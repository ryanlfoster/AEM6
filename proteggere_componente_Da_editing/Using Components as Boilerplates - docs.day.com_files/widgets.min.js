try{var p=CQ_swfobject.p
}catch(e){
/*! SWFObject v2.1 <http://code.google.com/p/swfobject/>
     Copyright (c) 2007-2008 Geoff Stearns, Michael Williams, and Bobby van der Sluis
     This software is released under the MIT License <http://www.opensource.org/licenses/mit-license.php>
     */
var CQ_swfobject=function(){var UNDEF="undefined",OBJECT="object",SHOCKWAVE_FLASH="Shockwave Flash",SHOCKWAVE_FLASH_AX="ShockwaveFlash.ShockwaveFlash",FLASH_MIME_TYPE="application/x-shockwave-flash",EXPRESS_INSTALL_ID="SWFObjectExprInst",win=window,doc=document,nav=navigator,domLoadFnArr=[],regObjArr=[],objIdArr=[],listenersArr=[],script,timer=null,storedAltContent=null,storedAltContentId=null,isDomLoaded=false,isExpressInstallActive=false;
var ua=function(){var w3cdom=typeof doc.getElementById!=UNDEF&&typeof doc.getElementsByTagName!=UNDEF&&typeof doc.createElement!=UNDEF,playerVersion=[0,0,0],d=null;
if(typeof nav.plugins!=UNDEF&&typeof nav.plugins[SHOCKWAVE_FLASH]==OBJECT){d=nav.plugins[SHOCKWAVE_FLASH].description;
if(d&&!(typeof nav.mimeTypes!=UNDEF&&nav.mimeTypes[FLASH_MIME_TYPE]&&!nav.mimeTypes[FLASH_MIME_TYPE].enabledPlugin)){d=d.replace(/^.*\s+(\S+\s+\S+$)/,"$1");
playerVersion[0]=parseInt(d.replace(/^(.*)\..*$/,"$1"),10);
playerVersion[1]=parseInt(d.replace(/^.*\.(.*)\s.*$/,"$1"),10);
playerVersion[2]=/r/.test(d)?parseInt(d.replace(/^.*r(.*)$/,"$1"),10):0
}}else{if(typeof win.ActiveXObject!=UNDEF){var a=null,fp6Crash=false;
try{a=new ActiveXObject(SHOCKWAVE_FLASH_AX+".7")
}catch(e){try{a=new ActiveXObject(SHOCKWAVE_FLASH_AX+".6");
playerVersion=[6,0,21];
a.allowScriptAccess="sameDomain"
}catch(e){if(playerVersion[0]==6){fp6Crash=true
}}if(!fp6Crash){try{a=new ActiveXObject(SHOCKWAVE_FLASH_AX)
}catch(e){}}}if(!fp6Crash&&a){try{d=a.GetVariable("$version");
if(d){d=d.split(" ")[1].split(",");
playerVersion=[parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10)]
}}catch(e){}}}}var u=nav.userAgent.toLowerCase(),p=nav.platform.toLowerCase(),webkit=/webkit/.test(u)?parseFloat(u.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,ie=false,windows=p?/win/.test(p):/win/.test(u),mac=p?/mac/.test(p):/mac/.test(u);
/*@cc_on
             ie = true;
             @if (@_win32)
             windows = true;
             @elif (@_mac)
             mac = true;
             @end
             @*/
return{w3cdom:w3cdom,pv:playerVersion,webkit:webkit,ie:ie,win:windows,mac:mac}
}();
var onDomLoad=function(){if(!ua.w3cdom){return
}addDomLoadEvent(main);
if(ua.webkit&&typeof doc.readyState!=UNDEF){timer=setInterval(function(){if(/loaded|complete/.test(doc.readyState)){callDomLoadFunctions()
}},10)
}if(typeof doc.addEventListener!=UNDEF){doc.addEventListener("DOMContentLoaded",callDomLoadFunctions,null)
}addLoadEvent(callDomLoadFunctions)
}();
function checkReadyState(){if(script.readyState=="complete"){script.parentNode.removeChild(script);
callDomLoadFunctions()
}}function callDomLoadFunctions(){if(isDomLoaded){return
}isDomLoaded=true;
if(timer){clearInterval(timer);
timer=null
}var dl=domLoadFnArr.length;
for(var i=0;
i<dl;
i++){domLoadFnArr[i]()
}}function addDomLoadEvent(fn){if(isDomLoaded){fn()
}else{domLoadFnArr[domLoadFnArr.length]=fn
}}function addLoadEvent(fn){if(typeof win.addEventListener!=UNDEF){win.addEventListener("load",fn,false)
}else{if(typeof doc.addEventListener!=UNDEF){doc.addEventListener("load",fn,false)
}else{if(typeof win.attachEvent!=UNDEF){addListener(win,"onload",fn)
}else{if(typeof win.onload=="function"){var fnOld=win.onload;
win.onload=function(){fnOld();
fn()
}
}else{win.onload=fn
}}}}}function main(){var rl=regObjArr.length;
for(var i=0;
i<rl;
i++){var id=regObjArr[i].id;
if(ua.pv[0]>0){var obj=getElementById(id);
if(obj){regObjArr[i].width=obj.getAttribute("width")?obj.getAttribute("width"):"0";
regObjArr[i].height=obj.getAttribute("height")?obj.getAttribute("height"):"0";
if(hasPlayerVersion(regObjArr[i].swfVersion)){if(ua.webkit&&ua.webkit<312){fixParams(obj)
}setVisibility(id,true)
}else{if(regObjArr[i].expressInstall&&!isExpressInstallActive&&hasPlayerVersion("6.0.65")&&(ua.win||ua.mac)){showExpressInstall(regObjArr[i])
}else{displayAltContent(obj)
}}}}else{setVisibility(id,true)
}}}function fixParams(obj){var nestedObj=obj.getElementsByTagName(OBJECT)[0];
if(nestedObj){var e=createElement("embed"),a=nestedObj.attributes;
if(a){var al=a.length;
for(var i=0;
i<al;
i++){if(a[i].nodeName=="DATA"){e.setAttribute("src",a[i].nodeValue)
}else{e.setAttribute(a[i].nodeName,a[i].nodeValue)
}}}var c=nestedObj.childNodes;
if(c){var cl=c.length;
for(var j=0;
j<cl;
j++){if(c[j].nodeType==1&&c[j].nodeName=="PARAM"){e.setAttribute(c[j].getAttribute("name"),c[j].getAttribute("value"))
}}}obj.parentNode.replaceChild(e,obj)
}}function showExpressInstall(regObj){isExpressInstallActive=true;
var obj=getElementById(regObj.id);
if(obj){if(regObj.altContentId){var ac=getElementById(regObj.altContentId);
if(ac){storedAltContent=ac;
storedAltContentId=regObj.altContentId
}}else{storedAltContent=abstractAltContent(obj)
}if(!(/%$/.test(regObj.width))&&parseInt(regObj.width,10)<310){regObj.width="310"
}if(!(/%$/.test(regObj.height))&&parseInt(regObj.height,10)<137){regObj.height="137"
}doc.title=doc.title.slice(0,47)+" - Flash Player Installation";
var pt=ua.ie&&ua.win?"ActiveX":"PlugIn",dt=doc.title,fv="MMredirectURL="+win.location+"&MMplayerType="+pt+"&MMdoctitle="+dt,replaceId=regObj.id;
if(ua.ie&&ua.win&&obj.readyState!=4){var newObj=createElement("div");
replaceId+="SWFObjectNew";
newObj.setAttribute("id",replaceId);
obj.parentNode.insertBefore(newObj,obj);
obj.style.display="none";
var fn=function(){obj.parentNode.removeChild(obj)
};
addListener(win,"onload",fn)
}createSWF({data:regObj.expressInstall,id:EXPRESS_INSTALL_ID,width:regObj.width,height:regObj.height},{flashvars:fv},replaceId)
}}function displayAltContent(obj){if(ua.ie&&ua.win&&obj.readyState!=4){var el=createElement("div");
obj.parentNode.insertBefore(el,obj);
el.parentNode.replaceChild(abstractAltContent(obj),el);
obj.style.display="none";
var fn=function(){obj.parentNode.removeChild(obj)
};
addListener(win,"onload",fn)
}else{obj.parentNode.replaceChild(abstractAltContent(obj),obj)
}}function abstractAltContent(obj){var ac=createElement("div");
if(ua.win&&ua.ie){ac.innerHTML=obj.innerHTML
}else{var nestedObj=obj.getElementsByTagName(OBJECT)[0];
if(nestedObj){var c=nestedObj.childNodes;
if(c){var cl=c.length;
for(var i=0;
i<cl;
i++){if(!(c[i].nodeType==1&&c[i].nodeName=="PARAM")&&!(c[i].nodeType==8)){ac.appendChild(c[i].cloneNode(true))
}}}}}return ac
}function createSWF(attObj,parObj,id){var r,el=getElementById(id);
if(el){if(typeof attObj.id==UNDEF){attObj.id=id
}if(ua.ie&&ua.win){var att="";
for(var i in attObj){if(attObj[i]!=Object.prototype[i]){if(i.toLowerCase()=="data"){parObj.movie=attObj[i]
}else{if(i.toLowerCase()=="styleclass"){att+=' class="'+attObj[i]+'"'
}else{if(i.toLowerCase()!="classid"){att+=" "+i+'="'+attObj[i]+'"'
}}}}}var par="";
for(var j in parObj){if(parObj[j]!=Object.prototype[j]){par+='<param name="'+j+'" value="'+parObj[j]+'" />'
}}el.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+att+">"+par+"</object>";
objIdArr[objIdArr.length]=attObj.id;
r=getElementById(attObj.id)
}else{if(ua.webkit&&ua.webkit<312){var e=createElement("embed");
e.setAttribute("type",FLASH_MIME_TYPE);
for(var k in attObj){if(attObj[k]!=Object.prototype[k]){if(k.toLowerCase()=="data"){e.setAttribute("src",attObj[k])
}else{if(k.toLowerCase()=="styleclass"){e.setAttribute("class",attObj[k])
}else{if(k.toLowerCase()!="classid"){e.setAttribute(k,attObj[k])
}}}}}for(var l in parObj){if(parObj[l]!=Object.prototype[l]){if(l.toLowerCase()!="movie"){e.setAttribute(l,parObj[l])
}}}el.parentNode.replaceChild(e,el);
r=e
}else{var o=createElement(OBJECT);
o.setAttribute("type",FLASH_MIME_TYPE);
for(var m in attObj){if(attObj[m]!=Object.prototype[m]){if(m.toLowerCase()=="styleclass"){o.setAttribute("class",attObj[m])
}else{if(m.toLowerCase()!="classid"){o.setAttribute(m,attObj[m])
}}}}for(var n in parObj){if(parObj[n]!=Object.prototype[n]&&n.toLowerCase()!="movie"){createObjParam(o,n,parObj[n])
}}el.parentNode.replaceChild(o,el);
r=o
}}}r.style.outline="none";
return r
}function createObjParam(el,pName,pValue){var p=createElement("param");
p.setAttribute("name",pName);
p.setAttribute("value",pValue);
el.appendChild(p)
}function removeSWF(id){var obj=getElementById(id);
if(obj&&(obj.nodeName=="OBJECT"||obj.nodeName=="EMBED")){if(ua.ie&&ua.win){if(obj.readyState==4){removeObjectInIE(id)
}else{win.attachEvent("onload",function(){removeObjectInIE(id)
})
}}else{obj.parentNode.removeChild(obj)
}}}function removeObjectInIE(id){var obj=getElementById(id);
if(obj){for(var i in obj){if(typeof obj[i]=="function"){obj[i]=null
}}obj.parentNode.removeChild(obj)
}}function getElementById(id){var el=null;
try{el=doc.getElementById(id)
}catch(e){}return el
}function createElement(el){return doc.createElement(el)
}function addListener(target,eventType,fn){target.attachEvent(eventType,fn);
listenersArr[listenersArr.length]=[target,eventType,fn]
}function hasPlayerVersion(rv){var pv=ua.pv,v=rv.split(".");
v[0]=parseInt(v[0],10);
v[1]=parseInt(v[1],10)||0;
v[2]=parseInt(v[2],10)||0;
return(pv[0]>v[0]||(pv[0]==v[0]&&pv[1]>v[1])||(pv[0]==v[0]&&pv[1]==v[1]&&pv[2]>=v[2]))?true:false
}function createCSS(sel,decl){if(ua.ie&&ua.mac){return
}var h=doc.getElementsByTagName("head")[0],s=createElement("style");
s.setAttribute("type","text/css");
s.setAttribute("media","screen");
if(!(ua.ie&&ua.win)&&typeof doc.createTextNode!=UNDEF){s.appendChild(doc.createTextNode(sel+" {"+decl+"}"))
}h.appendChild(s);
if(ua.ie&&ua.win&&typeof doc.styleSheets!=UNDEF&&doc.styleSheets.length>0){var ls=doc.styleSheets[doc.styleSheets.length-1];
if(typeof ls.addRule==OBJECT){ls.addRule(sel,decl)
}}}function setVisibility(id,isVisible){var v=isVisible?"visible":"hidden";
if(isDomLoaded&&getElementById(id)){getElementById(id).style.visibility=v
}else{createCSS("#"+id,"visibility:"+v)
}}function urlEncodeIfNecessary(s){var regex=/[\\\"<>\.;]/;
var hasBadChars=regex.exec(s)!=null;
return hasBadChars?encodeURIComponent(s):s
}var cleanup=function(){if(ua.ie&&ua.win){var fn=function(){var ll=listenersArr.length;
for(var i=0;
i<ll;
i++){listenersArr[i][0].detachEvent(listenersArr[i][1],listenersArr[i][2])
}var il=objIdArr.length;
for(var j=0;
j<il;
j++){removeSWF(objIdArr[j])
}for(var k in ua){ua[k]=null
}ua=null;
for(var l in CQ_swfobject){CQ_swfobject[l]=null
}CQ_swfobject=null;
window.detachEvent("onunload",fn)
};
window.attachEvent("onunload",fn)
}}();
return{registerObject:function(objectIdStr,swfVersionStr,xiSwfUrlStr){if(!ua.w3cdom||!objectIdStr||!swfVersionStr){return
}var regObj={};
regObj.id=objectIdStr;
regObj.swfVersion=swfVersionStr;
regObj.expressInstall=xiSwfUrlStr?xiSwfUrlStr:false;
regObjArr[regObjArr.length]=regObj;
setVisibility(objectIdStr,false)
},getObjectById:function(objectIdStr){var r=null;
if(ua.w3cdom){var o=getElementById(objectIdStr);
if(o){var n=o.getElementsByTagName(OBJECT)[0];
if(!n||(n&&typeof o.SetVariable!=UNDEF)){r=o
}else{if(typeof n.SetVariable!=UNDEF){r=n
}}}}return r
},embedSWF:function(swfUrlStr,replaceElemIdStr,widthStr,heightStr,swfVersionStr,xiSwfUrlStr,flashvarsObj,parObj,attObj){if(document.readyState===undefined||document.readyState=="complete"){callDomLoadFunctions()
}if(!ua.w3cdom||!swfUrlStr||!replaceElemIdStr||!widthStr||!heightStr||!swfVersionStr){return
}widthStr+="";
heightStr+="";
if(hasPlayerVersion(swfVersionStr)){setVisibility(replaceElemIdStr,false);
var att={};
if(attObj&&typeof attObj===OBJECT){for(var i in attObj){if(attObj[i]!=Object.prototype[i]){att[i]=attObj[i]
}}}att.data=swfUrlStr;
att.width=widthStr;
att.height=heightStr;
var par={};
if(parObj&&typeof parObj===OBJECT){for(var j in parObj){if(parObj[j]!=Object.prototype[j]){par[j]=parObj[j]
}}}if(flashvarsObj&&typeof flashvarsObj===OBJECT){for(var k in flashvarsObj){if(flashvarsObj[k]!=Object.prototype[k]){if(typeof par.flashvars!=UNDEF){par.flashvars+="&"+k+"="+flashvarsObj[k]
}else{par.flashvars=k+"="+flashvarsObj[k]
}}}}addDomLoadEvent(function(){createSWF(att,par,replaceElemIdStr);
if(att.id==replaceElemIdStr){setVisibility(replaceElemIdStr,true)
}})
}else{if(xiSwfUrlStr&&!isExpressInstallActive&&hasPlayerVersion("6.0.65")&&(ua.win||ua.mac)){isExpressInstallActive=true;
setVisibility(replaceElemIdStr,false);
addDomLoadEvent(function(){var regObj={};
regObj.id=regObj.altContentId=replaceElemIdStr;
regObj.width=widthStr;
regObj.height=heightStr;
regObj.expressInstall=xiSwfUrlStr;
showExpressInstall(regObj)
})
}}},getFlashPlayerVersion:function(){return{major:ua.pv[0],minor:ua.pv[1],release:ua.pv[2]}
},hasFlashPlayerVersion:hasPlayerVersion,createSWF:function(attObj,parObj,replaceElemIdStr){if(ua.w3cdom){return createSWF(attObj,parObj,replaceElemIdStr)
}else{return undefined
}},removeSWF:function(objElemIdStr){if(ua.w3cdom){removeSWF(objElemIdStr)
}},createCSS:function(sel,decl){if(ua.w3cdom){createCSS(sel,decl)
}},addDomLoadEvent:addDomLoadEvent,addLoadEvent:addLoadEvent,getQueryParamValue:function(param){var q=doc.location.search||doc.location.hash;
if(param==null){return urlEncodeIfNecessary(q)
}if(q){var pairs=q.substring(1).split("&");
for(var i=0;
i<pairs.length;
i++){if(pairs[i].substring(0,pairs[i].indexOf("="))==param){return urlEncodeIfNecessary(pairs[i].substring((pairs[i].indexOf("=")+1)))
}}}return""
},expressInstallCallback:function(){if(isExpressInstallActive&&storedAltContent){var obj=getElementById(EXPRESS_INSTALL_ID);
if(obj){obj.parentNode.replaceChild(storedAltContent,obj);
if(storedAltContentId){setVisibility(storedAltContentId,true);
if(ua.ie&&ua.win){storedAltContent.style.display="block"
}}storedAltContent=null;
storedAltContentId=null;
isExpressInstallActive=false
}}}}
}()
}window.CQ=window.CQ||{};
CQ.state={};
CQ.data={};
CQ.ipe={};
CQ.form={};
CQ.html5={};
CQ.html5.form={};
CQ.menu={};
CQ.tree={};
CQ.utils={};
CQ.security={};
CQ.wcm={};
CQ.wcm.msm={};
CQ.undo={};
CQ.undo.actions={};
CQ.undo.util={};
CQ.undo.persistence={};
CQ.endorsed={};
CQ.themes={};
CQ.themes.wcm={};
CQ.Class=function(){};
if(window.console===undefined){window.console={log:function(a){}}
}CQ.REQUEST_TIMEOUT=600000;
CQ.HEARTBEAT_INTERVAL=0;
CQ.HEARTBEAT_URL="/libs/cq/core/content/heartbeat.json";
CQ.VERY_SHORT_INTERVAL="VERY_SHORT_INTERVAL";
CQ.VERY_SHORT_INTERVAL_VALUE=200;
CQ.SHORT_INTERVAL="SHORT_INTERVAL";
CQ.SHORT_INTERVAL_VALUE=1000;
CQ.LONG_INTERVAL="LONG_INTERVAL";
CQ.LONG_INTERVAL_VALUE=20000;
CQ.VERY_LONG_INTERVAL="VERY_LONG_INTERVAL";
CQ.VERY_LONG_INTERVAL_VALUE=240000;
CQ.CF_REFRESH_INTERVAL=0;
CQ.EDITBASE_DD_MIMEMAPPING=[{mimeType:/image\/(gif|jpeg|png)/,resourceType:"foundation/components/image",binaryProp:"./file"+CQ.Sling.MOVE_SUFFIX,fileNameProp:"./jcr:title"},{mimeType:/application\/x-shockwave-flash/,resourceType:"foundation/components/flash",binaryProp:"./file"+CQ.Sling.MOVE_SUFFIX,fileNameProp:"./fileName"},{mimeType:/.*/,resourceType:"foundation/components/download",binaryProp:"./file"+CQ.Sling.MOVE_SUFFIX,fileNameProp:"./fileName"}];
CQ.TREE_AUTOEXPAND_MAX=30;
CQ.Timing=function(){return{stamps:null,cqPageRenderStart:null,lastTimes:{},init:function(){this.cqPageRenderStart=new Date();
this.lastTimes["default"]=new Date();
this.stamps="";
var b=window.onload;
if(typeof window.onload!="function"){window.onload=CQ.Timing.stampOnLoad
}else{window.onload=function(){if(b){b()
}CQ.Timing.stampOnLoad()
}
}var a=window.document.onkeydown;
if(typeof window.document.onkeydown!="function"){window.document.onkeydown=CQ.Timing.showDiv
}else{window.document.onkeydown=function(c){if(a){a(c)
}CQ.Timing.showDiv(c)
}
}},stamp:function(k,m,g){if(!m){m="default"
}var j=this.lastTimes[m];
var a=new Date();
var b;
if(g||j==undefined){b="&nbsp;---"
}else{b=a-j;
b=(b<1000?(b<100?(b<10?"&nbsp;&nbsp;&nbsp;":"&nbsp;&nbsp;"):"&nbsp;"):"")+b
}var c=b+" / "+(a-this.cqPageRenderStart)+" ms &ndash; "+k;
this.lastTimes[m]=a;
this.stamps+=(this.stamps)?","+c:c
},stampOnLoad:function(){CQ.Timing.stamp("Complete document loaded");
window.onload=null
},writeDiv:function(){var a=window.document.createElement("div");
var b=a.style;
a.id="cqTiming";
b.margin="0 auto 0 auto";
b.borderBottom="1px solid #000000";
b.marginBottom="5px";
b.fontSize="small";
b.fontFamily="monospace";
b.backgroundColor="#000000";
b.color="#ffffff";
b.position="absolute";
b.top="0px";
b.left="0px";
a.innerHTML='<p style="margin: 2px 0 1px 0"> Page load staticstics:<br>'+this.stamps.replace(/,/g,"<br>")+'</p><p style="margin: 2px 0 1px 0; text-align: right"><a href="javascript:{CQ.Timing.hideDiv();}">Close</a></p>';
window.document.body.appendChild(a)
},hideDiv:function(){window.document.getElementById("cqTiming").style.display="none"
},showDiv:function(c){var b;
var a;
if(document.all){b=window.event.keyCode;
a=window.event
}else{b=(typeof(c.which)!="undefined")?c.which:0;
a=c
}if(a&&a.ctrlKey&&a.shiftKey&&b==85){CQ.Timing.writeDiv()
}}}
}();
CQ.Timing.init();
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
window.undefined=window.undefined;
CQ.Ext={version:"3.4.0",versionDetail:{major:3,minor:4,patch:0}};
CQ.Ext.apply=function(g,j,b){if(b){CQ.Ext.apply(g,b)
}if(g&&j&&typeof j=="object"){for(var a in j){g[a]=j[a]
}}return g
};
(function(){var c=0,w=Object.prototype.toString,x=navigator.userAgent.toLowerCase(),B=function(F){return F.test(x)
},j=document,o=j.documentMode,m=j.compatMode=="CSS1Compat",D=B(/opera/),g=B(/\bchrome\b/),y=B(/webkit/),A=!g&&B(/safari/),b=A&&B(/applewebkit\/4/),a=A&&B(/version\/3/),E=A&&B(/version\/4/),v=!D&&B(/msie/),C=v&&(B(/msie 7/)&&B(/trident\/5.0/)),t=v&&(B(/msie 7/)||o==7)&&!C,r=v&&(B(/msie 8/)&&o!=7),q=v&&B(/msie 9/),n=v&&B(/msie 10/),u=v&&!t&&!r&&!q&&!n&&!C,k=v&&(u||t||r);
isGecko=!y&&B(/gecko/),isGecko2=isGecko&&B(/rv:1\.8/),isGecko4=isGecko&&B(/rv:2.0/),isGecko3=isGecko&&(B(/rv:1\.9/)||isGecko4),isBorderBox=v&&!m,isWindows=B(/windows|win32/),isMac=B(/macintosh|mac os x/),isAir=B(/adobeair/),isLinux=B(/linux/),isSecure=/^https/i.test(window.location.protocol);
if(u){try{j.execCommand("BackgroundImageCache",false,true)
}catch(z){}}CQ.Ext.apply(CQ.Ext,{SSL_SECURE_URL:isSecure&&v?'javascript:""':"about:blank",isStrict:m,isSecure:isSecure,isReady:false,enableForcedBoxModel:false,enableGarbageCollector:true,enableListenerCollection:false,enableNestedListenerRemoval:false,USE_NATIVE_JSON:false,applyIf:function(G,H){if(G){for(var F in H){if(!CQ.Ext.isDefined(G[F])){G[F]=H[F]
}}}return G
},id:function(F,G){F=CQ.Ext.getDom(F,true)||{};
if(!F.id){F.id=(G||"cq-gen")+(++c)
}return F.id
},extend:function(){var G=function(I){for(var H in I){this[H]=I[H]
}};
var F=Object.prototype.constructor;
return function(M,J,L){if(typeof J=="object"){L=J;
J=M;
M=L.constructor!=F?L.constructor:function(){J.apply(this,arguments)
}
}var I=function(){},K,H=J.prototype;
I.prototype=H;
K=M.prototype=new I();
K.constructor=M;
M.superclass=H;
if(H.constructor==F){H.constructor=J
}M.override=function(N){CQ.Ext.override(M,N)
};
K.superclass=K.supr=(function(){return H
});
K.override=G;
CQ.Ext.override(M,L);
M.extend=function(N){return CQ.Ext.extend(M,N)
};
return M
}
}(),override:function(F,H){if(H){var G=F.prototype;
CQ.Ext.apply(G,H);
if(CQ.Ext.isIE&&H.hasOwnProperty("toString")){G.toString=H.toString
}}},namespace:function(){var I=arguments.length,J=0,G,H,F,L,K,M;
for(;
J<I;
++J){F=arguments[J];
L=arguments[J].split(".");
M=window[L[0]];
if(M===undefined){M=window[L[0]]={}
}K=L.slice(1);
G=K.length;
for(H=0;
H<G;
++H){M=M[K[H]]=M[K[H]]||{}
}}return M
},urlEncode:function(J,I){var G,F=[],H=encodeURIComponent;
CQ.Ext.iterate(J,function(K,L){G=CQ.Ext.isEmpty(L);
CQ.Ext.each(G?K:L,function(M){F.push("&",H(K),"=",(!CQ.Ext.isEmpty(M)&&(M!=K||!G))?(CQ.Ext.isDate(M)?CQ.Ext.encode(M).replace(/"/g,""):H(M)):"")
})
});
if(!I){F.shift();
I=""
}return I+F.join("")
},urlDecode:function(H,G){if(CQ.Ext.isEmpty(H)){return{}
}var K={},J=H.split("&"),L=decodeURIComponent,F,I;
CQ.Ext.each(J,function(M){M=M.split("=");
F=L(M[0]);
I=L(M[1]);
K[F]=G||!K[F]?I:[].concat(K[F]).concat(I)
});
return K
},urlAppend:function(F,G){if(!CQ.Ext.isEmpty(G)){return F+(F.indexOf("?")===-1?"?":"&")+G
}return F
},toArray:function(){return v?function(H,K,I,J){J=[];
for(var G=0,F=H.length;
G<F;
G++){J.push(H[G])
}return J.slice(K||0,I||J.length)
}:function(F,H,G){return Array.prototype.slice.call(F,H||0,G||F.length)
}
}(),isIterable:function(F){if(CQ.Ext.isArray(F)||F.callee){return true
}if(/NodeList|HTMLCollection/.test(w.call(F))){return true
}return((typeof F.nextNode!="undefined"||F.item)&&CQ.Ext.isNumber(F.length))
},each:function(J,I,H){if(CQ.Ext.isEmpty(J,true)){return
}if(!CQ.Ext.isIterable(J)||CQ.Ext.isPrimitive(J)){J=[J]
}for(var G=0,F=J.length;
G<F;
G++){if(I.call(H||J[G],J[G],G,J)===false){return G
}}},iterate:function(H,G,F){if(CQ.Ext.isEmpty(H)){return
}if(CQ.Ext.isIterable(H)){CQ.Ext.each(H,G,F);
return
}else{if(typeof H=="object"){for(var I in H){if(H.hasOwnProperty(I)){if(G.call(F||H,I,H[I],H)===false){return
}}}}}},getDom:function(G,F){if(!G||!j){return null
}if(G.dom){return G.dom
}else{if(typeof G=="string"){var H=j.getElementById(G);
if(H&&v&&F){if(G==H.getAttribute("id")){return H
}else{return null
}}return H
}else{return G
}}},getBody:function(){return CQ.Ext.get(j.body||j.documentElement)
},getHead:function(){var F;
return function(){if(F==undefined){F=CQ.Ext.get(j.getElementsByTagName("head")[0])
}return F
}
}(),removeNode:v&&!r?function(){var F;
return function(G){if(G&&G.tagName!="BODY"){(CQ.Ext.enableNestedListenerRemoval)?CQ.Ext.EventManager.purgeElement(G,true):CQ.Ext.EventManager.removeAll(G);
F=F||j.createElement("div");
F.appendChild(G);
F.innerHTML="";
delete CQ.Ext.elCache[G.id]
}}
}():function(F){if(F&&F.parentNode&&F.tagName!="BODY"){(CQ.Ext.enableNestedListenerRemoval)?CQ.Ext.EventManager.purgeElement(F,true):CQ.Ext.EventManager.removeAll(F);
F.parentNode.removeChild(F);
delete CQ.Ext.elCache[F.id]
}},isEmpty:function(G,F){return G===null||G===undefined||((CQ.Ext.isArray(G)&&!G.length))||(!F?G==="":false)
},isArray:function(F){return w.apply(F)==="[object Array]"
},isDate:function(F){return w.apply(F)==="[object Date]"
},isObject:function(F){return !!F&&Object.prototype.toString.call(F)==="[object Object]"
},isPrimitive:function(F){return CQ.Ext.isString(F)||CQ.Ext.isNumber(F)||CQ.Ext.isBoolean(F)
},isFunction:function(F){return w.apply(F)==="[object Function]"
},isNumber:function(F){return typeof F==="number"&&isFinite(F)
},isString:function(F){return typeof F==="string"
},isBoolean:function(F){return typeof F==="boolean"
},isElement:function(F){return F?!!F.tagName:false
},isDefined:function(F){return typeof F!=="undefined"
},isOpera:D,isWebKit:y,isChrome:g,isSafari:A,isSafari3:a,isSafari4:E,isSafari2:b,isIE:v,isIE6:u,isIE7:t,isIE8:r,isIE9:q,isIE10:n,isOldIE:k,isGecko:isGecko,isGecko2:isGecko2,isGecko3:isGecko3,isGecko4:isGecko4,isBorderBox:isBorderBox,isLinux:isLinux,isWindows:isWindows,isMac:isMac,isAir:isAir});
CQ.Ext.ns=CQ.Ext.namespace
})();
CQ.Ext.ns("CQ.Ext.util","CQ.Ext.lib","CQ.Ext.data","CQ.Ext.supports");
CQ.Ext.elCache={};
CQ.Ext.apply(Function.prototype,{createInterceptor:function(b,a){var c=this;
return !CQ.Ext.isFunction(b)?this:function(){var j=this,g=arguments;
b.target=j;
b.method=c;
return(b.apply(a||j||window,g)!==false)?c.apply(j||window,g):null
}
},createCallback:function(){var a=arguments,b=this;
return function(){return b.apply(window,a)
}
},createDelegate:function(c,b,a){var g=this;
return function(){var k=b||arguments;
if(a===true){k=Array.prototype.slice.call(arguments,0);
k=k.concat(b)
}else{if(CQ.Ext.isNumber(a)){k=Array.prototype.slice.call(arguments,0);
var j=[a,0].concat(b);
Array.prototype.splice.apply(k,j)
}}return g.apply(c||window,k)
}
},defer:function(c,j,b,a){var g=this.createDelegate(j,b,a);
if(c>0){return setTimeout(g,c)
}g();
return 0
}});
CQ.Ext.applyIf(String,{format:function(b){var a=CQ.Ext.toArray(arguments,1);
return b.replace(/\{(\d+)\}/g,function(c,g){return a[g]
})
}});
CQ.Ext.applyIf(Array.prototype,{indexOf:function(b,c){var a=this.length;
c=c||0;
c+=(c<0)?a:0;
for(;
c<a;
++c){if(this[c]===b){return c
}}return -1
},remove:function(b){var a=this.indexOf(b);
if(a!=-1){this.splice(a,1)
}return this
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.util.TaskRunner=function(j){j=j||10;
var k=[],a=[],b=0,m=false,g=function(){m=false;
clearInterval(b);
b=0
},n=function(){if(!m){m=true;
b=setInterval(o,j)
}},c=function(q){a.push(q);
if(q.onStop){q.onStop.apply(q.scope||q)
}},o=function(){var u=a.length,w=new Date().getTime();
if(u>0){for(var y=0;
y<u;
y++){k.remove(a[y])
}a=[];
if(k.length<1){g();
return
}}for(var y=0,x,r,v,q=k.length;
y<q;
++y){x=k[y];
r=w-x.taskRunTime;
if(x.interval<=r){v=x.run.apply(x.scope||x,x.args||[++x.taskRunCount]);
x.taskRunTime=w;
if(v===false||x.taskRunCount===x.repeat){c(x);
return
}}if(x.duration&&x.duration<=(w-x.taskStartTime)){c(x)
}}};
this.start=function(q){k.push(q);
q.taskStartTime=new Date().getTime();
q.taskRunTime=0;
q.taskRunCount=0;
n();
return q
};
this.stop=function(q){c(q);
return q
};
this.stopAll=function(){g();
for(var r=0,q=k.length;
r<q;
r++){if(k[r].onStop){k[r].onStop()
}}k=[];
a=[]
}
};
CQ.Ext.TaskMgr=new CQ.Ext.util.TaskRunner();
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
(function(){var b;
function c(g){if(!b){b=new CQ.Ext.Element.Flyweight()
}b.dom=g;
return b
}(function(){var m=document,j=m.compatMode=="CSS1Compat",k=Math.max,g=Math.round,n=parseInt;
CQ.Ext.lib.Dom={isAncestor:function(q,r){var o=false;
q=CQ.Ext.getDom(q);
r=CQ.Ext.getDom(r);
if(q&&r){if(q.contains){return q.contains(r)
}else{if(q.compareDocumentPosition){return !!(q.compareDocumentPosition(r)&16)
}else{while(r=r.parentNode){o=r==q||o
}}}}return o
},getViewWidth:function(o){return o?this.getDocumentWidth():this.getViewportWidth()
},getViewHeight:function(o){return o?this.getDocumentHeight():this.getViewportHeight()
},getDocumentHeight:function(){return k(!j?m.body.scrollHeight:m.documentElement.scrollHeight,this.getViewportHeight())
},getDocumentWidth:function(){return k(!j?m.body.scrollWidth:m.documentElement.scrollWidth,this.getViewportWidth())
},getViewportHeight:function(){return CQ.Ext.isIE?(CQ.Ext.isStrict?m.documentElement.clientHeight:m.body.clientHeight):self.innerHeight
},getViewportWidth:function(){return !CQ.Ext.isStrict&&!CQ.Ext.isOpera?m.body.clientWidth:CQ.Ext.isIE?m.documentElement.clientWidth:self.innerWidth
},getY:function(o){return this.getXY(o)[1]
},getX:function(o){return this.getXY(o)[0]
},getXY:function(r){var q,z,B,E,t,u,D=0,A=0,C,o,v=(m.body||m.documentElement),w=[0,0];
r=CQ.Ext.getDom(r);
if(r!=v){if(r.getBoundingClientRect){B=r.getBoundingClientRect();
C=c(document).getScroll();
w=[g(B.left+C.left),g(B.top+C.top)]
}else{q=r;
o=c(r).isStyle("position","absolute");
while(q){z=c(q);
D+=q.offsetLeft;
A+=q.offsetTop;
o=o||z.isStyle("position","absolute");
if(CQ.Ext.isGecko){A+=E=n(z.getStyle("borderTopWidth"),10)||0;
D+=t=n(z.getStyle("borderLeftWidth"),10)||0;
if(q!=r&&!z.isStyle("overflow","visible")){D+=t;
A+=E
}}q=q.offsetParent
}if(CQ.Ext.isSafari&&o){D-=v.offsetLeft;
A-=v.offsetTop
}if(CQ.Ext.isGecko&&!o){u=c(v);
D+=n(u.getStyle("borderLeftWidth"),10)||0;
A+=n(u.getStyle("borderTopWidth"),10)||0
}q=r.parentNode;
while(q&&q!=v){if(!CQ.Ext.isOpera||(q.tagName!="TR"&&!c(q).isStyle("display","inline"))){D-=q.scrollLeft;
A-=q.scrollTop
}q=q.parentNode
}w=[D,A]
}}return w
},setXY:function(q,r){(q=CQ.Ext.fly(q,"_setXY")).position();
var t=q.translatePoints(r),o=q.dom.style,u;
for(u in t){if(!isNaN(t[u])){o[u]=t[u]+"px"
}}},setX:function(q,o){this.setXY(q,[o,false])
},setY:function(o,q){this.setXY(o,[false,q])
}}
})();
CQ.Ext.lib.Event=function(){var D=false,k={},H=0,w=[],g,I=false,r=window,M=document,t=200,z=20,x=0,o=1,A=2,E=3,B="scrollLeft",y="scrollTop",m="unload",G="mouseover",L="mouseout",j=function(){var N;
if(r.addEventListener){N=function(R,P,Q,O){if(P=="mouseenter"){Q=Q.createInterceptor(v);
R.addEventListener(G,Q,(O))
}else{if(P=="mouseleave"){Q=Q.createInterceptor(v);
R.addEventListener(L,Q,(O))
}else{R.addEventListener(P,Q,(O))
}}return Q
}
}else{if(r.attachEvent){N=function(R,P,Q,O){R.attachEvent("on"+P,Q);
return Q
}
}else{N=function(){}
}}return N
}(),n=function(){var N;
if(r.removeEventListener){N=function(R,P,Q,O){if(P=="mouseenter"){P=G
}else{if(P=="mouseleave"){P=L
}}R.removeEventListener(P,Q,(O))
}
}else{if(r.detachEvent){N=function(Q,O,P){Q.detachEvent("on"+O,P)
}
}else{N=function(){}
}}return N
}();
function v(N){return !C(N.currentTarget,F.getRelatedTarget(N))
}function C(N,O){if(N&&N.firstChild){while(O){if(O===N){return true
}O=O.parentNode;
if(O&&(O.nodeType!=1)){O=null
}}}return false
}function J(){var O=false,T=[],R,Q,N,P,S=!D||(H>0);
if(!I){I=true;
for(Q=0;
Q<w.length;
++Q){N=w[Q];
if(N&&(R=M.getElementById(N.id))){if(!N.checkReady||D||R.nextSibling||(M&&M.body)){P=N.override;
R=P?(P===true?N.obj:P):R;
N.fn.call(R,N.obj);
w.remove(N);
--Q
}else{T.push(N)
}}}H=(T.length===0)?0:H-1;
if(S){u()
}else{clearInterval(g);
g=null
}O=!(I=false)
}return O
}function u(){if(!g){var N=function(){J()
};
g=setInterval(N,z)
}}function K(){var N=M.documentElement,O=M.body;
if(N&&(N[y]||N[B])){return[N[B],N[y]]
}else{if(O){return[O[B],O[y]]
}else{return[0,0]
}}}function q(N,O){N=N.browserEvent||N;
var P=N["page"+O];
if(!P&&P!==0){P=N["client"+O]||0;
if(CQ.Ext.isIE){P+=K()[O=="X"?0:1]
}}return P
}var F={extAdapter:true,onAvailable:function(P,N,Q,O){w.push({id:P,fn:N,obj:Q,override:O,checkReady:false});
H=t;
u()
},addListener:function(P,N,O){P=CQ.Ext.getDom(P);
if(P&&O){if(N==m){if(k[P.id]===undefined){k[P.id]=[]
}k[P.id].push([N,O]);
return O
}return j(P,N,O,false)
}return false
},removeListener:function(T,P,S){T=CQ.Ext.getDom(T);
var R,O,N,Q;
if(T&&S){if(P==m){if((Q=k[T.id])!==undefined){for(R=0,O=Q.length;
R<O;
R++){if((N=Q[R])&&N[x]==P&&N[o]==S){k[T.id].splice(R,1)
}}}return
}n(T,P,S,false)
}},getTarget:function(N){N=N.browserEvent||N;
return this.resolveTextNode(N.target||N.srcElement)
},resolveTextNode:CQ.Ext.isGecko?function(O){if(!O){return
}var N=HTMLElement.prototype.toString.call(O);
if(N=="[xpconnect wrapped native prototype]"||N=="[object XULElement]"){return
}return O.nodeType==3?O.parentNode:O
}:function(N){return N&&N.nodeType==3?N.parentNode:N
},getRelatedTarget:function(N){N=N.browserEvent||N;
return this.resolveTextNode(N.relatedTarget||(/(mouseout|mouseleave)/.test(N.type)?N.toElement:/(mouseover|mouseenter)/.test(N.type)?N.fromElement:null))
},getPageX:function(N){return q(N,"X")
},getPageY:function(N){return q(N,"Y")
},getXY:function(N){return[this.getPageX(N),this.getPageY(N)]
},stopEvent:function(N){this.stopPropagation(N);
this.preventDefault(N)
},stopPropagation:function(N){N=N.browserEvent||N;
if(N.stopPropagation){N.stopPropagation()
}else{N.cancelBubble=true
}},preventDefault:function(N){N=N.browserEvent||N;
if(N.preventDefault){N.preventDefault()
}else{if(N.keyCode){N.keyCode=0
}N.returnValue=false
}},getEvent:function(N){N=N||r.event;
if(!N){var O=this.getEvent.caller;
while(O){N=O.arguments[0];
if(N&&Event==N.constructor){break
}O=O.caller
}}return N
},getCharCode:function(N){N=N.browserEvent||N;
return N.charCode||N.keyCode||0
},getListeners:function(O,N){CQ.Ext.EventManager.getListeners(O,N)
},purgeElement:function(O,P,N){CQ.Ext.EventManager.purgeElement(O,P,N)
},_load:function(N){D=true;
if(CQ.Ext.isIE&&N!==true){n(r,"load",arguments.callee)
}},_unload:function(R){var O=CQ.Ext.lib.Event,P,U,S,N,Q,V;
for(N in k){S=k[N];
for(P=0,Q=S.length;
P<Q;
P++){U=S[P];
if(U){try{V=U[E]?(U[E]===true?U[A]:U[E]):r;
U[o].call(V,O.getEvent(R),U[A])
}catch(T){}}}}CQ.Ext.EventManager._unload();
n(r,m,O._unload)
}};
F.on=F.addListener;
F.un=F.removeListener;
if(M&&M.body){F._load(true)
}else{j(r,"load",F._load)
}j(r,m,F._unload);
J();
return F
}();
CQ.Ext.lib.Ajax=function(){var m=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Msxml2.XMLHTTP"],g="Content-Type";
function n(D){var B=D.conn,E,C={};
function A(F,G){for(E in G){if(G.hasOwnProperty(E)){F.setRequestHeader(E,G[E])
}}}CQ.Ext.apply(C,r.headers,r.defaultHeaders);
A(B,C);
delete r.headers
}function j(D,C,B,A){return{tId:D,status:B?-1:0,statusText:B?"transaction aborted":"communication failure",isAbort:B,isTimeout:A,argument:C}
}function q(A,B){(r.headers=r.headers||{})[A]=B
}function x(A,E){var I={},D,C=A.conn,G,H,B=C.status==1223;
try{D=A.conn.getAllResponseHeaders();
CQ.Ext.each(D.replace(/\r\n/g,"\n").split("\n"),function(J){G=J.indexOf(":");
if(G>=0){H=J.substr(0,G).toLowerCase();
if(J.charAt(G+1)==" "){++G
}I[H]=J.substr(G+1)
}})
}catch(F){}return{tId:A.tId,status:B?204:C.status,statusText:B?"No Content":C.statusText,getResponseHeader:function(J){return I[J.toLowerCase()]
},getAllResponseHeaders:function(){return D
},responseText:C.responseText,responseXML:C.responseXML,argument:E}
}function w(A){if(A.tId){r.conn[A.tId]=null
}A.conn=null;
A=null
}function k(F,G,B,A){if(!G){w(F);
return
}var D,C;
try{if(F.conn.status!==undefined&&F.conn.status!=0){D=F.conn.status
}else{D=13030
}}catch(E){D=13030
}if((D>=200&&D<300)||(CQ.Ext.isIE&&D==1223)){C=x(F,G.argument);
if(G.success){if(!G.scope){G.success(C)
}else{G.success.apply(G.scope,[C])
}}}else{switch(D){case 12002:case 12029:case 12030:case 12031:case 12152:case 13030:C=j(F.tId,G.argument,(B?B:false),A);
if(G.failure){if(!G.scope){G.failure(C)
}else{G.failure.apply(G.scope,[C])
}}break;
default:C=x(F,G.argument);
if(G.failure){if(!G.scope){G.failure(C)
}else{G.failure.apply(G.scope,[C])
}}}}w(F);
C=null
}function u(C,F,A,E,B,D){if(A&&A.readyState==4){clearInterval(B[E]);
B[E]=null;
if(D){clearTimeout(r.timeout[E]);
r.timeout[E]=null
}k(C,F)
}}function z(A,B){r.abort(A,B,true)
}function v(C,F){F=F||{};
var A=C.conn,E=C.tId,B=r.poll,D=F.timeout||null;
if(D){r.conn[E]=A;
r.timeout[E]=setTimeout(z.createCallback(C,F),D)
}B[E]=setInterval(u.createCallback(C,F,A,E,B,D),r.pollInterval)
}function o(E,B,D,A){var C=t()||null;
if(C){C.conn.open(E,B,true);
if(r.useDefaultXhrHeader){q("X-Requested-With",r.defaultXhrHeader)
}if(A&&r.useDefaultHeader&&(!r.headers||!r.headers[g])){q(g,r.defaultPostHeader)
}if(r.defaultHeaders||r.headers){n(C)
}v(C,D);
C.conn.send(A||null)
}return C
}function t(){var B;
try{if(B=y(r.transactionId)){r.transactionId++
}}catch(A){}finally{return B
}}function y(D){var A;
try{A=new XMLHttpRequest()
}catch(C){for(var B=CQ.Ext.isIE6?1:0;
B<m.length;
++B){try{A=new ActiveXObject(m[B]);
break
}catch(C){}}}finally{return{conn:A,tId:D}
}}var r={request:function(A,C,D,E,I){if(I){var F=this,B=I.xmlData,G=I.jsonData,H;
CQ.Ext.applyIf(F,I);
if(B||G){H=F.headers;
if(!H||!H[g]){q(g,B?"text/xml":"application/json")
}E=B||(!CQ.Ext.isPrimitive(G)?CQ.Ext.encode(G):G)
}}return o(A||I.method||"POST",C,D,E)
},serializeForm:function(G){var F=G.elements||(document.forms[G]||CQ.Ext.getDom(G)).elements,A=false,E=encodeURIComponent,B,H="",D,C;
CQ.Ext.each(F,function(I){B=I.name;
D=I.type;
if(!I.disabled&&B){if(/select-(one|multiple)/i.test(D)){CQ.Ext.each(I.options,function(J){if(J.selected){C=J.hasAttribute?J.hasAttribute("value"):J.getAttributeNode("value").specified;
H+=String.format("{0}={1}&",E(B),E(C?J.value:J.text))
}})
}else{if(!(/file|undefined|reset|button/i.test(D))){if(!(/radio|checkbox/i.test(D)&&!I.checked)&&!(D=="submit"&&A)){H+=E(B)+"="+E(I.value)+"&";
A=/submit/i.test(D)
}}}}});
return H.substr(0,H.length-1)
},useDefaultHeader:true,defaultPostHeader:"application/x-www-form-urlencoded; charset=UTF-8",useDefaultXhrHeader:true,defaultXhrHeader:"XMLHttpRequest",poll:{},timeout:{},conn:{},pollInterval:50,transactionId:0,abort:function(D,F,A){var C=this,E=D.tId,B=false;
if(C.isCallInProgress(D)){D.conn.abort();
clearInterval(C.poll[E]);
C.poll[E]=null;
clearTimeout(r.timeout[E]);
C.timeout[E]=null;
k(D,F,(B=true),A)
}return B
},isCallInProgress:function(A){return A.conn&&!{0:true,4:true}[A.conn.readyState]
}};
return r
}();
(function(){var m=CQ.Ext.lib,o=/width|height|opacity|padding/i,k=/^((width|height)|(top|left))$/,g=/width|height|top$|bottom$|left$|right$/i,n=/\d+(em|%|en|ex|pt|in|cm|mm|pc)$/i,q=function(r){return typeof r!=="undefined"
},j=function(){return new Date()
};
m.Anim={motion:function(v,t,w,x,r,u){return this.run(v,t,w,x,r,u,CQ.Ext.lib.Motion)
},run:function(w,t,y,z,r,v,u){u=u||CQ.Ext.lib.AnimBase;
if(typeof z=="string"){z=CQ.Ext.lib.Easing[z]
}var x=new u(w,t,y,z);
x.animateX(function(){if(CQ.Ext.isFunction(r)){r.call(v)
}});
return x
}};
m.AnimBase=function(t,r,u,v){if(t){this.init(t,r,u,v)
}};
m.AnimBase.prototype={doMethod:function(r,v,t){var u=this;
return u.method(u.curFrame,v,t-v,u.totalFrames)
},setAttr:function(r,u,t){if(o.test(r)&&u<0){u=0
}CQ.Ext.fly(this.el,"_anim").setStyle(r,u+t)
},getAttr:function(r){var u=CQ.Ext.fly(this.el),v=u.getStyle(r),t=k.exec(r)||[];
if(v!=="auto"&&!n.test(v)){return parseFloat(v)
}return(!!(t[2])||(u.getStyle("position")=="absolute"&&!!(t[3])))?u.dom["offset"+t[0].charAt(0).toUpperCase()+t[0].substr(1)]:0
},getDefaultUnit:function(r){return g.test(r)?"px":""
},animateX:function(v,r){var t=this,u=function(){t.onComplete.removeListener(u);
if(CQ.Ext.isFunction(v)){v.call(r||t,t)
}};
t.onComplete.addListener(u,t);
t.animate()
},setRunAttr:function(x){var z=this,A=this.attributes[x],B=A.to,y=A.by,C=A.from,D=A.unit,t=(this.runAttrs[x]={}),u;
if(!q(B)&&!q(y)){return false
}var r=q(C)?C:z.getAttr(x);
if(q(B)){u=B
}else{if(q(y)){if(CQ.Ext.isArray(r)){u=[];
for(var v=0,w=r.length;
v<w;
v++){u[v]=r[v]+y[v]
}}else{u=r+y
}}}CQ.Ext.apply(t,{start:r,end:u,unit:q(D)?D:z.getDefaultUnit(x)})
},init:function(t,x,w,r){var z=this,v=0,A=m.AnimMgr;
CQ.Ext.apply(z,{isAnimated:false,startTime:null,el:CQ.Ext.getDom(t),attributes:x||{},duration:w||1,method:r||m.Easing.easeNone,useSec:true,curFrame:0,totalFrames:A.fps,runAttrs:{},animate:function(){var C=this,D=C.duration;
if(C.isAnimated){return false
}C.curFrame=0;
C.totalFrames=C.useSec?Math.ceil(A.fps*D):D;
A.registerElement(C)
},stop:function(C){var D=this;
if(C){D.curFrame=D.totalFrames;
D._onTween.fire()
}A.stop(D)
}});
var B=function(){var D=this,C;
D.onStart.fire();
D.runAttrs={};
for(C in this.attributes){this.setRunAttr(C)
}D.isAnimated=true;
D.startTime=j();
v=0
};
var y=function(){var D=this;
D.onTween.fire({duration:j()-D.startTime,curFrame:D.curFrame});
var E=D.runAttrs;
for(var C in E){this.setAttr(C,D.doMethod(C,E[C].start,E[C].end),E[C].unit)
}++v
};
var u=function(){var C=this,E=(j()-C.startTime)/1000,D={duration:E,frames:v,fps:v/E};
C.isAnimated=false;
v=0;
C.onComplete.fire(D)
};
z.onStart=new CQ.Ext.util.Event(z);
z.onTween=new CQ.Ext.util.Event(z);
z.onComplete=new CQ.Ext.util.Event(z);
(z._onStart=new CQ.Ext.util.Event(z)).addListener(B);
(z._onTween=new CQ.Ext.util.Event(z)).addListener(y);
(z._onComplete=new CQ.Ext.util.Event(z)).addListener(u)
}};
CQ.Ext.lib.AnimMgr=new function(){var w=this,u=null,t=[],r=0;
CQ.Ext.apply(w,{fps:1000,delay:1,registerElement:function(y){t.push(y);
++r;
y._onStart.fire();
w.start()
},unRegister:function(z,y){z._onComplete.fire();
y=y||x(z);
if(y!=-1){t.splice(y,1)
}if(--r<=0){w.stop()
}},start:function(){if(u===null){u=setInterval(w.run,w.delay)
}},stop:function(A){if(!A){clearInterval(u);
for(var z=0,y=t.length;
z<y;
++z){if(t[0].isAnimated){w.unRegister(t[0],0)
}}t=[];
u=null;
r=0
}else{w.unRegister(A)
}},run:function(){var B,A,y,z;
for(A=0,y=t.length;
A<y;
A++){z=t[A];
if(z&&z.isAnimated){B=z.totalFrames;
if(z.curFrame<B||B===null){++z.curFrame;
if(z.useSec){v(z)
}z._onTween.fire()
}else{w.stop(z)
}}}}});
var x=function(A){var z,y;
for(z=0,y=t.length;
z<y;
z++){if(t[z]===A){return z
}}return -1
};
var v=function(z){var D=z.totalFrames,C=z.curFrame,B=z.duration,A=(C*B*1000/D),y=(j()-z.startTime),E=0;
if(y<B*1000){E=Math.round((y/A-1)*C)
}else{E=D-(C+1)
}if(E>0&&isFinite(E)){if(z.curFrame+E>=D){E=D-(C+1)
}z.curFrame+=E
}}
};
m.Bezier=new function(){this.getPosition=function(x,w){var z=x.length,v=[],y=1-w,u,r;
for(u=0;
u<z;
++u){v[u]=[x[u][0],x[u][1]]
}for(r=1;
r<z;
++r){for(u=0;
u<z-r;
++u){v[u][0]=y*v[u][0]+w*v[parseInt(u+1,10)][0];
v[u][1]=y*v[u][1]+w*v[parseInt(u+1,10)][1]
}}return[v[0][0],v[0][1]]
}
};
m.Easing={easeNone:function(u,r,w,v){return w*u/v+r
},easeIn:function(u,r,w,v){return w*(u/=v)*u+r
},easeOut:function(u,r,w,v){return -w*(u/=v)*(u-2)+r
}};
(function(){m.Motion=function(w,v,x,y){if(w){m.Motion.superclass.constructor.call(this,w,v,x,y)
}};
CQ.Ext.extend(m.Motion,CQ.Ext.lib.AnimBase);
var u=m.Motion.superclass,t=/^points$/i;
CQ.Ext.apply(m.Motion.prototype,{setAttr:function(v,z,y){var x=this,w=u.setAttr;
if(t.test(v)){y=y||"px";
w.call(x,"left",z[0],y);
w.call(x,"top",z[1],y)
}else{w.call(x,v,z,y)
}},getAttr:function(v){var x=this,w=u.getAttr;
return t.test(v)?[w.call(x,"left"),w.call(x,"top")]:w.call(x,v)
},doMethod:function(v,y,w){var x=this;
return t.test(v)?m.Bezier.getPosition(x.runAttrs[v],x.method(x.curFrame,0,100,x.totalFrames)/100):u.doMethod.call(x,v,y,w)
},setRunAttr:function(C){if(t.test(C)){var E=this,x=this.el,H=this.attributes.points,A=H.control||[],F=H.from,G=H.to,D=H.by,I=m.Dom,w,z,y,B,v;
if(A.length>0&&!CQ.Ext.isArray(A[0])){A=[A]
}else{}CQ.Ext.fly(x,"_anim").position();
I.setXY(x,q(F)?F:I.getXY(x));
w=E.getAttr("points");
if(q(G)){y=r.call(E,G,w);
for(z=0,B=A.length;
z<B;
++z){A[z]=r.call(E,A[z],w)
}}else{if(q(D)){y=[w[0]+D[0],w[1]+D[1]];
for(z=0,B=A.length;
z<B;
++z){A[z]=[w[0]+A[z][0],w[1]+A[z][1]]
}}}v=this.runAttrs[C]=[w];
if(A.length>0){v=v.concat(A)
}v[v.length]=y
}else{u.setRunAttr.call(this,C)
}}});
var r=function(v,x){var w=m.Dom.getXY(this.el);
return[v[0]-w[0]+x[0],v[1]-w[1]+x[1]]
}
})()
})();
(function(){var g=Math.abs,o=Math.PI,n=Math.asin,m=Math.pow,j=Math.sin,k=CQ.Ext.lib;
CQ.Ext.apply(k.Easing,{easeBoth:function(r,q,v,u){return((r/=u/2)<1)?v/2*r*r+q:-v/2*((--r)*(r-2)-1)+q
},easeInStrong:function(r,q,v,u){return v*(r/=u)*r*r*r+q
},easeOutStrong:function(r,q,v,u){return -v*((r=r/u-1)*r*r*r-1)+q
},easeBothStrong:function(r,q,v,u){return((r/=u/2)<1)?v/2*r*r*r*r+q:-v/2*((r-=2)*r*r*r-2)+q
},elasticIn:function(u,q,y,x,r,w){if(u==0||(u/=x)==1){return u==0?q:q+y
}w=w||(x*0.3);
var v;
if(r>=g(y)){v=w/(2*o)*n(y/r)
}else{r=y;
v=w/4
}return -(r*m(2,10*(u-=1))*j((u*x-v)*(2*o)/w))+q
},elasticOut:function(u,q,y,x,r,w){if(u==0||(u/=x)==1){return u==0?q:q+y
}w=w||(x*0.3);
var v;
if(r>=g(y)){v=w/(2*o)*n(y/r)
}else{r=y;
v=w/4
}return r*m(2,-10*u)*j((u*x-v)*(2*o)/w)+y+q
},elasticBoth:function(u,q,y,x,r,w){if(u==0||(u/=x/2)==2){return u==0?q:q+y
}w=w||(x*(0.3*1.5));
var v;
if(r>=g(y)){v=w/(2*o)*n(y/r)
}else{r=y;
v=w/4
}return u<1?-0.5*(r*m(2,10*(u-=1))*j((u*x-v)*(2*o)/w))+q:r*m(2,-10*(u-=1))*j((u*x-v)*(2*o)/w)*0.5+y+q
},backIn:function(r,q,w,v,u){u=u||1.70158;
return w*(r/=v)*r*((u+1)*r-u)+q
},backOut:function(r,q,w,v,u){if(!u){u=1.70158
}return w*((r=r/v-1)*r*((u+1)*r+u)+1)+q
},backBoth:function(r,q,w,v,u){u=u||1.70158;
return((r/=v/2)<1)?w/2*(r*r*(((u*=(1.525))+1)*r-u))+q:w/2*((r-=2)*r*(((u*=(1.525))+1)*r+u)+2)+q
},bounceIn:function(r,q,v,u){return v-k.Easing.bounceOut(u-r,0,v,u)+q
},bounceOut:function(r,q,v,u){if((r/=u)<(1/2.75)){return v*(7.5625*r*r)+q
}else{if(r<(2/2.75)){return v*(7.5625*(r-=(1.5/2.75))*r+0.75)+q
}else{if(r<(2.5/2.75)){return v*(7.5625*(r-=(2.25/2.75))*r+0.9375)+q
}}}return v*(7.5625*(r-=(2.625/2.75))*r+0.984375)+q
},bounceBoth:function(r,q,v,u){return(r<u/2)?k.Easing.bounceIn(r*2,0,v,u)*0.5+q:k.Easing.bounceOut(r*2-u,0,v,u)*0.5+v*0.5+q
}})
})();
(function(){var n=CQ.Ext.lib;
n.Anim.color=function(x,v,y,z,u,w){return n.Anim.run(x,v,y,z,u,w,n.ColorAnim)
};
n.ColorAnim=function(v,u,w,x){n.ColorAnim.superclass.constructor.call(this,v,u,w,x)
};
CQ.Ext.extend(n.ColorAnim,n.AnimBase);
var q=n.ColorAnim.superclass,o=/color$/i,k=/^transparent|rgba\(0, 0, 0, 0\)$/,t=/^rgb\(([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\)$/i,g=/^#?([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})$/i,j=/^#?([0-9A-F]{1})([0-9A-F]{1})([0-9A-F]{1})$/i,m=function(u){return typeof u!=="undefined"
};
function r(v){var x=parseInt,w,u=null,y;
if(v.length==3){return v
}CQ.Ext.each([g,t,j],function(A,z){w=(z%2==0)?16:10;
y=A.exec(v);
if(y&&y.length==4){u=[x(y[1],w),x(y[2],w),x(y[3],w)];
return false
}});
return u
}CQ.Ext.apply(n.ColorAnim.prototype,{getAttr:function(u){var w=this,v=w.el,x;
if(o.test(u)){while(v&&k.test(x=CQ.Ext.fly(v).getStyle(u))){v=v.parentNode;
x="fff"
}}else{x=q.getAttr.call(w,u)
}return x
},doMethod:function(B,u,x){var C=this,w,z=Math.floor,y,A,D;
if(o.test(B)){w=[];
x=x||[];
for(y=0,A=u.length;
y<A;
y++){D=u[y];
w[y]=q.doMethod.call(C,B,D,x[y])
}w="rgb("+z(w[0])+","+z(w[1])+","+z(w[2])+")"
}else{w=q.doMethod.call(C,B,u,x)
}return w
},setRunAttr:function(z){var B=this,C=B.attributes[z],D=C.to,A=C.by,v;
q.setRunAttr.call(B,z);
v=B.runAttrs[z];
if(o.test(z)){var u=r(v.start),w=r(v.end);
if(!m(D)&&m(A)){w=r(A);
for(var x=0,y=u.length;
x<y;
x++){w[x]=u[x]+w[x]
}}v.start=u;
v.end=w
}}})
})();
(function(){var g=CQ.Ext.lib;
g.Anim.scroll=function(q,n,r,t,m,o){return g.Anim.run(q,n,r,t,m,o,g.Scroll)
};
g.Scroll=function(n,m,o,q){if(n){g.Scroll.superclass.constructor.call(this,n,m,o,q)
}};
CQ.Ext.extend(g.Scroll,g.ColorAnim);
var k=g.Scroll.superclass,j="scroll";
CQ.Ext.apply(g.Scroll.prototype,{doMethod:function(m,u,n){var r,q=this,t=q.curFrame,o=q.totalFrames;
if(m==j){r=[q.method(t,u[0],n[0]-u[0],o),q.method(t,u[1],n[1]-u[1],o)]
}else{r=k.doMethod.call(q,m,u,n)
}return r
},getAttr:function(m){var n=this;
if(m==j){return[n.el.scrollLeft,n.el.scrollTop]
}else{return k.getAttr.call(n,m)
}},setAttr:function(m,q,o){var n=this;
if(m==j){n.el.scrollLeft=q[0];
n.el.scrollTop=q[1]
}else{k.setAttr.call(n,m,q,o)
}}})
})();
if(CQ.Ext.isIE){function a(){var g=Function.prototype;
delete g.createSequence;
delete g.defer;
delete g.createDelegate;
delete g.createCallback;
delete g.createInterceptor;
window.detachEvent("onunload",a)
}window.attachEvent("onunload",a)
}})();
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
(function(){var m=CQ.Ext.util,o=CQ.Ext.each,k=true,n=false;
m.Observable=function(){var q=this,r=q.events;
if(q.listeners){q.on(q.listeners);
delete q.listeners
}q.events=r||{}
};
m.Observable.prototype={filterOptRe:/^(?:scope|delay|buffer|single)$/,fireEvent:function(){var r=Array.prototype.slice.call(arguments,0),u=r[0].toLowerCase(),v=this,t=k,x=v.events[u],z,w,y;
if(v.eventsSuspended===k){if(w=v.eventQueue){w.push(r)
}}else{if(typeof x=="object"){if(x.bubble){if(x.fire.apply(x,r.slice(1))===n){return n
}y=v.getBubbleTarget&&v.getBubbleTarget();
if(y&&y.enableBubble){z=y.events[u];
if(!z||typeof z!="object"||!z.bubble){y.enableBubble(u)
}return y.fireEvent.apply(y,r)
}}else{r.shift();
t=x.fire.apply(x,r)
}}}return t
},addListener:function(q,t,r,x){var u=this,w,y,v;
if(typeof q=="object"){x=q;
for(w in x){y=x[w];
if(!u.filterOptRe.test(w)){u.addListener(w,y.fn||y,y.scope||x.scope,y.fn?y:x)
}}}else{q=q.toLowerCase();
v=u.events[q]||k;
if(typeof v=="boolean"){u.events[q]=v=new m.Event(u,q)
}v.addListener(t,r,typeof x=="object"?x:{})
}},removeListener:function(q,t,r){var u=this.events[q.toLowerCase()];
if(typeof u=="object"){u.removeListener(t,r)
}},purgeListeners:function(){var t=this.events,q,r;
for(r in t){q=t[r];
if(typeof q=="object"){q.clearListeners()
}}},addEvents:function(u){var t=this;
t.events=t.events||{};
if(typeof u=="string"){var q=arguments,r=q.length;
while(r--){t.events[q[r]]=t.events[q[r]]||k
}}else{CQ.Ext.applyIf(t.events,u)
}},hasListener:function(q){var r=this.events[q.toLowerCase()];
return typeof r=="object"&&r.listeners.length>0
},suspendEvents:function(q){this.eventsSuspended=k;
if(q&&!this.eventQueue){this.eventQueue=[]
}},resumeEvents:function(){var q=this,r=q.eventQueue||[];
q.eventsSuspended=n;
delete q.eventQueue;
o(r,function(t){q.fireEvent.apply(q,t)
})
}};
var g=m.Observable.prototype;
g.on=g.addListener;
g.un=g.removeListener;
m.Observable.releaseCapture=function(q){q.fireEvent=g.fireEvent
};
function j(r,t,q){return function(){if(t.target==arguments[0]){r.apply(q,Array.prototype.slice.call(arguments,0))
}}
}function b(t,u,q,r){q.task=new m.DelayedTask();
return function(){q.task.delay(u.buffer,t,r,Array.prototype.slice.call(arguments,0))
}
}function c(t,u,r,q){return function(){u.removeListener(r,q);
return t.apply(q,arguments)
}
}function a(t,u,q,r){return function(){var v=new m.DelayedTask(),w=Array.prototype.slice.call(arguments,0);
if(!q.tasks){q.tasks=[]
}q.tasks.push(v);
v.delay(u.delay||10,function(){q.tasks.remove(v);
t.apply(r,w)
},r)
}
}m.Event=function(r,q){this.name=q;
this.obj=r;
this.listeners=[]
};
m.Event.prototype={addListener:function(u,t,r){var v=this,q;
t=t||v.obj;
if(!v.isListening(u,t)){q=v.createListener(u,t,r);
if(v.firing){v.listeners=v.listeners.slice(0)
}v.listeners.push(q)
}},createListener:function(u,t,v){v=v||{};
t=t||this.obj;
var q={fn:u,scope:t,options:v},r=u;
if(v.target){r=j(r,v,t)
}if(v.delay){r=a(r,v,q,t)
}if(v.single){r=c(r,this,u,t)
}if(v.buffer){r=b(r,v,q,t)
}q.fireFn=r;
return q
},findListener:function(u,t){var v=this.listeners,r=v.length,q;
t=t||this.obj;
while(r--){q=v[r];
if(q){if(q.fn==u&&q.scope==t){return r
}}}return -1
},isListening:function(r,q){return this.findListener(r,q)!=-1
},removeListener:function(w,v){var u,q,r,x=this,t=n;
if((u=x.findListener(w,v))!=-1){if(x.firing){x.listeners=x.listeners.slice(0)
}q=x.listeners[u];
if(q.task){q.task.cancel();
delete q.task
}r=q.tasks&&q.tasks.length;
if(r){while(r--){q.tasks[r].cancel()
}delete q.tasks
}x.listeners.splice(u,1);
t=k
}return t
},clearListeners:function(){var t=this,q=t.listeners,r=q.length;
while(r--){t.removeListener(q[r].fn,q[r].scope)
}},fire:function(){var w=this,v=w.listeners,q=v.length,u=0,r;
if(q>0){w.firing=k;
var t=Array.prototype.slice.call(arguments,0);
for(;
u<q;
u++){r=v[u];
if(r&&r.fireFn.apply(r.scope||w.obj||window,t)===n){return(w.firing=n)
}}}w.firing=n;
return k
}}
})();
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.DomHelper=function(){var E=null,q=/^(?:br|frame|hr|img|input|link|meta|range|spacer|wbr|area|param|col)$/i,t=/^table|tbody|tr|td$/i,g=/tag|children|cn|html$/i,A=/td|tr|tbody/i,v=/([a-z0-9-]+)\s*:\s*([^;\s]+(?:\s*[^;\s]+)*);?/gi,C=/end/i,y,u="afterbegin",w="afterend",c="beforebegin",x="beforeend",a="<table>",n="</table>",b=a+"<tbody>",o="</tbody>"+n,r=b+"<tr>",D="</tr>"+o;
function m(I,K,J,L,H,F){var G=y.insertHtml(L,CQ.Ext.getDom(I),B(K));
return J?CQ.Ext.get(G,true):G
}function B(K){var G="",F,J,I,L;
if(typeof K=="string"){G=K
}else{if(CQ.Ext.isArray(K)){for(var H=0;
H<K.length;
H++){if(K[H]){G+=B(K[H])
}}}else{G+="<"+(K.tag=K.tag||"div");
for(F in K){J=K[F];
if(!g.test(F)){if(typeof J=="object"){G+=" "+F+'="';
for(I in J){G+=I+":"+J[I]+";"
}G+='"'
}else{G+=" "+({cls:"class",htmlFor:"for"}[F]||F)+'="'+J+'"'
}}}if(q.test(K.tag)){G+="/>"
}else{G+=">";
if((L=K.children||K.cn)){G+=B(L)
}else{if(K.html){G+=K.html
}}G+="</"+K.tag+">"
}}}return G
}function k(M,J,I,K){E.innerHTML=[J,I,K].join("");
var F=-1,H=E,G;
while(++F<M){H=H.firstChild
}if(G=H.nextSibling){var L=document.createDocumentFragment();
while(H){G=H.nextSibling;
L.appendChild(H);
H=G
}H=L
}return H
}function j(F,G,I,H){var J,K;
E=E||document.createElement("div");
if(F=="td"&&(G==u||G==x)||!A.test(F)&&(G==c||G==w)){return
}K=G==c?I:G==w?I.nextSibling:G==u?I.firstChild:null;
if(G==c||G==w){I=I.parentNode
}if(F=="td"||(F=="tr"&&(G==x||G==u))){J=k(4,r,H,D)
}else{if((F=="tbody"&&(G==x||G==u))||(F=="tr"&&(G==c||G==w))){J=k(3,b,H,o)
}else{J=k(2,a,H,n)
}}I.insertBefore(J,K);
return J
}function z(H){var K=document.createElement("div"),F=document.createDocumentFragment(),G=0,I,J;
K.innerHTML=H;
J=K.childNodes;
I=J.length;
for(;
G<I;
G++){F.appendChild(J[G].cloneNode(true))
}return F
}y={markup:function(F){return B(F)
},applyStyles:function(F,G){if(G){var H;
F=CQ.Ext.fly(F);
if(typeof G=="function"){G=G.call()
}if(typeof G=="string"){v.lastIndex=0;
while((H=v.exec(G))){F.setStyle(H[1],H[2])
}}else{if(typeof G=="object"){F.setStyle(G)
}}}},insertHtml:function(K,F,L){var I={},H,M,J,N,O,G;
K=K.toLowerCase();
I[c]=["BeforeBegin","previousSibling"];
I[w]=["AfterEnd","nextSibling"];
if(F.insertAdjacentHTML){if(t.test(F.tagName)&&(G=j(F.tagName.toLowerCase(),K,F,L))){return G
}I[u]=["AfterBegin","firstChild"];
I[x]=["BeforeEnd","lastChild"];
if((H=I[K])){F.insertAdjacentHTML(H[0],L);
return F[H[1]]
}}else{M=F.ownerDocument.createRange();
N="setStart"+(C.test(K)?"After":"Before");
if(I[K]){M[N](F);
if(!M.createContextualFragment){O=z(L)
}else{O=M.createContextualFragment(L)
}F.parentNode.insertBefore(O,K==c?F:F.nextSibling);
return F[(K==c?"previous":"next")+"Sibling"]
}else{J=(K==u?"first":"last")+"Child";
if(F.firstChild){M[N](F[J]);
if(!M.createContextualFragment){O=z(L)
}else{O=M.createContextualFragment(L)
}if(K==u){F.insertBefore(O,F.firstChild)
}else{F.appendChild(O)
}}else{F.innerHTML=L
}return F[J]
}}throw'Illegal insertion point -> "'+K+'"'
},insertBefore:function(F,H,G){return m(F,H,G,c)
},insertAfter:function(F,H,G){return m(F,H,G,w,"nextSibling")
},insertFirst:function(F,H,G){return m(F,H,G,u,"firstChild")
},append:function(F,H,G){if(CQ.Util.isRoot(F)){F=CQ.Util.getRoot()
}return m(F,H,G,x,"",true)
},overwrite:function(F,H,G){F=CQ.Ext.getDom(F);
F.innerHTML=B(H);
return G?CQ.Ext.get(F.firstChild):F.firstChild
},createHtml:B};
return y
}();
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.Template=function(m){var n=this,c=arguments,j=[],g;
if(CQ.Ext.isArray(m)){m=m.join("")
}else{if(c.length>1){for(var k=0,b=c.length;
k<b;
k++){g=c[k];
if(typeof g=="object"){CQ.Ext.apply(n,g)
}else{j.push(g)
}}m=j.join("")
}}n.html=m;
if(n.compiled){n.compile()
}};
CQ.Ext.Template.prototype={re:/\{([\w\-]+)\}/g,applyTemplate:function(a){var b=this;
return b.compiled?b.compiled(a):b.html.replace(b.re,function(c,g){return a[g]!==undefined?a[g]:""
})
},set:function(a,c){var b=this;
b.html=a;
b.compiled=null;
return c?b.compile():b
},compile:function(){var me=this,sep=CQ.Ext.isGecko?"+":",";
function fn(m,name){name="values['"+name+"']";
return"'"+sep+"("+name+" == undefined ? '' : "+name+")"+sep+"'"
}eval("this.compiled = function(values){ return "+(CQ.Ext.isGecko?"'":"['")+me.html.replace(/\\/g,"\\\\").replace(/(\r\n|\n)/g,"\\n").replace(/'/g,"\\'").replace(this.re,fn)+(CQ.Ext.isGecko?"';};":"'].join('');};"));
return me
},insertFirst:function(b,a,c){return this.doInsert("afterBegin",b,a,c)
},insertBefore:function(b,a,c){return this.doInsert("beforeBegin",b,a,c)
},insertAfter:function(b,a,c){return this.doInsert("afterEnd",b,a,c)
},append:function(b,a,c){return this.doInsert("beforeEnd",b,a,c)
},doInsert:function(c,j,b,a){j=CQ.Ext.getDom(j);
var g=CQ.Ext.DomHelper.insertHtml(c,j,this.applyTemplate(b));
return a?CQ.Ext.get(g,true):g
},overwrite:function(b,a,c){b=CQ.Ext.getDom(b);
b.innerHTML=this.applyTemplate(a);
return c?CQ.Ext.get(b.firstChild,true):b.firstChild
}};
CQ.Ext.Template.prototype.apply=CQ.Ext.Template.prototype.applyTemplate;
CQ.Ext.Template.from=function(b,a){b=CQ.Ext.getDom(b);
return new CQ.Ext.Template(b.value||b.innerHTML,a||"")
};
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.DomQuery=function(){var cache={},simpleCache={},valueCache={},nonSpace=/\S/,trimRe=/^\s+|\s+$/g,tplRe=/\{(\d+)\}/g,modeRe=/^(\s?[\/>+~]\s?|\s|$)/,tagTokenRe=/^(#)?([\w\-\*]+)/,nthRe=/(\d*)n\+?(\d*)/,nthRe2=/\D/,isIE=window.ActiveXObject?true:false,key=30803;
eval("var batch = 30803;");
function child(parent,index){var i=0,n=parent.firstChild;
while(n){if(n.nodeType==1){if(++i==index){return n
}}n=n.nextSibling
}return null
}function next(n){while((n=n.nextSibling)&&n.nodeType!=1){}return n
}function prev(n){while((n=n.previousSibling)&&n.nodeType!=1){}return n
}function children(parent){var n=parent.firstChild,nodeIndex=-1,nextNode;
while(n){nextNode=n.nextSibling;
if(n.nodeType==3&&!nonSpace.test(n.nodeValue)){parent.removeChild(n)
}else{n.nodeIndex=++nodeIndex
}n=nextNode
}return this
}function byClassName(nodeSet,cls){if(!cls){return nodeSet
}var result=[],ri=-1;
for(var i=0,ci;
ci=nodeSet[i];
i++){if((" "+ci.className+" ").indexOf(cls)!=-1){result[++ri]=ci
}}return result
}function attrValue(n,attr){if(!n.tagName&&typeof n.length!="undefined"){n=n[0]
}if(!n){return null
}if(attr=="for"){return n.htmlFor
}if(attr=="class"||attr=="className"){return n.className
}return n.getAttribute(attr)||n[attr]
}function getNodes(ns,mode,tagName){var result=[],ri=-1,cs;
if(!ns){return result
}tagName=tagName||"*";
if(typeof ns.getElementsByTagName!="undefined"){ns=[ns]
}if(!mode){for(var i=0,ni;
ni=ns[i];
i++){cs=ni.getElementsByTagName(tagName);
for(var j=0,ci;
ci=cs[j];
j++){result[++ri]=ci
}}}else{if(mode=="/"||mode==">"){var utag=tagName.toUpperCase();
for(var i=0,ni,cn;
ni=ns[i];
i++){cn=ni.childNodes;
for(var j=0,cj;
cj=cn[j];
j++){if(cj.nodeName==utag||cj.nodeName==tagName||tagName=="*"){result[++ri]=cj
}}}}else{if(mode=="+"){var utag=tagName.toUpperCase();
for(var i=0,n;
n=ns[i];
i++){while((n=n.nextSibling)&&n.nodeType!=1){}if(n&&(n.nodeName==utag||n.nodeName==tagName||tagName=="*")){result[++ri]=n
}}}else{if(mode=="~"){var utag=tagName.toUpperCase();
for(var i=0,n;
n=ns[i];
i++){while((n=n.nextSibling)){if(n.nodeName==utag||n.nodeName==tagName||tagName=="*"){result[++ri]=n
}}}}}}}return result
}function concat(a,b){if(b.slice){return a.concat(b)
}for(var i=0,l=b.length;
i<l;
i++){a[a.length]=b[i]
}return a
}function byTag(cs,tagName){if(cs.tagName||cs==document){cs=[cs]
}if(!tagName){return cs
}var result=[],ri=-1;
tagName=tagName.toLowerCase();
for(var i=0,ci;
ci=cs[i];
i++){if(ci.nodeType==1&&ci.tagName.toLowerCase()==tagName){result[++ri]=ci
}}return result
}function byId(cs,id){if(cs.tagName||cs==document){cs=[cs]
}if(!id){return cs
}var result=[],ri=-1;
for(var i=0,ci;
ci=cs[i];
i++){if(ci&&ci.id==id){result[++ri]=ci;
return result
}}return result
}function byAttribute(cs,attr,value,op,custom){var result=[],ri=-1,useGetStyle=custom=="{",fn=CQ.Ext.DomQuery.operators[op],a,xml,hasXml;
for(var i=0,ci;
ci=cs[i];
i++){if(ci.nodeType!=1){continue
}if(!hasXml){xml=CQ.Ext.DomQuery.isXml(ci);
hasXml=true
}if(!xml){if(useGetStyle){a=CQ.Ext.DomQuery.getStyle(ci,attr)
}else{if(attr=="class"||attr=="className"){a=ci.className
}else{if(attr=="for"){a=ci.htmlFor
}else{if(attr=="href"){a=ci.getAttribute("href",2)
}else{a=ci.getAttribute(attr)
}}}}}else{a=ci.getAttribute(attr)
}if((fn&&fn(a,value))||(!fn&&a)){result[++ri]=ci
}}return result
}function byPseudo(cs,name,value){return CQ.Ext.DomQuery.pseudos[name](cs,value)
}function nodupIEXml(cs){var d=++key,r;
cs[0].setAttribute("_nodup",d);
r=[cs[0]];
for(var i=1,len=cs.length;
i<len;
i++){var c=cs[i];
if(!c.getAttribute("_nodup")!=d){c.setAttribute("_nodup",d);
r[r.length]=c
}}for(var i=0,len=cs.length;
i<len;
i++){cs[i].removeAttribute("_nodup")
}return r
}function nodup(cs){if(!cs){return[]
}var len=cs.length,c,i,r=cs,cj,ri=-1;
if(!len||typeof cs.nodeType!="undefined"||len==1){return cs
}if(isIE&&typeof cs[0].selectSingleNode!="undefined"){return nodupIEXml(cs)
}var d=++key;
cs[0]._nodup=d;
for(i=1;
c=cs[i];
i++){if(c._nodup!=d){c._nodup=d
}else{r=[];
for(var j=0;
j<i;
j++){r[++ri]=cs[j]
}for(j=i+1;
cj=cs[j];
j++){if(cj._nodup!=d){cj._nodup=d;
r[++ri]=cj
}}return r
}}return r
}function quickDiffIEXml(c1,c2){var d=++key,r=[];
for(var i=0,len=c1.length;
i<len;
i++){c1[i].setAttribute("_qdiff",d)
}for(var i=0,len=c2.length;
i<len;
i++){if(c2[i].getAttribute("_qdiff")!=d){r[r.length]=c2[i]
}}for(var i=0,len=c1.length;
i<len;
i++){c1[i].removeAttribute("_qdiff")
}return r
}function quickDiff(c1,c2){var len1=c1.length,d=++key,r=[];
if(!len1){return c2
}if(isIE&&typeof c1[0].selectSingleNode!="undefined"){return quickDiffIEXml(c1,c2)
}for(var i=0;
i<len1;
i++){c1[i]._qdiff=d
}for(var i=0,len=c2.length;
i<len;
i++){if(c2[i]._qdiff!=d){r[r.length]=c2[i]
}}return r
}function quickId(ns,mode,root,id){if(ns==root){var d=root.ownerDocument||root;
return d.getElementById(id)
}ns=getNodes(ns,mode,"*");
return byId(ns,id)
}return{getStyle:function(el,name){return CQ.Ext.fly(el).getStyle(name)
},compile:function(path,type){type=type||"select";
var fn=["var f = function(root){\n var mode; ++batch; var n = root || document;\n"],mode,lastPath,matchers=CQ.Ext.DomQuery.matchers,matchersLn=matchers.length,modeMatch,lmode=path.match(modeRe);
if(lmode&&lmode[1]){fn[fn.length]='mode="'+lmode[1].replace(trimRe,"")+'";';
path=path.replace(lmode[1],"")
}while(path.substr(0,1)=="/"){path=path.substr(1)
}while(path&&lastPath!=path){lastPath=path;
var tokenMatch=path.match(tagTokenRe);
if(type=="select"){if(tokenMatch){if(tokenMatch[1]=="#"){fn[fn.length]='n = quickId(n, mode, root, "'+tokenMatch[2]+'");'
}else{fn[fn.length]='n = getNodes(n, mode, "'+tokenMatch[2]+'");'
}path=path.replace(tokenMatch[0],"")
}else{if(path.substr(0,1)!="@"){fn[fn.length]='n = getNodes(n, mode, "*");'
}}}else{if(tokenMatch){if(tokenMatch[1]=="#"){fn[fn.length]='n = byId(n, "'+tokenMatch[2]+'");'
}else{fn[fn.length]='n = byTag(n, "'+tokenMatch[2]+'");'
}path=path.replace(tokenMatch[0],"")
}}while(!(modeMatch=path.match(modeRe))){var matched=false;
for(var j=0;
j<matchersLn;
j++){var t=matchers[j];
var m=path.match(t.re);
if(m){fn[fn.length]=t.select.replace(tplRe,function(x,i){return m[i]
});
path=path.replace(m[0],"");
matched=true;
break
}}if(!matched){throw'Error parsing selector, parsing failed at "'+path+'"'
}}if(modeMatch[1]){fn[fn.length]='mode="'+modeMatch[1].replace(trimRe,"")+'";';
path=path.replace(modeMatch[1],"")
}}fn[fn.length]="return nodup(n);\n}";
eval(fn.join(""));
return f
},jsSelect:function(path,root,type){root=root||document;
if(typeof root=="string"){root=document.getElementById(root)
}var paths=path.split(","),results=[];
for(var i=0,len=paths.length;
i<len;
i++){var subPath=paths[i].replace(trimRe,"");
if(!cache[subPath]){cache[subPath]=CQ.Ext.DomQuery.compile(subPath);
if(!cache[subPath]){throw subPath+" is not a valid selector"
}}var result=cache[subPath](root);
if(result&&result!=document){results=results.concat(result)
}}if(paths.length>1){return nodup(results)
}return results
},isXml:function(el){var docEl=(el?el.ownerDocument||el:0).documentElement;
return docEl?docEl.nodeName!=="HTML":false
},select:document.querySelectorAll?function(path,root,type){root=root||document;
if(!CQ.Ext.DomQuery.isXml(root)){try{var cs=root.querySelectorAll(path);
return CQ.Ext.toArray(cs)
}catch(ex){}}return CQ.Ext.DomQuery.jsSelect.call(this,path,root,type)
}:function(path,root,type){return CQ.Ext.DomQuery.jsSelect.call(this,path,root,type)
},selectNode:function(path,root){return CQ.Ext.DomQuery.select(path,root)[0]
},selectValue:function(path,root,defaultValue){path=path.replace(trimRe,"");
if(!valueCache[path]){valueCache[path]=CQ.Ext.DomQuery.compile(path,"select")
}var n=valueCache[path](root),v;
n=n[0]?n[0]:n;
if(typeof n.normalize=="function"){n.normalize()
}v=(n&&n.firstChild?n.firstChild.nodeValue:null);
return((v===null||v===undefined||v==="")?defaultValue:v)
},selectNumber:function(path,root,defaultValue){var v=CQ.Ext.DomQuery.selectValue(path,root,defaultValue||0);
return parseFloat(v)
},is:function(el,ss){if(typeof el=="string"){el=document.getElementById(el)
}var isArray=CQ.Ext.isArray(el),result=CQ.Ext.DomQuery.filter(isArray?el:[el],ss);
return isArray?(result.length==el.length):(result.length>0)
},filter:function(els,ss,nonMatches){ss=ss.replace(trimRe,"");
if(!simpleCache[ss]){simpleCache[ss]=CQ.Ext.DomQuery.compile(ss,"simple")
}var result=simpleCache[ss](els);
return nonMatches?quickDiff(result,els):result
},matchers:[{re:/^\.([\w\-]+)/,select:'n = byClassName(n, " {1} ");'},{re:/^\:([\w\-]+)(?:\(((?:[^\s>\/]*|.*?))\))?/,select:'n = byPseudo(n, "{1}", "{2}");'},{re:/^(?:([\[\{])(?:@)?([\w\-]+)\s?(?:(=|.=)\s?(["']?)(.*?)\4)?[\]\}])/,select:'n = byAttribute(n, "{2}", "{5}", "{3}", "{1}");'},{re:/^#([\w\-]+)/,select:'n = byId(n, "{1}");'},{re:/^@([\w\-]+)/,select:'return {firstChild:{nodeValue:attrValue(n, "{1}")}};'}],operators:{"=":function(a,v){return a==v
},"!=":function(a,v){return a!=v
},"^=":function(a,v){return a&&a.substr(0,v.length)==v
},"$=":function(a,v){return a&&a.substr(a.length-v.length)==v
},"*=":function(a,v){return a&&a.indexOf(v)!==-1
},"%=":function(a,v){return(a%v)==0
},"|=":function(a,v){return a&&(a==v||a.substr(0,v.length+1)==v+"-")
},"~=":function(a,v){return a&&(" "+a+" ").indexOf(" "+v+" ")!=-1
}},pseudos:{"first-child":function(c){var r=[],ri=-1,n;
for(var i=0,ci;
ci=n=c[i];
i++){while((n=n.previousSibling)&&n.nodeType!=1){}if(!n){r[++ri]=ci
}}return r
},"last-child":function(c){var r=[],ri=-1,n;
for(var i=0,ci;
ci=n=c[i];
i++){while((n=n.nextSibling)&&n.nodeType!=1){}if(!n){r[++ri]=ci
}}return r
},"nth-child":function(c,a){var r=[],ri=-1,m=nthRe.exec(a=="even"&&"2n"||a=="odd"&&"2n+1"||!nthRe2.test(a)&&"n+"+a||a),f=(m[1]||1)-0,l=m[2]-0;
for(var i=0,n;
n=c[i];
i++){var pn=n.parentNode;
if(batch!=pn._batch){var j=0;
for(var cn=pn.firstChild;
cn;
cn=cn.nextSibling){if(cn.nodeType==1){cn.nodeIndex=++j
}}pn._batch=batch
}if(f==1){if(l==0||n.nodeIndex==l){r[++ri]=n
}}else{if((n.nodeIndex+l)%f==0){r[++ri]=n
}}}return r
},"only-child":function(c){var r=[],ri=-1;
for(var i=0,ci;
ci=c[i];
i++){if(!prev(ci)&&!next(ci)){r[++ri]=ci
}}return r
},empty:function(c){var r=[],ri=-1;
for(var i=0,ci;
ci=c[i];
i++){var cns=ci.childNodes,j=0,cn,empty=true;
while(cn=cns[j]){++j;
if(cn.nodeType==1||cn.nodeType==3){empty=false;
break
}}if(empty){r[++ri]=ci
}}return r
},contains:function(c,v){var r=[],ri=-1;
for(var i=0,ci;
ci=c[i];
i++){if((ci.textContent||ci.innerText||"").indexOf(v)!=-1){r[++ri]=ci
}}return r
},nodeValue:function(c,v){var r=[],ri=-1;
for(var i=0,ci;
ci=c[i];
i++){if(ci.firstChild&&ci.firstChild.nodeValue==v){r[++ri]=ci
}}return r
},checked:function(c){var r=[],ri=-1;
for(var i=0,ci;
ci=c[i];
i++){if(ci.checked==true){r[++ri]=ci
}}return r
},not:function(c,ss){return CQ.Ext.DomQuery.filter(c,ss,true)
},any:function(c,selectors){var ss=selectors.split("|"),r=[],ri=-1,s;
for(var i=0,ci;
ci=c[i];
i++){for(var j=0;
s=ss[j];
j++){if(CQ.Ext.DomQuery.is(ci,s)){r[++ri]=ci;
break
}}}return r
},odd:function(c){return this["nth-child"](c,"odd")
},even:function(c){return this["nth-child"](c,"even")
},nth:function(c,a){return c[a-1]||[]
},first:function(c){return c[0]||[]
},last:function(c){return c[c.length-1]||[]
},has:function(c,ss){var s=CQ.Ext.DomQuery.select,r=[],ri=-1;
for(var i=0,ci;
ci=c[i];
i++){if(s(ss,ci).length>0){r[++ri]=ci
}}return r
},next:function(c,ss){var is=CQ.Ext.DomQuery.is,r=[],ri=-1;
for(var i=0,ci;
ci=c[i];
i++){var n=next(ci);
if(n&&is(n,ss)){r[++ri]=ci
}}return r
},prev:function(c,ss){var is=CQ.Ext.DomQuery.is,r=[],ri=-1;
for(var i=0,ci;
ci=c[i];
i++){var n=prev(ci);
if(n&&is(n,ss)){r[++ri]=ci
}}return r
}}}
}();
CQ.Ext.query=CQ.Ext.DomQuery.select;
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.util.DelayedTask=function(g,c,a){var j=this,k,b=function(){clearInterval(k);
k=null;
g.apply(c,a||[])
};
j.delay=function(n,q,o,m){j.cancel();
g=q||g;
c=o||c;
a=m||a;
k=setInterval(b,n)
};
j.cancel=function(){if(k){clearInterval(k);
k=null
}}
};
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
(function(){var m=document;
CQ.Ext.Element=function(r,t){var u=typeof r=="string"?m.getElementById(r):r,v;
if(!u){return null
}v=u.id;
if(!t&&v&&CQ.Ext.elCache[v]){return CQ.Ext.elCache[v].el
}this.dom=u;
this.id=v||CQ.Ext.id(u)
};
var g=CQ.Ext.DomHelper,j=CQ.Ext.Element,a=CQ.Ext.elCache;
j.prototype={set:function(w,t){var u=this.dom,r,v,t=(t!==false)&&!!u.setAttribute;
for(r in w){if(w.hasOwnProperty(r)){v=w[r];
if(r=="style"){g.applyStyles(u,v)
}else{if(r=="cls"){u.className=v
}else{if(t){u.setAttribute(r,v)
}else{u[r]=v
}}}}}return this
},defaultUnit:"px",is:function(r){return CQ.Ext.DomQuery.is(this.dom,r)
},focus:function(v,u){var r=this,u=u||r.dom;
try{if(Number(v)){r.focus.defer(v,null,[null,u])
}else{u.focus()
}}catch(t){}return r
},blur:function(){try{this.dom.blur()
}catch(r){}return this
},getValue:function(r){var t=this.dom.value;
return r?parseInt(t,10):t
},addListener:function(r,v,u,t){CQ.Ext.EventManager.on(this.dom,r,v,u||this,t);
return this
},removeListener:function(r,u,t){CQ.Ext.EventManager.removeListener(this.dom,r,u,t||this);
return this
},removeAllListeners:function(){CQ.Ext.EventManager.removeAll(this.dom);
return this
},purgeAllListeners:function(){CQ.Ext.EventManager.purgeElement(this,true);
return this
},addUnits:function(r){if(r===""||r=="auto"||r===undefined){r=r||""
}else{if(!isNaN(r)||!n.test(r)){r=r+(this.defaultUnit||"px")
}}return r
},load:function(t,u,r){CQ.Ext.Ajax.request(CQ.Ext.apply({params:u,url:t.url||t,callback:r,el:this.dom,indicatorText:t.indicatorText||""},CQ.Ext.isObject(t)?t:{}));
return this
},isBorderBox:function(){return CQ.Ext.isBorderBox||CQ.Ext.isForcedBorderBox||k[(this.dom.tagName||"").toLowerCase()]
},remove:function(){var r=this,t=r.dom;
if(t){delete r.dom;
CQ.Ext.removeNode(t)
}},hover:function(t,r,v,u){var w=this;
w.on("mouseenter",t,v||w.dom,u);
w.on("mouseleave",r,v||w.dom,u);
return w
},contains:function(r){return !r?false:CQ.Ext.lib.Dom.isAncestor(this.dom,r.dom?r.dom:r)
},getAttributeNS:function(t,r){return this.getAttribute(r,t)
},getAttribute:(function(){var w=document.createElement("table"),v=false,t="getAttribute" in w,r=/undefined|unknown/;
if(t){try{w.getAttribute("ext:qtip")
}catch(u){v=true
}return function(x,z){var y=this.dom,A;
if(y.getAttributeNS){A=y.getAttributeNS(z,x)||null
}if(A==null){if(z){if(v&&y.tagName.toUpperCase()=="TABLE"){try{A=y.getAttribute(z+":"+x)
}catch(B){A=""
}}else{A=y.getAttribute(z+":"+x)
}}else{A=y.getAttribute(x)||y[x]
}}return A||""
}
}else{return function(x,z){var y=this.om,B,A;
if(z){A=y[z+":"+x];
B=r.test(typeof A)?undefined:A
}else{B=y[x]
}return B||""
}
}w=null
})(),update:function(r){if(this.dom){this.dom.innerHTML=r
}return this
}};
var q=j.prototype;
j.addMethods=function(r){CQ.Ext.apply(q,r)
};
q.on=q.addListener;
q.un=q.removeListener;
q.autoBoxAdjust=true;
var n=/\d+(px|em|%|en|ex|pt|in|cm|mm|pc)$/i,c;
j.get=function(t){var r,w,v;
if(!t){return null
}if(typeof t=="string"){if(!(w=m.getElementById(t))){if(CQ.Util.isRoot(t)){return CQ.Util.createRoot()
}return null
}if(a[t]&&a[t].el){r=a[t].el;
r.dom=w
}else{r=j.addToCache(new j(w))
}return r
}else{if(t.tagName){if(!(v=t.id)){v=CQ.Ext.id(t)
}if(a[v]&&a[v].el){r=a[v].el;
r.dom=t
}else{r=j.addToCache(new j(t))
}return r
}else{if(t instanceof j){if(t!=c){if(CQ.Ext.isIE&&(t.id==undefined||t.id=="")){t.dom=t.dom
}else{t.dom=m.getElementById(t.id)||t.dom
}}return t
}else{if(t.isComposite){return t
}else{if(CQ.Ext.isArray(t)){return j.select(t)
}else{if(t==m){if(!c){var u=function(){};
u.prototype=j.prototype;
c=new u();
c.dom=m
}return c
}}}}}}return null
};
j.addToCache=function(r,t){t=t||r.id;
a[t]={el:r,data:{},events:{}};
return r
};
j.data=function(t,r,u){t=j.get(t);
if(!t){return null
}var v=a[t.id].data;
if(arguments.length==2){return v[r]
}else{return(v[r]=u)
}};
function o(){if(!CQ.Ext.enableGarbageCollector){clearInterval(j.collectorThreadId)
}else{var r,v,y,x;
for(r in a){x=a[r];
if(x.skipGC){continue
}v=x.el;
y=v.dom;
try{if(!y||!y.parentNode||(!y.offsetParent&&!m.getElementById(r))){if(CQ.Ext.enableListenerCollection){CQ.Ext.EventManager.removeAll(y)
}delete a[r]
}}catch(w){delete a[r]
}}if(CQ.Ext.isIE){var u={};
for(r in a){u[r]=a[r]
}a=CQ.Ext.elCache=u
}}}j.collectorThreadId=setInterval(o,30000);
var b=function(){};
b.prototype=j.prototype;
j.Flyweight=function(r){this.dom=r
};
j.Flyweight.prototype=new b();
j.Flyweight.prototype.isFlyweight=true;
j._flyweights={};
j.fly=function(u,r){var t=null;
r=r||"_global";
if(u=CQ.Ext.getDom(u)){(j._flyweights[r]=j._flyweights[r]||new j.Flyweight()).dom=u;
t=j._flyweights[r]
}return t
};
CQ.Ext.get=j.get;
CQ.Ext.fly=j.fly;
var k=CQ.Ext.isStrict?{select:1}:{input:1,select:1,textarea:1};
if(CQ.Ext.isIE||CQ.Ext.isGecko){k.button=1
}})();
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.Element.addMethods(function(){var g="parentNode",b="nextSibling",c="previousSibling",j=CQ.Ext.DomQuery,a=CQ.Ext.get;
return{findParent:function(t,r,m){var o=this.dom,k=document.body,q=0,n;
if(CQ.Ext.isGecko&&Object.prototype.toString.call(o)=="[object XULElement]"){return null
}r=r||50;
if(isNaN(r)){n=CQ.Ext.getDom(r);
r=Number.MAX_VALUE
}while(o&&o.nodeType==1&&q<r&&o!=k&&o!=n){if(j.is(o,t)){return m?a(o):o
}q++;
o=o.parentNode
}return null
},findParentNode:function(o,n,k){var m=CQ.Ext.fly(this.dom.parentNode,"_internal");
return m?m.findParent(o,n,k):null
},up:function(m,k){return this.findParentNode(m,k,true)
},select:function(k){return CQ.Ext.Element.select(k,this.dom)
},query:function(k){return j.select(k,this.dom)
},child:function(k,m){var o=j.selectNode(k,this.dom);
return m?o:a(o)
},down:function(k,m){var o=j.selectNode(" > "+k,this.dom);
return m?o:a(o)
},parent:function(k,m){return this.matchNode(g,g,k,m)
},next:function(k,m){return this.matchNode(b,b,k,m)
},prev:function(k,m){return this.matchNode(c,c,k,m)
},first:function(k,m){return this.matchNode(b,"firstChild",k,m)
},last:function(k,m){return this.matchNode(c,"lastChild",k,m)
},matchNode:function(m,r,k,o){var q=this.dom[r];
while(q){if(q.nodeType==1&&(!k||j.is(q,k))){return !o?a(q):q
}q=q[m]
}return null
}}
}());
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.Element.addMethods(function(){var c=CQ.Ext.getDom,a=CQ.Ext.get,b=CQ.Ext.DomHelper;
return{appendChild:function(g){return a(g).appendTo(this)
},appendTo:function(g){if(CQ.Util.isRoot(g)){g=CQ.Util.getRoot()
}c(g).appendChild(this.dom);
return this
},insertBefore:function(g){(g=c(g)).parentNode.insertBefore(this.dom,g);
return this
},insertAfter:function(g){(g=c(g)).parentNode.insertBefore(this.dom,g.nextSibling);
return this
},insertFirst:function(j,g){j=j||{};
if(j.nodeType||j.dom||typeof j=="string"){j=c(j);
this.dom.insertBefore(j,this.dom.firstChild);
return !g?a(j):j
}else{return this.createChild(j,this.dom.firstChild,g)
}},replace:function(g){g=a(g);
this.insertBefore(g);
g.remove();
return this
},replaceWith:function(g){var j=this;
if(g.nodeType||g.dom||typeof g=="string"){g=c(g);
j.dom.parentNode.insertBefore(g,j.dom)
}else{g=b.insertBefore(j.dom,g)
}delete CQ.Ext.elCache[j.id];
CQ.Ext.removeNode(j.dom);
j.id=CQ.Ext.id(j.dom=g);
CQ.Ext.Element.addToCache(j.isFlyweight?new CQ.Ext.Element(j.dom):j);
return j
},createChild:function(j,g,k){j=j||{tag:"div"};
return g?b.insertBefore(g,j,k!==true):b[!this.dom.firstChild?"overwrite":"append"](this.dom,j,k!==true)
},wrap:function(g,j){var k=b.insertBefore(this.dom,g||{tag:"div"},!j);
k.dom?k.dom.appendChild(this.dom):k.appendChild(this.dom);
return k
},insertHtml:function(j,k,g){var m=b.insertHtml(j,this.dom,k);
return g?CQ.Ext.get(m):m
}}
}());
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.Element.addMethods(function(){var H=CQ.Ext.supports,m={},E=/(-[a-z])/gi,z=document.defaultView,K=/alpha\(opacity=(.*)\)/i,r=/^\s+|\s+$/g,I=CQ.Ext.Element,B=/\s+/,b=/\w/g,g="padding",c="margin",F="border",A="-left",x="-right",D="-top",v="-bottom",o="-width",y=Math,G="hidden",j="isClipped",q="overflow",u="overflow-x",t="overflow-y",J="originalClip",n={l:F+A+o,r:F+x+o,t:F+D+o,b:F+v+o},k={l:g+A,r:g+x,t:g+D,b:g+v},a={l:c+A,r:c+x,t:c+D,b:c+v},L=CQ.Ext.Element.data;
function w(M,N){return N.charAt(1).toUpperCase()
}function C(M){return m[M]||(m[M]=M=="float"?(H.cssFloat?"cssFloat":"styleFloat"):M.replace(E,w))
}return{adjustWidth:function(M){var N=this;
var O=(typeof M=="number");
if(O&&N.autoBoxAdjust&&!N.isBorderBox()){M-=(N.getBorderWidth("lr")+N.getPadding("lr"))
}return(O&&M<0)?0:M
},adjustHeight:function(M){var N=this;
var O=(typeof M=="number");
if(O&&N.autoBoxAdjust&&!N.isBorderBox()){M-=(N.getBorderWidth("tb")+N.getPadding("tb"))
}return(O&&M<0)?0:M
},addClass:function(Q){var R=this,P,M,O,N=[];
if(!CQ.Ext.isArray(Q)){if(typeof Q=="string"&&!this.hasClass(Q)){R.dom.className+=" "+Q
}}else{for(P=0,M=Q.length;
P<M;
P++){O=Q[P];
if(typeof O=="string"&&(" "+R.dom.className+" ").indexOf(" "+O+" ")==-1){N.push(O)
}}if(N.length){R.dom.className+=" "+N.join(" ")
}}return R
},removeClass:function(R){var S=this,Q,N,M,P,O;
if(!CQ.Ext.isArray(R)){R=[R]
}if(S.dom&&S.dom.className){O=S.dom.className.replace(r,"").split(B);
for(Q=0,M=R.length;
Q<M;
Q++){P=R[Q];
if(typeof P=="string"){P=P.replace(r,"");
N=O.indexOf(P);
if(N!=-1){O.splice(N,1)
}}}S.dom.className=O.join(" ")
}return S
},radioClass:function(P){var Q=this.dom.parentNode.childNodes,N,O,M;
P=CQ.Ext.isArray(P)?P:[P];
for(O=0,M=Q.length;
O<M;
O++){N=Q[O];
if(N&&N.nodeType==1){CQ.Ext.fly(N,"_internal").removeClass(P)
}}return this.addClass(P)
},toggleClass:function(M){return this.hasClass(M)?this.removeClass(M):this.addClass(M)
},hasClass:function(M){return M&&(" "+this.dom.className+" ").indexOf(" "+M+" ")!=-1
},replaceClass:function(N,M){return this.removeClass(N).addClass(M)
},isStyle:function(M,N){return this.getStyle(M)==N
},getStyle:function(){return z&&z.getComputedStyle?function(R){var P=this.dom,M,O,N,Q;
if(P==document){return null
}R=C(R);
N=(M=P.style[R])?M:(O=z.getComputedStyle(P,""))?O[R]:null;
if(R=="marginRight"&&N!="0px"&&!H.correctRightMargin){Q=P.style.display;
P.style.display="inline-block";
N=z.getComputedStyle(P,"").marginRight;
P.style.display=Q
}if(R=="backgroundColor"&&N=="rgba(0, 0, 0, 0)"&&!H.correctTransparentColor){N="transparent"
}return N
}:function(Q){var O=this.dom,M,N;
if(O==document){return null
}if(Q=="opacity"){if(O.style.filter.match){if(M=O.style.filter.match(K)){var P=parseFloat(M[1]);
if(!isNaN(P)){return P?P/100:0
}}}return 1
}Q=C(Q);
return O.style[Q]||((N=O.currentStyle)?N[Q]:null)
}
}(),getColor:function(M,N,R){var P=this.getStyle(M),O=(typeof R!="undefined")?R:"#",Q;
if(!P||(/transparent|inherit/.test(P))){return N
}if(/^r/.test(P)){CQ.Ext.each(P.slice(4,P.length-1).split(","),function(S){Q=parseInt(S,10);
O+=(Q<16?"0":"")+Q.toString(16)
})
}else{P=P.replace("#","");
O+=P.length==3?P.replace(/^(\w)(\w)(\w)$/,"$1$1$2$2$3$3"):P
}return(O.length>5?O.toLowerCase():N)
},setStyle:function(P,O){var M,N;
if(typeof P!="object"){M={};
M[P]=O;
P=M
}for(N in P){O=P[N];
N=="opacity"?this.setOpacity(O):this.dom.style[C(N)]=O
}return this
},setOpacity:function(N,M){var Q=this,O=Q.dom.style;
if(!M||!Q.anim){if(CQ.Ext.isIE){var P=N<1?"alpha(opacity="+N*100+")":"",R=O.filter.replace(K,"").replace(r,"");
O.zoom=1;
O.filter=R+(R.length>0?" ":"")+P
}else{O.opacity=N
}}else{Q.anim({opacity:{to:N}},Q.preanim(arguments,1),null,0.35,"easeIn")
}return Q
},clearOpacity:function(){var M=this.dom.style;
if(CQ.Ext.isIE){if(!CQ.Ext.isEmpty(M.filter)){M.filter=M.filter.replace(K,"").replace(r,"")
}}else{M.opacity=M["-moz-opacity"]=M["-khtml-opacity"]=""
}return this
},getHeight:function(O){var N=this,Q=N.dom,P=CQ.Ext.isIE&&N.isStyle("display","none"),M=y.max(Q.offsetHeight,P?0:Q.clientHeight)||0;
M=!O?M:M-N.getBorderWidth("tb")-N.getPadding("tb");
return M<0?0:M
},getWidth:function(N){var O=this,Q=O.dom,P=CQ.Ext.isIE&&O.isStyle("display","none"),M=y.max(Q.offsetWidth,P?0:Q.clientWidth)||0;
M=!N?M:M-O.getBorderWidth("lr")-O.getPadding("lr");
return M<0?0:M
},setWidth:function(N,M){var O=this;
N=O.adjustWidth(N);
!M||!O.anim?O.dom.style.width=O.addUnits(N):O.anim({width:{to:N}},O.preanim(arguments,1));
return O
},setHeight:function(M,N){var O=this;
M=O.adjustHeight(M);
!N||!O.anim?O.dom.style.height=O.addUnits(M):O.anim({height:{to:M}},O.preanim(arguments,1));
return O
},getBorderWidth:function(M){return this.addStyles(M,n)
},getPadding:function(M){return this.addStyles(M,k)
},clip:function(){var M=this,N=M.dom;
if(!L(N,j)){L(N,j,true);
L(N,J,{o:M.getStyle(q),x:M.getStyle(u),y:M.getStyle(t)});
M.setStyle(q,G);
M.setStyle(u,G);
M.setStyle(t,G)
}return M
},unclip:function(){var M=this,O=M.dom;
if(L(O,j)){L(O,j,false);
var N=L(O,J);
if(N.o){M.setStyle(q,N.o)
}if(N.x){M.setStyle(u,N.x)
}if(N.y){M.setStyle(t,N.y)
}}return M
},addStyles:function(T,S){var Q=0,R=T.match(b),P,O,N,M=R.length;
for(N=0;
N<M;
N++){P=R[N];
O=P&&parseInt(this.getStyle(S[P]),10);
if(O){Q+=y.abs(O)
}}return Q
},margins:a}
}());
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
(function(){var a=CQ.Ext.lib.Dom,b="left",k="right",g="top",n="bottom",m="position",c="static",j="relative",o="auto",q="z-index";
CQ.Ext.Element.addMethods({getX:function(){return a.getX(this.dom)
},getY:function(){return a.getY(this.dom)
},getXY:function(){return a.getXY(this.dom)
},getOffsetsTo:function(r){var u=this.getXY(),t=CQ.Ext.fly(r,"_internal").getXY();
return[u[0]-t[0],u[1]-t[1]]
},setX:function(r,t){return this.setXY([r,this.getY()],this.animTest(arguments,t,1))
},setY:function(t,r){return this.setXY([this.getX(),t],this.animTest(arguments,r,1))
},setLeft:function(r){this.setStyle(b,this.addUnits(r));
return this
},setTop:function(r){this.setStyle(g,this.addUnits(r));
return this
},setRight:function(r){this.setStyle(k,this.addUnits(r));
return this
},setBottom:function(r){this.setStyle(n,this.addUnits(r));
return this
},setXY:function(u,r){var t=this;
if(!r||!t.anim){a.setXY(t.dom,u)
}else{t.anim({points:{to:u}},t.preanim(arguments,1),"motion")
}return t
},setLocation:function(r,u,t){return this.setXY([r,u],this.animTest(arguments,t,2))
},moveTo:function(r,u,t){return this.setXY([r,u],this.animTest(arguments,t,2))
},getLeft:function(r){return !r?this.getX():parseInt(this.getStyle(b),10)||0
},getRight:function(r){var t=this;
return !r?t.getX()+t.getWidth():(t.getLeft(true)+t.getWidth())||0
},getTop:function(r){return !r?this.getY():parseInt(this.getStyle(g),10)||0
},getBottom:function(r){var t=this;
return !r?t.getY()+t.getHeight():(t.getTop(true)+t.getHeight())||0
},position:function(w,v,r,u){var t=this;
if(!w&&t.isStyle(m,c)){t.setStyle(m,j)
}else{if(w){t.setStyle(m,w)
}}if(v){t.setStyle(q,v)
}if(r||u){t.setXY([r||false,u||false])
}},clearPositioning:function(r){r=r||"";
this.setStyle({left:r,right:r,top:r,bottom:r,"z-index":"",position:c});
return this
},getPositioning:function(){var r=this.getStyle(b);
var u=this.getStyle(g);
return{position:this.getStyle(m),left:r,right:r?"":this.getStyle(k),top:u,bottom:u?"":this.getStyle(n),"z-index":this.getStyle(q)}
},setPositioning:function(r){var u=this,t=u.dom.style;
u.setStyle(r);
if(r.right==o){t.right=""
}if(r.bottom==o){t.bottom=""
}return u
},translatePoints:function(r,B){B=isNaN(r[1])?B:r[1];
r=isNaN(r[0])?r:r[0];
var w=this,z=w.isStyle(m,j),A=w.getXY(),u=parseInt(w.getStyle(b),10),v=parseInt(w.getStyle(g),10);
u=!isNaN(u)?u:(z?0:w.dom.offsetLeft);
v=!isNaN(v)?v:(z?0:w.dom.offsetTop);
return{left:(r-A[0]+u),top:(B-A[1]+v)}
},animTest:function(t,r,u){return !!r&&this.preanim?this.preanim(t,u):false
}})
})();
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.Element.addMethods({isScrollable:function(){var a=this.dom;
return a.scrollHeight>a.clientHeight||a.scrollWidth>a.clientWidth
},scrollTo:function(a,b){this.dom["scroll"+(/top/i.test(a)?"Top":"Left")]=b;
return this
},getScroll:function(){var m=this.dom,k=document,a=k.body,c=k.documentElement,b,j,g;
if(m==k||m==a){if(CQ.Ext.isIE&&CQ.Ext.isStrict){b=c.scrollLeft;
j=c.scrollTop
}else{b=window.pageXOffset;
j=window.pageYOffset
}g={left:b||(a?a.scrollLeft:0),top:j||(a?a.scrollTop:0)}
}else{g={left:m.scrollLeft,top:m.scrollTop}
}return g
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.Element.VISIBILITY=1;
CQ.Ext.Element.DISPLAY=2;
CQ.Ext.Element.OFFSETS=3;
CQ.Ext.Element.ASCLASS=4;
CQ.Ext.Element.visibilityCls="x-hide-nosize";
CQ.Ext.Element.addMethods(function(){var j=CQ.Ext.Element,w="opacity",o="visibility",k="display",g="hidden",u="offsets",q="asclass",t="none",a="nosize",b="originalDisplay",c="visibilityMode",m="isVisible",n=j.data,r=function(y){var x=n(y,b);
if(x===undefined){n(y,b,x="")
}return x
},v=function(y){var x=n(y,c);
if(x===undefined){n(y,c,x=1)
}return x
};
return{originalDisplay:"",visibilityMode:1,setVisibilityMode:function(x){n(this.dom,c,x);
return this
},animate:function(y,A,z,B,x){this.anim(y,{duration:A,callback:z,easing:B},x);
return this
},anim:function(A,B,y,D,z,x){y=y||"run";
B=B||{};
var C=this,E=CQ.Ext.lib.Anim[y](C.dom,A,(B.duration||D)||0.35,(B.easing||z)||"easeOut",function(){if(x){x.call(C)
}if(B.callback){B.callback.call(B.scope||C,C,B)
}},C);
B.anim=E;
return E
},preanim:function(x,y){return !x[y]?false:(typeof x[y]=="object"?x[y]:{duration:x[y+1],callback:x[y+2],easing:x[y+3]})
},isVisible:function(){var x=this,z=x.dom,y=n(z,m);
if(typeof y=="boolean"){return y
}y=!x.isStyle(o,g)&&!x.isStyle(k,t)&&!((v(z)==j.ASCLASS)&&x.hasClass(x.visibilityCls||j.visibilityCls));
n(z,m,y);
return y
},setVisible:function(A,x){var D=this,y,F,E,C,B=D.dom,z=v(B);
if(typeof x=="string"){switch(x){case k:z=j.DISPLAY;
break;
case o:z=j.VISIBILITY;
break;
case u:z=j.OFFSETS;
break;
case a:case q:z=j.ASCLASS;
break
}D.setVisibilityMode(z);
x=false
}if(!x||!D.anim){if(z==j.ASCLASS){D[A?"removeClass":"addClass"](D.visibilityCls||j.visibilityCls)
}else{if(z==j.DISPLAY){return D.setDisplayed(A)
}else{if(z==j.OFFSETS){if(!A){D.hideModeStyles={position:D.getStyle("position"),top:D.getStyle("top"),left:D.getStyle("left")};
D.applyStyles({position:"absolute",top:"-10000px",left:"-10000px"})
}else{D.applyStyles(D.hideModeStyles||{position:"",top:"",left:""});
delete D.hideModeStyles
}}else{D.fixDisplay();
B.style.visibility=A?"visible":g
}}}}else{if(A){D.setOpacity(0.01);
D.setVisible(true)
}D.anim({opacity:{to:(A?1:0)}},D.preanim(arguments,1),null,0.35,"easeIn",function(){A||D.setVisible(false).setOpacity(1)
})
}n(B,m,A);
return D
},hasMetrics:function(){var x=this.dom;
return this.isVisible()||(v(x)==j.VISIBILITY)
},toggle:function(x){var y=this;
y.setVisible(!y.isVisible(),y.preanim(arguments,0));
return y
},setDisplayed:function(x){if(typeof x=="boolean"){x=x?r(this.dom):t
}this.setStyle(k,x);
return this
},fixDisplay:function(){var x=this;
if(x.isStyle(k,t)){x.setStyle(o,g);
x.setStyle(k,r(this.dom));
if(x.isStyle(k,t)){x.setStyle(k,"block")
}}},hide:function(x){if(typeof x=="string"){this.setVisible(false,x);
return this
}this.setVisible(false,this.preanim(arguments,0));
return this
},show:function(x){if(typeof x=="string"){this.setVisible(true,x);
return this
}this.setVisible(true,this.preanim(arguments,0));
return this
}}
}());
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
(function(){var F=null,H=undefined,q=true,A=false,o="setX",m="setY",a="setXY",u="left",r="bottom",z="top",t="right",x="height",k="width",n="points",D="hidden",G="absolute",B="visible",j="motion",v="position",y="easeOut",g=new CQ.Ext.Element.Flyweight(),C={},E=function(I){return I||{}
},w=function(I){g.dom=I;
g.id=CQ.Ext.id(I);
return g
},c=function(I){if(!C[I]){C[I]=[]
}return C[I]
},b=function(J,I){C[J]=I
};
CQ.Ext.enableFx=q;
CQ.Ext.Fx={switchStatements:function(J,K,I){return K.apply(this,I[J])
},slideIn:function(O,L){L=E(L);
var Q=this,N=Q.dom,T=N.style,V,I,S,K,J,T,P,U,R,M;
O=O||"t";
Q.queueFx(L,function(){V=w(N).getXY();
w(N).fixDisplay();
I=w(N).getFxRestore();
S={x:V[0],y:V[1],0:V[0],1:V[1],width:N.offsetWidth,height:N.offsetHeight};
S.right=S.x+S.width;
S.bottom=S.y+S.height;
w(N).setWidth(S.width).setHeight(S.height);
K=w(N).fxWrap(I.pos,L,D);
T.visibility=B;
T.position=G;
function W(){w(N).fxUnwrap(K,I.pos,L);
T.width=I.width;
T.height=I.height;
w(N).afterFx(L)
}U={to:[S.x,S.y]};
R={to:S.width};
M={to:S.height};
function X(ab,Y,ac,Z,ae,ag,aj,ai,ah,ad,aa){var af={};
w(ab).setWidth(ac).setHeight(Z);
if(w(ab)[ae]){w(ab)[ae](ag)
}Y[aj]=Y[ai]="0";
if(ah){af.width=ah
}if(ad){af.height=ad
}if(aa){af.points=aa
}return af
}P=w(N).switchStatements(O.toLowerCase(),X,{t:[K,T,S.width,0,F,F,u,r,F,M,F],l:[K,T,0,S.height,F,F,t,z,R,F,F],r:[K,T,S.width,S.height,o,S.right,u,z,F,F,U],b:[K,T,S.width,S.height,m,S.bottom,u,z,F,M,U],tl:[K,T,0,0,F,F,t,r,R,M,U],bl:[K,T,0,0,m,S.y+S.height,t,z,R,M,U],br:[K,T,0,0,a,[S.right,S.bottom],u,z,R,M,U],tr:[K,T,0,0,o,S.x+S.width,u,r,R,M,U]});
T.visibility=B;
w(K).show();
arguments.callee.anim=w(K).fxanim(P,L,j,0.5,y,W)
});
return Q
},slideOut:function(M,K){K=E(K);
var O=this,L=O.dom,R=L.style,S=O.getXY(),J,I,P,Q,N={to:0};
M=M||"t";
O.queueFx(K,function(){I=w(L).getFxRestore();
P={x:S[0],y:S[1],0:S[0],1:S[1],width:L.offsetWidth,height:L.offsetHeight};
P.right=P.x+P.width;
P.bottom=P.y+P.height;
w(L).setWidth(P.width).setHeight(P.height);
J=w(L).fxWrap(I.pos,K,B);
R.visibility=B;
R.position=G;
w(J).setWidth(P.width).setHeight(P.height);
function T(){K.useDisplay?w(L).setDisplayed(A):w(L).hide();
w(L).fxUnwrap(J,I.pos,K);
R.width=I.width;
R.height=I.height;
w(L).afterFx(K)
}function U(V,ad,ab,ae,Z,ac,Y,aa,X){var W={};
V[ad]=V[ab]="0";
W[ae]=Z;
if(ac){W[ac]=Y
}if(aa){W[aa]=X
}return W
}Q=w(L).switchStatements(M.toLowerCase(),U,{t:[R,u,r,x,N],l:[R,t,z,k,N],r:[R,u,z,k,N,n,{to:[P.right,P.y]}],b:[R,u,z,x,N,n,{to:[P.x,P.bottom]}],tl:[R,t,r,k,N,x,N],bl:[R,t,z,k,N,x,N,n,{to:[P.x,P.bottom]}],br:[R,u,z,k,N,x,N,n,{to:[P.x+P.width,P.bottom]}],tr:[R,u,r,k,N,x,N,n,{to:[P.right,P.y]}]});
arguments.callee.anim=w(J).fxanim(Q,K,j,0.5,y,T)
});
return O
},puff:function(O){O=E(O);
var M=this,N=M.dom,J=N.style,K,I,L;
M.queueFx(O,function(){K=w(N).getWidth();
I=w(N).getHeight();
w(N).clearOpacity();
w(N).show();
L=w(N).getFxRestore();
function P(){O.useDisplay?w(N).setDisplayed(A):w(N).hide();
w(N).clearOpacity();
w(N).setPositioning(L.pos);
J.width=L.width;
J.height=L.height;
J.fontSize="";
w(N).afterFx(O)
}arguments.callee.anim=w(N).fxanim({width:{to:w(N).adjustWidth(K*2)},height:{to:w(N).adjustHeight(I*2)},points:{by:[-K*0.5,-I*0.5]},opacity:{to:0},fontSize:{to:200,unit:"%"}},O,j,0.5,y,P)
});
return M
},switchOff:function(M){M=E(M);
var K=this,L=K.dom,I=L.style,J;
K.queueFx(M,function(){w(L).clearOpacity();
w(L).clip();
J=w(L).getFxRestore();
function N(){M.useDisplay?w(L).setDisplayed(A):w(L).hide();
w(L).clearOpacity();
w(L).setPositioning(J.pos);
I.width=J.width;
I.height=J.height;
w(L).afterFx(M)
}w(L).fxanim({opacity:{to:0.3}},F,F,0.1,F,function(){w(L).clearOpacity();
(function(){w(L).fxanim({height:{to:1},points:{by:[0,w(L).getHeight()*0.5]}},M,j,0.3,"easeIn",N)
}).defer(100)
})
});
return K
},highlight:function(K,O){O=E(O);
var M=this,N=M.dom,I=O.attr||"backgroundColor",J={},L;
M.queueFx(O,function(){w(N).clearOpacity();
w(N).show();
function P(){N.style[I]=L;
w(N).afterFx(O)
}L=N.style[I];
J[I]={from:K||"ffff9c",to:O.endColor||w(N).getColor(I)||"ffffff"};
arguments.callee.anim=w(N).fxanim(J,O,"color",1,"easeIn",P)
});
return M
},frame:function(I,L,O){O=E(O);
var K=this,N=K.dom,J,M;
K.queueFx(O,function(){I=I||"#C3DAF9";
if(I.length==6){I="#"+I
}L=L||1;
w(N).show();
var S=w(N).getXY(),Q={x:S[0],y:S[1],0:S[0],1:S[1],width:N.offsetWidth,height:N.offsetHeight},P=function(){J=w(document.body||document.documentElement).createChild({style:{position:G,"z-index":35000,border:"0px solid "+I}});
return J.queueFx({},R)
};
arguments.callee.anim={isAnimated:true,stop:function(){L=0;
J.stopFx()
}};
function R(){var T=CQ.Ext.isBorderBox?2:1;
M=J.anim({top:{from:Q.y,to:Q.y-20},left:{from:Q.x,to:Q.x-20},borderWidth:{from:0,to:10},opacity:{from:1,to:0},height:{from:Q.height,to:Q.height+20*T},width:{from:Q.width,to:Q.width+20*T}},{duration:O.duration||1,callback:function(){J.remove();
--L>0?P():w(N).afterFx(O)
}});
arguments.callee.anim={isAnimated:true,stop:function(){M.stop()
}}
}P()
});
return K
},pause:function(K){var J=this.dom,I;
this.queueFx({},function(){I=setTimeout(function(){w(J).afterFx({})
},K*1000);
arguments.callee.anim={isAnimated:true,stop:function(){clearTimeout(I);
w(J).afterFx({})
}}
});
return this
},fadeIn:function(K){K=E(K);
var I=this,J=I.dom,L=K.endOpacity||1;
I.queueFx(K,function(){w(J).setOpacity(0);
w(J).fixDisplay();
J.style.visibility=B;
arguments.callee.anim=w(J).fxanim({opacity:{to:L}},K,F,0.5,y,function(){if(L==1){w(J).clearOpacity()
}w(J).afterFx(K)
})
});
return I
},fadeOut:function(L){L=E(L);
var J=this,K=J.dom,I=K.style,M=L.endOpacity||0;
J.queueFx(L,function(){arguments.callee.anim=w(K).fxanim({opacity:{to:M}},L,F,0.5,y,function(){if(M==0){CQ.Ext.Element.data(K,"visibilityMode")==CQ.Ext.Element.DISPLAY||L.useDisplay?I.display="none":I.visibility=D;
w(K).clearOpacity()
}w(K).afterFx(L)
})
});
return J
},scale:function(I,J,K){this.shift(CQ.Ext.apply({},K,{width:I,height:J}));
return this
},shift:function(K){K=E(K);
var J=this.dom,I={};
this.queueFx(K,function(){for(var L in K){if(K[L]!=H){I[L]={to:K[L]}
}}I.width?I.width.to=w(J).adjustWidth(K.width):I;
I.height?I.height.to=w(J).adjustWidth(K.height):I;
if(I.x||I.y||I.xy){I.points=I.xy||{to:[I.x?I.x.to:w(J).getX(),I.y?I.y.to:w(J).getY()]}
}arguments.callee.anim=w(J).fxanim(I,K,j,0.35,y,function(){w(J).afterFx(K)
})
});
return this
},ghost:function(L,J){J=E(J);
var N=this,K=N.dom,Q=K.style,O={opacity:{to:0},points:{}},R=O.points,I,P,M;
L=L||"b";
N.queueFx(J,function(){I=w(K).getFxRestore();
P=w(K).getWidth();
M=w(K).getHeight();
function S(){J.useDisplay?w(K).setDisplayed(A):w(K).hide();
w(K).clearOpacity();
w(K).setPositioning(I.pos);
Q.width=I.width;
Q.height=I.height;
w(K).afterFx(J)
}R.by=w(K).switchStatements(L.toLowerCase(),function(U,T){return[U,T]
},{t:[0,-M],l:[-P,0],r:[P,0],b:[0,M],tl:[-P,-M],bl:[-P,M],br:[P,M],tr:[P,-M]});
arguments.callee.anim=w(K).fxanim(O,J,j,0.5,y,S)
});
return N
},syncFx:function(){var I=this;
I.fxDefaults=CQ.Ext.apply(I.fxDefaults||{},{block:A,concurrent:q,stopFx:A});
return I
},sequenceFx:function(){var I=this;
I.fxDefaults=CQ.Ext.apply(I.fxDefaults||{},{block:A,concurrent:A,stopFx:A});
return I
},nextFx:function(){var I=c(this.dom.id)[0];
if(I){I.call(this)
}},hasActiveFx:function(){return c(this.dom.id)[0]
},stopFx:function(I){var J=this,L=J.dom.id;
if(J.hasActiveFx()){var K=c(L)[0];
if(K&&K.anim){if(K.anim.isAnimated){b(L,[K]);
K.anim.stop(I!==undefined?I:q)
}else{b(L,[])
}}}return J
},beforeFx:function(I){if(this.hasActiveFx()&&!I.concurrent){if(I.stopFx){this.stopFx();
return q
}return A
}return q
},hasFxBlock:function(){var I=c(this.dom.id);
return I&&I[0]&&I[0].block
},queueFx:function(L,I){var J=w(this.dom);
if(!J.hasFxBlock()){CQ.Ext.applyIf(L,J.fxDefaults);
if(!L.concurrent){var K=J.beforeFx(L);
I.block=L.block;
c(J.dom.id).push(I);
if(K){J.nextFx()
}}else{I.call(J)
}}return J
},fxWrap:function(O,M,K){var L=this.dom,J,I;
if(!M.wrap||!(J=CQ.Ext.getDom(M.wrap))){if(M.fixPosition){I=w(L).getXY()
}var N=document.createElement("div");
N.style.visibility=K;
J=L.parentNode.insertBefore(N,L);
w(J).setPositioning(O);
if(w(J).isStyle(v,"static")){w(J).position("relative")
}w(L).clearPositioning("auto");
w(J).clip();
J.appendChild(L);
if(I){w(J).setXY(I)
}}return J
},fxUnwrap:function(J,M,L){var K=this.dom;
w(K).clearPositioning();
w(K).setPositioning(M);
if(!L.wrap){var I=w(J).dom.parentNode;
I.insertBefore(K,J);
w(J).remove()
}},getFxRestore:function(){var I=this.dom.style;
return{pos:this.getPositioning(),width:I.width,height:I.height}
},afterFx:function(J){var I=this.dom,K=I.id;
if(J.afterStyle){w(I).setStyle(J.afterStyle)
}if(J.afterCls){w(I).addClass(J.afterCls)
}if(J.remove==q){w(I).remove()
}if(J.callback){J.callback.call(J.scope,w(I))
}if(!J.concurrent){c(K).shift();
w(I).nextFx()
}},fxanim:function(L,M,J,N,K,I){J=J||"run";
M=M||{};
var O=CQ.Ext.lib.Anim[J](this.dom,L,(M.duration||N)||0.35,(M.easing||K)||y,I,this);
M.anim=O;
return O
}};
CQ.Ext.Fx.resize=CQ.Ext.Fx.scale;
CQ.Ext.Element.addMethods(CQ.Ext.Fx)
})();
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.CompositeElementLite=function(b,a){this.elements=[];
this.add(b,a);
this.el=new CQ.Ext.Element.Flyweight()
};
CQ.Ext.CompositeElementLite.prototype={isComposite:true,getElement:function(a){var b=this.el;
b.dom=a;
b.id=a.id;
return b
},transformElement:function(a){return CQ.Ext.getDom(a)
},getCount:function(){return this.elements.length
},add:function(g,b){var j=this,k=j.elements;
if(!g){return this
}if(typeof g=="string"){g=CQ.Ext.Element.selectorFunction(g,b)
}else{if(g.isComposite){g=g.elements
}else{if(!CQ.Ext.isIterable(g)){g=[g]
}}}for(var c=0,a=g.length;
c<a;
++c){k.push(j.transformElement(g[c]))
}return j
},invoke:function(j,b){var k=this,g=k.elements,a=g.length,m,c;
for(c=0;
c<a;
c++){m=g[c];
if(m){CQ.Ext.Element.prototype[j].apply(k.getElement(m),b)
}}return k
},item:function(b){var g=this,c=g.elements[b],a=null;
if(c){a=g.getElement(c)
}return a
},addListener:function(b,m,k,j){var g=this.elements,a=g.length,c,n;
for(c=0;
c<a;
c++){n=g[c];
if(n){CQ.Ext.EventManager.on(n,b,m,k||n,j)
}}return this
},each:function(j,g){var k=this,c=k.elements,a=c.length,b,m;
for(b=0;
b<a;
b++){m=c[b];
if(m){m=this.getElement(m);
if(j.call(g||m,m,k,b)===false){break
}}}return k
},fill:function(a){var b=this;
b.elements=[];
b.add(a);
return b
},filter:function(a){var b=[],g=this,c=CQ.Ext.isFunction(a)?a:function(j){return j.is(a)
};
g.each(function(m,j,k){if(c(m,k)!==false){b[b.length]=g.transformElement(m)
}});
g.elements=b;
return g
},indexOf:function(a){return this.elements.indexOf(this.transformElement(a))
},replaceElement:function(g,c,a){var b=!isNaN(g)?g:this.indexOf(g),j;
if(b>-1){c=CQ.Ext.getDom(c);
if(a){j=this.elements[b];
j.parentNode.insertBefore(c,j);
CQ.Ext.removeNode(j)
}this.elements.splice(b,1,c)
}return this
},clear:function(){this.elements=[]
}};
CQ.Ext.CompositeElementLite.prototype.on=CQ.Ext.CompositeElementLite.prototype.addListener;
CQ.Ext.CompositeElementLite.importElementMethods=function(){var c,b=CQ.Ext.Element.prototype,a=CQ.Ext.CompositeElementLite.prototype;
for(c in b){if(typeof b[c]=="function"){(function(g){a[g]=a[g]||function(){return this.invoke(g,arguments)
}
}).call(a,c)
}}};
CQ.Ext.CompositeElementLite.importElementMethods();
if(CQ.Ext.DomQuery){CQ.Ext.Element.selectorFunction=CQ.Ext.DomQuery.select
}CQ.Ext.Element.select=function(a,b){var c;
if(typeof a=="string"){c=CQ.Ext.Element.selectorFunction(a,b)
}else{if(a.length!==undefined){c=a
}else{throw"Invalid selector"
}}return new CQ.Ext.CompositeElementLite(c)
};
CQ.Ext.select=CQ.Ext.Element.select;
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
(function(){var b="beforerequest",j="requestcomplete",g="requestexception",m=undefined,c="load",n="POST",a="GET",k=window;
CQ.Ext.data.Connection=function(o){CQ.Ext.apply(this,o);
this.addEvents(b,j,g);
CQ.Ext.data.Connection.superclass.constructor.call(this)
};
CQ.Ext.extend(CQ.Ext.data.Connection,CQ.Ext.util.Observable,{timeout:30000,autoAbort:false,disableCaching:true,disableCachingParam:"_dc",request:function(v){var y=this;
if(y.fireEvent(b,y,v)){if(v.el){if(!CQ.Ext.isEmpty(v.indicatorText)){y.indicatorText='<div class="loading-indicator">'+v.indicatorText+"</div>"
}if(y.indicatorText){CQ.Ext.getDom(v.el).innerHTML=y.indicatorText
}v.success=(CQ.Ext.isFunction(v.success)?v.success:function(){}).createInterceptor(function(o){CQ.Ext.getDom(v.el).innerHTML=o.responseText
})
}var t=v.params,r=v.url||y.url,q,w={success:y.handleResponse,failure:y.handleFailure,scope:y,argument:{options:v},timeout:CQ.Ext.num(v.timeout,y.timeout)},u,z;
if(CQ.Ext.isFunction(t)){t=t.call(v.scope||k,v)
}t=CQ.Ext.urlEncode(y.extraParams,CQ.Ext.isObject(t)?CQ.Ext.urlEncode(t):t);
if(CQ.Ext.isFunction(r)){r=r.call(v.scope||k,v)
}r=CQ.HTTP.externalize(r,true);
if((u=CQ.Ext.getDom(v.form))){r=r||u.action;
if(v.isUpload||(/multipart\/form-data/i.test(u.getAttribute("enctype")))){return y.doFormUpload.call(y,v,t,r)
}z=CQ.Ext.lib.Ajax.serializeForm(u);
t=t?(t+"&"+z):z
}q=v.method||y.method||((t||v.xmlData||v.jsonData)?n:a);
if(q===a&&(y.disableCaching&&v.disableCaching!==false)||v.disableCaching===true){var x=v.disableCachingParam||y.disableCachingParam;
r=CQ.Ext.urlAppend(r,x+"="+(new Date().getTime()))
}v.headers=CQ.Ext.applyIf(v.headers||{},y.defaultHeaders||{});
if(v.autoAbort===true||y.autoAbort){y.abort()
}if((q==a||v.xmlData||v.jsonData)&&t){r=CQ.Ext.urlAppend(r,t);
t=""
}return(y.transId=CQ.Ext.lib.Ajax.request(q,r,w,t,v))
}else{return v.callback?v.callback.apply(v.scope,[v,m,m]):null
}},isLoading:function(o){return o?CQ.Ext.lib.Ajax.isCallInProgress(o):!!this.transId
},abort:function(o){if(o||this.isLoading()){CQ.Ext.lib.Ajax.abort(o||this.transId)
}},handleResponse:function(o){this.transId=false;
var q=o.argument.options;
o.argument=q?q.argument:null;
this.fireEvent(j,this,o,q);
if(q.success){q.success.call(q.scope,o,q)
}if(q.callback){q.callback.call(q.scope,q,true,o)
}},handleFailure:function(o,r){this.transId=false;
var q=o.argument.options;
o.argument=q?q.argument:null;
this.fireEvent(g,this,o,q,r);
if(q.failure){q.failure.call(q.scope,o,q)
}if(q.callback){q.callback.call(q.scope,q,false,o)
}},doFormUpload:function(x,q,r){var t=CQ.Ext.id(),C=document,y=C.createElement("iframe"),u=CQ.Ext.getDom(x.form),B=[],A,w="multipart/form-data",v={target:u.target,method:u.method,encoding:u.encoding,enctype:u.enctype,action:u.action};
CQ.Ext.fly(y).set({id:t,name:t,cls:"x-hidden",src:CQ.Ext.SSL_SECURE_URL});
CQ.Util.getRoot().dom.appendChild(y);
if(CQ.Ext.isIE){document.frames[t].name=t
}CQ.Ext.fly(u).set({target:t,method:n,enctype:w,encoding:w,action:r||v.action});
CQ.Ext.iterate(CQ.Ext.urlDecode(q,false),function(D,o){A=C.createElement("input");
CQ.Ext.fly(A).set({type:"hidden",value:o,name:D});
u.appendChild(A);
B.push(A)
});
function z(){var E=this,D={responseText:"",responseXML:null,argument:x.argument},H,G;
try{H=y.contentWindow.document||y.contentDocument||k.frames[t].document;
if(H){if(H.body){if(/textarea/i.test((G=H.body.firstChild||{}).tagName)){D.responseText=G.value
}else{D.responseText=H.body.innerHTML
}}D.responseXML=H.XMLDocument||H
}}catch(F){}CQ.Ext.EventManager.removeListener(y,c,z,E);
E.fireEvent(j,E,D,x);
function o(K,J,I){if(CQ.Ext.isFunction(K)){K.apply(J,I)
}}o(x.success,x.scope,[D,x]);
o(x.callback,x.scope,[x,true,D]);
if(!E.debugUploads){setTimeout(function(){CQ.Ext.removeNode(y)
},100)
}}CQ.Ext.EventManager.on(y,c,z,this);
u.submit();
CQ.Ext.fly(u).set(v);
CQ.Ext.each(B,function(o){CQ.Ext.removeNode(o)
})
}})
})();
CQ.Ext.Ajax=new CQ.Ext.data.Connection({autoAbort:false,serializeForm:function(a){return CQ.Ext.lib.Ajax.serializeForm(a)
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.util.JSON=new (function(){var useHasOwn=!!{}.hasOwnProperty,isNative=function(){var useNative=null;
return function(){if(useNative===null){useNative=CQ.Ext.USE_NATIVE_JSON&&window.JSON&&JSON.toString()=="[object JSON]"
}return useNative
}
}(),pad=function(n){return n<10?"0"+n:n
},doDecode=function(json){return json?eval("("+json+")"):""
},doEncode=function(o){if(!CQ.Ext.isDefined(o)||o===null){return"null"
}else{if(CQ.Ext.isArray(o)){return encodeArray(o)
}else{if(CQ.Ext.isDate(o)){return CQ.Ext.util.JSON.encodeDate(o)
}else{if(CQ.Ext.isString(o)){return encodeString(o)
}else{if(typeof o=="number"){return isFinite(o)?String(o):"null"
}else{if(CQ.Ext.isBoolean(o)){return String(o)
}else{var a=["{"],b,i,v;
for(i in o){if(!o.getElementsByTagName){if(!useHasOwn||o.hasOwnProperty(i)){v=o[i];
switch(typeof v){case"undefined":case"function":case"unknown":break;
default:if(b){a.push(",")
}a.push(doEncode(i),":",v===null?"null":doEncode(v));
b=true
}}}}a.push("}");
return a.join("")
}}}}}}},m={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},encodeString=function(s){if(/["\\\x00-\x1f]/.test(s)){return'"'+s.replace(/([\x00-\x1f\\"])/g,function(a,b){var c=m[b];
if(c){return c
}c=b.charCodeAt();
return"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16)
})+'"'
}return'"'+s+'"'
},encodeArray=function(o){var a=["["],b,i,l=o.length,v;
for(i=0;
i<l;
i+=1){v=o[i];
switch(typeof v){case"undefined":case"function":case"unknown":break;
default:if(b){a.push(",")
}a.push(v===null?"null":CQ.Ext.util.JSON.encode(v));
b=true
}}a.push("]");
return a.join("")
};
this.encodeDate=function(o){return'"'+o.getFullYear()+"-"+pad(o.getMonth()+1)+"-"+pad(o.getDate())+"T"+pad(o.getHours())+":"+pad(o.getMinutes())+":"+pad(o.getSeconds())+'"'
};
this.encode=function(){var ec;
return function(o){if(!ec){ec=isNative()?JSON.stringify:doEncode
}return ec(o)
}
}();
this.decode=function(){var dc;
return function(json){if(!dc){dc=isNative()?JSON.parse:doDecode
}return dc(json)
}
}()
})();
CQ.Ext.encode=CQ.Ext.util.JSON.encode;
CQ.Ext.decode=CQ.Ext.util.JSON.decode;
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.EventManager=function(){var N,A,t=false,v=CQ.Ext.isGecko||CQ.Ext.isWebKit||CQ.Ext.isSafari,z=CQ.Ext.lib.Event,B=CQ.Ext.lib.Dom,g=document,O=window,C="DOMContentLoaded",G="complete",o=/^(?:scope|delay|buffer|single|stopEvent|preventDefault|stopPropagation|normalized|args|delegate)$/,H=[];
var b="CQ";
function x(R){var U=false,E=0,D=H.length,S=false,T;
if(R){if(R.getElementById||R.navigator){for(;
E<D;
++E){T=H[E];
if(T.el===R){U=T.id;
break
}}if(!U){U=CQ.Ext.id(R);
H.push({id:U,el:R});
S=true
}}else{U=CQ.Ext.id(R)
}if(!CQ.Ext.elCache[U]){CQ.Ext.Element.addToCache(new CQ.Ext.Element(R),U);
if(S){CQ.Ext.elCache[U].skipGC=true
}}}return U
}function w(R,T,W,S,E,Y){R=CQ.Ext.getDom(R);
var D=x(R),X=CQ.Ext.elCache[D].events,U;
U=z.on(R,T,E);
X[T]=X[T]||[];
X[T].push([W,E,Y,U,S]);
if(R.addEventListener&&T=="mousewheel"){var V=["DOMMouseScroll",E,false];
R.addEventListener.apply(R,V);
CQ.Ext.EventManager.addListener(O,"unload",function(){R.removeEventListener.apply(R,V)
})
}if(R==g&&T=="mousedown"){CQ.Ext.EventManager.stoppedMouseDownEvent.addListener(E)
}}function k(){if(window!=top){return false
}try{g.documentElement.doScroll("left")
}catch(D){return false
}c();
return true
}function Q(D){if(CQ.Ext.isIE&&k()){return true
}if(g.readyState==G){c();
return true
}t||(A=setTimeout(arguments.callee,2));
return false
}var u;
function r(D){u||(u=CQ.Ext.query("style, link[rel=stylesheet]"));
if(u.length==g.styleSheets.length){c();
return true
}t||(A=setTimeout(arguments.callee,2));
return false
}function L(D){g.removeEventListener(C,arguments.callee,false);
r()
}function c(D){if(!t){t=true;
if(A){clearTimeout(A)
}if(v){g.removeEventListener(C,c,false)
}if(CQ.Ext.isIE&&Q.bindIE){g.detachEvent("onreadystatechange",Q)
}z.un(O,"load",arguments.callee)
}if(N&&!CQ.Ext.isReady){CQ.Ext.isReady=true;
N.fire();
N.listeners=[]
}}function a(){N||(N=new CQ.Ext.util.Event());
if(v){g.addEventListener(C,c,false)
}if(CQ.Ext.isIE){if(!Q()){Q.bindIE=true;
g.attachEvent("onreadystatechange",Q)
}}else{if(CQ.Ext.isOpera){(g.readyState==G&&r())||g.addEventListener(C,L,false)
}else{if(CQ.Ext.isWebKit){Q()
}}}var D=function(){c();
z.un(O,"load",D)
};
z.on(O,"load",D)
}function K(D,E){return function(){var R=CQ.Ext.toArray(arguments);
if(E.target==CQ.Ext.EventObject.setEvent(R[0]).target){D.apply(this,R)
}}
}function J(E,R,D){return function(S){D.delay(R.buffer,E,null,[new CQ.Ext.EventObjectImpl(S)])
}
}function F(T,S,D,R,E){return function(U){CQ.Ext.EventManager.removeListener(S,D,R,E);
T(U)
}
}function m(E,R,D){return function(T){var S=new CQ.Ext.util.DelayedTask(E);
if(!D.tasks){D.tasks=[]
}D.tasks.push(S);
S.delay(R.delay||10,E,null,[new CQ.Ext.EventObjectImpl(T)])
}
}function q(U,T,D,W,X){var E=(!D||typeof D=="boolean")?{}:D,R=CQ.Ext.getDom(U),S;
W=W||E.fn;
X=X||E.scope;
if(!R){throw'Error listening for "'+T+'". Element "'+U+"\" doesn't exist."
}function V(Z){if(!CQ.Ext){return
}Z=CQ.Ext.EventObject.setEvent(Z);
var Y;
if(E.delegate){if(!(Y=Z.getTarget(E.delegate,R))){return
}}else{Y=Z.target
}if(E.stopEvent){Z.stopEvent()
}if(E.preventDefault){Z.preventDefault()
}if(E.stopPropagation){Z.stopPropagation()
}if(E.normalized===false){Z=Z.browserEvent
}W.call(X||R,Z,Y,E)
}if(E.target){V=K(V,E)
}if(E.delay){V=m(V,E,W)
}if(E.single){V=F(V,R,T,W,X)
}if(E.buffer){S=new CQ.Ext.util.DelayedTask(V);
V=J(V,E,S)
}w(R,T,W,S,V,X);
return V
}var M,P,n=false;
function j(){z.un(window,"load",j);
if(!n){n=true;
CQ.Ext.isLoaded=true;
if(P){clearInterval(P)
}if(M){M.fire();
M.clearListeners()
}}}function y(){M=new CQ.Ext.util.Event();
z.on(window,"load",j)
}var I={addListener:function(R,D,T,S,E){if(typeof D=="object"){var W=D,U,V;
for(U in W){V=W[U];
if(!o.test(U)){if(CQ.Ext.isFunction(V)){q(R,U,W,V,W.scope)
}else{q(R,U,V)
}}}}else{q(R,D,E,T,S)
}},removeListener:function(R,V,Z,aa){R=CQ.Ext.getDom(R);
var D=x(R),X=R&&(CQ.Ext.elCache[D].events)[V]||[],E,U,S,T,W,Y;
for(U=0,W=X.length;
U<W;
U++){if(CQ.Ext.isArray(Y=X[U])&&Y[0]==Z&&(!aa||Y[2]==aa)){if(Y[4]){Y[4].cancel()
}T=Z.tasks&&Z.tasks.length;
if(T){while(T--){Z.tasks[T].cancel()
}delete Z.tasks
}E=Y[1];
z.un(R,V,z.extAdapter?Y[3]:E);
if(E&&R.addEventListener&&V=="mousewheel"){R.removeEventListener("DOMMouseScroll",E,false)
}if(E&&R==g&&V=="mousedown"){CQ.Ext.EventManager.stoppedMouseDownEvent.removeListener(E)
}X.splice(U,1);
if(X.length===0){delete CQ.Ext.elCache[D].events[V]
}for(T in CQ.Ext.elCache[D].events){return false
}CQ.Ext.elCache[D].events={};
return false
}}},removeAll:function(R){R=CQ.Ext.getDom(R);
var E=x(R),W=CQ.Ext.elCache[E]||{},Z=W.events||{},V,U,X,S,Y,T,D;
for(S in Z){if(Z.hasOwnProperty(S)){V=Z[S];
for(U=0,X=V.length;
U<X;
U++){Y=V[U];
if(Y[4]){Y[4].cancel()
}if(Y[0].tasks&&(T=Y[0].tasks.length)){while(T--){Y[0].tasks[T].cancel()
}delete Y.tasks
}D=Y[1];
z.un(R,S,z.extAdapter?Y[3]:D);
if(R.addEventListener&&D&&S=="mousewheel"){R.removeEventListener("DOMMouseScroll",D,false)
}if(D&&R==g&&S=="mousedown"){CQ.Ext.EventManager.stoppedMouseDownEvent.removeListener(D)
}}}}if(CQ.Ext.elCache[E]){CQ.Ext.elCache[E].events={}
}},getListeners:function(S,D){S=CQ.Ext.getDom(S);
var U=x(S),E=CQ.Ext.elCache[U]||{},T=E.events||{},R=[];
if(T&&T[D]){return T[D]
}else{return null
}},purgeElement:function(R,D,T){R=CQ.Ext.getDom(R);
var E=x(R),W=CQ.Ext.elCache[E]||{},X=W.events||{},S,V,U;
if(T){if(X&&X.hasOwnProperty(T)){V=X[T];
for(S=0,U=V.length;
S<U;
S++){CQ.Ext.EventManager.removeListener(R,T,V[S][0])
}}}else{CQ.Ext.EventManager.removeAll(R)
}if(D&&R&&R.childNodes){for(S=0,U=R.childNodes.length;
S<U;
S++){CQ.Ext.EventManager.purgeElement(R.childNodes[S],D,T)
}}},_unload:function(){var D;
for(D in CQ.Ext.elCache){CQ.Ext.EventManager.removeAll(D)
}delete CQ.Ext.elCache;
delete CQ.Ext.Element._flyweights;
var T,E,S,R=CQ.Ext.lib.Ajax;
(typeof R.conn=="object")?E=R.conn:E={};
for(S in E){T=E[S];
if(T){R.abort({conn:T,tId:S})
}}},onWindowLoaded:function(R,E,D){if(n){M.addListener(R,E,D);
M.fire();
M.clearListeners();
return
}if(!M){y()
}M.addListener(R,E,D)
},onDocumentReady:function(R,E,D){if(CQ.Ext.isReady){N||(N=new CQ.Ext.util.Event());
N.addListener(R,E,D);
N.fire();
N.listeners=[]
}else{if(!N){a()
}D=D||{};
D.delay=D.delay||1;
N.addListener(R,E,D)
}},fireDocReady:c};
I.on=I.addListener;
I.un=I.removeListener;
I.stoppedMouseDownEvent=new CQ.Ext.util.Event();
return I
}();
CQ.Ext.onReady=CQ.Ext.EventManager.onDocumentReady;
CQ.Ext.onLoad=CQ.Ext.EventManager.onWindowLoaded;
(function(){var a=function(){var c=document.body||document.getElementsByTagName("body")[0];
if(!c){return false
}var b=[" ",CQ.Ext.isIE?"ext-ie "+(CQ.Ext.isIE6?"ext-ie6":(CQ.Ext.isIE7?"ext-ie7":(CQ.Ext.isIE8?"ext-ie8":(CQ.Ext.isIE9?"ext-ie9":"ext-ie10")))):CQ.Ext.isGecko?"ext-gecko "+(CQ.Ext.isGecko2?"ext-gecko2":"ext-gecko3"):CQ.Ext.isOpera?"ext-opera":CQ.Ext.isWebKit?"ext-webkit":""];
if(CQ.Ext.isSafari){b.push("ext-safari "+(CQ.Ext.isSafari2?"ext-safari2":(CQ.Ext.isSafari3?"ext-safari3":"ext-safari4")))
}else{if(CQ.Ext.isChrome){b.push("ext-chrome")
}}if(CQ.Ext.isMac){b.push("ext-mac")
}if(CQ.Ext.isLinux){b.push("ext-linux")
}if(CQ.Ext.isStrict||CQ.Ext.isBorderBox){var g=c.parentNode;
if(g){if(!CQ.Ext.isStrict){CQ.Ext.fly(g,"_internal").addClass("x-quirks");
if(CQ.Ext.isIE&&!CQ.Ext.isStrict){CQ.Ext.isIEQuirks=true
}}CQ.Ext.fly(g,"_internal").addClass(((CQ.Ext.isStrict&&CQ.Ext.isIE)||(!CQ.Ext.enableForcedBoxModel&&!CQ.Ext.isIE))?" ext-strict":" ext-border-box")
}}if(CQ.Ext.enableForcedBoxModel&&!CQ.Ext.isIE){CQ.Ext.isForcedBorderBox=true;
b.push("ext-forced-border-box")
}CQ.Ext.fly(c,"_internal").addClass(b);
return true
};
if(!a()){CQ.Ext.onReady(a)
}})();
(function(){var b=CQ.Ext.apply(CQ.Ext.supports,{correctRightMargin:true,correctTransparentColor:true,cssFloat:true});
var a=function(){var k=document.createElement("div"),j=document,c,g;
k.innerHTML='<div style="height:30px;width:50px;"><div style="height:20px;width:20px;"></div></div><div style="float:left;background-color:transparent;">';
j.body.appendChild(k);
g=k.lastChild;
if((c=j.defaultView)){if(c.getComputedStyle(k.firstChild.firstChild,null).marginRight!="0px"){b.correctRightMargin=false
}if(c.getComputedStyle(g,null).backgroundColor!="transparent"){b.correctTransparentColor=false
}}b.cssFloat=!!g.style.cssFloat;
j.body.removeChild(k)
};
if(CQ.Ext.isReady){a()
}else{CQ.Ext.onReady(a)
}})();
CQ.Ext.EventObject=function(){var b=CQ.Ext.lib.Event,c=/(dbl)?click/,a={3:13,63234:37,63235:39,63232:38,63233:40,63276:33,63277:34,63272:46,63273:36,63275:35},g=CQ.Ext.isIE?{1:0,4:1,2:2}:{0:0,1:1,2:2};
CQ.Ext.EventObjectImpl=function(j){if(j){this.setEvent(j.browserEvent||j)
}};
CQ.Ext.EventObjectImpl.prototype={setEvent:function(k){var j=this;
if(k==j||(k&&k.browserEvent)){return k
}j.browserEvent=k;
if(k){j.button=k.button?g[k.button]:(k.which?k.which-1:-1);
if(c.test(k.type)&&j.button==-1){j.button=0
}j.type=k.type;
j.shiftKey=k.shiftKey;
j.ctrlKey=k.ctrlKey||k.metaKey||false;
j.altKey=k.altKey;
j.keyCode=k.keyCode;
j.charCode=k.charCode;
j.target=b.getTarget(k);
j.xy=b.getXY(k)
}else{j.button=-1;
j.shiftKey=false;
j.ctrlKey=false;
j.altKey=false;
j.keyCode=0;
j.charCode=0;
j.target=null;
j.xy=[0,0]
}return j
},stopEvent:function(){var j=this;
if(j.browserEvent){if(j.browserEvent.type=="mousedown"){CQ.Ext.EventManager.stoppedMouseDownEvent.fire(j)
}b.stopEvent(j.browserEvent)
}},preventDefault:function(){if(this.browserEvent){b.preventDefault(this.browserEvent)
}},stopPropagation:function(){var j=this;
if(j.browserEvent){if(j.browserEvent.type=="mousedown"){CQ.Ext.EventManager.stoppedMouseDownEvent.fire(j)
}b.stopPropagation(j.browserEvent)
}},getCharCode:function(){return this.charCode||this.keyCode
},getKey:function(){return this.normalizeKey(this.keyCode||this.charCode)
},normalizeKey:function(j){return CQ.Ext.isSafari?(a[j]||j):j
},getPageX:function(){return this.xy[0]
},getPageY:function(){return this.xy[1]
},getXY:function(){return this.xy
},getTarget:function(k,m,j){return k?CQ.Ext.fly(this.target).findParent(k,m,j):(j?CQ.Ext.get(this.target):this.target)
},getRelatedTarget:function(){return this.browserEvent?b.getRelatedTarget(this.browserEvent):null
},getWheelDelta:function(){var j=this.browserEvent;
var k=0;
if(j.wheelDelta){k=j.wheelDelta/120
}else{if(j.detail){k=-j.detail/3
}}return k
},within:function(m,n,j){if(m){var k=this[n?"getRelatedTarget":"getTarget"]();
return k&&((j?(k==CQ.Ext.getDom(m)):false)||CQ.Ext.fly(m).contains(k))
}return false
}};
return new CQ.Ext.EventObjectImpl()
}();
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.Loader=CQ.Ext.apply({},{load:function(o,n,q,c){var q=q||this,k=document.getElementsByTagName("head")[0],b=document.createDocumentFragment(),a=o.length,m=0,j=this;
var r=function(t){k.appendChild(j.buildScriptTag(o[t],g))
};
var g=function(){m++;
if(a==m&&typeof n=="function"){n.call(q)
}else{if(c===true){r(m)
}}};
if(c===true){r.call(this,0)
}else{CQ.Ext.each(o,function(u,t){b.appendChild(this.buildScriptTag(u,g))
},this);
k.appendChild(b)
}},buildScriptTag:function(b,c){var a=document.createElement("script");
a.type="text/javascript";
a.src=b;
if(a.readyState){a.onreadystatechange=function(){if(a.readyState=="loaded"||a.readyState=="complete"){a.onreadystatechange=null;
c()
}}
}else{a.onload=c
}return a
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.ns("CQ.Ext.grid","CQ.Ext.list","CQ.Ext.dd","CQ.Ext.tree","CQ.Ext.form","CQ.Ext.menu","CQ.Ext.state","CQ.Ext.layout.boxOverflow","CQ.Ext.app","CQ.Ext.ux","CQ.Ext.chart","CQ.Ext.direct","CQ.Ext.slider");
CQ.Ext.apply(CQ.Ext,function(){var c=CQ.Ext,a=0,b=null;
return{emptyFn:function(){},BLANK_IMAGE_URL:CQ.Ext.isIE6||CQ.Ext.isIE7||CQ.Ext.isAir?"http://www.extjs.com/s.gif":"data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",extendX:function(g,j){return CQ.Ext.extend(g,j(g.prototype))
},getDoc:function(){return CQ.Ext.get(document)
},num:function(j,g){j=Number(CQ.Ext.isEmpty(j)||CQ.Ext.isArray(j)||typeof j=="boolean"||(typeof j=="string"&&j.trim().length==0)?NaN:j);
return isNaN(j)?g:j
},value:function(k,g,j){return CQ.Ext.isEmpty(k,j)?g:k
},escapeRe:function(g){return g.replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")
},sequence:function(m,g,k,j){m[g]=m[g].createSequence(k,j)
},addBehaviors:function(n){if(!CQ.Ext.isReady){CQ.Ext.onReady(function(){CQ.Ext.addBehaviors(n)
})
}else{var j={},m,g,k;
for(g in n){if((m=g.split("@"))[1]){k=m[0];
if(!j[k]){j[k]=CQ.Ext.select(k)
}j[k].on(m[1],n[g])
}}j=null
}},getScrollBarWidth:function(k){if(!CQ.Ext.isReady){return 0
}if(k===true||b===null){var n=CQ.Ext.getBody().createChild('<div class="x-hide-offsets" style="width:100px;height:50px;overflow:hidden;"><div style="height:200px;"></div></div>'),m=n.child("div",true);
var j=m.offsetWidth;
n.setStyle("overflow",(CQ.Ext.isWebKit||CQ.Ext.isGecko)?"auto":"scroll");
var g=m.offsetWidth;
n.remove();
b=j-g+2
}return b
},combine:function(){var k=arguments,j=k.length,n=[];
for(var m=0;
m<j;
m++){var g=k[m];
if(CQ.Ext.isArray(g)){n=n.concat(g)
}else{if(g.length!==undefined&&!g.substr){n=n.concat(Array.prototype.slice.call(g,0))
}else{n.push(g)
}}}return n
},copyTo:function(g,j,k){if(typeof k=="string"){k=k.split(/[,;\s]/)
}CQ.Ext.each(k,function(m){if(j.hasOwnProperty(m)){g[m]=j[m]
}},this);
return g
},destroy:function(){CQ.Ext.each(arguments,function(g){if(g){if(CQ.Ext.isArray(g)){this.destroy.apply(this,g)
}else{if(typeof g.destroy=="function"){g.destroy()
}else{if(g.dom){g.remove()
}}}}},this)
},destroyMembers:function(r,n,k,m){for(var q=1,j=arguments,g=j.length;
q<g;
q++){CQ.Ext.destroy(r[j[q]]);
delete r[j[q]]
}},clean:function(g){var j=[];
CQ.Ext.each(g,function(k){if(!!k){j.push(k)
}});
return j
},unique:function(g){var j=[],k={};
CQ.Ext.each(g,function(m){if(!k[m]){j.push(m)
}k[m]=true
});
return j
},flatten:function(g){var k=[];
function j(m){CQ.Ext.each(m,function(n){if(CQ.Ext.isArray(n)){j(n)
}else{k.push(n)
}});
return k
}return j(g)
},min:function(g,j){var k=g[0];
j=j||function(n,m){return n<m?-1:1
};
CQ.Ext.each(g,function(m){k=j(k,m)==-1?k:m
});
return k
},max:function(g,j){var k=g[0];
j=j||function(n,m){return n>m?1:-1
};
CQ.Ext.each(g,function(m){k=j(k,m)==1?k:m
});
return k
},mean:function(g){return g.length>0?CQ.Ext.sum(g)/g.length:undefined
},sum:function(g){var j=0;
CQ.Ext.each(g,function(k){j+=k
});
return j
},partition:function(g,j){var k=[[],[]];
CQ.Ext.each(g,function(n,o,m){k[(j&&j(n,o,m))||(!j&&n)?0:1].push(n)
});
return k
},invoke:function(g,j){var m=[],k=Array.prototype.slice.call(arguments,2);
CQ.Ext.each(g,function(n,o){if(n&&typeof n[j]=="function"){m.push(n[j].apply(n,k))
}else{m.push(undefined)
}});
return m
},pluck:function(g,k){var j=[];
CQ.Ext.each(g,function(m){j.push(m[k])
});
return j
},zip:function(){var t=CQ.Ext.partition(arguments,function(j){return typeof j!="function"
}),o=t[0],r=t[1][0],g=CQ.Ext.max(CQ.Ext.pluck(o,"length")),n=[];
for(var q=0;
q<g;
q++){n[q]=[];
if(r){n[q]=r.apply(r,CQ.Ext.pluck(o,q))
}else{for(var m=0,k=o.length;
m<k;
m++){n[q].push(o[m][q])
}}}return n
},getCmp:function(g){return CQ.Ext.ComponentMgr.get(g)
},useShims:c.isIE6||(c.isMac&&c.isGecko2),type:function(j){if(j===undefined||j===null){return false
}if(j.htmlElement){return"element"
}var g=typeof j;
if(g=="object"&&j.nodeName){switch(j.nodeType){case 1:return"element";
case 3:return(/\S/).test(j.nodeValue)?"textnode":"whitespace"
}}if(g=="object"||g=="function"){switch(j.constructor){case Array:return"array";
case RegExp:return"regexp";
case Date:return"date"
}if(typeof j.length=="number"&&typeof j.item=="function"){return"nodelist"
}}return g
},intercept:function(m,g,k,j){m[g]=m[g].createInterceptor(k,j)
},callback:function(g,m,k,j){if(typeof g=="function"){if(j){g.defer(j,m,k||[])
}else{g.apply(m,k||[])
}}}}
}());
CQ.Ext.apply(Function.prototype,{createSequence:function(b,a){var c=this;
return(typeof b!="function")?this:function(){var g=c.apply(this||window,arguments);
b.apply(a||this||window,arguments);
return g
}
}});
CQ.Ext.applyIf(String,{escape:function(a){return a.replace(/('|\\)/g,"\\$1")
},leftPad:function(g,b,c){var a=String(g);
if(!c){c=" "
}while(a.length<b){a=c+a
}return a
}});
String.prototype.toggle=function(b,a){return this==b?a:b
};
String.prototype.trim=function(){var a=/^\s+|\s+$/g;
return function(){return this.replace(a,"")
}
}();
Date.prototype.getElapsed=function(a){return Math.abs((a||new Date()).getTime()-this.getTime())
};
CQ.Ext.applyIf(Number.prototype,{constrain:function(b,a){return Math.min(Math.max(this,b),a)
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.lib.Dom.getRegion=function(a){return CQ.Ext.lib.Region.getRegion(a)
};
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.lib.Region=function(g,k,a,c){var j=this;
j.top=g;
j[1]=g;
j.right=k;
j.bottom=a;
j.left=c;
j[0]=c
};
CQ.Ext.lib.Region.prototype={contains:function(b){var a=this;
return(b.left>=a.left&&b.right<=a.right&&b.top>=a.top&&b.bottom<=a.bottom)
},getArea:function(){var a=this;
return((a.bottom-a.top)*(a.right-a.left))
},intersect:function(m){var k=this,g=Math.max(k.top,m.top),j=Math.min(k.right,m.right),a=Math.min(k.bottom,m.bottom),c=Math.max(k.left,m.left);
if(a>=g&&j>=c){return new CQ.Ext.lib.Region(g,j,a,c)
}},union:function(m){var k=this,g=Math.min(k.top,m.top),j=Math.max(k.right,m.right),a=Math.max(k.bottom,m.bottom),c=Math.min(k.left,m.left);
return new CQ.Ext.lib.Region(g,j,a,c)
},constrainTo:function(b){var a=this;
a.top=a.top.constrain(b.top,b.bottom);
a.bottom=a.bottom.constrain(b.top,b.bottom);
a.left=a.left.constrain(b.left,b.right);
a.right=a.right.constrain(b.left,b.right);
return a
},adjust:function(g,c,a,k){var j=this;
j.top+=g;
j.left+=c;
j.right+=k;
j.bottom+=a;
return j
}};
CQ.Ext.lib.Region.getRegion=function(j){var m=CQ.Ext.lib.Dom.getXY(j),g=m[1],k=m[0]+j.offsetWidth,a=m[1]+j.offsetHeight,c=m[0];
return new CQ.Ext.lib.Region(g,k,a,c)
};
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.lib.Point=function(a,c){if(CQ.Ext.isArray(a)){c=a[1];
a=a[0]
}var b=this;
b.x=b.right=b.left=b[0]=a;
b.y=b.top=b.bottom=b[1]=c
};
CQ.Ext.lib.Point.prototype=new CQ.Ext.lib.Region();
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.apply(CQ.Ext.DomHelper,function(){var j,a="afterbegin",m="afterend",n="beforebegin",g="beforeend",b=/tag|children|cn|html$/i;
function k(u,w,v,x,t,q){u=CQ.Ext.getDom(u);
var r;
if(j.useDom){r=c(w,null);
if(q){u.appendChild(r)
}else{(t=="firstChild"?u:u.parentNode).insertBefore(r,u[t]||u)
}}else{r=CQ.Ext.DomHelper.insertHtml(x,u,CQ.Ext.DomHelper.createHtml(w))
}return v?CQ.Ext.get(r,true):r
}function c(q,x){var r,A=document,v,y,t,z;
if(CQ.Ext.isArray(q)){r=A.createDocumentFragment();
for(var w=0,u=q.length;
w<u;
w++){c(q[w],r)
}}else{if(typeof q=="string"){r=A.createTextNode(q)
}else{r=A.createElement(q.tag||"div");
v=!!r.setAttribute;
for(var y in q){if(!b.test(y)){t=q[y];
if(y=="cls"){r.className=t
}else{if(v){r.setAttribute(y,t)
}else{r[y]=t
}}}}CQ.Ext.DomHelper.applyStyles(r,q.style);
if((z=q.children||q.cn)){c(z,r)
}else{if(q.html){r.innerHTML=q.html
}}}}if(x){x.appendChild(r)
}return r
}j={createTemplate:function(r){var q=CQ.Ext.DomHelper.createHtml(r);
return new CQ.Ext.Template(q)
},useDom:false,insertBefore:function(q,t,r){return k(q,t,r,n)
},insertAfter:function(q,t,r){return k(q,t,r,m,"nextSibling")
},insertFirst:function(q,t,r){return k(q,t,r,a,"firstChild")
},append:function(q,t,r){if(CQ.Util.isRoot(q)){q=CQ.Util.getRoot()
}return k(q,t,r,g,"",true)
},createDom:c};
return j
}());
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.apply(CQ.Ext.Template.prototype,{disableFormats:false,re:/\{([\w\-]+)(?:\:([\w\.]*)(?:\((.*?)?\))?)?\}/g,argsRe:/^\s*['"](.*)["']\s*$/,compileARe:/\\/g,compileBRe:/(\r\n|\n)/g,compileCRe:/'/g,applyTemplate:function(b){var k=this,a=k.disableFormats!==true,j=CQ.Ext.util.Format,c=k;
if(k.compiled){return k.compiled(b)
}function g(o,r,v,q){if(v&&a){if(v.substr(0,5)=="this."){return c.call(v.substr(5),b[r],b)
}else{if(q){var u=k.argsRe;
q=q.split(",");
for(var t=0,n=q.length;
t<n;
t++){q[t]=q[t].replace(u,"$1")
}q=[b[r]].concat(q)
}else{q=[b[r]]
}return j[v].apply(j,q)
}}else{return b[r]!==undefined?b[r]:""
}}return k.html.replace(k.re,g)
},compile:function(){var me=this,fm=CQ.Ext.util.Format,useF=me.disableFormats!==true,sep=CQ.Ext.isGecko?"+":",",body;
function fn(m,name,format,args){if(format&&useF){args=args?","+args:"";
if(format.substr(0,5)!="this."){format="fm."+format+"("
}else{format='this.call("'+format.substr(5)+'", ';
args=", values"
}}else{args="";
format="(values['"+name+"'] == undefined ? '' : "
}return"'"+sep+format+"values['"+name+"']"+args+")"+sep+"'"
}if(CQ.Ext.isGecko){body="this.compiled = function(values){ return '"+me.html.replace(me.compileARe,"\\\\").replace(me.compileBRe,"\\n").replace(me.compileCRe,"\\'").replace(me.re,fn)+"';};"
}else{body=["this.compiled = function(values){ return ['"];
body.push(me.html.replace(me.compileARe,"\\\\").replace(me.compileBRe,"\\n").replace(me.compileCRe,"\\'").replace(me.re,fn));
body.push("'].join('');};");
body=body.join("")
}eval(body);
return me
},call:function(c,b,a){return this[c](b,a)
}});
CQ.Ext.Template.prototype.apply=CQ.Ext.Template.prototype.applyTemplate;
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.util.Functions={createInterceptor:function(c,b,a){var g=c;
if(!CQ.Ext.isFunction(b)){return c
}else{return function(){var k=this,j=arguments;
b.target=k;
b.method=c;
return(b.apply(a||k||window,j)!==false)?c.apply(k||window,j):null
}
}},createDelegate:function(c,g,b,a){if(!CQ.Ext.isFunction(c)){return c
}return function(){var k=b||arguments;
if(a===true){k=Array.prototype.slice.call(arguments,0);
k=k.concat(b)
}else{if(CQ.Ext.isNumber(a)){k=Array.prototype.slice.call(arguments,0);
var j=[a,0].concat(b);
Array.prototype.splice.apply(k,j)
}}return c.apply(g||window,k)
}
},defer:function(g,c,j,b,a){g=CQ.Ext.util.Functions.createDelegate(g,j,b,a);
if(c>0){return setTimeout(g,c)
}g();
return 0
},createSequence:function(c,b,a){if(!CQ.Ext.isFunction(b)){return c
}else{return function(){var g=c.apply(this||window,arguments);
b.apply(a||this||window,arguments);
return g
}
}}};
CQ.Ext.defer=CQ.Ext.util.Functions.defer;
CQ.Ext.createInterceptor=CQ.Ext.util.Functions.createInterceptor;
CQ.Ext.createSequence=CQ.Ext.util.Functions.createSequence;
CQ.Ext.createDelegate=CQ.Ext.util.Functions.createDelegate;
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.apply(CQ.Ext.util.Observable.prototype,function(){function a(n){var m=(this.methodEvents=this.methodEvents||{})[n],g,c,j,k=this;
if(!m){this.methodEvents[n]=m={};
m.originalFn=this[n];
m.methodName=n;
m.before=[];
m.after=[];
var b=function(r,q,o){if((c=r.apply(q||k,o))!==undefined){if(typeof c=="object"){if(c.returnValue!==undefined){g=c.returnValue
}else{g=c
}j=!!c.cancel
}else{if(c===false){j=true
}else{g=c
}}}};
this[n]=function(){var r=Array.prototype.slice.call(arguments,0),q;
g=c=undefined;
j=false;
for(var t=0,o=m.before.length;
t<o;
t++){q=m.before[t];
b(q.fn,q.scope,r);
if(j){return g
}}if((c=m.originalFn.apply(k,r))!==undefined){g=c
}for(var t=0,o=m.after.length;
t<o;
t++){q=m.after[t];
b(q.fn,q.scope,r);
if(j){return g
}}return g
}
}return m
}return{beforeMethod:function(g,c,b){a.call(this,g).before.push({fn:c,scope:b})
},afterMethod:function(g,c,b){a.call(this,g).after.push({fn:c,scope:b})
},removeMethodListener:function(m,j,g){var k=this.getMethodEvent(m);
for(var c=0,b=k.before.length;
c<b;
c++){if(k.before[c].fn==j&&k.before[c].scope==g){k.before.splice(c,1);
return
}}for(var c=0,b=k.after.length;
c<b;
c++){if(k.after[c].fn==j&&k.after[c].scope==g){k.after.splice(c,1);
return
}}},relayEvents:function(n,j){var m=this;
function k(o){return function(){return m.fireEvent.apply(m,[o].concat(Array.prototype.slice.call(arguments,0)))
}
}for(var g=0,b=j.length;
g<b;
g++){var c=j[g];
m.events[c]=m.events[c]||true;
n.on(c,k(c),m)
}},enableBubble:function(j){var k=this;
if(!CQ.Ext.isEmpty(j)){j=CQ.Ext.isArray(j)?j:Array.prototype.slice.call(arguments,0);
for(var g=0,b=j.length;
g<b;
g++){var c=j[g];
c=c.toLowerCase();
var m=k.events[c]||true;
if(typeof m=="boolean"){m=new CQ.Ext.util.Event(k,c);
k.events[c]=m
}m.bubble=true
}}}}
}());
CQ.Ext.util.Observable.capture=function(c,b,a){c.fireEvent=c.fireEvent.createInterceptor(b,a)
};
CQ.Ext.util.Observable.observeClass=function(b,a){if(b){if(!b.fireEvent){CQ.Ext.apply(b,new CQ.Ext.util.Observable());
CQ.Ext.util.Observable.capture(b.prototype,b.fireEvent,b)
}if(typeof a=="object"){b.on(a)
}return b
}};
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.apply(CQ.Ext.EventManager,function(){var g,q,k,b,a=CQ.Ext.lib.Dom,o=/^(?:scope|delay|buffer|single|stopEvent|preventDefault|stopPropagation|normalized|args|delegate)$/,c=CQ.Ext.EventManager._unload,n=0,m=0,j=CQ.Ext.isWebKit?CQ.Ext.num(navigator.userAgent.match(/AppleWebKit\/(\d+)/)[1])>=525:!((CQ.Ext.isGecko&&!CQ.Ext.isWindows)||CQ.Ext.isOpera);
return{_unload:function(){CQ.Ext.EventManager.un(window,"resize",this.fireWindowResize,this);
c.call(CQ.Ext.EventManager)
},doResizeEvent:function(){var t=a.getViewHeight(),r=a.getViewWidth();
if(m!=t||n!=r){g.fire(n=r,m=t)
}},onWindowResize:function(u,t,r){if(!g){g=new CQ.Ext.util.Event();
q=new CQ.Ext.util.DelayedTask(this.doResizeEvent);
CQ.Ext.EventManager.on(window,"resize",this.fireWindowResize,this)
}g.addListener(u,t,r)
},fireWindowResize:function(){if(g){q.delay(100)
}},onTextResize:function(v,u,r){if(!k){k=new CQ.Ext.util.Event();
var t=new CQ.Ext.Element(document.createElement("div"));
t.dom.className="x-text-resize";
t.dom.innerHTML="X";
t.appendTo(document.body);
b=t.dom.offsetHeight;
setInterval(function(){if(t.dom.offsetHeight!=b){k.fire(b,b=t.dom.offsetHeight)
}},this.textResizeInterval)
}k.addListener(v,u,r)
},removeResizeListener:function(t,r){if(g){g.removeListener(t,r)
}},fireResize:function(){if(g){g.fire(a.getViewWidth(),a.getViewHeight())
}},textResizeInterval:50,ieDeferSrc:false,getKeyEvent:function(){return j?"keydown":"keypress"
},useKeydown:j}
}());
CQ.Ext.EventManager.on=CQ.Ext.EventManager.addListener;
CQ.Ext.apply(CQ.Ext.EventObjectImpl.prototype,{BACKSPACE:8,TAB:9,NUM_CENTER:12,ENTER:13,RETURN:13,SHIFT:16,CTRL:17,CONTROL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGEUP:33,PAGE_DOWN:34,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINT_SCREEN:44,INSERT:45,DELETE:46,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,CONTEXT_MENU:93,NUM_ZERO:96,NUM_ONE:97,NUM_TWO:98,NUM_THREE:99,NUM_FOUR:100,NUM_FIVE:101,NUM_SIX:102,NUM_SEVEN:103,NUM_EIGHT:104,NUM_NINE:105,NUM_MULTIPLY:106,NUM_PLUS:107,NUM_MINUS:109,NUM_PERIOD:110,NUM_DIVISION:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,isNavKeyPress:function(){var b=this,a=this.normalizeKey(b.keyCode);
return(a>=33&&a<=40)||a==b.RETURN||a==b.TAB||a==b.ESC
},isSpecialKey:function(){var a=this.normalizeKey(this.keyCode);
return(this.type=="keypress"&&this.ctrlKey)||this.isNavKeyPress()||(a==this.BACKSPACE)||(a>=16&&a<=20)||(a>=44&&a<=46)
},getPoint:function(){return new CQ.Ext.lib.Point(this.xy[0],this.xy[1])
},hasModifier:function(){return((this.ctrlKey||this.altKey)||this.shiftKey)
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.Element.addMethods({swallowEvent:function(a,b){var g=this;
function c(j){j.stopPropagation();
if(b){j.preventDefault()
}}if(CQ.Ext.isArray(a)){CQ.Ext.each(a,function(j){g.on(j,c)
});
return g
}g.on(a,c);
return g
},relayEvent:function(a,b){this.on(a,function(c){b.fireEvent(a,c)
})
},clean:function(b){var g=this,j=g.dom,k=j.firstChild,c=-1;
if(CQ.Ext.Element.data(j,"isCleaned")&&b!==true){return g
}while(k){var a=k.nextSibling;
if(k.nodeType==3&&!(/\S/.test(k.nodeValue))){j.removeChild(k)
}else{k.nodeIndex=++c
}k=a
}CQ.Ext.Element.data(j,"isCleaned",true);
return g
},load:function(){var a=this.getUpdater();
a.update.apply(a,arguments);
return this
},getUpdater:function(){return this.updateManager||(this.updateManager=new CQ.Ext.Updater(this))
},update:function(html,loadScripts,callback){if(!this.dom){return this
}html=html||"";
if(loadScripts!==true){this.dom.innerHTML=html;
if(typeof callback=="function"){callback()
}return this
}var id=CQ.Ext.id(),dom=this.dom;
html+='<span id="'+id+'"></span>';
CQ.Ext.lib.Event.onAvailable(id,function(){var DOC=document,hd=DOC.getElementsByTagName("head")[0],re=/(?:<script([^>]*)?>)((\n|\r|.)*?)(?:<\/script>)/ig,srcRe=/\ssrc=([\'\"])(.*?)\1/i,typeRe=/\stype=([\'\"])(.*?)\1/i,match,attrs,srcMatch,typeMatch,el,s;
while((match=re.exec(html))){attrs=match[1];
srcMatch=attrs?attrs.match(srcRe):false;
if(srcMatch&&srcMatch[2]){s=DOC.createElement("script");
s.src=srcMatch[2];
typeMatch=attrs.match(typeRe);
if(typeMatch&&typeMatch[2]){s.type=typeMatch[2]
}hd.appendChild(s)
}else{if(match[2]&&match[2].length>0){if(window.execScript){window.execScript(match[2])
}else{window.eval(match[2])
}}}}el=DOC.getElementById(id);
if(el){CQ.Ext.removeNode(el)
}if(typeof callback=="function"){callback()
}});
dom.innerHTML=html.replace(/(?:<script.*?>)((\n|\r|.)*?)(?:<\/script>)/ig,"");
return this
},removeAllListeners:function(){this.removeAnchor();
CQ.Ext.EventManager.removeAll(this.dom);
return this
},createProxy:function(a,j,g){a=(typeof a=="object")?a:{tag:"div",cls:a};
var c=this,b=j?CQ.Ext.DomHelper.append(j,a,true):CQ.Ext.DomHelper.insertBefore(c.dom,a,true);
if(g&&c.setBox&&c.getBox){b.setBox(c.getBox())
}return b
}});
CQ.Ext.Element.prototype.getUpdateManager=CQ.Ext.Element.prototype.getUpdater;
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.Element.addMethods({getAnchorXY:function(j,t,y){j=(j||"tl").toLowerCase();
y=y||{};
var q=this,b=q.dom==document.body||q.dom==document,v=y.width||b?CQ.Ext.lib.Dom.getViewWidth():q.getWidth(),m=y.height||b?CQ.Ext.lib.Dom.getViewHeight():q.getHeight(),x,a=Math.round,c=q.getXY(),u=q.getScroll(),n=b?u.left:!t?c[0]:0,k=b?u.top:!t?c[1]:0,g={c:[a(v*0.5),a(m*0.5)],t:[a(v*0.5),0],l:[0,a(m*0.5)],r:[v,a(m*0.5)],b:[a(v*0.5),m],tl:[0,0],bl:[0,m],br:[v,m],tr:[v,0]};
x=g[j];
return[x[0]+n,x[1]+k]
},anchorTo:function(b,m,c,a,q,r){var n=this,j=n.dom,o=!CQ.Ext.isEmpty(q),g=function(){CQ.Ext.fly(j).alignTo(b,m,c,a);
CQ.Ext.callback(r,CQ.Ext.fly(j))
},k=this.getAnchor();
this.removeAnchor();
CQ.Ext.apply(k,{fn:g,scroll:o});
CQ.Ext.EventManager.onWindowResize(g,null);
if(o){CQ.Ext.EventManager.on(window,"scroll",g,null,{buffer:!isNaN(q)?q:50})
}g.call(n);
return n
},removeAnchor:function(){var b=this,a=this.getAnchor();
if(a&&a.fn){CQ.Ext.EventManager.removeResizeListener(a.fn);
if(a.scroll){CQ.Ext.EventManager.un(window,"scroll",a.fn)
}delete a.fn
}return b
},getAnchor:function(){var b=CQ.Ext.Element.data,c=this.dom;
if(!c){return
}var a=b(c,"_anchor");
if(!a){a=b(c,"_anchor",{})
}return a
},getAlignToXY:function(j,E,F){j=CQ.Ext.get(j);
if(!j||!j.dom){throw"Element.alignToXY with an element that doesn't exist"
}F=F||[0,0];
E=(!E||E=="?"?"tl-bl?":(!(/-/).test(E)&&E!==""?"tl-"+E:E||"tl-bl")).toLowerCase();
var O=this,L=O.dom,Q,P,u,t,z,J,C,A=CQ.Ext.lib.Dom.getViewWidth()-10,K=CQ.Ext.lib.Dom.getViewHeight()-10,b,k,n,q,B,D,R=document,N=R.documentElement,v=R.body,I=(N.scrollLeft||v.scrollLeft||0)+5,H=(N.scrollTop||v.scrollTop||0)+5,M=false,g="",a="",G=E.match(/^([a-z]+)-([a-z]+)(\?)?$/);
if(!G){throw"Element.alignTo with an invalid alignment "+E
}g=G[1];
a=G[2];
M=!!G[3];
Q=O.getAnchorXY(g,true);
P=j.getAnchorXY(a,false);
u=P[0]-Q[0]+F[0];
t=P[1]-Q[1]+F[1];
if(M){z=O.getWidth();
J=O.getHeight();
C=j.getRegion();
b=g.charAt(0);
k=g.charAt(g.length-1);
n=a.charAt(0);
q=a.charAt(a.length-1);
B=((b=="t"&&n=="b")||(b=="b"&&n=="t"));
D=((k=="r"&&q=="l")||(k=="l"&&q=="r"));
if(u+z>A+I){u=D?C.left-z:A+I-z
}if(u<I){u=D?C.right:I
}if(t+J>K+H){t=B?C.top-J:K+H-J
}if(t<H){t=B?C.bottom:H
}}return[u,t]
},alignTo:function(c,a,j,b){var g=this;
return g.setXY(g.getAlignToXY(c,a,j),g.preanim&&!!b?g.preanim(arguments,3):false)
},adjustForConstraints:function(c,a,b){return this.getConstrainToXY(a||document,false,b,c)||c
},getConstrainToXY:function(b,a,c,j){var g={top:0,left:0,bottom:0,right:0};
return function(m,F,q,t){m=CQ.Ext.get(m);
q=q?CQ.Ext.applyIf(q,g):g;
var E,I,D=0,C=0;
if(m.dom==document.body||m.dom==document){E=CQ.Ext.lib.Dom.getViewWidth();
I=CQ.Ext.lib.Dom.getViewHeight()
}else{E=m.dom.clientWidth;
I=m.dom.clientHeight;
if(!F){var B=m.getXY();
D=B[0];
C=B[1]
}}var A=m.getScroll();
D+=q.left+A.left;
C+=q.top+A.top;
E-=q.right;
I-=q.bottom;
var G=D+E,k=C+I,n=t||(!F?this.getXY():[this.getLeft(true),this.getTop(true)]),v=n[0],u=n[1],o=this.getConstrainOffset(),z=this.dom.offsetWidth+o,H=this.dom.offsetHeight+o;
var r=false;
if((v+z)>G){v=G-z;
r=true
}if((u+H)>k){u=k-H;
r=true
}if(v<D){v=D;
r=true
}if(u<C){u=C;
r=true
}return r?[v,u]:false
}
}(),getConstrainOffset:function(){return 0
},getCenterXY:function(){return this.getAlignToXY(document,"c-c")
},center:function(a){return this.alignTo(a||document,"c-c")
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.Element.addMethods({select:function(a,b){return CQ.Ext.Element.select(a,b,this.dom)
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.apply(CQ.Ext.Element.prototype,function(){var c=CQ.Ext.getDom,a=CQ.Ext.get,b=CQ.Ext.DomHelper;
return{insertSibling:function(n,k,m){var o=this,j,g=(k||"before").toLowerCase()=="after",q;
if(CQ.Ext.isArray(n)){q=o;
CQ.Ext.each(n,function(r){j=CQ.Ext.fly(q,"_internal").insertSibling(r,k,m);
if(g){q=j
}});
return j
}n=n||{};
if(n.nodeType||n.dom){j=o.dom.parentNode.insertBefore(c(n),g?o.dom.nextSibling:o.dom);
if(!m){j=a(j)
}}else{if(g&&!o.dom.nextSibling){j=b.append(o.dom.parentNode,n,!m)
}else{j=b[g?"insertAfter":"insertBefore"](o.dom,n,!m)
}}return j
}}
}());
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.Element.boxMarkup='<div class="{0}-tl"><div class="{0}-tr"><div class="{0}-tc"></div></div></div><div class="{0}-ml"><div class="{0}-mr"><div class="{0}-mc"></div></div></div><div class="{0}-bl"><div class="{0}-br"><div class="{0}-bc"></div></div></div>';
CQ.Ext.Element.addMethods(function(){var a="_internal",b=/(\d+\.?\d+)px/;
return{applyStyles:function(c){CQ.Ext.DomHelper.applyStyles(this.dom,c);
return this
},getStyles:function(){var c={};
CQ.Ext.each(arguments,function(g){c[g]=this.getStyle(g)
},this);
return c
},setOverflow:function(c){var g=this.dom;
if(c=="auto"&&CQ.Ext.isMac&&CQ.Ext.isGecko2){g.style.overflow="hidden";
(function(){g.style.overflow="auto"
}).defer(1)
}else{g.style.overflow=c
}},boxWrap:function(c){c=c||"x-box";
var g=CQ.Ext.get(this.insertHtml("beforeBegin","<div class='"+c+"'>"+String.format(CQ.Ext.Element.boxMarkup,c)+"</div>"));
CQ.Ext.DomQuery.selectNode("."+c+"-mc",g.dom).appendChild(this.dom);
return g
},setSize:function(j,c,g){var k=this;
if(typeof j=="object"){c=j.height;
j=j.width
}j=k.adjustWidth(j);
c=k.adjustHeight(c);
if(!g||!k.anim){k.dom.style.width=k.addUnits(j);
k.dom.style.height=k.addUnits(c)
}else{k.anim({width:{to:j},height:{to:c}},k.preanim(arguments,2))
}return k
},getComputedHeight:function(){var g=this,c=Math.max(g.dom.offsetHeight,g.dom.clientHeight);
if(!c){c=parseFloat(g.getStyle("height"))||0;
if(!g.isBorderBox()){c+=g.getFrameWidth("tb")
}}return c
},getComputedWidth:function(){var c=Math.max(this.dom.offsetWidth,this.dom.clientWidth);
if(!c){c=parseFloat(this.getStyle("width"))||0;
if(!this.isBorderBox()){c+=this.getFrameWidth("lr")
}}return c
},getFrameWidth:function(g,c){return c&&this.isBorderBox()?0:(this.getPadding(g)+this.getBorderWidth(g))
},addClassOnOver:function(c){this.hover(function(){CQ.Ext.fly(this,a).addClass(c)
},function(){CQ.Ext.fly(this,a).removeClass(c)
});
return this
},addClassOnFocus:function(c){this.on("focus",function(){CQ.Ext.fly(this,a).addClass(c)
},this.dom);
this.on("blur",function(){CQ.Ext.fly(this,a).removeClass(c)
},this.dom);
return this
},addClassOnClick:function(c){var g=this.dom;
this.on("mousedown",function(){CQ.Ext.fly(g,a).addClass(c);
var k=CQ.Ext.getDoc(),j=function(){CQ.Ext.fly(g,a).removeClass(c);
k.removeListener("mouseup",j)
};
k.on("mouseup",j)
});
return this
},getViewSize:function(){var j=document,k=this.dom,c=(k==j||k==j.body);
if(c){var g=CQ.Ext.lib.Dom;
return{width:g.getViewWidth(),height:g.getViewHeight()}
}else{return{width:k.clientWidth,height:k.clientHeight}
}},getStyleSize:function(){var m=this,c,k,o=document,q=this.dom,g=(q==o||q==o.body),j=q.style;
if(g){var n=CQ.Ext.lib.Dom;
return{width:n.getViewWidth(),height:n.getViewHeight()}
}if(j.width&&j.width!="auto"){c=parseFloat(j.width);
if(m.isBorderBox()){c-=m.getFrameWidth("lr")
}}if(j.height&&j.height!="auto"){k=parseFloat(j.height);
if(m.isBorderBox()){k-=m.getFrameWidth("tb")
}}return{width:c||m.getWidth(true),height:k||m.getHeight(true)}
},getSize:function(c){return{width:this.getWidth(c),height:this.getHeight(c)}
},repaint:function(){var c=this.dom;
this.addClass("x-repaint");
setTimeout(function(){CQ.Ext.fly(c).removeClass("x-repaint")
},1);
return this
},unselectable:function(){this.dom.unselectable="on";
return this.swallowEvent("selectstart",true).applyStyles("-moz-user-select:none;-khtml-user-select:none;").addClass("x-unselectable")
},getMargins:function(g){var j=this,c,k={t:"top",l:"left",r:"right",b:"bottom"},m={};
if(!g){for(c in j.margins){m[k[c]]=parseFloat(j.getStyle(j.margins[c]))||0
}return m
}else{return j.addStyles.call(j,g,j.margins)
}}}
}());
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.Element.addMethods({setBox:function(j,k,b){var g=this,a=j.width,c=j.height;
if((k&&!g.autoBoxAdjust)&&!g.isBorderBox()){a-=(g.getBorderWidth("lr")+g.getPadding("lr"));
c-=(g.getBorderWidth("tb")+g.getPadding("tb"))
}g.setBounds(j.x,j.y,a,c,g.animTest.call(g,arguments,b,2));
return g
},getBox:function(n,x){var q=this,B,j,v,g=q.getBorderWidth,y=q.getPadding,k,a,A,u;
if(!x){B=q.getXY()
}else{j=parseInt(q.getStyle("left"),10)||0;
v=parseInt(q.getStyle("top"),10)||0;
B=[j,v]
}var c=q.dom,z=c.offsetWidth,m=c.offsetHeight,o;
if(!n){o={x:B[0],y:B[1],0:B[0],1:B[1],width:z,height:m}
}else{k=g.call(q,"l")+y.call(q,"l");
a=g.call(q,"r")+y.call(q,"r");
A=g.call(q,"t")+y.call(q,"t");
u=g.call(q,"b")+y.call(q,"b");
o={x:B[0]+k,y:B[1]+A,0:B[0]+k,1:B[1]+A,width:z-(k+a),height:m-(A+u)}
}o.right=o.x+o.width;
o.bottom=o.y+o.height;
return o
},move:function(o,b,c){var k=this,t=k.getXY(),q=t[0],n=t[1],g=[q-b,n],r=[q+b,n],m=[q,n-b],a=[q,n+b],j={l:g,left:g,r:r,right:r,t:m,top:m,up:m,b:a,bottom:a,down:a};
o=o.toLowerCase();
k.moveTo(j[o][0],j[o][1],k.animTest.call(k,arguments,c,2))
},setLeftTop:function(g,c){var b=this,a=b.dom.style;
a.left=b.addUnits(g);
a.top=b.addUnits(c);
return b
},getRegion:function(){return CQ.Ext.lib.Dom.getRegion(this.dom)
},setBounds:function(b,k,g,a,c){var j=this;
if(!c||!j.anim){j.setSize(g,a);
j.setLocation(b,k)
}else{j.anim({points:{to:[b,k]},width:{to:j.adjustWidth(g)},height:{to:j.adjustHeight(a)}},j.preanim(arguments,4),"motion")
}return j
},setRegion:function(b,a){return this.setBounds(b.left,b.top,b.right-b.left,b.bottom-b.top,this.animTest.call(this,arguments,a,1))
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.Element.addMethods({scrollTo:function(b,g,a){var j=/top/i.test(b),c=this,k=c.dom,m;
if(!a||!c.anim){m="scroll"+(j?"Top":"Left");
k[m]=g
}else{m="scroll"+(j?"Left":"Top");
c.anim({scroll:{to:j?[k[m],g]:[g,k[m]]}},c.preanim(arguments,2),"scroll")
}return c
},scrollIntoView:function(j,n){var x=CQ.Ext.getDom(j)||CQ.Ext.getBody().dom,m=this.dom,k=this.getOffsetsTo(x),u=k[0]+x.scrollLeft,A=k[1]+x.scrollTop,y=A+m.offsetHeight,g=u+m.offsetWidth,a=x.clientHeight,v=parseInt(x.scrollTop,10),z=parseInt(x.scrollLeft,10),q=v+a,w=z+x.clientWidth;
if(m.offsetHeight>a||A<v){x.scrollTop=A
}else{if(y>q){x.scrollTop=y-a
}}x.scrollTop=x.scrollTop;
if(n!==false){if(m.offsetWidth>x.clientWidth||u<z){x.scrollLeft=u
}else{if(g>w){x.scrollLeft=g-x.clientWidth
}}x.scrollLeft=x.scrollLeft
}return this
},scrollChildIntoView:function(b,a){CQ.Ext.fly(b,"_scrollChildIntoView").scrollIntoView(this,a)
},scroll:function(q,b,g){if(!this.isScrollable()){return false
}var j=this.dom,k=j.scrollLeft,x=j.scrollTop,r=j.scrollWidth,o=j.scrollHeight,m=j.clientWidth,a=j.clientHeight,c=false,u,n={l:Math.min(k+b,r-m),r:u=Math.max(k-b,0),t:Math.max(x-b,0),b:Math.min(x+b,o-a)};
n.d=n.b;
n.u=n.t;
q=q.substr(0,1);
if((u=n[q])>-1){c=true;
this.scrollTo(q=="l"||q=="r"?"left":"top",u,this.preanim(arguments,2))
}return c
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.Element.addMethods(function(){var g="visibility",b="display",a="hidden",m="none",c="x-masked",k="x-masked-relative",j=CQ.Ext.Element.data;
return{isVisible:function(n){var o=!this.isStyle(g,a)&&!this.isStyle(b,m),q=this.dom.parentNode;
if(n!==true||!o){return o
}while(q&&!(/^body/i.test(q.tagName))){if(!CQ.Ext.fly(q,"_isVisible").isVisible()){return false
}q=q.parentNode
}return true
},isDisplayed:function(){return !this.isStyle(b,m)
},enableDisplayMode:function(n){this.setVisibilityMode(CQ.Ext.Element.DISPLAY);
if(!CQ.Ext.isEmpty(n)){j(this.dom,"originalDisplay",n)
}return this
},mask:function(o,u){var w=this,r=w.dom,v=CQ.Ext.DomHelper,t="ext-el-mask-msg",n,x;
if(!/^body/i.test(r.tagName)&&w.getStyle("position")=="static"){w.addClass(k)
}if(n=j(r,"maskMsg")){n.remove()
}if(n=j(r,"mask")){n.remove()
}x=v.append(r,{cls:"ext-el-mask"},true);
j(r,"mask",x);
w.addClass(c);
x.setDisplayed(true);
if(typeof o=="string"){var q=v.append(r,{cls:t,cn:{tag:"div"}},true);
j(r,"maskMsg",q);
q.dom.className=u?t+" "+u:t;
q.dom.firstChild.innerHTML=o;
q.setDisplayed(true);
q.center(w)
}if(CQ.Ext.isIE&&!((CQ.Ext.isIE7&&CQ.Ext.isStrict)||CQ.Ext.isIE8)&&w.getStyle("height")=="auto"){x.setSize(undefined,w.getHeight())
}return x
},unmask:function(){var q=this,r=q.dom,n=j(r,"mask"),o=j(r,"maskMsg");
if(n){if(o){o.remove();
j(r,"maskMsg",undefined)
}n.remove();
j(r,"mask",undefined);
q.removeClass([c,k])
}},isMasked:function(){var n=j(this.dom,"mask");
return n&&n.isVisible()
},createShim:function(){var n=document.createElement("iframe"),o;
n.frameBorder="0";
n.className="ext-shim";
n.src=CQ.Ext.SSL_SECURE_URL;
o=CQ.Ext.get(this.dom.parentNode.insertBefore(n,this.dom));
o.autoBoxAdjust=false;
return o
}}
}());
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.Element.addMethods({addKeyListener:function(b,g,c){var a;
if(typeof b!="object"||CQ.Ext.isArray(b)){a={key:b,fn:g,scope:c}
}else{a={key:b.key,shift:b.shift,ctrl:b.ctrl,alt:b.alt,fn:g,scope:c}
}return new CQ.Ext.KeyMap(this,a)
},addKeyMap:function(a){return new CQ.Ext.KeyMap(this,a)
}});
CQ.Ext.CompositeElementLite.importElementMethods();
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.apply(CQ.Ext.CompositeElementLite.prototype,{addElements:function(c,a){if(!c){return this
}if(typeof c=="string"){c=CQ.Ext.Element.selectorFunction(c,a)
}var b=this.elements;
CQ.Ext.each(c,function(g){b.push(CQ.Ext.get(g))
});
return this
},first:function(){return this.item(0)
},last:function(){return this.item(this.getCount()-1)
},contains:function(a){return this.indexOf(a)!=-1
},removeElement:function(g,j){var c=this,a=this.elements,b;
CQ.Ext.each(g,function(k){if((b=(a[k]||a[k=c.indexOf(k)]))){if(j){if(b.dom){b.remove()
}else{CQ.Ext.removeNode(b)
}}a.splice(k,1)
}});
return this
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.CompositeElement=CQ.Ext.extend(CQ.Ext.CompositeElementLite,{constructor:function(b,a){this.elements=[];
this.add(b,a)
},getElement:function(a){return a
},transformElement:function(a){return CQ.Ext.get(a)
}});
CQ.Ext.Element.select=function(a,g,b){var c;
if(typeof a=="string"){c=CQ.Ext.Element.selectorFunction(a,b)
}else{if(a.length!==undefined){c=a
}else{throw"Invalid selector"
}}return(g===true)?new CQ.Ext.CompositeElement(c):new CQ.Ext.CompositeElementLite(c)
};
CQ.Ext.select=CQ.Ext.Element.select;
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.UpdateManager=CQ.Ext.Updater=CQ.Ext.extend(CQ.Ext.util.Observable,function(){var b="beforeupdate",g="update",c="failure";
function a(m){var n=this;
n.transaction=null;
if(m.argument.form&&m.argument.reset){try{m.argument.form.reset()
}catch(o){}}if(n.loadScripts){n.renderer.render(n.el,m,n,k.createDelegate(n,[m]))
}else{n.renderer.render(n.el,m,n);
k.call(n,m)
}}function k(m,n,o){this.fireEvent(n||g,this.el,m);
if(CQ.Ext.isFunction(m.argument.callback)){m.argument.callback.call(m.argument.scope,this.el,CQ.Ext.isEmpty(o)?true:false,m,m.argument.options)
}}function j(m){k.call(this,m,c,!!(this.transaction=null))
}return{constructor:function(n,m){var o=this;
n=CQ.Ext.get(n);
if(!m&&n.updateManager){return n.updateManager
}o.el=n;
o.defaultUrl=null;
o.addEvents(b,g,c);
CQ.Ext.apply(o,CQ.Ext.Updater.defaults);
o.transaction=null;
o.refreshDelegate=o.refresh.createDelegate(o);
o.updateDelegate=o.update.createDelegate(o);
o.formUpdateDelegate=(o.formUpdate||function(){}).createDelegate(o);
o.renderer=o.renderer||o.getDefaultRenderer();
CQ.Ext.Updater.superclass.constructor.call(o)
},setRenderer:function(m){this.renderer=m
},getRenderer:function(){return this.renderer
},getDefaultRenderer:function(){return new CQ.Ext.Updater.BasicRenderer()
},setDefaultUrl:function(m){this.defaultUrl=m
},getEl:function(){return this.el
},update:function(n,v,w,t){var r=this,m,q;
if(r.fireEvent(b,r.el,n,v)!==false){if(CQ.Ext.isObject(n)){m=n;
n=m.url;
v=v||m.params;
w=w||m.callback;
t=t||m.discardUrl;
q=m.scope;
if(!CQ.Ext.isEmpty(m.nocache)){r.disableCaching=m.nocache
}if(!CQ.Ext.isEmpty(m.text)){r.indicatorText='<div class="loading-indicator">'+m.text+"</div>"
}if(!CQ.Ext.isEmpty(m.scripts)){r.loadScripts=m.scripts
}if(!CQ.Ext.isEmpty(m.timeout)){r.timeout=m.timeout
}}r.showLoading();
if(!t){r.defaultUrl=n
}if(CQ.Ext.isFunction(n)){n=n.call(r)
}var u=CQ.Ext.apply({},{url:n,params:(CQ.Ext.isFunction(v)&&q)?v.createDelegate(q):v,success:a,failure:j,scope:r,callback:undefined,timeout:(r.timeout*1000),disableCaching:r.disableCaching,argument:{options:m,url:n,form:null,callback:w,scope:q||window,params:v}},m);
r.transaction=CQ.Ext.Ajax.request(u)
}},formUpdate:function(q,m,o,r){var n=this;
if(n.fireEvent(b,n.el,q,m)!==false){if(CQ.Ext.isFunction(m)){m=m.call(n)
}q=CQ.Ext.getDom(q);
n.transaction=CQ.Ext.Ajax.request({form:q,url:m,success:a,failure:j,scope:n,timeout:(n.timeout*1000),argument:{url:m,form:q,callback:r,reset:o}});
n.showLoading.defer(1,n)
}},startAutoRefresh:function(n,o,r,t,m){var q=this;
if(m){q.update(o||q.defaultUrl,r,t,true)
}if(q.autoRefreshProcId){clearInterval(q.autoRefreshProcId)
}q.autoRefreshProcId=setInterval(q.update.createDelegate(q,[o||q.defaultUrl,r,t,true]),n*1000)
},stopAutoRefresh:function(){if(this.autoRefreshProcId){clearInterval(this.autoRefreshProcId);
delete this.autoRefreshProcId
}},isAutoRefreshing:function(){return !!this.autoRefreshProcId
},showLoading:function(){if(this.showLoadIndicator){this.el.dom.innerHTML=this.indicatorText
}},abort:function(){if(this.transaction){CQ.Ext.Ajax.abort(this.transaction)
}},isUpdating:function(){return this.transaction?CQ.Ext.Ajax.isLoading(this.transaction):false
},refresh:function(m){if(this.defaultUrl){this.update(this.defaultUrl,null,m,true)
}}}
}());
CQ.Ext.Updater.defaults={timeout:30,disableCaching:false,showLoadIndicator:true,indicatorText:'<div class="loading-indicator">Loading...</div>',loadScripts:false,sslBlankUrl:CQ.Ext.SSL_SECURE_URL};
CQ.Ext.Updater.updateElement=function(g,c,j,b){var a=CQ.Ext.get(g).getUpdater();
CQ.Ext.apply(a,b);
a.update(c,j,b?b.callback:null)
};
CQ.Ext.Updater.BasicRenderer=function(){};
CQ.Ext.Updater.BasicRenderer.prototype={render:function(c,a,b,g){c.update(a.responseText,b.loadScripts,g)
}};
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
(function(){Date.useStrict=false;
function b(g){var c=Array.prototype.slice.call(arguments,1);
return g.replace(/\{(\d+)\}/g,function(j,k){return c[k]
})
}Date.formatCodeToRegex=function(g,c){var j=Date.parseCodes[g];
if(j){j=typeof j=="function"?j():j;
Date.parseCodes[g]=j
}return j?CQ.Ext.applyIf({c:j.c?b(j.c,c||"{0}"):j.c},j):{g:0,c:null,s:CQ.Ext.escapeRe(g)}
};
var a=Date.formatCodeToRegex;
CQ.Ext.apply(Date,{parseFunctions:{"M$":function(g,c){var j=new RegExp("\\/Date\\(([-+])?(\\d+)(?:[+-]\\d{4})?\\)\\/");
var k=(g||"").match(j);
return k?new Date(((k[1]||"")+k[2])*1):null
}},parseRegexes:[],formatFunctions:{"M$":function(){return"\\/Date("+this.getTime()+")\\/"
}},y2kYear:50,MILLI:"ms",SECOND:"s",MINUTE:"mi",HOUR:"h",DAY:"d",MONTH:"mo",YEAR:"y",defaults:{},dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNumbers:{Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11},getShortMonthName:function(c){return Date.monthNames[c].substring(0,3)
},getShortDayName:function(c){return Date.dayNames[c].substring(0,3)
},getMonthNumber:function(c){return Date.monthNumbers[c.substring(0,1).toUpperCase()+c.substring(1,3).toLowerCase()]
},formatContainsHourInfo:(function(){var g=/(\\.)/g,c=/([gGhHisucUOPZ]|M\$)/;
return function(j){return c.test(j.replace(g,""))
}
})(),formatCodes:{d:"String.leftPad(this.getDate(), 2, '0')",D:"Date.getShortDayName(this.getDay())",j:"this.getDate()",l:"Date.dayNames[this.getDay()]",N:"(this.getDay() ? this.getDay() : 7)",S:"this.getSuffix()",w:"this.getDay()",z:"this.getDayOfYear()",W:"String.leftPad(this.getWeekOfYear(), 2, '0')",F:"Date.monthNames[this.getMonth()]",m:"String.leftPad(this.getMonth() + 1, 2, '0')",M:"Date.getShortMonthName(this.getMonth())",n:"(this.getMonth() + 1)",t:"this.getDaysInMonth()",L:"(this.isLeapYear() ? 1 : 0)",o:"(this.getFullYear() + (this.getWeekOfYear() == 1 && this.getMonth() > 0 ? +1 : (this.getWeekOfYear() >= 52 && this.getMonth() < 11 ? -1 : 0)))",Y:"String.leftPad(this.getFullYear(), 4, '0')",y:"('' + this.getFullYear()).substring(2, 4)",a:"(this.getHours() < 12 ? 'am' : 'pm')",A:"(this.getHours() < 12 ? 'AM' : 'PM')",g:"((this.getHours() % 12) ? this.getHours() % 12 : 12)",G:"this.getHours()",h:"String.leftPad((this.getHours() % 12) ? this.getHours() % 12 : 12, 2, '0')",H:"String.leftPad(this.getHours(), 2, '0')",i:"String.leftPad(this.getMinutes(), 2, '0')",s:"String.leftPad(this.getSeconds(), 2, '0')",u:"String.leftPad(this.getMilliseconds(), 3, '0')",O:"this.getGMTOffset()",P:"this.getGMTOffset(true)",T:"this.getTimezone()",Z:"(this.getTimezoneOffset() * -60)",c:function(){for(var n="Y-m-dTH:i:sP",k=[],j=0,g=n.length;
j<g;
++j){var m=n.charAt(j);
k.push(m=="T"?"'T'":Date.getFormatCode(m))
}return k.join(" + ")
},U:"Math.round(this.getTime() / 1000)"},isValid:function(r,c,q,n,j,k,g){n=n||0;
j=j||0;
k=k||0;
g=g||0;
var o=new Date(r<100?100:r,c-1,q,n,j,k,g).add(Date.YEAR,r<100?r-100:0);
return r==o.getFullYear()&&c==o.getMonth()+1&&q==o.getDate()&&n==o.getHours()&&j==o.getMinutes()&&k==o.getSeconds()&&g==o.getMilliseconds()
},parseDate:function(g,k,c){var j=Date.parseFunctions;
if(j[k]==null){Date.createParser(k)
}return j[k](g,CQ.Ext.isDefined(c)?c:Date.useStrict)
},getFormatCode:function(g){var c=Date.formatCodes[g];
if(c){c=typeof c=="function"?c():c;
Date.formatCodes[g]=c
}return c||("'"+String.escape(g)+"'")
},createFormat:function(m){var k=[],c=false,j="";
for(var g=0;
g<m.length;
++g){j=m.charAt(g);
if(!c&&j=="\\"){c=true
}else{if(c){c=false;
k.push("'"+String.escape(j)+"'")
}else{k.push(Date.getFormatCode(j))
}}}Date.formatFunctions[m]=new Function("return "+k.join("+"))
},createParser:function(){var c=["var dt, y, m, d, h, i, s, ms, o, z, zz, u, v,","def = Date.defaults,","results = String(input).match(Date.parseRegexes[{0}]);","if(results){","{1}","if(u != null){","v = new Date(u * 1000);","}else{","dt = (new Date()).clearTime();","y = CQ.Ext.num(y, CQ.Ext.num(def.y, dt.getFullYear()));","m = CQ.Ext.num(m, CQ.Ext.num(def.m - 1, dt.getMonth()));","d = CQ.Ext.num(d, CQ.Ext.num(def.d, dt.getDate()));","h  = CQ.Ext.num(h, CQ.Ext.num(def.h, dt.getHours()));","i  = CQ.Ext.num(i, CQ.Ext.num(def.i, dt.getMinutes()));","s  = CQ.Ext.num(s, CQ.Ext.num(def.s, dt.getSeconds()));","ms = CQ.Ext.num(ms, CQ.Ext.num(def.ms, dt.getMilliseconds()));","if(z >= 0 && y >= 0){","v = new Date(y < 100 ? 100 : y, 0, 1, h, i, s, ms).add(Date.YEAR, y < 100 ? y - 100 : 0);","v = !strict? v : (strict === true && (z <= 364 || (v.isLeapYear() && z <= 365))? v.add(Date.DAY, z) : null);","}else if(strict === true && !Date.isValid(y, m + 1, d, h, i, s, ms)){","v = null;","}else{","v = new Date(y < 100 ? 100 : y, m, d, h, i, s, ms).add(Date.YEAR, y < 100 ? y - 100 : 0);","}","}","}","if(v){","if(zz != null){","v = v.add(Date.SECOND, -v.getTimezoneOffset() * 60 - zz);","}else if(o){","v = v.add(Date.MINUTE, -v.getTimezoneOffset() + (sn == '+'? -1 : 1) * (hr * 60 + mn));","}","}","return v;"].join("\n");
return function(r){var j=Date.parseRegexes.length,u=1,k=[],q=[],o=false,g="",n=0,m,t;
for(;
n<r.length;
++n){g=r.charAt(n);
if(!o&&g=="\\"){o=true
}else{if(o){o=false;
q.push(String.escape(g))
}else{m=a(g,u);
u+=m.g;
q.push(m.s);
if(m.g&&m.c){if(m.calcLast){t=m.c
}else{k.push(m.c)
}}}}}if(t){k.push(t)
}Date.parseRegexes[j]=new RegExp("^"+q.join("")+"$","i");
Date.parseFunctions[r]=new Function("input","strict",b(c,j,k.join("")))
}
}(),parseCodes:{d:{g:1,c:"d = parseInt(results[{0}], 10);\n",s:"(\\d{2})"},j:{g:1,c:"d = parseInt(results[{0}], 10);\n",s:"(\\d{1,2})"},D:function(){for(var c=[],g=0;
g<7;
c.push(Date.getShortDayName(g)),++g){}return{g:0,c:null,s:"(?:"+c.join("|")+")"}
},l:function(){return{g:0,c:null,s:"(?:"+Date.dayNames.join("|")+")"}
},N:{g:0,c:null,s:"[1-7]"},S:{g:0,c:null,s:"(?:st|nd|rd|th)"},w:{g:0,c:null,s:"[0-6]"},z:{g:1,c:"z = parseInt(results[{0}], 10);\n",s:"(\\d{1,3})"},W:{g:0,c:null,s:"(?:\\d{2})"},F:function(){return{g:1,c:"m = parseInt(Date.getMonthNumber(results[{0}]), 10);\n",s:"("+Date.monthNames.join("|")+")"}
},M:function(){for(var c=[],g=0;
g<12;
c.push(Date.getShortMonthName(g)),++g){}return CQ.Ext.applyIf({s:"("+c.join("|")+")"},a("F"))
},m:{g:1,c:"m = parseInt(results[{0}], 10) - 1;\n",s:"(\\d{2})"},n:{g:1,c:"m = parseInt(results[{0}], 10) - 1;\n",s:"(\\d{1,2})"},t:{g:0,c:null,s:"(?:\\d{2})"},L:{g:0,c:null,s:"(?:1|0)"},o:function(){return a("Y")
},Y:{g:1,c:"y = parseInt(results[{0}], 10);\n",s:"(\\d{4})"},y:{g:1,c:"var ty = parseInt(results[{0}], 10);\ny = ty > Date.y2kYear ? 1900 + ty : 2000 + ty;\n",s:"(\\d{1,2})"},a:function(){return a("A")
},A:{calcLast:true,g:1,c:"if (/(am)/i.test(results[{0}])) {\nif (!h || h == 12) { h = 0; }\n} else { if (!h || h < 12) { h = (h || 0) + 12; }}",s:"(AM|PM|am|pm)"},g:function(){return a("G")
},G:{g:1,c:"h = parseInt(results[{0}], 10);\n",s:"(\\d{1,2})"},h:function(){return a("H")
},H:{g:1,c:"h = parseInt(results[{0}], 10);\n",s:"(\\d{2})"},i:{g:1,c:"i = parseInt(results[{0}], 10);\n",s:"(\\d{2})"},s:{g:1,c:"s = parseInt(results[{0}], 10);\n",s:"(\\d{2})"},u:{g:1,c:"ms = results[{0}]; ms = parseInt(ms, 10)/Math.pow(10, ms.length - 3);\n",s:"(\\d+)"},O:{g:1,c:["o = results[{0}];","var sn = o.substring(0,1),","hr = o.substring(1,3)*1 + Math.floor(o.substring(3,5) / 60),","mn = o.substring(3,5) % 60;","o = ((-12 <= (hr*60 + mn)/60) && ((hr*60 + mn)/60 <= 14))? (sn + String.leftPad(hr, 2, '0') + String.leftPad(mn, 2, '0')) : null;\n"].join("\n"),s:"([+-]\\d{4})"},P:{g:1,c:["o = results[{0}];","var sn = o.substring(0,1),","hr = o.substring(1,3)*1 + Math.floor(o.substring(4,6) / 60),","mn = o.substring(4,6) % 60;","o = ((-12 <= (hr*60 + mn)/60) && ((hr*60 + mn)/60 <= 14))? (sn + String.leftPad(hr, 2, '0') + String.leftPad(mn, 2, '0')) : null;\n"].join("\n"),s:"([+-]\\d{2}:\\d{2})"},T:{g:0,c:null,s:"[A-Z]{1,4}"},Z:{g:1,c:"zz = results[{0}] * 1;\nzz = (-43200 <= zz && zz <= 50400)? zz : null;\n",s:"([+-]?\\d{1,5})"},c:function(){var j=[],c=[a("Y",1),a("m",2),a("d",3),a("h",4),a("i",5),a("s",6),{c:"ms = results[7] || '0'; ms = parseInt(ms, 10)/Math.pow(10, ms.length - 3);\n"},{c:["if(results[8]) {","if(results[8] == 'Z'){","zz = 0;","}else if (results[8].indexOf(':') > -1){",a("P",8).c,"}else{",a("O",8).c,"}","}"].join("\n")}];
for(var k=0,g=c.length;
k<g;
++k){j.push(c[k].c)
}return{g:1,c:j.join(""),s:[c[0].s,"(?:","-",c[1].s,"(?:","-",c[2].s,"(?:","(?:T| )?",c[3].s,":",c[4].s,"(?::",c[5].s,")?","(?:(?:\\.|,)(\\d+))?","(Z|(?:[-+]\\d{2}(?::)?\\d{2}))?",")?",")?",")?"].join("")}
},U:{g:1,c:"u = parseInt(results[{0}], 10);\n",s:"(-?\\d+)"}}})
}());
CQ.Ext.apply(Date.prototype,{dateFormat:function(a){if(Date.formatFunctions[a]==null){Date.createFormat(a)
}return Date.formatFunctions[a].call(this)
},getTimezone:function(){return this.toString().replace(/^.* (?:\((.*)\)|([A-Z]{1,4})(?:[\-+][0-9]{4})?(?: -?\d+)?)$/,"$1$2").replace(/[^A-Z]/g,"")
},getGMTOffset:function(a){return(this.getTimezoneOffset()>0?"-":"+")+String.leftPad(Math.floor(Math.abs(this.getTimezoneOffset())/60),2,"0")+(a?":":"")+String.leftPad(Math.abs(this.getTimezoneOffset()%60),2,"0")
},getDayOfYear:function(){var b=0,g=this.clone(),a=this.getMonth(),c;
for(c=0,g.setDate(1),g.setMonth(0);
c<a;
g.setMonth(++c)){b+=g.getDaysInMonth()
}return b+this.getDate()-1
},getWeekOfYear:function(){var a=86400000,b=7*a;
return function(){var g=Date.UTC(this.getFullYear(),this.getMonth(),this.getDate()+3)/a,c=Math.floor(g/7),j=new Date(c*b).getUTCFullYear();
return c-Math.floor(Date.UTC(j,0,7)/b)+1
}
}(),isLeapYear:function(){var a=this.getFullYear();
return !!((a&3)==0&&(a%100||(a%400==0&&a)))
},getFirstDayOfMonth:function(){var a=(this.getDay()-(this.getDate()-1))%7;
return(a<0)?(a+7):a
},getLastDayOfMonth:function(){return this.getLastDateOfMonth().getDay()
},getFirstDateOfMonth:function(){return new Date(this.getFullYear(),this.getMonth(),1)
},getLastDateOfMonth:function(){return new Date(this.getFullYear(),this.getMonth(),this.getDaysInMonth())
},getDaysInMonth:function(){var a=[31,28,31,30,31,30,31,31,30,31,30,31];
return function(){var b=this.getMonth();
return b==1&&this.isLeapYear()?29:a[b]
}
}(),getSuffix:function(){switch(this.getDate()){case 1:case 21:case 31:return"st";
case 2:case 22:return"nd";
case 3:case 23:return"rd";
default:return"th"
}},clone:function(){return new Date(this.getTime())
},isDST:function(){return new Date(this.getFullYear(),0,1).getTimezoneOffset()!=this.getTimezoneOffset()
},clearTime:function(j){if(j){return this.clone().clearTime()
}var b=this.getDate();
this.setHours(0);
this.setMinutes(0);
this.setSeconds(0);
this.setMilliseconds(0);
if(this.getDate()!=b){for(var a=1,g=this.add(Date.HOUR,a);
g.getDate()!=b;
a++,g=this.add(Date.HOUR,a)){}this.setDate(b);
this.setHours(g.getHours())
}return this
},add:function(b,c){var g=this.clone();
if(!b||c===0){return g
}switch(b.toLowerCase()){case Date.MILLI:g.setMilliseconds(this.getMilliseconds()+c);
break;
case Date.SECOND:g.setSeconds(this.getSeconds()+c);
break;
case Date.MINUTE:g.setMinutes(this.getMinutes()+c);
break;
case Date.HOUR:g.setHours(this.getHours()+c);
break;
case Date.DAY:g.setDate(this.getDate()+c);
break;
case Date.MONTH:var a=this.getDate();
if(a>28){a=Math.min(a,this.getFirstDateOfMonth().add("mo",c).getLastDateOfMonth().getDate())
}g.setDate(a);
g.setMonth(this.getMonth()+c);
break;
case Date.YEAR:g.setFullYear(this.getFullYear()+c);
break
}return g
},between:function(c,a){var b=this.getTime();
return c.getTime()<=b&&b<=a.getTime()
}});
Date.prototype.format=Date.prototype.dateFormat;
if(CQ.Ext.isSafari&&(navigator.userAgent.match(/WebKit\/(\d+)/)[1]||NaN)<420){CQ.Ext.apply(Date.prototype,{_xMonth:Date.prototype.setMonth,_xDate:Date.prototype.setDate,setMonth:function(a){if(a<=-1){var g=Math.ceil(-a),c=Math.ceil(g/12),b=(g%12)?12-g%12:0;
this.setFullYear(this.getFullYear()-c);
return this._xMonth(b)
}else{return this._xMonth(a)
}},setDate:function(a){return this.setTime(this.getTime()-(this.getDate()-a)*86400000)
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
}CQ.Ext.util.MixedCollection=function(b,a){this.items=[];
this.map={};
this.keys=[];
this.length=0;
this.addEvents("clear","add","replace","remove","sort");
this.allowFunctions=b===true;
if(a){this.getKey=a
}CQ.Ext.util.MixedCollection.superclass.constructor.call(this)
};
CQ.Ext.extend(CQ.Ext.util.MixedCollection,CQ.Ext.util.Observable,{allowFunctions:false,add:function(b,c){if(arguments.length==1){c=arguments[0];
b=this.getKey(c)
}if(typeof b!="undefined"&&b!==null){var a=this.map[b];
if(typeof a!="undefined"){return this.replace(b,c)
}this.map[b]=c
}this.length++;
this.items.push(c);
this.keys.push(b);
this.fireEvent("add",this.length-1,c,b);
return c
},getKey:function(a){return a.id
},replace:function(c,g){if(arguments.length==1){g=arguments[0];
c=this.getKey(g)
}var a=this.map[c];
if(typeof c=="undefined"||c===null||typeof a=="undefined"){return this.add(c,g)
}var b=this.indexOfKey(c);
this.items[b]=g;
this.map[c]=g;
this.fireEvent("replace",c,a,g);
return g
},addAll:function(j){if(arguments.length>1||CQ.Ext.isArray(j)){var b=arguments.length>1?arguments:j;
for(var g=0,a=b.length;
g<a;
g++){this.add(b[g])
}}else{for(var c in j){if(this.allowFunctions||typeof j[c]!="function"){this.add(c,j[c])
}}}},each:function(j,g){var b=[].concat(this.items);
for(var c=0,a=b.length;
c<a;
c++){if(j.call(g||b[c],b[c],c,a)===false){break
}}},eachKey:function(g,c){for(var b=0,a=this.keys.length;
b<a;
b++){g.call(c||window,this.keys[b],this.items[b],b,a)
}},find:function(g,c){for(var b=0,a=this.items.length;
b<a;
b++){if(g.call(c||window,this.items[b],this.keys[b])){return this.items[b]
}}return null
},insert:function(a,b,c){if(arguments.length==2){c=arguments[1];
b=this.getKey(c)
}if(this.containsKey(b)){this.suspendEvents();
this.removeKey(b);
this.resumeEvents()
}if(a>=this.length){return this.add(b,c)
}this.length++;
this.items.splice(a,0,c);
if(typeof b!="undefined"&&b!==null){this.map[b]=c
}this.keys.splice(a,0,b);
this.fireEvent("add",a,c,b);
return c
},remove:function(a){return this.removeAt(this.indexOf(a))
},removeAt:function(a){if(a<this.length&&a>=0){this.length--;
var c=this.items[a];
this.items.splice(a,1);
var b=this.keys[a];
if(typeof b!="undefined"){delete this.map[b]
}this.keys.splice(a,1);
this.fireEvent("remove",c,b);
return c
}return false
},removeKey:function(a){return this.removeAt(this.indexOfKey(a))
},getCount:function(){return this.length
},indexOf:function(a){return this.items.indexOf(a)
},indexOfKey:function(a){return this.keys.indexOf(a)
},item:function(b){var a=this.map[b],c=a!==undefined?a:(typeof b=="number")?this.items[b]:undefined;
return typeof c!="function"||this.allowFunctions?c:null
},itemAt:function(a){return this.items[a]
},key:function(a){return this.map[a]
},contains:function(a){return this.indexOf(a)!=-1
},containsKey:function(a){return typeof this.map[a]!="undefined"
},clear:function(){this.length=0;
this.items=[];
this.keys=[];
this.map={};
this.fireEvent("clear")
},first:function(){return this.items[0]
},last:function(){return this.items[this.length-1]
},_sort:function(o,a,n){var g,j,b=String(a).toUpperCase()=="DESC"?-1:1,m=[],q=this.keys,k=this.items;
n=n||function(r,c){return r-c
};
for(g=0,j=k.length;
g<j;
g++){m[m.length]={key:q[g],value:k[g],index:g}
}m.sort(function(r,c){var t=n(r[o],c[o])*b;
if(t===0){t=(r.index<c.index?-1:1)
}return t
});
for(g=0,j=m.length;
g<j;
g++){k[g]=m[g].value;
q[g]=m[g].key
}this.fireEvent("sort",this)
},sort:function(a,b){this._sort("value",a,b)
},reorder:function(g){this.suspendEvents();
var b=this.items,c=0,k=b.length,a=[],j=[],m;
for(m in g){a[g[m]]=b[m]
}for(c=0;
c<k;
c++){if(g[c]==undefined){j.push(b[c])
}}for(c=0;
c<k;
c++){if(a[c]==undefined){a[c]=j.shift()
}}this.clear();
this.addAll(a);
this.resumeEvents();
this.fireEvent("sort",this)
},keySort:function(a,b){this._sort("key",a,b||function(g,c){var k=String(g).toUpperCase(),j=String(c).toUpperCase();
return k>j?1:(k<j?-1:0)
})
},getRange:function(j,a){var b=this.items;
if(b.length<1){return[]
}j=j||0;
a=Math.min(typeof a=="undefined"?this.length-1:a,this.length-1);
var c,g=[];
if(j<=a){for(c=j;
c<=a;
c++){g[g.length]=b[c]
}}else{for(c=j;
c>=a;
c--){g[g.length]=b[c]
}}return g
},filter:function(c,b,g,a){if(CQ.Ext.isEmpty(b,false)){return this.clone()
}b=this.createValueMatcher(b,g,a);
return this.filterBy(function(j){return j&&b.test(j[c])
})
},filterBy:function(m,j){var n=new CQ.Ext.util.MixedCollection();
n.getKey=this.getKey;
var b=this.keys,g=this.items;
for(var c=0,a=g.length;
c<a;
c++){if(m.call(j||this,g[c],b[c])){n.add(b[c],g[c])
}}return n
},findIndex:function(c,b,j,g,a){if(CQ.Ext.isEmpty(b,false)){return -1
}b=this.createValueMatcher(b,g,a);
return this.findIndexBy(function(k){return k&&b.test(k[c])
},null,j)
},findIndexBy:function(m,j,n){var b=this.keys,g=this.items;
for(var c=(n||0),a=g.length;
c<a;
c++){if(m.call(j||this,g[c],b[c])){return c
}}return -1
},createValueMatcher:function(c,j,a,b){if(!c.exec){var g=CQ.Ext.escapeRe;
c=String(c);
if(j===true){c=g(c)
}else{c="^"+g(c);
if(b===true){c+="$"
}}c=new RegExp(c,a?"":"i")
}return c
},clone:function(){var j=new CQ.Ext.util.MixedCollection();
var b=this.keys,g=this.items;
for(var c=0,a=g.length;
c<a;
c++){j.add(b[c],g[c])
}j.getKey=this.getKey;
return j
}});
CQ.Ext.util.MixedCollection.prototype.get=CQ.Ext.util.MixedCollection.prototype.item;
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.AbstractManager=CQ.Ext.extend(Object,{typeName:"type",constructor:function(a){CQ.Ext.apply(this,a||{});
this.all=new CQ.Ext.util.MixedCollection();
this.types={}
},get:function(a){return this.all.get(a)
},register:function(a){this.all.add(a)
},unregister:function(a){this.all.remove(a)
},registerType:function(b,a){this.types[b]=a;
a[this.typeName]=b
},isRegistered:function(a){return this.types[a]!==undefined
},create:function(a,g){var b=a[this.typeName]||a.type||g,c=this.types[b];
if(c==undefined){throw new Error(String.format("The '{0}' type has not been registered with this manager",b))
}return new c(a)
},onAvailable:function(g,c,b){var a=this.all;
a.on("add",function(j,k){if(k.id==g){c.call(b||k,k);
a.un("add",c,b)
}})
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.util.Format=function(){var trimRe=/^\s+|\s+$/g,stripTagsRE=/<\/?[^>]+>/gi,stripScriptsRe=/(?:<script.*?>)((\n|\r|.)*?)(?:<\/script>)/ig,nl2brRe=/\r?\n/g;
return{ellipsis:function(value,len,word){if(value&&value.length>len){if(word){var vs=value.substr(0,len-2),index=Math.max(vs.lastIndexOf(" "),vs.lastIndexOf("."),vs.lastIndexOf("!"),vs.lastIndexOf("?"));
if(index==-1||index<(len-15)){return value.substr(0,len-3)+"..."
}else{return vs.substr(0,index)+"..."
}}else{return value.substr(0,len-3)+"..."
}}return value
},undef:function(value){return value!==undefined?value:""
},defaultValue:function(value,defaultValue){return value!==undefined&&value!==""?value:defaultValue
},htmlEncode:function(value){return !value?value:String(value).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")
},htmlDecode:function(value){return !value?value:String(value).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&")
},trim:function(value){return String(value).replace(trimRe,"")
},substr:function(value,start,length){return String(value).substr(start,length)
},lowercase:function(value){return String(value).toLowerCase()
},uppercase:function(value){return String(value).toUpperCase()
},capitalize:function(value){return !value?value:value.charAt(0).toUpperCase()+value.substr(1).toLowerCase()
},call:function(value,fn){if(arguments.length>2){var args=Array.prototype.slice.call(arguments,2);
args.unshift(value);
return eval(fn).apply(window,args)
}else{return eval(fn).call(window,value)
}},usMoney:function(v){v=(Math.round((v-0)*100))/100;
v=(v==Math.floor(v))?v+".00":((v*10==Math.floor(v*10))?v+"0":v);
v=String(v);
var ps=v.split("."),whole=ps[0],sub=ps[1]?"."+ps[1]:".00",r=/(\d+)(\d{3})/;
while(r.test(whole)){whole=whole.replace(r,"$1,$2")
}v=whole+sub;
if(v.charAt(0)=="-"){return"-$"+v.substr(1)
}return"$"+v
},date:function(v,format){if(!v){return""
}if(!CQ.Ext.isDate(v)){v=new Date(Date.parse(v))
}return v.dateFormat(format||"m/d/Y")
},dateRenderer:function(format){return function(v){return CQ.Ext.util.Format.date(v,format)
}
},stripTags:function(v){return !v?v:String(v).replace(stripTagsRE,"")
},stripScripts:function(v){return !v?v:String(v).replace(stripScriptsRe,"")
},fileSize:function(size){if(size<1024){return size+" bytes"
}else{if(size<1048576){return(Math.round(((size*10)/1024))/10)+" KB"
}else{return(Math.round(((size*10)/1048576))/10)+" MB"
}}},math:function(){var fns={};
return function(v,a){if(!fns[a]){fns[a]=new Function("v","return v "+a+";")
}return fns[a](v)
}
}(),round:function(value,precision){var result=Number(value);
if(typeof precision=="number"){precision=Math.pow(10,precision);
result=Math.round(value*precision)/precision
}return result
},number:function(v,format){if(!format){return v
}v=CQ.Ext.num(v,NaN);
if(isNaN(v)){return""
}var comma=",",dec=".",i18n=false,neg=v<0;
v=Math.abs(v);
if(format.substr(format.length-2)=="/i"){format=format.substr(0,format.length-2);
i18n=true;
comma=".";
dec=","
}var hasComma=format.indexOf(comma)!=-1,psplit=(i18n?format.replace(/[^\d\,]/g,""):format.replace(/[^\d\.]/g,"")).split(dec);
if(1<psplit.length){v=v.toFixed(psplit[1].length)
}else{if(2<psplit.length){throw ("NumberFormatException: invalid format, formats should have no more than 1 period: "+format)
}else{v=v.toFixed(0)
}}var fnum=v.toString();
psplit=fnum.split(".");
if(hasComma){var cnum=psplit[0],parr=[],j=cnum.length,m=Math.floor(j/3),n=cnum.length%3||3,i;
for(i=0;
i<j;
i+=n){if(i!=0){n=3
}parr[parr.length]=cnum.substr(i,n);
m-=1
}fnum=parr.join(comma);
if(psplit[1]){fnum+=dec+psplit[1]
}}else{if(psplit[1]){fnum=psplit[0]+dec+psplit[1]
}}return(neg?"-":"")+format.replace(/[\d,?\.?]+/,fnum)
},numberRenderer:function(format){return function(v){return CQ.Ext.util.Format.number(v,format)
}
},plural:function(v,s,p){return v+" "+(v==1?s:(p?p:s+"s"))
},nl2br:function(v){return CQ.Ext.isEmpty(v)?"":v.replace(nl2brRe,"<br/>")
}}
}();
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.XTemplate=function(){CQ.Ext.XTemplate.superclass.constructor.apply(this,arguments);
var D=this,o=D.html,w=/<tpl\b[^>]*>((?:(?=([^<]+))\2|<(?!tpl\b[^>]*>))*?)<\/tpl>/,g=/^<tpl\b[^>]*?for="(.*?)"/,A=/^<tpl\b[^>]*?if="(.*?)"/,C=/^<tpl\b[^>]*?exec="(.*?)"/,x,v=0,q=[],u="values",B="parent",r="xindex",t="xcount",j="return ",c="with(values){ ";
o=["<tpl>",o,"</tpl>"].join("");
while((x=o.match(w))){var b=x[0].match(g),a=x[0].match(A),F=x[0].match(C),k=null,n=null,y=null,E=b&&b[1]?b[1]:"";
if(a){k=a&&a[1]?a[1]:null;
if(k){n=new Function(u,B,r,t,c+j+(CQ.Ext.util.Format.htmlDecode(k))+"; }")
}}if(F){k=F&&F[1]?F[1]:null;
if(k){y=new Function(u,B,r,t,c+(CQ.Ext.util.Format.htmlDecode(k))+"; }")
}}if(E){switch(E){case".":E=new Function(u,B,c+j+u+"; }");
break;
case"..":E=new Function(u,B,c+j+B+"; }");
break;
default:E=new Function(u,B,c+j+E+"; }")
}}q.push({id:v,target:E,exec:y,test:n,body:x[1]||""});
o=o.replace(x[0],"{xtpl"+v+"}");
++v
}for(var z=q.length-1;
z>=0;
--z){D.compileTpl(q[z])
}D.master=q[q.length-1];
D.tpls=q
};
CQ.Ext.extend(CQ.Ext.XTemplate,CQ.Ext.Template,{re:/\{([\w\-\.\#]+)(?:\:([\w\.]*)(?:\((.*?)?\))?)?(\s?[\+\-\*\\]\s?[\d\.\+\-\*\\\(\)]+)?\}/g,codeRe:/\{\[((?:\\\]|.|\n)*?)\]\}/g,applySubTemplate:function(a,o,n,g,c){var m=this,k,r=m.tpls[a],q,b=[];
if((r.test&&!r.test.call(m,o,n,g,c))||(r.exec&&r.exec.call(m,o,n,g,c))){return""
}q=r.target?r.target.call(m,o,n):o;
k=q.length;
n=r.target?o:n;
if(r.target&&CQ.Ext.isArray(q)){for(var j=0,k=q.length;
j<k;
j++){b[b.length]=r.compiled.call(m,q[j],n,j+1,k)
}return b.join("")
}return r.compiled.call(m,q,n,g,c)
},compileTpl:function(tpl){var fm=CQ.Ext.util.Format,useF=this.disableFormats!==true,sep=CQ.Ext.isGecko?"+":",",body;
function fn(m,name,format,args,math){if(name.substr(0,4)=="xtpl"){return"'"+sep+"this.applySubTemplate("+name.substr(4)+", values, parent, xindex, xcount)"+sep+"'"
}var v;
if(name==="."){v="values"
}else{if(name==="#"){v="xindex"
}else{if(name.indexOf(".")!=-1){v=name
}else{v="values['"+name+"']"
}}}if(math){v="("+v+math+")"
}if(format&&useF){args=args?","+args:"";
if(format.substr(0,5)!="this."){format="fm."+format+"("
}else{format='this.call("'+format.substr(5)+'", ';
args=", values"
}}else{args="";
format="("+v+" === undefined ? '' : "
}return"'"+sep+format+v+args+")"+sep+"'"
}function codeFn(m,code){return"'"+sep+"("+code.replace(/\\'/g,"'")+")"+sep+"'"
}if(CQ.Ext.isGecko){body="tpl.compiled = function(values, parent, xindex, xcount){ return '"+tpl.body.replace(/(\r\n|\n)/g,"\\n").replace(/'/g,"\\'").replace(this.re,fn).replace(this.codeRe,codeFn)+"';};"
}else{body=["tpl.compiled = function(values, parent, xindex, xcount){ return ['"];
body.push(tpl.body.replace(/(\r\n|\n)/g,"\\n").replace(/'/g,"\\'").replace(this.re,fn).replace(this.codeRe,codeFn));
body.push("'].join('');};");
body=body.join("")
}eval(body);
return this
},applyTemplate:function(a){return this.master.compiled.call(this,a,{},1,1)
},compile:function(){return this
}});
CQ.Ext.XTemplate.prototype.apply=CQ.Ext.XTemplate.prototype.applyTemplate;
CQ.Ext.XTemplate.from=function(a){a=CQ.Ext.getDom(a);
return new CQ.Ext.XTemplate(a.value||a.innerHTML)
};
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.util.CSS=function(){var g=null;
var c=document;
var b=/(-[a-z])/gi;
var a=function(j,k){return k.charAt(1).toUpperCase()
};
return{createStyleSheet:function(m,q){var k;
var j=c.getElementsByTagName("head")[0];
var o=c.createElement("style");
o.setAttribute("type","text/css");
if(q){o.setAttribute("id",q)
}if(CQ.Ext.isIE){j.appendChild(o);
k=o.styleSheet;
k.cssText=m
}else{try{o.appendChild(c.createTextNode(m))
}catch(n){o.cssText=m
}j.appendChild(o);
k=o.styleSheet?o.styleSheet:(o.sheet||c.styleSheets[c.styleSheets.length-1])
}this.cacheStyleSheet(k);
return k
},removeStyleSheet:function(k){var j=c.getElementById(k);
if(j){j.parentNode.removeChild(j)
}},swapStyleSheet:function(m,j){this.removeStyleSheet(m);
var k=c.createElement("link");
k.setAttribute("rel","stylesheet");
k.setAttribute("type","text/css");
k.setAttribute("id",m);
k.setAttribute("href",j);
c.getElementsByTagName("head")[0].appendChild(k)
},refreshCache:function(){return this.getRules(true)
},cacheStyleSheet:function(m){if(!g){g={}
}try{var o=m.cssRules||m.rules;
for(var k=o.length-1;
k>=0;
--k){g[o[k].selectorText.toLowerCase()]=o[k]
}}catch(n){}},getRules:function(k){if(g===null||k){g={};
var n=c.styleSheets;
for(var m=0,j=n.length;
m<j;
m++){try{this.cacheStyleSheet(n[m])
}catch(o){}}}return g
},getRule:function(j,m){var k=this.getRules(m);
if(!CQ.Ext.isArray(j)){return k[j.toLowerCase()]
}for(var n=0;
n<j.length;
n++){if(k[j[n]]){return k[j[n].toLowerCase()]
}}return null
},updateRule:function(j,n,m){if(!CQ.Ext.isArray(j)){var o=this.getRule(j);
if(o){o.style[n.replace(b,a)]=m;
return true
}}else{for(var k=0;
k<j.length;
k++){if(this.updateRule(j[k],n,m)){return true
}}}return false
}}
}();
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.util.ClickRepeater=CQ.Ext.extend(CQ.Ext.util.Observable,{constructor:function(b,a){this.el=CQ.Ext.get(b);
this.el.unselectable();
CQ.Ext.apply(this,a);
this.addEvents("mousedown","click","mouseup");
if(!this.disabled){this.disabled=true;
this.enable()
}if(this.handler){this.on("click",this.handler,this.scope||this)
}CQ.Ext.util.ClickRepeater.superclass.constructor.call(this)
},interval:20,delay:250,preventDefault:true,stopDefault:false,timer:0,enable:function(){if(this.disabled){this.el.on("mousedown",this.handleMouseDown,this);
if(CQ.Ext.isIE){this.el.on("dblclick",this.handleDblClick,this)
}if(this.preventDefault||this.stopDefault){this.el.on("click",this.eventOptions,this)
}}this.disabled=false
},disable:function(a){if(a||!this.disabled){clearTimeout(this.timer);
if(this.pressClass){this.el.removeClass(this.pressClass)
}CQ.Ext.getDoc().un("mouseup",this.handleMouseUp,this);
this.el.removeAllListeners()
}this.disabled=true
},setDisabled:function(a){this[a?"disable":"enable"]()
},eventOptions:function(a){if(this.preventDefault){a.preventDefault()
}if(this.stopDefault){a.stopEvent()
}},destroy:function(){this.disable(true);
CQ.Ext.destroy(this.el);
this.purgeListeners()
},handleDblClick:function(a){clearTimeout(this.timer);
this.el.blur();
this.fireEvent("mousedown",this,a);
this.fireEvent("click",this,a)
},handleMouseDown:function(a){clearTimeout(this.timer);
this.el.blur();
if(this.pressClass){this.el.addClass(this.pressClass)
}this.mousedownTime=new Date();
CQ.Ext.getDoc().on("mouseup",this.handleMouseUp,this);
this.el.on("mouseout",this.handleMouseOut,this);
this.fireEvent("mousedown",this,a);
this.fireEvent("click",this,a);
if(this.accelerate){this.delay=400
}this.timer=this.click.defer(this.delay||this.interval,this,[a])
},click:function(a){this.fireEvent("click",this,a);
this.timer=this.click.defer(this.accelerate?this.easeOutExpo(this.mousedownTime.getElapsed(),400,-390,12000):this.interval,this,[a])
},easeOutExpo:function(g,a,k,j){return(g==j)?a+k:k*(-Math.pow(2,-10*g/j)+1)+a
},handleMouseOut:function(){clearTimeout(this.timer);
if(this.pressClass){this.el.removeClass(this.pressClass)
}this.el.on("mouseover",this.handleMouseReturn,this)
},handleMouseReturn:function(){this.el.un("mouseover",this.handleMouseReturn,this);
if(this.pressClass){this.el.addClass(this.pressClass)
}this.click()
},handleMouseUp:function(a){clearTimeout(this.timer);
this.el.un("mouseover",this.handleMouseReturn,this);
this.el.un("mouseout",this.handleMouseOut,this);
CQ.Ext.getDoc().un("mouseup",this.handleMouseUp,this);
this.el.removeClass(this.pressClass);
this.fireEvent("mouseup",this,a)
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.KeyNav=function(b,a){this.el=CQ.Ext.get(b);
CQ.Ext.apply(this,a);
if(!this.disabled){this.disabled=true;
this.enable()
}};
CQ.Ext.KeyNav.prototype={disabled:false,defaultEventAction:"stopEvent",forceKeyDown:false,relay:function(c){var a=c.getKey(),b=this.keyToHandler[a];
if(b&&this[b]){if(this.doRelay(c,this[b],b)!==true){c[this.defaultEventAction]()
}}},doRelay:function(c,b,a){return b.call(this.scope||this,c,a)
},enter:false,left:false,right:false,up:false,down:false,tab:false,esc:false,pageUp:false,pageDown:false,del:false,home:false,end:false,space:false,keyToHandler:{37:"left",39:"right",38:"up",40:"down",33:"pageUp",34:"pageDown",46:"del",36:"home",35:"end",13:"enter",27:"esc",9:"tab",32:"space"},stopKeyUp:function(b){var a=b.getKey();
if(a>=37&&a<=40){b.stopEvent()
}},destroy:function(){this.disable()
},enable:function(){if(this.disabled){if(CQ.Ext.isSafari2){this.el.on("keyup",this.stopKeyUp,this)
}this.el.on(this.isKeydown()?"keydown":"keypress",this.relay,this);
this.disabled=false
}},disable:function(){if(!this.disabled){if(CQ.Ext.isSafari2){this.el.un("keyup",this.stopKeyUp,this)
}this.el.un(this.isKeydown()?"keydown":"keypress",this.relay,this);
this.disabled=true
}},setDisabled:function(a){this[a?"disable":"enable"]()
},isKeydown:function(){return this.forceKeyDown||CQ.Ext.EventManager.useKeydown
}};
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.KeyMap=function(c,b,a){this.el=CQ.Ext.get(c);
this.eventName=a||"keydown";
this.bindings=[];
if(b){this.addBinding(b)
}this.enable()
};
CQ.Ext.KeyMap.prototype={stopEvent:false,addBinding:function(b){if(CQ.Ext.isArray(b)){CQ.Ext.each(b,function(j){this.addBinding(j)
},this);
return
}var q=b.key,m=b.fn||b.handler,r=b.scope;
if(b.stopEvent){this.stopEvent=b.stopEvent
}if(typeof q=="string"){var n=[];
var k=q.toUpperCase();
for(var c=0,g=k.length;
c<g;
c++){n.push(k.charCodeAt(c))
}q=n
}var a=CQ.Ext.isArray(q);
var o=function(v){if(this.checkModifiers(b,v)){var t=v.getKey();
if(a){for(var u=0,j=q.length;
u<j;
u++){if(q[u]==t){if(this.stopEvent){v.stopEvent()
}m.call(r||window,t,v);
return
}}}else{if(t==q){if(this.stopEvent){v.stopEvent()
}m.call(r||window,t,v)
}}}};
this.bindings.push(o)
},checkModifiers:function(b,k){var m,g,j=["shift","ctrl","alt"];
for(var c=0,a=j.length;
c<a;
++c){g=j[c];
m=b[g];
if(!(m===undefined||(m===k[g+"Key"]))){return false
}}return true
},on:function(b,g,c){var m,a,j,k;
if(typeof b=="object"&&!CQ.Ext.isArray(b)){m=b.key;
a=b.shift;
j=b.ctrl;
k=b.alt
}else{m=b
}this.addBinding({key:m,shift:a,ctrl:j,alt:k,fn:g,scope:c})
},handleKeyDown:function(j){if(this.enabled){var c=this.bindings;
for(var g=0,a=c.length;
g<a;
g++){c[g].call(this,j)
}}},isEnabled:function(){return this.enabled
},enable:function(){if(!this.enabled){this.el.on(this.eventName,this.handleKeyDown,this);
this.enabled=true
}},disable:function(){if(this.enabled){this.el.removeListener(this.eventName,this.handleKeyDown,this);
this.enabled=false
}},setDisabled:function(a){this[a?"disable":"enable"]()
}};
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.util.TextMetrics=function(){var a;
return{measure:function(b,c,g){if(!a){a=CQ.Ext.util.TextMetrics.Instance(b,g)
}a.bind(b);
a.setFixedWidth(g||"auto");
return a.getSize(c)
},createInstance:function(b,c){return CQ.Ext.util.TextMetrics.Instance(b,c)
}}
}();
CQ.Ext.util.TextMetrics.Instance=function(b,g){var c=new CQ.Ext.Element(document.createElement("div"));
CQ.Util.getRoot().appendChild(c.dom);
c.position("absolute");
c.setLeftTop(-1000,-1000);
c.hide();
if(g){c.setWidth(g)
}var a={getSize:function(k){c.update(k);
var j=c.getSize();
c.update("");
return j
},bind:function(j){c.setStyle(CQ.Ext.fly(j).getStyles("font-size","font-style","font-weight","font-family","line-height","text-transform","letter-spacing"))
},setFixedWidth:function(j){c.setWidth(j)
},getWidth:function(j){c.dom.style.width="auto";
return this.getSize(j).width
},getHeight:function(j){return this.getSize(j).height
}};
a.bind(b);
return a
};
CQ.Ext.Element.addMethods({getTextWidth:function(c,b,a){return(CQ.Ext.util.TextMetrics.measure(this.dom,CQ.Ext.value(c,this.dom.innerHTML,true)).width).constrain(b||0,a||1000000)
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.util.Cookies={set:function(c,j){var a=arguments;
var n=arguments.length;
var b=(n>2)?a[2]:null;
var m=(n>3)?a[3]:"/";
var g=(n>4)?a[4]:null;
var k=(n>5)?a[5]:false;
document.cookie=c+"="+escape(j)+((b===null)?"":("; expires="+b.toGMTString()))+((m===null)?"":("; path="+m))+((g===null)?"":("; domain="+g))+((k===true)?"; secure":"")
},get:function(g){var b=g+"=";
var m=b.length;
var a=document.cookie.length;
var k=0;
var c=0;
while(k<a){c=k+m;
if(document.cookie.substring(k,c)==b){return CQ.Ext.util.Cookies.getCookieVal(c)
}k=document.cookie.indexOf(" ",k)+1;
if(k===0){break
}}return null
},clear:function(a){if(CQ.Ext.util.Cookies.get(a)){document.cookie=a+"=; expires=Thu, 01-Jan-70 00:00:01 GMT"
}},getCookieVal:function(b){var a=document.cookie.indexOf(";",b);
if(a==-1){a=document.cookie.length
}return unescape(document.cookie.substring(b,a))
}};
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.handleError=function(a){throw a
};
CQ.Ext.Error=function(a){this.message=(this.lang[a])?this.lang[a]:a
};
CQ.Ext.Error.prototype=new Error();
CQ.Ext.apply(CQ.Ext.Error.prototype,{lang:{},name:"CQ.Ext.Error",getName:function(){return this.name
},getMessage:function(){return this.message
},toJson:function(){return CQ.Ext.encode(this)
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
(function(){var a=CQ.Ext.EventManager;
var b=CQ.Ext.lib.Dom;
CQ.Ext.dd.DragDrop=function(j,c,g){if(j){this.init(j,c,g)
}};
CQ.Ext.dd.DragDrop.prototype={id:null,config:null,dragElId:null,handleElId:null,invalidHandleTypes:null,invalidHandleIds:null,invalidHandleClasses:null,startPageX:0,startPageY:0,groups:null,locked:false,lock:function(){this.locked=true
},moveOnly:false,unlock:function(){this.locked=false
},isTarget:true,padding:null,_domRef:null,__ygDragDrop:true,constrainX:false,constrainY:false,minX:0,maxX:0,minY:0,maxY:0,maintainOffset:false,xTicks:null,yTicks:null,primaryButtonOnly:true,available:false,hasOuterHandles:false,b4StartDrag:function(c,g){},startDrag:function(c,g){},b4Drag:function(c){},onDrag:function(c){},onDragEnter:function(c,g){},b4DragOver:function(c){},onDragOver:function(c,g){},b4DragOut:function(c){},onDragOut:function(c,g){},b4DragDrop:function(c){},onDragDrop:function(c,g){},onInvalidDrop:function(c){},b4EndDrag:function(c){},endDrag:function(c){},b4MouseDown:function(c){},onMouseDown:function(c){},onMouseUp:function(c){},onAvailable:function(){},defaultPadding:{left:0,right:0,top:0,bottom:0},constrainTo:function(o,m,v){if(CQ.Ext.isNumber(m)){m={left:m,right:m,top:m,bottom:m}
}m=m||this.defaultPadding;
var r=CQ.Ext.get(this.getEl()).getBox(),g=CQ.Ext.get(o),u=g.getScroll(),q,j=g.dom;
if(j==document.body){q={x:u.left,y:u.top,width:CQ.Ext.lib.Dom.getViewWidth(),height:CQ.Ext.lib.Dom.getViewHeight()}
}else{var t=g.getXY();
q={x:t[0],y:t[1],width:j.clientWidth,height:j.clientHeight}
}var n=r.y-q.y,k=r.x-q.x;
this.resetConstraints();
this.setXConstraint(k-(m.left||0),q.width-k-r.width-(m.right||0),this.xTickSize);
this.setYConstraint(n-(m.top||0),q.height-n-r.height-(m.bottom||0),this.yTickSize)
},getEl:function(){if(!this._domRef){this._domRef=CQ.Ext.getDom(this.id)
}return this._domRef
},getDragEl:function(){return CQ.Ext.getDom(this.dragElId)
},init:function(j,c,g){this.initTarget(j,c,g);
a.on(this.id,"mousedown",this.handleMouseDown,this)
},initTarget:function(j,c,g){this.config=g||{};
this.DDM=CQ.Ext.dd.DDM;
this.groups={};
if(typeof j!=="string"){j=CQ.Ext.id(j)
}this.id=j;
this.addToGroup((c)?c:"default");
this.handleElId=j;
this.setDragElId(j);
this.invalidHandleTypes={A:"A"};
this.invalidHandleIds={};
this.invalidHandleClasses=[];
this.applyConfig();
this.handleOnAvailable()
},applyConfig:function(){this.padding=this.config.padding||[0,0,0,0];
this.isTarget=(this.config.isTarget!==false);
this.maintainOffset=(this.config.maintainOffset);
this.primaryButtonOnly=(this.config.primaryButtonOnly!==false)
},handleOnAvailable:function(){this.available=true;
this.resetConstraints();
this.onAvailable()
},setPadding:function(j,c,k,g){if(!c&&0!==c){this.padding=[j,j,j,j]
}else{if(!k&&0!==k){this.padding=[j,c,j,c]
}else{this.padding=[j,c,k,g]
}}},setInitPosition:function(k,j){var m=this.getEl();
if(!this.DDM.verifyEl(m)){return
}var g=k||0;
var c=j||0;
var n=b.getXY(m);
this.initPageX=n[0]-g;
this.initPageY=n[1]-c;
this.lastPageX=n[0];
this.lastPageY=n[1];
this.setStartPosition(n)
},setStartPosition:function(g){var c=g||b.getXY(this.getEl());
this.deltaSetXY=null;
this.startPageX=c[0];
this.startPageY=c[1]
},addToGroup:function(c){this.groups[c]=true;
this.DDM.regDragDrop(this,c)
},removeFromGroup:function(c){if(this.groups[c]){delete this.groups[c]
}this.DDM.removeDDFromGroup(this,c)
},setDragElId:function(c){this.dragElId=c
},setHandleElId:function(c){if(typeof c!=="string"){c=CQ.Ext.id(c)
}this.handleElId=c;
this.DDM.regHandle(this.id,c)
},setOuterHandleElId:function(c){if(typeof c!=="string"){c=CQ.Ext.id(c)
}a.on(c,"mousedown",this.handleMouseDown,this);
this.setHandleElId(c);
this.hasOuterHandles=true
},unreg:function(){a.un(this.id,"mousedown",this.handleMouseDown);
this._domRef=null;
this.DDM._remove(this)
},destroy:function(){this.unreg()
},isLocked:function(){return(this.DDM.isLocked()||this.locked)
},handleMouseDown:function(j,g){if(this.primaryButtonOnly&&j.button!=0){return
}if(this.isLocked()){return
}this.DDM.refreshCache(this.groups);
var c=new CQ.Ext.lib.Point(CQ.Ext.lib.Event.getPageX(j),CQ.Ext.lib.Event.getPageY(j));
if(!this.hasOuterHandles&&!this.DDM.isOverTarget(c,this)){}else{if(this.clickValidator(j)){this.setStartPosition();
this.b4MouseDown(j);
this.onMouseDown(j);
this.DDM.handleMouseDown(j,this);
this.DDM.stopEvent(j)
}else{}}},clickValidator:function(g){var c=g.getTarget();
return(this.isValidHandleChild(c)&&(this.id==this.handleElId||this.DDM.handleWasClicked(c,this.id)))
},addInvalidHandleType:function(c){var g=c.toUpperCase();
this.invalidHandleTypes[g]=g
},addInvalidHandleId:function(c){if(typeof c!=="string"){c=CQ.Ext.id(c)
}this.invalidHandleIds[c]=c
},addInvalidHandleClass:function(c){this.invalidHandleClasses.push(c)
},removeInvalidHandleType:function(c){var g=c.toUpperCase();
delete this.invalidHandleTypes[g]
},removeInvalidHandleId:function(c){if(typeof c!=="string"){c=CQ.Ext.id(c)
}delete this.invalidHandleIds[c]
},removeInvalidHandleClass:function(g){for(var j=0,c=this.invalidHandleClasses.length;
j<c;
++j){if(this.invalidHandleClasses[j]==g){delete this.invalidHandleClasses[j]
}}},isValidHandleChild:function(k){var j=true;
var n;
try{n=k.nodeName.toUpperCase()
}catch(m){n=k.nodeName
}j=j&&!this.invalidHandleTypes[n];
j=j&&!this.invalidHandleIds[k.id];
for(var g=0,c=this.invalidHandleClasses.length;
j&&g<c;
++g){j=!CQ.Ext.fly(k).hasClass(this.invalidHandleClasses[g])
}return j
},setXTicks:function(k,c){this.xTicks=[];
this.xTickSize=c;
var j={};
for(var g=this.initPageX;
g>=this.minX;
g=g-c){if(!j[g]){this.xTicks[this.xTicks.length]=g;
j[g]=true
}}for(g=this.initPageX;
g<=this.maxX;
g=g+c){if(!j[g]){this.xTicks[this.xTicks.length]=g;
j[g]=true
}}this.xTicks.sort(this.DDM.numericSort)
},setYTicks:function(k,c){this.yTicks=[];
this.yTickSize=c;
var j={};
for(var g=this.initPageY;
g>=this.minY;
g=g-c){if(!j[g]){this.yTicks[this.yTicks.length]=g;
j[g]=true
}}for(g=this.initPageY;
g<=this.maxY;
g=g+c){if(!j[g]){this.yTicks[this.yTicks.length]=g;
j[g]=true
}}this.yTicks.sort(this.DDM.numericSort)
},setXConstraint:function(j,g,c){this.leftConstraint=j;
this.rightConstraint=g;
this.minX=this.initPageX-j;
this.maxX=this.initPageX+g;
if(c){this.setXTicks(this.initPageX,c)
}this.constrainX=true
},clearConstraints:function(){this.constrainX=false;
this.constrainY=false;
this.clearTicks()
},clearTicks:function(){this.xTicks=null;
this.yTicks=null;
this.xTickSize=0;
this.yTickSize=0
},setYConstraint:function(c,j,g){this.topConstraint=c;
this.bottomConstraint=j;
this.minY=this.initPageY-c;
this.maxY=this.initPageY+j;
if(g){this.setYTicks(this.initPageY,g)
}this.constrainY=true
},resetConstraints:function(){if(this.initPageX||this.initPageX===0){var g=(this.maintainOffset)?this.lastPageX-this.initPageX:0;
var c=(this.maintainOffset)?this.lastPageY-this.initPageY:0;
this.setInitPosition(g,c)
}else{this.setInitPosition()
}if(this.constrainX){this.setXConstraint(this.leftConstraint,this.rightConstraint,this.xTickSize)
}if(this.constrainY){this.setYConstraint(this.topConstraint,this.bottomConstraint,this.yTickSize)
}},getTick:function(o,k){if(!k){return o
}else{if(k[0]>=o){return k[0]
}else{for(var g=0,c=k.length;
g<c;
++g){var j=g+1;
if(k[j]&&k[j]>=o){var n=o-k[g];
var m=k[j]-o;
return(m>n)?k[g]:k[j]
}}return k[k.length-1]
}}},toString:function(){return("DragDrop "+this.id)
}}
})();
if(!CQ.Ext.dd.DragDropMgr){CQ.Ext.dd.DragDropMgr=function(){var a=CQ.Ext.EventManager;
return{ids:{},handleIds:{},dragCurrent:null,dragOvers:{},deltaX:0,deltaY:0,preventDefault:true,stopPropagation:true,initialized:false,locked:false,init:function(){this.initialized=true
},POINT:0,INTERSECT:1,mode:0,_execOnAll:function(g,c){for(var k in this.ids){for(var b in this.ids[k]){var m=this.ids[k][b];
if(!this.isTypeOfDD(m)){continue
}m[g].apply(m,c)
}}},_onLoad:function(){this.init();
a.on(document,"mouseup",this.handleMouseUp,this,true);
a.on(document,"mousemove",this.handleMouseMove,this,true);
a.on(window,"unload",this._onUnload,this,true);
a.on(window,"resize",this._onResize,this,true)
},_onResize:function(b){this._execOnAll("resetConstraints",[])
},lock:function(){this.locked=true
},unlock:function(){this.locked=false
},isLocked:function(){return this.locked
},locationCache:{},useCache:true,clickPixelThresh:3,clickTimeThresh:350,dragThreshMet:false,clickTimeout:null,startX:0,startY:0,regDragDrop:function(c,b){if(!this.initialized){this.init()
}if(!this.ids[b]){this.ids[b]={}
}this.ids[b][c.id]=c
},removeDDFromGroup:function(g,b){if(!this.ids[b]){this.ids[b]={}
}var c=this.ids[b];
if(c&&c[g.id]){delete c[g.id]
}},_remove:function(c){for(var b in c.groups){if(b&&this.ids[b]&&this.ids[b][c.id]){delete this.ids[b][c.id]
}}delete this.handleIds[c.id]
},regHandle:function(c,b){if(!this.handleIds[c]){this.handleIds[c]={}
}this.handleIds[c][b]=b
},isDragDrop:function(b){return(this.getDDById(b))?true:false
},getRelated:function(n,c){var m=[];
for(var k in n.groups){for(var g in this.ids[k]){var b=this.ids[k][g];
if(!this.isTypeOfDD(b)){continue
}if(!c||b.isTarget){m[m.length]=b
}}}return m
},isLegalTarget:function(k,j){var c=this.getRelated(k,true);
for(var g=0,b=c.length;
g<b;
++g){if(c[g].id==j.id){return true
}}return false
},isTypeOfDD:function(b){return(b&&b.__ygDragDrop)
},isHandle:function(c,b){return(this.handleIds[c]&&this.handleIds[c][b])
},getDDById:function(c){for(var b in this.ids){if(this.ids[b][c]){return this.ids[b][c]
}}return null
},handleMouseDown:function(g,c){if(CQ.Ext.QuickTips){CQ.Ext.QuickTips.ddDisable()
}if(this.dragCurrent){this.handleMouseUp(g)
}this.currentTarget=g.getTarget();
this.dragCurrent=c;
var b=c.getEl();
this.startX=g.getPageX();
this.startY=g.getPageY();
this.deltaX=this.startX-b.offsetLeft;
this.deltaY=this.startY-b.offsetTop;
this.dragThreshMet=false;
this.clickTimeout=setTimeout(function(){var j=CQ.Ext.dd.DDM;
j.startDrag(j.startX,j.startY)
},this.clickTimeThresh)
},startDrag:function(b,c){clearTimeout(this.clickTimeout);
if(this.dragCurrent){this.dragCurrent.b4StartDrag(b,c);
this.dragCurrent.startDrag(b,c)
}this.dragThreshMet=true
},handleMouseUp:function(b){if(CQ.Ext.QuickTips){CQ.Ext.QuickTips.ddEnable()
}if(!this.dragCurrent){return
}clearTimeout(this.clickTimeout);
if(this.dragThreshMet){this.fireEvents(b,true)
}else{}this.stopDrag(b);
this.stopEvent(b)
},stopEvent:function(b){if(this.stopPropagation){b.stopPropagation()
}if(this.preventDefault){b.preventDefault()
}},stopDrag:function(b){if(this.dragCurrent){if(this.dragThreshMet){this.dragCurrent.b4EndDrag(b);
this.dragCurrent.endDrag(b)
}this.dragCurrent.onMouseUp(b)
}this.dragCurrent=null;
this.dragOvers={}
},handleMouseMove:function(g){if(!this.dragCurrent){return true
}if(CQ.Ext.isIE&&(g.button!==0&&g.button!==1&&g.button!==2)){this.stopEvent(g);
return this.handleMouseUp(g)
}if(!this.dragThreshMet){var c=Math.abs(this.startX-g.getPageX());
var b=Math.abs(this.startY-g.getPageY());
if(c>this.clickPixelThresh||b>this.clickPixelThresh){this.startDrag(this.startX,this.startY)
}}if(this.dragThreshMet){this.dragCurrent.b4Drag(g);
this.dragCurrent.onDrag(g);
if(!this.dragCurrent.moveOnly){this.fireEvents(g,false)
}}this.stopEvent(g);
return true
},fireEvents:function(r,t){var v=this.dragCurrent;
if(!v||v.isLocked()){return
}var w=r.getPoint();
var b=[];
var j=[];
var o=[];
var m=[];
var g=[];
for(var k in this.dragOvers){var c=this.dragOvers[k];
if(!this.isTypeOfDD(c)){continue
}if(!this.isOverTarget(w,c,this.mode)){j.push(c)
}b[k]=true;
delete this.dragOvers[k]
}for(var u in v.groups){if("string"!=typeof u){continue
}for(k in this.ids[u]){var n=this.ids[u][k];
if(!this.isTypeOfDD(n)){continue
}if(n.isTarget&&!n.isLocked()&&((n!=v)||(v.ignoreSelf===false))){if(this.isOverTarget(w,n,this.mode)){if(t){m.push(n)
}else{if(!b[n.id]){g.push(n)
}else{o.push(n)
}this.dragOvers[n.id]=n
}}}}}if(this.mode){if(j.length){v.b4DragOut(r,j);
v.onDragOut(r,j)
}if(g.length){v.onDragEnter(r,g)
}if(o.length){v.b4DragOver(r,o);
v.onDragOver(r,o)
}if(m.length){v.b4DragDrop(r,m);
v.onDragDrop(r,m)
}}else{var q=0;
for(k=0,q=j.length;
k<q;
++k){v.b4DragOut(r,j[k].id);
v.onDragOut(r,j[k].id)
}for(k=0,q=g.length;
k<q;
++k){v.onDragEnter(r,g[k].id)
}for(k=0,q=o.length;
k<q;
++k){v.b4DragOver(r,o[k].id);
v.onDragOver(r,o[k].id)
}for(k=0,q=m.length;
k<q;
++k){v.b4DragDrop(r,m[k].id);
v.onDragDrop(r,m[k].id)
}}if(t&&!m.length){v.onInvalidDrop(r)
}},getBestMatch:function(g){var k=null;
var c=g.length;
if(c==1){k=g[0]
}else{for(var j=0;
j<c;
++j){var b=g[j];
if(b.cursorIsOver){k=b;
break
}else{if(!k||k.overlap.getArea()<b.overlap.getArea()){k=b
}}}}return k
},refreshCache:function(c){for(var b in c){if("string"!=typeof b){continue
}for(var g in this.ids[b]){var j=this.ids[b][g];
if(this.isTypeOfDD(j)){var k=this.getLocation(j);
if(k){this.locationCache[j.id]=k
}else{delete this.locationCache[j.id]
}}}}},verifyEl:function(c){if(c){var b;
if(CQ.Ext.isIE){try{b=c.offsetParent
}catch(g){}}else{b=c.offsetParent
}if(b){return true
}}return false
},getLocation:function(n){if(!this.isTypeOfDD(n)){return null
}var k=n.getEl(),v,j,g,x,w,y,c,u,m,q;
try{v=CQ.Ext.lib.Dom.getXY(k)
}catch(o){}if(!v){return null
}j=v[0];
g=j+k.offsetWidth;
x=v[1];
w=x+k.offsetHeight;
y=x-n.padding[0];
c=g+n.padding[1];
u=w+n.padding[2];
m=j-n.padding[3];
q=new CQ.Ext.lib.Region(y,c,u,m);
k=CQ.Ext.get(k.parentNode);
while(k&&q){if(k.isScrollable()){q=q.intersect(k.getRegion())
}k=k.parent()
}return q
},isOverTarget:function(q,b,g){var k=this.locationCache[b.id];
if(!k||!this.useCache){k=this.getLocation(b);
this.locationCache[b.id]=k
}if(!k){return false
}b.cursorIsOver=k.contains(q);
var o=this.dragCurrent;
if(!o||!o.getTargetCoord||(!g&&!o.constrainX&&!o.constrainY)){return b.cursorIsOver
}b.overlap=null;
var m=o.getTargetCoord(q.x,q.y);
var c=o.getDragEl();
var j=new CQ.Ext.lib.Region(m.y,m.x+c.offsetWidth,m.y+c.offsetHeight,m.x);
var n=j.intersect(k);
if(n){b.overlap=n;
return(g)?true:b.cursorIsOver
}else{return false
}},_onUnload:function(c,b){a.removeListener(document,"mouseup",this.handleMouseUp,this);
a.removeListener(document,"mousemove",this.handleMouseMove,this);
a.removeListener(window,"resize",this._onResize,this);
CQ.Ext.dd.DragDropMgr.unregAll()
},unregAll:function(){if(this.dragCurrent){this.stopDrag();
this.dragCurrent=null
}this._execOnAll("unreg",[]);
for(var b in this.elementCache){delete this.elementCache[b]
}this.elementCache={};
this.ids={}
},elementCache:{},getElWrapper:function(c){var b=this.elementCache[c];
if(!b||!b.el){b=this.elementCache[c]=new this.ElementWrapper(CQ.Ext.getDom(c))
}return b
},getElement:function(b){return CQ.Ext.getDom(b)
},getCss:function(c){var b=CQ.Ext.getDom(c);
return(b)?b.style:null
},ElementWrapper:function(b){this.el=b||null;
this.id=this.el&&b.id;
this.css=this.el&&b.style
},getPosX:function(b){return CQ.Ext.lib.Dom.getX(b)
},getPosY:function(b){return CQ.Ext.lib.Dom.getY(b)
},swapNode:function(g,b){if(g.swapNode){g.swapNode(b)
}else{var j=b.parentNode;
var c=b.nextSibling;
if(c==g){j.insertBefore(g,b)
}else{if(b==g.nextSibling){j.insertBefore(b,g)
}else{g.parentNode.replaceChild(b,g);
j.insertBefore(g,c)
}}}},getScroll:function(){var g,b,j=document.documentElement,c=document.body;
if(j&&(j.scrollTop||j.scrollLeft)){g=j.scrollTop;
b=j.scrollLeft
}else{if(c){g=c.scrollTop;
b=c.scrollLeft
}else{}}return{top:g,left:b}
},getStyle:function(c,b){return CQ.Ext.fly(c).getStyle(b)
},getScrollTop:function(){return this.getScroll().top
},getScrollLeft:function(){return this.getScroll().left
},moveToEl:function(b,g){var c=CQ.Ext.lib.Dom.getXY(g);
CQ.Ext.lib.Dom.setXY(b,c)
},numericSort:function(g,c){return(g-c)
},_timeoutCount:0,_addListeners:function(){var b=CQ.Ext.dd.DDM;
if(CQ.Ext.lib.Event&&document){b._onLoad()
}else{if(b._timeoutCount>2000){}else{setTimeout(b._addListeners,10);
if(document&&document.body){b._timeoutCount+=1
}}}},handleWasClicked:function(b,g){if(this.isHandle(g,b.id)){return true
}else{var c=b.parentNode;
while(c){if(this.isHandle(g,c.id)){return true
}else{c=c.parentNode
}}}return false
}}
}();
CQ.Ext.dd.DDM=CQ.Ext.dd.DragDropMgr;
CQ.Ext.dd.DDM._addListeners()
}CQ.Ext.dd.DD=function(c,a,b){if(c){this.init(c,a,b)
}};
CQ.Ext.extend(CQ.Ext.dd.DD,CQ.Ext.dd.DragDrop,{scroll:true,autoOffset:function(c,b){var a=c-this.startPageX;
var g=b-this.startPageY;
this.setDelta(a,g)
},setDelta:function(b,a){this.deltaX=b;
this.deltaY=a
},setDragElPos:function(c,b){var a=this.getDragEl();
this.alignElWithMouse(a,c,b)
},alignElWithMouse:function(c,m,k){var j=this.getTargetCoord(m,k);
var b=c.dom?c:CQ.Ext.fly(c,"_dd");
if(!this.deltaSetXY){var n=[j.x,j.y];
b.setXY(n);
var g=b.getLeft(true);
var a=b.getTop(true);
this.deltaSetXY=[g-j.x,a-j.y]
}else{b.setLeftTop(j.x+this.deltaSetXY[0],j.y+this.deltaSetXY[1])
}this.cachePosition(j.x,j.y);
this.autoScroll(j.x,j.y,c.offsetHeight,c.offsetWidth);
return j
},cachePosition:function(b,a){if(b){this.lastPageX=b;
this.lastPageY=a
}else{var c=CQ.Ext.lib.Dom.getXY(this.getEl());
this.lastPageX=c[0];
this.lastPageY=c[1]
}},autoScroll:function(q,o,j,r){if(this.scroll){var t=CQ.Ext.lib.Dom.getViewHeight();
var b=CQ.Ext.lib.Dom.getViewWidth();
var v=this.DDM.getScrollTop();
var g=this.DDM.getScrollLeft();
var n=j+o;
var u=r+q;
var m=(t+v-o-this.deltaY);
var k=(b+g-q-this.deltaX);
var c=40;
var a=(document.all)?80:30;
if(n>t&&m<c){window.scrollTo(g,v+a)
}if(o<v&&v>0&&o-v<c){window.scrollTo(g,v-a)
}if(u>b&&k<c){window.scrollTo(g+a,v)
}if(q<g&&g>0&&q-g<c){window.scrollTo(g-a,v)
}}},getTargetCoord:function(c,b){var a=c-this.deltaX;
var g=b-this.deltaY;
if(this.constrainX){if(a<this.minX){a=this.minX
}if(a>this.maxX){a=this.maxX
}}if(this.constrainY){if(g<this.minY){g=this.minY
}if(g>this.maxY){g=this.maxY
}}a=this.getTick(a,this.xTicks);
g=this.getTick(g,this.yTicks);
return{x:a,y:g}
},applyConfig:function(){CQ.Ext.dd.DD.superclass.applyConfig.call(this);
this.scroll=(this.config.scroll!==false)
},b4MouseDown:function(a){this.autoOffset(a.getPageX(),a.getPageY())
},b4Drag:function(a){this.setDragElPos(a.getPageX(),a.getPageY())
},toString:function(){return("DD "+this.id)
}});
CQ.Ext.dd.DDProxy=function(c,a,b){if(c){this.init(c,a,b);
this.initFrame()
}};
CQ.Ext.dd.DDProxy.dragElId="ygddfdiv";
CQ.Ext.extend(CQ.Ext.dd.DDProxy,CQ.Ext.dd.DD,{resizeFrame:true,centerFrame:false,createFrame:function(){var b=this;
var a=document.body;
if(!a||!a.firstChild){setTimeout(function(){b.createFrame()
},50);
return
}var g=this.getDragEl();
if(!g){g=document.createElement("div");
g.id=this.dragElId;
var c=g.style;
c.position="absolute";
c.visibility="hidden";
c.cursor="move";
c.border="2px solid #aaa";
c.zIndex=999;
CQ.Ext.DomHelper.insertFirst(CQ.Util.getRoot(),g)
}},initFrame:function(){this.createFrame()
},applyConfig:function(){CQ.Ext.dd.DDProxy.superclass.applyConfig.call(this);
this.resizeFrame=(this.config.resizeFrame!==false);
this.centerFrame=(this.config.centerFrame);
this.setDragElId(this.config.dragElId||CQ.Ext.dd.DDProxy.dragElId)
},showFrame:function(j,g){var c=this.getEl();
var a=this.getDragEl();
var b=a.style;
this._resizeProxy();
if(this.centerFrame){this.setDelta(Math.round(parseInt(b.width,10)/2),Math.round(parseInt(b.height,10)/2))
}this.setDragElPos(j,g);
CQ.Ext.fly(a).show()
},_resizeProxy:function(){if(this.resizeFrame){var a=this.getEl();
CQ.Ext.fly(this.getDragEl()).setSize(a.offsetWidth,a.offsetHeight)
}},b4MouseDown:function(b){var a=b.getPageX();
var c=b.getPageY();
this.autoOffset(a,c);
this.setDragElPos(a,c)
},b4StartDrag:function(a,b){this.showFrame(a,b)
},b4EndDrag:function(a){CQ.Ext.fly(this.getDragEl()).hide()
},endDrag:function(c){var b=this.getEl();
var a=this.getDragEl();
a.style.visibility="";
this.beforeMove();
b.style.visibility="hidden";
CQ.Ext.dd.DDM.moveToEl(b,a);
a.style.visibility="hidden";
b.style.visibility="";
this.afterDrag()
},beforeMove:function(){},afterDrag:function(){},toString:function(){return("DDProxy "+this.id)
}});
CQ.Ext.dd.DDTarget=function(c,a,b){if(c){this.initTarget(c,a,b)
}};
CQ.Ext.extend(CQ.Ext.dd.DDTarget,CQ.Ext.dd.DragDrop,{getDragEl:CQ.Ext.emptyFn,isValidHandleChild:CQ.Ext.emptyFn,startDrag:CQ.Ext.emptyFn,endDrag:CQ.Ext.emptyFn,onDrag:CQ.Ext.emptyFn,onDragDrop:CQ.Ext.emptyFn,onDragEnter:CQ.Ext.emptyFn,onDragOut:CQ.Ext.emptyFn,onDragOver:CQ.Ext.emptyFn,onInvalidDrop:CQ.Ext.emptyFn,onMouseDown:CQ.Ext.emptyFn,onMouseUp:CQ.Ext.emptyFn,setXConstraint:CQ.Ext.emptyFn,setYConstraint:CQ.Ext.emptyFn,resetConstraints:CQ.Ext.emptyFn,clearConstraints:CQ.Ext.emptyFn,clearTicks:CQ.Ext.emptyFn,setInitPosition:CQ.Ext.emptyFn,setDragElId:CQ.Ext.emptyFn,setHandleElId:CQ.Ext.emptyFn,setOuterHandleElId:CQ.Ext.emptyFn,addInvalidHandleClass:CQ.Ext.emptyFn,addInvalidHandleId:CQ.Ext.emptyFn,addInvalidHandleType:CQ.Ext.emptyFn,removeInvalidHandleClass:CQ.Ext.emptyFn,removeInvalidHandleId:CQ.Ext.emptyFn,removeInvalidHandleType:CQ.Ext.emptyFn,toString:function(){return("DDTarget "+this.id)
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.dd.DragTracker=CQ.Ext.extend(CQ.Ext.util.Observable,{active:false,tolerance:5,autoStart:false,constructor:function(a){CQ.Ext.apply(this,a);
this.addEvents("mousedown","mouseup","mousemove","dragstart","dragend","drag");
this.dragRegion=new CQ.Ext.lib.Region(0,0,0,0);
if(this.el){this.initEl(this.el)
}CQ.Ext.dd.DragTracker.superclass.constructor.call(this,a)
},initEl:function(a){this.el=CQ.Ext.get(a);
a.on("mousedown",this.onMouseDown,this,this.delegate?{delegate:this.delegate}:undefined)
},destroy:function(){this.el.un("mousedown",this.onMouseDown,this);
delete this.el
},onMouseDown:function(b,a){if(this.fireEvent("mousedown",this,b)!==false&&this.onBeforeStart(b)!==false){this.startXY=this.lastXY=b.getXY();
this.dragTarget=this.delegate?a:this.el.dom;
if(this.preventDefault!==false){b.preventDefault()
}CQ.Ext.getDoc().on({scope:this,mouseup:this.onMouseUp,mousemove:this.onMouseMove,selectstart:this.stopSelect});
if(this.autoStart){this.timer=this.triggerStart.defer(this.autoStart===true?1000:this.autoStart,this,[b])
}}},onMouseMove:function(g,c){if(this.active&&CQ.Ext.isIE&&!g.browserEvent.button){g.preventDefault();
this.onMouseUp(g);
return
}g.preventDefault();
var b=g.getXY(),a=this.startXY;
this.lastXY=b;
if(!this.active){if(Math.abs(a[0]-b[0])>this.tolerance||Math.abs(a[1]-b[1])>this.tolerance){this.triggerStart(g)
}else{return
}}this.fireEvent("mousemove",this,g);
this.onDrag(g);
this.fireEvent("drag",this,g)
},onMouseUp:function(c){var b=CQ.Ext.getDoc(),a=this.active;
b.un("mousemove",this.onMouseMove,this);
b.un("mouseup",this.onMouseUp,this);
b.un("selectstart",this.stopSelect,this);
c.preventDefault();
this.clearStart();
this.active=false;
delete this.elRegion;
this.fireEvent("mouseup",this,c);
if(a){this.onEnd(c);
this.fireEvent("dragend",this,c)
}},triggerStart:function(a){this.clearStart();
this.active=true;
this.onStart(a);
this.fireEvent("dragstart",this,a)
},clearStart:function(){if(this.timer){clearTimeout(this.timer);
delete this.timer
}},stopSelect:function(a){a.stopEvent();
return false
},onBeforeStart:function(a){},onStart:function(a){},onDrag:function(a){},onEnd:function(a){},getDragTarget:function(){return this.dragTarget
},getDragCt:function(){return this.el
},getXY:function(a){return a?this.constrainModes[a].call(this,this.lastXY):this.lastXY
},getOffset:function(c){var b=this.getXY(c),a=this.startXY;
return[a[0]-b[0],a[1]-b[1]]
},constrainModes:{point:function(b){if(!this.elRegion){this.elRegion=this.getDragCt().getRegion()
}var a=this.dragRegion;
a.left=b[0];
a.top=b[1];
a.right=b[0];
a.bottom=b[1];
a.constrainTo(this.elRegion);
return[a.left,a.top]
}}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.dd.ScrollManager=function(){var c=CQ.Ext.dd.DragDropMgr;
var j={};
var b=null;
var n={};
var m=function(r){b=null;
a()
};
var o=function(){if(c.dragCurrent){c.refreshCache(c.dragCurrent.groups)
}};
var g=function(){if(c.dragCurrent){var r=CQ.Ext.dd.ScrollManager;
var t=n.el.ddScrollConfig?n.el.ddScrollConfig.increment:r.increment;
if(!r.animate){if(n.el.scroll(n.dir,t)){o()
}}else{n.el.scroll(n.dir,t,true,r.animDuration,o)
}}};
var a=function(){if(n.id){clearInterval(n.id)
}n.id=0;
n.el=null;
n.dir=""
};
var k=function(t,r){a();
n.el=t;
n.dir=r;
var v=t.ddScrollConfig?t.ddScrollConfig.ddGroup:undefined,u=(t.ddScrollConfig&&t.ddScrollConfig.frequency)?t.ddScrollConfig.frequency:CQ.Ext.dd.ScrollManager.frequency;
if(v===undefined||c.dragCurrent.ddGroup==v){n.id=setInterval(g,u)
}};
var q=function(w,y){if(y||!c.dragCurrent){return
}var z=CQ.Ext.dd.ScrollManager;
if(!b||b!=c.dragCurrent){b=c.dragCurrent;
z.refreshCache()
}var A=CQ.Ext.lib.Event.getXY(w);
var B=new CQ.Ext.lib.Point(A[0],A[1]);
for(var u in j){var v=j[u],t=v._region;
var x=v.ddScrollConfig?v.ddScrollConfig:z;
if(t&&t.contains(B)&&v.isScrollable()){if(t.bottom-B.y<=x.vthresh){if(n.el!=v){k(v,"down")
}return
}else{if(t.right-B.x<=x.hthresh){if(n.el!=v){k(v,"left")
}return
}else{if(B.y-t.top<=x.vthresh){if(n.el!=v){k(v,"up")
}return
}else{if(B.x-t.left<=x.hthresh){if(n.el!=v){k(v,"right")
}return
}}}}}}a()
};
c.fireEvents=c.fireEvents.createSequence(q,c);
c.stopDrag=c.stopDrag.createSequence(m,c);
return{register:function(u){if(CQ.Ext.isArray(u)){for(var t=0,r=u.length;
t<r;
t++){this.register(u[t])
}}else{u=CQ.Ext.get(u);
j[u.id]=u
}},unregister:function(u){if(CQ.Ext.isArray(u)){for(var t=0,r=u.length;
t<r;
t++){this.unregister(u[t])
}}else{u=CQ.Ext.get(u);
delete j[u.id]
}},vthresh:25,hthresh:25,increment:100,frequency:500,animate:true,animDuration:0.4,ddGroup:undefined,refreshCache:function(){for(var r in j){if(typeof j[r]=="object"){j[r]._region=j[r].getRegion()
}}}}
}();
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.dd.Registry=function(){var g={};
var b={};
var a=0;
var c=function(k,j){if(typeof k=="string"){return k
}var m=k.id;
if(!m&&j!==false){m="extdd-"+(++a);
k.id=m
}return m
};
return{register:function(n,o){o=o||{};
if(typeof n=="string"){n=document.getElementById(n)
}o.ddel=n;
g[c(n)]=o;
if(o.isHandle!==false){b[o.ddel.id]=o
}if(o.handles){var m=o.handles;
for(var k=0,j=m.length;
k<j;
k++){b[c(m[k])]=o
}}},unregister:function(n){var q=c(n,false);
var o=g[q];
if(o){delete g[q];
if(o.handles){var m=o.handles;
for(var k=0,j=m.length;
k<j;
k++){delete b[c(m[k],false)]
}}}},getHandle:function(j){if(typeof j!="string"){j=j.id
}return b[j]
},getHandleFromEvent:function(k){var j=CQ.Ext.lib.Event.getTarget(k);
return j?b[j.id]:null
},getTarget:function(j){if(typeof j!="string"){j=j.id
}return g[j]
},getTargetFromEvent:function(k){var j=CQ.Ext.lib.Event.getTarget(k);
return j?g[j.id]||b[j.id]:null
}}
}();
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.dd.StatusProxy=function(a){CQ.Ext.apply(this,a);
this.id=this.id||CQ.Ext.id();
this.el=new CQ.Ext.Layer({dh:{id:this.id,tag:"div",cls:"x-dd-drag-proxy "+this.dropNotAllowed,children:[{tag:"div",cls:"x-dd-drop-icon"},{tag:"div",cls:"x-dd-drag-ghost"}]},shadow:!a||a.shadow!==false});
this.ghost=CQ.Ext.get(this.el.dom.childNodes[1]);
this.dropStatus=this.dropNotAllowed
};
CQ.Ext.dd.StatusProxy.prototype={dropAllowed:"x-dd-drop-ok",dropNotAllowed:"x-dd-drop-nodrop",setStatus:function(a){a=a||this.dropNotAllowed;
if(this.dropStatus!=a){this.el.replaceClass(this.dropStatus,a);
this.dropStatus=a
}},reset:function(a){this.el.dom.className="x-dd-drag-proxy "+this.dropNotAllowed;
this.dropStatus=this.dropNotAllowed;
if(a){this.ghost.update("")
}},update:function(a){if(typeof a=="string"){this.ghost.update(a)
}else{this.ghost.update("");
a.style.margin="0";
this.ghost.dom.appendChild(a)
}var b=this.ghost.dom.firstChild;
if(b){CQ.Ext.fly(b).setStyle("float","none")
}},getEl:function(){return this.el
},getGhost:function(){return this.ghost
},hide:function(a){this.el.hide();
if(a){this.reset(true)
}},stop:function(){if(this.anim&&this.anim.isAnimated&&this.anim.isAnimated()){this.anim.stop()
}},show:function(){this.el.show()
},sync:function(){this.el.sync()
},repair:function(b,c,a){this.callback=c;
this.scope=a;
if(b&&this.animRepair!==false){this.el.addClass("x-dd-drag-repair");
this.el.hideUnders(true);
this.anim=this.el.shift({duration:this.repairDuration||0.5,easing:"easeOut",xy:b,stopFx:true,callback:this.afterRepair,scope:this})
}else{this.afterRepair()
}},afterRepair:function(){this.hide(true);
if(typeof this.callback=="function"){this.callback.call(this.scope||this)
}this.callback=null;
this.scope=null
},destroy:function(){CQ.Ext.destroy(this.ghost,this.el)
}};
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.dd.DragSource=function(b,a){this.el=CQ.Ext.get(b);
if(!this.dragData){this.dragData={}
}CQ.Ext.apply(this,a);
if(!this.proxy){this.proxy=new CQ.Ext.dd.StatusProxy()
}CQ.Ext.dd.DragSource.superclass.constructor.call(this,this.el.dom,this.ddGroup||this.group,{dragElId:this.proxy.id,resizeFrame:false,isTarget:false,scroll:this.scroll===true});
this.dragging=false
};
CQ.Ext.extend(CQ.Ext.dd.DragSource,CQ.Ext.dd.DDProxy,{dropAllowed:"x-dd-drop-ok",dropNotAllowed:"x-dd-drop-nodrop",getDragData:function(a){return this.dragData
},onDragEnter:function(c,g){var b=CQ.Ext.dd.DragDropMgr.getDDById(g);
this.cachedTarget=b;
if(this.beforeDragEnter(b,c,g)!==false){if(b.isNotifyTarget){var a=b.notifyEnter(this,c,this.dragData);
this.proxy.setStatus(a)
}else{this.proxy.setStatus(this.dropAllowed)
}if(this.afterDragEnter){this.afterDragEnter(b,c,g)
}}},beforeDragEnter:function(b,a,c){return true
},alignElWithMouse:function(){CQ.Ext.dd.DragSource.superclass.alignElWithMouse.apply(this,arguments);
this.proxy.sync()
},onDragOver:function(c,g){var b=this.cachedTarget||CQ.Ext.dd.DragDropMgr.getDDById(g);
if(this.beforeDragOver(b,c,g)!==false){if(b.isNotifyTarget){var a=b.notifyOver(this,c,this.dragData);
this.proxy.setStatus(a)
}if(this.afterDragOver){this.afterDragOver(b,c,g)
}}},beforeDragOver:function(b,a,c){return true
},onDragOut:function(b,c){var a=this.cachedTarget||CQ.Ext.dd.DragDropMgr.getDDById(c);
if(this.beforeDragOut(a,b,c)!==false){if(a.isNotifyTarget){a.notifyOut(this,b,this.dragData)
}this.proxy.reset();
if(this.afterDragOut){this.afterDragOut(a,b,c)
}}this.cachedTarget=null
},beforeDragOut:function(b,a,c){return true
},onDragDrop:function(b,c){var a=this.cachedTarget||CQ.Ext.dd.DragDropMgr.getDDById(c);
if(this.beforeDragDrop(a,b,c)!==false){if(a.isNotifyTarget){if(a.notifyDrop(this,b,this.dragData)){this.onValidDrop(a,b,c)
}else{this.onInvalidDrop(a,b,c)
}}else{this.onValidDrop(a,b,c)
}if(this.afterDragDrop){this.afterDragDrop(a,b,c)
}}delete this.cachedTarget
},beforeDragDrop:function(b,a,c){return true
},onValidDrop:function(b,a,c){this.hideProxy();
if(this.afterValidDrop){this.afterValidDrop(b,a,c)
}},getRepairXY:function(b,a){return this.el.getXY()
},onInvalidDrop:function(b,a,c){this.beforeInvalidDrop(b,a,c);
if(this.cachedTarget){if(this.cachedTarget.isNotifyTarget){this.cachedTarget.notifyOut(this,a,this.dragData)
}this.cacheTarget=null
}this.proxy.repair(this.getRepairXY(a,this.dragData),this.afterRepair,this);
if(this.afterInvalidDrop){this.afterInvalidDrop(a,c)
}},afterRepair:function(){if(CQ.Ext.enableFx){this.el.highlight(this.hlColor||"c3daf9")
}this.dragging=false
},beforeInvalidDrop:function(b,a,c){return true
},handleMouseDown:function(b){if(this.dragging){return
}var a=this.getDragData(b);
if(a&&this.onBeforeDrag(a,b)!==false){this.dragData=a;
this.proxy.stop();
CQ.Ext.dd.DragSource.superclass.handleMouseDown.apply(this,arguments)
}},onBeforeDrag:function(a,b){return true
},onStartDrag:CQ.Ext.emptyFn,startDrag:function(a,b){this.proxy.reset();
this.dragging=true;
this.proxy.update("");
this.onInitDrag(a,b);
this.proxy.show()
},onInitDrag:function(a,c){var b=this.el.dom.cloneNode(true);
b.id=CQ.Ext.id();
this.proxy.update(b);
this.onStartDrag(a,c);
return true
},getProxy:function(){return this.proxy
},hideProxy:function(){this.proxy.hide();
this.proxy.reset(true);
this.dragging=false
},triggerCacheRefresh:function(){CQ.Ext.dd.DDM.refreshCache(this.groups)
},b4EndDrag:function(a){},endDrag:function(a){this.onEndDrag(this.dragData,a)
},onEndDrag:function(a,b){},autoOffset:function(a,b){this.setDelta(-12,-20)
},destroy:function(){CQ.Ext.dd.DragSource.superclass.destroy.call(this);
CQ.Ext.destroy(this.proxy)
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.dd.DropTarget=CQ.Ext.extend(CQ.Ext.dd.DDTarget,{constructor:function(b,a){this.el=CQ.Ext.get(b);
CQ.Ext.apply(this,a);
if(this.containerScroll){CQ.Ext.dd.ScrollManager.register(this.el)
}CQ.Ext.dd.DropTarget.superclass.constructor.call(this,this.el.dom,this.ddGroup||this.group,{isTarget:true})
},dropAllowed:"x-dd-drop-ok",dropNotAllowed:"x-dd-drop-nodrop",isTarget:true,isNotifyTarget:true,notifyEnter:function(a,c,b){if(this.overClass){this.el.addClass(this.overClass)
}return this.dropAllowed
},notifyOver:function(a,c,b){return this.dropAllowed
},notifyOut:function(a,c,b){if(this.overClass){this.el.removeClass(this.overClass)
}},notifyDrop:function(a,c,b){return false
},destroy:function(){CQ.Ext.dd.DropTarget.superclass.destroy.call(this);
if(this.containerScroll){CQ.Ext.dd.ScrollManager.unregister(this.el)
}}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.dd.DragZone=CQ.Ext.extend(CQ.Ext.dd.DragSource,{constructor:function(b,a){CQ.Ext.dd.DragZone.superclass.constructor.call(this,b,a);
if(this.containerScroll){CQ.Ext.dd.ScrollManager.register(this.el)
}},getDragData:function(a){return CQ.Ext.dd.Registry.getHandleFromEvent(a)
},onInitDrag:function(a,b){this.proxy.update(this.dragData.ddel.cloneNode(true));
this.onStartDrag(a,b);
return true
},afterRepair:function(){if(CQ.Ext.enableFx){CQ.Ext.Element.fly(this.dragData.ddel).highlight(this.hlColor||"c3daf9")
}this.dragging=false
},getRepairXY:function(a){return CQ.Ext.Element.fly(this.dragData.ddel).getXY()
},destroy:function(){CQ.Ext.dd.DragZone.superclass.destroy.call(this);
if(this.containerScroll){CQ.Ext.dd.ScrollManager.unregister(this.el)
}}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.dd.DropZone=function(b,a){CQ.Ext.dd.DropZone.superclass.constructor.call(this,b,a)
};
CQ.Ext.extend(CQ.Ext.dd.DropZone,CQ.Ext.dd.DropTarget,{getTargetFromEvent:function(a){return CQ.Ext.dd.Registry.getTargetFromEvent(a)
},onNodeEnter:function(g,a,c,b){},onNodeOver:function(g,a,c,b){return this.dropAllowed
},onNodeOut:function(g,a,c,b){},onNodeDrop:function(g,a,c,b){return false
},onContainerOver:function(a,c,b){return this.dropNotAllowed
},onContainerDrop:function(a,c,b){return false
},notifyEnter:function(a,c,b){return this.dropNotAllowed
},notifyOver:function(a,c,b){var g=this.getTargetFromEvent(c);
if(!g){if(this.lastOverNode){this.onNodeOut(this.lastOverNode,a,c,b);
this.lastOverNode=null
}return this.onContainerOver(a,c,b)
}if(this.lastOverNode!=g){if(this.lastOverNode){this.onNodeOut(this.lastOverNode,a,c,b)
}this.onNodeEnter(g,a,c,b);
this.lastOverNode=g
}return this.onNodeOver(g,a,c,b)
},notifyOut:function(a,c,b){if(this.lastOverNode){this.onNodeOut(this.lastOverNode,a,c,b);
this.lastOverNode=null
}},notifyDrop:function(a,c,b){if(this.lastOverNode){this.onNodeOut(this.lastOverNode,a,c,b);
this.lastOverNode=null
}var g=this.getTargetFromEvent(c);
return g?this.onNodeDrop(g,a,c,b):this.onContainerDrop(a,c,b)
},triggerCacheRefresh:function(){CQ.Ext.dd.DDM.refreshCache(this.groups)
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.Element.addMethods({initDD:function(c,b,g){var a=new CQ.Ext.dd.DD(CQ.Ext.id(this.dom),c,b);
return CQ.Ext.apply(a,g)
},initDDProxy:function(c,b,g){var a=new CQ.Ext.dd.DDProxy(CQ.Ext.id(this.dom),c,b);
return CQ.Ext.apply(a,g)
},initDDTarget:function(c,b,g){var a=new CQ.Ext.dd.DDTarget(CQ.Ext.id(this.dom),c,b);
return CQ.Ext.apply(a,g)
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.ComponentMgr=function(){var c=new CQ.Ext.util.MixedCollection();
var b={};
var a={};
return{register:function(g){c.add(g)
},unregister:function(g){c.remove(g)
},get:function(g){return c.get(g)
},onAvailable:function(k,j,g){c.on("add",function(m,n){if(n.id==k){j.call(g||n,n);
c.un("add",j,g)
}})
},all:c,types:b,ptypes:a,isRegistered:function(g){return b[g]!==undefined
},isPluginRegistered:function(g){return a[g]!==undefined
},registerType:function(j,g){b[j]=g;
g.xtype=j
},create:function(g,k){if(g.render){return g
}else{var j=b[g.xtype||k];
if(!j){throw ("cannot create Component: xtype '"+g.xtype+"' not found and no default supplied")
}return new j(g)
}},registerPlugin:function(j,g){a[j]=g;
g.ptype=j
},createPlugin:function(j,k){var g=a[j.ptype||k];
if(g.init){return g
}else{return new g(j)
}}}
}();
CQ.Ext.reg=CQ.Ext.ComponentMgr.registerType;
CQ.Ext.preg=CQ.Ext.ComponentMgr.registerPlugin;
CQ.Ext.create=CQ.Ext.ComponentMgr.create;
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.Component=function(b){b=b||{};
if(b.initialConfig){if(b.isAction){this.baseAction=b
}b=b.initialConfig
}else{if(b.tagName||b.dom||CQ.Ext.isString(b)){b={applyTo:b,id:b.id||b}
}}this.initialConfig=b;
CQ.Ext.apply(this,b);
this.addEvents("added","disable","enable","beforeshow","show","beforehide","hide","removed","beforerender","render","afterrender","beforedestroy","destroy","beforestaterestore","staterestore","beforestatesave","statesave");
this.getId();
CQ.Ext.ComponentMgr.register(this);
CQ.Ext.Component.superclass.constructor.call(this);
if(this.baseAction){this.baseAction.addComponent(this)
}this.initComponent();
if(this.plugins){if(CQ.Ext.isArray(this.plugins)){for(var c=0,a=this.plugins.length;
c<a;
c++){this.plugins[c]=this.initPlugin(this.plugins[c])
}}else{this.plugins=this.initPlugin(this.plugins)
}}if(this.stateful!==false){this.initState()
}if(this.applyTo){this.applyToMarkup(this.applyTo);
delete this.applyTo
}else{if(this.renderTo){this.render(this.renderTo);
delete this.renderTo
}}};
CQ.Ext.Component.AUTO_ID=1000;
CQ.Ext.extend(CQ.Ext.Component,CQ.Ext.util.Observable,{disabled:false,hidden:false,autoEl:"div",disabledClass:"x-item-disabled",allowDomMove:true,autoShow:false,hideMode:"display",hideParent:false,rendered:false,tplWriteMode:"overwrite",bubbleEvents:[],ctype:"CQ.Ext.Component",actionMode:"el",getActionEl:function(){return this[this.actionMode]
},initPlugin:function(a){if(a.ptype&&!CQ.Ext.isFunction(a.init)){a=CQ.Ext.ComponentMgr.createPlugin(a)
}else{if(CQ.Ext.isString(a)){a=CQ.Ext.ComponentMgr.createPlugin({ptype:a})
}}a.init(this);
return a
},initComponent:function(){if(this.listeners){this.on(this.listeners);
delete this.listeners
}this.enableBubble(this.bubbleEvents)
},render:function(b,a){if(!this.rendered&&this.fireEvent("beforerender",this)!==false){if(!b&&this.el){this.el=CQ.Ext.get(this.el);
b=this.el.dom.parentNode;
this.allowDomMove=false
}if(CQ.Util.isRoot(b)){b=CQ.Util.getRoot()
}this.container=CQ.Ext.get(b);
if(this.ctCls){this.container.addClass(this.ctCls)
}this.rendered=true;
if(a!==undefined){if(CQ.Ext.isNumber(a)){a=this.container.dom.childNodes[a]
}else{a=CQ.Ext.getDom(a)
}}this.onRender(this.container,a||null);
if(this.autoShow){this.el.removeClass(["x-hidden","x-hide-"+this.hideMode])
}if(this.cls){this.el.addClass(this.cls);
delete this.cls
}if(this.style){this.el.applyStyles(this.style);
delete this.style
}if(this.overCls){this.el.addClassOnOver(this.overCls)
}this.fireEvent("render",this);
var c=this.getContentTarget();
if(this.html){c.update(CQ.Ext.DomHelper.markup(this.html));
delete this.html
}if(this.contentEl){var g=CQ.Ext.getDom(this.contentEl);
CQ.Ext.fly(g).removeClass(["x-hidden","x-hide-display"]);
c.appendChild(g)
}if(this.tpl){if(!this.tpl.compile){this.tpl=new CQ.Ext.XTemplate(this.tpl)
}if(this.data){this.tpl[this.tplWriteMode](c,this.data);
delete this.data
}}this.afterRender(this.container);
if(this.hidden){this.doHide()
}if(this.disabled){this.disable(true)
}if(this.stateful!==false){this.initStateEvents()
}this.fireEvent("afterrender",this)
}return this
},update:function(b,g,a){var c=this.getContentTarget();
if(this.tpl&&typeof b!=="string"){this.tpl[this.tplWriteMode](c,b||{})
}else{var j=CQ.Ext.isObject(b)?CQ.Ext.DomHelper.markup(b):b;
c.update(j,g,a)
}},onAdded:function(a,b){this.ownerCt=a;
this.initRef();
this.fireEvent("added",this,a,b)
},onRemoved:function(){this.removeRef();
this.fireEvent("removed",this,this.ownerCt);
delete this.ownerCt
},initRef:function(){if(this.ref&&!this.refOwner){var g=this.ref.split("/"),c=g.length,b=0,a=this;
while(a&&b<c){a=a.ownerCt;
++b
}if(a){a[this.refName=g[--b]]=this;
this.refOwner=a
}}},removeRef:function(){if(this.refOwner&&this.refName){delete this.refOwner[this.refName];
delete this.refOwner
}},initState:function(){if(CQ.Ext.state.Manager){var b=this.getStateId();
if(b){var a=CQ.Ext.state.Manager.get(b);
if(a){if(this.fireEvent("beforestaterestore",this,a)!==false){this.applyState(CQ.Ext.apply({},a));
this.fireEvent("staterestore",this,a)
}}}}},getStateId:function(){return this.stateId||((/^(ext-comp-|ext-gen)/).test(String(this.id))?null:this.id)
},initStateEvents:function(){if(this.stateEvents){for(var a=0,b;
b=this.stateEvents[a];
a++){this.on(b,this.saveState,this,{delay:100})
}}},applyState:function(a){if(a){CQ.Ext.apply(this,a)
}},getState:function(){return null
},saveState:function(){if(CQ.Ext.state.Manager&&this.stateful!==false){var b=this.getStateId();
if(b){var a=this.getState();
if(this.fireEvent("beforestatesave",this,a)!==false){CQ.Ext.state.Manager.set(b,a);
this.fireEvent("statesave",this,a)
}}}},applyToMarkup:function(a){this.allowDomMove=false;
this.el=CQ.Ext.get(a);
this.render(this.el.dom.parentNode)
},addClass:function(a){if(this.el){this.el.addClass(a)
}else{this.cls=this.cls?this.cls+" "+a:a
}return this
},removeClass:function(a){if(this.el){this.el.removeClass(a)
}else{if(this.cls){this.cls=this.cls.split(" ").remove(a).join(" ")
}}return this
},onRender:function(b,a){if(!this.el&&this.autoEl){if(CQ.Ext.isString(this.autoEl)){this.el=document.createElement(this.autoEl)
}else{var c=document.createElement("div");
CQ.Ext.DomHelper.overwrite(c,this.autoEl);
this.el=c.firstChild
}if(!this.el.id){this.el.id=this.getId()
}}if(this.el){this.el=CQ.Ext.get(this.el);
if(this.allowDomMove!==false){b.dom.insertBefore(this.el.dom,a);
if(c){CQ.Ext.removeNode(c);
c=null
}}}},getAutoCreate:function(){var a=CQ.Ext.isObject(this.autoCreate)?this.autoCreate:CQ.Ext.apply({},this.defaultAutoCreate);
if(this.id&&!a.id){a.id=this.id
}return a
},afterRender:CQ.Ext.emptyFn,destroy:function(){if(!this.isDestroyed){if(this.fireEvent("beforedestroy",this)!==false){this.destroying=true;
this.beforeDestroy();
if(this.ownerCt&&this.ownerCt.remove){this.ownerCt.remove(this,false)
}if(this.rendered){this.el.remove();
if(this.actionMode=="container"||this.removeMode=="container"){this.container.remove()
}}if(this.focusTask&&this.focusTask.cancel){this.focusTask.cancel()
}this.onDestroy();
CQ.Ext.ComponentMgr.unregister(this);
this.fireEvent("destroy",this);
this.purgeListeners();
this.destroying=false;
this.isDestroyed=true
}}},deleteMembers:function(){var b=arguments;
for(var c=0,a=b.length;
c<a;
++c){delete this[b[c]]
}},beforeDestroy:CQ.Ext.emptyFn,onDestroy:CQ.Ext.emptyFn,getEl:function(){return this.el
},getContentTarget:function(){return this.el
},getId:function(){return this.id||(this.id="ext-comp-"+(++CQ.Ext.Component.AUTO_ID))
},getItemId:function(){return this.itemId||this.getId()
},focus:function(b,a){if(a){this.focusTask=new CQ.Ext.util.DelayedTask(this.focus,this,[b,false]);
this.focusTask.delay(CQ.Ext.isNumber(a)?a:10);
return this
}if(this.rendered&&!this.isDestroyed){this.el.focus();
if(b===true){this.el.dom.select()
}}return this
},blur:function(){if(this.rendered){this.el.blur()
}return this
},disable:function(a){if(this.rendered){this.onDisable()
}this.disabled=true;
if(a!==true){this.fireEvent("disable",this)
}return this
},onDisable:function(){this.getActionEl().addClass(this.disabledClass);
this.el.dom.disabled=true
},enable:function(){if(this.rendered){this.onEnable()
}this.disabled=false;
this.fireEvent("enable",this);
return this
},onEnable:function(){this.getActionEl().removeClass(this.disabledClass);
this.el.dom.disabled=false
},setDisabled:function(a){return this[a?"disable":"enable"]()
},show:function(){if(this.fireEvent("beforeshow",this)!==false){this.hidden=false;
if(this.autoRender){this.render(CQ.Ext.isBoolean(this.autoRender)?CQ.Util.getRoot():this.autoRender)
}if(this.rendered){this.onShow()
}this.fireEvent("show",this)
}return this
},onShow:function(){this.getVisibilityEl().removeClass("x-hide-"+this.hideMode)
},hide:function(){if(this.fireEvent("beforehide",this)!==false){this.doHide();
this.fireEvent("hide",this)
}return this
},doHide:function(){this.hidden=true;
if(this.rendered){this.onHide()
}},onHide:function(){this.getVisibilityEl().addClass("x-hide-"+this.hideMode)
},getVisibilityEl:function(){return this.hideParent?this.container:this.getActionEl()
},setVisible:function(a){return this[a?"show":"hide"]()
},isVisible:function(){return this.rendered&&this.getVisibilityEl().isVisible()
},cloneConfig:function(b){b=b||{};
var c=b.id||CQ.Ext.id();
var a=CQ.Ext.applyIf(b,this.initialConfig);
a.id=c;
return new this.constructor(a)
},getXType:function(){return this.constructor.xtype
},isXType:function(b,a){if(CQ.Ext.isFunction(b)){b=b.xtype
}else{if(CQ.Ext.isObject(b)){b=b.constructor.xtype
}}return !a?("/"+this.getXTypes()+"/").indexOf("/"+b+"/")!=-1:this.constructor.xtype==b
},getXTypes:function(){var a=this.constructor;
if(!a.xtypes){var g=[],b=this;
while(b&&b.constructor.xtype){g.unshift(b.constructor.xtype);
b=b.constructor.superclass
}a.xtypeChain=g;
a.xtypes=g.join("/")
}return a.xtypes
},findParentBy:function(a){for(var b=this.ownerCt;
(b!=null)&&!a(b,this);
b=b.ownerCt){}return b||null
},findParentByType:function(b,a){return this.findParentBy(function(g){return g.isXType(b,a)
})
},bubble:function(c,b,a){var g=this;
while(g){if(c.apply(b||g,a||[g])===false){break
}g=g.ownerCt
}return this
},getPositionEl:function(){return this.positionEl||this.el
},purgeListeners:function(){CQ.Ext.Component.superclass.purgeListeners.call(this);
if(this.mons){this.on("beforedestroy",this.clearMons,this,{single:true})
}},clearMons:function(){CQ.Ext.each(this.mons,function(a){a.item.un(a.ename,a.fn,a.scope)
},this);
this.mons=[]
},createMons:function(){if(!this.mons){this.mons=[];
this.on("beforedestroy",this.clearMons,this,{single:true})
}},mon:function(j,b,g,c,a){this.createMons();
if(CQ.Ext.isObject(b)){var n=/^(?:scope|delay|buffer|single|stopEvent|preventDefault|stopPropagation|normalized|args|delegate)$/;
var m=b;
for(var k in m){if(n.test(k)){continue
}if(CQ.Ext.isFunction(m[k])){this.mons.push({item:j,ename:k,fn:m[k],scope:m.scope});
j.on(k,m[k],m.scope,m)
}else{this.mons.push({item:j,ename:k,fn:m[k],scope:m.scope});
j.on(k,m[k])
}}return
}this.mons.push({item:j,ename:b,fn:g,scope:c});
j.on(b,g,c,a)
},mun:function(m,c,k,j){var n,g;
this.createMons();
for(var b=0,a=this.mons.length;
b<a;
++b){g=this.mons[b];
if(m===g.item&&c==g.ename&&k===g.fn&&j===g.scope){this.mons.splice(b,1);
m.un(c,k,j);
n=true;
break
}}return n
},nextSibling:function(){if(this.ownerCt){var a=this.ownerCt.items.indexOf(this);
if(a!=-1&&a+1<this.ownerCt.items.getCount()){return this.ownerCt.items.itemAt(a+1)
}}return null
},previousSibling:function(){if(this.ownerCt){var a=this.ownerCt.items.indexOf(this);
if(a>0){return this.ownerCt.items.itemAt(a-1)
}}return null
},getBubbleTarget:function(){return this.ownerCt
}});
CQ.Ext.reg("component",CQ.Ext.Component);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.Action=CQ.Ext.extend(Object,{constructor:function(a){this.initialConfig=a;
this.itemId=a.itemId=(a.itemId||a.id||CQ.Ext.id());
this.items=[]
},isAction:true,setText:function(a){this.initialConfig.text=a;
this.callEach("setText",[a])
},getText:function(){return this.initialConfig.text
},setIconClass:function(a){this.initialConfig.iconCls=a;
this.callEach("setIconClass",[a])
},getIconClass:function(){return this.initialConfig.iconCls
},setDisabled:function(a){this.initialConfig.disabled=a;
this.callEach("setDisabled",[a])
},enable:function(){this.setDisabled(false)
},disable:function(){this.setDisabled(true)
},isDisabled:function(){return this.initialConfig.disabled
},setHidden:function(a){this.initialConfig.hidden=a;
this.callEach("setVisible",[!a])
},show:function(){this.setHidden(false)
},hide:function(){this.setHidden(true)
},isHidden:function(){return this.initialConfig.hidden
},setHandler:function(b,a){this.initialConfig.handler=b;
this.initialConfig.scope=a;
this.callEach("setHandler",[b,a])
},each:function(b,a){CQ.Ext.each(this.items,b,a)
},callEach:function(j,b){var g=this.items;
for(var c=0,a=g.length;
c<a;
c++){g[c][j].apply(g[c],b)
}},addComponent:function(a){this.items.push(a);
a.on("destroy",this.removeComponent,this)
},removeComponent:function(a){this.items.remove(a)
},execute:function(){this.initialConfig.handler.apply(this.initialConfig.scope||window,arguments)
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
(function(){CQ.Ext.Layer=function(g,c){g=g||{};
var j=CQ.Ext.DomHelper;
var m=g.parentEl,k=m?CQ.Ext.getDom(m):CQ.Util.getRoot();
if(c){this.dom=CQ.Ext.getDom(c)
}if(!this.dom){var n=g.dh||{tag:"div",cls:"x-layer"};
this.dom=j.append(k,n)
}if(g.cls){this.addClass(g.cls)
}this.constrain=g.constrain!==false;
this.setVisibilityMode(CQ.Ext.Element.VISIBILITY);
if(g.id){this.id=this.dom.id=g.id
}else{this.id=CQ.Ext.id(this.dom)
}this.zindex=g.zindex||this.getZIndex();
this.position("absolute",this.zindex);
if(g.shadow){this.shadowOffset=g.shadowOffset||4;
this.shadow=new CQ.Ext.Shadow({offset:this.shadowOffset,mode:g.shadow})
}else{this.shadowOffset=0
}this.useShim=g.shim!==false&&CQ.Ext.useShims;
this.useDisplay=g.useDisplay;
this.hide()
};
var a=CQ.Ext.Element.prototype;
var b=[];
CQ.Ext.extend(CQ.Ext.Layer,CQ.Ext.Element,{getZIndex:function(){return this.zindex||parseInt((this.getShim()||this).getStyle("z-index"),10)||11000
},getShim:function(){if(!this.useShim){return null
}if(this.shim){return this.shim
}var g=b.shift();
if(!g){g=this.createShim();
g.enableDisplayMode("block");
g.dom.style.display="none";
g.dom.style.visibility="visible"
}var c=this.dom.parentNode;
if(g.dom.parentNode!=c){c.insertBefore(g.dom,this.dom)
}g.setStyle("z-index",this.getZIndex()-2);
this.shim=g;
return g
},hideShim:function(){if(this.shim){this.shim.setDisplayed(false);
b.push(this.shim);
delete this.shim
}},disableShadow:function(){if(this.shadow){this.shadowDisabled=true;
this.shadow.hide();
this.lastShadowOffset=this.shadowOffset;
this.shadowOffset=0
}},enableShadow:function(c){if(this.shadow){this.shadowDisabled=false;
if(CQ.Ext.isDefined(this.lastShadowOffset)){this.shadowOffset=this.lastShadowOffset;
delete this.lastShadowOffset
}if(c){this.sync(true)
}}},sync:function(g){var r=this.shadow;
if(!this.updating&&this.isVisible()&&(r||this.useShim)){var m=this.getShim(),q=this.getWidth(),n=this.getHeight(),j=this.getLeft(true),u=this.getTop(true);
if(r&&!this.shadowDisabled){if(g&&!r.isVisible()){r.show(this)
}else{r.realign(j,u,q,n)
}if(m){if(g){m.show()
}var o=r.el.getXY(),k=m.dom.style,c=r.el.getSize();
k.left=(o[0])+"px";
k.top=(o[1])+"px";
k.width=(c.width)+"px";
k.height=(c.height)+"px"
}}else{if(m){if(g){m.show()
}m.setSize(q,n);
m.setLeftTop(j,u)
}}}},destroy:function(){this.hideShim();
if(this.shadow){this.shadow.hide()
}this.removeAllListeners();
CQ.Ext.removeNode(this.dom);
delete this.dom
},remove:function(){this.destroy()
},beginUpdate:function(){this.updating=true
},endUpdate:function(){this.updating=false;
this.sync(true)
},hideUnders:function(c){if(this.shadow){this.shadow.hide()
}this.hideShim()
},constrainXY:function(){if(this.constrain){var n=CQ.Ext.lib.Dom.getViewWidth(),g=CQ.Ext.lib.Dom.getViewHeight();
var u=CQ.Ext.getDoc().getScroll();
var t=this.getXY();
var o=t[0],m=t[1];
var c=this.shadowOffset;
var q=this.dom.offsetWidth+c,j=this.dom.offsetHeight+c;
var k=false;
if((o+q)>n+u.left){o=n-q-c;
k=true
}if((m+j)>g+u.top){m=g-j-c;
k=true
}if(o<u.left){o=u.left;
k=true
}if(m<u.top){m=u.top;
k=true
}if(k){if(this.avoidY){var r=this.avoidY;
if(m<=r&&(m+j)>=r){m=r-j-5
}}t=[o,m];
this.storeXY(t);
a.setXY.call(this,t);
this.sync()
}}return this
},getConstrainOffset:function(){return this.shadowOffset
},isVisible:function(){return this.visible
},showAction:function(){this.visible=true;
if(this.useDisplay===true){this.setDisplayed("")
}else{if(this.lastXY){a.setXY.call(this,this.lastXY)
}else{if(this.lastLT){a.setLeftTop.call(this,this.lastLT[0],this.lastLT[1])
}}}},hideAction:function(){this.visible=false;
if(this.useDisplay===true){this.setDisplayed(false)
}else{this.setLeftTop(-10000,-10000)
}},setVisible:function(k,j,n,o,m){if(k){this.showAction()
}if(j&&k){var g=function(){this.sync(true);
if(o){o()
}}.createDelegate(this);
a.setVisible.call(this,true,true,n,g,m)
}else{if(!k){this.hideUnders(true)
}var g=o;
if(j){g=function(){this.hideAction();
if(o){o()
}}.createDelegate(this)
}a.setVisible.call(this,k,j,n,g,m);
if(k){this.sync(true)
}else{if(!j){this.hideAction()
}}}return this
},storeXY:function(c){delete this.lastLT;
this.lastXY=c
},storeLeftTop:function(g,c){delete this.lastXY;
this.lastLT=[g,c]
},beforeFx:function(){this.beforeAction();
return CQ.Ext.Layer.superclass.beforeFx.apply(this,arguments)
},afterFx:function(){CQ.Ext.Layer.superclass.afterFx.apply(this,arguments);
this.sync(this.isVisible())
},beforeAction:function(){if(!this.updating&&this.shadow){this.shadow.hide()
}},setLeft:function(c){this.storeLeftTop(c,this.getTop(true));
a.setLeft.apply(this,arguments);
this.sync();
return this
},setTop:function(c){this.storeLeftTop(this.getLeft(true),c);
a.setTop.apply(this,arguments);
this.sync();
return this
},setLeftTop:function(g,c){this.storeLeftTop(g,c);
a.setLeftTop.apply(this,arguments);
this.sync();
return this
},setXY:function(m,j,n,o,k){this.fixDisplay();
this.beforeAction();
this.storeXY(m);
var g=this.createCB(o);
a.setXY.call(this,m,j,n,g,k);
if(!j){g()
}return this
},createCB:function(j){var g=this;
return function(){g.constrainXY();
g.sync(true);
if(j){j()
}}
},setX:function(g,j,m,n,k){this.setXY([g,this.getY()],j,m,n,k);
return this
},setY:function(n,g,k,m,j){this.setXY([this.getX(),n],g,k,m,j);
return this
},setSize:function(k,m,j,o,q,n){this.beforeAction();
var g=this.createCB(q);
a.setSize.call(this,k,m,j,o,g,n);
if(!j){g()
}return this
},setWidth:function(k,j,n,o,m){this.beforeAction();
var g=this.createCB(o);
a.setWidth.call(this,k,j,n,g,m);
if(!j){g()
}return this
},setHeight:function(k,j,n,o,m){this.beforeAction();
var g=this.createCB(o);
a.setHeight.call(this,k,j,n,g,m);
if(!j){g()
}return this
},setBounds:function(r,o,t,j,q,m,n,k){this.beforeAction();
var g=this.createCB(n);
if(!q){this.storeXY([r,o]);
a.setXY.call(this,[r,o]);
a.setSize.call(this,t,j,q,m,g,k);
g()
}else{a.setBounds.call(this,r,o,t,j,q,m,g,k)
}return this
},setZIndex:function(c){this.zindex=c;
this.setStyle("z-index",c+2);
if(this.shadow){this.shadow.setZIndex(c+1)
}if(this.shim){this.shim.setStyle("z-index",c)
}return this
}})
})();
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.Shadow=function(g){CQ.Ext.apply(this,g);
if(typeof this.mode!="string"){this.mode=this.defaultMode
}var j=this.offset,c={h:0},b=Math.floor(this.offset/2);
switch(this.mode.toLowerCase()){case"drop":c.w=0;
c.l=c.t=j;
c.t-=1;
if(CQ.Ext.isIE){c.l-=this.offset+b;
c.t-=this.offset+b;
c.w-=b;
c.h-=b;
c.t+=1
}break;
case"sides":c.w=(j*2);
c.l=-j;
c.t=j-1;
if(CQ.Ext.isIE){c.l-=(this.offset-b);
c.t-=this.offset+b;
c.l+=1;
c.w-=(this.offset-b)*2;
c.w-=b+1;
c.h-=1
}break;
case"frame":c.w=c.h=(j*2);
c.l=c.t=-j;
c.t+=1;
c.h-=2;
if(CQ.Ext.isIE){c.l-=(this.offset-b);
c.t-=(this.offset-b);
c.l+=1;
c.w-=(this.offset+b+1);
c.h-=(this.offset+b);
c.h+=1
}break
}this.adjusts=c
};
CQ.Ext.Shadow.prototype={offset:4,defaultMode:"drop",show:function(a){a=CQ.Ext.get(a);
if(!this.el){this.el=CQ.Ext.Shadow.Pool.pull();
if(this.el.dom.nextSibling!=a.dom){this.el.insertBefore(a)
}}this.el.setStyle("z-index",this.zIndex||parseInt(a.getStyle("z-index"),10)-1);
if(CQ.Ext.isIE){this.el.dom.style.filter="progid:DXImageTransform.Microsoft.alpha(opacity=50) progid:DXImageTransform.Microsoft.Blur(pixelradius="+(this.offset)+")"
}this.realign(a.getLeft(true),a.getTop(true),a.getWidth(),a.getHeight());
this.el.dom.style.display="block"
},isVisible:function(){return this.el?true:false
},realign:function(b,x,v,j){if(!this.el){return
}var q=this.adjusts,n=this.el.dom,y=n.style,k=0,u=(v+q.w),g=(j+q.h),m=u+"px",r=g+"px",o,c;
y.left=(b+q.l)+"px";
y.top=(x+q.t)+"px";
if(y.width!=m||y.height!=r){y.width=m;
y.height=r;
if(!CQ.Ext.isIE){o=n.childNodes;
c=Math.max(0,(u-12))+"px";
o[0].childNodes[1].style.width=c;
o[1].childNodes[1].style.width=c;
o[2].childNodes[1].style.width=c;
o[1].style.height=Math.max(0,(g-12))+"px"
}}},hide:function(){if(this.el){this.el.dom.style.display="none";
CQ.Ext.Shadow.Pool.push(this.el);
delete this.el
}},setZIndex:function(a){this.zIndex=a;
if(this.el){this.el.setStyle("z-index",a)
}}};
CQ.Ext.Shadow.Pool=function(){var b=[],a=CQ.Ext.isIE?'<div class="x-ie-shadow"></div>':'<div class="x-shadow"><div class="xst"><div class="xstl"></div><div class="xstc"></div><div class="xstr"></div></div><div class="xsc"><div class="xsml"></div><div class="xsmc"></div><div class="xsmr"></div></div><div class="xsb"><div class="xsbl"></div><div class="xsbc"></div><div class="xsbr"></div></div></div>';
return{pull:function(){var j=b.shift();
if(!j){var c=CQ.Ext.getDom(CQ.Util.getRoot());
var k;
for(var g=0;
g<c.childNodes.length;
g++){if(c.childNodes[g].tagName){k=c.childNodes[g];
break
}}j=CQ.Ext.get(CQ.Ext.DomHelper.insertHtml("beforeBegin",k,a));
j.autoBoxAdjust=false
}return j
},push:function(c){b.push(c)
}}
}();
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.BoxComponent=CQ.Ext.extend(CQ.Ext.Component,{initComponent:function(){CQ.Ext.BoxComponent.superclass.initComponent.call(this);
this.addEvents("resize","move")
},boxReady:false,deferHeight:false,setSize:function(b,g){if(typeof b=="object"){g=b.height;
b=b.width
}if(CQ.Ext.isDefined(b)&&CQ.Ext.isDefined(this.boxMinWidth)&&(b<this.boxMinWidth)){b=this.boxMinWidth
}if(CQ.Ext.isDefined(g)&&CQ.Ext.isDefined(this.boxMinHeight)&&(g<this.boxMinHeight)){g=this.boxMinHeight
}if(CQ.Ext.isDefined(b)&&CQ.Ext.isDefined(this.boxMaxWidth)&&(b>this.boxMaxWidth)){b=this.boxMaxWidth
}if(CQ.Ext.isDefined(g)&&CQ.Ext.isDefined(this.boxMaxHeight)&&(g>this.boxMaxHeight)){g=this.boxMaxHeight
}if(!this.boxReady){this.width=b;
this.height=g;
return this
}if(this.cacheSizes!==false&&this.lastSize&&this.lastSize.width==b&&this.lastSize.height==g){return this
}this.lastSize={width:b,height:g};
var c=this.adjustSize(b,g),k=c.width,a=c.height,j;
if(k!==undefined||a!==undefined){j=this.getResizeEl();
if(!this.deferHeight&&k!==undefined&&a!==undefined){j.setSize(k,a)
}else{if(!this.deferHeight&&a!==undefined){j.setHeight(a)
}else{if(k!==undefined){j.setWidth(k)
}}}this.onResize(k,a,b,g);
this.fireEvent("resize",this,k,a,b,g)
}return this
},setWidth:function(a){return this.setSize(a)
},setHeight:function(a){return this.setSize(undefined,a)
},getSize:function(){return this.getResizeEl().getSize()
},getWidth:function(){return this.getResizeEl().getWidth()
},getHeight:function(){return this.getResizeEl().getHeight()
},getOuterSize:function(){var a=this.getResizeEl();
return{width:a.getWidth()+a.getMargins("lr"),height:a.getHeight()+a.getMargins("tb")}
},getPosition:function(a){var b=this.getPositionEl();
if(a===true){return[b.getLeft(true),b.getTop(true)]
}return this.xy||b.getXY()
},getBox:function(a){var c=this.getPosition(a);
var b=this.getSize();
b.x=c[0];
b.y=c[1];
return b
},updateBox:function(a){this.setSize(a.width,a.height);
this.setPagePosition(a.x,a.y);
return this
},getResizeEl:function(){return this.resizeEl||this.el
},setAutoScroll:function(a){if(this.rendered){this.getContentTarget().setOverflow(a?"auto":"")
}this.autoScroll=a;
return this
},setPosition:function(a,k){if(a&&typeof a[1]=="number"){k=a[1];
a=a[0]
}this.x=a;
this.y=k;
if(!this.boxReady){return this
}var b=this.adjustPosition(a,k);
var j=b.x,g=b.y;
var c=this.getPositionEl();
if(j!==undefined||g!==undefined){if(j!==undefined&&g!==undefined){c.setLeftTop(j,g)
}else{if(j!==undefined){c.setLeft(j)
}else{if(g!==undefined){c.setTop(g)
}}}this.onPosition(j,g);
this.fireEvent("move",this,j,g)
}return this
},setPagePosition:function(a,c){if(a&&typeof a[1]=="number"){c=a[1];
a=a[0]
}this.pageX=a;
this.pageY=c;
if(!this.boxReady){return
}if(a===undefined||c===undefined){return
}var b=this.getPositionEl().translatePoints(a,c);
this.setPosition(b.left,b.top);
return this
},afterRender:function(){CQ.Ext.BoxComponent.superclass.afterRender.call(this);
if(this.resizeEl){this.resizeEl=CQ.Ext.get(this.resizeEl)
}if(this.positionEl){this.positionEl=CQ.Ext.get(this.positionEl)
}this.boxReady=true;
CQ.Ext.isDefined(this.autoScroll)&&this.setAutoScroll(this.autoScroll);
this.setSize(this.width,this.height);
if(this.x||this.y){this.setPosition(this.x,this.y)
}else{if(this.pageX||this.pageY){this.setPagePosition(this.pageX,this.pageY)
}}},syncSize:function(){delete this.lastSize;
this.setSize(this.autoWidth?undefined:this.getResizeEl().getWidth(),this.autoHeight?undefined:this.getResizeEl().getHeight());
return this
},onResize:function(g,b,a,c){},onPosition:function(a,b){},adjustSize:function(a,b){if(this.autoWidth){a="auto"
}if(this.autoHeight){b="auto"
}return{width:a,height:b}
},adjustPosition:function(a,b){return{x:a,y:b}
}});
CQ.Ext.reg("box",CQ.Ext.BoxComponent);
CQ.Ext.Spacer=CQ.Ext.extend(CQ.Ext.BoxComponent,{autoEl:"div"});
CQ.Ext.reg("spacer",CQ.Ext.Spacer);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.SplitBar=function(c,j,b,g,a){this.el=CQ.Ext.get(c,true);
this.el.dom.unselectable="on";
this.resizingEl=CQ.Ext.get(j,true);
this.orientation=b||CQ.Ext.SplitBar.HORIZONTAL;
this.minSize=0;
this.maxSize=2000;
this.animate=false;
this.useShim=false;
this.shim=null;
if(!a){this.proxy=CQ.Ext.SplitBar.createProxy(this.orientation)
}else{this.proxy=CQ.Ext.get(a).dom
}this.dd=new CQ.Ext.dd.DDProxy(this.el.dom.id,"XSplitBars",{dragElId:this.proxy.id});
this.dd.b4StartDrag=this.onStartProxyDrag.createDelegate(this);
this.dd.endDrag=this.onEndProxyDrag.createDelegate(this);
this.dragSpecs={};
this.adapter=new CQ.Ext.SplitBar.BasicLayoutAdapter();
this.adapter.init(this);
if(this.orientation==CQ.Ext.SplitBar.HORIZONTAL){this.placement=g||(this.el.getX()>this.resizingEl.getX()?CQ.Ext.SplitBar.LEFT:CQ.Ext.SplitBar.RIGHT);
this.el.addClass("x-splitbar-h")
}else{this.placement=g||(this.el.getY()>this.resizingEl.getY()?CQ.Ext.SplitBar.TOP:CQ.Ext.SplitBar.BOTTOM);
this.el.addClass("x-splitbar-v")
}this.addEvents("resize","moved","beforeresize","beforeapply");
CQ.Ext.SplitBar.superclass.constructor.call(this)
};
CQ.Ext.extend(CQ.Ext.SplitBar,CQ.Ext.util.Observable,{onStartProxyDrag:function(a,j){this.fireEvent("beforeresize",this);
this.overlay=CQ.Ext.DomHelper.append(document.body,{cls:"x-drag-overlay",html:"&#160;"},true);
this.overlay.unselectable();
this.overlay.setSize(CQ.Ext.lib.Dom.getViewWidth(true),CQ.Ext.lib.Dom.getViewHeight(true));
this.overlay.show();
CQ.Ext.get(this.proxy).setDisplayed("block");
var c=this.adapter.getElementSize(this);
this.activeMinSize=this.getMinimumSize();
this.activeMaxSize=this.getMaximumSize();
var g=c-this.activeMinSize;
var b=Math.max(this.activeMaxSize-c,0);
if(this.orientation==CQ.Ext.SplitBar.HORIZONTAL){this.dd.resetConstraints();
this.dd.setXConstraint(this.placement==CQ.Ext.SplitBar.LEFT?g:b,this.placement==CQ.Ext.SplitBar.LEFT?b:g,this.tickSize);
this.dd.setYConstraint(0,0)
}else{this.dd.resetConstraints();
this.dd.setXConstraint(0,0);
this.dd.setYConstraint(this.placement==CQ.Ext.SplitBar.TOP?g:b,this.placement==CQ.Ext.SplitBar.TOP?b:g,this.tickSize)
}this.dragSpecs.startSize=c;
this.dragSpecs.startPoint=[a,j];
CQ.Ext.dd.DDProxy.prototype.b4StartDrag.call(this.dd,a,j)
},onEndProxyDrag:function(c){CQ.Ext.get(this.proxy).setDisplayed(false);
var b=CQ.Ext.lib.Event.getXY(c);
if(this.overlay){CQ.Ext.destroy(this.overlay);
delete this.overlay
}var a;
if(this.orientation==CQ.Ext.SplitBar.HORIZONTAL){a=this.dragSpecs.startSize+(this.placement==CQ.Ext.SplitBar.LEFT?b[0]-this.dragSpecs.startPoint[0]:this.dragSpecs.startPoint[0]-b[0])
}else{a=this.dragSpecs.startSize+(this.placement==CQ.Ext.SplitBar.TOP?b[1]-this.dragSpecs.startPoint[1]:this.dragSpecs.startPoint[1]-b[1])
}a=Math.min(Math.max(a,this.activeMinSize),this.activeMaxSize);
if(a!=this.dragSpecs.startSize){if(this.fireEvent("beforeapply",this,a)!==false){this.adapter.setElementSize(this,a);
this.fireEvent("moved",this,a);
this.fireEvent("resize",this,a)
}}},getAdapter:function(){return this.adapter
},setAdapter:function(a){this.adapter=a;
this.adapter.init(this)
},getMinimumSize:function(){return this.minSize
},setMinimumSize:function(a){this.minSize=a
},getMaximumSize:function(){return this.maxSize
},setMaximumSize:function(a){this.maxSize=a
},setCurrentSize:function(b){var a=this.animate;
this.animate=false;
this.adapter.setElementSize(this,b);
this.animate=a
},destroy:function(a){CQ.Ext.destroy(this.shim,CQ.Ext.get(this.proxy));
this.dd.unreg();
if(a){this.el.remove()
}this.purgeListeners()
}});
CQ.Ext.SplitBar.createProxy=function(b){var c=new CQ.Ext.Element(document.createElement("div"));
CQ.Util.getRoot().appendChild(c.dom);
c.unselectable();
var a="x-splitbar-proxy";
c.addClass(a+" "+(b==CQ.Ext.SplitBar.HORIZONTAL?a+"-h":a+"-v"));
return c.dom
};
CQ.Ext.SplitBar.BasicLayoutAdapter=function(){};
CQ.Ext.SplitBar.BasicLayoutAdapter.prototype={init:function(a){},getElementSize:function(a){if(a.orientation==CQ.Ext.SplitBar.HORIZONTAL){return a.resizingEl.getWidth()
}else{return a.resizingEl.getHeight()
}},setElementSize:function(b,a,c){if(b.orientation==CQ.Ext.SplitBar.HORIZONTAL){if(!b.animate){b.resizingEl.setWidth(a);
if(c){c(b,a)
}}else{b.resizingEl.setWidth(a,true,0.1,c,"easeOut")
}}else{if(!b.animate){b.resizingEl.setHeight(a);
if(c){c(b,a)
}}else{b.resizingEl.setHeight(a,true,0.1,c,"easeOut")
}}}};
CQ.Ext.SplitBar.AbsoluteLayoutAdapter=function(a){this.basic=new CQ.Ext.SplitBar.BasicLayoutAdapter();
this.container=CQ.Ext.get(a)
};
CQ.Ext.SplitBar.AbsoluteLayoutAdapter.prototype={init:function(a){this.basic.init(a)
},getElementSize:function(a){return this.basic.getElementSize(a)
},setElementSize:function(b,a,c){this.basic.setElementSize(b,a,this.moveSplitter.createDelegate(this,[b]))
},moveSplitter:function(a){var b=CQ.Ext.SplitBar;
switch(a.placement){case b.LEFT:a.el.setX(a.resizingEl.getRight());
break;
case b.RIGHT:a.el.setStyle("right",(this.container.getWidth()-a.resizingEl.getLeft())+"px");
break;
case b.TOP:a.el.setY(a.resizingEl.getBottom());
break;
case b.BOTTOM:a.el.setY(a.resizingEl.getTop()-a.el.getHeight());
break
}}};
CQ.Ext.SplitBar.VERTICAL=1;
CQ.Ext.SplitBar.HORIZONTAL=2;
CQ.Ext.SplitBar.LEFT=1;
CQ.Ext.SplitBar.RIGHT=2;
CQ.Ext.SplitBar.TOP=3;
CQ.Ext.SplitBar.BOTTOM=4;
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.Container=CQ.Ext.extend(CQ.Ext.BoxComponent,{bufferResize:50,autoDestroy:true,forceLayout:false,defaultType:"panel",resizeEvent:"resize",bubbleEvents:["add","remove"],initComponent:function(){CQ.Ext.Container.superclass.initComponent.call(this);
this.addEvents("afterlayout","beforeadd","beforeremove","add","remove");
var a=this.items;
if(a){delete this.items;
this.add(a)
}},initItems:function(){if(!this.items){this.items=new CQ.Ext.util.MixedCollection(false,this.getComponentId);
this.getLayout()
}},setLayout:function(a){if(this.layout&&this.layout!=a){this.layout.setContainer(null)
}this.layout=a;
this.initItems();
a.setContainer(this)
},afterRender:function(){CQ.Ext.Container.superclass.afterRender.call(this);
if(!this.layout){this.layout="auto"
}if(CQ.Ext.isObject(this.layout)&&!this.layout.layout){this.layoutConfig=this.layout;
this.layout=this.layoutConfig.type
}if(CQ.Ext.isString(this.layout)){this.layout=new CQ.Ext.Container.LAYOUTS[this.layout.toLowerCase()](this.layoutConfig)
}this.setLayout(this.layout);
if(this.activeItem!==undefined&&this.layout.setActiveItem){var a=this.activeItem;
delete this.activeItem;
this.layout.setActiveItem(a)
}if(!this.ownerCt){this.doLayout(false,true)
}if(this.monitorResize===true){CQ.Ext.EventManager.onWindowResize(this.doLayout,this,[false])
}},getLayoutTarget:function(){return this.el
},getComponentId:function(a){return a.getItemId()
},add:function(b){this.initItems();
var j=arguments.length>1;
if(j||CQ.Ext.isArray(b)){var a=[];
CQ.Ext.each(j?arguments:b,function(m){a.push(this.add(m))
},this);
return a
}var k=this.lookupComponent(this.applyDefaults(b));
var g=this.items.length;
if(this.fireEvent("beforeadd",this,k,g)!==false&&this.onBeforeAdd(k)!==false){this.items.add(k);
k.onAdded(this,g);
this.onAdd(k);
this.fireEvent("add",this,k,g)
}return k
},onAdd:function(a){},onAdded:function(a,b){this.ownerCt=a;
this.initRef();
this.cascade(function(g){g.initRef()
});
this.fireEvent("added",this,a,b)
},insert:function(j,b){var g=arguments,m=g.length,a=[],k,n;
this.initItems();
if(m>2){for(k=m-1;
k>=1;
--k){a.push(this.insert(j,g[k]))
}return a
}n=this.lookupComponent(this.applyDefaults(b));
j=Math.min(j,this.items.length);
if(this.fireEvent("beforeadd",this,n,j)!==false&&this.onBeforeAdd(n)!==false){if(n.ownerCt==this){this.items.remove(n)
}this.items.insert(j,n);
n.onAdded(this,j);
this.onAdd(n);
this.fireEvent("add",this,n,j)
}return n
},applyDefaults:function(b){var a=this.defaults;
if(a){if(CQ.Ext.isFunction(a)){a=a.call(this,b)
}if(CQ.Ext.isString(b)){b=CQ.Ext.ComponentMgr.get(b);
CQ.Ext.apply(b,a)
}else{if(!b.events){CQ.Ext.applyIf(b.isAction?b.initialConfig:b,a)
}else{CQ.Ext.apply(b,a)
}}}return b
},onBeforeAdd:function(a){if(a.ownerCt){a.ownerCt.remove(a,false)
}if(this.hideBorders===true){a.border=(a.border===true)
}},remove:function(a,b){this.initItems();
var g=this.getComponent(a);
if(g&&this.fireEvent("beforeremove",this,g)!==false){this.doRemove(g,b);
this.fireEvent("remove",this,g)
}return g
},onRemove:function(a){},doRemove:function(j,g){var b=this.layout,a=b&&this.rendered;
if(a){b.onRemove(j)
}this.items.remove(j);
j.onRemoved();
this.onRemove(j);
if(g===true||(g!==false&&this.autoDestroy)){j.destroy()
}if(a){b.afterRemove(j)
}},removeAll:function(c){this.initItems();
var j,k=[],b=[];
this.items.each(function(m){k.push(m)
});
for(var g=0,a=k.length;
g<a;
++g){j=k[g];
this.remove(j,c);
if(j.ownerCt!==this){b.push(j)
}}return b
},getComponent:function(a){if(CQ.Ext.isObject(a)){a=a.getItemId()
}return this.items.get(a)
},lookupComponent:function(a){if(CQ.Ext.isString(a)){return CQ.Ext.ComponentMgr.get(a)
}else{if(!a.events){return this.createComponent(a)
}}return a
},createComponent:function(a,g){if(a.render){return a
}var b=CQ.Ext.create(CQ.Ext.apply({ownerCt:this},a),g||this.defaultType);
delete b.initialConfig.ownerCt;
delete b.ownerCt;
return b
},canLayout:function(){var a=this.getVisibilityEl();
return a&&a.dom&&!a.isStyle("display","none")
},doLayout:function(k,j){var o=this.rendered,n=j||this.forceLayout;
if(this.collapsed||!this.canLayout()){this.deferLayout=this.deferLayout||!k;
if(!n){return
}k=k&&!this.deferLayout
}else{delete this.deferLayout
}if(o&&this.layout){this.layout.layout()
}if(k!==true&&this.items){var g=this.items.items;
for(var b=0,a=g.length;
b<a;
b++){var m=g[b];
if(m.doLayout){m.doLayout(false,n)
}}}if(o){this.onLayout(k,n)
}this.hasLayout=true;
delete this.forceLayout
},onLayout:CQ.Ext.emptyFn,shouldBufferLayout:function(){var a=this.hasLayout;
if(this.ownerCt){return a?!this.hasLayoutPending():false
}return a
},hasLayoutPending:function(){var a=false;
this.ownerCt.bubble(function(b){if(b.layoutPending){a=true;
return false
}});
return a
},onShow:function(){CQ.Ext.Container.superclass.onShow.call(this);
if(CQ.Ext.isDefined(this.deferLayout)){delete this.deferLayout;
this.doLayout(true)
}},getLayout:function(){if(!this.layout){var a=new CQ.Ext.layout.AutoLayout(this.layoutConfig);
this.setLayout(a)
}return this.layout
},beforeDestroy:function(){var a;
if(this.items){while(a=this.items.first()){this.doRemove(a,true)
}}if(this.monitorResize){CQ.Ext.EventManager.removeResizeListener(this.doLayout,this)
}CQ.Ext.destroy(this.layout);
CQ.Ext.Container.superclass.beforeDestroy.call(this)
},cascade:function(k,j,b){if(k.apply(j||this,b||[this])!==false){if(this.items){var g=this.items.items;
for(var c=0,a=g.length;
c<a;
c++){if(g[c].cascade){g[c].cascade(k,j,b)
}else{k.apply(j||g[c],b||[g[c]])
}}}}return this
},findById:function(c){var a=null,b=this;
this.cascade(function(g){if(b!=g&&g.id===c){a=g;
return false
}});
return a
},findByType:function(b,a){return this.findBy(function(g){return g.isXType(b,a)
})
},find:function(b,a){return this.findBy(function(g){return g[b]===a
})
},findBy:function(g,c){var a=[],b=this;
this.cascade(function(j){if(b!=j&&g.call(c||j,j,b)===true){a.push(j)
}});
return a
},get:function(a){return this.getComponent(a)
}});
CQ.Ext.Container.LAYOUTS={};
CQ.Ext.reg("container",CQ.Ext.Container);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.layout.ContainerLayout=CQ.Ext.extend(Object,{monitorResize:false,activeItem:null,constructor:function(a){this.id=CQ.Ext.id(null,"ext-layout-");
CQ.Ext.apply(this,a)
},type:"container",IEMeasureHack:function(m,g){var a=m.dom.childNodes,b=a.length,q,o=[],n,j,k;
for(j=0;
j<b;
j++){q=a[j];
n=CQ.Ext.get(q);
if(n){o[j]=n.getStyle("display");
n.setStyle({display:"none"})
}}k=m?m.getViewSize(g):{};
for(j=0;
j<b;
j++){q=a[j];
n=CQ.Ext.get(q);
if(n){n.setStyle({display:o[j]})
}}return k
},getLayoutTargetSize:CQ.Ext.EmptyFn,layout:function(){var a=this.container,b=a.getLayoutTarget();
if(!(this.hasLayout||CQ.Ext.isEmpty(this.targetCls))){b.addClass(this.targetCls)
}this.onLayout(a,b);
a.fireEvent("afterlayout",a,this)
},onLayout:function(a,b){this.renderAll(a,b)
},isValidParent:function(b,a){return a&&b.getPositionEl().dom.parentNode==(a.dom||a)
},renderAll:function(j,k){var b=j.items.items,g,m,a=b.length;
for(g=0;
g<a;
g++){m=b[g];
if(m&&(!m.rendered||!this.isValidParent(m,k))){this.renderItem(m,g,k)
}}},renderItem:function(g,a,b){if(g){if(!g.rendered){g.render(b,a);
this.configureItem(g)
}else{if(!this.isValidParent(g,b)){if(CQ.Ext.isNumber(a)){a=b.dom.childNodes[a]
}b.dom.insertBefore(g.getPositionEl().dom,a||null);
g.container=b;
this.configureItem(g)
}}}},getRenderedItems:function(k){var j=k.getLayoutTarget(),m=k.items.items,a=m.length,g,n,b=[];
for(g=0;
g<a;
g++){if((n=m[g]).rendered&&this.isValidParent(n,j)&&n.shouldLayout!==false){b.push(n)
}}return b
},configureItem:function(b){if(this.extraCls){var a=b.getPositionEl?b.getPositionEl():b;
a.addClass(this.extraCls)
}if(b.doLayout&&this.forceLayout){b.doLayout()
}if(this.renderHidden&&b!=this.activeItem){b.hide()
}},onRemove:function(b){if(this.activeItem==b){delete this.activeItem
}if(b.rendered&&this.extraCls){var a=b.getPositionEl?b.getPositionEl():b;
a.removeClass(this.extraCls)
}},afterRemove:function(a){if(a.removeRestore){a.removeMode="container";
delete a.removeRestore
}},onResize:function(){var c=this.container,a;
if(c.collapsed){return
}if(a=c.bufferResize&&c.shouldBufferLayout()){if(!this.resizeTask){this.resizeTask=new CQ.Ext.util.DelayedTask(this.runLayout,this);
this.resizeBuffer=CQ.Ext.isNumber(a)?a:50
}c.layoutPending=true;
this.resizeTask.delay(this.resizeBuffer)
}else{this.runLayout()
}},runLayout:function(){var a=this.container;
this.layout();
a.onLayout();
delete a.layoutPending
},setContainer:function(b){if(this.monitorResize&&b!=this.container){var a=this.container;
if(a){a.un(a.resizeEvent,this.onResize,this)
}if(b){b.on(b.resizeEvent,this.onResize,this)
}}this.container=b
},parseMargins:function(b){if(CQ.Ext.isNumber(b)){b=b.toString()
}var c=b.split(" "),a=c.length;
if(a==1){c[1]=c[2]=c[3]=c[0]
}else{if(a==2){c[2]=c[0];
c[3]=c[1]
}else{if(a==3){c[3]=c[1]
}}}return{top:parseInt(c[0],10)||0,right:parseInt(c[1],10)||0,bottom:parseInt(c[2],10)||0,left:parseInt(c[3],10)||0}
},fieldTpl:(function(){var a=new CQ.Ext.Template('<div class="x-form-item {itemCls}" tabIndex="-1">','<label for="{id}" style="{labelStyle}" class="x-form-item-label">{label}{labelSeparator}</label>','<div class="x-form-element" id="x-form-el-{id}" style="{elementStyle}">','</div><div class="{clearCls}"></div>',"</div>");
a.disableFormats=true;
return a.compile()
})(),destroy:function(){if(this.resizeTask&&this.resizeTask.cancel){this.resizeTask.cancel()
}if(this.container){this.container.un(this.container.resizeEvent,this.onResize,this)
}if(!CQ.Ext.isEmpty(this.targetCls)){var a=this.container.getLayoutTarget();
if(a){a.removeClass(this.targetCls)
}}}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.layout.AutoLayout=CQ.Ext.extend(CQ.Ext.layout.ContainerLayout,{type:"auto",monitorResize:true,onLayout:function(g,k){CQ.Ext.layout.AutoLayout.superclass.onLayout.call(this,g,k);
var j=this.getRenderedItems(g),a=j.length,b,m;
for(b=0;
b<a;
b++){m=j[b];
if(m.doLayout){m.doLayout(true)
}}}});
CQ.Ext.Container.LAYOUTS.auto=CQ.Ext.layout.AutoLayout;
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.layout.FitLayout=CQ.Ext.extend(CQ.Ext.layout.ContainerLayout,{monitorResize:true,type:"fit",getLayoutTargetSize:function(){var a=this.container.getLayoutTarget();
if(!a){return{}
}return a.getStyleSize()
},onLayout:function(a,b){CQ.Ext.layout.FitLayout.superclass.onLayout.call(this,a,b);
if(!a.collapsed){this.setItemSize(this.activeItem||a.items.itemAt(0),this.getLayoutTargetSize())
}},setItemSize:function(b,a){if(b&&a.height>0){b.setSize(a)
}}});
CQ.Ext.Container.LAYOUTS.fit=CQ.Ext.layout.FitLayout;
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.layout.CardLayout=CQ.Ext.extend(CQ.Ext.layout.FitLayout,{deferredRender:false,layoutOnCardChange:false,renderHidden:true,type:"card",setActiveItem:function(g){var a=this.activeItem,b=this.container;
g=b.getComponent(g);
if(g&&a!=g){if(a){a.hide();
if(a.hidden!==true){return false
}a.fireEvent("deactivate",a)
}var c=g.doLayout&&(this.layoutOnCardChange||!g.rendered);
this.activeItem=g;
delete g.deferLayout;
g.show();
this.layout();
if(c){g.doLayout()
}g.fireEvent("activate",g)
}},renderAll:function(a,b){if(this.deferredRender){this.renderItem(this.activeItem,undefined,b)
}else{CQ.Ext.layout.CardLayout.superclass.renderAll.call(this,a,b)
}}});
CQ.Ext.Container.LAYOUTS.card=CQ.Ext.layout.CardLayout;
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.layout.AnchorLayout=CQ.Ext.extend(CQ.Ext.layout.ContainerLayout,{monitorResize:true,type:"anchor",defaultAnchor:"100%",parseAnchorRE:/^(r|right|b|bottom)$/i,getLayoutTargetSize:function(){var b=this.container.getLayoutTarget(),a={};
if(b){a=b.getViewSize();
if(CQ.Ext.isIE&&CQ.Ext.isStrict&&a.width==0){a=b.getStyleSize()
}a.width-=b.getPadding("lr");
a.height-=b.getPadding("tb")
}return a
},onLayout:function(r,C){CQ.Ext.layout.AnchorLayout.superclass.onLayout.call(this,r,C);
var v=this.getLayoutTargetSize(),o=v.width,u=v.height,w=C.getStyle("overflow"),t=this.getRenderedItems(r),z=t.length,k=[],n,a,B,q,m,c,j,g,A=0,y,b;
if(o<20&&u<20){return
}if(r.anchorSize){if(typeof r.anchorSize=="number"){a=r.anchorSize
}else{a=r.anchorSize.width;
B=r.anchorSize.height
}}else{a=r.initialConfig.width;
B=r.initialConfig.height
}for(y=0;
y<z;
y++){q=t[y];
b=q.getPositionEl();
if(!q.anchor&&q.items&&!CQ.Ext.isNumber(q.width)&&!(CQ.Ext.isIE6&&CQ.Ext.isStrict)){q.anchor=this.defaultAnchor
}if(q.anchor){m=q.anchorSpec;
if(!m){g=q.anchor.split(" ");
q.anchorSpec=m={right:this.parseAnchor(g[0],q.initialConfig.width,a),bottom:this.parseAnchor(g[1],q.initialConfig.height,B)}
}c=m.right?this.adjustWidthAnchor(m.right(o)-b.getMargins("lr"),q):undefined;
j=m.bottom?this.adjustHeightAnchor(m.bottom(u)-b.getMargins("tb"),q):undefined;
if(c||j){k.push({component:q,width:c||undefined,height:j||undefined})
}}}for(y=0,z=k.length;
y<z;
y++){n=k[y];
n.component.setSize(n.width,n.height)
}if(w&&w!="hidden"&&!this.adjustmentPass){var x=this.getLayoutTargetSize();
if(x.width!=v.width||x.height!=v.height){this.adjustmentPass=true;
this.onLayout(r,C)
}}delete this.adjustmentPass
},parseAnchor:function(c,m,b){if(c&&c!="none"){var j;
if(this.parseAnchorRE.test(c)){var k=b-m;
return function(a){if(a!==j){j=a;
return a-k
}}
}else{if(c.indexOf("%")!=-1){var g=parseFloat(c.replace("%",""))*0.01;
return function(a){if(a!==j){j=a;
return Math.floor(a*g)
}}
}else{c=parseInt(c,10);
if(!isNaN(c)){return function(a){if(a!==j){j=a;
return a+c
}}
}}}}return false
},adjustWidthAnchor:function(b,a){return b
},adjustHeightAnchor:function(b,a){return b
}});
CQ.Ext.Container.LAYOUTS.anchor=CQ.Ext.layout.AnchorLayout;
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.layout.ColumnLayout=CQ.Ext.extend(CQ.Ext.layout.ContainerLayout,{monitorResize:true,type:"column",extraCls:"x-column",scrollOffset:0,targetCls:"x-column-layout-ct",isValidParent:function(b,a){return this.innerCt&&b.getPositionEl().dom.parentNode==this.innerCt.dom
},getLayoutTargetSize:function(){var b=this.container.getLayoutTarget(),a;
if(b){a=b.getViewSize();
if(CQ.Ext.isIE&&CQ.Ext.isStrict&&a.width==0){a=b.getStyleSize()
}a.width-=b.getPadding("lr");
a.height-=b.getPadding("tb")
}return a
},renderAll:function(a,b){if(!this.innerCt){this.innerCt=b.createChild({cls:"x-column-inner"});
this.innerCt.createChild({cls:"x-clear"})
}CQ.Ext.layout.ColumnLayout.superclass.renderAll.call(this,a,this.innerCt)
},onLayout:function(j,o){var k=j.items.items,n=k.length,r,b,a,t=[];
this.renderAll(j,o);
var x=this.getLayoutTargetSize();
if(x.width<1&&x.height<1){return
}var u=x.width-this.scrollOffset,g=x.height,v=u;
this.innerCt.setWidth(u);
for(b=0;
b<n;
b++){r=k[b];
a=r.getPositionEl().getMargins("lr");
t[b]=a;
if(!r.columnWidth){v-=(r.getWidth()+a)
}}v=v<0?0:v;
for(b=0;
b<n;
b++){r=k[b];
a=t[b];
if(r.columnWidth){r.setSize(Math.floor(r.columnWidth*v)-a)
}}if(CQ.Ext.isIE){if(b=o.getStyle("overflow")&&b!="hidden"&&!this.adjustmentPass){var q=this.getLayoutTargetSize();
if(q.width!=x.width){this.adjustmentPass=true;
this.onLayout(j,o)
}}}delete this.adjustmentPass
}});
CQ.Ext.Container.LAYOUTS.column=CQ.Ext.layout.ColumnLayout;
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.layout.BorderLayout=CQ.Ext.extend(CQ.Ext.layout.ContainerLayout,{monitorResize:true,rendered:false,type:"border",targetCls:"x-border-layout-ct",getLayoutTargetSize:function(){var a=this.container.getLayoutTarget();
return a?a.getViewSize():{}
},onLayout:function(j,L){var k,E,I,r,A=j.items.items,F=A.length;
if(!this.rendered){k=[];
for(E=0;
E<F;
E++){I=A[E];
r=I.region;
if(I.collapsed){k.push(I)
}I.collapsed=false;
if(!I.rendered){I.render(L,E);
I.getPositionEl().addClass("x-border-panel")
}this[r]=r!="center"&&I.split?new CQ.Ext.layout.BorderLayout.SplitRegion(this,I.initialConfig,r):new CQ.Ext.layout.BorderLayout.Region(this,I.initialConfig,r);
this[r].render(L,I)
}this.rendered=true
}var z=this.getLayoutTargetSize();
if(z.width<20||z.height<20){if(k){this.restoreCollapsed=k
}return
}else{if(this.restoreCollapsed){k=this.restoreCollapsed;
delete this.restoreCollapsed
}}var x=z.width,G=z.height,v=x,D=G,t=0,u=0,B=this.north,y=this.south,q=this.west,H=this.east,I=this.center,K,C,g,J;
if(!I&&CQ.Ext.layout.BorderLayout.WARN!==false){throw"No center region defined in BorderLayout "+j.id
}if(B&&B.isVisible()){K=B.getSize();
C=B.getMargins();
K.width=x-(C.left+C.right);
K.x=C.left;
K.y=C.top;
t=K.height+K.y+C.bottom;
D-=t;
B.applyLayout(K)
}if(y&&y.isVisible()){K=y.getSize();
C=y.getMargins();
K.width=x-(C.left+C.right);
K.x=C.left;
J=(K.height+C.top+C.bottom);
K.y=G-J+C.top;
D-=J;
y.applyLayout(K)
}if(q&&q.isVisible()){K=q.getSize();
C=q.getMargins();
K.height=D-(C.top+C.bottom);
K.x=C.left;
K.y=t+C.top;
g=(K.width+C.left+C.right);
u+=g;
v-=g;
q.applyLayout(K)
}if(H&&H.isVisible()){K=H.getSize();
C=H.getMargins();
K.height=D-(C.top+C.bottom);
g=(K.width+C.left+C.right);
K.x=x-g+C.left;
K.y=t+C.top;
v-=g;
H.applyLayout(K)
}if(I){C=I.getMargins();
var o={x:u+C.left,y:t+C.top,width:v-(C.left+C.right),height:D-(C.top+C.bottom)};
I.applyLayout(o)
}if(k){for(E=0,F=k.length;
E<F;
E++){k[E].collapse(false)
}}if(CQ.Ext.isIE&&CQ.Ext.isStrict){L.repaint()
}if(E=L.getStyle("overflow")&&E!="hidden"&&!this.adjustmentPass){var a=this.getLayoutTargetSize();
if(a.width!=z.width||a.height!=z.height){this.adjustmentPass=true;
this.onLayout(j,L)
}}delete this.adjustmentPass
},destroy:function(){var b=["north","south","east","west"],a,c;
for(a=0;
a<b.length;
a++){c=this[b[a]];
if(c){if(c.destroy){c.destroy()
}else{if(c.split){c.split.destroy(true)
}}}}CQ.Ext.layout.BorderLayout.superclass.destroy.call(this)
}});
CQ.Ext.layout.BorderLayout.Region=function(b,a,c){CQ.Ext.apply(this,a);
this.layout=b;
this.position=c;
this.state={};
if(typeof this.margins=="string"){this.margins=this.layout.parseMargins(this.margins)
}this.margins=CQ.Ext.applyIf(this.margins||{},this.defaultMargins);
if(this.collapsible){if(typeof this.cmargins=="string"){this.cmargins=this.layout.parseMargins(this.cmargins)
}if(this.collapseMode=="mini"&&!this.cmargins){this.cmargins={left:0,top:0,right:0,bottom:0}
}else{this.cmargins=CQ.Ext.applyIf(this.cmargins||{},c=="north"||c=="south"?this.defaultNSCMargins:this.defaultEWCMargins)
}}};
CQ.Ext.layout.BorderLayout.Region.prototype={collapsible:false,split:false,floatable:true,minWidth:50,minHeight:50,defaultMargins:{left:0,top:0,right:0,bottom:0},defaultNSCMargins:{left:5,top:5,right:5,bottom:5},defaultEWCMargins:{left:5,top:0,right:5,bottom:0},floatingZIndex:100,isCollapsed:false,render:function(b,c){this.panel=c;
c.el.enableDisplayMode();
this.targetEl=b;
this.el=c.el;
var a=c.getState,g=this.position;
c.getState=function(){return CQ.Ext.apply(a.call(c)||{},this.state)
}.createDelegate(this);
if(g!="center"){c.allowQueuedExpand=false;
c.on({beforecollapse:this.beforeCollapse,collapse:this.onCollapse,beforeexpand:this.beforeExpand,expand:this.onExpand,hide:this.onHide,show:this.onShow,scope:this});
if(this.collapsible||this.floatable){c.collapseEl="el";
c.slideAnchor=this.getSlideAnchor()
}if(c.tools&&c.tools.toggle){c.tools.toggle.addClass("x-tool-collapse-"+g);
c.tools.toggle.addClassOnOver("x-tool-collapse-"+g+"-over")
}}},getCollapsedEl:function(){if(!this.collapsedEl){if(!this.toolTemplate){var b=new CQ.Ext.Template('<div class="x-tool x-tool-{id}">&#160;</div>');
b.disableFormats=true;
b.compile();
CQ.Ext.layout.BorderLayout.Region.prototype.toolTemplate=b
}this.collapsedEl=this.targetEl.createChild({cls:"x-layout-collapsed x-layout-collapsed-"+this.position,id:this.panel.id+"-xcollapsed"});
this.collapsedEl.enableDisplayMode("block");
if(this.collapseMode=="mini"){this.collapsedEl.addClass("x-layout-cmini-"+this.position);
this.miniCollapsedEl=this.collapsedEl.createChild({cls:"x-layout-mini x-layout-mini-"+this.position,html:"&#160;"});
this.miniCollapsedEl.addClassOnOver("x-layout-mini-over");
this.collapsedEl.addClassOnOver("x-layout-collapsed-over");
this.collapsedEl.on("click",this.onExpandClick,this,{stopEvent:true})
}else{if(this.collapsible!==false&&!this.hideCollapseTool){var a=this.expandToolEl=this.toolTemplate.append(this.collapsedEl.dom,{id:"expand-"+this.position},true);
a.addClassOnOver("x-tool-expand-"+this.position+"-over");
a.on("click",this.onExpandClick,this,{stopEvent:true})
}if(this.floatable!==false||this.titleCollapse){this.collapsedEl.addClassOnOver("x-layout-collapsed-over");
this.collapsedEl.on("click",this[this.floatable?"collapseClick":"onExpandClick"],this)
}}}return this.collapsedEl
},onExpandClick:function(a){if(this.isSlid){this.panel.expand(false)
}else{this.panel.expand()
}},onCollapseClick:function(a){this.panel.collapse()
},beforeCollapse:function(c,a){this.lastAnim=a;
if(this.splitEl){this.splitEl.hide()
}this.getCollapsedEl().show();
var b=this.panel.getEl();
this.originalZIndex=b.getStyle("z-index");
b.setStyle("z-index",100);
this.isCollapsed=true;
this.layout.layout()
},onCollapse:function(a){this.panel.el.setStyle("z-index",1);
if(this.lastAnim===false||this.panel.animCollapse===false){this.getCollapsedEl().dom.style.visibility="visible"
}else{this.getCollapsedEl().slideIn(this.panel.slideAnchor,{duration:0.2})
}this.state.collapsed=true;
this.panel.saveState()
},beforeExpand:function(a){if(this.isSlid){this.afterSlideIn()
}var b=this.getCollapsedEl();
this.el.show();
if(this.position=="east"||this.position=="west"){this.panel.setSize(undefined,b.getHeight())
}else{this.panel.setSize(b.getWidth(),undefined)
}b.hide();
b.dom.style.visibility="hidden";
this.panel.el.setStyle("z-index",this.floatingZIndex)
},onExpand:function(){this.isCollapsed=false;
if(this.splitEl){this.splitEl.show()
}this.layout.layout();
this.panel.el.setStyle("z-index",this.originalZIndex);
this.state.collapsed=false;
this.panel.saveState()
},collapseClick:function(a){if(this.isSlid){a.stopPropagation();
this.slideIn()
}else{a.stopPropagation();
this.slideOut()
}},onHide:function(){if(this.isCollapsed){this.getCollapsedEl().hide()
}else{if(this.splitEl){this.splitEl.hide()
}}},onShow:function(){if(this.isCollapsed){this.getCollapsedEl().show()
}else{if(this.splitEl){this.splitEl.show()
}}},isVisible:function(){return !this.panel.hidden
},getMargins:function(){return this.isCollapsed&&this.cmargins?this.cmargins:this.margins
},getSize:function(){return this.isCollapsed?this.getCollapsedEl().getSize():this.panel.getSize()
},setPanel:function(a){this.panel=a
},getMinWidth:function(){return this.minWidth
},getMinHeight:function(){return this.minHeight
},applyLayoutCollapsed:function(a){var b=this.getCollapsedEl();
b.setLeftTop(a.x,a.y);
b.setSize(a.width,a.height)
},applyLayout:function(a){if(this.isCollapsed){this.applyLayoutCollapsed(a)
}else{this.panel.setPosition(a.x,a.y);
this.panel.setSize(a.width,a.height)
}},beforeSlide:function(){this.panel.beforeEffect()
},afterSlide:function(){this.panel.afterEffect()
},initAutoHide:function(){if(this.autoHide!==false){if(!this.autoHideHd){this.autoHideSlideTask=new CQ.Ext.util.DelayedTask(this.slideIn,this);
this.autoHideHd={mouseout:function(a){if(!a.within(this.el,true)){this.autoHideSlideTask.delay(500)
}},mouseover:function(a){this.autoHideSlideTask.cancel()
},scope:this}
}this.el.on(this.autoHideHd);
this.collapsedEl.on(this.autoHideHd)
}},clearAutoHide:function(){if(this.autoHide!==false){this.el.un("mouseout",this.autoHideHd.mouseout);
this.el.un("mouseover",this.autoHideHd.mouseover);
this.collapsedEl.un("mouseout",this.autoHideHd.mouseout);
this.collapsedEl.un("mouseover",this.autoHideHd.mouseover)
}},clearMonitor:function(){CQ.Ext.getDoc().un("click",this.slideInIf,this)
},slideOut:function(){if(this.isSlid||this.el.hasActiveFx()){return
}this.isSlid=true;
var b=this.panel.tools,c,a;
if(b&&b.toggle){b.toggle.hide()
}this.el.show();
a=this.panel.collapsed;
this.panel.collapsed=false;
if(this.position=="east"||this.position=="west"){c=this.panel.deferHeight;
this.panel.deferHeight=false;
this.panel.setSize(undefined,this.collapsedEl.getHeight());
this.panel.deferHeight=c
}else{this.panel.setSize(this.collapsedEl.getWidth(),undefined)
}this.panel.collapsed=a;
this.restoreLT=[this.el.dom.style.left,this.el.dom.style.top];
this.el.alignTo(this.collapsedEl,this.getCollapseAnchor());
this.el.setStyle("z-index",this.floatingZIndex+2);
this.panel.el.replaceClass("x-panel-collapsed","x-panel-floating");
if(this.animFloat!==false){this.beforeSlide();
this.el.slideIn(this.getSlideAnchor(),{callback:function(){this.afterSlide();
this.initAutoHide();
CQ.Ext.getDoc().on("click",this.slideInIf,this)
},scope:this,block:true})
}else{this.initAutoHide();
CQ.Ext.getDoc().on("click",this.slideInIf,this)
}},afterSlideIn:function(){this.clearAutoHide();
this.isSlid=false;
this.clearMonitor();
this.el.setStyle("z-index","");
this.panel.el.replaceClass("x-panel-floating","x-panel-collapsed");
this.el.dom.style.left=this.restoreLT[0];
this.el.dom.style.top=this.restoreLT[1];
var a=this.panel.tools;
if(a&&a.toggle){a.toggle.show()
}},slideIn:function(a){if(!this.isSlid||this.el.hasActiveFx()){CQ.Ext.callback(a);
return
}this.isSlid=false;
if(this.animFloat!==false){this.beforeSlide();
this.el.slideOut(this.getSlideAnchor(),{callback:function(){this.el.hide();
this.afterSlide();
this.afterSlideIn();
CQ.Ext.callback(a)
},scope:this,block:true})
}else{this.el.hide();
this.afterSlideIn()
}},slideInIf:function(a){if(!a.within(this.el)){this.slideIn()
}},anchors:{west:"left",east:"right",north:"top",south:"bottom"},sanchors:{west:"l",east:"r",north:"t",south:"b"},canchors:{west:"tl-tr",east:"tr-tl",north:"tl-bl",south:"bl-tl"},getAnchor:function(){return this.anchors[this.position]
},getCollapseAnchor:function(){return this.canchors[this.position]
},getSlideAnchor:function(){return this.sanchors[this.position]
},getAlignAdj:function(){var a=this.cmargins;
switch(this.position){case"west":return[0,0];
break;
case"east":return[0,0];
break;
case"north":return[0,0];
break;
case"south":return[0,0];
break
}},getExpandAdj:function(){var b=this.collapsedEl,a=this.cmargins;
switch(this.position){case"west":return[-(a.right+b.getWidth()+a.left),0];
break;
case"east":return[a.right+b.getWidth()+a.left,0];
break;
case"north":return[0,-(a.top+a.bottom+b.getHeight())];
break;
case"south":return[0,a.top+a.bottom+b.getHeight()];
break
}},destroy:function(){if(this.autoHideSlideTask&&this.autoHideSlideTask.cancel){this.autoHideSlideTask.cancel()
}CQ.Ext.destroyMembers(this,"miniCollapsedEl","collapsedEl","expandToolEl")
}};
CQ.Ext.layout.BorderLayout.SplitRegion=function(b,a,c){CQ.Ext.layout.BorderLayout.SplitRegion.superclass.constructor.call(this,b,a,c);
this.applyLayout=this.applyFns[c]
};
CQ.Ext.extend(CQ.Ext.layout.BorderLayout.SplitRegion,CQ.Ext.layout.BorderLayout.Region,{splitTip:"Drag to resize.",collapsibleSplitTip:"Drag to resize. Double click to hide.",useSplitTips:false,splitSettings:{north:{orientation:CQ.Ext.SplitBar.VERTICAL,placement:CQ.Ext.SplitBar.TOP,maxFn:"getVMaxSize",minProp:"minHeight",maxProp:"maxHeight"},south:{orientation:CQ.Ext.SplitBar.VERTICAL,placement:CQ.Ext.SplitBar.BOTTOM,maxFn:"getVMaxSize",minProp:"minHeight",maxProp:"maxHeight"},east:{orientation:CQ.Ext.SplitBar.HORIZONTAL,placement:CQ.Ext.SplitBar.RIGHT,maxFn:"getHMaxSize",minProp:"minWidth",maxProp:"maxWidth"},west:{orientation:CQ.Ext.SplitBar.HORIZONTAL,placement:CQ.Ext.SplitBar.LEFT,maxFn:"getHMaxSize",minProp:"minWidth",maxProp:"maxWidth"}},applyFns:{west:function(c){if(this.isCollapsed){return this.applyLayoutCollapsed(c)
}var g=this.splitEl.dom,b=g.style;
this.panel.setPosition(c.x,c.y);
var a=g.offsetWidth;
b.left=(c.x+c.width-a)+"px";
b.top=(c.y)+"px";
b.height=Math.max(0,c.height)+"px";
this.panel.setSize(c.width-a,c.height)
},east:function(c){if(this.isCollapsed){return this.applyLayoutCollapsed(c)
}var g=this.splitEl.dom,b=g.style;
var a=g.offsetWidth;
this.panel.setPosition(c.x+a,c.y);
b.left=(c.x)+"px";
b.top=(c.y)+"px";
b.height=Math.max(0,c.height)+"px";
this.panel.setSize(c.width-a,c.height)
},north:function(c){if(this.isCollapsed){return this.applyLayoutCollapsed(c)
}var g=this.splitEl.dom,b=g.style;
var a=g.offsetHeight;
this.panel.setPosition(c.x,c.y);
b.left=(c.x)+"px";
b.top=(c.y+c.height-a)+"px";
b.width=Math.max(0,c.width)+"px";
this.panel.setSize(c.width,c.height-a)
},south:function(c){if(this.isCollapsed){return this.applyLayoutCollapsed(c)
}var g=this.splitEl.dom,b=g.style;
var a=g.offsetHeight;
this.panel.setPosition(c.x,c.y+a);
b.left=(c.x)+"px";
b.top=(c.y)+"px";
b.width=Math.max(0,c.width)+"px";
this.panel.setSize(c.width,c.height-a)
}},render:function(a,c){CQ.Ext.layout.BorderLayout.SplitRegion.superclass.render.call(this,a,c);
var g=this.position;
this.splitEl=a.createChild({cls:"x-layout-split x-layout-split-"+g,html:"&#160;",id:this.panel.id+"-xsplit"});
if(this.collapseMode=="mini"){this.miniSplitEl=this.splitEl.createChild({cls:"x-layout-mini x-layout-mini-"+g,html:"&#160;"});
this.miniSplitEl.addClassOnOver("x-layout-mini-over");
this.miniSplitEl.on("click",this.onCollapseClick,this,{stopEvent:true})
}var b=this.splitSettings[g];
this.split=new CQ.Ext.SplitBar(this.splitEl.dom,c.el,b.orientation);
this.split.tickSize=this.tickSize;
this.split.placement=b.placement;
this.split.getMaximumSize=this[b.maxFn].createDelegate(this);
this.split.minSize=this.minSize||this[b.minProp];
this.split.on("beforeapply",this.onSplitMove,this);
this.split.useShim=this.useShim===true;
this.maxSize=this.maxSize||this[b.maxProp];
if(c.hidden){this.splitEl.hide()
}if(this.useSplitTips){this.splitEl.dom.title=this.collapsible?this.collapsibleSplitTip:this.splitTip
}if(this.collapsible){this.splitEl.on("dblclick",this.onCollapseClick,this)
}},getSize:function(){if(this.isCollapsed){return this.collapsedEl.getSize()
}var a=this.panel.getSize();
if(this.position=="north"||this.position=="south"){a.height+=this.splitEl.dom.offsetHeight
}else{a.width+=this.splitEl.dom.offsetWidth
}return a
},getHMaxSize:function(){var b=this.maxSize||10000;
var a=this.layout.center;
return Math.min(b,(this.el.getWidth()+a.el.getWidth())-a.getMinWidth())
},getVMaxSize:function(){var b=this.maxSize||10000;
var a=this.layout.center;
return Math.min(b,(this.el.getHeight()+a.el.getHeight())-a.getMinHeight())
},onSplitMove:function(b,a){var c=this.panel.getSize();
this.lastSplitSize=a;
if(this.position=="north"||this.position=="south"){this.panel.setSize(c.width,a);
this.state.height=a
}else{this.panel.setSize(a,c.height);
this.state.width=a
}this.layout.layout();
this.panel.saveState();
return false
},getSplitBar:function(){return this.split
},destroy:function(){CQ.Ext.destroy(this.miniSplitEl,this.split,this.splitEl);
CQ.Ext.layout.BorderLayout.SplitRegion.superclass.destroy.call(this)
}});
CQ.Ext.Container.LAYOUTS.border=CQ.Ext.layout.BorderLayout;
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.layout.FormLayout=CQ.Ext.extend(CQ.Ext.layout.AnchorLayout,{labelSeparator:":",trackLabels:true,type:"form",onRemove:function(g){CQ.Ext.layout.FormLayout.superclass.onRemove.call(this,g);
if(this.trackLabels){g.un("show",this.onFieldShow,this);
g.un("hide",this.onFieldHide,this)
}var b=g.getPositionEl(),a=g.getItemCt&&g.getItemCt();
if(g.rendered&&a){if(b&&b.dom){b.insertAfter(a)
}CQ.Ext.destroy(a);
CQ.Ext.destroyMembers(g,"label","itemCt");
if(g.customItemCt){CQ.Ext.destroyMembers(g,"getItemCt","customItemCt")
}}},setContainer:function(a){CQ.Ext.layout.FormLayout.superclass.setContainer.call(this,a);
if(a.labelAlign){a.addClass("x-form-label-"+a.labelAlign)
}if(a.hideLabels){CQ.Ext.apply(this,{labelStyle:"display:none",elementStyle:"padding-left:0;",labelAdjust:0})
}else{this.labelSeparator=CQ.Ext.isDefined(a.labelSeparator)?a.labelSeparator:this.labelSeparator;
a.labelWidth=a.labelWidth||100;
if(CQ.Ext.isNumber(a.labelWidth)){var b=CQ.Ext.isNumber(a.labelPad)?a.labelPad:5;
CQ.Ext.apply(this,{labelAdjust:a.labelWidth+b,labelStyle:"width:"+a.labelWidth+"px;",elementStyle:"padding-left:"+(a.labelWidth+b)+"px"})
}if(a.labelAlign=="top"){CQ.Ext.apply(this,{labelStyle:"width:auto;",labelAdjust:0,elementStyle:"padding-left:0;"})
}}},isHide:function(a){return a.hideLabel||this.container.hideLabels
},onFieldShow:function(a){a.getItemCt().removeClass("x-hide-"+a.hideMode);
if(a.isComposite){a.doLayout()
}},onFieldHide:function(a){a.getItemCt().addClass("x-hide-"+a.hideMode)
},getLabelStyle:function(j){var b="",c=[this.labelStyle,j];
for(var g=0,a=c.length;
g<a;
++g){if(c[g]){b+=c[g];
if(b.substr(-1,1)!=";"){b+=";"
}}}return b
},renderItem:function(j,a,g){if(j&&(j.isFormField||j.fieldLabel)&&j.inputType!="hidden"){var b=this.getTemplateArgs(j);
if(CQ.Ext.isNumber(a)){a=g.dom.childNodes[a]||null
}if(a){j.itemCt=this.fieldTpl.insertBefore(a,b,true)
}else{j.itemCt=this.fieldTpl.append(g,b,true)
}if(!j.getItemCt){CQ.Ext.apply(j,{getItemCt:function(){return j.itemCt
},customItemCt:true})
}j.label=j.getItemCt().child("label.x-form-item-label");
if(!j.rendered){j.render("x-form-el-"+j.id)
}else{if(!this.isValidParent(j,g)){CQ.Ext.fly("x-form-el-"+j.id).appendChild(j.getPositionEl())
}}if(this.trackLabels){if(j.hidden){this.onFieldHide(j)
}j.on({scope:this,show:this.onFieldShow,hide:this.onFieldHide})
}this.configureItem(j)
}else{CQ.Ext.layout.FormLayout.superclass.renderItem.apply(this,arguments)
}},getTemplateArgs:function(c){var a=!c.fieldLabel||c.hideLabel,b=(c.itemCls||this.container.itemCls||"")+(c.hideLabel?" x-hide-label":"");
if(CQ.Ext.isIE9&&CQ.Ext.isIEQuirks&&c instanceof CQ.Ext.form.TextField){b+=" x-input-wrapper"
}return{id:c.id,label:c.fieldLabel,itemCls:b,clearCls:c.clearCls||"x-form-clear-left",labelStyle:this.getLabelStyle(c.labelStyle),elementStyle:this.elementStyle||"",labelSeparator:a?"":(CQ.Ext.isDefined(c.labelSeparator)?c.labelSeparator:this.labelSeparator)}
},adjustWidthAnchor:function(a,g){if(g.label&&!this.isHide(g)&&(this.container.labelAlign!="top")){var b=CQ.Ext.isIE6||(CQ.Ext.isIE&&!CQ.Ext.isStrict);
return a-this.labelAdjust+(b?-3:0)
}return a
},adjustHeightAnchor:function(a,b){if(b.label&&!this.isHide(b)&&(this.container.labelAlign=="top")){return a-b.label.getHeight()
}return a
},isValidParent:function(b,a){return a&&this.container.getEl().contains(b.getPositionEl())
}});
CQ.Ext.Container.LAYOUTS.form=CQ.Ext.layout.FormLayout;
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.layout.AccordionLayout=CQ.Ext.extend(CQ.Ext.layout.FitLayout,{fill:true,autoWidth:true,titleCollapse:true,hideCollapseTool:false,collapseFirst:false,animate:false,sequence:false,activeOnTop:false,type:"accordion",renderItem:function(a){if(this.animate===false){a.animCollapse=false
}a.collapsible=true;
if(this.autoWidth){a.autoWidth=true
}if(this.titleCollapse){a.titleCollapse=true
}if(this.hideCollapseTool){a.hideCollapseTool=true
}if(this.collapseFirst!==undefined){a.collapseFirst=this.collapseFirst
}if(!this.activeItem&&!a.collapsed){this.setActiveItem(a,true)
}else{if(this.activeItem&&this.activeItem!=a){a.collapsed=true
}}CQ.Ext.layout.AccordionLayout.superclass.renderItem.apply(this,arguments);
a.header.addClass("x-accordion-hd");
a.on("beforeexpand",this.beforeExpand,this)
},onRemove:function(a){CQ.Ext.layout.AccordionLayout.superclass.onRemove.call(this,a);
if(a.rendered){a.header.removeClass("x-accordion-hd")
}a.un("beforeexpand",this.beforeExpand,this)
},beforeExpand:function(c,b){var a=this.activeItem;
if(a){if(this.sequence){delete this.activeItem;
if(!a.collapsed){a.collapse({callback:function(){c.expand(b||true)
},scope:this});
return false
}}else{a.collapse(this.animate)
}}this.setActive(c);
if(this.activeOnTop){c.el.dom.parentNode.insertBefore(c.el.dom,c.el.dom.parentNode.firstChild)
}this.layout()
},setItemSize:function(k,j){if(this.fill&&k){var g=0,c,b=this.getRenderedItems(this.container),a=b.length,m;
for(c=0;
c<a;
c++){if((m=b[c])!=k&&!m.hidden){g+=m.header.getHeight()
}}j.height-=g;
k.setSize(j)
}},setActiveItem:function(a){this.setActive(a,true)
},setActive:function(c,b){var a=this.activeItem;
c=this.container.getComponent(c);
if(a!=c){if(c.rendered&&c.collapsed&&b){c.expand()
}else{if(a){a.fireEvent("deactivate",a)
}this.activeItem=c;
c.fireEvent("activate",c)
}}}});
CQ.Ext.Container.LAYOUTS.accordion=CQ.Ext.layout.AccordionLayout;
CQ.Ext.layout.Accordion=CQ.Ext.layout.AccordionLayout;
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.layout.TableLayout=CQ.Ext.extend(CQ.Ext.layout.ContainerLayout,{monitorResize:false,type:"table",targetCls:"x-table-layout-ct",tableAttrs:null,setContainer:function(a){CQ.Ext.layout.TableLayout.superclass.setContainer.call(this,a);
this.currentRow=0;
this.currentColumn=0;
this.cells=[]
},onLayout:function(g,k){var j=g.items.items,a=j.length,m,b;
if(!this.table){k.addClass("x-table-layout-ct");
this.table=k.createChild(CQ.Ext.apply({tag:"table",cls:"x-table-layout",cellspacing:0,cn:{tag:"tbody"}},this.tableAttrs),null,true)
}this.renderAll(g,k)
},getRow:function(a){var b=this.table.tBodies[0].childNodes[a];
if(!b){b=document.createElement("tr");
this.table.tBodies[0].appendChild(b)
}return b
},getNextCell:function(o){var a=this.getNextNonSpan(this.currentColumn,this.currentRow);
var k=this.currentColumn=a[0],j=this.currentRow=a[1];
for(var n=j;
n<j+(o.rowspan||1);
n++){if(!this.cells[n]){this.cells[n]=[]
}for(var g=k;
g<k+(o.colspan||1);
g++){this.cells[n][g]=true
}}var m=document.createElement("td");
if(o.cellId){m.id=o.cellId
}var b="x-table-layout-cell";
if(o.cellCls){b+=" "+o.cellCls
}m.className=b;
if(o.colspan){m.colSpan=o.colspan
}if(o.rowspan){m.rowSpan=o.rowspan
}this.getRow(j).appendChild(m);
return m
},getNextNonSpan:function(a,c){var b=this.columns;
while((b&&a>=b)||(this.cells[c]&&this.cells[c][a])){if(b&&a>=b){c++;
a=0
}else{a++
}}return[a,c]
},renderItem:function(j,a,g){if(!this.table){this.table=g.createChild(CQ.Ext.apply({tag:"table",cls:"x-table-layout",cellspacing:0,cn:{tag:"tbody"}},this.tableAttrs),null,true)
}if(j&&!j.rendered){j.render(this.getNextCell(j));
this.configureItem(j)
}else{if(j&&!this.isValidParent(j,g)){var b=this.getNextCell(j);
b.insertBefore(j.getPositionEl().dom,null);
j.container=CQ.Ext.get(b);
this.configureItem(j)
}}},isValidParent:function(b,a){return b.getPositionEl().up("table",5).dom.parentNode===(a.dom||a)
},destroy:function(){delete this.table;
CQ.Ext.layout.TableLayout.superclass.destroy.call(this)
}});
CQ.Ext.Container.LAYOUTS.table=CQ.Ext.layout.TableLayout;
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.layout.AbsoluteLayout=CQ.Ext.extend(CQ.Ext.layout.AnchorLayout,{extraCls:"x-abs-layout-item",type:"absolute",onLayout:function(a,b){b.position();
this.paddingLeft=b.getPadding("l");
this.paddingTop=b.getPadding("t");
CQ.Ext.layout.AbsoluteLayout.superclass.onLayout.call(this,a,b)
},adjustWidthAnchor:function(b,a){return b?b-a.getPosition(true)[0]+this.paddingLeft:b
},adjustHeightAnchor:function(b,a){return b?b-a.getPosition(true)[1]+this.paddingTop:b
}});
CQ.Ext.Container.LAYOUTS.absolute=CQ.Ext.layout.AbsoluteLayout;
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.layout.BoxLayout=CQ.Ext.extend(CQ.Ext.layout.ContainerLayout,{defaultMargins:{left:0,top:0,right:0,bottom:0},padding:"0",pack:"start",monitorResize:true,type:"box",scrollOffset:0,extraCls:"x-box-item",targetCls:"x-box-layout-ct",innerCls:"x-box-inner",constructor:function(a){CQ.Ext.layout.BoxLayout.superclass.constructor.call(this,a);
if(CQ.Ext.isString(this.defaultMargins)){this.defaultMargins=this.parseMargins(this.defaultMargins)
}var g=this.overflowHandler;
if(typeof g=="string"){g={type:g}
}var c="none";
if(g&&g.type!=undefined){c=g.type
}var b=CQ.Ext.layout.boxOverflow[c];
if(b[this.type]){b=b[this.type]
}this.overflowHandler=new b(this,g)
},onLayout:function(b,m){CQ.Ext.layout.BoxLayout.superclass.onLayout.call(this,b,m);
var g=this.getLayoutTargetSize(),n=this.getVisibleItems(b),c=this.calculateChildBoxes(n,g),k=c.boxes,o=c.meta;
if(g.width>0){var q=this.overflowHandler,a=o.tooNarrow?"handleOverflow":"clearOverflow";
var j=q[a](c,g);
if(j){if(j.targetSize){g=j.targetSize
}if(j.recalculate){n=this.getVisibleItems(b);
c=this.calculateChildBoxes(n,g);
k=c.boxes
}}}this.layoutTargetLastSize=g;
this.childBoxCache=c;
this.updateInnerCtSize(g,c);
this.updateChildBoxes(k);
this.handleTargetOverflow(g,b,m)
},updateChildBoxes:function(c){for(var b=0,j=c.length;
b<j;
b++){var g=c[b],a=g.component;
if(g.dirtySize){a.setSize(g.width,g.height)
}if(isNaN(g.left)||isNaN(g.top)){continue
}a.setPosition(g.left,g.top)
}},updateInnerCtSize:function(c,m){var n=this.align,k=this.padding,j=c.width,a=c.height;
if(this.type=="hbox"){var b=j,g=m.meta.maxHeight+k.top+k.bottom;
if(n=="stretch"){g=a
}else{if(n=="middle"){g=Math.max(a,g)
}}}else{var g=a,b=m.meta.maxWidth+k.left+k.right;
if(n=="stretch"){b=j
}else{if(n=="center"){b=Math.max(j,b)
}}}this.innerCt.setSize(b||undefined,g||undefined)
},handleTargetOverflow:function(g,a,c){var j=c.getStyle("overflow");
if(j&&j!="hidden"&&!this.adjustmentPass){var b=this.getLayoutTargetSize();
if(b.width!=g.width||b.height!=g.height){this.adjustmentPass=true;
this.onLayout(a,c)
}}delete this.adjustmentPass
},isValidParent:function(b,a){return this.innerCt&&b.getPositionEl().dom.parentNode==this.innerCt.dom
},getVisibleItems:function(k){var k=k||this.container,j=k.getLayoutTarget(),m=k.items.items,a=m.length,g,n,b=[];
for(g=0;
g<a;
g++){if((n=m[g]).rendered&&this.isValidParent(n,j)&&n.hidden!==true&&n.collapsed!==true&&n.shouldLayout!==false){b.push(n)
}}return b
},renderAll:function(a,b){if(!this.innerCt){this.innerCt=b.createChild({cls:this.innerCls});
this.padding=this.parseMargins(this.padding)
}CQ.Ext.layout.BoxLayout.superclass.renderAll.call(this,a,this.innerCt)
},getLayoutTargetSize:function(){var b=this.container.getLayoutTarget(),a;
if(b){a=b.getViewSize();
if(CQ.Ext.isIE&&CQ.Ext.isStrict&&a.width==0){a=b.getStyleSize()
}a.width-=b.getPadding("lr");
a.height-=b.getPadding("tb")
}return a
},renderItem:function(a){if(CQ.Ext.isString(a.margins)){a.margins=this.parseMargins(a.margins)
}else{if(!a.margins){a.margins=this.defaultMargins
}}CQ.Ext.layout.BoxLayout.superclass.renderItem.apply(this,arguments)
},destroy:function(){CQ.Ext.destroy(this.overflowHandler);
CQ.Ext.layout.BoxLayout.superclass.destroy.apply(this,arguments)
}});
CQ.Ext.layout.boxOverflow.None=CQ.Ext.extend(Object,{constructor:function(b,a){this.layout=b;
CQ.Ext.apply(this,a||{})
},handleOverflow:CQ.Ext.emptyFn,clearOverflow:CQ.Ext.emptyFn});
CQ.Ext.layout.boxOverflow.none=CQ.Ext.layout.boxOverflow.None;
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.layout.boxOverflow.Menu=CQ.Ext.extend(CQ.Ext.layout.boxOverflow.None,{afterCls:"x-strip-right",noItemsMenuText:'<div class="x-toolbar-no-items">(None)</div>',constructor:function(a){CQ.Ext.layout.boxOverflow.Menu.superclass.constructor.apply(this,arguments);
this.menuItems=[]
},createInnerElements:function(){if(!this.afterCt){this.afterCt=this.layout.innerCt.insertSibling({cls:this.afterCls},"before")
}},clearOverflow:function(a,k){var j=k.width+(this.afterCt?this.afterCt.getWidth():0),b=this.menuItems;
this.hideTrigger();
for(var c=0,g=b.length;
c<g;
c++){b.pop().component.show()
}return{targetSize:{height:k.height,width:j}}
},showTrigger:function(){this.createMenu();
this.menuTrigger.show()
},hideTrigger:function(){if(this.menuTrigger!=undefined){this.menuTrigger.hide()
}},beforeMenuShow:function(m){var b=this.menuItems,a=b.length,k,j;
var c=function(o,n){return o.isXType("buttongroup")&&!(n instanceof CQ.Ext.Toolbar.Separator)
};
this.clearMenu();
m.removeAll();
for(var g=0;
g<a;
g++){k=b[g].component;
if(j&&(c(k,j)||c(j,k))){m.add("-")
}this.addComponentToMenu(m,k);
j=k
}if(m.items.length<1){m.add(this.noItemsMenuText)
}},createMenuConfig:function(c,a){var b=CQ.Ext.apply({},c.initialConfig),g=c.toggleGroup;
CQ.Ext.copyTo(b,c,["iconCls","icon","itemId","disabled","handler","scope","menu"]);
CQ.Ext.apply(b,{text:c.overflowText||c.text,hideOnClick:a});
if(g||c.enableToggle){CQ.Ext.apply(b,{group:g,checked:c.pressed,listeners:{checkchange:function(k,j){c.toggle(j)
}}})
}delete b.ownerCt;
delete b.xtype;
delete b.id;
return b
},addComponentToMenu:function(b,a){if(a instanceof CQ.Ext.Toolbar.Separator){b.add("-")
}else{if(CQ.Ext.isFunction(a.isXType)){if(a.isXType("splitbutton")){b.add(this.createMenuConfig(a,true))
}else{if(a.isXType("button")){b.add(this.createMenuConfig(a,!a.menu))
}else{if(a.isXType("buttongroup")){a.items.each(function(c){this.addComponentToMenu(b,c)
},this)
}}}}}},clearMenu:function(){var a=this.moreMenu;
if(a&&a.items){a.items.each(function(b){delete b.menu
})
}},createMenu:function(){if(!this.menuTrigger){this.createInnerElements();
this.menu=new CQ.Ext.menu.Menu({ownerCt:this.layout.container,listeners:{scope:this,beforeshow:this.beforeMenuShow}});
this.menuTrigger=new CQ.Ext.Button({iconCls:"x-toolbar-more-icon",cls:"x-toolbar-more",menu:this.menu,renderTo:this.afterCt})
}},destroy:function(){CQ.Ext.destroy(this.menu,this.menuTrigger)
}});
CQ.Ext.layout.boxOverflow.menu=CQ.Ext.layout.boxOverflow.Menu;
CQ.Ext.layout.boxOverflow.HorizontalMenu=CQ.Ext.extend(CQ.Ext.layout.boxOverflow.Menu,{constructor:function(){CQ.Ext.layout.boxOverflow.HorizontalMenu.superclass.constructor.apply(this,arguments);
var c=this,b=c.layout,a=b.calculateChildBoxes;
b.calculateChildBoxes=function(g,n){var r=a.apply(b,arguments),q=r.meta,j=c.menuItems;
var o=0;
for(var k=0,m=j.length;
k<m;
k++){o+=j[k].width
}q.minimumWidth+=o;
q.tooNarrow=q.minimumWidth>n.width;
return r
}
},handleOverflow:function(g,m){this.showTrigger();
var o=m.width-this.afterCt.getWidth(),q=g.boxes,j=0,x=false;
for(var u=0,c=q.length;
u<c;
u++){j+=q[u].width
}var a=o-j,k=0;
for(var u=0,c=this.menuItems.length;
u<c;
u++){var t=this.menuItems[u],r=t.component,b=t.width;
if(b<a){r.show();
a-=b;
k++;
x=true
}else{break
}}if(x){this.menuItems=this.menuItems.slice(k)
}else{for(var n=q.length-1;
n>=0;
n--){var w=q[n].component,v=q[n].left+q[n].width;
if(v>=o){this.menuItems.unshift({component:w,width:q[n].width});
w.hide()
}else{break
}}}if(this.menuItems.length==0){this.hideTrigger()
}return{targetSize:{height:m.height,width:o},recalculate:x}
}});
CQ.Ext.layout.boxOverflow.menu.hbox=CQ.Ext.layout.boxOverflow.HorizontalMenu;
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.layout.boxOverflow.Scroller=CQ.Ext.extend(CQ.Ext.layout.boxOverflow.None,{animateScroll:true,scrollIncrement:100,wheelIncrement:3,scrollRepeatInterval:400,scrollDuration:0.4,beforeCls:"x-strip-left",afterCls:"x-strip-right",scrollerCls:"x-strip-scroller",beforeScrollerCls:"x-strip-scroller-left",afterScrollerCls:"x-strip-scroller-right",createWheelListener:function(){this.layout.innerCt.on({scope:this,mousewheel:function(a){a.stopEvent();
this.scrollBy(a.getWheelDelta()*this.wheelIncrement*-1,false)
}})
},handleOverflow:function(a,b){this.createInnerElements();
this.showScrollers()
},clearOverflow:function(){this.hideScrollers()
},showScrollers:function(){this.createScrollers();
this.beforeScroller.show();
this.afterScroller.show();
this.updateScrollButtons()
},hideScrollers:function(){if(this.beforeScroller!=undefined){this.beforeScroller.hide();
this.afterScroller.hide()
}},createScrollers:function(){if(!this.beforeScroller&&!this.afterScroller){var a=this.beforeCt.createChild({cls:String.format("{0} {1} ",this.scrollerCls,this.beforeScrollerCls)});
var b=this.afterCt.createChild({cls:String.format("{0} {1}",this.scrollerCls,this.afterScrollerCls)});
a.addClassOnOver(this.beforeScrollerCls+"-hover");
b.addClassOnOver(this.afterScrollerCls+"-hover");
a.setVisibilityMode(CQ.Ext.Element.DISPLAY);
b.setVisibilityMode(CQ.Ext.Element.DISPLAY);
this.beforeRepeater=new CQ.Ext.util.ClickRepeater(a,{interval:this.scrollRepeatInterval,handler:this.scrollLeft,scope:this});
this.afterRepeater=new CQ.Ext.util.ClickRepeater(b,{interval:this.scrollRepeatInterval,handler:this.scrollRight,scope:this});
this.beforeScroller=a;
this.afterScroller=b
}},destroy:function(){CQ.Ext.destroy(this.beforeScroller,this.afterScroller,this.beforeRepeater,this.afterRepeater,this.beforeCt,this.afterCt)
},scrollBy:function(b,a){this.scrollTo(this.getScrollPosition()+b,a)
},getItem:function(a){if(CQ.Ext.isString(a)){a=CQ.Ext.getCmp(a)
}else{if(CQ.Ext.isNumber(a)){a=this.items[a]
}}return a
},getScrollAnim:function(){return{duration:this.scrollDuration,callback:this.updateScrollButtons,scope:this}
},updateScrollButtons:function(){if(this.beforeScroller==undefined||this.afterScroller==undefined){return
}var g=this.atExtremeBefore()?"addClass":"removeClass",c=this.atExtremeAfter()?"addClass":"removeClass",a=this.beforeScrollerCls+"-disabled",b=this.afterScrollerCls+"-disabled";
this.beforeScroller[g](a);
this.afterScroller[c](b);
this.scrolling=false
},atExtremeBefore:function(){return this.getScrollPosition()===0
},scrollLeft:function(a){this.scrollBy(-this.scrollIncrement,a)
},scrollRight:function(a){this.scrollBy(this.scrollIncrement,a)
},scrollToItem:function(g,b){g=this.getItem(g);
if(g!=undefined){var a=this.getItemVisibility(g);
if(!a.fullyVisible){var c=g.getBox(true,true),j=c.x;
if(a.hiddenRight){j-=(this.layout.innerCt.getWidth()-c.width)
}this.scrollTo(j,b)
}}},getItemVisibility:function(j){var g=this.getItem(j).getBox(true,true),a=g.x,c=g.x+g.width,k=this.getScrollPosition(),b=this.layout.innerCt.getWidth()+k;
return{hiddenLeft:a<k,hiddenRight:c>b,fullyVisible:a>k&&c<b}
}});
CQ.Ext.layout.boxOverflow.scroller=CQ.Ext.layout.boxOverflow.Scroller;
CQ.Ext.layout.boxOverflow.VerticalScroller=CQ.Ext.extend(CQ.Ext.layout.boxOverflow.Scroller,{scrollIncrement:75,wheelIncrement:2,handleOverflow:function(a,b){CQ.Ext.layout.boxOverflow.VerticalScroller.superclass.handleOverflow.apply(this,arguments);
return{targetSize:{height:b.height-(this.beforeCt.getHeight()+this.afterCt.getHeight()),width:b.width}}
},createInnerElements:function(){var a=this.layout.innerCt;
if(!this.beforeCt){this.beforeCt=a.insertSibling({cls:this.beforeCls},"before");
this.afterCt=a.insertSibling({cls:this.afterCls},"after");
this.createWheelListener()
}},scrollTo:function(a,b){var g=this.getScrollPosition(),c=a.constrain(0,this.getMaxScrollBottom());
if(c!=g&&!this.scrolling){if(b==undefined){b=this.animateScroll
}this.layout.innerCt.scrollTo("top",c,b?this.getScrollAnim():false);
if(b){this.scrolling=true
}else{this.scrolling=false;
this.updateScrollButtons()
}}},getScrollPosition:function(){return parseInt(this.layout.innerCt.dom.scrollTop,10)||0
},getMaxScrollBottom:function(){return this.layout.innerCt.dom.scrollHeight-this.layout.innerCt.getHeight()
},atExtremeAfter:function(){return this.getScrollPosition()>=this.getMaxScrollBottom()
}});
CQ.Ext.layout.boxOverflow.scroller.vbox=CQ.Ext.layout.boxOverflow.VerticalScroller;
CQ.Ext.layout.boxOverflow.HorizontalScroller=CQ.Ext.extend(CQ.Ext.layout.boxOverflow.Scroller,{handleOverflow:function(a,b){CQ.Ext.layout.boxOverflow.HorizontalScroller.superclass.handleOverflow.apply(this,arguments);
return{targetSize:{height:b.height,width:b.width-(this.beforeCt.getWidth()+this.afterCt.getWidth())}}
},createInnerElements:function(){var a=this.layout.innerCt;
if(!this.beforeCt){this.afterCt=a.insertSibling({cls:this.afterCls},"before");
this.beforeCt=a.insertSibling({cls:this.beforeCls},"before");
this.createWheelListener()
}},scrollTo:function(a,b){var g=this.getScrollPosition(),c=a.constrain(0,this.getMaxScrollRight());
if(c!=g&&!this.scrolling){if(b==undefined){b=this.animateScroll
}this.layout.innerCt.scrollTo("left",c,b?this.getScrollAnim():false);
if(b){this.scrolling=true
}else{this.scrolling=false;
this.updateScrollButtons()
}}},getScrollPosition:function(){return parseInt(this.layout.innerCt.dom.scrollLeft,10)||0
},getMaxScrollRight:function(){return this.layout.innerCt.dom.scrollWidth-this.layout.innerCt.getWidth()
},atExtremeAfter:function(){return this.getScrollPosition()>=this.getMaxScrollRight()
}});
CQ.Ext.layout.boxOverflow.scroller.hbox=CQ.Ext.layout.boxOverflow.HorizontalScroller;
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.layout.HBoxLayout=CQ.Ext.extend(CQ.Ext.layout.BoxLayout,{align:"top",type:"hbox",calculateChildBoxes:function(x,b){var L=x.length,X=this.padding,J=X.top,aa=X.left,E=J+X.bottom,U=aa+X.right,a=b.width-this.scrollOffset,j=b.height,u=Math.max(0,j-E),V=this.pack=="start",ac=this.pack=="center",G=this.pack=="end",R=0,W=0,Z=0,q=0,ad=0,N=[],o,P,S,ab,C,n,Y,O,c,D,w,T;
for(Y=0;
Y<L;
Y++){o=x[Y];
S=o.height;
P=o.width;
n=!o.hasLayout&&typeof o.doLayout=="function";
if(typeof P!="number"){if(o.flex&&!P){Z+=o.flex
}else{if(!P&&n){o.doLayout()
}ab=o.getSize();
P=ab.width;
S=ab.height
}}C=o.margins;
D=C.left+C.right;
R+=D+(P||0);
q+=D+(o.flex?o.minWidth||0:P);
ad+=D+(o.minWidth||P||0);
if(typeof S!="number"){if(n){o.doLayout()
}S=o.getHeight()
}W=Math.max(W,S+C.top+C.bottom);
N.push({component:o,height:S||undefined,width:P||undefined})
}var Q=q-a,v=ad>a;
var t=Math.max(0,a-R-U);
if(v){for(Y=0;
Y<L;
Y++){N[Y].width=x[Y].minWidth||x[Y].width||N[Y].width
}}else{if(Q>0){var I=[];
for(var K=0,B=L;
K<B;
K++){var H=x[K],z=H.minWidth||0;
if(H.flex){N[K].width=z
}else{I.push({minWidth:z,available:N[K].width-z,index:K})
}}I.sort(function(af,ae){return af.available>ae.available?1:-1
});
for(var Y=0,B=I.length;
Y<B;
Y++){var M=I[Y].index;
if(M==undefined){continue
}var H=x[M],r=N[M],A=r.width,z=H.minWidth,g=Math.max(z,A-Math.ceil(Q/(B-Y))),k=A-g;
N[M].width=g;
Q-=k
}}else{var m=t,y=Z;
for(Y=0;
Y<L;
Y++){o=x[Y];
O=N[Y];
C=o.margins;
w=C.top+C.bottom;
if(V&&o.flex&&!o.width){c=Math.ceil((o.flex/y)*m);
m-=c;
y-=o.flex;
O.width=c;
O.dirtySize=true
}}}}if(ac){aa+=t/2
}else{if(G){aa+=t
}}for(Y=0;
Y<L;
Y++){o=x[Y];
O=N[Y];
C=o.margins;
aa+=C.left;
w=C.top+C.bottom;
O.left=aa;
O.top=J+C.top;
switch(this.align){case"stretch":T=u-w;
O.height=T.constrain(o.minHeight||0,o.maxHeight||1000000);
O.dirtySize=true;
break;
case"stretchmax":T=W-w;
O.height=T.constrain(o.minHeight||0,o.maxHeight||1000000);
O.dirtySize=true;
break;
case"middle":var F=u-O.height-w;
if(F>0){O.top=J+w+(F/2)
}}aa+=O.width+C.right
}return{boxes:N,meta:{maxHeight:W,nonFlexWidth:R,desiredWidth:q,minimumWidth:ad,shortfall:q-a,tooNarrow:v}}
}});
CQ.Ext.Container.LAYOUTS.hbox=CQ.Ext.layout.HBoxLayout;
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.layout.VBoxLayout=CQ.Ext.extend(CQ.Ext.layout.BoxLayout,{align:"left",type:"vbox",calculateChildBoxes:function(u,b){var K=u.length,X=this.padding,I=X.top,ab=X.left,D=I+X.bottom,U=ab+X.right,a=b.width-this.scrollOffset,c=b.height,Q=Math.max(0,a-U),V=this.pack=="start",ad=this.pack=="center",F=this.pack=="end",o=0,A=0,aa=0,R=0,r=0,M=[],m,O,T,ac,z,k,Z,N,Y,C,t,g,x;
for(Z=0;
Z<K;
Z++){m=u[Z];
T=m.height;
O=m.width;
k=!m.hasLayout&&typeof m.doLayout=="function";
if(typeof T!="number"){if(m.flex&&!T){aa+=m.flex
}else{if(!T&&k){m.doLayout()
}ac=m.getSize();
O=ac.width;
T=ac.height
}}z=m.margins;
t=z.top+z.bottom;
o+=t+(T||0);
R+=t+(m.flex?m.minHeight||0:T);
r+=t+(m.minHeight||T||0);
if(typeof O!="number"){if(k){m.doLayout()
}O=m.getWidth()
}A=Math.max(A,O+z.left+z.right);
M.push({component:m,height:T||undefined,width:O||undefined})
}var S=R-c,q=r>c;
var w=Math.max(0,(c-o-D));
if(q){for(Z=0,x=K;
Z<x;
Z++){M[Z].height=u[Z].minHeight||u[Z].height||M[Z].height
}}else{if(S>0){var P=[];
for(var J=0,x=K;
J<x;
J++){var G=u[J],y=G.minHeight||0;
if(G.flex){M[J].height=y
}else{P.push({minHeight:y,available:M[J].height-y,index:J})
}}P.sort(function(af,ae){return af.available>ae.available?1:-1
});
for(var Z=0,x=P.length;
Z<x;
Z++){var L=P[Z].index;
if(L==undefined){continue
}var G=u[L],n=M[L],B=n.height,y=G.minHeight,H=Math.max(y,B-Math.ceil(S/(x-Z))),j=B-H;
M[L].height=H;
S-=j
}}else{var W=w,v=aa;
for(Z=0;
Z<K;
Z++){m=u[Z];
N=M[Z];
z=m.margins;
C=z.left+z.right;
if(V&&m.flex&&!m.height){Y=Math.ceil((m.flex/v)*W);
W-=Y;
v-=m.flex;
N.height=Y;
N.dirtySize=true
}}}}if(ad){I+=w/2
}else{if(F){I+=w
}}for(Z=0;
Z<K;
Z++){m=u[Z];
N=M[Z];
z=m.margins;
I+=z.top;
C=z.left+z.right;
N.left=ab+z.left;
N.top=I;
switch(this.align){case"stretch":g=Q-C;
N.width=g.constrain(m.minWidth||0,m.maxWidth||1000000);
N.dirtySize=true;
break;
case"stretchmax":g=A-C;
N.width=g.constrain(m.minWidth||0,m.maxWidth||1000000);
N.dirtySize=true;
break;
case"center":var E=Q-N.width-C;
if(E>0){N.left=ab+C+(E/2)
}}I+=N.height+z.bottom
}return{boxes:M,meta:{maxWidth:A,nonFlexHeight:o,desiredHeight:R,minimumHeight:r,shortfall:R-c,tooNarrow:q}}
}});
CQ.Ext.Container.LAYOUTS.vbox=CQ.Ext.layout.VBoxLayout;
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.layout.ToolbarLayout=CQ.Ext.extend(CQ.Ext.layout.ContainerLayout,{monitorResize:true,type:"toolbar",triggerWidth:18,noItemsMenuText:'<div class="x-toolbar-no-items">(None)</div>',lastOverflow:false,tableHTML:['<table cellspacing="0" class="x-toolbar-ct">',"<tbody>","<tr>",'<td class="x-toolbar-left" align="{0}">','<table cellspacing="0">',"<tbody>",'<tr class="x-toolbar-left-row"></tr>',"</tbody>","</table>","</td>",'<td class="x-toolbar-right" align="right">','<table cellspacing="0" class="x-toolbar-right-ct">',"<tbody>","<tr>","<td>",'<table cellspacing="0">',"<tbody>",'<tr class="x-toolbar-right-row"></tr>',"</tbody>","</table>","</td>","<td>",'<table cellspacing="0">',"<tbody>",'<tr class="x-toolbar-extras-row"></tr>',"</tbody>","</table>","</td>","</tr>","</tbody>","</table>","</td>","</tr>","</tbody>","</table>"].join(""),onLayout:function(j,n){if(!this.leftTr){var m=j.buttonAlign=="center"?"center":"left";
n.addClass("x-toolbar-layout-ct");
n.insertHtml("beforeEnd",String.format(this.tableHTML,m));
this.leftTr=n.child("tr.x-toolbar-left-row",true);
this.rightTr=n.child("tr.x-toolbar-right-row",true);
this.extrasTr=n.child("tr.x-toolbar-extras-row",true);
if(this.hiddenItem==undefined){this.hiddenItems=[]
}}var o=j.buttonAlign=="right"?this.rightTr:this.leftTr,q=j.items.items,g=0;
for(var b=0,k=q.length,r;
b<k;
b++,g++){r=q[b];
if(r.isFill){o=this.rightTr;
g=-1
}else{if(!r.rendered){r.render(this.insertCell(r,o,g));
this.configureItem(r)
}else{if(!r.xtbHidden&&!this.isValidParent(r,o.childNodes[g])){var a=this.insertCell(r,o,g);
a.appendChild(r.getPositionEl().dom);
r.container=CQ.Ext.get(a)
}}}}this.cleanup(this.leftTr);
this.cleanup(this.rightTr);
this.cleanup(this.extrasTr);
this.fitToSize(n)
},cleanup:function(b){var j=b.childNodes,a,g;
for(a=j.length-1;
a>=0&&(g=j[a]);
a--){if(!g.firstChild){b.removeChild(g)
}}},insertCell:function(j,b,a){var g=document.createElement("td");
g.className="x-toolbar-cell";
b.insertBefore(g,b.childNodes[a]||null);
return g
},hideItem:function(a){this.hiddenItems.push(a);
a.xtbHidden=true;
a.xtbWidth=a.getPositionEl().dom.parentNode.offsetWidth;
a.hide()
},unhideItem:function(a){a.show();
a.xtbHidden=false;
this.hiddenItems.remove(a)
},getItemWidth:function(a){return a.hidden?(a.xtbWidth||0):a.getPositionEl().dom.parentNode.offsetWidth
},fitToSize:function(o){if(this.container.enableOverflow===false){return
}var b=o.dom.clientWidth,n=o.dom.firstChild.offsetWidth,r=b-this.triggerWidth,a=this.lastWidth||0,c=this.hiddenItems,j=c.length!=0,t=b>=a;
this.lastWidth=b;
if(n>b||(j&&t)){var q=this.container.items.items,m=q.length,g=0,u;
for(var k=0;
k<m;
k++){u=q[k];
if(!u.isFill){g+=this.getItemWidth(u);
if(g>r){if(!(u.hidden||u.xtbHidden)){this.hideItem(u)
}}else{if(u.xtbHidden){this.unhideItem(u)
}}}}}j=c.length!=0;
if(j){this.initMore();
if(!this.lastOverflow){this.container.fireEvent("overflowchange",this.container,true);
this.lastOverflow=true
}}else{if(this.more){this.clearMenu();
this.more.destroy();
delete this.more;
if(this.lastOverflow){this.container.fireEvent("overflowchange",this.container,false);
this.lastOverflow=false
}}}},createMenuConfig:function(c,a){var b=CQ.Ext.apply({},c.initialConfig),g=c.toggleGroup;
CQ.Ext.copyTo(b,c,["iconCls","icon","itemId","disabled","handler","scope","menu"]);
CQ.Ext.apply(b,{text:c.overflowText||c.text,hideOnClick:a});
if(g||c.enableToggle){CQ.Ext.apply(b,{group:g,checked:c.pressed,listeners:{checkchange:function(k,j){c.toggle(j)
}}})
}delete b.ownerCt;
delete b.xtype;
delete b.id;
return b
},addComponentToMenu:function(b,a){if(a instanceof CQ.Ext.Toolbar.Separator){b.add("-")
}else{if(CQ.Ext.isFunction(a.isXType)){if(a.isXType("splitbutton")){b.add(this.createMenuConfig(a,true))
}else{if(a.isXType("button")){b.add(this.createMenuConfig(a,!a.menu))
}else{if(a.isXType("buttongroup")){a.items.each(function(c){this.addComponentToMenu(b,c)
},this)
}}}}}},clearMenu:function(){var a=this.moreMenu;
if(a&&a.items){a.items.each(function(b){delete b.menu
})
}},beforeMoreShow:function(m){var b=this.container.items.items,a=b.length,k,j;
var c=function(o,n){return o.isXType("buttongroup")&&!(n instanceof CQ.Ext.Toolbar.Separator)
};
this.clearMenu();
m.removeAll();
for(var g=0;
g<a;
g++){k=b[g];
if(k.xtbHidden){if(j&&(c(k,j)||c(j,k))){m.add("-")
}this.addComponentToMenu(m,k);
j=k
}}if(m.items.length<1){m.add(this.noItemsMenuText)
}},initMore:function(){if(!this.more){this.moreMenu=new CQ.Ext.menu.Menu({ownerCt:this.container,listeners:{beforeshow:this.beforeMoreShow,scope:this}});
this.more=new CQ.Ext.Button({iconCls:"x-toolbar-more-icon",cls:"x-toolbar-more",menu:this.moreMenu,ownerCt:this.container});
var a=this.insertCell(this.more,this.extrasTr,100);
this.more.render(a)
}},destroy:function(){CQ.Ext.destroy(this.more,this.moreMenu);
delete this.leftTr;
delete this.rightTr;
delete this.extrasTr;
CQ.Ext.layout.ToolbarLayout.superclass.destroy.call(this)
}});
CQ.Ext.Container.LAYOUTS.toolbar=CQ.Ext.layout.ToolbarLayout;
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.layout.MenuLayout=CQ.Ext.extend(CQ.Ext.layout.ContainerLayout,{monitorResize:true,type:"menu",setContainer:function(a){this.monitorResize=!a.floating;
a.on("autosize",this.doAutoSize,this);
CQ.Ext.layout.MenuLayout.superclass.setContainer.call(this,a)
},renderItem:function(k,b,j){if(!this.itemTpl){this.itemTpl=CQ.Ext.layout.MenuLayout.prototype.itemTpl=new CQ.Ext.XTemplate('<li id="{itemId}" class="{itemCls}">','<tpl if="needsIcon">','<img alt="{altText}" src="{icon}" class="{iconCls}"/>',"</tpl>","</li>")
}if(k&&!k.rendered){if(CQ.Ext.isNumber(b)){b=j.dom.childNodes[b]
}var g=this.getItemArgs(k);
k.render(k.positionEl=b?this.itemTpl.insertBefore(b,g,true):this.itemTpl.append(j,g,true));
k.positionEl.menuItemId=k.getItemId();
if(!g.isMenuItem&&g.needsIcon){k.positionEl.addClass("x-menu-list-item-indent")
}this.configureItem(k)
}else{if(k&&!this.isValidParent(k,j)){if(CQ.Ext.isNumber(b)){b=j.dom.childNodes[b]
}j.dom.insertBefore(k.getActionEl().dom,b||null)
}}},getItemArgs:function(g){var a=g instanceof CQ.Ext.menu.Item,b=!(a||g instanceof CQ.Ext.menu.Separator);
return{isMenuItem:a,needsIcon:b&&(g.icon||g.iconCls),icon:g.icon||CQ.Ext.BLANK_IMAGE_URL,iconCls:"x-menu-item-icon "+(g.iconCls||""),itemId:"x-menu-el-"+g.id,itemCls:"x-menu-list-item ",altText:g.altText||""}
},isValidParent:function(b,a){return b.el.up("li.x-menu-list-item",5).dom.parentNode===(a.dom||a)
},onLayout:function(a,b){CQ.Ext.layout.MenuLayout.superclass.onLayout.call(this,a,b);
this.doAutoSize()
},doAutoSize:function(){var c=this.container,a=c.width;
if(c.floating){if(a){c.setWidth(a)
}else{if(CQ.Ext.isIE){c.setWidth(CQ.Ext.isStrict&&(CQ.Ext.isIE7||CQ.Ext.isIE8||CQ.Ext.isIE9||CQ.Ext.isIE10)?"auto":c.minWidth);
var g=c.getEl(),b=g.dom.offsetWidth;
c.setWidth(c.getLayoutTarget().getWidth()+g.getFrameWidth("lr"))
}}}}});
CQ.Ext.Container.LAYOUTS.menu=CQ.Ext.layout.MenuLayout;
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.Viewport=CQ.Ext.extend(CQ.Ext.Container,{initComponent:function(){CQ.Ext.Viewport.superclass.initComponent.call(this);
document.getElementsByTagName("html")[0].className+=" x-viewport";
this.el=CQ.Ext.getBody();
this.el.setHeight=CQ.Ext.emptyFn;
this.el.setWidth=CQ.Ext.emptyFn;
this.el.setSize=CQ.Ext.emptyFn;
this.el.dom.scroll="no";
this.allowDomMove=false;
this.autoWidth=true;
this.autoHeight=true;
CQ.Ext.EventManager.onWindowResize(this.fireResize,this);
this.renderTo=this.el
},fireResize:function(a,b){this.fireEvent("resize",this,a,b,a,b)
}});
CQ.Ext.reg("viewport",CQ.Ext.Viewport);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.Panel=CQ.Ext.extend(CQ.Ext.Container,{baseCls:"x-panel",collapsedCls:"x-panel-collapsed",maskDisabled:true,animCollapse:CQ.Ext.enableFx,headerAsText:true,buttonAlign:"right",collapsed:false,collapseFirst:true,minButtonWidth:75,elements:"body",preventBodyReset:false,padding:undefined,resizeEvent:"bodyresize",toolTarget:"header",collapseEl:"bwrap",slideAnchor:"t",disabledClass:"",deferHeight:true,expandDefaults:{duration:0.25},collapseDefaults:{duration:0.25},initComponent:function(){CQ.Ext.Panel.superclass.initComponent.call(this);
this.addEvents("bodyresize","titlechange","iconchange","collapse","expand","beforecollapse","beforeexpand","beforeclose","close","activate","deactivate");
if(this.unstyled){this.baseCls="x-plain"
}this.toolbars=[];
if(this.tbar){this.elements+=",tbar";
this.topToolbar=this.createToolbar(this.tbar);
this.tbar=null
}if(this.bbar){this.elements+=",bbar";
this.bottomToolbar=this.createToolbar(this.bbar);
this.bbar=null
}if(this.header===true){this.elements+=",header";
this.header=null
}else{if(this.headerCfg||(this.title&&this.header!==false)){this.elements+=",header"
}}if(this.footerCfg||this.footer===true){this.elements+=",footer";
this.footer=null
}if(this.buttons){this.fbar=this.buttons;
this.buttons=null
}if(this.fbar){this.createFbar(this.fbar)
}if(this.autoLoad){this.on("render",this.doAutoLoad,this,{delay:10})
}},createFbar:function(b){var a=this.minButtonWidth;
this.elements+=",footer";
this.fbar=this.createToolbar(b,{buttonAlign:this.buttonAlign,toolbarCls:"x-panel-fbar",enableOverflow:false,defaults:function(g){return{minWidth:g.minWidth||a}
}});
this.fbar.items.each(function(g){g.minWidth=g.minWidth||this.minButtonWidth
},this);
this.buttons=this.fbar.items.items
},createToolbar:function(b,c){var a;
if(CQ.Ext.isArray(b)){b={items:b}
}a=b.events?CQ.Ext.apply(b,c):this.createComponent(CQ.Ext.apply({},b,c),"toolbar");
this.toolbars.push(a);
return a
},createElement:function(a,c){if(this[a]){c.appendChild(this[a].dom);
return
}if(a==="bwrap"||this.elements.indexOf(a)!=-1){if(this[a+"Cfg"]){this[a]=CQ.Ext.fly(c).createChild(this[a+"Cfg"])
}else{var b=document.createElement("div");
b.className=this[a+"Cls"];
this[a]=CQ.Ext.get(c.appendChild(b))
}if(this[a+"CssClass"]){this[a].addClass(this[a+"CssClass"])
}if(this[a+"Style"]){this[a].applyStyles(this[a+"Style"])
}}},onRender:function(j,g){CQ.Ext.Panel.superclass.onRender.call(this,j,g);
this.createClasses();
var a=this.el,k=a.dom,o,m;
if(this.collapsible&&!this.hideCollapseTool){this.tools=this.tools?this.tools.slice(0):[];
this.tools[this.collapseFirst?"unshift":"push"]({id:"toggle",handler:this.toggleCollapse,scope:this})
}if(this.tools){m=this.tools;
this.elements+=(this.header!==false)?",header":""
}this.tools={};
a.addClass(this.baseCls);
if(k.firstChild){this.header=a.down("."+this.headerCls);
this.bwrap=a.down("."+this.bwrapCls);
var n=this.bwrap?this.bwrap:a;
this.tbar=n.down("."+this.tbarCls);
this.body=n.down("."+this.bodyCls);
this.bbar=n.down("."+this.bbarCls);
this.footer=n.down("."+this.footerCls);
this.fromMarkup=true
}if(this.preventBodyReset===true){a.addClass("x-panel-reset")
}if(this.cls){a.addClass(this.cls)
}if(this.buttons){this.elements+=",footer"
}if(this.frame){a.insertHtml("afterBegin",String.format(CQ.Ext.Element.boxMarkup,this.baseCls));
this.createElement("header",k.firstChild.firstChild.firstChild);
this.createElement("bwrap",k);
o=this.bwrap.dom;
var c=k.childNodes[1],b=k.childNodes[2];
o.appendChild(c);
o.appendChild(b);
var q=o.firstChild.firstChild.firstChild;
this.createElement("tbar",q);
this.createElement("body",q);
this.createElement("bbar",q);
this.createElement("footer",o.lastChild.firstChild.firstChild);
if(!this.footer){this.bwrap.dom.lastChild.className+=" x-panel-nofooter"
}this.ft=CQ.Ext.get(this.bwrap.dom.lastChild);
this.mc=CQ.Ext.get(q)
}else{this.createElement("header",k);
this.createElement("bwrap",k);
o=this.bwrap.dom;
this.createElement("tbar",o);
this.createElement("body",o);
this.createElement("bbar",o);
this.createElement("footer",o);
if(!this.header){this.body.addClass(this.bodyCls+"-noheader");
if(this.tbar){this.tbar.addClass(this.tbarCls+"-noheader")
}}}if(CQ.Ext.isDefined(this.padding)){this.body.setStyle("padding",this.body.addUnits(this.padding))
}if(this.border===false){this.el.addClass(this.baseCls+"-noborder");
this.body.addClass(this.bodyCls+"-noborder");
if(this.header){this.header.addClass(this.headerCls+"-noborder")
}if(this.footer){this.footer.addClass(this.footerCls+"-noborder")
}if(this.tbar){this.tbar.addClass(this.tbarCls+"-noborder")
}if(this.bbar){this.bbar.addClass(this.bbarCls+"-noborder")
}}if(this.bodyBorder===false){this.body.addClass(this.bodyCls+"-noborder")
}this.bwrap.enableDisplayMode("block");
if(this.header){this.header.unselectable();
if(this.headerAsText){this.header.dom.innerHTML='<span class="'+this.headerTextCls+'">'+this.header.dom.innerHTML+"</span>";
if(this.iconCls){this.setIconClass(this.iconCls)
}}}if(this.floating){this.makeFloating(this.floating)
}if(this.collapsible&&this.titleCollapse&&this.header){this.mon(this.header,"click",this.toggleCollapse,this);
this.header.setStyle("cursor","pointer")
}if(m){this.addTool.apply(this,m)
}if(this.fbar){this.footer.addClass("x-panel-btns");
this.fbar.ownerCt=this;
this.fbar.render(this.footer);
this.footer.createChild({cls:"x-clear"})
}if(this.tbar&&this.topToolbar){this.topToolbar.ownerCt=this;
this.topToolbar.render(this.tbar)
}if(this.bbar&&this.bottomToolbar){this.bottomToolbar.ownerCt=this;
this.bottomToolbar.render(this.bbar)
}},setIconClass:function(b){var a=this.iconCls;
this.iconCls=b;
if(this.rendered&&this.header){if(this.frame){this.header.addClass("x-panel-icon");
this.header.replaceClass(a,this.iconCls)
}else{var j=this.header,c=j.child("img.x-panel-inline-icon");
if(c){CQ.Ext.fly(c).replaceClass(a,this.iconCls)
}else{var g=j.child("span."+this.headerTextCls);
if(g){CQ.Ext.DomHelper.insertBefore(g.dom,{tag:"img",alt:"",src:CQ.Ext.BLANK_IMAGE_URL,cls:"x-panel-inline-icon "+this.iconCls})
}}}}this.fireEvent("iconchange",this,b,a)
},makeFloating:function(a){this.floating=true;
this.el=new CQ.Ext.Layer(CQ.Ext.apply({},a,{shadow:CQ.Ext.isDefined(this.shadow)?this.shadow:"sides",shadowOffset:this.shadowOffset,constrain:false,shim:this.shim===false?false:undefined}),this.el)
},getTopToolbar:function(){return this.topToolbar
},getBottomToolbar:function(){return this.bottomToolbar
},getFooterToolbar:function(){return this.fbar
},addButton:function(a,c,b){if(!this.fbar){this.createFbar([])
}if(c){if(CQ.Ext.isString(a)){a={text:a}
}a=CQ.Ext.apply({handler:c,scope:b},a)
}return this.fbar.add(a)
},addTool:function(){if(!this.rendered){if(!this.tools){this.tools=[]
}CQ.Ext.each(arguments,function(a){this.tools.push(a)
},this);
return
}if(!this[this.toolTarget]){return
}if(!this.toolTemplate){var m=new CQ.Ext.Template('<div class="x-tool x-tool-{id}">&#160;</div>');
m.disableFormats=true;
m.compile();
CQ.Ext.Panel.prototype.toolTemplate=m
}for(var k=0,g=arguments,c=g.length;
k<c;
k++){var b=g[k];
if(!this.tools[b.id]){var n="x-tool-"+b.id+"-over";
var j=this.toolTemplate.insertFirst(this[this.toolTarget],b,true);
this.tools[b.id]=j;
j.enableDisplayMode("block");
this.mon(j,"click",this.createToolHandler(j,b,n,this));
if(b.on){this.mon(j,b.on)
}if(b.hidden){j.hide()
}if(b.qtip){if(CQ.Ext.isObject(b.qtip)){CQ.Ext.QuickTips.register(CQ.Ext.apply({target:j.id},b.qtip))
}else{j.dom.qtip=b.qtip
}}j.addClassOnOver(n)
}}},onLayout:function(b,a){CQ.Ext.Panel.superclass.onLayout.apply(this,arguments);
if(this.hasLayout&&this.toolbars.length>0){CQ.Ext.each(this.toolbars,function(c){c.doLayout(undefined,a)
});
this.syncHeight()
}},syncHeight:function(){var b=this.toolbarHeight,c=this.body,a=this.lastSize.height,g;
if(this.autoHeight||!CQ.Ext.isDefined(a)||a=="auto"){return
}if(b!=this.getToolbarHeight()){b=Math.max(0,a-this.getFrameHeight());
c.setHeight(b);
g=c.getSize();
this.toolbarHeight=this.getToolbarHeight();
this.onBodyResize(g.width,g.height)
}},onShow:function(){if(this.floating){return this.el.show()
}CQ.Ext.Panel.superclass.onShow.call(this)
},onHide:function(){if(this.floating){return this.el.hide()
}CQ.Ext.Panel.superclass.onHide.call(this)
},createToolHandler:function(c,a,g,b){return function(j){c.removeClass(g);
if(a.stopEvent!==false){j.stopEvent()
}if(a.handler){a.handler.call(a.scope||c,j,c,b,a)
}}
},afterRender:function(){if(this.floating&&!this.hidden){this.el.show()
}if(this.title){this.setTitle(this.title)
}CQ.Ext.Panel.superclass.afterRender.call(this);
if(this.collapsed){this.collapsed=false;
this.collapse(false)
}this.initEvents()
},getKeyMap:function(){if(!this.keyMap){this.keyMap=new CQ.Ext.KeyMap(this.el,this.keys)
}return this.keyMap
},initEvents:function(){if(this.keys){this.getKeyMap()
}if(this.draggable){this.initDraggable()
}if(this.toolbars.length>0){CQ.Ext.each(this.toolbars,function(a){a.doLayout();
a.on({scope:this,afterlayout:this.syncHeight,remove:this.syncHeight})
},this);
this.syncHeight()
}},initDraggable:function(){this.dd=new CQ.Ext.Panel.DD(this,CQ.Ext.isBoolean(this.draggable)?null:this.draggable)
},beforeEffect:function(a){if(this.floating){this.el.beforeAction()
}if(a!==false){this.el.addClass("x-panel-animated")
}},afterEffect:function(a){this.syncShadow();
this.el.removeClass("x-panel-animated")
},createEffect:function(c,b,g){var j={scope:g,block:true};
if(c===true){j.callback=b;
return j
}else{if(!c.callback){j.callback=b
}else{j.callback=function(){b.call(g);
CQ.Ext.callback(c.callback,c.scope)
}
}}return CQ.Ext.applyIf(j,c)
},collapse:function(b){if(this.collapsed||this.el.hasFxBlock()||this.fireEvent("beforecollapse",this,b)===false){return
}var a=b===true||(b!==false&&this.animCollapse);
this.beforeEffect(a);
this.onCollapse(a,b);
return this
},onCollapse:function(a,b){if(a){this[this.collapseEl].slideOut(this.slideAnchor,CQ.Ext.apply(this.createEffect(b||true,this.afterCollapse,this),this.collapseDefaults))
}else{this[this.collapseEl].hide(this.hideMode);
this.afterCollapse(false)
}},afterCollapse:function(a){this.collapsed=true;
this.el.addClass(this.collapsedCls);
if(a!==false){this[this.collapseEl].hide(this.hideMode)
}this.afterEffect(a);
this.cascade(function(b){if(b.lastSize){b.lastSize={width:undefined,height:undefined}
}});
this.fireEvent("collapse",this)
},expand:function(b){if(!this.collapsed||this.el.hasFxBlock()||this.fireEvent("beforeexpand",this,b)===false){return
}var a=b===true||(b!==false&&this.animCollapse);
this.el.removeClass(this.collapsedCls);
this.beforeEffect(a);
this.onExpand(a,b);
return this
},onExpand:function(a,b){if(a){this[this.collapseEl].slideIn(this.slideAnchor,CQ.Ext.apply(this.createEffect(b||true,this.afterExpand,this),this.expandDefaults))
}else{this[this.collapseEl].show(this.hideMode);
this.afterExpand(false)
}},afterExpand:function(a){this.collapsed=false;
if(a!==false){this[this.collapseEl].show(this.hideMode)
}this.afterEffect(a);
if(this.deferLayout){delete this.deferLayout;
this.doLayout(true)
}this.fireEvent("expand",this)
},toggleCollapse:function(a){this[this.collapsed?"expand":"collapse"](a);
return this
},onDisable:function(){if(this.rendered&&this.maskDisabled){this.el.mask()
}CQ.Ext.Panel.superclass.onDisable.call(this)
},onEnable:function(){if(this.rendered&&this.maskDisabled){this.el.unmask()
}CQ.Ext.Panel.superclass.onEnable.call(this)
},onResize:function(k,g,c,j){var a=k,b=g;
if(CQ.Ext.isDefined(a)||CQ.Ext.isDefined(b)){if(!this.collapsed){if(CQ.Ext.isNumber(a)){this.body.setWidth(a=this.adjustBodyWidth(a-this.getFrameWidth()))
}else{if(a=="auto"){a=this.body.setWidth("auto").dom.offsetWidth
}else{a=this.body.dom.offsetWidth
}}if(this.tbar){this.tbar.setWidth(a);
if(this.topToolbar){this.topToolbar.setSize(a)
}}if(this.bbar){this.bbar.setWidth(a);
if(this.bottomToolbar){this.bottomToolbar.setSize(a);
if(CQ.Ext.isIE){this.bbar.setStyle("position","static");
this.bbar.setStyle("position","")
}}}if(this.footer){this.footer.setWidth(a);
if(this.fbar){this.fbar.setSize(CQ.Ext.isIE?(a-this.footer.getFrameWidth("lr")):"auto")
}}if(CQ.Ext.isNumber(b)){b=Math.max(0,b-this.getFrameHeight());
this.body.setHeight(b)
}else{if(b=="auto"){this.body.setHeight(b)
}}if(this.disabled&&this.el._mask){this.el._mask.setSize(this.el.dom.clientWidth,this.el.getHeight())
}}else{this.queuedBodySize={width:a,height:b};
if(!this.queuedExpand&&this.allowQueuedExpand!==false){this.queuedExpand=true;
this.on("expand",function(){delete this.queuedExpand;
this.onResize(this.queuedBodySize.width,this.queuedBodySize.height)
},this,{single:true})
}}this.onBodyResize(a,b)
}this.syncShadow();
CQ.Ext.Panel.superclass.onResize.call(this,k,g,c,j)
},onBodyResize:function(a,b){this.fireEvent("bodyresize",this,a,b)
},getToolbarHeight:function(){var a=0;
if(this.rendered){CQ.Ext.each(this.toolbars,function(b){a+=b.getHeight()
},this)
}return a
},adjustBodyHeight:function(a){return a
},adjustBodyWidth:function(a){return a
},onPosition:function(){this.syncShadow()
},getFrameWidth:function(){var b=this.el.getFrameWidth("lr")+this.bwrap.getFrameWidth("lr");
if(this.frame){var a=this.bwrap.dom.firstChild;
b+=(CQ.Ext.fly(a).getFrameWidth("l")+CQ.Ext.fly(a.firstChild).getFrameWidth("r"));
b+=this.mc.getFrameWidth("lr")
}return b
},getFrameHeight:function(){var a=this.el.getFrameWidth("tb")+this.bwrap.getFrameWidth("tb");
a+=(this.tbar?this.tbar.getHeight():0)+(this.bbar?this.bbar.getHeight():0);
if(this.frame){a+=this.el.dom.firstChild.offsetHeight+this.ft.dom.offsetHeight+this.mc.getFrameWidth("tb")
}else{a+=(this.header?this.header.getHeight():0)+(this.footer?this.footer.getHeight():0)
}return a
},getInnerWidth:function(){return this.getSize().width-this.getFrameWidth()
},getInnerHeight:function(){return this.body.getHeight()
},syncShadow:function(){if(this.floating){this.el.sync(true)
}},getLayoutTarget:function(){return this.body
},getContentTarget:function(){return this.body
},setTitle:function(b,a){this.title=b;
if(this.header&&this.headerAsText){this.header.child("span").update(b)
}if(a){this.setIconClass(a)
}this.fireEvent("titlechange",this,b);
return this
},getUpdater:function(){return this.body.getUpdater()
},load:function(){var a=this.body.getUpdater();
a.update.apply(a,arguments);
return this
},beforeDestroy:function(){CQ.Ext.Panel.superclass.beforeDestroy.call(this);
if(this.header){this.header.removeAllListeners()
}if(this.tools){for(var a in this.tools){CQ.Ext.destroy(this.tools[a])
}}if(this.toolbars.length>0){CQ.Ext.each(this.toolbars,function(b){b.un("afterlayout",this.syncHeight,this);
b.un("remove",this.syncHeight,this)
},this)
}if(CQ.Ext.isArray(this.buttons)){while(this.buttons.length){CQ.Ext.destroy(this.buttons[0])
}}if(this.rendered){CQ.Ext.destroy(this.ft,this.header,this.footer,this.tbar,this.bbar,this.body,this.mc,this.bwrap,this.dd);
if(this.fbar){CQ.Ext.destroy(this.fbar,this.fbar.el)
}}CQ.Ext.destroy(this.toolbars)
},createClasses:function(){this.headerCls=this.baseCls+"-header";
this.headerTextCls=this.baseCls+"-header-text";
this.bwrapCls=this.baseCls+"-bwrap";
this.tbarCls=this.baseCls+"-tbar";
this.bodyCls=this.baseCls+"-body";
this.bbarCls=this.baseCls+"-bbar";
this.footerCls=this.baseCls+"-footer"
},createGhost:function(a,j,b){var g=document.createElement("div");
g.className="x-panel-ghost "+(a?a:"");
if(this.header){g.appendChild(this.el.dom.firstChild.cloneNode(true))
}CQ.Ext.fly(g.appendChild(document.createElement("ul"))).setHeight(this.bwrap.getHeight());
g.style.width=this.el.dom.offsetWidth+"px";
if(!b){this.container.dom.appendChild(g)
}else{CQ.Ext.getDom(b).appendChild(g)
}if(j!==false&&this.el.useShim!==false){var c=new CQ.Ext.Layer({shadow:false,useDisplay:true,constrain:false},g);
c.show();
return c
}else{return new CQ.Ext.Element(g)
}},doAutoLoad:function(){var a=this.body.getUpdater();
if(this.renderer){a.setRenderer(this.renderer)
}a.update(CQ.Ext.isObject(this.autoLoad)?this.autoLoad:{url:this.autoLoad})
},getTool:function(a){return this.tools[a]
}});
CQ.Ext.reg("panel",CQ.Ext.Panel);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.Editor=function(b,a){if(b.field){this.field=CQ.Ext.create(b.field,"textfield");
a=CQ.Ext.apply({},b);
delete a.field
}else{this.field=b
}CQ.Ext.Editor.superclass.constructor.call(this,a)
};
CQ.Ext.extend(CQ.Ext.Editor,CQ.Ext.Component,{allowBlur:true,value:"",alignment:"c-c?",offsets:[0,0],shadow:"frame",constrain:false,swallowKeys:true,completeOnEnter:true,cancelOnEsc:true,updateEl:false,initComponent:function(){CQ.Ext.Editor.superclass.initComponent.call(this);
this.addEvents("beforestartedit","startedit","beforecomplete","complete","canceledit","specialkey")
},onRender:function(b,a){this.el=new CQ.Ext.Layer({shadow:this.shadow,cls:"x-editor",parentEl:b,shim:this.shim,shadowOffset:this.shadowOffset||4,id:this.id,constrain:this.constrain});
if(this.zIndex){this.el.setZIndex(this.zIndex)
}this.el.setStyle("overflow",CQ.Ext.isGecko?"auto":"hidden");
if(this.field.msgTarget!="title"){this.field.msgTarget="qtip"
}this.field.inEditor=true;
this.mon(this.field,{scope:this,blur:this.onBlur,specialkey:this.onSpecialKey});
if(this.field.grow){this.mon(this.field,"autosize",this.el.sync,this.el,{delay:1})
}this.field.render(this.el).show();
this.field.getEl().dom.name="";
if(this.swallowKeys){this.field.el.swallowEvent(["keypress","keydown"])
}},onSpecialKey:function(j,g){var b=g.getKey(),a=this.completeOnEnter&&b==g.ENTER,c=this.cancelOnEsc&&b==g.ESC;
if(a||c){g.stopEvent();
if(a){this.completeEdit()
}else{this.cancelEdit()
}if(j.triggerBlur){j.triggerBlur()
}}this.fireEvent("specialkey",j,g)
},startEdit:function(b,c){if(this.editing){this.completeEdit()
}this.boundEl=CQ.Ext.get(b);
var a=c!==undefined?c:this.boundEl.dom.innerHTML;
if(!this.rendered){this.render(this.parentEl||document.body)
}if(this.fireEvent("beforestartedit",this,this.boundEl,a)!==false){this.startValue=a;
this.field.reset();
this.field.setValue(a);
this.realign(true);
this.editing=true;
this.show()
}},doAutoSize:function(){if(this.autoSize){var b=this.boundEl.getSize(),a=this.field.getSize();
switch(this.autoSize){case"width":this.setSize(b.width,a.height);
break;
case"height":this.setSize(a.width,b.height);
break;
case"none":this.setSize(a.width,a.height);
break;
default:this.setSize(b.width,b.height)
}}},setSize:function(a,b){delete this.field.lastSize;
this.field.setSize(a,b);
if(this.el){if(CQ.Ext.isGecko2||CQ.Ext.isOpera||(CQ.Ext.isIE7&&CQ.Ext.isStrict)){this.el.setSize(a,b)
}this.el.sync()
}},realign:function(a){if(a===true){this.doAutoSize()
}this.el.alignTo(this.boundEl,this.alignment,this.offsets)
},completeEdit:function(a){if(!this.editing){return
}if(this.field.assertValue){this.field.assertValue()
}var b=this.getValue();
if(!this.field.isValid()){if(this.revertInvalid!==false){this.cancelEdit(a)
}return
}if(String(b)===String(this.startValue)&&this.ignoreNoChange){this.hideEdit(a);
return
}if(this.fireEvent("beforecomplete",this,b,this.startValue)!==false){b=this.getValue();
if(this.updateEl&&this.boundEl){this.boundEl.update(b)
}this.hideEdit(a);
this.fireEvent("complete",this,b,this.startValue)
}},onShow:function(){this.el.show();
if(this.hideEl!==false){this.boundEl.hide()
}this.field.show().focus(false,true);
this.fireEvent("startedit",this.boundEl,this.startValue)
},cancelEdit:function(a){if(this.editing){var b=this.getValue();
this.setValue(this.startValue);
this.hideEdit(a);
this.fireEvent("canceledit",this,b,this.startValue)
}},hideEdit:function(a){if(a!==true){this.editing=false;
this.hide()
}},onBlur:function(){if(this.allowBlur===true&&this.editing&&this.selectSameEditor!==true){this.completeEdit()
}},onHide:function(){if(this.editing){this.completeEdit();
return
}this.field.blur();
if(this.field.collapse){this.field.collapse()
}this.el.hide();
if(this.hideEl!==false){this.boundEl.show()
}},setValue:function(a){this.field.setValue(a)
},getValue:function(){return this.field.getValue()
},beforeDestroy:function(){CQ.Ext.destroyMembers(this,"field");
delete this.parentEl;
delete this.boundEl
}});
CQ.Ext.reg("editor",CQ.Ext.Editor);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.ColorPalette=CQ.Ext.extend(CQ.Ext.Component,{itemCls:"x-color-palette",value:null,clickEvent:"click",ctype:"CQ.Ext.ColorPalette",allowReselect:false,colors:["000000","993300","333300","003300","003366","000080","333399","333333","800000","FF6600","808000","008000","008080","0000FF","666699","808080","FF0000","FF9900","99CC00","339966","33CCCC","3366FF","800080","969696","FF00FF","FFCC00","FFFF00","00FF00","00FFFF","00CCFF","993366","C0C0C0","FF99CC","FFCC99","FFFF99","CCFFCC","CCFFFF","99CCFF","CC99FF","FFFFFF"],initComponent:function(){CQ.Ext.ColorPalette.superclass.initComponent.call(this);
this.addEvents("select");
if(this.handler){this.on("select",this.handler,this.scope,true)
}},onRender:function(b,a){this.autoEl={tag:"div",cls:this.itemCls};
CQ.Ext.ColorPalette.superclass.onRender.call(this,b,a);
var c=this.tpl||new CQ.Ext.XTemplate('<tpl for="."><a href="#" class="color-{.}" hidefocus="on"><em><span style="background:#{.}" unselectable="on">&#160;</span></em></a></tpl>');
c.overwrite(this.el,this.colors);
this.mon(this.el,this.clickEvent,this.handleClick,this,{delegate:"a"});
if(this.clickEvent!="click"){this.mon(this.el,"click",CQ.Ext.emptyFn,this,{delegate:"a",preventDefault:true})
}},afterRender:function(){CQ.Ext.ColorPalette.superclass.afterRender.call(this);
if(this.value){var a=this.value;
this.value=null;
this.select(a,true)
}},handleClick:function(b,a){b.preventDefault();
if(!this.disabled){var g=a.className.match(/(?:^|\s)color-(.{6})(?:\s|$)/)[1];
this.select(g.toUpperCase())
}},select:function(b,a){b=b.replace("#","");
if(b!=this.value||this.allowReselect){var c=this.el;
if(this.value){c.child("a.color-"+this.value).removeClass("x-color-palette-sel")
}c.child("a.color-"+b).addClass("x-color-palette-sel");
this.value=b;
if(a!==true){this.fireEvent("select",this,b)
}}}});
CQ.Ext.reg("colorpalette",CQ.Ext.ColorPalette);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.DatePicker=CQ.Ext.extend(CQ.Ext.BoxComponent,{todayText:"Today",okText:"&#160;OK&#160;",cancelText:"Cancel",todayTip:"{0} (Spacebar)",minText:"This date is before the minimum date",maxText:"This date is after the maximum date",format:"m/d/y",disabledDaysText:"Disabled",disabledDatesText:"Disabled",monthNames:Date.monthNames,dayNames:Date.dayNames,nextText:"Next Month (Control+Right)",prevText:"Previous Month (Control+Left)",monthYearText:"Choose a month (Control+Up/Down to move years)",startDay:0,showToday:true,focusOnSelect:true,initHour:12,initComponent:function(){CQ.Ext.DatePicker.superclass.initComponent.call(this);
this.value=this.value?this.value.clearTime(true):new Date().clearTime();
this.addEvents("select");
if(this.handler){this.on("select",this.handler,this.scope||this)
}this.initDisabledDays()
},initDisabledDays:function(){if(!this.disabledDatesRE&&this.disabledDates){var b=this.disabledDates,a=b.length-1,c="(?:";
CQ.Ext.each(b,function(j,g){c+=CQ.Ext.isDate(j)?"^"+CQ.Ext.escapeRe(j.dateFormat(this.format))+"$":b[g];
if(g!=a){c+="|"
}},this);
this.disabledDatesRE=new RegExp(c+")")
}},setDisabledDates:function(a){if(CQ.Ext.isArray(a)){this.disabledDates=a;
this.disabledDatesRE=null
}else{this.disabledDatesRE=a
}this.initDisabledDays();
this.update(this.value,true)
},setDisabledDays:function(a){this.disabledDays=a;
this.update(this.value,true)
},setMinDate:function(a){this.minDate=a;
this.update(this.value,true)
},setMaxDate:function(a){this.maxDate=a;
this.update(this.value,true)
},setValue:function(a){this.value=a.clearTime(true);
this.update(this.value)
},getValue:function(){return this.value
},focus:function(){this.update(this.activeDate)
},onEnable:function(a){CQ.Ext.DatePicker.superclass.onEnable.call(this);
this.doDisabled(false);
this.update(a?this.value:this.activeDate);
if(CQ.Ext.isIE){this.el.repaint()
}},onDisable:function(){CQ.Ext.DatePicker.superclass.onDisable.call(this);
this.doDisabled(true);
if(CQ.Ext.isIE&&!CQ.Ext.isIE8){CQ.Ext.each([].concat(this.textNodes,this.el.query("th span")),function(a){CQ.Ext.fly(a).repaint()
})
}},doDisabled:function(a){this.keyNav.setDisabled(a);
this.prevRepeater.setDisabled(a);
this.nextRepeater.setDisabled(a);
if(this.showToday){this.todayKeyListener.setDisabled(a);
this.todayBtn.setDisabled(a)
}},onRender:function(g,b){var a=['<table cellspacing="0">','<tr><td class="x-date-left"><a href="#" title="',this.prevText,'">&#160;</a></td><td class="x-date-middle" align="center"></td><td class="x-date-right"><a href="#" title="',this.nextText,'">&#160;</a></td></tr>','<tr><td colspan="3"><table class="x-date-inner" cellspacing="0"><thead><tr>'],c=this.dayNames,k;
for(k=0;
k<7;
k++){var o=this.startDay+k;
if(o>6){o=o-7
}a.push("<th><span>",c[o].substr(0,1),"</span></th>")
}a[a.length]="</tr></thead><tbody><tr>";
for(k=0;
k<42;
k++){if(k%7===0&&k!==0){a[a.length]="</tr><tr>"
}a[a.length]='<td><a href="#" hidefocus="on" class="x-date-date" tabIndex="1"><em><span></span></em></a></td>'
}a.push("</tr></tbody></table></td></tr>",this.showToday?'<tr><td colspan="3" class="x-date-bottom" align="center"></td></tr>':"",'</table><div class="x-date-mp"></div>');
var n=document.createElement("div");
n.className="x-date-picker";
n.innerHTML=a.join("");
g.dom.insertBefore(n,b);
this.el=CQ.Ext.get(n);
this.eventEl=CQ.Ext.get(n.firstChild);
this.prevRepeater=new CQ.Ext.util.ClickRepeater(this.el.child("td.x-date-left a"),{handler:this.showPrevMonth,scope:this,preventDefault:true,stopDefault:true});
this.nextRepeater=new CQ.Ext.util.ClickRepeater(this.el.child("td.x-date-right a"),{handler:this.showNextMonth,scope:this,preventDefault:true,stopDefault:true});
this.monthPicker=this.el.down("div.x-date-mp");
this.monthPicker.enableDisplayMode("block");
this.keyNav=new CQ.Ext.KeyNav(this.eventEl,{left:function(m){if(m.ctrlKey){this.showPrevMonth()
}else{this.update(this.activeDate.add("d",-1))
}},right:function(m){if(m.ctrlKey){this.showNextMonth()
}else{this.update(this.activeDate.add("d",1))
}},up:function(m){if(m.ctrlKey){this.showNextYear()
}else{this.update(this.activeDate.add("d",-7))
}},down:function(m){if(m.ctrlKey){this.showPrevYear()
}else{this.update(this.activeDate.add("d",7))
}},pageUp:function(m){this.showNextMonth()
},pageDown:function(m){this.showPrevMonth()
},enter:function(m){m.stopPropagation();
return true
},scope:this});
this.el.unselectable();
this.cells=this.el.select("table.x-date-inner tbody td");
this.textNodes=this.el.query("table.x-date-inner tbody span");
this.mbtn=new CQ.Ext.Button({text:"&#160;",tooltip:this.monthYearText,renderTo:this.el.child("td.x-date-middle",true)});
this.mbtn.el.child("em").addClass("x-btn-arrow");
if(this.showToday){this.todayKeyListener=this.eventEl.addKeyListener(CQ.Ext.EventObject.SPACE,this.selectToday,this);
var j=(new Date()).dateFormat(this.format);
this.todayBtn=new CQ.Ext.Button({renderTo:this.el.child("td.x-date-bottom",true),text:String.format(this.todayText,j),tooltip:String.format(this.todayTip,j),handler:this.selectToday,scope:this})
}this.mon(this.eventEl,"mousewheel",this.handleMouseWheel,this);
this.mon(this.eventEl,"click",this.handleDateClick,this,{delegate:"a.x-date-date"});
this.mon(this.mbtn,"click",this.showMonthPicker,this);
this.onEnable(true)
},createMonthPicker:function(){if(!this.monthPicker.dom.firstChild){var a=['<table border="0" cellspacing="0">'];
for(var b=0;
b<6;
b++){a.push('<tr><td class="x-date-mp-month"><a href="#">',Date.getShortMonthName(b),"</a></td>",'<td class="x-date-mp-month x-date-mp-sep"><a href="#">',Date.getShortMonthName(b+6),"</a></td>",b===0?'<td class="x-date-mp-ybtn" align="center"><a class="x-date-mp-prev"></a></td><td class="x-date-mp-ybtn" align="center"><a class="x-date-mp-next"></a></td></tr>':'<td class="x-date-mp-year"><a href="#"></a></td><td class="x-date-mp-year"><a href="#"></a></td></tr>')
}a.push('<tr class="x-date-mp-btns"><td colspan="4"><button type="button" class="x-date-mp-ok">',this.okText,'</button><button type="button" class="x-date-mp-cancel">',this.cancelText,"</button></td></tr>","</table>");
this.monthPicker.update(a.join(""));
this.mon(this.monthPicker,"click",this.onMonthClick,this);
this.mon(this.monthPicker,"dblclick",this.onMonthDblClick,this);
this.mpMonths=this.monthPicker.select("td.x-date-mp-month");
this.mpYears=this.monthPicker.select("td.x-date-mp-year");
this.mpMonths.each(function(c,g,j){j+=1;
if((j%2)===0){c.dom.xmonth=5+Math.round(j*0.5)
}else{c.dom.xmonth=Math.round((j-1)*0.5)
}})
}},showMonthPicker:function(){if(!this.disabled){this.createMonthPicker();
var a=this.el.getSize();
this.monthPicker.setSize(a);
this.monthPicker.child("table").setSize(a);
this.mpSelMonth=(this.activeDate||this.value).getMonth();
this.updateMPMonth(this.mpSelMonth);
this.mpSelYear=(this.activeDate||this.value).getFullYear();
this.updateMPYear(this.mpSelYear);
this.monthPicker.slideIn("t",{duration:0.2})
}},updateMPYear:function(j){this.mpyear=j;
var c=this.mpYears.elements;
for(var b=1;
b<=10;
b++){var g=c[b-1],a;
if((b%2)===0){a=j+Math.round(b*0.5);
g.firstChild.innerHTML=a;
g.xyear=a
}else{a=j-(5-Math.round(b*0.5));
g.firstChild.innerHTML=a;
g.xyear=a
}this.mpYears.item(b-1)[a==this.mpSelYear?"addClass":"removeClass"]("x-date-mp-sel")
}},updateMPMonth:function(a){this.mpMonths.each(function(b,c,g){b[b.dom.xmonth==a?"addClass":"removeClass"]("x-date-mp-sel")
})
},selectMPMonth:function(a){},onMonthClick:function(g,b){g.stopEvent();
var c=new CQ.Ext.Element(b),a;
if(c.is("button.x-date-mp-cancel")){this.hideMonthPicker()
}else{if(c.is("button.x-date-mp-ok")){var j=new Date(this.mpSelYear,this.mpSelMonth,(this.activeDate||this.value).getDate());
if(j.getMonth()!=this.mpSelMonth){j=new Date(this.mpSelYear,this.mpSelMonth,1).getLastDateOfMonth()
}this.update(j);
this.hideMonthPicker()
}else{if((a=c.up("td.x-date-mp-month",2))){this.mpMonths.removeClass("x-date-mp-sel");
a.addClass("x-date-mp-sel");
this.mpSelMonth=a.dom.xmonth
}else{if((a=c.up("td.x-date-mp-year",2))){this.mpYears.removeClass("x-date-mp-sel");
a.addClass("x-date-mp-sel");
this.mpSelYear=a.dom.xyear
}else{if(c.is("a.x-date-mp-prev")){this.updateMPYear(this.mpyear-10)
}else{if(c.is("a.x-date-mp-next")){this.updateMPYear(this.mpyear+10)
}}}}}}},onMonthDblClick:function(g,b){g.stopEvent();
var c=new CQ.Ext.Element(b),a;
if((a=c.up("td.x-date-mp-month",2))){this.update(new Date(this.mpSelYear,a.dom.xmonth,(this.activeDate||this.value).getDate()));
this.hideMonthPicker()
}else{if((a=c.up("td.x-date-mp-year",2))){this.update(new Date(a.dom.xyear,this.mpSelMonth,(this.activeDate||this.value).getDate()));
this.hideMonthPicker()
}}},hideMonthPicker:function(a){if(this.monthPicker){if(a===true){this.monthPicker.hide()
}else{this.monthPicker.slideOut("t",{duration:0.2})
}}},showPrevMonth:function(a){this.update(this.activeDate.add("mo",-1))
},showNextMonth:function(a){this.update(this.activeDate.add("mo",1))
},showPrevYear:function(){this.update(this.activeDate.add("y",-1))
},showNextYear:function(){this.update(this.activeDate.add("y",1))
},handleMouseWheel:function(a){a.stopEvent();
if(!this.disabled){var b=a.getWheelDelta();
if(b>0){this.showPrevMonth()
}else{if(b<0){this.showNextMonth()
}}}},handleDateClick:function(b,a){b.stopEvent();
if(!this.disabled&&a.dateValue&&!CQ.Ext.fly(a.parentNode).hasClass("x-date-disabled")){this.cancelFocus=this.focusOnSelect===false;
this.setValue(new Date(a.dateValue));
delete this.cancelFocus;
this.fireEvent("select",this,this.value)
}},selectToday:function(){if(this.todayBtn&&!this.todayBtn.disabled){this.setValue(new Date().clearTime());
this.fireEvent("select",this,this.value)
}},update:function(L,F){if(this.rendered){var a=this.activeDate,v=this.isVisible();
this.activeDate=L;
if(!F&&a&&this.el){var u=L.getTime();
if(a.getMonth()==L.getMonth()&&a.getFullYear()==L.getFullYear()){this.cells.removeClass("x-date-selected");
this.cells.each(function(t){if(t.dom.firstChild.dateValue==u){t.addClass("x-date-selected");
if(v&&!this.cancelFocus){CQ.Ext.fly(t.dom.firstChild).focus(50)
}return false
}},this);
return
}}var n=L.getDaysInMonth(),x=L.getFirstDateOfMonth(),j=x.getDay()-this.startDay;
if(j<0){j+=7
}n+=j;
var G=L.add("mo",-1),k=G.getDaysInMonth()-j,g=this.cells.elements,y=this.textNodes,I=(new Date(G.getFullYear(),G.getMonth(),k,this.initHour)),H=new Date().clearTime().getTime(),B=L.clearTime(true).getTime(),A=this.minDate?this.minDate.clearTime(true):Number.NEGATIVE_INFINITY,D=this.maxDate?this.maxDate.clearTime(true):Number.POSITIVE_INFINITY,K=this.disabledDatesRE,z=this.disabledDatesText,N=this.disabledDays?this.disabledDays.join(""):false,J=this.disabledDaysText,E=this.format;
if(this.showToday){var q=new Date().clearTime(),c=(q<A||q>D||(K&&E&&K.test(q.dateFormat(E)))||(N&&N.indexOf(q.getDay())!=-1));
if(!this.disabled){this.todayBtn.setDisabled(c);
this.todayKeyListener[c?"disable":"enable"]()
}}var o=function(Q,w){w.title="";
var O=I.clearTime(true).getTime();
w.firstChild.dateValue=O;
if(O==H){w.className+=" x-date-today";
w.title=Q.todayText
}if(O==B){w.className+=" x-date-selected";
if(v){CQ.Ext.fly(w.firstChild).focus(50)
}}if(O<A){w.className=" x-date-disabled";
w.title=Q.minText;
return
}if(O>D){w.className=" x-date-disabled";
w.title=Q.maxText;
return
}if(N){if(N.indexOf(I.getDay())!=-1){w.title=J;
w.className=" x-date-disabled"
}}if(K&&E){var P=I.dateFormat(E);
if(K.test(P)){w.title=z.replace("%0",P);
w.className=" x-date-disabled"
}}};
var C=0;
for(;
C<j;
C++){y[C].innerHTML=(++k);
I.setDate(I.getDate()+1);
g[C].className="x-date-prevday";
o(this,g[C])
}for(;
C<n;
C++){var b=C-j+1;
y[C].innerHTML=(b);
I.setDate(I.getDate()+1);
g[C].className="x-date-active";
o(this,g[C])
}var M=0;
for(;
C<42;
C++){y[C].innerHTML=(++M);
I.setDate(I.getDate()+1);
g[C].className="x-date-nextday";
o(this,g[C])
}this.mbtn.setText(this.monthNames[L.getMonth()]+" "+L.getFullYear());
if(!this.internalRender){var m=this.el.dom.firstChild,r=m.offsetWidth;
this.el.setWidth(r+this.el.getBorderWidth("lr"));
CQ.Ext.fly(m).setWidth(r);
this.internalRender=true;
if(CQ.Ext.isOpera&&!this.secondPass){m.rows[0].cells[1].style.width=(r-(m.rows[0].cells[0].offsetWidth+m.rows[0].cells[2].offsetWidth))+"px";
this.secondPass=true;
this.update.defer(10,this,[L])
}}}},beforeDestroy:function(){if(this.rendered){CQ.Ext.destroy(this.keyNav,this.monthPicker,this.eventEl,this.mbtn,this.nextRepeater,this.prevRepeater,this.cells.el,this.todayBtn);
delete this.textNodes;
delete this.cells.elements
}}});
CQ.Ext.reg("datepicker",CQ.Ext.DatePicker);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.LoadMask=function(c,b){this.el=CQ.Ext.get(c);
CQ.Ext.apply(this,b);
if(this.store){this.store.on({scope:this,beforeload:this.onBeforeLoad,load:this.onLoad,exception:this.onLoad});
this.removeMask=CQ.Ext.value(this.removeMask,false)
}else{var a=this.el.getUpdater();
a.showLoadIndicator=false;
a.on({scope:this,beforeupdate:this.onBeforeLoad,update:this.onLoad,failure:this.onLoad});
this.removeMask=CQ.Ext.value(this.removeMask,true)
}};
CQ.Ext.LoadMask.prototype={msg:"Loading...",msgCls:"x-mask-loading",disabled:false,disable:function(){this.disabled=true
},enable:function(){this.disabled=false
},onLoad:function(){this.el.unmask(this.removeMask)
},onBeforeLoad:function(){if(!this.disabled){this.el.mask(this.msg,this.msgCls)
}},show:function(){this.onBeforeLoad()
},hide:function(){this.onLoad()
},destroy:function(){if(this.store){this.store.un("beforeload",this.onBeforeLoad,this);
this.store.un("load",this.onLoad,this);
this.store.un("exception",this.onLoad,this)
}else{var a=this.el.getUpdater();
a.un("beforeupdate",this.onBeforeLoad,this);
a.un("update",this.onLoad,this);
a.un("failure",this.onLoad,this)
}}};
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.slider.Thumb=CQ.Ext.extend(Object,{dragging:false,constructor:function(a){CQ.Ext.apply(this,a||{},{cls:"x-slider-thumb",constrain:false});
CQ.Ext.slider.Thumb.superclass.constructor.call(this,a);
if(this.slider.vertical){CQ.Ext.apply(this,CQ.Ext.slider.Thumb.Vertical)
}},render:function(){this.el=this.slider.innerEl.insertFirst({cls:this.cls});
this.initEvents()
},enable:function(){this.disabled=false;
this.el.removeClass(this.slider.disabledClass)
},disable:function(){this.disabled=true;
this.el.addClass(this.slider.disabledClass)
},initEvents:function(){var a=this.el;
a.addClassOnOver("x-slider-thumb-over");
this.tracker=new CQ.Ext.dd.DragTracker({onBeforeStart:this.onBeforeDragStart.createDelegate(this),onStart:this.onDragStart.createDelegate(this),onDrag:this.onDrag.createDelegate(this),onEnd:this.onDragEnd.createDelegate(this),tolerance:3,autoStart:300});
this.tracker.initEl(a)
},onBeforeDragStart:function(a){if(this.disabled){return false
}else{this.slider.promoteThumb(this);
return true
}},onDragStart:function(a){this.el.addClass("x-slider-thumb-drag");
this.dragging=true;
this.dragStartValue=this.value;
this.slider.fireEvent("dragstart",this.slider,a,this)
},onDrag:function(j){var c=this.slider,b=this.index,g=this.getNewValue();
if(this.constrain){var a=c.thumbs[b+1],k=c.thumbs[b-1];
if(k!=undefined&&g<=k.value){g=k.value
}if(a!=undefined&&g>=a.value){g=a.value
}}c.setValue(b,g,false);
c.fireEvent("drag",c,j,this)
},getNewValue:function(){var a=this.slider,b=a.innerEl.translatePoints(this.tracker.getXY());
return CQ.Ext.util.Format.round(a.reverseValue(b.left),a.decimalPrecision)
},onDragEnd:function(c){var a=this.slider,b=this.value;
this.el.removeClass("x-slider-thumb-drag");
this.dragging=false;
a.fireEvent("dragend",a,c);
if(this.dragStartValue!=b){a.fireEvent("changecomplete",a,b,this)
}},destroy:function(){CQ.Ext.destroyMembers(this,"tracker","el")
}});
CQ.Ext.slider.MultiSlider=CQ.Ext.extend(CQ.Ext.BoxComponent,{vertical:false,minValue:0,maxValue:100,decimalPrecision:0,keyIncrement:1,increment:0,clickRange:[5,15],clickToChange:true,animate:true,constrainThumbs:true,topThumbZIndex:10000,initComponent:function(){if(!CQ.Ext.isDefined(this.value)){this.value=this.minValue
}this.thumbs=[];
CQ.Ext.slider.MultiSlider.superclass.initComponent.call(this);
this.keyIncrement=Math.max(this.increment,this.keyIncrement);
this.addEvents("beforechange","change","changecomplete","dragstart","drag","dragend");
if(this.values==undefined||CQ.Ext.isEmpty(this.values)){this.values=[0]
}var a=this.values;
for(var b=0;
b<a.length;
b++){this.addThumb(a[b])
}if(this.vertical){CQ.Ext.apply(this,CQ.Ext.slider.Vertical)
}},addThumb:function(b){var a=new CQ.Ext.slider.Thumb({value:b,slider:this,index:this.thumbs.length,constrain:this.constrainThumbs});
this.thumbs.push(a);
if(this.rendered){a.render()
}},promoteThumb:function(g){var a=this.thumbs,m,b;
for(var k=0,c=a.length;
k<c;
k++){b=a[k];
if(b==g){m=this.topThumbZIndex
}else{m=""
}b.el.setStyle("zIndex",m)
}},onRender:function(){this.autoEl={cls:"x-slider "+(this.vertical?"x-slider-vert":"x-slider-horz"),cn:{cls:"x-slider-end",cn:{cls:"x-slider-inner",cn:[{tag:"a",cls:"x-slider-focus",href:"#",tabIndex:"-1",hidefocus:"on"}]}}};
CQ.Ext.slider.MultiSlider.superclass.onRender.apply(this,arguments);
this.endEl=this.el.first();
this.innerEl=this.endEl.first();
this.focusEl=this.innerEl.child(".x-slider-focus");
for(var b=0;
b<this.thumbs.length;
b++){this.thumbs[b].render()
}var a=this.innerEl.child(".x-slider-thumb");
this.halfThumb=(this.vertical?a.getHeight():a.getWidth())/2;
this.initEvents()
},initEvents:function(){this.mon(this.el,{scope:this,mousedown:this.onMouseDown,keydown:this.onKeyDown});
this.focusEl.swallowEvent("click",true)
},onMouseDown:function(g){if(this.disabled){return
}var c=false;
for(var b=0;
b<this.thumbs.length;
b++){c=c||g.target==this.thumbs[b].el.dom
}if(this.clickToChange&&!c){var a=this.innerEl.translatePoints(g.getXY());
this.onClickChange(a)
}this.focus()
},onClickChange:function(c){if(c.top>this.clickRange[0]&&c.top<this.clickRange[1]){var a=this.getNearest(c,"left"),b=a.index;
this.setValue(b,CQ.Ext.util.Format.round(this.reverseValue(c.left),this.decimalPrecision),undefined,true)
}},getNearest:function(o,b){var r=b=="top"?this.innerEl.getHeight()-o[b]:o[b],k=this.reverseValue(r),n=(this.maxValue-this.minValue)+5,j=0,c=null;
for(var g=0;
g<this.thumbs.length;
g++){var a=this.thumbs[g],q=a.value,m=Math.abs(q-k);
if(Math.abs(m<=n)){c=a;
j=g;
n=m
}}return c
},onKeyDown:function(b){if(this.disabled||this.thumbs.length!==1){b.preventDefault();
return
}var a=b.getKey(),c;
switch(a){case b.UP:case b.RIGHT:b.stopEvent();
c=b.ctrlKey?this.maxValue:this.getValue(0)+this.keyIncrement;
this.setValue(0,c,undefined,true);
break;
case b.DOWN:case b.LEFT:b.stopEvent();
c=b.ctrlKey?this.minValue:this.getValue(0)-this.keyIncrement;
this.setValue(0,c,undefined,true);
break;
default:b.preventDefault()
}},doSnap:function(b){if(!(this.increment&&b)){return b
}var g=b,c=this.increment,a=b%c;
if(a!=0){g-=a;
if(a*2>=c){g+=c
}else{if(a*2<-c){g-=c
}}}return g.constrain(this.minValue,this.maxValue)
},afterRender:function(){CQ.Ext.slider.MultiSlider.superclass.afterRender.apply(this,arguments);
for(var c=0;
c<this.thumbs.length;
c++){var b=this.thumbs[c];
if(b.value!==undefined){var a=this.normalizeValue(b.value);
if(a!==b.value){this.setValue(c,a,false)
}else{this.moveThumb(c,this.translateValue(a),false)
}}}},getRatio:function(){var a=this.innerEl.getWidth(),b=this.maxValue-this.minValue;
return b==0?a:(a/b)
},normalizeValue:function(a){a=this.doSnap(a);
a=CQ.Ext.util.Format.round(a,this.decimalPrecision);
a=a.constrain(this.minValue,this.maxValue);
return a
},setMinValue:function(j){this.minValue=j;
var g=0,b=this.thumbs,a=b.length,c;
for(;
g<a;
++g){c=b[g];
c.value=c.value<j?j:c.value
}this.syncThumb()
},setMaxValue:function(j){this.maxValue=j;
var g=0,b=this.thumbs,a=b.length,c;
for(;
g<a;
++g){c=b[g];
c.value=c.value>j?j:c.value
}this.syncThumb()
},setValue:function(g,c,b,k){var a=this.thumbs[g],j=a.el;
c=this.normalizeValue(c);
if(c!==a.value&&this.fireEvent("beforechange",this,c,a.value,a)!==false){a.value=c;
if(this.rendered){this.moveThumb(g,this.translateValue(c),b!==false);
this.fireEvent("change",this,c,a);
if(k){this.fireEvent("changecomplete",this,c,a)
}}}},translateValue:function(a){var b=this.getRatio();
return(a*b)-(this.minValue*b)-this.halfThumb
},reverseValue:function(b){var a=this.getRatio();
return(b+(this.minValue*a))/a
},moveThumb:function(g,c,b){var a=this.thumbs[g].el;
if(!b||this.animate===false){a.setLeft(c)
}else{a.shift({left:c,stopFx:true,duration:0.35})
}},focus:function(){this.focusEl.focus(10)
},onResize:function(c,j){var b=this.thumbs,a=b.length,g=0;
for(;
g<a;
++g){b[g].el.stopFx()
}if(CQ.Ext.isNumber(c)){this.innerEl.setWidth(c-(this.el.getPadding("l")+this.endEl.getPadding("r")))
}this.syncThumb();
CQ.Ext.slider.MultiSlider.superclass.onResize.apply(this,arguments)
},onDisable:function(){CQ.Ext.slider.MultiSlider.superclass.onDisable.call(this);
for(var b=0;
b<this.thumbs.length;
b++){var a=this.thumbs[b],c=a.el;
a.disable();
if(CQ.Ext.isIE){var g=c.getXY();
c.hide();
this.innerEl.addClass(this.disabledClass).dom.disabled=true;
if(!this.thumbHolder){this.thumbHolder=this.endEl.createChild({cls:"x-slider-thumb "+this.disabledClass})
}this.thumbHolder.show().setXY(g)
}}},onEnable:function(){CQ.Ext.slider.MultiSlider.superclass.onEnable.call(this);
for(var b=0;
b<this.thumbs.length;
b++){var a=this.thumbs[b],c=a.el;
a.enable();
if(CQ.Ext.isIE){this.innerEl.removeClass(this.disabledClass).dom.disabled=false;
if(this.thumbHolder){this.thumbHolder.hide()
}c.show();
this.syncThumb()
}}},syncThumb:function(){if(this.rendered){for(var a=0;
a<this.thumbs.length;
a++){this.moveThumb(a,this.translateValue(this.thumbs[a].value))
}}},getValue:function(a){return this.thumbs[a].value
},getValues:function(){var a=[];
for(var b=0;
b<this.thumbs.length;
b++){a.push(this.thumbs[b].value)
}return a
},beforeDestroy:function(){var b=this.thumbs;
for(var c=0,a=b.length;
c<a;
++c){b[c].destroy();
b[c]=null
}CQ.Ext.destroyMembers(this,"endEl","innerEl","focusEl","thumbHolder");
CQ.Ext.slider.MultiSlider.superclass.beforeDestroy.call(this)
}});
CQ.Ext.reg("multislider",CQ.Ext.slider.MultiSlider);
CQ.Ext.slider.SingleSlider=CQ.Ext.extend(CQ.Ext.slider.MultiSlider,{constructor:function(a){a=a||{};
CQ.Ext.applyIf(a,{values:[a.value||0]});
CQ.Ext.slider.SingleSlider.superclass.constructor.call(this,a)
},getValue:function(){return CQ.Ext.slider.SingleSlider.superclass.getValue.call(this,0)
},setValue:function(g,b){var c=CQ.Ext.toArray(arguments),a=c.length;
if(a==1||(a<=3&&typeof arguments[1]!="number")){c.unshift(0)
}return CQ.Ext.slider.SingleSlider.superclass.setValue.apply(this,c)
},syncThumb:function(){return CQ.Ext.slider.SingleSlider.superclass.syncThumb.apply(this,[0].concat(arguments))
},getNearest:function(){return this.thumbs[0]
}});
CQ.Ext.Slider=CQ.Ext.slider.SingleSlider;
CQ.Ext.reg("slider",CQ.Ext.slider.SingleSlider);
CQ.Ext.slider.Vertical={onResize:function(a,b){this.innerEl.setHeight(b-(this.el.getPadding("t")+this.endEl.getPadding("b")));
this.syncThumb()
},getRatio:function(){var b=this.innerEl.getHeight(),a=this.maxValue-this.minValue;
return b/a
},moveThumb:function(g,c,b){var a=this.thumbs[g],j=a.el;
if(!b||this.animate===false){j.setBottom(c)
}else{j.shift({bottom:c,stopFx:true,duration:0.35})
}},onClickChange:function(c){if(c.left>this.clickRange[0]&&c.left<this.clickRange[1]){var a=this.getNearest(c,"top"),b=a.index,g=this.minValue+this.reverseValue(this.innerEl.getHeight()-c.top);
this.setValue(b,CQ.Ext.util.Format.round(g,this.decimalPrecision),undefined,true)
}}};
CQ.Ext.slider.Thumb.Vertical={getNewValue:function(){var b=this.slider,c=b.innerEl,g=c.translatePoints(this.tracker.getXY()),a=c.getHeight()-g.top;
return b.minValue+CQ.Ext.util.Format.round(a/b.getRatio(),b.decimalPrecision)
}};
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.ProgressBar=CQ.Ext.extend(CQ.Ext.BoxComponent,{baseCls:"x-progress",animate:false,waitTimer:null,initComponent:function(){CQ.Ext.ProgressBar.superclass.initComponent.call(this);
this.addEvents("update")
},onRender:function(g,a){var c=new CQ.Ext.Template('<div class="{cls}-wrap">','<div class="{cls}-inner">','<div class="{cls}-bar">','<div class="{cls}-text">',"<div>&#160;</div>","</div>","</div>",'<div class="{cls}-text {cls}-text-back">',"<div>&#160;</div>","</div>","</div>","</div>");
this.el=a?c.insertBefore(a,{cls:this.baseCls},true):c.append(g,{cls:this.baseCls},true);
if(this.id){this.el.dom.id=this.id
}var b=this.el.dom.firstChild;
this.progressBar=CQ.Ext.get(b.firstChild);
if(this.textEl){this.textEl=CQ.Ext.get(this.textEl);
delete this.textTopEl
}else{this.textTopEl=CQ.Ext.get(this.progressBar.dom.firstChild);
var j=CQ.Ext.get(b.childNodes[1]);
this.textTopEl.setStyle("z-index",99).addClass("x-hidden");
this.textEl=new CQ.Ext.CompositeElement([this.textTopEl.dom.firstChild,j.dom.firstChild]);
this.textEl.setWidth(b.offsetWidth)
}this.progressBar.setHeight(b.offsetHeight)
},afterRender:function(){CQ.Ext.ProgressBar.superclass.afterRender.call(this);
if(this.value){this.updateProgress(this.value,this.text)
}else{this.updateText(this.text)
}},updateProgress:function(c,g,b){this.value=c||0;
if(g){this.updateText(g)
}if(this.rendered&&!this.isDestroyed){var a=Math.floor(c*this.el.dom.firstChild.offsetWidth);
this.progressBar.setWidth(a,b===true||(b!==false&&this.animate));
if(this.textTopEl){this.textTopEl.removeClass("x-hidden").setWidth(a)
}}this.fireEvent("update",this,c,g);
return this
},wait:function(b){if(!this.waitTimer){var a=this;
b=b||{};
this.updateText(b.text);
this.waitTimer=CQ.Ext.TaskMgr.start({run:function(c){var g=b.increment||10;
c-=1;
this.updateProgress(((((c+g)%g)+1)*(100/g))*0.01,null,b.animate)
},interval:b.interval||1000,duration:b.duration,onStop:function(){if(b.fn){b.fn.apply(b.scope||this)
}this.reset()
},scope:a})
}return this
},isWaiting:function(){return this.waitTimer!==null
},updateText:function(a){this.text=a||"&#160;";
if(this.rendered){this.textEl.update(this.text)
}return this
},syncProgressBar:function(){if(this.value){this.updateProgress(this.value,this.text)
}return this
},setSize:function(a,c){CQ.Ext.ProgressBar.superclass.setSize.call(this,a,c);
if(this.textTopEl){var b=this.el.dom.firstChild;
this.textEl.setSize(b.offsetWidth,b.offsetHeight)
}this.syncProgressBar();
return this
},reset:function(a){this.updateProgress(0);
if(this.textTopEl){this.textTopEl.addClass("x-hidden")
}this.clearTimer();
if(a===true){this.hide()
}return this
},clearTimer:function(){if(this.waitTimer){this.waitTimer.onStop=null;
CQ.Ext.TaskMgr.stop(this.waitTimer);
this.waitTimer=null
}},onDestroy:function(){this.clearTimer();
if(this.rendered){if(this.textEl.isComposite){this.textEl.clear()
}CQ.Ext.destroyMembers(this,"textEl","progressBar","textTopEl")
}CQ.Ext.ProgressBar.superclass.onDestroy.call(this)
}});
CQ.Ext.reg("progress",CQ.Ext.ProgressBar);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.data.Api=(function(){var a={};
return{actions:{create:"create",read:"read",update:"update",destroy:"destroy"},restActions:{create:"POST",read:"GET",update:"PUT",destroy:"DELETE"},isAction:function(b){return(CQ.Ext.data.Api.actions[b])?true:false
},getVerb:function(b){if(a[b]){return a[b]
}for(var c in this.actions){if(this.actions[c]===b){a[b]=c;
break
}}return(a[b]!==undefined)?a[b]:null
},isValid:function(b){var j=[];
var g=this.actions;
for(var c in b){if(!(c in g)){j.push(c)
}}return(!j.length)?true:j
},hasUniqueUrl:function(c,k){var b=(c.api[k])?c.api[k].url:null;
var j=true;
for(var g in c.api){if((j=(g===k)?true:(c.api[g].url!=b)?true:false)===false){break
}}return j
},prepare:function(b){if(!b.api){b.api={}
}for(var g in this.actions){var c=this.actions[g];
b.api[c]=b.api[c]||b.url||b.directFn;
if(typeof(b.api[c])=="string"){b.api[c]={url:b.api[c],method:(b.restful===true)?CQ.Ext.data.Api.restActions[c]:undefined}
}}},restify:function(b){b.restful=true;
for(var c in this.restActions){b.api[this.actions[c]].method||(b.api[this.actions[c]].method=this.restActions[c])
}b.onWrite=b.onWrite.createInterceptor(function(n,q,k,j){var g=q.reader;
var m=new CQ.Ext.data.Response({action:n,raw:k});
switch(k.status){case 200:return true;
break;
case 201:if(CQ.Ext.isEmpty(m.raw.responseText)){m.success=true
}else{return true
}break;
case 204:m.success=true;
m.data=null;
break;
default:return true;
break
}if(m.success===true){this.fireEvent("write",this,n,m.data,m,j,q.request.arg)
}else{this.fireEvent("exception",this,"remote",n,q,m,j)
}q.request.callback.call(q.request.scope,m.data,m,m.success);
return false
},b)
}}
})();
CQ.Ext.data.Response=function(b,a){CQ.Ext.apply(this,b,{raw:a})
};
CQ.Ext.data.Response.prototype={message:null,success:false,status:null,root:null,raw:null,getMessage:function(){return this.message
},getSuccess:function(){return this.success
},getStatus:function(){return this.status
},getRoot:function(){return this.root
},getRawResponse:function(){return this.raw
}};
CQ.Ext.data.Api.Error=CQ.Ext.extend(CQ.Ext.Error,{constructor:function(b,a){this.arg=a;
CQ.Ext.Error.call(this,b)
},name:"CQ.Ext.data.Api"});
CQ.Ext.apply(CQ.Ext.data.Api.Error.prototype,{lang:{"action-url-undefined":"No fallback url defined for this action.  When defining a DataProxy api, please be sure to define an url for each CRUD action in CQ.Ext.data.Api.actions or define a default url in addition to your api-configuration.",invalid:"received an invalid API-configuration.  Please ensure your proxy API-configuration contains only the actions defined in CQ.Ext.data.Api.actions","invalid-url":"Invalid url.  Please review your proxy configuration.",execute:'Attempted to execute an unknown action.  Valid API actions are defined in CQ.Ext.data.Api.actions"'}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.data.SortTypes={none:function(a){return a
},stripTagsRE:/<\/?[^>]+>/gi,asText:function(a){return String(a).replace(this.stripTagsRE,"")
},asUCText:function(a){return String(a).toUpperCase().replace(this.stripTagsRE,"")
},asUCString:function(a){return String(a).toUpperCase()
},asDate:function(a){if(!a){return 0
}if(CQ.Ext.isDate(a)){return a.getTime()
}return Date.parse(String(a))
},asFloat:function(a){var b=parseFloat(String(a).replace(/,/g,""));
return isNaN(b)?0:b
},asInt:function(a){var b=parseInt(String(a).replace(/,/g,""),10);
return isNaN(b)?0:b
}};
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.data.Record=function(a,b){this.id=(b||b===0)?b:CQ.Ext.data.Record.id(this);
this.data=a||{}
};
CQ.Ext.data.Record.create=function(j){var c=CQ.Ext.extend(CQ.Ext.data.Record,{});
var g=c.prototype;
g.fields=new CQ.Ext.util.MixedCollection(false,function(k){return k.name
});
for(var b=0,a=j.length;
b<a;
b++){g.fields.add(new CQ.Ext.data.Field(j[b]))
}c.getField=function(k){return g.fields.get(k)
};
return c
};
CQ.Ext.data.Record.PREFIX="ext-record";
CQ.Ext.data.Record.AUTO_ID=1;
CQ.Ext.data.Record.EDIT="edit";
CQ.Ext.data.Record.REJECT="reject";
CQ.Ext.data.Record.COMMIT="commit";
CQ.Ext.data.Record.id=function(a){a.phantom=true;
return[CQ.Ext.data.Record.PREFIX,"-",CQ.Ext.data.Record.AUTO_ID++].join("")
};
CQ.Ext.data.Record.prototype={dirty:false,editing:false,error:null,modified:null,phantom:false,join:function(a){this.store=a
},set:function(a,c){var b=CQ.Ext.isPrimitive(c)?String:CQ.Ext.encode;
if(b(this.data[a])==b(c)){return
}this.dirty=true;
if(!this.modified){this.modified={}
}if(this.modified[a]===undefined){this.modified[a]=this.data[a]
}this.data[a]=c;
if(!this.editing){this.afterEdit()
}},afterEdit:function(){if(this.store!=undefined&&typeof this.store.afterEdit=="function"){this.store.afterEdit(this)
}},afterReject:function(){if(this.store){this.store.afterReject(this)
}},afterCommit:function(){if(this.store){this.store.afterCommit(this)
}},get:function(a){return this.data[a]
},beginEdit:function(){this.editing=true;
this.modified=this.modified||{}
},cancelEdit:function(){this.editing=false;
delete this.modified
},endEdit:function(){this.editing=false;
if(this.dirty){this.afterEdit()
}},reject:function(b){var a=this.modified;
for(var c in a){if(typeof a[c]!="function"){this.data[c]=a[c]
}}this.dirty=false;
delete this.modified;
this.editing=false;
if(b!==true){this.afterReject()
}},commit:function(a){this.dirty=false;
delete this.modified;
this.editing=false;
if(a!==true){this.afterCommit()
}},getChanges:function(){var a=this.modified,b={};
for(var c in a){if(a.hasOwnProperty(c)){b[c]=this.data[c]
}}return b
},hasError:function(){return this.error!==null
},clearError:function(){this.error=null
},copy:function(a){return new this.constructor(CQ.Ext.apply({},this.data),a||this.id)
},isModified:function(a){return !!(this.modified&&this.modified.hasOwnProperty(a))
},isValid:function(){return this.fields.find(function(a){return(a.allowBlank===false&&CQ.Ext.isEmpty(this.data[a.name]))?true:false
},this)?false:true
},markDirty:function(){this.dirty=true;
if(!this.modified){this.modified={}
}this.fields.each(function(a){this.modified[a.name]=this.data[a.name]
},this)
}};
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.StoreMgr=CQ.Ext.apply(new CQ.Ext.util.MixedCollection(),{register:function(){for(var a=0,b;
(b=arguments[a]);
a++){this.add(b)
}},unregister:function(){for(var a=0,b;
(b=arguments[a]);
a++){this.remove(this.lookup(b))
}},lookup:function(j){if(CQ.Ext.isArray(j)){var b=["field1"],g=!CQ.Ext.isArray(j[0]);
if(!g){for(var c=2,a=j[0].length;
c<=a;
++c){b.push("field"+c)
}}return new CQ.Ext.data.ArrayStore({fields:b,data:j,expandData:g,autoDestroy:true,autoCreated:true})
}return CQ.Ext.isObject(j)?(j.events?j:CQ.Ext.create(j,"store")):this.get(j)
},getKey:function(a){return a.storeId
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.data.Store=CQ.Ext.extend(CQ.Ext.util.Observable,{writer:undefined,remoteSort:false,autoDestroy:false,pruneModifiedRecords:false,lastOptions:null,autoSave:true,batch:true,restful:false,paramNames:undefined,defaultParamNames:{start:"start",limit:"limit",sort:"sort",dir:"dir"},isDestroyed:false,hasMultiSort:false,batchKey:"_ext_batch_",constructor:function(a){this.data=new CQ.Ext.util.MixedCollection(false);
this.data.getKey=function(b){return b.id
};
this.removed=[];
if(a&&a.data){this.inlineData=a.data;
delete a.data
}CQ.Ext.apply(this,a);
this.baseParams=CQ.Ext.isObject(this.baseParams)?this.baseParams:{};
this.paramNames=CQ.Ext.applyIf(this.paramNames||{},this.defaultParamNames);
if((this.url||this.api)&&!this.proxy){this.proxy=new CQ.Ext.data.HttpProxy({url:this.url,api:this.api})
}if(this.restful===true&&this.proxy){this.batch=false;
CQ.Ext.data.Api.restify(this.proxy)
}if(this.reader){if(!this.recordType){this.recordType=this.reader.recordType
}if(this.reader.onMetaChange){this.reader.onMetaChange=this.reader.onMetaChange.createSequence(this.onMetaChange,this)
}if(this.writer){if(this.writer instanceof (CQ.Ext.data.DataWriter)===false){this.writer=this.buildWriter(this.writer)
}this.writer.meta=this.reader.meta;
this.pruneModifiedRecords=true
}}if(this.recordType){this.fields=this.recordType.prototype.fields
}this.modified=[];
this.addEvents("datachanged","metachange","add","remove","update","clear","exception","beforeload","load","loadexception","beforewrite","write","beforesave","save");
if(this.proxy){this.relayEvents(this.proxy,["loadexception","exception"])
}if(this.writer){this.on({scope:this,add:this.createRecords,remove:this.destroyRecord,update:this.updateRecord,clear:this.onClear})
}this.sortToggle={};
if(this.sortField){this.setDefaultSort(this.sortField,this.sortDir)
}else{if(this.sortInfo){this.setDefaultSort(this.sortInfo.field,this.sortInfo.direction)
}}CQ.Ext.data.Store.superclass.constructor.call(this);
if(this.id){this.storeId=this.id;
delete this.id
}if(this.storeId){CQ.Ext.StoreMgr.register(this)
}if(this.inlineData){this.loadData(this.inlineData);
delete this.inlineData
}else{if(this.autoLoad){this.load.defer(10,this,[typeof this.autoLoad=="object"?this.autoLoad:undefined])
}}this.batchCounter=0;
this.batches={}
},buildWriter:function(b){var a=undefined,c=(b.format||"json").toLowerCase();
switch(c){case"json":a=CQ.Ext.data.JsonWriter;
break;
case"xml":a=CQ.Ext.data.XmlWriter;
break;
default:a=CQ.Ext.data.JsonWriter
}return new a(b)
},destroy:function(){if(!this.isDestroyed){if(this.storeId){CQ.Ext.StoreMgr.unregister(this)
}this.clearData();
this.data=null;
CQ.Ext.destroy(this.proxy);
this.reader=this.writer=null;
this.purgeListeners();
this.isDestroyed=true
}},add:function(c){var j,a,b,g;
c=[].concat(c);
if(c.length<1){return
}for(j=0,a=c.length;
j<a;
j++){b=c[j];
b.join(this);
if(b.dirty||b.phantom){this.modified.push(b)
}}g=this.data.length;
this.data.addAll(c);
if(this.snapshot){this.snapshot.addAll(c)
}this.fireEvent("add",this,c,g)
},addSorted:function(a){var b=this.findInsertIndex(a);
this.insert(b,a)
},doUpdate:function(a){var b=a.id;
this.getById(b).join(null);
this.data.replace(b,a);
if(this.snapshot){this.snapshot.replace(b,a)
}a.join(this);
this.fireEvent("update",this,a,CQ.Ext.data.Record.COMMIT)
},remove:function(a){if(CQ.Ext.isArray(a)){CQ.Ext.each(a,function(c){this.remove(c)
},this);
return
}var b=this.data.indexOf(a);
if(b>-1){a.join(null);
this.data.removeAt(b)
}if(this.pruneModifiedRecords){this.modified.remove(a)
}if(this.snapshot){this.snapshot.remove(a)
}if(b>-1){this.fireEvent("remove",this,a,b)
}},removeAt:function(a){this.remove(this.getAt(a))
},removeAll:function(b){var a=[];
this.each(function(c){a.push(c)
});
this.clearData();
if(this.snapshot){this.snapshot.clear()
}if(this.pruneModifiedRecords){this.modified=[]
}if(b!==true){this.fireEvent("clear",this,a)
}},onClear:function(b,a){CQ.Ext.each(a,function(g,c){this.destroyRecord(this,g,c)
},this)
},insert:function(g,c){var j,a,b;
c=[].concat(c);
for(j=0,a=c.length;
j<a;
j++){b=c[j];
this.data.insert(g+j,b);
b.join(this);
if(b.dirty||b.phantom){this.modified.push(b)
}}if(this.snapshot){this.snapshot.addAll(c)
}this.fireEvent("add",this,c,g)
},indexOf:function(a){return this.data.indexOf(a)
},indexOfId:function(a){return this.data.indexOfKey(a)
},getById:function(a){return(this.snapshot||this.data).key(a)
},getAt:function(a){return this.data.itemAt(a)
},getRange:function(b,a){return this.data.getRange(b,a)
},storeOptions:function(a){a=CQ.Ext.apply({},a);
delete a.callback;
delete a.scope;
this.lastOptions=a
},clearData:function(){this.data.each(function(a){a.join(null)
});
this.data.clear()
},load:function(b){b=CQ.Ext.apply({},b);
this.storeOptions(b);
if(this.sortInfo&&this.remoteSort){var a=this.paramNames;
b.params=CQ.Ext.apply({},b.params);
b.params[a.sort]=this.sortInfo.field;
b.params[a.dir]=this.sortInfo.direction
}try{return this.execute("read",null,b)
}catch(c){this.handleException(c);
return false
}},updateRecord:function(b,a,c){if(c==CQ.Ext.data.Record.EDIT&&this.autoSave===true&&(!a.phantom||(a.phantom&&a.isValid()))){this.save()
}},createRecords:function(c,b,j){var g=this.modified,m=b.length,a,k;
for(k=0;
k<m;
k++){a=b[k];
if(a.phantom&&a.isValid()){a.markDirty();
if(g.indexOf(a)==-1){g.push(a)
}}}if(this.autoSave===true){this.save()
}},destroyRecord:function(b,a,c){if(this.modified.indexOf(a)!=-1){this.modified.remove(a)
}if(!a.phantom){this.removed.push(a);
a.lastIndex=c;
if(this.autoSave===true){this.save()
}}},execute:function(j,a,c,b){if(!CQ.Ext.data.Api.isAction(j)){throw new CQ.Ext.data.Api.Error("execute",j)
}c=CQ.Ext.applyIf(c||{},{params:{}});
if(b!==undefined){this.addToBatch(b)
}var g=true;
if(j==="read"){g=this.fireEvent("beforeload",this,c);
CQ.Ext.applyIf(c.params,this.baseParams)
}else{if(this.writer.listful===true&&this.restful!==true){a=(CQ.Ext.isArray(a))?a:[a]
}else{if(CQ.Ext.isArray(a)&&a.length==1){a=a.shift()
}}if((g=this.fireEvent("beforewrite",this,j,a,c))!==false){this.writer.apply(c.params,this.baseParams,j,a)
}}if(g!==false){if(this.writer&&this.proxy.url&&!this.proxy.restful&&!CQ.Ext.data.Api.hasUniqueUrl(this.proxy,j)){c.params.xaction=j
}this.proxy.request(CQ.Ext.data.Api.actions[j],a,c.params,this.reader,this.createCallback(j,a,b),this,c)
}return g
},save:function(){if(!this.writer){throw new CQ.Ext.data.Store.Error("writer-undefined")
}var m=[],n,o,j,c={},g;
if(this.removed.length){m.push(["destroy",this.removed])
}var b=[].concat(this.getModifiedRecords());
if(b.length){var k=[];
for(g=b.length-1;
g>=0;
g--){if(b[g].phantom===true){var a=b.splice(g,1).shift();
if(a.isValid()){k.push(a)
}}else{if(!b[g].isValid()){b.splice(g,1)
}}}if(k.length){m.push(["create",k])
}if(b.length){m.push(["update",b])
}}n=m.length;
if(n){j=++this.batchCounter;
for(g=0;
g<n;
++g){o=m[g];
c[o[0]]=o[1]
}if(this.fireEvent("beforesave",this,c)!==false){for(g=0;
g<n;
++g){o=m[g];
this.doTransaction(o[0],o[1],j)
}return j
}}return -1
},doTransaction:function(j,b,c){function k(m){try{this.execute(j,m,undefined,c)
}catch(n){this.handleException(n)
}}if(this.batch===false){for(var g=0,a=b.length;
g<a;
g++){k.call(this,b[g])
}}else{k.call(this,b)
}},addToBatch:function(c){var a=this.batches,g=this.batchKey+c,j=a[g];
if(!j){a[g]=j={id:c,count:0,data:{}}
}++j.count
},removeFromBatch:function(g,m,k){var c=this.batches,j=this.batchKey+g,n=c[j],a;
if(n){a=n.data[m]||[];
n.data[m]=a.concat(k);
if(n.count===1){k=n.data;
delete c[j];
this.fireEvent("save",this,g,k)
}else{--n.count
}}},createCallback:function(c,a,b){var g=CQ.Ext.data.Api.actions;
return(c=="read")?this.loadRecords:function(k,j,m){this["on"+CQ.Ext.util.Format.capitalize(c)+"Records"](m,a,[].concat(k));
if(m===true){this.fireEvent("write",this,c,k,j,a)
}this.removeFromBatch(b,c,k)
}
},clearModified:function(a){if(CQ.Ext.isArray(a)){for(var b=a.length-1;
b>=0;
b--){this.modified.splice(this.modified.indexOf(a[b]),1)
}}else{this.modified.splice(this.modified.indexOf(a),1)
}},reMap:function(b){if(CQ.Ext.isArray(b)){for(var g=0,a=b.length;
g<a;
g++){this.reMap(b[g])
}}else{delete this.data.map[b._phid];
this.data.map[b.id]=b;
var c=this.data.keys.indexOf(b._phid);
this.data.keys.splice(c,1,b.id);
delete b._phid
}},onCreateRecords:function(g,a,b){if(g===true){try{this.reader.realize(a,b)
}catch(c){this.handleException(c);
if(CQ.Ext.isArray(a)){this.onCreateRecords(g,a,b)
}}}},onUpdateRecords:function(g,a,b){if(g===true){try{this.reader.update(a,b)
}catch(c){this.handleException(c);
if(CQ.Ext.isArray(a)){this.onUpdateRecords(g,a,b)
}}}},onDestroyRecords:function(j,b,g){b=(b instanceof CQ.Ext.data.Record)?[b]:[].concat(b);
for(var c=0,a=b.length;
c<a;
c++){this.removed.splice(this.removed.indexOf(b[c]),1)
}if(j===false){for(c=b.length-1;
c>=0;
c--){this.insert(b[c].lastIndex,b[c])
}}},handleException:function(a){CQ.Ext.handleError(a)
},reload:function(a){this.load(CQ.Ext.applyIf(a||{},this.lastOptions))
},loadRecords:function(b,u,m){var j,k;
if(this.isDestroyed===true){return
}if(!b||m===false){if(m!==false){this.fireEvent("load",this,[],u)
}if(u.callback){u.callback.call(u.scope||this,[],u,false,b)
}return
}var a=b.records,n=b.totalRecords||a.length;
if(!u||u.add!==true){if(this.pruneModifiedRecords){this.modified=[]
}for(j=0,k=a.length;
j<k;
j++){a[j].join(this)
}if(this.snapshot){this.data=this.snapshot;
delete this.snapshot
}this.clearData();
this.data.addAll(a);
this.totalLength=n;
this.applySort();
this.fireEvent("datachanged",this)
}else{var q=[],g,c=0;
for(j=0,k=a.length;
j<k;
++j){g=a[j];
if(this.indexOfId(g.id)>-1){this.doUpdate(g)
}else{q.push(g);
++c
}}this.totalLength=Math.max(n,this.data.length+c);
this.add(q)
}this.fireEvent("load",this,a,u);
if(u.callback){u.callback.call(u.scope||this,a,u,true)
}},loadData:function(c,a){var b=this.reader.readRecords(c);
this.loadRecords(b,{add:a},true)
},getCount:function(){return this.data.length||0
},getTotalCount:function(){return this.totalLength||0
},getSortState:function(){return this.sortInfo
},applySort:function(){if((this.sortInfo||this.multiSortInfo)&&!this.remoteSort){this.sortData()
}},sortData:function(){var a=this.hasMultiSort?this.multiSortInfo:this.sortInfo,o=a.direction||"ASC",n=a.sorters,c=[];
if(!this.hasMultiSort){n=[{direction:o,field:a.field}]
}for(var g=0,b=n.length;
g<b;
g++){c.push(this.createSortFunction(n[g].field,n[g].direction))
}if(c.length==0){return
}var m=o.toUpperCase()=="DESC"?-1:1;
var k=function(t,r){var q=c[0].call(this,t,r);
if(c.length>1){for(var v=1,u=c.length;
v<u;
v++){q=q||c[v].call(this,t,r)
}}return m*q
};
this.data.sort(o,k);
if(this.snapshot&&this.snapshot!=this.data){this.snapshot.sort(o,k)
}},createSortFunction:function(c,b){b=b||"ASC";
var a=b.toUpperCase()=="DESC"?-1:1;
var g=this.fields.get(c).sortType;
return function(k,j){var n=g(k.data[c]),m=g(j.data[c]);
return a*(n>m?1:(n<m?-1:0))
}
},setDefaultSort:function(b,a){a=a?a.toUpperCase():"ASC";
this.sortInfo={field:b,direction:a};
this.sortToggle[b]=a
},sort:function(b,a){if(CQ.Ext.isArray(arguments[0])){return this.multiSort.call(this,b,a)
}else{return this.singleSort(b,a)
}},singleSort:function(k,c){var j=this.fields.get(k);
if(!j){return false
}var b=j.name,a=this.sortInfo||null,g=this.sortToggle?this.sortToggle[b]:null;
if(!c){if(a&&a.field==b){c=(this.sortToggle[b]||"ASC").toggle("ASC","DESC")
}else{c=j.sortDir
}}this.sortToggle[b]=c;
this.sortInfo={field:b,direction:c};
this.hasMultiSort=false;
if(this.remoteSort){if(!this.load(this.lastOptions)){if(g){this.sortToggle[b]=g
}if(a){this.sortInfo=a
}}}else{this.applySort();
this.fireEvent("datachanged",this)
}return true
},multiSort:function(b,a){this.hasMultiSort=true;
a=a||"ASC";
if(this.multiSortInfo&&a==this.multiSortInfo.direction){a=a.toggle("ASC","DESC")
}this.multiSortInfo={sorters:b,direction:a};
if(this.remoteSort){this.singleSort(b[0].field,b[0].direction)
}else{this.applySort();
this.fireEvent("datachanged",this)
}},each:function(b,a){this.data.each(b,a)
},getModifiedRecords:function(){return this.modified
},sum:function(j,k,a){var c=this.data.items,b=0;
k=k||0;
a=(a||a===0)?a:c.length-1;
for(var g=k;
g<=a;
g++){b+=(c[g].data[j]||0)
}return b
},createFilterFn:function(g,c,j,a,b){if(CQ.Ext.isEmpty(c,false)){return false
}c=this.data.createValueMatcher(c,j,a,b);
return function(k){return c.test(k.data[g])
}
},createMultipleFilterFn:function(a){return function(b){var o=true;
for(var g=0,c=a.length;
g<c;
g++){var n=a[g],m=n.fn,k=n.scope;
o=o&&m.call(k,b)
}return o
}
},filter:function(t,r,n,o,k){var q;
if(CQ.Ext.isObject(t)){t=[t]
}if(CQ.Ext.isArray(t)){var b=[];
for(var m=0,g=t.length;
m<g;
m++){var a=t[m],c=a.fn,u=a.scope||this;
if(!CQ.Ext.isFunction(c)){c=this.createFilterFn(a.property,a.value,a.anyMatch,a.caseSensitive,a.exactMatch)
}b.push({fn:c,scope:u})
}q=this.createMultipleFilterFn(b)
}else{q=this.createFilterFn(t,r,n,o,k)
}return q?this.filterBy(q):this.clearFilter()
},filterBy:function(b,a){this.snapshot=this.snapshot||this.data;
this.data=this.queryBy(b,a||this);
this.fireEvent("datachanged",this)
},clearFilter:function(a){if(this.isFiltered()){this.data=this.snapshot;
delete this.snapshot;
if(a!==true){this.fireEvent("datachanged",this)
}}},isFiltered:function(){return !!this.snapshot&&this.snapshot!=this.data
},query:function(g,c,j,a){var b=this.createFilterFn(g,c,j,a);
return b?this.queryBy(b):this.data.clone()
},queryBy:function(b,a){var c=this.snapshot||this.data;
return c.filterBy(b,a||this)
},find:function(g,c,k,j,a){var b=this.createFilterFn(g,c,j,a);
return b?this.data.findIndexBy(b,null,k):-1
},findExact:function(b,a,c){return this.data.findIndexBy(function(g){return g.get(b)===a
},this,c)
},findBy:function(b,a,c){return this.data.findIndexBy(b,a,c)
},collect:function(m,n,b){var k=(b===true&&this.snapshot)?this.snapshot.items:this.data.items;
var o,q,a=[],c={};
for(var g=0,j=k.length;
g<j;
g++){o=k[g].data[m];
q=String(o);
if((n||!CQ.Ext.isEmpty(o))&&!c[q]){c[q]=true;
a[a.length]=o
}}return a
},afterEdit:function(a){if(this.modified.indexOf(a)==-1){this.modified.push(a)
}this.fireEvent("update",this,a,CQ.Ext.data.Record.EDIT)
},afterReject:function(a){this.modified.remove(a);
this.fireEvent("update",this,a,CQ.Ext.data.Record.REJECT)
},afterCommit:function(a){this.modified.remove(a);
this.fireEvent("update",this,a,CQ.Ext.data.Record.COMMIT)
},commitChanges:function(){var a=this.modified.slice(0),c=a.length,b;
for(b=0;
b<c;
b++){a[b].commit()
}this.modified=[];
this.removed=[]
},rejectChanges:function(){var a=this.modified.slice(0),j=this.removed.slice(0).reverse(),c=a.length,g=j.length,b;
for(b=0;
b<c;
b++){a[b].reject()
}for(b=0;
b<g;
b++){this.insert(j[b].lastIndex||0,j[b]);
j[b].reject()
}this.modified=[];
this.removed=[]
},onMetaChange:function(a){this.recordType=this.reader.recordType;
this.fields=this.recordType.prototype.fields;
delete this.snapshot;
if(this.reader.meta.sortInfo){this.sortInfo=this.reader.meta.sortInfo
}else{if(this.sortInfo&&!this.fields.get(this.sortInfo.field)){delete this.sortInfo
}}if(this.writer){this.writer.meta=this.reader.meta
}this.modified=[];
this.fireEvent("metachange",this,this.reader.meta)
},findInsertIndex:function(a){this.suspendEvents();
var c=this.data.clone();
this.data.add(a);
this.applySort();
var b=this.data.indexOf(a);
this.data=c;
this.resumeEvents();
return b
},setBaseParam:function(a,b){this.baseParams=this.baseParams||{};
this.baseParams[a]=b
}});
CQ.Ext.reg("store",CQ.Ext.data.Store);
CQ.Ext.data.Store.Error=CQ.Ext.extend(CQ.Ext.Error,{name:"CQ.Ext.data.Store"});
CQ.Ext.apply(CQ.Ext.data.Store.Error.prototype,{lang:{"writer-undefined":"Attempted to execute a write-action without a DataWriter installed."}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.data.Field=CQ.Ext.extend(Object,{constructor:function(b){if(CQ.Ext.isString(b)){b={name:b}
}CQ.Ext.apply(this,b);
var g=CQ.Ext.data.Types,a=this.sortType,c;
if(this.type){if(CQ.Ext.isString(this.type)){this.type=CQ.Ext.data.Types[this.type.toUpperCase()]||g.AUTO
}}else{this.type=g.AUTO
}if(CQ.Ext.isString(a)){this.sortType=CQ.Ext.data.SortTypes[a]
}else{if(CQ.Ext.isEmpty(a)){this.sortType=this.type.sortType
}}if(!this.convert){this.convert=this.type.convert
}},dateFormat:null,useNull:false,defaultValue:"",mapping:null,sortType:null,sortDir:"ASC",allowBlank:true});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.data.DataReader=function(a,b){this.meta=a;
this.recordType=CQ.Ext.isArray(b)?CQ.Ext.data.Record.create(b):b;
if(this.recordType){this.buildExtractors()
}};
CQ.Ext.data.DataReader.prototype={getTotal:CQ.Ext.emptyFn,getRoot:CQ.Ext.emptyFn,getMessage:CQ.Ext.emptyFn,getSuccess:CQ.Ext.emptyFn,getId:CQ.Ext.emptyFn,buildExtractors:CQ.Ext.emptyFn,extractValues:CQ.Ext.emptyFn,realize:function(a,c){if(CQ.Ext.isArray(a)){for(var b=a.length-1;
b>=0;
b--){if(CQ.Ext.isArray(c)){this.realize(a.splice(b,1).shift(),c.splice(b,1).shift())
}else{this.realize(a.splice(b,1).shift(),c)
}}}else{if(CQ.Ext.isArray(c)&&c.length==1){c=c.shift()
}if(!this.isData(c)){throw new CQ.Ext.data.DataReader.Error("realize",a)
}a.phantom=false;
a._phid=a.id;
a.id=this.getId(c);
a.data=c;
a.commit();
a.store.reMap(a)
}},update:function(a,c){if(CQ.Ext.isArray(a)){for(var b=a.length-1;
b>=0;
b--){if(CQ.Ext.isArray(c)){this.update(a.splice(b,1).shift(),c.splice(b,1).shift())
}else{this.update(a.splice(b,1).shift(),c)
}}}else{if(CQ.Ext.isArray(c)&&c.length==1){c=c.shift()
}if(this.isData(c)){a.data=CQ.Ext.apply(a.data,c)
}a.commit()
}},extractData:function(q,a){var o=(this instanceof CQ.Ext.data.JsonReader)?"json":"node";
var c=[];
if(this.isData(q)&&!(this instanceof CQ.Ext.data.XmlReader)){q=[q]
}var m=this.recordType.prototype.fields,u=m.items,t=m.length,c=[];
if(a===true){var r=this.recordType;
for(var j=0;
j<q.length;
j++){var b=q[j];
var k=new r(this.extractValues(b,u,t),this.getId(b));
k[o]=b;
c.push(k)
}}else{for(var j=0;
j<q.length;
j++){var g=this.extractValues(q[j],u,t);
g[this.meta.idProperty]=this.getId(q[j]);
c.push(g)
}}return c
},isData:function(a){return(a&&CQ.Ext.isObject(a)&&!CQ.Ext.isEmpty(this.getId(a)))?true:false
},onMetaChange:function(a){delete this.ef;
this.meta=a;
this.recordType=CQ.Ext.data.Record.create(a.fields);
this.buildExtractors()
}};
CQ.Ext.data.DataReader.Error=CQ.Ext.extend(CQ.Ext.Error,{constructor:function(b,a){this.arg=a;
CQ.Ext.Error.call(this,b)
},name:"CQ.Ext.data.DataReader"});
CQ.Ext.apply(CQ.Ext.data.DataReader.Error.prototype,{lang:{update:"#update received invalid data from server.  Please see docs for DataReader#update and review your DataReader configuration.",realize:"#realize was called with invalid remote-data.  Please see the docs for DataReader#realize and review your DataReader configuration.","invalid-response":"#readResponse received an invalid response from the server."}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.data.DataWriter=function(a){CQ.Ext.apply(this,a)
};
CQ.Ext.data.DataWriter.prototype={writeAllFields:false,listful:false,apply:function(j,k,g,a){var c=[],b=g+"Record";
if(CQ.Ext.isArray(a)){CQ.Ext.each(a,function(m){c.push(this[b](m))
},this)
}else{if(a instanceof CQ.Ext.data.Record){c=this[b](a)
}}this.render(j,k,c)
},render:CQ.Ext.emptyFn,updateRecord:CQ.Ext.emptyFn,createRecord:CQ.Ext.emptyFn,destroyRecord:CQ.Ext.emptyFn,toHash:function(k,c){var j=k.fields.map,g={},b=(this.writeAllFields===false&&k.phantom===false)?k.getChanges():k.data,a;
CQ.Ext.iterate(b,function(n,m){if((a=j[n])){g[a.mapping?a.mapping:a.name]=m
}});
if(k.phantom){if(k.fields.containsKey(this.meta.idProperty)&&CQ.Ext.isEmpty(k.data[this.meta.idProperty])){delete g[this.meta.idProperty]
}}else{g[this.meta.idProperty]=k.id
}return g
},toArray:function(b){var a=[];
CQ.Ext.iterate(b,function(g,c){a.push({name:g,value:c})
},this);
return a
}};
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.data.DataProxy=function(a){a=a||{};
this.api=a.api;
this.url=a.url;
this.restful=a.restful;
this.listeners=a.listeners;
this.prettyUrls=a.prettyUrls;
this.addEvents("exception","beforeload","load","loadexception","beforewrite","write");
CQ.Ext.data.DataProxy.superclass.constructor.call(this);
try{CQ.Ext.data.Api.prepare(this)
}catch(b){if(b instanceof CQ.Ext.data.Api.Error){b.toConsole()
}}CQ.Ext.data.DataProxy.relayEvents(this,["beforewrite","write","exception"])
};
CQ.Ext.extend(CQ.Ext.data.DataProxy,CQ.Ext.util.Observable,{restful:false,setApi:function(){if(arguments.length==1){var a=CQ.Ext.data.Api.isValid(arguments[0]);
if(a===true){this.api=arguments[0]
}else{throw new CQ.Ext.data.Api.Error("invalid",a)
}}else{if(arguments.length==2){if(!CQ.Ext.data.Api.isAction(arguments[0])){throw new CQ.Ext.data.Api.Error("invalid",arguments[0])
}this.api[arguments[0]]=arguments[1]
}}CQ.Ext.data.Api.prepare(this)
},isApiAction:function(a){return(this.api[a])?true:false
},request:function(j,b,k,a,m,g,c){if(!this.api[j]&&!this.load){throw new CQ.Ext.data.DataProxy.Error("action-undefined",j)
}k=k||{};
if((j===CQ.Ext.data.Api.actions.read)?this.fireEvent("beforeload",this,k):this.fireEvent("beforewrite",this,j,b,k)!==false){this.doRequest.apply(this,arguments)
}else{m.call(g||this,null,c,false)
}},load:null,doRequest:function(j,b,k,a,m,g,c){this.load(k,a,m,g,c)
},onRead:CQ.Ext.emptyFn,onWrite:CQ.Ext.emptyFn,buildUrl:function(g,b){b=b||null;
var c=(this.conn&&this.conn.url)?this.conn.url:(this.api[g])?this.api[g].url:this.url;
if(!c){throw new CQ.Ext.data.Api.Error("invalid-url",g)
}var j=null;
var a=c.match(/(.*)(\.json|\.xml|\.html)$/);
if(a){j=a[2];
c=a[1]
}if((this.restful===true||this.prettyUrls===true)&&b instanceof CQ.Ext.data.Record&&!b.phantom){c+="/"+b.id
}return(j===null)?c:c+j
},destroy:function(){this.purgeListeners()
}});
CQ.Ext.apply(CQ.Ext.data.DataProxy,CQ.Ext.util.Observable.prototype);
CQ.Ext.util.Observable.call(CQ.Ext.data.DataProxy);
CQ.Ext.data.DataProxy.Error=CQ.Ext.extend(CQ.Ext.Error,{constructor:function(b,a){this.arg=a;
CQ.Ext.Error.call(this,b)
},name:"CQ.Ext.data.DataProxy"});
CQ.Ext.apply(CQ.Ext.data.DataProxy.Error.prototype,{lang:{"action-undefined":"DataProxy attempted to execute an API-action but found an undefined url / function.  Please review your Proxy url/api-configuration.","api-invalid":"Recieved an invalid API-configuration.  Please ensure your proxy API-configuration contains only the actions from CQ.Ext.data.Api.actions."}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.data.Request=function(a){CQ.Ext.apply(this,a)
};
CQ.Ext.data.Request.prototype={action:undefined,rs:undefined,params:undefined,callback:CQ.Ext.emptyFn,scope:undefined,reader:undefined};
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.data.Response=function(a){CQ.Ext.apply(this,a)
};
CQ.Ext.data.Response.prototype={action:undefined,success:undefined,message:undefined,data:undefined,raw:undefined,records:undefined};
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.data.ScriptTagProxy=function(a){CQ.Ext.apply(this,a);
CQ.Ext.data.ScriptTagProxy.superclass.constructor.call(this,a);
this.head=document.getElementsByTagName("head")[0]
};
CQ.Ext.data.ScriptTagProxy.TRANS_ID=1000;
CQ.Ext.extend(CQ.Ext.data.ScriptTagProxy,CQ.Ext.data.DataProxy,{timeout:30000,callbackParam:"callback",nocache:true,doRequest:function(j,k,g,m,o,q,r){var c=CQ.Ext.urlEncode(CQ.Ext.apply(g,this.extraParams));
var b=this.buildUrl(j,k);
if(!b){throw new CQ.Ext.data.Api.Error("invalid-url",b)
}b=CQ.Ext.urlAppend(b,c);
if(this.nocache){b=CQ.Ext.urlAppend(b,"_dc="+(new Date().getTime()))
}var a=++CQ.Ext.data.ScriptTagProxy.TRANS_ID;
var t={id:a,action:j,cb:"stcCallback"+a,scriptId:"stcScript"+a,params:g,arg:r,url:b,callback:o,scope:q,reader:m};
window[t.cb]=this.createCallback(j,k,t);
b+=String.format("&{0}={1}",this.callbackParam,t.cb);
if(this.autoAbort!==false){this.abort()
}t.timeoutId=this.handleFailure.defer(this.timeout,this,[t]);
var n=document.createElement("script");
n.setAttribute("src",b);
n.setAttribute("type","text/javascript");
n.setAttribute("id",t.scriptId);
this.head.appendChild(n);
this.trans=t
},createCallback:function(g,b,c){var a=this;
return function(j){a.trans=false;
a.destroyTrans(c,true);
if(g===CQ.Ext.data.Api.actions.read){a.onRead.call(a,g,c,j)
}else{a.onWrite.call(a,g,c,j,b)
}}
},onRead:function(g,c,b){var a;
try{a=c.reader.readRecords(b)
}catch(j){this.fireEvent("loadexception",this,c,b,j);
this.fireEvent("exception",this,"response",g,c,b,j);
c.callback.call(c.scope||window,null,c.arg,false);
return
}if(a.success===false){this.fireEvent("loadexception",this,c,b);
this.fireEvent("exception",this,"remote",g,c,b,null)
}else{this.fireEvent("load",this,b,c.arg)
}c.callback.call(c.scope||window,a,c.arg,a.success)
},onWrite:function(k,j,c,b){var a=j.reader;
try{var g=a.readResponse(k,c)
}catch(m){this.fireEvent("exception",this,"response",k,j,g,m);
j.callback.call(j.scope||window,null,g,false);
return
}if(!g.success===true){this.fireEvent("exception",this,"remote",k,j,g,b);
j.callback.call(j.scope||window,null,g,false);
return
}this.fireEvent("write",this,k,g.data,g,b,j.arg);
j.callback.call(j.scope||window,g.data,g,true)
},isLoading:function(){return this.trans?true:false
},abort:function(){if(this.isLoading()){this.destroyTrans(this.trans)
}},destroyTrans:function(b,a){this.head.removeChild(document.getElementById(b.scriptId));
clearTimeout(b.timeoutId);
if(a){window[b.cb]=undefined;
try{delete window[b.cb]
}catch(c){}}else{window[b.cb]=function(){window[b.cb]=undefined;
try{delete window[b.cb]
}catch(g){}}
}},handleFailure:function(a){this.trans=false;
this.destroyTrans(a,false);
if(a.action===CQ.Ext.data.Api.actions.read){this.fireEvent("loadexception",this,null,a.arg)
}this.fireEvent("exception",this,"response",a.action,{response:null,options:a.arg});
a.callback.call(a.scope||window,null,a.arg,false)
},destroy:function(){this.abort();
CQ.Ext.data.ScriptTagProxy.superclass.destroy.call(this)
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.data.HttpProxy=function(a){CQ.Ext.data.HttpProxy.superclass.constructor.call(this,a);
this.conn=a;
this.conn.url=null;
this.useAjax=!a||!a.events;
var c=CQ.Ext.data.Api.actions;
this.activeRequest={};
for(var b in c){this.activeRequest[c[b]]=undefined
}};
CQ.Ext.extend(CQ.Ext.data.HttpProxy,CQ.Ext.data.DataProxy,{getConnection:function(){return this.useAjax?CQ.Ext.Ajax:this.conn
},setUrl:function(a,b){this.conn.url=a;
if(b===true){this.url=a;
this.api=null;
CQ.Ext.data.Api.prepare(this)
}},doRequest:function(k,g,n,c,b,j,a){var m={method:(this.api[k])?this.api[k]["method"]:undefined,request:{callback:b,scope:j,arg:a},reader:c,callback:this.createCallback(k,g),scope:this};
if(n.jsonData){m.jsonData=n.jsonData
}else{if(n.xmlData){m.xmlData=n.xmlData
}else{m.params=n||{}
}}this.conn.url=this.buildUrl(k,g);
if(this.useAjax){CQ.Ext.applyIf(m,this.conn);
if(this.activeRequest[k]){}this.activeRequest[k]=CQ.Ext.Ajax.request(m)
}else{this.conn.request(m)
}this.conn.url=null
},createCallback:function(b,a){return function(j,g,c){this.activeRequest[b]=undefined;
if(!g){if(b===CQ.Ext.data.Api.actions.read){this.fireEvent("loadexception",this,j,c)
}this.fireEvent("exception",this,"response",b,j,c);
j.request.callback.call(j.request.scope,null,j.request.arg,false);
return
}if(b===CQ.Ext.data.Api.actions.read){this.onRead(b,j,c)
}else{this.onWrite(b,j,c,a)
}}
},onRead:function(g,k,b){var a;
try{a=k.reader.read(b)
}catch(j){this.fireEvent("loadexception",this,k,b,j);
this.fireEvent("exception",this,"response",g,k,b,j);
k.request.callback.call(k.request.scope,null,k.request.arg,false);
return
}if(a.success===false){this.fireEvent("loadexception",this,k,b);
var c=k.reader.readResponse(g,b);
this.fireEvent("exception",this,"remote",g,k,c,null)
}else{this.fireEvent("load",this,k,k.request.arg)
}k.request.callback.call(k.request.scope,a,k.request.arg,a.success)
},onWrite:function(j,m,c,b){var a=m.reader;
var g;
try{g=a.readResponse(j,c)
}catch(k){this.fireEvent("exception",this,"response",j,m,c,k);
m.request.callback.call(m.request.scope,null,m.request.arg,false);
return
}if(g.success===true){this.fireEvent("write",this,j,g.data,g,b,m.request.arg)
}else{this.fireEvent("exception",this,"remote",j,m,g,b)
}m.request.callback.call(m.request.scope,g.data,g,g.success)
},destroy:function(){if(!this.useAjax){this.conn.abort()
}else{if(this.activeRequest){var b=CQ.Ext.data.Api.actions;
for(var a in b){if(this.activeRequest[b[a]]){CQ.Ext.Ajax.abort(this.activeRequest[b[a]])
}}}}CQ.Ext.data.HttpProxy.superclass.destroy.call(this)
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.data.MemoryProxy=function(b){var a={};
a[CQ.Ext.data.Api.actions.read]=true;
CQ.Ext.data.MemoryProxy.superclass.constructor.call(this,{api:a});
this.data=b
};
CQ.Ext.extend(CQ.Ext.data.MemoryProxy,CQ.Ext.data.DataProxy,{doRequest:function(b,c,a,g,k,m,n){a=a||{};
var o;
try{o=g.readRecords(this.data)
}catch(j){this.fireEvent("loadexception",this,null,n,j);
this.fireEvent("exception",this,"response",b,n,null,j);
k.call(m,null,n,false);
return
}k.call(m,o,n,true)
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.data.Types=new function(){var a=CQ.Ext.data.SortTypes;
CQ.Ext.apply(this,{stripRe:/[\$,%]/g,AUTO:{convert:function(b){return b
},sortType:a.none,type:"auto"},STRING:{convert:function(b){return(b===undefined||b===null)?"":String(b)
},sortType:a.asUCString,type:"string"},INT:{convert:function(b){return b!==undefined&&b!==null&&b!==""?parseInt(String(b).replace(CQ.Ext.data.Types.stripRe,""),10):(this.useNull?null:0)
},sortType:a.none,type:"int"},FLOAT:{convert:function(b){return b!==undefined&&b!==null&&b!==""?parseFloat(String(b).replace(CQ.Ext.data.Types.stripRe,""),10):(this.useNull?null:0)
},sortType:a.none,type:"float"},BOOL:{convert:function(b){return b===true||b==="true"||b==1
},sortType:a.none,type:"bool"},DATE:{convert:function(c){var g=this.dateFormat;
if(!c){return null
}if(CQ.Ext.isDate(c)){return c
}if(g){if(g=="timestamp"){return new Date(c*1000)
}if(g=="time"){return new Date(parseInt(c,10))
}return Date.parseDate(c,g)
}var b=Date.parse(c);
return b?new Date(b):null
},sortType:a.asDate,type:"date"}});
CQ.Ext.apply(this,{BOOLEAN:this.BOOL,INTEGER:this.INT,NUMBER:this.FLOAT})
};
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.data.JsonWriter=CQ.Ext.extend(CQ.Ext.data.DataWriter,{encode:true,encodeDelete:false,constructor:function(a){CQ.Ext.data.JsonWriter.superclass.constructor.call(this,a)
},render:function(c,g,b){if(this.encode===true){CQ.Ext.apply(c,g);
c[this.meta.root]=CQ.Ext.encode(b)
}else{var a=CQ.Ext.apply({},g);
a[this.meta.root]=b;
c.jsonData=a
}},createRecord:function(a){return this.toHash(a)
},updateRecord:function(a){return this.toHash(a)
},destroyRecord:function(b){if(this.encodeDelete){var a={};
a[this.meta.idProperty]=b.id;
return a
}else{return b.id
}}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.data.JsonReader=function(a,b){a=a||{};
CQ.Ext.applyIf(a,{idProperty:"id",successProperty:"success",totalProperty:"total"});
CQ.Ext.data.JsonReader.superclass.constructor.call(this,a,b||a.fields)
};
CQ.Ext.extend(CQ.Ext.data.JsonReader,CQ.Ext.data.DataReader,{read:function(a){var b=a.responseText;
var c=CQ.Ext.decode(b);
if(!c){throw {message:"JsonReader.read: Json object not found"}
}return this.readRecords(c)
},readResponse:function(j,b){var m=(b.responseText!==undefined)?CQ.Ext.decode(b.responseText):b;
if(!m){throw new CQ.Ext.data.JsonReader.Error("response")
}var a=this.getRoot(m),k=this.getSuccess(m);
if(k&&j===CQ.Ext.data.Api.actions.create){var g=CQ.Ext.isDefined(a);
if(g&&CQ.Ext.isEmpty(a)){throw new CQ.Ext.data.JsonReader.Error("root-empty",this.meta.root)
}else{if(!g){throw new CQ.Ext.data.JsonReader.Error("root-undefined-response",this.meta.root)
}}}var c=new CQ.Ext.data.Response({action:j,success:k,data:(a)?this.extractData(a,false):[],message:this.getMessage(m),raw:m});
if(CQ.Ext.isEmpty(c.success)){throw new CQ.Ext.data.JsonReader.Error("successProperty-response",this.meta.successProperty)
}return c
},readRecords:function(a){this.jsonData=a;
if(a.metaData){this.onMetaChange(a.metaData)
}var u=this.meta,m=this.recordType,b=m.prototype.fields,t=b.items,n=b.length,q;
var k=this.getRoot(a),j=k.length,g=j,r=true;
if(u.totalProperty){q=parseInt(this.getTotal(a),10);
if(!isNaN(q)){g=q
}}if(u.successProperty){q=this.getSuccess(a);
if(q===false||q==="false"){r=false
}}return{success:r,records:this.extractData(k,true),totalRecords:g}
},buildExtractors:function(){if(this.ef){return
}var q=this.meta,m=this.recordType,k=m.prototype.fields,o=k.items,n=k.length;
if(q.totalProperty){this.getTotal=this.createAccessor(q.totalProperty)
}if(q.successProperty){this.getSuccess=this.createAccessor(q.successProperty)
}if(q.messageProperty){this.getMessage=this.createAccessor(q.messageProperty)
}this.getRoot=q.root?this.createAccessor(q.root):function(g){return g
};
if(q.id||q.idProperty){var j=this.createAccessor(q.id||q.idProperty);
this.getId=function(t){var g=j(t);
return(g===undefined||g==="")?null:g
}
}else{this.getId=function(){return null
}
}var c=[];
for(var b=0;
b<n;
b++){k=o[b];
var a=(k.mapping!==undefined&&k.mapping!==null)?k.mapping:k.name;
c.push(this.createAccessor(a))
}this.ef=c
},simpleAccess:function(b,a){return b[a]
},createAccessor:function(){var a=/[\[\.]/;
return function(c){if(CQ.Ext.isEmpty(c)){return CQ.Ext.emptyFn
}if(CQ.Ext.isFunction(c)){return c
}var b=String(c).search(a);
if(b>=0){return new Function("obj","return obj"+(b>0?".":"")+c)
}return function(g){return g[c]
}
}
}(),extractValues:function(n,g,a){var m,c={};
for(var k=0;
k<a;
k++){m=g[k];
var b=this.ef[k](n);
c[m.name]=m.convert((b!==undefined)?b:m.defaultValue,n)
}return c
}});
CQ.Ext.data.JsonReader.Error=CQ.Ext.extend(CQ.Ext.Error,{constructor:function(b,a){this.arg=a;
CQ.Ext.Error.call(this,b)
},name:"CQ.Ext.data.JsonReader"});
CQ.Ext.apply(CQ.Ext.data.JsonReader.Error.prototype,{lang:{response:"An error occurred while json-decoding your server response","successProperty-response":'Could not locate your "successProperty" in your server response.  Please review your JsonReader config to ensure the config-property "successProperty" matches the property in your server-response.  See the JsonReader docs.',"root-undefined-config":'Your JsonReader was configured without a "root" property.  Please review your JsonReader config and make sure to define the root property.  See the JsonReader docs.',"idProperty-undefined":'Your JsonReader was configured without an "idProperty"  Please review your JsonReader configuration and ensure the "idProperty" is set (e.g.: "id").  See the JsonReader docs.',"root-empty":'Data was expected to be returned by the server in the "root" property of the response.  Please review your JsonReader configuration to ensure the "root" property matches that returned in the server-response.  See JsonReader docs.'}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.data.ArrayReader=CQ.Ext.extend(CQ.Ext.data.JsonReader,{readRecords:function(y){this.arrayData=y;
var t=this.meta,g=t?CQ.Ext.num(t.idIndex,t.id):null,b=this.recordType,x=b.prototype.fields,E=[],m=true,q;
var A=this.getRoot(y);
for(var D=0,F=A.length;
D<F;
D++){var z=A[D],a={},w=((g||g===0)&&z[g]!==undefined&&z[g]!==""?z[g]:null);
for(var C=0,u=x.length;
C<u;
C++){var G=x.items[C],B=G.mapping!==undefined&&G.mapping!==null?G.mapping:C;
q=z[B]!==undefined?z[B]:G.defaultValue;
q=G.convert(q,z);
a[G.name]=q
}var c=new b(a,w);
c.json=z;
E[E.length]=c
}var r=E.length;
if(t.totalProperty){q=parseInt(this.getTotal(y),10);
if(!isNaN(q)){r=q
}}if(t.successProperty){q=this.getSuccess(y);
if(q===false||q==="false"){m=false
}}return{success:m,records:E,totalRecords:r}
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.data.ArrayStore=CQ.Ext.extend(CQ.Ext.data.Store,{constructor:function(a){CQ.Ext.data.ArrayStore.superclass.constructor.call(this,CQ.Ext.apply(a,{reader:new CQ.Ext.data.ArrayReader(a)}))
},loadData:function(j,b){if(this.expandData===true){var g=[];
for(var c=0,a=j.length;
c<a;
c++){g[g.length]=[j[c]]
}j=g
}CQ.Ext.data.ArrayStore.superclass.loadData.call(this,j,b)
}});
CQ.Ext.reg("arraystore",CQ.Ext.data.ArrayStore);
CQ.Ext.data.SimpleStore=CQ.Ext.data.ArrayStore;
CQ.Ext.reg("simplestore",CQ.Ext.data.SimpleStore);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.data.JsonStore=CQ.Ext.extend(CQ.Ext.data.Store,{constructor:function(a){CQ.Ext.data.JsonStore.superclass.constructor.call(this,CQ.Ext.apply(a,{reader:new CQ.Ext.data.JsonReader(a)}))
}});
CQ.Ext.reg("jsonstore",CQ.Ext.data.JsonStore);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.data.XmlWriter=function(a){CQ.Ext.data.XmlWriter.superclass.constructor.apply(this,arguments);
this.tpl=(typeof(this.tpl)==="string")?new CQ.Ext.XTemplate(this.tpl).compile():this.tpl.compile()
};
CQ.Ext.extend(CQ.Ext.data.XmlWriter,CQ.Ext.data.DataWriter,{documentRoot:"xrequest",forceDocumentRoot:false,root:"records",xmlVersion:"1.0",xmlEncoding:"ISO-8859-15",tpl:'<tpl for="."><\u003fxml version="{version}" encoding="{encoding}"\u003f><tpl if="documentRoot"><{documentRoot}><tpl for="baseParams"><tpl for="."><{name}>{value}</{name}></tpl></tpl></tpl><tpl if="records.length&gt;1"><{root}></tpl><tpl for="records"><{parent.record}><tpl for="."><{name}>{value}</{name}></tpl></{parent.record}></tpl><tpl if="records.length&gt;1"></{root}></tpl><tpl if="documentRoot"></{documentRoot}></tpl></tpl>',render:function(b,c,a){c=this.toArray(c);
b.xmlData=this.tpl.applyTemplate({version:this.xmlVersion,encoding:this.xmlEncoding,documentRoot:(c.length>0||this.forceDocumentRoot===true)?this.documentRoot:false,record:this.meta.record,root:this.root,baseParams:c,records:(CQ.Ext.isArray(a[0]))?a:[a]})
},createRecord:function(a){return this.toArray(this.toHash(a))
},updateRecord:function(a){return this.toArray(this.toHash(a))
},destroyRecord:function(b){var a={};
a[this.meta.idProperty]=b.id;
return this.toArray(a)
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.data.XmlReader=function(a,b){a=a||{};
CQ.Ext.applyIf(a,{idProperty:a.idProperty||a.idPath||a.id,successProperty:a.successProperty||a.success});
CQ.Ext.data.XmlReader.superclass.constructor.call(this,a,b||a.fields)
};
CQ.Ext.extend(CQ.Ext.data.XmlReader,CQ.Ext.data.DataReader,{read:function(a){var b=a.responseXML;
if(!b){throw {message:"XmlReader.read: XML Document not available"}
}return this.readRecords(b)
},readRecords:function(g){this.xmlData=g;
var a=g.documentElement||g,c=CQ.Ext.DomQuery,k=0,j=true;
if(this.meta.totalProperty){k=this.getTotal(a,0)
}if(this.meta.successProperty){j=this.getSuccess(a)
}var b=this.extractData(c.select(this.meta.record,a),true);
return{success:j,records:b,totalRecords:k||b.length}
},readResponse:function(k,b){var j=CQ.Ext.DomQuery,m=b.responseXML,a=m.documentElement||m;
var c=new CQ.Ext.data.Response({action:k,success:this.getSuccess(a),message:this.getMessage(a),data:this.extractData(j.select(this.meta.record,a)||j.select(this.meta.root,a),false),raw:m});
if(CQ.Ext.isEmpty(c.success)){throw new CQ.Ext.data.DataReader.Error("successProperty-response",this.meta.successProperty)
}if(k===CQ.Ext.data.Api.actions.create){var g=CQ.Ext.isDefined(c.data);
if(g&&CQ.Ext.isEmpty(c.data)){throw new CQ.Ext.data.JsonReader.Error("root-empty",this.meta.root)
}else{if(!g){throw new CQ.Ext.data.JsonReader.Error("root-undefined-response",this.meta.root)
}}}return c
},getSuccess:function(){return true
},buildExtractors:function(){if(this.ef){return
}var q=this.meta,m=this.recordType,k=m.prototype.fields,o=k.items,n=k.length;
if(q.totalProperty){this.getTotal=this.createAccessor(q.totalProperty)
}if(q.successProperty){this.getSuccess=this.createAccessor(q.successProperty)
}if(q.messageProperty){this.getMessage=this.createAccessor(q.messageProperty)
}this.getRoot=function(g){return(!CQ.Ext.isEmpty(g[this.meta.record]))?g[this.meta.record]:g[this.meta.root]
};
if(q.idPath||q.idProperty){var j=this.createAccessor(q.idPath||q.idProperty);
this.getId=function(g){var r=j(g)||g.id;
return(r===undefined||r==="")?null:r
}
}else{this.getId=function(){return null
}
}var c=[];
for(var b=0;
b<n;
b++){k=o[b];
var a=(k.mapping!==undefined&&k.mapping!==null)?k.mapping:k.name;
c.push(this.createAccessor(a))
}this.ef=c
},createAccessor:function(){var a=CQ.Ext.DomQuery;
return function(b){if(CQ.Ext.isFunction(b)){return b
}switch(b){case this.meta.totalProperty:return function(c,g){return a.selectNumber(b,c,g)
};
break;
case this.meta.successProperty:return function(g,j){var c=a.selectValue(b,g,true);
var k=c!==false&&c!=="false";
return k
};
break;
default:return function(c,g){return a.selectValue(b,c,g)
};
break
}}
}(),extractValues:function(n,g,a){var m,c={};
for(var k=0;
k<a;
k++){m=g[k];
var b=this.ef[k](n);
c[m.name]=m.convert((b!==undefined)?b:m.defaultValue,n)
}return c
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.data.XmlStore=CQ.Ext.extend(CQ.Ext.data.Store,{constructor:function(a){CQ.Ext.data.XmlStore.superclass.constructor.call(this,CQ.Ext.apply(a,{reader:new CQ.Ext.data.XmlReader(a)}))
}});
CQ.Ext.reg("xmlstore",CQ.Ext.data.XmlStore);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.data.GroupingStore=CQ.Ext.extend(CQ.Ext.data.Store,{constructor:function(g){g=g||{};
this.hasMultiSort=true;
this.multiSortInfo=this.multiSortInfo||{sorters:[]};
var j=this.multiSortInfo.sorters,c=g.groupField||this.groupField,b=g.sortInfo||this.sortInfo,a=g.groupDir||this.groupDir;
if(c){j.push({field:c,direction:a})
}if(b){j.push(b)
}CQ.Ext.data.GroupingStore.superclass.constructor.call(this,g);
this.addEvents("groupchange");
this.applyGroupField()
},remoteGroup:false,groupOnSort:false,groupDir:"ASC",clearGrouping:function(){this.groupField=false;
if(this.remoteGroup){if(this.baseParams){delete this.baseParams.groupBy;
delete this.baseParams.groupDir
}var a=this.lastOptions;
if(a&&a.params){delete a.params.groupBy;
delete a.params.groupDir
}this.reload()
}else{this.sort();
this.fireEvent("datachanged",this)
}},groupBy:function(j,a,g){g=g?(String(g).toUpperCase()=="DESC"?"DESC":"ASC"):this.groupDir;
if(this.groupField==j&&this.groupDir==g&&!a){return
}var c=this.multiSortInfo.sorters;
if(c.length>0&&c[0].field==this.groupField){c.shift()
}this.groupField=j;
this.groupDir=g;
this.applyGroupField();
var b=function(){this.fireEvent("groupchange",this,this.getGroupState())
};
if(this.groupOnSort){this.sort(j,g);
b.call(this);
return
}if(this.remoteGroup){this.on("load",b,this,{single:true});
this.reload()
}else{this.sort(c);
b.call(this)
}},sort:function(m,c){if(this.remoteSort){return CQ.Ext.data.GroupingStore.superclass.sort.call(this,m,c)
}var k=[];
if(CQ.Ext.isArray(arguments[0])){k=arguments[0]
}else{if(m==undefined){k=this.sortInfo?[this.sortInfo]:[]
}else{var j=this.fields.get(m);
if(!j){return false
}var b=j.name,a=this.sortInfo||null,g=this.sortToggle?this.sortToggle[b]:null;
if(!c){if(a&&a.field==b){c=(this.sortToggle[b]||"ASC").toggle("ASC","DESC")
}else{c=j.sortDir
}}this.sortToggle[b]=c;
this.sortInfo={field:b,direction:c};
k=[this.sortInfo]
}}if(this.groupField){k.unshift({direction:this.groupDir,field:this.groupField})
}return this.multiSort.call(this,k,c)
},applyGroupField:function(){if(this.remoteGroup){if(!this.baseParams){this.baseParams={}
}CQ.Ext.apply(this.baseParams,{groupBy:this.groupField,groupDir:this.groupDir});
var a=this.lastOptions;
if(a&&a.params){a.params.groupDir=this.groupDir;
delete a.params.groupBy
}}},applyGrouping:function(a){if(this.groupField!==false){this.groupBy(this.groupField,true,this.groupDir);
return true
}else{if(a===true){this.fireEvent("datachanged",this)
}return false
}},getGroupState:function(){return this.groupOnSort&&this.groupField!==false?(this.sortInfo?this.sortInfo.field:undefined):this.groupField
}});
CQ.Ext.reg("groupingstore",CQ.Ext.data.GroupingStore);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.data.DirectProxy=function(a){CQ.Ext.apply(this,a);
if(typeof this.paramOrder=="string"){this.paramOrder=this.paramOrder.split(/[\s,|]/)
}CQ.Ext.data.DirectProxy.superclass.constructor.call(this,a)
};
CQ.Ext.extend(CQ.Ext.data.DirectProxy,CQ.Ext.data.DataProxy,{paramOrder:undefined,paramsAsHash:true,directFn:undefined,doRequest:function(b,c,a,j,o,q,t){var n=[],m=this.api[b]||this.directFn;
switch(b){case CQ.Ext.data.Api.actions.create:n.push(a.jsonData);
break;
case CQ.Ext.data.Api.actions.read:if(m.directCfg.method.len>0){if(this.paramOrder){for(var g=0,k=this.paramOrder.length;
g<k;
g++){n.push(a[this.paramOrder[g]])
}}else{if(this.paramsAsHash){n.push(a)
}}}break;
case CQ.Ext.data.Api.actions.update:n.push(a.jsonData);
break;
case CQ.Ext.data.Api.actions.destroy:n.push(a.jsonData);
break
}var r={params:a||{},request:{callback:o,scope:q,arg:t},reader:j};
n.push(this.createCallback(b,c,r),this);
m.apply(window,n)
},createCallback:function(g,a,b){var c=this;
return function(j,k){if(!k.status){if(g===CQ.Ext.data.Api.actions.read){c.fireEvent("loadexception",c,b,k,null)
}c.fireEvent("exception",c,"remote",g,b,k,null);
b.request.callback.call(b.request.scope,null,b.request.arg,false);
return
}if(g===CQ.Ext.data.Api.actions.read){c.onRead(g,b,j,k)
}else{c.onWrite(g,b,j,k,a)
}}
},onRead:function(k,j,a,g){var b;
try{b=j.reader.readRecords(a)
}catch(c){this.fireEvent("loadexception",this,j,g,c);
this.fireEvent("exception",this,"response",k,j,g,c);
j.request.callback.call(j.request.scope,null,j.request.arg,false);
return
}this.fireEvent("load",this,g,j.request.arg);
j.request.callback.call(j.request.scope,b,j.request.arg,true)
},onWrite:function(k,g,a,c,b){var j=g.reader.extractData(g.reader.getRoot(a),false);
var m=g.reader.getSuccess(a);
m=(m!==false);
if(m){this.fireEvent("write",this,k,j,c,b,g.request.arg)
}else{this.fireEvent("exception",this,"remote",k,g,a,b)
}g.request.callback.call(g.request.scope,j,c,m)
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.data.DirectStore=CQ.Ext.extend(CQ.Ext.data.Store,{constructor:function(a){var b=CQ.Ext.apply({},{batchTransactions:false},a);
CQ.Ext.data.DirectStore.superclass.constructor.call(this,CQ.Ext.apply(b,{proxy:CQ.Ext.isDefined(b.proxy)?b.proxy:new CQ.Ext.data.DirectProxy(CQ.Ext.copyTo({},b,"paramOrder,paramsAsHash,directFn,api")),reader:(!CQ.Ext.isDefined(b.reader)&&b.fields)?new CQ.Ext.data.JsonReader(CQ.Ext.copyTo({},b,"totalProperty,root,idProperty"),b.fields):b.reader}))
}});
CQ.Ext.reg("directstore",CQ.Ext.data.DirectStore);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.Direct=CQ.Ext.extend(CQ.Ext.util.Observable,{exceptions:{TRANSPORT:"xhr",PARSE:"parse",LOGIN:"login",SERVER:"exception"},constructor:function(){this.addEvents("event","exception");
this.transactions={};
this.providers={}
},addProvider:function(j){var c=arguments;
if(c.length>1){for(var g=0,b=c.length;
g<b;
g++){this.addProvider(c[g])
}return
}if(!j.events){j=new CQ.Ext.Direct.PROVIDERS[j.type](j)
}j.id=j.id||CQ.Ext.id();
this.providers[j.id]=j;
j.on("data",this.onProviderData,this);
j.on("exception",this.onProviderException,this);
if(!j.isConnected()){j.connect()
}return j
},getProvider:function(a){return this.providers[a]
},removeProvider:function(b){var a=b.id?b:this.providers[b];
a.un("data",this.onProviderData,this);
a.un("exception",this.onProviderException,this);
delete this.providers[a.id];
return a
},addTransaction:function(a){this.transactions[a.tid]=a;
return a
},removeTransaction:function(a){delete this.transactions[a.tid||a];
return a
},getTransaction:function(a){return this.transactions[a.tid||a]
},onProviderData:function(g,c){if(CQ.Ext.isArray(c)){for(var b=0,a=c.length;
b<a;
b++){this.onProviderData(g,c[b])
}return
}if(c.name&&c.name!="event"&&c.name!="exception"){this.fireEvent(c.name,c)
}else{if(c.type=="exception"){this.fireEvent("exception",c)
}}this.fireEvent("event",c,g)
},createEvent:function(a,b){return new CQ.Ext.Direct.eventTypes[a.type](CQ.Ext.apply(a,b))
}});
CQ.Ext.Direct=new CQ.Ext.Direct();
CQ.Ext.Direct.TID=1;
CQ.Ext.Direct.PROVIDERS={};
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.Direct.Transaction=function(a){CQ.Ext.apply(this,a);
this.tid=++CQ.Ext.Direct.TID;
this.retryCount=0
};
CQ.Ext.Direct.Transaction.prototype={send:function(){this.provider.queueTransaction(this)
},retry:function(){this.retryCount++;
this.send()
},getProvider:function(){return this.provider
}};
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.Direct.Event=function(a){CQ.Ext.apply(this,a)
};
CQ.Ext.Direct.Event.prototype={status:true,getData:function(){return this.data
}};
CQ.Ext.Direct.RemotingEvent=CQ.Ext.extend(CQ.Ext.Direct.Event,{type:"rpc",getTransaction:function(){return this.transaction||CQ.Ext.Direct.getTransaction(this.tid)
}});
CQ.Ext.Direct.ExceptionEvent=CQ.Ext.extend(CQ.Ext.Direct.RemotingEvent,{status:false,type:"exception"});
CQ.Ext.Direct.eventTypes={rpc:CQ.Ext.Direct.RemotingEvent,event:CQ.Ext.Direct.Event,exception:CQ.Ext.Direct.ExceptionEvent};
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.direct.Provider=CQ.Ext.extend(CQ.Ext.util.Observable,{priority:1,constructor:function(a){CQ.Ext.apply(this,a);
this.addEvents("connect","disconnect","data","exception");
CQ.Ext.direct.Provider.superclass.constructor.call(this,a)
},isConnected:function(){return false
},connect:CQ.Ext.emptyFn,disconnect:CQ.Ext.emptyFn});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.direct.JsonProvider=CQ.Ext.extend(CQ.Ext.direct.Provider,{parseResponse:function(a){if(!CQ.Ext.isEmpty(a.responseText)){if(typeof a.responseText=="object"){return a.responseText
}return CQ.Ext.decode(a.responseText)
}return null
},getEvents:function(m){var j=null;
try{j=this.parseResponse(m)
}catch(k){var g=new CQ.Ext.Direct.ExceptionEvent({data:k,xhr:m,code:CQ.Ext.Direct.exceptions.PARSE,message:"Error parsing json response: \n\n "+j});
return[g]
}var c=[];
if(CQ.Ext.isArray(j)){for(var b=0,a=j.length;
b<a;
b++){c.push(CQ.Ext.Direct.createEvent(j[b]))
}}else{c.push(CQ.Ext.Direct.createEvent(j))
}return c
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.direct.PollingProvider=CQ.Ext.extend(CQ.Ext.direct.JsonProvider,{priority:3,interval:3000,constructor:function(a){CQ.Ext.direct.PollingProvider.superclass.constructor.call(this,a);
this.addEvents("beforepoll","poll")
},isConnected:function(){return !!this.pollTask
},connect:function(){if(this.url&&!this.pollTask){this.pollTask=CQ.Ext.TaskMgr.start({run:function(){if(this.fireEvent("beforepoll",this)!==false){if(typeof this.url=="function"){this.url(this.baseParams)
}else{CQ.Ext.Ajax.request({url:this.url,callback:this.onData,scope:this,params:this.baseParams})
}}},interval:this.interval,scope:this});
this.fireEvent("connect",this)
}else{if(!this.url){throw"Error initializing PollingProvider, no url configured."
}}},disconnect:function(){if(this.pollTask){CQ.Ext.TaskMgr.stop(this.pollTask);
delete this.pollTask;
this.fireEvent("disconnect",this)
}},onData:function(g,m,k){if(m){var c=this.getEvents(k);
for(var b=0,a=c.length;
b<a;
b++){var j=c[b];
this.fireEvent("data",this,j)
}}else{var j=new CQ.Ext.Direct.ExceptionEvent({data:j,code:CQ.Ext.Direct.exceptions.TRANSPORT,message:"Unable to connect to the server.",xhr:k});
this.fireEvent("data",this,j)
}}});
CQ.Ext.Direct.PROVIDERS.polling=CQ.Ext.direct.PollingProvider;
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.direct.RemotingProvider=CQ.Ext.extend(CQ.Ext.direct.JsonProvider,{enableBuffer:10,maxRetries:1,timeout:undefined,constructor:function(a){CQ.Ext.direct.RemotingProvider.superclass.constructor.call(this,a);
this.addEvents("beforecall","call");
this.namespace=(CQ.Ext.isString(this.namespace))?CQ.Ext.ns(this.namespace):this.namespace||window;
this.transactions={};
this.callBuffer=[]
},initAPI:function(){var n=this.actions;
for(var q in n){var g=this.namespace[q]||(this.namespace[q]={}),j=n[q];
for(var k=0,b=j.length;
k<b;
k++){var a=j[k];
g[a.name]=this.createMethod(q,a)
}}},isConnected:function(){return !!this.connected
},connect:function(){if(this.url){this.initAPI();
this.connected=true;
this.fireEvent("connect",this)
}else{if(!this.url){throw"Error initializing RemotingProvider, no url configured."
}}},disconnect:function(){if(this.connected){this.connected=false;
this.fireEvent("disconnect",this)
}},onData:function(a,k,m){if(k){var n=this.getEvents(m);
for(var b=0,c=n.length;
b<c;
b++){var g=n[b],o=this.getTransaction(g);
this.fireEvent("data",this,g);
if(o){this.doCallback(o,g,true);
CQ.Ext.Direct.removeTransaction(o)
}}}else{var j=[].concat(a.ts);
for(var b=0,c=j.length;
b<c;
b++){var o=this.getTransaction(j[b]);
if(o&&o.retryCount<this.maxRetries){o.retry()
}else{var g=new CQ.Ext.Direct.ExceptionEvent({data:g,transaction:o,code:CQ.Ext.Direct.exceptions.TRANSPORT,message:"Unable to connect to the server.",xhr:m});
this.fireEvent("data",this,g);
if(o){this.doCallback(o,g,false);
CQ.Ext.Direct.removeTransaction(o)
}}}}},getCallData:function(a){return{action:a.action,method:a.method,data:a.data,type:"rpc",tid:a.tid}
},doSend:function(g){var k={url:this.url,callback:this.onData,scope:this,ts:g,timeout:this.timeout},b;
if(CQ.Ext.isArray(g)){b=[];
for(var c=0,a=g.length;
c<a;
c++){b.push(this.getCallData(g[c]))
}}else{b=this.getCallData(g)
}if(this.enableUrlEncode){var j={};
j[CQ.Ext.isString(this.enableUrlEncode)?this.enableUrlEncode:"data"]=CQ.Ext.encode(b);
k.params=j
}else{k.jsonData=b
}CQ.Ext.Ajax.request(k)
},combineAndSend:function(){var a=this.callBuffer.length;
if(a>0){this.doSend(a==1?this.callBuffer[0]:this.callBuffer);
this.callBuffer=[]
}},queueTransaction:function(a){if(a.form){this.processForm(a);
return
}this.callBuffer.push(a);
if(this.enableBuffer){if(!this.callTask){this.callTask=new CQ.Ext.util.DelayedTask(this.combineAndSend,this)
}this.callTask.delay(CQ.Ext.isNumber(this.enableBuffer)?this.enableBuffer:10)
}else{this.combineAndSend()
}},doCall:function(o,a,b){var n=null,j=b[a.len],k=b[a.len+1];
if(a.len!==0){n=b.slice(0,a.len)
}var g=new CQ.Ext.Direct.Transaction({provider:this,args:b,action:o,method:a.name,data:n,cb:k&&CQ.Ext.isFunction(j)?j.createDelegate(k):j});
if(this.fireEvent("beforecall",this,g,a)!==false){CQ.Ext.Direct.addTransaction(g);
this.queueTransaction(g);
this.fireEvent("call",this,g,a)
}},doForm:function(q,b,k,o,j){var g=new CQ.Ext.Direct.Transaction({provider:this,action:q,method:b.name,args:[k,o,j],cb:j&&CQ.Ext.isFunction(o)?o.createDelegate(j):o,isForm:true});
if(this.fireEvent("beforecall",this,g,b)!==false){CQ.Ext.Direct.addTransaction(g);
var a=String(k.getAttribute("enctype")).toLowerCase()=="multipart/form-data",n={extTID:g.tid,extAction:q,extMethod:b.name,extType:"rpc",extUpload:String(a)};
CQ.Ext.apply(g,{form:CQ.Ext.getDom(k),isUpload:a,params:o&&CQ.Ext.isObject(o.params)?CQ.Ext.apply(n,o.params):n});
this.fireEvent("call",this,g,b);
this.processForm(g)
}},processForm:function(a){CQ.Ext.Ajax.request({url:this.url,params:a.params,callback:this.onData,scope:this,form:a.form,isUpload:a.isUpload,ts:a})
},createMethod:function(g,a){var b;
if(!a.formHandler){b=function(){this.doCall(g,a,Array.prototype.slice.call(arguments,0))
}.createDelegate(this)
}else{b=function(j,k,c){this.doForm(g,a,j,k,c)
}.createDelegate(this)
}b.directCfg={action:g,method:a};
return b
},getTransaction:function(a){return a&&a.tid?CQ.Ext.Direct.getTransaction(a.tid):null
},doCallback:function(c,j){var g=j.status?"success":"failure";
if(c&&c.cb){var b=c.cb,a=CQ.Ext.isDefined(j.result)?j.result:j.data;
if(CQ.Ext.isFunction(b)){b(a,j)
}else{CQ.Ext.callback(b[g],b.scope,[a,j]);
CQ.Ext.callback(b.callback,b.scope,[a,j])
}}}});
CQ.Ext.Direct.PROVIDERS.remoting=CQ.Ext.direct.RemotingProvider;
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.Window=CQ.Ext.extend(CQ.Ext.Panel,{baseCls:"x-window",resizable:true,draggable:true,closable:true,closeAction:"close",constrain:false,constrainHeader:false,plain:false,minimizable:false,maximizable:false,minHeight:100,minWidth:200,expandOnShow:true,showAnimDuration:0.25,hideAnimDuration:0.25,collapsible:false,initHidden:undefined,hidden:true,elements:"header,body",frame:true,floating:true,initComponent:function(){this.initTools();
CQ.Ext.Window.superclass.initComponent.call(this);
this.addEvents("resize","maximize","minimize","restore");
if(CQ.Ext.isDefined(this.initHidden)){this.hidden=this.initHidden
}if(this.hidden===false){this.hidden=true;
this.show()
}},getState:function(){return CQ.Ext.apply(CQ.Ext.Window.superclass.getState.call(this)||{},this.getBox(true))
},onRender:function(b,a){CQ.Ext.Window.superclass.onRender.call(this,b,a);
if(this.plain){this.el.addClass("x-window-plain")
}this.focusEl=this.el.createChild({tag:"a",href:"#",cls:"x-dlg-focus",tabIndex:"-1",html:"&#160;"});
this.focusEl.swallowEvent("click",true);
this.proxy=this.el.createProxy("x-window-proxy");
this.proxy.enableDisplayMode("block");
if(this.modal){this.mask=this.container.createChild({cls:"ext-el-mask"},this.el.dom);
this.mask.enableDisplayMode("block");
this.mask.hide();
this.mon(this.mask,"click",this.focus,this)
}if(this.maximizable){this.mon(this.header,"dblclick",this.toggleMaximize,this)
}},initEvents:function(){CQ.Ext.Window.superclass.initEvents.call(this);
if(this.animateTarget){this.setAnimateTarget(this.animateTarget)
}if(this.resizable){this.resizer=new CQ.Ext.Resizable(this.el,{minWidth:this.minWidth,minHeight:this.minHeight,handles:this.resizeHandles||"all",pinned:true,resizeElement:this.resizerAction,handleCls:"x-window-handle"});
this.resizer.window=this;
this.mon(this.resizer,"beforeresize",this.beforeResize,this)
}if(this.draggable){this.header.addClass("x-window-draggable")
}this.mon(this.el,"mousedown",this.toFront,this);
this.manager=this.manager||CQ.Ext.WindowMgr;
this.manager.register(this);
if(this.maximized){this.maximized=false;
this.maximize()
}if(this.closable){var a=this.getKeyMap();
a.on(27,this.onEsc,this);
a.disable()
}},initDraggable:function(){this.dd=new CQ.Ext.Window.DD(this)
},onEsc:function(a,b){if(this.activeGhost){this.unghost()
}b.stopEvent();
this[this.closeAction]()
},beforeDestroy:function(){if(this.rendered){this.hide();
this.clearAnchor();
CQ.Ext.destroy(this.focusEl,this.resizer,this.dd,this.proxy,this.mask)
}CQ.Ext.Window.superclass.beforeDestroy.call(this)
},onDestroy:function(){if(this.manager){this.manager.unregister(this)
}CQ.Ext.Window.superclass.onDestroy.call(this)
},initTools:function(){if(this.minimizable){this.addTool({id:"minimize",handler:this.minimize.createDelegate(this,[])})
}if(this.maximizable){this.addTool({id:"maximize",handler:this.maximize.createDelegate(this,[])});
this.addTool({id:"restore",handler:this.restore.createDelegate(this,[]),hidden:true})
}if(this.closable){this.addTool({id:"close",handler:this[this.closeAction].createDelegate(this,[])})
}},resizerAction:function(){var a=this.proxy.getBox();
this.proxy.hide();
this.window.handleResize(a);
return a
},beforeResize:function(){this.resizer.minHeight=Math.max(this.minHeight,this.getFrameHeight()+40);
this.resizer.minWidth=Math.max(this.minWidth,this.getFrameWidth()+40);
this.resizeBox=this.el.getBox()
},updateHandles:function(){if(CQ.Ext.isIE&&this.resizer){this.resizer.syncHandleHeight();
this.el.repaint()
}},handleResize:function(b){var a=this.resizeBox;
if(a.x!=b.x||a.y!=b.y){this.updateBox(b)
}else{this.setSize(b);
if(CQ.Ext.isIE6&&CQ.Ext.isStrict){this.doLayout()
}}this.focus();
this.updateHandles();
this.saveState()
},focus:function(){var j=this.focusEl,a=this.defaultButton,c=typeof a,g,b;
if(CQ.Ext.isDefined(a)){if(CQ.Ext.isNumber(a)&&this.fbar){j=this.fbar.items.get(a)
}else{if(CQ.Ext.isString(a)){j=CQ.Ext.getCmp(a)
}else{j=a
}}g=j.getEl();
b=CQ.Ext.getDom(this.container);
if(g&&b){if(b!=document.body&&!CQ.Ext.lib.Region.getRegion(b).contains(CQ.Ext.lib.Region.getRegion(g.dom))){return
}}}j=j||this.focusEl;
j.focus.defer(10,j)
},setAnimateTarget:function(a){a=CQ.Ext.get(a);
this.animateTarget=a
},beforeShow:function(){delete this.el.lastXY;
delete this.el.lastLT;
if(this.x===undefined||this.y===undefined){var a=this.el.getAlignToXY(this.container,"c-c");
var b=this.el.translatePoints(a[0],a[1]);
this.x=this.x===undefined?b.left:this.x;
this.y=this.y===undefined?b.top:this.y
}this.el.setLeftTop(this.x,this.y);
if(this.expandOnShow){this.expand(false)
}if(this.modal){CQ.Ext.getBody().addClass("x-body-masked");
this.mask.setSize(CQ.Ext.lib.Dom.getViewWidth(true),CQ.Ext.lib.Dom.getViewHeight(true));
this.mask.show()
}},show:function(c,a,b){if(!this.rendered){this.render(CQ.Util.getRoot())
}if(this.hidden===false){this.toFront();
return this
}if(this.fireEvent("beforeshow",this)===false){return this
}if(a){this.on("show",a,b,{single:true})
}this.hidden=false;
if(CQ.Ext.isDefined(c)){this.setAnimateTarget(c)
}this.beforeShow();
if(this.animateTarget){this.animShow()
}else{this.afterShow()
}return this
},afterShow:function(b){if(this.isDestroyed){return false
}this.proxy.hide();
this.el.setStyle("display","block");
this.el.show();
if(this.maximized){this.fitContainer()
}if(CQ.Ext.isMac&&CQ.Ext.isGecko2){this.cascade(this.setAutoScroll)
}if(this.monitorResize||this.modal||this.constrain||this.constrainHeader){CQ.Ext.EventManager.onWindowResize(this.onWindowResize,this)
}this.doConstrain();
this.doLayout();
if(this.keyMap){this.keyMap.enable()
}this.toFront();
this.updateHandles();
if(b&&(CQ.Ext.isIE||CQ.Ext.isWebKit)){var a=this.getSize();
this.onResize(a.width,a.height)
}this.onShow();
this.fireEvent("show",this)
},animShow:function(){this.proxy.show();
this.proxy.setBox(this.animateTarget.getBox());
this.proxy.setOpacity(0);
var a=this.getBox();
this.el.setStyle("display","none");
this.proxy.shift(CQ.Ext.apply(a,{callback:this.afterShow.createDelegate(this,[true],false),scope:this,easing:"easeNone",duration:this.showAnimDuration,opacity:0.5}))
},hide:function(c,a,b){if(this.hidden||this.fireEvent("beforehide",this)===false){return this
}if(a){this.on("hide",a,b,{single:true})
}this.hidden=true;
if(c!==undefined){this.setAnimateTarget(c)
}if(this.modal){this.mask.hide();
CQ.Ext.getBody().removeClass("x-body-masked")
}if(this.animateTarget){this.animHide()
}else{this.el.hide();
this.afterHide()
}return this
},afterHide:function(){this.proxy.hide();
if(this.monitorResize||this.modal||this.constrain||this.constrainHeader){CQ.Ext.EventManager.removeResizeListener(this.onWindowResize,this)
}if(this.keyMap){this.keyMap.disable()
}this.onHide();
this.fireEvent("hide",this)
},animHide:function(){this.proxy.setOpacity(0.5);
this.proxy.show();
var a=this.getBox(false);
this.proxy.setBox(a);
this.el.hide();
this.proxy.shift(CQ.Ext.apply(this.animateTarget.getBox(),{callback:this.afterHide,scope:this,duration:this.hideAnimDuration,easing:"easeNone",opacity:0}))
},onShow:CQ.Ext.emptyFn,onHide:CQ.Ext.emptyFn,onWindowResize:function(){if(this.maximized){this.fitContainer()
}if(this.modal){this.mask.setSize("100%","100%");
var a=this.mask.dom.offsetHeight;
this.mask.setSize(CQ.Ext.lib.Dom.getViewWidth(true),CQ.Ext.lib.Dom.getViewHeight(true))
}this.doConstrain()
},doConstrain:function(){if(this.constrain||this.constrainHeader){var b;
if(this.constrain){b={right:this.el.shadowOffset,left:this.el.shadowOffset,bottom:this.el.shadowOffset}
}else{var a=this.getSize();
b={right:-(a.width-100),bottom:-(a.height-25+this.el.getConstrainOffset())}
}var c=this.el.getConstrainToXY(this.container,true,b);
if(c){this.setPosition(c[0],c[1])
}}},ghost:function(a){var c=this.createGhost(a);
var b=this.getBox(true);
c.setLeftTop(b.x,b.y);
c.setWidth(b.width);
this.el.hide();
this.activeGhost=c;
return c
},unghost:function(b,a){if(!this.activeGhost){return
}if(b!==false){this.el.show();
this.focus.defer(10,this);
if(CQ.Ext.isMac&&CQ.Ext.isGecko2){this.cascade(this.setAutoScroll)
}}if(a!==false){this.setPosition(this.activeGhost.getLeft(true),this.activeGhost.getTop(true))
}this.activeGhost.hide();
this.activeGhost.remove();
delete this.activeGhost
},minimize:function(){this.fireEvent("minimize",this);
return this
},close:function(){if(this.fireEvent("beforeclose",this)!==false){if(this.hidden){this.doClose()
}else{this.hide(null,this.doClose,this)
}}},doClose:function(){this.fireEvent("close",this);
this.destroy()
},maximize:function(){if(!this.maximized){this.expand(false);
this.restoreSize=this.getSize();
this.restorePos=this.getPosition(true);
if(this.maximizable){this.tools.maximize.hide();
this.tools.restore.show()
}this.maximized=true;
this.el.disableShadow();
if(this.dd){this.dd.lock()
}if(this.collapsible){this.tools.toggle.hide()
}this.el.addClass("x-window-maximized");
this.container.addClass("x-window-maximized-ct");
this.setPosition(0,0);
this.fitContainer();
this.fireEvent("maximize",this)
}return this
},restore:function(){if(this.maximized){var a=this.tools;
this.el.removeClass("x-window-maximized");
if(a.restore){a.restore.hide()
}if(a.maximize){a.maximize.show()
}this.setPosition(this.restorePos[0],this.restorePos[1]);
this.setSize(this.restoreSize.width,this.restoreSize.height);
delete this.restorePos;
delete this.restoreSize;
this.maximized=false;
this.el.enableShadow(true);
if(this.dd){this.dd.unlock()
}if(this.collapsible&&a.toggle){a.toggle.show()
}this.container.removeClass("x-window-maximized-ct");
this.doConstrain();
this.fireEvent("restore",this)
}return this
},toggleMaximize:function(){return this[this.maximized?"restore":"maximize"]()
},fitContainer:function(){var a=this.container.getViewSize(false);
this.setSize(a.width,a.height)
},setZIndex:function(a){if(this.modal){this.mask.setStyle("z-index",a)
}this.el.setZIndex(++a);
a+=5;
if(this.resizer){this.resizer.proxy.setStyle("z-index",++a)
}this.lastZIndex=a
},alignTo:function(b,a,c){var g=this.el.getAlignToXY(b,a,c);
this.setPagePosition(g[0],g[1]);
return this
},anchorTo:function(c,j,g,b){this.clearAnchor();
this.anchorTarget={el:c,alignment:j,offsets:g};
CQ.Ext.EventManager.onWindowResize(this.doAnchor,this);
var a=typeof b;
if(a!="undefined"){CQ.Ext.EventManager.on(window,"scroll",this.doAnchor,this,{buffer:a=="number"?b:50})
}return this.doAnchor()
},doAnchor:function(){var a=this.anchorTarget;
this.alignTo(a.el,a.alignment,a.offsets);
return this
},clearAnchor:function(){if(this.anchorTarget){CQ.Ext.EventManager.removeResizeListener(this.doAnchor,this);
CQ.Ext.EventManager.un(window,"scroll",this.doAnchor,this);
delete this.anchorTarget
}return this
},toFront:function(a){if(this.manager.bringToFront(this)){if(!a||!a.getTarget().focus){this.focus()
}}return this
},setActive:function(a){if(a){if(!this.maximized){this.el.enableShadow(true)
}this.fireEvent("activate",this)
}else{this.el.disableShadow();
this.fireEvent("deactivate",this)
}},toBack:function(){this.manager.sendToBack(this);
return this
},center:function(){var a=this.el.getAlignToXY(this.container,"c-c");
this.setPagePosition(a[0],a[1]);
return this
}});
CQ.Ext.reg("window",CQ.Ext.Window);
CQ.Ext.Window.DD=CQ.Ext.extend(CQ.Ext.dd.DD,{constructor:function(a){this.win=a;
CQ.Ext.Window.DD.superclass.constructor.call(this,a.el.id,"WindowDD-"+a.id);
this.setHandleElId(a.header.id);
this.scroll=false
},moveOnly:true,headerOffsets:[100,25],startDrag:function(){var a=this.win;
this.proxy=a.ghost(a.initialConfig.cls);
if(a.constrain!==false){var c=a.el.shadowOffset;
this.constrainTo(a.container,{right:c,left:c,bottom:c})
}else{if(a.constrainHeader!==false){var b=this.proxy.getSize();
this.constrainTo(a.container,{right:-(b.width-this.headerOffsets[0]),bottom:-(b.height-this.headerOffsets[1])})
}}},b4Drag:CQ.Ext.emptyFn,onDrag:function(a){this.alignElWithMouse(this.proxy,a.getPageX(),a.getPageY())
},endDrag:function(a){this.win.unghost();
this.win.saveState()
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.WindowGroup=function(){var k={};
var g=[];
var j=null;
var c=function(o,n){return(!o._lastAccess||o._lastAccess<n._lastAccess)?-1:1
};
var m=function(){var q=g,n=q.length;
if(n>0){q.sort(c);
var o=q[0].manager.zseed;
for(var r=0;
r<n;
r++){var t=q[r];
if(t&&!t.hidden){t.setZIndex(o+(r*10))
}}}a()
};
var b=function(n){if(n!=j){if(j){j.setActive(false)
}j=n;
if(n){n.setActive(true)
}}};
var a=function(){for(var n=g.length-1;
n>=0;
--n){if(!g[n].hidden){b(g[n]);
return
}}b(null)
};
return{zseed:9000,register:function(n){if(n.manager){n.manager.unregister(n)
}n.manager=this;
k[n.id]=n;
g.push(n);
n.on("hide",a)
},unregister:function(n){delete n.manager;
delete k[n.id];
n.un("hide",a);
g.remove(n)
},get:function(n){return typeof n=="object"?n:k[n]
},bringToFront:function(n){n=this.get(n);
if(n!=j){n._lastAccess=new Date().getTime();
m();
return true
}return false
},sendToBack:function(n){n=this.get(n);
n._lastAccess=-(new Date().getTime());
m();
return n
},hideAll:function(){for(var n in k){if(k[n]&&typeof k[n]!="function"&&k[n].isVisible()){k[n].hide()
}}},getActive:function(){return j
},getBy:function(q,o){var t=[];
for(var n=g.length-1;
n>=0;
--n){var u=g[n];
if(q.call(o||u,u)!==false){t.push(u)
}}return t
},each:function(o,n){for(var q in k){if(k[q]&&typeof k[q]!="function"){if(o.call(n||k[q],k[q])===false){return
}}}}}
};
CQ.Ext.WindowMgr=new CQ.Ext.WindowGroup();
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.MessageBox=function(){var B,b,x,A,m,r,z,a,u,w,o,k,y,C,v,n="",g="",t=["ok","yes","no","cancel"];
var c=function(E){y[E].blur();
if(B.isVisible()){B.hide();
D();
CQ.Ext.callback(b.fn,b.scope||window,[E,C.dom.value,b],1)
}};
var D=function(){if(b&&b.cls){B.el.removeClass(b.cls)
}u.reset()
};
var j=function(G,E,F){if(b&&b.closable!==false){B.hide();
D()
}if(F){F.stopEvent()
}};
var q=function(E){var G=0,F;
if(!E){CQ.Ext.each(t,function(H){y[H].hide()
});
return G
}B.footer.dom.style.display="";
CQ.Ext.iterate(y,function(H,I){F=E[H];
if(F){I.show();
I.setText(CQ.Ext.isString(F)?F:CQ.Ext.MessageBox.buttonText[H]);
G+=I.getEl().getWidth()+15
}else{I.hide()
}});
return G
};
return{getDialog:function(E){if(!B){var G=[];
y={};
CQ.Ext.each(t,function(H){G.push(y[H]=new CQ.Ext.Button({text:this.buttonText[H],handler:c.createCallback(H),hideMode:"offsets"}))
},this);
B=new CQ.Ext.Window({autoCreate:true,title:E,resizable:false,id:CQ.Util.createId("cq-msgbox"),minimizable:false,maximizable:false,stateful:false,modal:true,shim:true,buttonAlign:"center",width:400,height:100,minHeight:80,plain:true,footer:true,closable:true,close:function(){if(b&&b.buttons&&b.buttons.no&&!b.buttons.cancel){c("no")
}else{c("cancel")
}},fbar:new CQ.Ext.Toolbar({items:G,enableOverflow:false})});
B.render(CQ.Util.getRoot());
B.getEl().addClass("x-window-dlg");
x=B.mask;
m=B.body.createChild({html:'<div class="ext-mb-icon"></div><div class="ext-mb-content"><span class="ext-mb-text"></span><br /><div class="ext-mb-fix-cursor"><input type="text" class="ext-mb-input" /><textarea class="ext-mb-textarea"></textarea></div></div>'});
o=CQ.Ext.get(m.dom.firstChild);
var F=m.dom.childNodes[1];
r=CQ.Ext.get(F.firstChild);
z=CQ.Ext.get(F.childNodes[2].firstChild);
z.enableDisplayMode();
z.addKeyListener([10,13],function(){if(B.isVisible()&&b&&b.buttons){if(b.buttons.ok){c("ok")
}else{if(b.buttons.yes){c("yes")
}}}});
a=CQ.Ext.get(F.childNodes[2].childNodes[1]);
a.enableDisplayMode();
u=new CQ.Ext.ProgressBar({renderTo:m});
m.createChild({cls:"x-clear"})
}return B
},updateText:function(H){if(!B.isVisible()&&!b.width){B.setSize(this.maxWidth,100)
}r.update(H?H+" ":"&#160;");
var F=g!=""?(o.getWidth()+o.getMargins("lr")):0,J=r.getWidth()+r.getMargins("lr"),G=B.getFrameWidth("lr"),I=B.body.getFrameWidth("lr"),E;
E=Math.max(Math.min(b.width||F+J+G+I,b.maxWidth||this.maxWidth),Math.max(b.minWidth||this.minWidth,v||0));
if(b.prompt===true){C.setWidth(E-F-G-I)
}if(b.progress===true||b.wait===true){u.setSize(E-F-G-I)
}if(CQ.Ext.isIE&&E==v){E+=4
}r.update(H||"&#160;");
B.setSize(E,"auto").center();
return this
},updateProgress:function(F,E,G){u.updateProgress(F,E);
if(G){this.updateText(G)
}return this
},isVisible:function(){return B&&B.isVisible()
},hide:function(){var E=B?B.activeGhost:null;
if(this.isVisible()||E){B.hide();
D();
if(E){B.unghost(false,false)
}}return this
},show:function(H){if(this.isVisible()){this.hide()
}b=H;
var I=this.getDialog(b.title||"&#160;");
I.setTitle(b.title||"&#160;");
var E=(b.closable!==false&&b.progress!==true&&b.wait!==true);
I.tools.close.setDisplayed(E);
C=z;
b.prompt=b.prompt||(b.multiline?true:false);
if(b.prompt){if(b.multiline){z.hide();
a.show();
a.setHeight(CQ.Ext.isNumber(b.multiline)?b.multiline:this.defaultTextHeight);
C=a
}else{z.show();
a.hide()
}}else{z.hide();
a.hide()
}C.dom.value=b.value||"";
if(b.prompt){I.focusEl=C
}else{var G=b.buttons;
var F=null;
if(G&&G.ok){F=y.ok
}else{if(G&&G.yes){F=y.yes
}}if(F){I.focusEl=F
}}if(CQ.Ext.isDefined(b.iconCls)){I.setIconClass(b.iconCls)
}this.setIcon(CQ.Ext.isDefined(b.icon)?b.icon:n);
v=q(b.buttons);
u.setVisible(b.progress===true||b.wait===true);
this.updateProgress(0,b.progressText);
this.updateText(b.msg);
if(b.cls){I.el.addClass(b.cls)
}I.proxyDrag=b.proxyDrag===true;
I.modal=b.modal!==false;
I.mask=b.modal!==false?x:false;
if(!I.isVisible()){CQ.Util.getRoot().appendChild(B.el.dom);
this.getDialog().center=function(){var J=this.el.getAlignToXY(CQ.Ext.getBody(),"c-c");
this.setPagePosition(J[0],J[1]-40);
return this
};
I.center();
I.setAnimateTarget(b.animEl);
I.on("show",function(){if(E===true){I.keyMap.enable()
}else{I.keyMap.disable()
}},this,{single:true});
I.show(b.animEl)
}if(b.wait===true){u.wait(b.waitConfig)
}return this
},setIcon:function(E){if(!B){n=E;
return
}n=undefined;
if(E&&E!=""){o.removeClass("x-hidden");
o.replaceClass(g,E);
m.addClass("x-dlg-icon");
g=E
}else{o.replaceClass(g,"x-hidden");
m.removeClass("x-dlg-icon");
g="";
b.cls="ext-mb-noicon"
}return this
},progress:function(G,F,E){this.show({title:G,msg:F,buttons:false,progress:true,closable:false,minWidth:this.minProgressWidth,progressText:E});
return this
},wait:function(G,F,E){this.show({title:F,msg:G,buttons:false,closable:false,wait:true,modal:true,minWidth:this.minProgressWidth,waitConfig:E});
return this
},alert:function(H,G,F,E){this.show({title:H,msg:G,icon:CQ.Ext.MessageBox.WARNING,buttons:this.OK,fn:F,scope:E,minWidth:this.minWidth});
return this
},confirm:function(H,G,F,E){this.show({title:H,msg:G,buttons:this.YESNO,fn:F,scope:E,icon:this.QUESTION,minWidth:this.minWidth});
return this
},prompt:function(J,I,G,F,E,H){this.show({title:J,msg:I,buttons:this.OKCANCEL,fn:G,minWidth:this.minPromptWidth,scope:F,prompt:true,multiline:E,value:H});
return this
},OK:{ok:true},CANCEL:{cancel:true},OKCANCEL:{ok:true,cancel:true},YESNO:{yes:true,no:true},YESNOCANCEL:{yes:true,no:true,cancel:true},INFO:"ext-mb-info",WARNING:"ext-mb-warning",QUESTION:"ext-mb-question",ERROR:"ext-mb-error",defaultTextHeight:75,maxWidth:600,minWidth:100,minProgressWidth:250,minPromptWidth:250,buttonText:{ok:"OK",cancel:"Cancel",yes:"Yes",no:"No"}}
}();
CQ.Ext.Msg=CQ.Ext.MessageBox;
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.dd.PanelProxy=CQ.Ext.extend(Object,{constructor:function(a,b){this.panel=a;
this.id=this.panel.id+"-ddproxy";
CQ.Ext.apply(this,b)
},insertProxy:true,setStatus:CQ.Ext.emptyFn,reset:CQ.Ext.emptyFn,update:CQ.Ext.emptyFn,stop:CQ.Ext.emptyFn,sync:CQ.Ext.emptyFn,getEl:function(){return this.ghost
},getGhost:function(){return this.ghost
},getProxy:function(){return this.proxy
},hide:function(){if(this.ghost){if(this.proxy){this.proxy.remove();
delete this.proxy
}this.panel.el.dom.style.display="";
this.ghost.remove();
delete this.ghost
}},show:function(){if(!this.ghost){this.ghost=this.panel.createGhost(undefined,undefined,CQ.Util.getRoot());
this.ghost.setXY(this.panel.el.getXY());
if(this.insertProxy){this.proxy=this.panel.el.insertSibling({cls:"x-panel-dd-spacer"});
this.proxy.setSize(this.panel.getSize())
}this.panel.el.dom.style.display="none"
}},repair:function(b,c,a){this.hide();
if(typeof c=="function"){c.call(a||this)
}},moveProxy:function(a,b){if(this.proxy){a.insertBefore(this.proxy.dom,b)
}}});
CQ.Ext.Panel.DD=CQ.Ext.extend(CQ.Ext.dd.DragSource,{constructor:function(b,a){this.panel=b;
this.dragData={panel:b};
this.proxy=new CQ.Ext.dd.PanelProxy(b,a);
CQ.Ext.Panel.DD.superclass.constructor.call(this,b.el,a);
var g=b.header,c=b.body;
if(g){this.setHandleElId(g.id);
c=b.header
}c.setStyle("cursor","move");
this.scroll=false
},showFrame:CQ.Ext.emptyFn,startDrag:CQ.Ext.emptyFn,b4StartDrag:function(a,b){this.proxy.show()
},b4MouseDown:function(b){var a=b.getPageX(),c=b.getPageY();
this.autoOffset(a,c)
},onInitDrag:function(a,b){this.onStartDrag(a,b);
return true
},createFrame:CQ.Ext.emptyFn,getDragEl:function(a){return this.proxy.ghost.dom
},endDrag:function(a){this.proxy.hide();
this.panel.saveState()
},autoOffset:function(a,b){a-=this.startPageX;
b-=this.startPageY;
this.setDelta(a,b)
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.state.Provider=CQ.Ext.extend(CQ.Ext.util.Observable,{constructor:function(){this.addEvents("statechange");
this.state={};
CQ.Ext.state.Provider.superclass.constructor.call(this)
},get:function(b,a){return typeof this.state[b]=="undefined"?a:this.state[b]
},clear:function(a){delete this.state[a];
this.fireEvent("statechange",this,a,null)
},set:function(a,b){this.state[a]=b;
this.fireEvent("statechange",this,a,b)
},decodeValue:function(b){var j=/^(a|n|d|b|s|o|e)\:(.*)$/,m=j.exec(unescape(b)),g,c,a,k;
if(!m||!m[1]){return
}c=m[1];
a=m[2];
switch(c){case"e":return null;
case"n":return parseFloat(a);
case"d":return new Date(Date.parse(a));
case"b":return(a=="1");
case"a":g=[];
if(a!=""){CQ.Ext.each(a.split("^"),function(n){g.push(this.decodeValue(n))
},this)
}return g;
case"o":g={};
if(a!=""){CQ.Ext.each(a.split("^"),function(n){k=n.split("=");
g[k[0]]=this.decodeValue(k[1])
},this)
}return g;
default:return a
}},encodeValue:function(c){var b,k="",j=0,a,g;
if(c==null){return"e:1"
}else{if(typeof c=="number"){b="n:"+c
}else{if(typeof c=="boolean"){b="b:"+(c?"1":"0")
}else{if(CQ.Ext.isDate(c)){b="d:"+c.toGMTString()
}else{if(CQ.Ext.isArray(c)){for(a=c.length;
j<a;
j++){k+=this.encodeValue(c[j]);
if(j!=a-1){k+="^"
}}b="a:"+k
}else{if(typeof c=="object"){for(g in c){if(typeof c[g]!="function"&&c[g]!==undefined){k+=g+"="+this.encodeValue(c[g])+"^"
}}b="o:"+k.substring(0,k.length-1)
}else{b="s:"+c
}}}}}}return escape(b)
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.state.Manager=function(){var a=new CQ.Ext.state.Provider();
return{setProvider:function(b){a=b
},get:function(c,b){return a.get(c,b)
},set:function(b,c){a.set(b,c)
},clear:function(b){a.clear(b)
},getProvider:function(){return a
}}
}();
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.state.CookieProvider=CQ.Ext.extend(CQ.Ext.state.Provider,{constructor:function(a){CQ.Ext.state.CookieProvider.superclass.constructor.call(this);
this.path="/";
this.expires=new Date(new Date().getTime()+(1000*60*60*24*7));
this.domain=null;
this.secure=false;
CQ.Ext.apply(this,a);
this.state=this.readCookies()
},set:function(a,b){if(typeof b=="undefined"||b===null){this.clear(a);
return
}this.setCookie(a,b);
CQ.Ext.state.CookieProvider.superclass.set.call(this,a,b)
},clear:function(a){this.clearCookie(a);
CQ.Ext.state.CookieProvider.superclass.clear.call(this,a)
},readCookies:function(){var g={},m=document.cookie+";",b=/\s?(.*?)=(.*?);/g,k,a,j;
while((k=b.exec(m))!=null){a=k[1];
j=k[2];
if(a&&a.substring(0,3)=="ys-"){g[a.substr(3)]=this.decodeValue(j)
}}return g
},setCookie:function(a,b){document.cookie="ys-"+a+"="+this.encodeValue(b)+((this.expires==null)?"":("; expires="+this.expires.toGMTString()))+((this.path==null)?"":("; path="+this.path))+((this.domain==null)?"":("; domain="+this.domain))+((this.secure==true)?"; secure":"")
},clearCookie:function(a){document.cookie="ys-"+a+"=null; expires=Thu, 01-Jan-70 00:00:01 GMT"+((this.path==null)?"":("; path="+this.path))+((this.domain==null)?"":("; domain="+this.domain))+((this.secure==true)?"; secure":"")
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.DataView=CQ.Ext.extend(CQ.Ext.BoxComponent,{selectedClass:"x-view-selected",emptyText:"",deferEmptyText:true,trackOver:false,blockRefresh:false,last:false,initComponent:function(){CQ.Ext.DataView.superclass.initComponent.call(this);
if(CQ.Ext.isString(this.tpl)||CQ.Ext.isArray(this.tpl)){this.tpl=new CQ.Ext.XTemplate(this.tpl)
}this.addEvents("beforeclick","click","mouseenter","mouseleave","containerclick","dblclick","contextmenu","containercontextmenu","selectionchange","beforeselect");
this.store=CQ.Ext.StoreMgr.lookup(this.store);
this.all=new CQ.Ext.CompositeElementLite();
this.selected=new CQ.Ext.CompositeElementLite()
},afterRender:function(){CQ.Ext.DataView.superclass.afterRender.call(this);
this.mon(this.getTemplateTarget(),{click:this.onClick,dblclick:this.onDblClick,contextmenu:this.onContextMenu,scope:this});
if(this.overClass||this.trackOver){this.mon(this.getTemplateTarget(),{mouseover:this.onMouseOver,mouseout:this.onMouseOut,scope:this})
}if(this.store){this.bindStore(this.store,true)
}},refresh:function(){this.clearSelections(false,true);
var b=this.getTemplateTarget(),a=this.store.getRange();
b.update("");
if(a.length<1){if(!this.deferEmptyText||this.hasSkippedEmptyText){b.update(this.emptyText)
}this.all.clear()
}else{this.tpl.overwrite(b,this.collectData(a,0));
this.all.fill(CQ.Ext.query(this.itemSelector,b.dom));
this.updateIndexes(0)
}this.hasSkippedEmptyText=true
},getTemplateTarget:function(){return this.el
},prepareData:function(a){return a
},collectData:function(b,j){var g=[],c=0,a=b.length;
for(;
c<a;
c++){g[g.length]=this.prepareData(b[c].data,j+c,b[c])
}return g
},bufferRender:function(a,b){var c=document.createElement("div");
this.tpl.overwrite(c,this.collectData(a,b));
return CQ.Ext.query(this.itemSelector,c)
},onUpdate:function(k,a){var b=this.store.indexOf(a);
if(b>-1){var j=this.isSelected(b),c=this.all.elements[b],g=this.bufferRender([a],b)[0];
this.all.replaceElement(b,g,true);
if(j){this.selected.replaceElement(c,g);
this.all.item(b).addClass(this.selectedClass)
}this.updateIndexes(b,b)
}},onAdd:function(k,g,j){if(this.all.getCount()===0){this.refresh();
return
}var c=this.bufferRender(g,j),m,b=this.all.elements;
if(j<this.all.getCount()){m=this.all.item(j).insertSibling(c,"before",true);
b.splice.apply(b,[j,0].concat(c))
}else{m=this.all.last().insertSibling(c,"after",true);
b.push.apply(b,c)
}this.updateIndexes(j)
},onRemove:function(c,a,b){this.deselect(b);
this.all.removeElement(b,true);
this.updateIndexes(b);
if(this.store.getCount()===0){this.refresh()
}},refreshNode:function(a){this.onUpdate(this.store,this.store.getAt(a))
},updateIndexes:function(g,c){var b=this.all.elements;
g=g||0;
c=c||((c===0)?0:(b.length-1));
for(var a=g;
a<=c;
a++){b[a].viewIndex=a
}},getStore:function(){return this.store
},bindStore:function(a,b){if(!b&&this.store){if(a!==this.store&&this.store.autoDestroy){this.store.destroy()
}else{this.store.un("beforeload",this.onBeforeLoad,this);
this.store.un("datachanged",this.onDataChanged,this);
this.store.un("add",this.onAdd,this);
this.store.un("remove",this.onRemove,this);
this.store.un("update",this.onUpdate,this);
this.store.un("clear",this.refresh,this)
}if(!a){this.store=null
}}if(a){a=CQ.Ext.StoreMgr.lookup(a);
a.on({scope:this,beforeload:this.onBeforeLoad,datachanged:this.onDataChanged,add:this.onAdd,remove:this.onRemove,update:this.onUpdate,clear:this.refresh})
}this.store=a;
if(a){this.refresh()
}},onDataChanged:function(){if(this.blockRefresh!==true){this.refresh.apply(this,arguments)
}},findItemFromChild:function(a){return CQ.Ext.fly(a).findParent(this.itemSelector,this.getTemplateTarget())
},onClick:function(c){var b=c.getTarget(this.itemSelector,this.getTemplateTarget()),a;
if(b){a=this.indexOf(b);
if(this.onItemClick(b,a,c)!==false){this.fireEvent("click",this,a,b,c)
}}else{if(this.fireEvent("containerclick",this,c)!==false){this.onContainerClick(c)
}}},onContainerClick:function(a){this.clearSelections()
},onContextMenu:function(b){var a=b.getTarget(this.itemSelector,this.getTemplateTarget());
if(a){this.fireEvent("contextmenu",this,this.indexOf(a),a,b)
}else{this.fireEvent("containercontextmenu",this,b)
}},onDblClick:function(b){var a=b.getTarget(this.itemSelector,this.getTemplateTarget());
if(a){this.fireEvent("dblclick",this,this.indexOf(a),a,b)
}},onMouseOver:function(b){var a=b.getTarget(this.itemSelector,this.getTemplateTarget());
if(a&&a!==this.lastItem){this.lastItem=a;
CQ.Ext.fly(a).addClass(this.overClass);
this.fireEvent("mouseenter",this,this.indexOf(a),a,b)
}},onMouseOut:function(a){if(this.lastItem){if(!a.within(this.lastItem,true,true)){CQ.Ext.fly(this.lastItem).removeClass(this.overClass);
this.fireEvent("mouseleave",this,this.indexOf(this.lastItem),this.lastItem,a);
delete this.lastItem
}}},onItemClick:function(b,a,c){if(this.fireEvent("beforeclick",this,a,b,c)===false){return false
}if(this.multiSelect){this.doMultiSelection(b,a,c);
c.preventDefault()
}else{if(this.singleSelect){this.doSingleSelection(b,a,c);
c.preventDefault()
}}return true
},doSingleSelection:function(b,a,c){if(c.ctrlKey&&this.isSelected(a)){this.deselect(a)
}else{this.select(a,false)
}},doMultiSelection:function(c,a,g){if(g.shiftKey&&this.last!==false){var b=this.last;
this.selectRange(b,a,g.ctrlKey);
this.last=b
}else{if((g.ctrlKey||this.simpleSelect)&&this.isSelected(a)){this.deselect(a)
}else{this.select(a,g.ctrlKey||g.shiftKey||this.simpleSelect)
}}},getSelectionCount:function(){return this.selected.getCount()
},getSelectedNodes:function(){return this.selected.elements
},getSelectedIndexes:function(){var b=[],g=this.selected.elements,c=0,a=g.length;
for(;
c<a;
c++){b.push(g[c].viewIndex)
}return b
},getSelectedRecords:function(){return this.getRecords(this.selected.elements)
},getRecords:function(c){var b=[],g=0,a=c.length;
for(;
g<a;
g++){b[b.length]=this.store.getAt(c[g].viewIndex)
}return b
},getRecord:function(a){return this.store.getAt(a.viewIndex)
},clearSelections:function(a,b){if((this.multiSelect||this.singleSelect)&&this.selected.getCount()>0){if(!b){this.selected.removeClass(this.selectedClass)
}this.selected.clear();
this.last=false;
if(!a){this.fireEvent("selectionchange",this,this.selected.elements)
}}},isSelected:function(a){return this.selected.contains(this.getNode(a))
},deselect:function(a){if(this.isSelected(a)){a=this.getNode(a);
this.selected.removeElement(a);
if(this.last==a.viewIndex){this.last=false
}CQ.Ext.fly(a).removeClass(this.selectedClass);
this.fireEvent("selectionchange",this,this.selected.elements)
}},select:function(g,k,b){if(CQ.Ext.isArray(g)){if(!k){this.clearSelections(true)
}for(var c=0,a=g.length;
c<a;
c++){this.select(g[c],true,true)
}if(!b){this.fireEvent("selectionchange",this,this.selected.elements)
}}else{var j=this.getNode(g);
if(!k){this.clearSelections(true)
}if(j&&!this.isSelected(j)){if(this.fireEvent("beforeselect",this,j,this.selected.elements)!==false){CQ.Ext.fly(j).addClass(this.selectedClass);
this.selected.add(j);
this.last=j.viewIndex;
if(!b){this.fireEvent("selectionchange",this,this.selected.elements)
}}}}},selectRange:function(c,a,b){if(!b){this.clearSelections(true)
}this.select(this.getNodes(c,a),true)
},getNode:function(b){if(CQ.Ext.isString(b)){return document.getElementById(b)
}else{if(CQ.Ext.isNumber(b)){return this.all.elements[b]
}else{if(b instanceof CQ.Ext.data.Record){var a=this.store.indexOf(b);
return this.all.elements[a]
}}}return b
},getNodes:function(j,a){var g=this.all.elements,b=[],c;
j=j||0;
a=!CQ.Ext.isDefined(a)?Math.max(g.length-1,0):a;
if(j<=a){for(c=j;
c<=a&&g[c];
c++){b.push(g[c])
}}else{for(c=j;
c>=a&&g[c];
c--){b.push(g[c])
}}return b
},indexOf:function(a){a=this.getNode(a);
if(CQ.Ext.isNumber(a.viewIndex)){return a.viewIndex
}return this.all.indexOf(a)
},onBeforeLoad:function(){if(this.loadingText){this.clearSelections(false,true);
this.getTemplateTarget().update('<div class="loading-indicator">'+this.loadingText+"</div>");
this.all.clear()
}},onDestroy:function(){this.all.clear();
this.selected.clear();
CQ.Ext.DataView.superclass.onDestroy.call(this);
this.bindStore(null)
}});
CQ.Ext.DataView.prototype.setStore=CQ.Ext.DataView.prototype.bindStore;
CQ.Ext.reg("dataview",CQ.Ext.DataView);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.list.ListView=CQ.Ext.extend(CQ.Ext.DataView,{itemSelector:"dl",selectedClass:"x-list-selected",overClass:"x-list-over",scrollOffset:undefined,columnResize:true,columnSort:true,maxColumnWidth:CQ.Ext.isIE?99:100,initComponent:function(){if(this.columnResize){this.colResizer=new CQ.Ext.list.ColumnResizer(this.colResizer);
this.colResizer.init(this)
}if(this.columnSort){this.colSorter=new CQ.Ext.list.Sorter(this.columnSort);
this.colSorter.init(this)
}if(!this.internalTpl){this.internalTpl=new CQ.Ext.XTemplate('<div class="x-list-header"><div class="x-list-header-inner">','<tpl for="columns">','<div style="width:{[values.width*100]}%;text-align:{align};"><em unselectable="on" id="',this.id,'-xlhd-{#}">',"{header}","</em></div>","</tpl>",'<div class="x-clear"></div>',"</div></div>",'<div class="x-list-body"><div class="x-list-body-inner">',"</div></div>")
}if(!this.tpl){this.tpl=new CQ.Ext.XTemplate('<tpl for="rows">',"<dl>",'<tpl for="parent.columns">','<dt style="width:{[values.width*100]}%;text-align:{align};">','<em unselectable="on"<tpl if="cls"> class="{cls}</tpl>">',"{[values.tpl.apply(parent)]}","</em></dt>","</tpl>",'<div class="x-clear"></div>',"</dl>","</tpl>")
}var q=this.columns,n=0,o=0,r=q.length,b=[];
for(var m=0;
m<r;
m++){var t=q[m];
if(!t.isColumn){t.xtype=t.xtype?(/^lv/.test(t.xtype)?t.xtype:"lv"+t.xtype):"lvcolumn";
t=CQ.Ext.create(t)
}if(t.width){n+=t.width*100;
if(n>this.maxColumnWidth){t.width-=(n-this.maxColumnWidth)/100
}o++
}b.push(t)
}q=this.columns=b;
if(o<r){var g=r-o;
if(n<this.maxColumnWidth){var a=((this.maxColumnWidth-n)/g)/100;
for(var k=0;
k<r;
k++){var t=q[k];
if(!t.width){t.width=a
}}}}CQ.Ext.list.ListView.superclass.initComponent.call(this)
},onRender:function(){this.autoEl={cls:"x-list-wrap"};
CQ.Ext.list.ListView.superclass.onRender.apply(this,arguments);
this.internalTpl.overwrite(this.el,{columns:this.columns});
this.innerBody=CQ.Ext.get(this.el.dom.childNodes[1].firstChild);
this.innerHd=CQ.Ext.get(this.el.dom.firstChild.firstChild);
if(this.hideHeaders){this.el.dom.firstChild.style.display="none"
}},getTemplateTarget:function(){return this.innerBody
},collectData:function(){var a=CQ.Ext.list.ListView.superclass.collectData.apply(this,arguments);
return{columns:this.columns,rows:a}
},verifyInternalSize:function(){if(this.lastSize){this.onResize(this.lastSize.width,this.lastSize.height)
}},onResize:function(c,j){var b=this.innerBody.dom,k=this.innerHd.dom,g=c-CQ.Ext.num(this.scrollOffset,CQ.Ext.getScrollBarWidth())+"px",a;
if(!b){return
}a=b.parentNode;
if(CQ.Ext.isNumber(c)){if(this.reserveScrollOffset||((a.offsetWidth-a.clientWidth)>10)){b.style.width=g;
k.style.width=g
}else{b.style.width=c+"px";
k.style.width=c+"px";
setTimeout(function(){if((a.offsetWidth-a.clientWidth)>10){b.style.width=g;
k.style.width=g
}},10)
}}if(CQ.Ext.isNumber(j)){a.style.height=Math.max(0,j-k.parentNode.offsetHeight)+"px"
}},updateIndexes:function(){CQ.Ext.list.ListView.superclass.updateIndexes.apply(this,arguments);
this.verifyInternalSize()
},findHeaderIndex:function(k){k=k.dom||k;
var a=k.parentNode,g=a.parentNode.childNodes,b=0,j;
for(;
j=g[b];
b++){if(j==a){return b
}}return -1
},setHdWidths:function(){var g=this.innerHd.dom.getElementsByTagName("div"),c=0,b=this.columns,a=b.length;
for(;
c<a;
c++){g[c].style.width=(b[c].width*100)+"%"
}}});
CQ.Ext.reg("listview",CQ.Ext.list.ListView);
CQ.Ext.ListView=CQ.Ext.list.ListView;
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.list.Column=CQ.Ext.extend(Object,{isColumn:true,align:"left",header:"",width:null,cls:"",constructor:function(a){if(!a.tpl){a.tpl=new CQ.Ext.XTemplate("{"+a.dataIndex+"}")
}else{if(CQ.Ext.isString(a.tpl)){a.tpl=new CQ.Ext.XTemplate(a.tpl)
}}CQ.Ext.apply(this,a)
}});
CQ.Ext.reg("lvcolumn",CQ.Ext.list.Column);
CQ.Ext.list.NumberColumn=CQ.Ext.extend(CQ.Ext.list.Column,{format:"0,000.00",constructor:function(a){a.tpl=a.tpl||new CQ.Ext.XTemplate("{"+a.dataIndex+':number("'+(a.format||this.format)+'")}');
CQ.Ext.list.NumberColumn.superclass.constructor.call(this,a)
}});
CQ.Ext.reg("lvnumbercolumn",CQ.Ext.list.NumberColumn);
CQ.Ext.list.DateColumn=CQ.Ext.extend(CQ.Ext.list.Column,{format:"m/d/Y",constructor:function(a){a.tpl=a.tpl||new CQ.Ext.XTemplate("{"+a.dataIndex+':date("'+(a.format||this.format)+'")}');
CQ.Ext.list.DateColumn.superclass.constructor.call(this,a)
}});
CQ.Ext.reg("lvdatecolumn",CQ.Ext.list.DateColumn);
CQ.Ext.list.BooleanColumn=CQ.Ext.extend(CQ.Ext.list.Column,{trueText:"true",falseText:"false",undefinedText:"&#160;",constructor:function(j){j.tpl=j.tpl||new CQ.Ext.XTemplate("{"+j.dataIndex+":this.format}");
var b=this.trueText,g=this.falseText,a=this.undefinedText;
j.tpl.format=function(c){if(c===undefined){return a
}if(!c||c==="false"){return g
}return b
};
CQ.Ext.list.DateColumn.superclass.constructor.call(this,j)
}});
CQ.Ext.reg("lvbooleancolumn",CQ.Ext.list.BooleanColumn);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.list.ColumnResizer=CQ.Ext.extend(CQ.Ext.util.Observable,{minPct:0.05,constructor:function(a){CQ.Ext.apply(this,a);
CQ.Ext.list.ColumnResizer.superclass.constructor.call(this)
},init:function(a){this.view=a;
a.on("render",this.initEvents,this)
},initEvents:function(a){a.mon(a.innerHd,"mousemove",this.handleHdMove,this);
this.tracker=new CQ.Ext.dd.DragTracker({onBeforeStart:this.onBeforeStart.createDelegate(this),onStart:this.onStart.createDelegate(this),onDrag:this.onDrag.createDelegate(this),onEnd:this.onEnd.createDelegate(this),tolerance:3,autoStart:300});
this.tracker.initEl(a.innerHd);
a.on("beforedestroy",this.tracker.destroy,this.tracker)
},handleHdMove:function(m,g){var c=5,b=m.getPageX(),n=m.getTarget("em",3,true);
if(n){var k=n.getRegion(),j=n.dom.style,a=n.dom.parentNode;
if(b-k.left<=c&&a!=a.parentNode.firstChild){this.activeHd=CQ.Ext.get(a.previousSibling.firstChild);
j.cursor=CQ.Ext.isWebKit?"e-resize":"col-resize"
}else{if(k.right-b<=c&&a!=a.parentNode.lastChild.previousSibling){this.activeHd=n;
j.cursor=CQ.Ext.isWebKit?"w-resize":"col-resize"
}else{delete this.activeHd;
j.cursor=""
}}}},onBeforeStart:function(a){this.dragHd=this.activeHd;
return !!this.dragHd
},onStart:function(j){var g=this,b=g.view,c=g.dragHd,a=g.tracker.getXY()[0];
g.proxy=b.el.createChild({cls:"x-list-resizer"});
g.dragX=c.getX();
g.headerIndex=b.findHeaderIndex(c);
g.headersDisabled=b.disableHeaders;
b.disableHeaders=true;
g.proxy.setHeight(b.el.getHeight());
g.proxy.setX(g.dragX);
g.proxy.setWidth(a-g.dragX);
this.setBoundaries()
},setBoundaries:function(o){var q=this.view,m=this.headerIndex,c=q.innerHd.getWidth(),o=q.innerHd.getX(),b=Math.ceil(c*this.minPct),r=c-b,j=q.columns.length,g=q.innerHd.select("em",true),k=b+o,a=r+o,n;
if(j==2){this.minX=k;
this.maxX=a
}else{n=g.item(m+2);
this.minX=g.item(m).getX()+b;
this.maxX=n?n.getX()-b:a;
if(m==0){this.minX=k
}else{if(m==j-2){this.maxX=a
}}}},onDrag:function(c){var b=this,a=b.tracker.getXY()[0].constrain(b.minX,b.maxX);
b.proxy.setWidth(a-this.dragX)
},onEnd:function(m){var j=this.proxy.getWidth(),k=this.headerIndex,q=this.view,c=q.columns,b=q.innerHd.getWidth(),o=Math.ceil(j*q.maxColumnWidth/b)/100,g=this.headersDisabled,r=c[k],n=c[k+1],a=r.width+n.width;
this.proxy.remove();
r.width=o;
n.width=a-o;
delete this.dragHd;
q.setHdWidths();
q.refresh();
setTimeout(function(){q.disableHeaders=g
},100)
}});
CQ.Ext.ListView.ColumnResizer=CQ.Ext.list.ColumnResizer;
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.list.Sorter=CQ.Ext.extend(CQ.Ext.util.Observable,{sortClasses:["sort-asc","sort-desc"],constructor:function(a){CQ.Ext.apply(this,a);
CQ.Ext.list.Sorter.superclass.constructor.call(this)
},init:function(a){this.view=a;
a.on("render",this.initEvents,this)
},initEvents:function(a){a.mon(a.innerHd,"click",this.onHdClick,this);
a.innerHd.setStyle("cursor","pointer");
a.mon(a.store,"datachanged",this.updateSortState,this);
this.updateSortState.defer(10,this,[a.store])
},updateSortState:function(c){var k=c.getSortState();
if(!k){return
}this.sortState=k;
var j=this.view.columns,m=-1;
for(var g=0,a=j.length;
g<a;
g++){if(j[g].dataIndex==k.field){m=g;
break
}}if(m!=-1){var b=k.direction;
this.updateSortIcon(m,b)
}},updateSortIcon:function(b,a){var g=this.sortClasses;
var c=this.view.innerHd.select("em").removeClass(g);
c.item(b).addClass(g[a=="DESC"?1:0])
},onHdClick:function(c){var b=c.getTarget("em",3);
if(b&&!this.view.disableHeaders){var a=this.view.findHeaderIndex(b);
this.view.store.sort(this.view.columns[a].dataIndex)
}}});
CQ.Ext.ListView.Sorter=CQ.Ext.list.Sorter;
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.Resizable=CQ.Ext.extend(CQ.Ext.util.Observable,{constructor:function(g,j){this.el=CQ.Ext.get(g);
if(j&&j.wrap){j.resizeChild=this.el;
this.el=this.el.wrap(typeof j.wrap=="object"?j.wrap:{cls:"xresizable-wrap"});
this.el.id=this.el.dom.id=j.resizeChild.id+"-rzwrap";
this.el.setStyle("overflow","hidden");
this.el.setPositioning(j.resizeChild.getPositioning());
j.resizeChild.clearPositioning();
if(!j.width||!j.height){var k=j.resizeChild.getSize();
this.el.setSize(k.width,k.height)
}if(j.pinned&&!j.adjustments){j.adjustments="auto"
}}this.proxy=this.el.createProxy({tag:"div",cls:"x-resizable-proxy",id:this.el.id+"-rzproxy"},CQ.Util.getRoot());
this.proxy.unselectable();
this.proxy.enableDisplayMode("block");
CQ.Ext.apply(this,j);
if(this.pinned){this.disableTrackOver=true;
this.el.addClass("x-resizable-pinned")
}var o=this.el.getStyle("position");
if(o!="absolute"&&o!="fixed"){this.el.setStyle("position","relative")
}if(!this.handles){this.handles="s,e,se";
if(this.multiDirectional){this.handles+=",n,w"
}}if(this.handles=="all"){this.handles="n s e w ne nw se sw"
}var u=this.handles.split(/\s*?[,;]\s*?| /);
var c=CQ.Ext.Resizable.positions;
for(var n=0,q=u.length;
n<q;
n++){if(u[n]&&c[u[n]]){var t=c[u[n]];
this[t]=new CQ.Ext.Resizable.Handle(this,t,this.disableTrackOver,this.transparent,this.handleCls)
}}this.corner=this.southeast;
if(this.handles.indexOf("n")!=-1||this.handles.indexOf("w")!=-1){this.updateBox=true
}this.activeHandle=null;
if(this.resizeChild){if(typeof this.resizeChild=="boolean"){this.resizeChild=CQ.Ext.get(this.el.dom.firstChild,true)
}else{this.resizeChild=CQ.Ext.get(this.resizeChild,true)
}}if(this.adjustments=="auto"){var b=this.resizeChild;
var r=this.west,m=this.east,a=this.north,u=this.south;
if(b&&(r||a)){b.position("relative");
b.setLeft(r?r.el.getWidth():0);
b.setTop(a?a.el.getHeight():0)
}this.adjustments=[(m?-m.el.getWidth():0)+(r?-r.el.getWidth():0),(a?-a.el.getHeight():0)+(u?-u.el.getHeight():0)-1]
}if(this.draggable){this.dd=this.dynamic?this.el.initDD(null):this.el.initDDProxy(null,{dragElId:this.proxy.id});
this.dd.setHandleElId(this.resizeChild?this.resizeChild.id:this.el.id);
if(this.constrainTo){this.dd.constrainTo(this.constrainTo)
}}this.addEvents("beforeresize","resize");
if(this.width!==null&&this.height!==null){this.resizeTo(this.width,this.height)
}else{this.updateChildSize()
}if(CQ.Ext.isIE){this.el.dom.style.zoom=1
}CQ.Ext.Resizable.superclass.constructor.call(this)
},adjustments:[0,0],animate:false,disableTrackOver:false,draggable:false,duration:0.35,dynamic:false,easing:"easeOutStrong",enabled:true,handles:false,multiDirectional:false,height:null,width:null,heightIncrement:0,widthIncrement:0,minHeight:5,minWidth:5,maxHeight:10000,maxWidth:10000,minX:0,minY:0,pinned:false,preserveRatio:false,resizeChild:false,transparent:false,resizeTo:function(b,a){this.el.setSize(b,a);
this.updateChildSize();
this.fireEvent("resize",this,b,a,null)
},startSizing:function(c,b){this.fireEvent("beforeresize",this,c);
if(this.enabled){if(!this.overlay){this.overlay=this.el.createProxy({tag:"div",cls:"x-resizable-overlay",html:"&#160;"},CQ.Util.getRoot());
this.overlay.unselectable();
this.overlay.enableDisplayMode("block");
this.overlay.on({scope:this,mousemove:this.onMouseMove,mouseup:this.onMouseUp})
}this.overlay.setStyle("cursor",b.el.getStyle("cursor"));
this.resizing=true;
this.startBox=this.el.getBox();
this.startPoint=c.getXY();
this.offsets=[(this.startBox.x+this.startBox.width)-this.startPoint[0],(this.startBox.y+this.startBox.height)-this.startPoint[1]];
this.overlay.setSize(CQ.Ext.lib.Dom.getViewWidth(true),CQ.Ext.lib.Dom.getViewHeight(true));
this.overlay.show();
if(this.constrainTo){var a=CQ.Ext.get(this.constrainTo);
this.resizeRegion=a.getRegion().adjust(a.getFrameWidth("t"),a.getFrameWidth("l"),-a.getFrameWidth("b"),-a.getFrameWidth("r"))
}this.proxy.setStyle("visibility","hidden");
this.proxy.show();
this.proxy.setBox(this.startBox);
if(!this.dynamic){this.proxy.setStyle("visibility","visible")
}}},onMouseDown:function(a,b){if(this.enabled){b.stopEvent();
this.activeHandle=a;
this.startSizing(b,a)
}},onMouseUp:function(b){this.activeHandle=null;
var a=this.resizeElement();
this.resizing=false;
this.handleOut();
this.overlay.hide();
this.proxy.hide();
this.fireEvent("resize",this,a.width,a.height,b)
},updateChildSize:function(){if(this.resizeChild){var g=this.el;
var j=this.resizeChild;
var c=this.adjustments;
if(g.dom.offsetWidth){var a=g.getSize(true);
j.setSize(a.width+c[0],a.height+c[1])
}if(CQ.Ext.isIE){setTimeout(function(){if(g.dom.offsetWidth){var k=g.getSize(true);
j.setSize(k.width+c[0],k.height+c[1])
}},10)
}}},snap:function(c,j,b){if(!j||!c){return c
}var g=c;
var a=c%j;
if(a>0){if(a>(j/2)){g=c+(j-a)
}else{g=c-a
}}return Math.max(b,g)
},resizeElement:function(){var a=this.proxy.getBox();
if(this.updateBox){this.el.setBox(a,false,this.animate,this.duration,null,this.easing)
}else{this.el.setSize(a.width,a.height,this.animate,this.duration,null,this.easing)
}this.updateChildSize();
if(!this.dynamic){this.proxy.hide()
}if(this.draggable&&this.constrainTo){this.dd.resetConstraints();
this.dd.constrainTo(this.constrainTo)
}return a
},constrain:function(b,c,a,g){if(b-c<a){c=b-a
}else{if(b-c>g){c=b-g
}}return c
},onMouseMove:function(E){if(this.enabled&&this.activeHandle){try{if(this.resizeRegion&&!this.resizeRegion.contains(E.getPoint())){return
}var B=this.curSize||this.startBox,o=this.startBox.x,n=this.startBox.y,c=o,b=n,q=B.width,C=B.height,g=q,t=C,r=this.minWidth,F=this.minHeight,A=this.maxWidth,I=this.maxHeight,k=this.widthIncrement,a=this.heightIncrement,G=E.getXY(),z=-(this.startPoint[0]-Math.max(this.minX,G[0])),u=-(this.startPoint[1]-Math.max(this.minY,G[1])),m=this.activeHandle.position,J,j;
switch(m){case"east":q+=z;
q=Math.min(Math.max(r,q),A);
break;
case"south":C+=u;
C=Math.min(Math.max(F,C),I);
break;
case"southeast":q+=z;
C+=u;
q=Math.min(Math.max(r,q),A);
C=Math.min(Math.max(F,C),I);
break;
case"north":u=this.constrain(C,u,F,I);
n+=u;
C-=u;
break;
case"west":z=this.constrain(q,z,r,A);
o+=z;
q-=z;
break;
case"northeast":q+=z;
q=Math.min(Math.max(r,q),A);
u=this.constrain(C,u,F,I);
n+=u;
C-=u;
break;
case"northwest":z=this.constrain(q,z,r,A);
u=this.constrain(C,u,F,I);
n+=u;
C-=u;
o+=z;
q-=z;
break;
case"southwest":z=this.constrain(q,z,r,A);
C+=u;
C=Math.min(Math.max(F,C),I);
o+=z;
q-=z;
break
}var v=this.snap(q,k,r);
var H=this.snap(C,a,F);
if(v!=q||H!=C){switch(m){case"northeast":n-=H-C;
break;
case"north":n-=H-C;
break;
case"southwest":o-=v-q;
break;
case"west":o-=v-q;
break;
case"northwest":o-=v-q;
n-=H-C;
break
}q=v;
C=H
}if(this.preserveRatio){switch(m){case"southeast":case"east":C=t*(q/g);
C=Math.min(Math.max(F,C),I);
q=g*(C/t);
break;
case"south":q=g*(C/t);
q=Math.min(Math.max(r,q),A);
C=t*(q/g);
break;
case"northeast":q=g*(C/t);
q=Math.min(Math.max(r,q),A);
C=t*(q/g);
break;
case"north":J=q;
q=g*(C/t);
q=Math.min(Math.max(r,q),A);
C=t*(q/g);
o+=(J-q)/2;
break;
case"southwest":C=t*(q/g);
C=Math.min(Math.max(F,C),I);
J=q;
q=g*(C/t);
o+=J-q;
break;
case"west":j=C;
C=t*(q/g);
C=Math.min(Math.max(F,C),I);
n+=(j-C)/2;
J=q;
q=g*(C/t);
o+=J-q;
break;
case"northwest":J=q;
j=C;
C=t*(q/g);
C=Math.min(Math.max(F,C),I);
q=g*(C/t);
n+=j-C;
o+=J-q;
break
}}this.proxy.setBounds(o,n,q,C);
if(this.dynamic){this.resizeElement()
}}catch(D){}}},handleOver:function(){if(this.enabled){this.el.addClass("x-resizable-over")
}},handleOut:function(){if(!this.resizing){this.el.removeClass("x-resizable-over")
}},getEl:function(){return this.el
},getResizeChild:function(){return this.resizeChild
},destroy:function(b){CQ.Ext.destroy(this.dd,this.overlay,this.proxy);
this.overlay=null;
this.proxy=null;
var c=CQ.Ext.Resizable.positions;
for(var a in c){if(typeof c[a]!="function"&&this[c[a]]){this[c[a]].destroy()
}}if(b){this.el.update("");
CQ.Ext.destroy(this.el);
this.el=null
}this.purgeListeners()
},syncHandleHeight:function(){var a=this.el.getHeight(true);
if(this.west){this.west.el.setHeight(a)
}if(this.east){this.east.el.setHeight(a)
}}});
CQ.Ext.Resizable.positions={n:"north",s:"south",e:"east",w:"west",se:"southeast",sw:"southwest",nw:"northwest",ne:"northeast"};
CQ.Ext.Resizable.Handle=CQ.Ext.extend(Object,{constructor:function(g,k,c,j,a){if(!this.tpl){var b=CQ.Ext.DomHelper.createTemplate({tag:"div",cls:"x-resizable-handle x-resizable-handle-{0}"});
b.compile();
CQ.Ext.Resizable.Handle.prototype.tpl=b
}this.position=k;
this.rz=g;
this.el=this.tpl.append(g.el.dom,[this.position],true);
this.el.unselectable();
if(j){this.el.setOpacity(0)
}if(!CQ.Ext.isEmpty(a)){this.el.addClass(a)
}this.el.on("mousedown",this.onMouseDown,this);
if(!c){this.el.on({scope:this,mouseover:this.onMouseOver,mouseout:this.onMouseOut})
}},afterResize:function(a){},onMouseDown:function(a){this.rz.onMouseDown(this,a)
},onMouseOver:function(a){this.rz.handleOver(this,a)
},onMouseOut:function(a){this.rz.handleOut(this,a)
},destroy:function(){CQ.Ext.destroy(this.el);
this.el=null
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.TabPanel=CQ.Ext.extend(CQ.Ext.Panel,{deferredRender:true,tabWidth:120,minTabWidth:30,resizeTabs:false,enableTabScroll:false,scrollIncrement:0,scrollRepeatInterval:400,scrollDuration:0.35,animScroll:true,tabPosition:"top",baseCls:"x-tab-panel",autoTabs:false,autoTabSelector:"div.x-tab",activeTab:undefined,tabMargin:2,plain:false,wheelIncrement:20,idDelimiter:"__",itemCls:"x-tab-item",elements:"body",headerAsText:false,frame:false,hideBorders:true,initComponent:function(){this.frame=false;
CQ.Ext.TabPanel.superclass.initComponent.call(this);
this.addEvents("beforetabchange","tabchange","contextmenu");
this.setLayout(new CQ.Ext.layout.CardLayout(CQ.Ext.apply({layoutOnCardChange:this.layoutOnTabChange,deferredRender:this.deferredRender},this.layoutConfig)));
if(this.tabPosition=="top"){this.elements+=",header";
this.stripTarget="header"
}else{this.elements+=",footer";
this.stripTarget="footer"
}if(!this.stack){this.stack=CQ.Ext.TabPanel.AccessStack()
}this.initItems()
},onRender:function(c,a){CQ.Ext.TabPanel.superclass.onRender.call(this,c,a);
if(this.plain){var k=this.tabPosition=="top"?"header":"footer";
this[k].addClass("x-tab-panel-"+k+"-plain")
}var b=this[this.stripTarget];
this.stripWrap=b.createChild({cls:"x-tab-strip-wrap",cn:{tag:"ul",cls:"x-tab-strip x-tab-strip-"+this.tabPosition}});
var j=(this.tabPosition=="bottom"?this.stripWrap:null);
b.createChild({cls:"x-tab-strip-spacer"},j);
this.strip=new CQ.Ext.Element(this.stripWrap.dom.firstChild);
this.edge=this.strip.createChild({tag:"li",cls:"x-tab-edge",cn:[{tag:"span",cls:"x-tab-strip-text",cn:"&#160;"}]});
this.strip.createChild({cls:"x-clear"});
this.body.addClass("x-tab-panel-body-"+this.tabPosition);
if(!this.itemTpl){var g=new CQ.Ext.Template('<li class="{cls}" id="{id}"><a class="x-tab-strip-close"></a>','<a class="x-tab-right" href="#"><em class="x-tab-left">','<span class="x-tab-strip-inner"><span class="x-tab-strip-text {iconCls}">{text}</span></span>',"</em></a></li>");
g.disableFormats=true;
g.compile();
CQ.Ext.TabPanel.prototype.itemTpl=g
}this.items.each(this.initTab,this)
},afterRender:function(){CQ.Ext.TabPanel.superclass.afterRender.call(this);
if(this.autoTabs){this.readTabs(false)
}if(this.activeTab!==undefined){var a=CQ.Ext.isObject(this.activeTab)?this.activeTab:this.items.get(this.activeTab);
delete this.activeTab;
this.setActiveTab(a)
}},initEvents:function(){CQ.Ext.TabPanel.superclass.initEvents.call(this);
this.mon(this.strip,{scope:this,mousedown:this.onStripMouseDown,contextmenu:this.onStripContextMenu});
if(this.enableTabScroll){this.mon(this.strip,"mousewheel",this.onWheel,this)
}},findTargets:function(c){var b=null,a=c.getTarget("li:not(.x-tab-edge)",this.strip);
if(a){b=this.getComponent(a.id.substring(a.id.indexOf(this.idDelimiter)+this.idDelimiter.length));
if(b.disabled){return{close:null,item:null,el:null}
}}return{close:c.getTarget(".x-tab-strip-close",this.strip),item:b,el:a}
},onStripMouseDown:function(b){if(b.button!==0){return
}b.preventDefault();
var a=this.findTargets(b);
if(a.close){if(a.item.fireEvent("beforeclose",a.item)!==false){a.item.fireEvent("close",a.item);
this.remove(a.item)
}return
}if(a.item&&a.item!=this.activeTab){this.setActiveTab(a.item)
}},onStripContextMenu:function(b){b.preventDefault();
var a=this.findTargets(b);
if(a.item){this.fireEvent("contextmenu",this,a.item,b)
}},readTabs:function(g){if(g===true){this.items.each(function(m){this.remove(m)
},this)
}var c=this.el.query(this.autoTabSelector);
for(var b=0,a=c.length;
b<a;
b++){var j=c[b],k=j.getAttribute("title");
j.removeAttribute("title");
this.add({title:k,contentEl:j})
}},initTab:function(g,b){var j=this.strip.dom.childNodes[b],k=this.getTemplateArgs(g),c=j?this.itemTpl.insertBefore(j,k):this.itemTpl.append(this.strip,k),a="x-tab-strip-over",m=CQ.Ext.get(c);
m.hover(function(){if(!g.disabled){m.addClass(a)
}},function(){m.removeClass(a)
});
if(g.tabTip){m.child("span.x-tab-strip-text",true).qtip=g.tabTip
}g.tabEl=c;
m.select("a").on("click",function(n){if(!n.getPageX()){this.onStripMouseDown(n)
}},this,{preventDefault:true});
g.on({scope:this,disable:this.onItemDisabled,enable:this.onItemEnabled,titlechange:this.onItemTitleChanged,iconchange:this.onItemIconChanged,beforeshow:this.onBeforeShowItem})
},getTemplateArgs:function(b){var a=b.closable?"x-tab-strip-closable":"";
if(b.disabled){a+=" x-item-disabled"
}if(b.iconCls){a+=" x-tab-with-icon"
}if(b.tabCls){a+=" "+b.tabCls
}return{id:this.id+this.idDelimiter+b.getItemId(),text:b.title,cls:a,iconCls:b.iconCls||""}
},onAdd:function(b){CQ.Ext.TabPanel.superclass.onAdd.call(this,b);
if(this.rendered){var a=this.items;
this.initTab(b,a.indexOf(b));
this.delegateUpdates()
}},onBeforeAdd:function(b){var a=b.events?(this.items.containsKey(b.getItemId())?b:null):this.items.get(b);
if(a){this.setActiveTab(b);
return false
}CQ.Ext.TabPanel.superclass.onBeforeAdd.apply(this,arguments);
var c=b.elements;
b.elements=c?c.replace(",header",""):c;
b.border=(b.border===true)
},onRemove:function(g){var b=CQ.Ext.get(g.tabEl);
if(b){b.select("a").removeAllListeners();
CQ.Ext.destroy(b)
}CQ.Ext.TabPanel.superclass.onRemove.call(this,g);
this.stack.remove(g);
delete g.tabEl;
g.un("disable",this.onItemDisabled,this);
g.un("enable",this.onItemEnabled,this);
g.un("titlechange",this.onItemTitleChanged,this);
g.un("iconchange",this.onItemIconChanged,this);
g.un("beforeshow",this.onBeforeShowItem,this);
if(g==this.activeTab){var a=this.stack.next();
if(a){this.setActiveTab(a)
}else{if(this.items.getCount()>0){this.setActiveTab(0)
}else{this.setActiveTab(null)
}}}if(!this.destroying){this.delegateUpdates()
}},onBeforeShowItem:function(a){if(a!=this.activeTab){this.setActiveTab(a);
return false
}},onItemDisabled:function(b){var a=this.getTabEl(b);
if(a){CQ.Ext.fly(a).addClass("x-item-disabled")
}this.stack.remove(b)
},onItemEnabled:function(b){var a=this.getTabEl(b);
if(a){CQ.Ext.fly(a).removeClass("x-item-disabled")
}},onItemTitleChanged:function(b){var a=this.getTabEl(b);
if(a){CQ.Ext.fly(a).child("span.x-tab-strip-text",true).innerHTML=b.title
}},onItemIconChanged:function(g,a,c){var b=this.getTabEl(g);
if(b){b=CQ.Ext.get(b);
b.child("span.x-tab-strip-text").replaceClass(c,a);
b[CQ.Ext.isEmpty(a)?"removeClass":"addClass"]("x-tab-with-icon")
}},getTabEl:function(a){var b=this.getComponent(a);
return b?b.tabEl:null
},onResize:function(){CQ.Ext.TabPanel.superclass.onResize.apply(this,arguments);
this.delegateUpdates()
},beginUpdate:function(){this.suspendUpdates=true
},endUpdate:function(){this.suspendUpdates=false;
this.delegateUpdates()
},hideTabStripItem:function(b){b=this.getComponent(b);
var a=this.getTabEl(b);
if(a){a.style.display="none";
this.delegateUpdates()
}this.stack.remove(b)
},unhideTabStripItem:function(b){b=this.getComponent(b);
var a=this.getTabEl(b);
if(a){a.style.display="";
this.delegateUpdates()
}},delegateUpdates:function(){var a=this.rendered;
if(this.suspendUpdates){return
}if(this.resizeTabs&&a){this.autoSizeTabs()
}if(this.enableTabScroll&&a){this.autoScrollTabs()
}},autoSizeTabs:function(){var m=this.items.length,b=this.tabPosition!="bottom"?"header":"footer",c=this[b].dom.offsetWidth,a=this[b].dom.clientWidth;
if(!this.resizeTabs||m<1||!a){return
}var o=Math.max(Math.min(Math.floor((a-4)/m)-this.tabMargin,this.tabWidth),this.minTabWidth);
this.lastTabWidth=o;
var r=this.strip.query("li:not(.x-tab-edge)");
for(var j=0,n=r.length;
j<n;
j++){var q=r[j],t=CQ.Ext.fly(q).child(".x-tab-strip-inner",true),k=q.offsetWidth,g=t.offsetWidth;
t.style.width=(o-(k-g))+"px"
}},adjustBodyWidth:function(a){if(this.header){this.header.setWidth(a)
}if(this.footer){this.footer.setWidth(a)
}return a
},setActiveTab:function(c){c=this.getComponent(c);
if(this.fireEvent("beforetabchange",this,c,this.activeTab)===false){return
}if(!this.rendered){this.activeTab=c;
return
}if(this.activeTab!=c){if(this.activeTab){var a=this.getTabEl(this.activeTab);
if(a){CQ.Ext.fly(a).removeClass("x-tab-strip-active")
}}this.activeTab=c;
if(c){var b=this.getTabEl(c);
CQ.Ext.fly(b).addClass("x-tab-strip-active");
this.stack.add(c);
this.layout.setActiveItem(c);
this.delegateUpdates();
if(this.scrolling){this.scrollToTab(c,this.animScroll)
}}this.fireEvent("tabchange",this,c)
}},getActiveTab:function(){return this.activeTab||null
},getItem:function(a){return this.getComponent(a)
},autoScrollTabs:function(){this.pos=this.tabPosition=="bottom"?this.footer:this.header;
var m=this.items.length,g=this.pos.dom.offsetWidth,c=this.pos.dom.clientWidth,k=this.stripWrap,j=k.dom,b=j.offsetWidth,n=this.getScrollPos(),a=this.edge.getOffsetsTo(this.stripWrap)[0]+n;
if(!this.enableTabScroll||b<20){return
}if(m==0||a<=c){j.scrollLeft=0;
k.setWidth(c);
if(this.scrolling){this.scrolling=false;
this.pos.removeClass("x-tab-scrolling");
this.scrollLeft.hide();
this.scrollRight.hide();
if(CQ.Ext.isAir||CQ.Ext.isWebKit){j.style.marginLeft="";
j.style.marginRight=""
}}}else{if(!this.scrolling){this.pos.addClass("x-tab-scrolling");
if(CQ.Ext.isAir||CQ.Ext.isWebKit){j.style.marginLeft="18px";
j.style.marginRight="18px"
}}c-=k.getMargins("lr");
k.setWidth(c>20?c:20);
if(!this.scrolling){if(!this.scrollLeft){this.createScrollers()
}else{this.scrollLeft.show();
this.scrollRight.show()
}}this.scrolling=true;
if(n>(a-c)){j.scrollLeft=a-c
}else{this.scrollToTab(this.activeTab,false)
}this.updateScrollButtons()
}},createScrollers:function(){this.pos.addClass("x-tab-scrolling-"+this.tabPosition);
var c=this.stripWrap.dom.offsetHeight;
var a=this.pos.insertFirst({cls:"x-tab-scroller-left"});
a.setHeight(c);
a.addClassOnOver("x-tab-scroller-left-over");
this.leftRepeater=new CQ.Ext.util.ClickRepeater(a,{interval:this.scrollRepeatInterval,handler:this.onScrollLeft,scope:this});
this.scrollLeft=a;
var b=this.pos.insertFirst({cls:"x-tab-scroller-right"});
b.setHeight(c);
b.addClassOnOver("x-tab-scroller-right-over");
this.rightRepeater=new CQ.Ext.util.ClickRepeater(b,{interval:this.scrollRepeatInterval,handler:this.onScrollRight,scope:this});
this.scrollRight=b
},getScrollWidth:function(){return this.edge.getOffsetsTo(this.stripWrap)[0]+this.getScrollPos()
},getScrollPos:function(){return parseInt(this.stripWrap.dom.scrollLeft,10)||0
},getScrollArea:function(){return parseInt(this.stripWrap.dom.clientWidth,10)||0
},getScrollAnim:function(){return{duration:this.scrollDuration,callback:this.updateScrollButtons,scope:this}
},getScrollIncrement:function(){return this.scrollIncrement||(this.resizeTabs?this.lastTabWidth+2:100)
},scrollToTab:function(j,a){if(!j){return
}var c=this.getTabEl(j),m=this.getScrollPos(),g=this.getScrollArea(),k=CQ.Ext.fly(c).getOffsetsTo(this.stripWrap)[0]+m,b=k+c.offsetWidth;
if(k<m){this.scrollTo(k,a)
}else{if(b>(m+g)){this.scrollTo(b-g,a)
}}},scrollTo:function(b,a){this.stripWrap.scrollTo("left",b,a?this.getScrollAnim():false);
if(!a){this.updateScrollButtons()
}},onWheel:function(g){var j=g.getWheelDelta()*this.wheelIncrement*-1;
g.stopEvent();
var k=this.getScrollPos(),c=k+j,a=this.getScrollWidth()-this.getScrollArea();
var b=Math.max(0,Math.min(a,c));
if(b!=k){this.scrollTo(b,false)
}},onScrollRight:function(){var a=this.getScrollWidth()-this.getScrollArea(),c=this.getScrollPos(),b=Math.min(a,c+this.getScrollIncrement());
if(b!=c){this.scrollTo(b,this.animScroll)
}},onScrollLeft:function(){var b=this.getScrollPos(),a=Math.max(0,b-this.getScrollIncrement());
if(a!=b){this.scrollTo(a,this.animScroll)
}},updateScrollButtons:function(){var a=this.getScrollPos();
this.scrollLeft[a===0?"addClass":"removeClass"]("x-tab-scroller-left-disabled");
this.scrollRight[a>=(this.getScrollWidth()-this.getScrollArea())?"addClass":"removeClass"]("x-tab-scroller-right-disabled")
},beforeDestroy:function(){CQ.Ext.destroy(this.leftRepeater,this.rightRepeater);
this.deleteMembers("strip","edge","scrollLeft","scrollRight","stripWrap");
this.activeTab=null;
CQ.Ext.TabPanel.superclass.beforeDestroy.apply(this)
}});
CQ.Ext.reg("tabpanel",CQ.Ext.TabPanel);
CQ.Ext.TabPanel.prototype.activate=CQ.Ext.TabPanel.prototype.setActiveTab;
CQ.Ext.TabPanel.AccessStack=function(){var a=[];
return{add:function(b){a.push(b);
if(a.length>10){a.shift()
}},remove:function(j){var g=[];
for(var c=0,b=a.length;
c<b;
c++){if(a[c]!=j){g.push(a[c])
}}a=g
},next:function(){return a.pop()
}}
};
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.Button=CQ.Ext.extend(CQ.Ext.BoxComponent,{hidden:false,disabled:false,pressed:false,enableToggle:false,menuAlign:"tl-bl?",type:"button",menuClassTarget:"tr:nth(2)",clickEvent:"click",handleMouseEvents:true,tooltipType:"qtip",buttonSelector:"button:first-child",scale:"small",iconAlign:"left",arrowAlign:"right",initComponent:function(){if(this.menu){if(CQ.Ext.isArray(this.menu)){this.menu={items:this.menu}
}if(CQ.Ext.isObject(this.menu)){this.menu.ownerCt=this
}this.menu=CQ.Ext.menu.MenuMgr.get(this.menu);
this.menu.ownerCt=undefined
}CQ.Ext.Button.superclass.initComponent.call(this);
this.addEvents("click","toggle","mouseover","mouseout","menushow","menuhide","menutriggerover","menutriggerout");
if(CQ.Ext.isString(this.toggleGroup)){this.enableToggle=true
}},getTemplateArgs:function(){return[this.type,"x-btn-"+this.scale+" x-btn-icon-"+this.scale+"-"+this.iconAlign,this.getMenuClass(),this.cls,this.id]
},setButtonClass:function(){if(this.useSetClass){if(!CQ.Ext.isEmpty(this.oldCls)){this.el.removeClass([this.oldCls,"x-btn-pressed"])
}this.oldCls=(this.iconCls||this.icon)?(this.text?"x-btn-text-icon":"x-btn-icon"):"x-btn-noicon";
this.el.addClass([this.oldCls,this.pressed?"x-btn-pressed":null])
}},getMenuClass:function(){return this.menu?(this.arrowAlign!="bottom"?"x-btn-arrow":"x-btn-arrow-bottom"):""
},onRender:function(c,a){if(!this.template){if(!CQ.Ext.Button.buttonTemplate){CQ.Ext.Button.buttonTemplate=new CQ.Ext.Template('<table id="{4}" cellspacing="0" class="x-btn {3}"><tbody class="{1}">','<tr><td class="x-btn-tl"><i>&#160;</i></td><td class="x-btn-tc"></td><td class="x-btn-tr"><i>&#160;</i></td></tr>','<tr><td class="x-btn-ml"><i>&#160;</i></td><td class="x-btn-mc"><em class="{2}" unselectable="on"><button type="{0}"></button></em></td><td class="x-btn-mr"><i>&#160;</i></td></tr>','<tr><td class="x-btn-bl"><i>&#160;</i></td><td class="x-btn-bc"></td><td class="x-btn-br"><i>&#160;</i></td></tr>',"</tbody></table>");
CQ.Ext.Button.buttonTemplate.compile()
}this.template=CQ.Ext.Button.buttonTemplate
}var b,g=this.getTemplateArgs();
if(a){b=this.template.insertBefore(a,g,true)
}else{b=this.template.append(c,g,true)
}this.btnEl=b.child(this.buttonSelector);
this.mon(this.btnEl,{scope:this,focus:this.onFocus,blur:this.onBlur});
this.initButtonEl(b,this.btnEl);
CQ.Ext.ButtonToggleMgr.register(this)
},initButtonEl:function(b,c){this.el=b;
this.setIcon(this.icon);
this.setText(this.text);
this.setIconClass(this.iconCls);
if(CQ.Ext.isDefined(this.tabIndex)){c.dom.tabIndex=this.tabIndex
}if(this.tooltip){this.setTooltip(this.tooltip,true)
}if(this.handleMouseEvents){this.mon(b,{scope:this,mouseover:this.onMouseOver,mousedown:this.onMouseDown})
}if(this.menu){this.mon(this.menu,{scope:this,show:this.onMenuShow,hide:this.onMenuHide})
}if(this.repeat){var a=new CQ.Ext.util.ClickRepeater(b,CQ.Ext.isObject(this.repeat)?this.repeat:{});
this.mon(a,"click",this.onRepeatClick,this)
}else{this.mon(b,this.clickEvent,this.onClick,this)
}},afterRender:function(){CQ.Ext.Button.superclass.afterRender.call(this);
this.useSetClass=true;
this.setButtonClass();
this.doc=CQ.Ext.getDoc();
this.doAutoWidth()
},setIconClass:function(a){this.iconCls=a;
if(this.el){this.btnEl.dom.className="";
this.btnEl.addClass(["x-btn-text",a||""]);
this.setButtonClass()
}return this
},setTooltip:function(b,a){if(this.rendered){if(!a){this.clearTip()
}if(CQ.Ext.isObject(b)){CQ.Ext.QuickTips.register(CQ.Ext.apply({target:this.btnEl.id},b));
this.tooltip=b
}else{this.btnEl.dom[this.tooltipType]=b
}}else{this.tooltip=b
}return this
},clearTip:function(){if(CQ.Ext.isObject(this.tooltip)){CQ.Ext.QuickTips.unregister(this.btnEl)
}},beforeDestroy:function(){if(this.rendered){this.clearTip()
}if(this.menu&&this.destroyMenu!==false){CQ.Ext.destroy(this.btnEl,this.menu)
}CQ.Ext.destroy(this.repeater)
},onDestroy:function(){if(this.rendered){this.doc.un("mouseover",this.monitorMouseOver,this);
this.doc.un("mouseup",this.onMouseUp,this);
delete this.doc;
delete this.btnEl;
CQ.Ext.ButtonToggleMgr.unregister(this)
}CQ.Ext.Button.superclass.onDestroy.call(this)
},doAutoWidth:function(){if(this.autoWidth!==false&&this.el&&this.text&&this.width===undefined){this.el.setWidth("auto");
if(CQ.Ext.isIE7&&CQ.Ext.isStrict){var a=this.btnEl;
if(a&&a.getWidth()>20){a.clip();
a.setWidth(CQ.Ext.util.TextMetrics.measure(a,this.text).width+a.getFrameWidth("lr"))
}}if(this.minWidth){if(this.el.getWidth()<this.minWidth){this.el.setWidth(this.minWidth)
}}}},setHandler:function(b,a){this.handler=b;
this.scope=a;
return this
},setText:function(a){this.text=a;
if(this.el){this.btnEl.update(a||"&#160;");
this.setButtonClass()
}this.doAutoWidth();
return this
},setIcon:function(a){this.icon=a;
if(this.el){this.btnEl.setStyle("background-image",a?"url("+a+")":"");
this.setButtonClass()
}return this
},getText:function(){return this.text
},toggle:function(b,a){b=b===undefined?!this.pressed:!!b;
if(b!=this.pressed){if(this.rendered){this.el[b?"addClass":"removeClass"]("x-btn-pressed")
}this.pressed=b;
if(!a){this.fireEvent("toggle",this,b);
if(this.toggleHandler){this.toggleHandler.call(this.scope||this,this,b)
}}}return this
},onDisable:function(){this.onDisableChange(true)
},onEnable:function(){this.onDisableChange(false)
},onDisableChange:function(a){if(this.el){if(!CQ.Ext.isIE6||!this.text){this.el[a?"addClass":"removeClass"](this.disabledClass)
}this.el.dom.disabled=a
}this.disabled=a
},showMenu:function(){if(this.rendered&&this.menu){if(this.tooltip){CQ.Ext.QuickTips.getQuickTip().cancelShow(this.btnEl)
}if(this.menu.isVisible()){this.menu.hide()
}this.menu.ownerCt=this;
this.menu.show(this.el,this.menuAlign)
}return this
},hideMenu:function(){if(this.hasVisibleMenu()){this.menu.hide()
}return this
},hasVisibleMenu:function(){return this.menu&&this.menu.ownerCt==this&&this.menu.isVisible()
},onRepeatClick:function(a,b){this.onClick(b)
},onClick:function(a){if(a){a.preventDefault()
}if(a.button!==0){return
}if(!this.disabled){this.doToggle();
if(this.menu&&!this.hasVisibleMenu()&&!this.ignoreNextClick){this.showMenu()
}this.fireEvent("click",this,a);
if(this.handler){this.handler.call(this.scope||this,this,a)
}}},doToggle:function(){if(this.enableToggle&&(this.allowDepress!==false||!this.pressed)){this.toggle()
}},isMenuTriggerOver:function(b,a){return this.menu&&!a
},isMenuTriggerOut:function(b,a){return this.menu&&!a
},onMouseOver:function(b){if(!this.disabled){var a=b.within(this.el,true);
if(!a){this.el.addClass("x-btn-over");
if(!this.monitoringMouseOver){this.doc.on("mouseover",this.monitorMouseOver,this);
this.monitoringMouseOver=true
}this.fireEvent("mouseover",this,b)
}if(this.isMenuTriggerOver(b,a)){this.fireEvent("menutriggerover",this,this.menu,b)
}}},monitorMouseOver:function(a){if(a.target!=this.el.dom&&!a.within(this.el)){if(this.monitoringMouseOver){this.doc.un("mouseover",this.monitorMouseOver,this);
this.monitoringMouseOver=false
}this.onMouseOut(a)
}},onMouseOut:function(b){var a=b.within(this.el)&&b.target!=this.el.dom;
this.el.removeClass("x-btn-over");
this.fireEvent("mouseout",this,b);
if(this.isMenuTriggerOut(b,a)){this.fireEvent("menutriggerout",this,this.menu,b)
}},focus:function(){this.btnEl.focus()
},blur:function(){this.btnEl.blur()
},onFocus:function(a){if(!this.disabled){this.el.addClass("x-btn-focus")
}},onBlur:function(a){this.el.removeClass("x-btn-focus")
},getClickEl:function(b,a){return this.el
},onMouseDown:function(a){if(!this.disabled&&a.button===0){this.getClickEl(a).addClass("x-btn-click");
this.doc.on("mouseup",this.onMouseUp,this)
}},onMouseUp:function(a){if(a.button===0){this.getClickEl(a,true).removeClass("x-btn-click");
this.doc.un("mouseup",this.onMouseUp,this)
}},onMenuShow:function(a){if(this.menu.ownerCt==this){this.menu.ownerCt=this;
this.ignoreNextClick=0;
this.el.addClass("x-btn-menu-active");
this.fireEvent("menushow",this,this.menu)
}},onMenuHide:function(a){if(this.menu.ownerCt==this){this.el.removeClass("x-btn-menu-active");
this.ignoreNextClick=this.restoreClick.defer(250,this);
this.fireEvent("menuhide",this,this.menu);
delete this.menu.ownerCt
}},restoreClick:function(){this.ignoreNextClick=0
}});
CQ.Ext.reg("button",CQ.Ext.Button);
CQ.Ext.ButtonToggleMgr=function(){var a={};
function b(k,n){if(n){var m=a[k.toggleGroup];
for(var j=0,c=m.length;
j<c;
j++){if(m[j]!=k){m[j].toggle(false)
}}}}return{register:function(c){if(!c.toggleGroup){return
}var j=a[c.toggleGroup];
if(!j){j=a[c.toggleGroup]=[]
}j.push(c);
c.on("toggle",b)
},unregister:function(c){if(!c.toggleGroup){return
}var j=a[c.toggleGroup];
if(j){j.remove(c);
c.un("toggle",b)
}},getPressed:function(m){var k=a[m];
if(k){for(var j=0,c=k.length;
j<c;
j++){if(k[j].pressed===true){return k[j]
}}}return null
}}
}();
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.SplitButton=CQ.Ext.extend(CQ.Ext.Button,{arrowSelector:"em",split:true,initComponent:function(){CQ.Ext.SplitButton.superclass.initComponent.call(this);
this.addEvents("arrowclick")
},onRender:function(){CQ.Ext.SplitButton.superclass.onRender.apply(this,arguments);
if(this.arrowTooltip){this.el.child(this.arrowSelector).dom[this.tooltipType]=this.arrowTooltip
}},setArrowHandler:function(b,a){this.arrowHandler=b;
this.scope=a
},getMenuClass:function(){return"x-btn-split"+(this.arrowAlign=="bottom"?"-bottom":"")
},isClickOnArrow:function(c){if(this.arrowAlign!="bottom"){var b=this.el.child("em.x-btn-split");
var a=b.getRegion().right-b.getPadding("r");
return c.getPageX()>a
}else{return c.getPageY()>this.btnEl.getRegion().bottom
}},onClick:function(b,a){b.preventDefault();
if(!this.disabled){if(this.isClickOnArrow(b)){if(this.menu&&!this.menu.isVisible()&&!this.ignoreNextClick){this.showMenu()
}this.fireEvent("arrowclick",this,b);
if(this.arrowHandler){this.arrowHandler.call(this.scope||this,this,b)
}}else{this.doToggle();
this.fireEvent("click",this,b);
if(this.handler){this.handler.call(this.scope||this,this,b)
}}}},isMenuTriggerOver:function(a){return this.menu&&a.target.tagName==this.arrowSelector
},isMenuTriggerOut:function(b,a){return this.menu&&b.target.tagName!=this.arrowSelector
}});
CQ.Ext.reg("splitbutton",CQ.Ext.SplitButton);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.CycleButton=CQ.Ext.extend(CQ.Ext.SplitButton,{getItemText:function(a){if(a&&this.showText===true){var b="";
if(this.prependText){b+=this.prependText
}b+=a.text;
return b
}return undefined
},setActiveItem:function(c,a){if(!CQ.Ext.isObject(c)){c=this.menu.getComponent(c)
}if(c){if(!this.rendered){this.text=this.getItemText(c);
this.iconCls=c.iconCls
}else{var b=this.getItemText(c);
if(b){this.setText(b)
}this.setIconClass(c.iconCls)
}this.activeItem=c;
if(!c.checked){c.setChecked(true,a)
}if(this.forceIcon){this.setIconClass(this.forceIcon)
}if(!a){this.fireEvent("change",this,c)
}}},getActiveItem:function(){return this.activeItem
},initComponent:function(){this.addEvents("change");
if(this.changeHandler){this.on("change",this.changeHandler,this.scope||this);
delete this.changeHandler
}this.itemCount=this.items.length;
this.menu={cls:"x-cycle-menu",items:[]};
var a=0;
CQ.Ext.each(this.items,function(c,b){CQ.Ext.apply(c,{group:c.group||this.id,itemIndex:b,checkHandler:this.checkHandler,scope:this,checked:c.checked||false});
this.menu.items.push(c);
if(c.checked){a=b
}},this);
CQ.Ext.CycleButton.superclass.initComponent.call(this);
this.on("click",this.toggleSelected,this);
this.setActiveItem(a,true)
},checkHandler:function(a,b){if(b){this.setActiveItem(a)
}},toggleSelected:function(){var a=this.menu;
a.render();
if(!a.hasLayout){a.doLayout()
}var g,b;
for(var c=1;
c<this.itemCount;
c++){g=(this.activeItem.itemIndex+c)%this.itemCount;
b=a.items.itemAt(g);
if(!b.disabled){b.setChecked(true);
break
}}}});
CQ.Ext.reg("cycle",CQ.Ext.CycleButton);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.Toolbar=function(a){if(CQ.Ext.isArray(a)){a={items:a,layout:"toolbar"}
}else{a=CQ.Ext.apply({layout:"toolbar"},a);
if(a.buttons){a.items=a.buttons
}}CQ.Ext.Toolbar.superclass.constructor.call(this,a)
};
(function(){var a=CQ.Ext.Toolbar;
CQ.Ext.extend(a,CQ.Ext.Container,{defaultType:"button",enableOverflow:false,trackMenus:true,internalDefaults:{removeMode:"container",hideParent:true},toolbarCls:"x-toolbar",initComponent:function(){a.superclass.initComponent.call(this);
this.addEvents("overflowchange")
},onRender:function(c,b){if(!this.el){if(!this.autoCreate){this.autoCreate={cls:this.toolbarCls+" x-small-editor"}
}this.el=c.createChild(CQ.Ext.apply({id:this.id},this.autoCreate),b);
CQ.Ext.Toolbar.superclass.onRender.apply(this,arguments)
}},lookupComponent:function(b){if(CQ.Ext.isString(b)){if(b=="-"){b=new a.Separator()
}else{if(b==" "){b=new a.Spacer()
}else{if(b=="->"){b=new a.Fill()
}else{b=new a.TextItem(b)
}}}this.applyDefaults(b)
}else{if(b.isFormField||b.render){b=this.createComponent(b)
}else{if(b.tag){b=new a.Item({autoEl:b})
}else{if(b.tagName){b=new a.Item({el:b})
}else{if(CQ.Ext.isObject(b)){b=b.xtype?this.createComponent(b):this.constructButton(b)
}}}}}return b
},applyDefaults:function(g){if(!CQ.Ext.isString(g)){g=CQ.Ext.Toolbar.superclass.applyDefaults.call(this,g);
var b=this.internalDefaults;
if(g.events){CQ.Ext.applyIf(g.initialConfig,b);
CQ.Ext.apply(g,b)
}else{CQ.Ext.applyIf(g,b)
}}return g
},addSeparator:function(){return this.add(new a.Separator())
},addSpacer:function(){return this.add(new a.Spacer())
},addFill:function(){this.add(new a.Fill())
},addElement:function(b){return this.addItem(new a.Item({el:b}))
},addItem:function(b){return this.add.apply(this,arguments)
},addButton:function(c){if(CQ.Ext.isArray(c)){var j=[];
for(var g=0,b=c.length;
g<b;
g++){j.push(this.addButton(c[g]))
}return j
}return this.add(this.constructButton(c))
},addText:function(b){return this.addItem(new a.TextItem(b))
},addDom:function(b){return this.add(new a.Item({autoEl:b}))
},addField:function(b){return this.add(b)
},insertButton:function(c,k){if(CQ.Ext.isArray(k)){var j=[];
for(var g=0,b=k.length;
g<b;
g++){j.push(this.insertButton(c+g,k[g]))
}return j
}return CQ.Ext.Toolbar.superclass.insert.call(this,c,k)
},trackMenu:function(c,b){if(this.trackMenus&&c.menu){var g=b?"mun":"mon";
this[g](c,"menutriggerover",this.onButtonTriggerOver,this);
this[g](c,"menushow",this.onButtonMenuShow,this);
this[g](c,"menuhide",this.onButtonMenuHide,this)
}},constructButton:function(g){var c=g.events?g:this.createComponent(g,g.split?"splitbutton":this.defaultType);
return c
},onAdd:function(b){CQ.Ext.Toolbar.superclass.onAdd.call(this);
this.trackMenu(b);
if(this.disabled){b.disable()
}},onRemove:function(b){CQ.Ext.Toolbar.superclass.onRemove.call(this);
if(b==this.activeMenuBtn){delete this.activeMenuBtn
}this.trackMenu(b,true)
},onDisable:function(){this.items.each(function(b){if(b.disable){b.disable()
}})
},onEnable:function(){this.items.each(function(b){if(b.enable){b.enable()
}})
},onButtonTriggerOver:function(b){if(this.activeMenuBtn&&this.activeMenuBtn!=b){this.activeMenuBtn.hideMenu();
b.showMenu();
this.activeMenuBtn=b
}},onButtonMenuShow:function(b){this.activeMenuBtn=b
},onButtonMenuHide:function(b){delete this.activeMenuBtn
}});
CQ.Ext.reg("toolbar",CQ.Ext.Toolbar);
a.Item=CQ.Ext.extend(CQ.Ext.BoxComponent,{hideParent:true,enable:CQ.Ext.emptyFn,disable:CQ.Ext.emptyFn,focus:CQ.Ext.emptyFn});
CQ.Ext.reg("tbitem",a.Item);
a.Separator=CQ.Ext.extend(a.Item,{onRender:function(c,b){this.el=c.createChild({tag:"span",cls:"xtb-sep"},b)
}});
CQ.Ext.reg("tbseparator",a.Separator);
a.Spacer=CQ.Ext.extend(a.Item,{onRender:function(c,b){this.el=c.createChild({tag:"div",cls:"xtb-spacer",style:this.width?"width:"+this.width+"px":""},b)
}});
CQ.Ext.reg("tbspacer",a.Spacer);
a.Fill=CQ.Ext.extend(a.Item,{render:CQ.Ext.emptyFn,isFill:true});
CQ.Ext.reg("tbfill",a.Fill);
a.TextItem=CQ.Ext.extend(a.Item,{constructor:function(b){a.TextItem.superclass.constructor.call(this,CQ.Ext.isString(b)?{text:b}:b)
},onRender:function(c,b){this.autoEl={cls:"xtb-text",html:this.text||""};
a.TextItem.superclass.onRender.call(this,c,b)
},setText:function(b){if(this.rendered){this.el.update(b)
}else{this.text=b
}}});
CQ.Ext.reg("tbtext",a.TextItem);
a.Button=CQ.Ext.extend(CQ.Ext.Button,{});
a.SplitButton=CQ.Ext.extend(CQ.Ext.SplitButton,{});
CQ.Ext.reg("tbbutton",a.Button);
CQ.Ext.reg("tbsplit",a.SplitButton)
})();
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.ButtonGroup=CQ.Ext.extend(CQ.Ext.Panel,{baseCls:"x-btn-group",layout:"table",defaultType:"button",frame:true,internalDefaults:{removeMode:"container",hideParent:true},initComponent:function(){this.layoutConfig=this.layoutConfig||{};
CQ.Ext.applyIf(this.layoutConfig,{columns:this.columns});
if(!this.title){this.addClass("x-btn-group-notitle")
}this.on("afterlayout",this.onAfterLayout,this);
CQ.Ext.ButtonGroup.superclass.initComponent.call(this)
},applyDefaults:function(b){b=CQ.Ext.ButtonGroup.superclass.applyDefaults.call(this,b);
var a=this.internalDefaults;
if(b.events){CQ.Ext.applyIf(b.initialConfig,a);
CQ.Ext.apply(b,a)
}else{CQ.Ext.applyIf(b,a)
}return b
},onAfterLayout:function(){var a=this.body.getFrameWidth("lr")+this.body.dom.firstChild.offsetWidth;
this.body.setWidth(a);
this.el.setWidth(a+this.getFrameWidth())
}});
CQ.Ext.reg("buttongroup",CQ.Ext.ButtonGroup);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
(function(){var a=CQ.Ext.Toolbar;
CQ.Ext.PagingToolbar=CQ.Ext.extend(CQ.Ext.Toolbar,{pageSize:20,displayMsg:"Displaying {0} - {1} of {2}",emptyMsg:"No data to display",beforePageText:"Page",afterPageText:"of {0}",firstText:"First Page",prevText:"Previous Page",nextText:"Next Page",lastText:"Last Page",refreshText:"Refresh",initComponent:function(){var c=[this.first=new a.Button({tooltip:this.firstText,overflowText:this.firstText,iconCls:"x-tbar-page-first",disabled:true,handler:this.moveFirst,scope:this}),this.prev=new a.Button({tooltip:this.prevText,overflowText:this.prevText,iconCls:"x-tbar-page-prev",disabled:true,handler:this.movePrevious,scope:this}),"-",this.beforePageText,this.inputItem=new CQ.Ext.form.NumberField({cls:"x-tbar-page-number",allowDecimals:false,allowNegative:false,enableKeyEvents:true,selectOnFocus:true,submitValue:false,listeners:{scope:this,keydown:this.onPagingKeyDown,blur:this.onPagingBlur}}),this.afterTextItem=new a.TextItem({text:String.format(this.afterPageText,1)}),"-",this.next=new a.Button({tooltip:this.nextText,overflowText:this.nextText,iconCls:"x-tbar-page-next",disabled:true,handler:this.moveNext,scope:this}),this.last=new a.Button({tooltip:this.lastText,overflowText:this.lastText,iconCls:"x-tbar-page-last",disabled:true,handler:this.moveLast,scope:this}),"-",this.refresh=new a.Button({tooltip:this.refreshText,overflowText:this.refreshText,iconCls:"x-tbar-loading",handler:this.doRefresh,scope:this})];
var b=this.items||this.buttons||[];
if(this.prependButtons){this.items=b.concat(c)
}else{this.items=c.concat(b)
}delete this.buttons;
if(this.displayInfo){this.items.push("->");
this.items.push(this.displayItem=new a.TextItem({}))
}CQ.Ext.PagingToolbar.superclass.initComponent.call(this);
this.addEvents("change","beforechange");
this.on("afterlayout",this.onFirstLayout,this,{single:true});
this.cursor=0;
this.bindStore(this.store,true)
},onFirstLayout:function(){if(this.dsLoaded){this.onLoad.apply(this,this.dsLoaded)
}},updateInfo:function(){if(this.displayItem){var b=this.store.getCount();
var c=b==0?this.emptyMsg:String.format(this.displayMsg,this.cursor+1,this.cursor+b,this.store.getTotalCount());
this.displayItem.setText(c)
}},onLoad:function(b,g,n){if(!this.rendered){this.dsLoaded=[b,g,n];
return
}var j=this.getParams();
this.cursor=(n.params&&n.params[j.start])?n.params[j.start]:0;
var m=this.getPageData(),c=m.activePage,k=m.pages;
this.afterTextItem.setText(String.format(this.afterPageText,m.pages));
this.inputItem.setValue(c);
this.first.setDisabled(c==1);
this.prev.setDisabled(c==1);
this.next.setDisabled(c==k);
this.last.setDisabled(c==k);
this.refresh.enable();
this.updateInfo();
this.fireEvent("change",this,m)
},getPageData:function(){var b=this.store.getTotalCount();
return{total:b,activePage:Math.ceil((this.cursor+this.pageSize)/this.pageSize),pages:b<this.pageSize?1:Math.ceil(b/this.pageSize)}
},changePage:function(b){this.doLoad(((b-1)*this.pageSize).constrain(0,this.store.getTotalCount()))
},onLoadError:function(){if(!this.rendered){return
}this.refresh.enable()
},readPage:function(g){var b=this.inputItem.getValue(),c;
if(!b||isNaN(c=parseInt(b,10))){this.inputItem.setValue(g.activePage);
return false
}return c
},onPagingFocus:function(){this.inputItem.select()
},onPagingBlur:function(b){this.inputItem.setValue(this.getPageData().activePage)
},onPagingKeyDown:function(m,j){var c=j.getKey(),n=this.getPageData(),g;
if(c==j.RETURN){j.stopEvent();
g=this.readPage(n);
if(g!==false){g=Math.min(Math.max(1,g),n.pages)-1;
this.doLoad(g*this.pageSize)
}}else{if(c==j.HOME||c==j.END){j.stopEvent();
g=c==j.HOME?1:n.pages;
m.setValue(g)
}else{if(c==j.UP||c==j.PAGEUP||c==j.DOWN||c==j.PAGEDOWN){j.stopEvent();
if((g=this.readPage(n))){var b=j.shiftKey?10:1;
if(c==j.DOWN||c==j.PAGEDOWN){b*=-1
}g+=b;
if(g>=1&g<=n.pages){m.setValue(g)
}}}}}},getParams:function(){return this.paramNames||this.store.paramNames
},beforeLoad:function(){if(this.rendered&&this.refresh){this.refresh.disable()
}},doLoad:function(g){var c={},b=this.getParams();
c[b.start]=g;
c[b.limit]=this.pageSize;
if(this.fireEvent("beforechange",this,c)!==false){this.store.load({params:c})
}},moveFirst:function(){this.doLoad(0)
},movePrevious:function(){this.doLoad(Math.max(0,this.cursor-this.pageSize))
},moveNext:function(){this.doLoad(this.cursor+this.pageSize)
},moveLast:function(){var c=this.store.getTotalCount(),b=c%this.pageSize;
this.doLoad(b?(c-b):c-this.pageSize)
},doRefresh:function(){this.doLoad(this.cursor)
},bindStore:function(c,g){var b;
if(!g&&this.store){if(c!==this.store&&this.store.autoDestroy){this.store.destroy()
}else{this.store.un("beforeload",this.beforeLoad,this);
this.store.un("load",this.onLoad,this);
this.store.un("exception",this.onLoadError,this)
}if(!c){this.store=null
}}if(c){c=CQ.Ext.StoreMgr.lookup(c);
c.on({scope:this,beforeload:this.beforeLoad,load:this.onLoad,exception:this.onLoadError});
b=true
}this.store=c;
if(b){this.onLoad(c,null,{})
}},unbind:function(b){this.bindStore(null)
},bind:function(b){this.bindStore(b)
},onDestroy:function(){this.bindStore(null);
CQ.Ext.PagingToolbar.superclass.onDestroy.call(this)
}})
})();
CQ.Ext.reg("paging",CQ.Ext.PagingToolbar);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.History=(function(){var j,c;
var q=false;
var g;
function k(){var r=location.href,t=r.indexOf("#"),u=t>=0?r.substr(t+1):null;
if(CQ.Ext.isGecko){u=decodeURIComponent(u)
}return u
}function a(){c.value=g
}function m(r){g=r;
CQ.Ext.History.fireEvent("change",decodeURI(r))
}function n(t){var r=['<html><body><div id="state">',CQ.Ext.util.Format.htmlEncode(t),"</div></body></html>"].join("");
try{var v=j.contentWindow.document;
v.open();
v.write(r);
v.close();
return true
}catch(u){return false
}}function b(){if(!j.contentWindow||!j.contentWindow.document){setTimeout(b,10);
return
}var v=j.contentWindow.document;
var t=v.getElementById("state");
var r=t?t.innerText:null;
var u=k();
setInterval(function(){v=j.contentWindow.document;
t=v.getElementById("state");
var x=t?t.innerText:null;
var w=k();
if(x!==r){r=x;
m(r);
location.hash=r;
u=r;
a()
}else{if(w!==u){u=w;
n(w)
}}},50);
q=true;
CQ.Ext.History.fireEvent("ready",CQ.Ext.History)
}function o(){g=c.value?c.value:k();
if(CQ.Ext.isIE){b()
}else{var r=k();
setInterval(function(){var t=k();
if(t!==r){r=t;
m(r);
a()
}},50);
q=true;
CQ.Ext.History.fireEvent("ready",CQ.Ext.History)
}}return{fieldId:"x-history-field",iframeId:"x-history-frame",events:{},init:function(t,r){if(q){CQ.Ext.callback(t,r,[this]);
return
}if(!CQ.Ext.isReady){CQ.Ext.onReady(function(){CQ.Ext.History.init(t,r)
});
return
}c=CQ.Ext.getDom(CQ.Ext.History.fieldId);
if(CQ.Ext.isIE){j=CQ.Ext.getDom(CQ.Ext.History.iframeId)
}this.addEvents("ready","change");
if(t){this.on("ready",t,r,{single:true})
}o()
},add:function(t,v,u){if(top.CQ_PORTAL_API){return false
}if(v!==false){if(this.getToken()==t){return true
}}if(CQ.Ext.isIE){return n(t)
}else{var r=CQ.WCM.getTopWindow();
if(u){CQ.shared.Util.reload(r,"#"+encodeURI(t),u);
r.location.replace("#"+encodeURI(t))
}else{r.location.hash=encodeURI(t)
}return true
}},back:function(){history.go(-1)
},forward:function(){history.go(1)
},getToken:function(){return q?g:k()
}}
})();
CQ.Ext.apply(CQ.Ext.History,new CQ.Ext.util.Observable());
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.Tip=CQ.Ext.extend(CQ.Ext.Panel,{minWidth:40,maxWidth:300,shadow:"sides",defaultAlign:"tl-bl?",autoRender:true,quickShowInterval:250,frame:true,hidden:true,baseCls:"x-tip",floating:{shadow:true,shim:true,useDisplay:true,constrain:false},autoHeight:true,closeAction:"hide",initComponent:function(){CQ.Ext.Tip.superclass.initComponent.call(this);
if(this.closable&&!this.title){this.elements+=",header"
}},afterRender:function(){CQ.Ext.Tip.superclass.afterRender.call(this);
if(this.closable){this.addTool({id:"close",handler:this[this.closeAction],scope:this})
}},showAt:function(a){CQ.Ext.Tip.superclass.show.call(this);
if(this.measureWidth!==false&&(!this.initialConfig||typeof this.initialConfig.width!="number")){this.doAutoWidth()
}if(this.constrainPosition){a=this.el.adjustForConstraints(a)
}this.setPagePosition(a[0],a[1])
},doAutoWidth:function(a){a=a||0;
var b=this.body.getTextWidth();
if(this.title){b=Math.max(b,this.header.child("span").getTextWidth(this.title))
}b+=this.getFrameWidth()+(this.closable?20:0)+this.body.getPadding("lr")+a;
this.setWidth(b.constrain(this.minWidth,this.maxWidth));
if(CQ.Ext.isIE7&&!this.repainted){this.el.repaint();
this.repainted=true
}},showBy:function(a,b){if(!this.rendered){this.render(CQ.Util.getRoot())
}this.showAt(this.el.getAlignToXY(a,b||this.defaultAlign))
},initDraggable:function(){this.dd=new CQ.Ext.Tip.DD(this,typeof this.draggable=="boolean"?null:this.draggable);
this.header.addClass("x-tip-draggable")
}});
CQ.Ext.reg("tip",CQ.Ext.Tip);
CQ.Ext.Tip.DD=function(b,a){CQ.Ext.apply(this,a);
this.tip=b;
CQ.Ext.Tip.DD.superclass.constructor.call(this,b.el.id,"WindowDD-"+b.id);
this.setHandleElId(b.header.id);
this.scroll=false
};
CQ.Ext.extend(CQ.Ext.Tip.DD,CQ.Ext.dd.DD,{moveOnly:true,scroll:false,headerOffsets:[100,25],startDrag:function(){this.tip.el.disableShadow()
},endDrag:function(a){this.tip.el.enableShadow(true)
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.ToolTip=CQ.Ext.extend(CQ.Ext.Tip,{showDelay:500,hideDelay:200,dismissDelay:5000,trackMouse:false,anchorToTarget:true,anchorOffset:0,targetCounter:0,constrainPosition:false,initComponent:function(){CQ.Ext.ToolTip.superclass.initComponent.call(this);
this.lastActive=new Date();
this.initTarget(this.target);
this.origAnchor=this.anchor
},onRender:function(b,a){CQ.Ext.ToolTip.superclass.onRender.call(this,b,a);
this.anchorCls="x-tip-anchor-"+this.getAnchorPosition();
this.anchorEl=this.el.createChild({cls:"x-tip-anchor "+this.anchorCls})
},afterRender:function(){CQ.Ext.ToolTip.superclass.afterRender.call(this);
this.anchorEl.setStyle("z-index",this.el.getZIndex()+1).setVisibilityMode(CQ.Ext.Element.DISPLAY)
},initTarget:function(c){var a;
if((a=CQ.Ext.get(c))){if(this.target){var b=CQ.Ext.get(this.target);
this.mun(b,"mouseover",this.onTargetOver,this);
this.mun(b,"mouseout",this.onTargetOut,this);
this.mun(b,"mousemove",this.onMouseMove,this)
}this.mon(a,{mouseover:this.onTargetOver,mouseout:this.onTargetOut,mousemove:this.onMouseMove,scope:this});
this.target=a
}if(this.anchor){this.anchorTarget=this.target
}},onMouseMove:function(b){var a=this.delegate?b.getTarget(this.delegate):this.triggerElement=true;
if(a){this.targetXY=b.getXY();
if(a===this.triggerElement){if(!this.hidden&&this.trackMouse){this.setPagePosition(this.getTargetXY())
}}else{this.hide();
this.lastActive=new Date(0);
this.onTargetOver(b)
}}else{if(!this.closable&&this.isVisible()){this.hide()
}}},getTargetXY:function(){if(this.delegate){this.anchorTarget=this.triggerElement
}if(this.anchor){this.targetCounter++;
var c=this.getOffsets(),r=(this.anchorToTarget&&!this.trackMouse)?this.el.getAlignToXY(this.anchorTarget,this.getAnchorAlign()):this.targetXY,a=CQ.Ext.lib.Dom.getViewWidth()-5,m=CQ.Ext.lib.Dom.getViewHeight()-5,n=document.documentElement,j=document.body,q=(n.scrollLeft||j.scrollLeft||0)+5,o=(n.scrollTop||j.scrollTop||0)+5,b=[r[0]+c[0],r[1]+c[1]],k=this.getSize();
this.anchorEl.removeClass(this.anchorCls);
if(this.targetCounter<2){if(b[0]<q){if(this.anchorToTarget){this.defaultAlign="l-r";
if(this.mouseOffset){this.mouseOffset[0]*=-1
}}this.anchor="left";
return this.getTargetXY()
}if(b[0]+k.width>a){if(this.anchorToTarget){this.defaultAlign="r-l";
if(this.mouseOffset){this.mouseOffset[0]*=-1
}}this.anchor="right";
return this.getTargetXY()
}if(b[1]<o){if(this.anchorToTarget){this.defaultAlign="t-b";
if(this.mouseOffset){this.mouseOffset[1]*=-1
}}this.anchor="top";
return this.getTargetXY()
}if(b[1]+k.height>m){if(this.anchorToTarget){this.defaultAlign="b-t";
if(this.mouseOffset){this.mouseOffset[1]*=-1
}}this.anchor="bottom";
return this.getTargetXY()
}}this.anchorCls="x-tip-anchor-"+this.getAnchorPosition();
this.anchorEl.addClass(this.anchorCls);
this.targetCounter=0;
return b
}else{var g=this.getMouseOffset();
return[this.targetXY[0]+g[0],this.targetXY[1]+g[1]]
}},getMouseOffset:function(){var a=this.anchor?[0,0]:[15,18];
if(this.mouseOffset){a[0]+=this.mouseOffset[0];
a[1]+=this.mouseOffset[1]
}return a
},getAnchorPosition:function(){if(this.anchor){this.tipAnchor=this.anchor.charAt(0)
}else{var a=this.defaultAlign.match(/^([a-z]+)-([a-z]+)(\?)?$/);
if(!a){throw"AnchorTip.defaultAlign is invalid"
}this.tipAnchor=a[1].charAt(0)
}switch(this.tipAnchor){case"t":return"top";
case"b":return"bottom";
case"r":return"right"
}return"left"
},getAnchorAlign:function(){switch(this.anchor){case"top":return"tl-bl";
case"left":return"tl-tr";
case"right":return"tr-tl";
default:return"bl-tl"
}},getOffsets:function(){var b,a=this.getAnchorPosition().charAt(0);
if(this.anchorToTarget&&!this.trackMouse){switch(a){case"t":b=[0,9];
break;
case"b":b=[0,-13];
break;
case"r":b=[-13,0];
break;
default:b=[9,0];
break
}}else{switch(a){case"t":b=[-15-this.anchorOffset,30];
break;
case"b":b=[-19-this.anchorOffset,-13-this.el.dom.offsetHeight];
break;
case"r":b=[-15-this.el.dom.offsetWidth,-13-this.anchorOffset];
break;
default:b=[25,-13-this.anchorOffset];
break
}}var c=this.getMouseOffset();
b[0]+=c[0];
b[1]+=c[1];
return b
},onTargetOver:function(b){if(this.disabled||b.within(this.target.dom,true)){return
}var a=b.getTarget(this.delegate);
if(a){this.triggerElement=a;
this.clearTimer("hide");
this.targetXY=b.getXY();
this.delayShow()
}},delayShow:function(){if(this.hidden&&!this.showTimer){if(this.lastActive.getElapsed()<this.quickShowInterval){this.show()
}else{this.showTimer=this.show.defer(this.showDelay,this)
}}else{if(!this.hidden&&this.autoHide!==false){this.show()
}}},onTargetOut:function(a){if(this.disabled||a.within(this.target.dom,true)){return
}this.clearTimer("show");
if(this.autoHide!==false){this.delayHide()
}},delayHide:function(){if(!this.hidden&&!this.hideTimer){this.hideTimer=this.hide.defer(this.hideDelay,this)
}},hide:function(){this.clearTimer("dismiss");
this.lastActive=new Date();
if(this.anchorEl){this.anchorEl.hide()
}CQ.Ext.ToolTip.superclass.hide.call(this);
delete this.triggerElement
},show:function(){if(this.anchor){this.showAt([-1000,-1000]);
this.origConstrainPosition=this.constrainPosition;
this.constrainPosition=false;
this.anchor=this.origAnchor
}this.showAt(this.getTargetXY());
if(this.anchor){this.anchorEl.show();
this.syncAnchor();
this.constrainPosition=this.origConstrainPosition
}else{this.anchorEl.hide()
}},showAt:function(a){this.lastActive=new Date();
this.clearTimers();
CQ.Ext.ToolTip.superclass.showAt.call(this,a);
if(this.dismissDelay&&this.autoHide!==false){this.dismissTimer=this.hide.defer(this.dismissDelay,this)
}if(this.anchor&&!this.anchorEl.isVisible()){this.syncAnchor();
this.anchorEl.show()
}else{this.anchorEl.hide()
}},syncAnchor:function(){var a,b,c;
switch(this.tipAnchor.charAt(0)){case"t":a="b";
b="tl";
c=[20+this.anchorOffset,2];
break;
case"r":a="l";
b="tr";
c=[-2,11+this.anchorOffset];
break;
case"b":a="t";
b="bl";
c=[20+this.anchorOffset,-2];
break;
default:a="r";
b="tl";
c=[2,11+this.anchorOffset];
break
}this.anchorEl.alignTo(this.el,a+"-"+b,c)
},setPagePosition:function(a,b){CQ.Ext.ToolTip.superclass.setPagePosition.call(this,a,b);
if(this.anchor){this.syncAnchor()
}},clearTimer:function(a){a=a+"Timer";
clearTimeout(this[a]);
delete this[a]
},clearTimers:function(){this.clearTimer("show");
this.clearTimer("dismiss");
this.clearTimer("hide")
},onShow:function(){CQ.Ext.ToolTip.superclass.onShow.call(this);
CQ.Ext.getDoc().on("mousedown",this.onDocMouseDown,this)
},onHide:function(){CQ.Ext.ToolTip.superclass.onHide.call(this);
CQ.Ext.getDoc().un("mousedown",this.onDocMouseDown,this)
},onDocMouseDown:function(a){if(this.autoHide!==true&&!this.closable&&!a.within(this.el.dom)){this.disable();
this.doEnable.defer(100,this)
}},doEnable:function(){if(!this.isDestroyed){this.enable()
}},onDisable:function(){this.clearTimers();
this.hide()
},adjustPosition:function(a,g){if(this.constrainPosition){var c=this.targetXY[1],b=this.getSize().height;
if(g<=c&&(g+b)>=c){g=c-b-5
}}return{x:a,y:g}
},beforeDestroy:function(){this.clearTimers();
CQ.Ext.destroy(this.anchorEl);
delete this.anchorEl;
delete this.target;
delete this.anchorTarget;
delete this.triggerElement;
CQ.Ext.ToolTip.superclass.beforeDestroy.call(this)
},onDestroy:function(){CQ.Ext.getDoc().un("mousedown",this.onDocMouseDown,this);
CQ.Ext.ToolTip.superclass.onDestroy.call(this)
}});
CQ.Ext.reg("tooltip",CQ.Ext.ToolTip);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.QuickTip=CQ.Ext.extend(CQ.Ext.ToolTip,{interceptTitles:false,tagConfig:{namespace:"ext",attribute:"qtip",width:"qwidth",target:"target",title:"qtitle",hide:"hide",cls:"qclass",align:"qalign",anchor:"anchor"},initComponent:function(){this.target=this.target||CQ.Ext.getDoc();
this.targets=this.targets||{};
CQ.Ext.QuickTip.superclass.initComponent.call(this)
},register:function(k){var n=CQ.Ext.isArray(k)?k:arguments;
for(var m=0,a=n.length;
m<a;
m++){var q=n[m];
var o=q.target;
if(o){if(CQ.Ext.isArray(o)){for(var g=0,b=o.length;
g<b;
g++){this.targets[CQ.Ext.id(o[g])]=q
}}else{this.targets[CQ.Ext.id(o)]=q
}}}},unregister:function(a){delete this.targets[CQ.Ext.id(a)]
},cancelShow:function(b){var a=this.activeTarget;
b=CQ.Ext.get(b).dom;
if(this.isVisible()){if(a&&a.el==b){this.hide()
}}else{if(a&&a.el==b){this.clearTimer("show")
}}},getTipCfg:function(g){var b=g.getTarget(),c,a;
if(this.interceptTitles&&b.title&&CQ.Ext.isString(b.title)){c=b.title;
b.qtip=c;
b.removeAttribute("title");
g.preventDefault()
}else{a=this.tagConfig;
c=b.qtip||CQ.Ext.fly(b).getAttribute(a.attribute,a.namespace)
}return c
},onTargetOver:function(m){if(this.disabled){return
}this.targetXY=m.getXY();
var c=m.getTarget();
if(!c||c.nodeType!==1||c==document||c==document.body){return
}if(this.activeTarget&&((c==this.activeTarget.el)||CQ.Ext.fly(this.activeTarget.el).contains(c))){this.clearTimer("hide");
this.show();
return
}if(c&&this.targets[c.id]){this.activeTarget=this.targets[c.id];
this.activeTarget.el=c;
this.anchor=this.activeTarget.anchor;
if(this.anchor){this.anchorTarget=c
}this.delayShow();
return
}var j,k=CQ.Ext.fly(c),b=this.tagConfig,g=b.namespace;
if(j=this.getTipCfg(m)){var a=k.getAttribute(b.hide,g);
this.activeTarget={el:c,text:j,width:k.getAttribute(b.width,g),autoHide:a!="user"&&a!=="false",title:k.getAttribute(b.title,g),cls:k.getAttribute(b.cls,g),align:k.getAttribute(b.align,g)};
this.anchor=k.getAttribute(b.anchor,g);
if(this.anchor){this.anchorTarget=c
}this.delayShow()
}},onTargetOut:function(a){if(this.activeTarget&&a.within(this.activeTarget.el)&&!this.getTipCfg(a)){return
}this.clearTimer("show");
if(this.autoHide!==false){this.delayHide()
}},showAt:function(b){var a=this.activeTarget;
if(a){if(!this.rendered){this.render(CQ.Util.getRoot());
this.activeTarget=a
}if(a.width){this.setWidth(a.width);
this.body.setWidth(this.adjustBodyWidth(a.width-this.getFrameWidth()));
this.measureWidth=false
}else{this.measureWidth=true
}this.setTitle(a.title||"");
this.body.update(a.text);
this.autoHide=a.autoHide;
this.dismissDelay=a.dismissDelay||this.dismissDelay;
if(this.lastCls){this.el.removeClass(this.lastCls);
delete this.lastCls
}if(a.cls){this.el.addClass(a.cls);
this.lastCls=a.cls
}if(this.anchor){this.constrainPosition=false
}else{if(a.align){b=this.el.getAlignToXY(a.el,a.align);
this.constrainPosition=false
}else{this.constrainPosition=true
}}}CQ.Ext.QuickTip.superclass.showAt.call(this,b)
},hide:function(){delete this.activeTarget;
CQ.Ext.QuickTip.superclass.hide.call(this)
}});
CQ.Ext.reg("quicktip",CQ.Ext.QuickTip);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.QuickTips=function(){var b,a=false;
return{init:function(c){if(!b){if(!CQ.Ext.isReady){CQ.Ext.onReady(function(){CQ.Ext.QuickTips.init(c)
});
return
}b=new CQ.Ext.QuickTip({elements:"header,body",disabled:a});
if(c!==false){b.render(CQ.Util.getRoot())
}}},ddDisable:function(){if(b&&!a){b.disable()
}},ddEnable:function(){if(b&&!a){b.enable()
}},enable:function(){if(b){b.enable()
}a=false
},disable:function(){if(b){b.disable()
}a=true
},isEnabled:function(){return b!==undefined&&!b.disabled
},getQuickTip:function(){return b
},register:function(){b.register.apply(b,arguments)
},unregister:function(){b.unregister.apply(b,arguments)
},tips:function(){b.register.apply(b,arguments)
}}
}();
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.slider.Tip=CQ.Ext.extend(CQ.Ext.Tip,{minWidth:10,offsets:[0,-10],init:function(a){a.on({scope:this,dragstart:this.onSlide,drag:this.onSlide,dragend:this.hide,destroy:this.destroy})
},onSlide:function(b,c,a){this.show();
this.body.update(this.getText(a));
this.doAutoWidth();
this.el.alignTo(a.el,"b-t?",this.offsets)
},getText:function(a){return String(a.value)
}});
CQ.Ext.ux.SliderTip=CQ.Ext.slider.Tip;
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.tree.TreePanel=CQ.Ext.extend(CQ.Ext.Panel,{rootVisible:true,animate:CQ.Ext.enableFx,lines:true,enableDD:false,hlDrop:CQ.Ext.enableFx,pathSeparator:"/",bubbleEvents:[],initComponent:function(){CQ.Ext.tree.TreePanel.superclass.initComponent.call(this);
if(!this.eventModel){this.eventModel=new CQ.Ext.tree.TreeEventModel(this)
}var a=this.loader;
if(!a){a=new CQ.Ext.tree.TreeLoader({dataUrl:this.dataUrl,requestMethod:this.requestMethod})
}else{if(CQ.Ext.isObject(a)&&!a.load){a=new CQ.Ext.tree.TreeLoader(a)
}}this.loader=a;
this.nodeHash={};
if(this.root){var b=this.root;
delete this.root;
this.setRootNode(b)
}this.addEvents("append","remove","movenode","insert","beforeappend","beforeremove","beforemovenode","beforeinsert","beforeload","load","textchange","beforeexpandnode","beforecollapsenode","expandnode","disabledchange","collapsenode","beforeclick","click","containerclick","checkchange","beforedblclick","dblclick","containerdblclick","contextmenu","containercontextmenu","beforechildrenrendered","startdrag","enddrag","dragdrop","beforenodedrop","nodedrop","nodedragover");
if(this.singleExpand){this.on("beforeexpandnode",this.restrictExpand,this)
}},proxyNodeEvent:function(c,b,a,m,k,j,g){if(c=="collapse"||c=="expand"||c=="beforecollapse"||c=="beforeexpand"||c=="move"||c=="beforemove"){c=c+"node"
}return this.fireEvent(c,b,a,m,k,j,g)
},getRootNode:function(){return this.root
},setRootNode:function(b){this.destroyRoot();
if(!b.render){b=this.loader.createNode(b)
}this.root=b;
b.ownerTree=this;
b.isRoot=true;
this.registerNode(b);
if(!this.rootVisible){var a=b.attributes.uiProvider;
b.ui=a?new a(b):new CQ.Ext.tree.RootTreeNodeUI(b)
}if(this.innerCt){this.clearInnerCt();
this.renderRoot()
}return b
},clearInnerCt:function(){this.innerCt.update("")
},renderRoot:function(){this.root.render();
if(!this.rootVisible){this.root.renderChildren()
}},getNodeById:function(a){return this.nodeHash[a]
},registerNode:function(a){this.nodeHash[a.id]=a
},unregisterNode:function(a){delete this.nodeHash[a.id]
},toString:function(){return"[Tree"+(this.id?" "+this.id:"")+"]"
},restrictExpand:function(a){var b=a.parentNode;
if(b){if(b.expandedChild&&b.expandedChild.parentNode==b){b.expandedChild.collapse()
}b.expandedChild=a
}},getChecked:function(b,c){c=c||this.root;
var g=[];
var j=function(){if(this.attributes.checked){g.push(!b?this:(b=="id"?this.id:this.attributes[b]))
}};
c.cascade(j);
return g
},getLoader:function(){return this.loader
},expandAll:function(){this.root.expand(true)
},collapseAll:function(){this.root.collapse(true)
},getSelectionModel:function(){if(!this.selModel){this.selModel=new CQ.Ext.tree.DefaultSelectionModel()
}return this.selModel
},expandPath:function(k,a,m){if(CQ.Ext.isEmpty(k)){if(m){m(false,undefined)
}return
}a=a||"id";
var g=k.split(this.pathSeparator);
var c=this.root;
if(c.attributes[a]!=g[1]){if(m){m(false,null)
}return
}var b=1;
var j=function(){if(++b==g.length){if(m){m(true,c)
}return
}var n=c.findChild(a,g[b]);
if(!n){if(m){m(false,c)
}return
}c=n;
n.expand(false,false,j)
};
c.expand(false,false,j)
},selectPath:function(j,a,k){if(CQ.Ext.isEmpty(j)){if(k){k(false,undefined)
}return
}a=a||"id";
var c=j.split(this.pathSeparator),b=c.pop();
if(c.length>1){var g=function(o,m){if(o&&m){var q=m.findChild(a,b);
if(q){q.select();
if(k){k(true,q)
}}else{if(k){k(false,q)
}}}else{if(k){k(false,q)
}}};
this.expandPath(c.join(this.pathSeparator),a,g)
}else{this.root.select();
if(k){k(true,this.root)
}}},getTreeEl:function(){return this.body
},onRender:function(b,a){CQ.Ext.tree.TreePanel.superclass.onRender.call(this,b,a);
this.el.addClass("x-tree");
this.innerCt=this.body.createChild({tag:"ul",cls:"x-tree-root-ct "+(this.useArrows?"x-tree-arrows":this.lines?"x-tree-lines":"x-tree-no-lines")})
},initEvents:function(){CQ.Ext.tree.TreePanel.superclass.initEvents.call(this);
if(this.containerScroll){CQ.Ext.dd.ScrollManager.register(this.body)
}if((this.enableDD||this.enableDrop)&&!this.dropZone){this.dropZone=new CQ.Ext.tree.TreeDropZone(this,this.dropConfig||{ddGroup:this.ddGroup||"TreeDD",appendOnly:this.ddAppendOnly===true})
}if((this.enableDD||this.enableDrag)&&!this.dragZone){this.dragZone=new CQ.Ext.tree.TreeDragZone(this,this.dragConfig||{ddGroup:this.ddGroup||"TreeDD",scroll:this.ddScroll})
}this.getSelectionModel().init(this)
},afterRender:function(){CQ.Ext.tree.TreePanel.superclass.afterRender.call(this);
this.renderRoot()
},beforeDestroy:function(){if(this.rendered){CQ.Ext.dd.ScrollManager.unregister(this.body);
CQ.Ext.destroy(this.dropZone,this.dragZone)
}this.destroyRoot();
CQ.Ext.destroy(this.loader);
this.nodeHash=this.root=this.loader=null;
CQ.Ext.tree.TreePanel.superclass.beforeDestroy.call(this)
},destroyRoot:function(){if(this.root&&this.root.destroy){this.root.destroy(true)
}}});
CQ.Ext.tree.TreePanel.nodeTypes={};
CQ.Ext.reg("treepanel",CQ.Ext.tree.TreePanel);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.tree.TreeEventModel=function(a){this.tree=a;
this.tree.on("render",this.initEvents,this)
};
CQ.Ext.tree.TreeEventModel.prototype={initEvents:function(){var a=this.tree;
if(a.trackMouseOver!==false){a.mon(a.innerCt,{scope:this,mouseover:this.delegateOver,mouseout:this.delegateOut})
}a.mon(a.getTreeEl(),{scope:this,click:this.delegateClick,dblclick:this.delegateDblClick,contextmenu:this.delegateContextMenu})
},getNode:function(b){var a;
if(a=b.getTarget(".x-tree-node-el",10)){var c=CQ.Ext.fly(a,"_treeEvents").getAttribute("tree-node-id","ext");
if(c){return this.tree.getNodeById(c)
}}return null
},getNodeTarget:function(b){var a=b.getTarget(".x-tree-node-icon",1);
if(!a){a=b.getTarget(".x-tree-node-el",6)
}return a
},delegateOut:function(b,a){if(!this.beforeEvent(b)){return
}if(b.getTarget(".x-tree-ec-icon",1)){var c=this.getNode(b);
this.onIconOut(b,c);
if(c==this.lastEcOver){delete this.lastEcOver
}}if((a=this.getNodeTarget(b))&&!b.within(a,true)){this.onNodeOut(b,this.getNode(b))
}},delegateOver:function(b,a){if(!this.beforeEvent(b)){return
}if(CQ.Ext.isGecko&&!this.trackingDoc){CQ.Ext.getBody().on("mouseover",this.trackExit,this);
this.trackingDoc=true
}if(this.lastEcOver){this.onIconOut(b,this.lastEcOver);
delete this.lastEcOver
}if(b.getTarget(".x-tree-ec-icon",1)){this.lastEcOver=this.getNode(b);
this.onIconOver(b,this.lastEcOver)
}if(a=this.getNodeTarget(b)){this.onNodeOver(b,this.getNode(b))
}},trackExit:function(a){if(this.lastOverNode){if(this.lastOverNode.ui&&!a.within(this.lastOverNode.ui.getEl())){this.onNodeOut(a,this.lastOverNode)
}delete this.lastOverNode;
CQ.Ext.getBody().un("mouseover",this.trackExit,this);
this.trackingDoc=false
}},delegateClick:function(b,a){if(this.beforeEvent(b)){if(b.getTarget("input[type=checkbox]",1)){this.onCheckboxClick(b,this.getNode(b))
}else{if(b.getTarget(".x-tree-ec-icon",1)){this.onIconClick(b,this.getNode(b))
}else{if(this.getNodeTarget(b)){this.onNodeClick(b,this.getNode(b))
}}}}else{this.checkContainerEvent(b,"click")
}},delegateDblClick:function(b,a){if(this.beforeEvent(b)){if(this.getNodeTarget(b)){this.onNodeDblClick(b,this.getNode(b))
}}else{this.checkContainerEvent(b,"dblclick")
}},delegateContextMenu:function(b,a){if(this.beforeEvent(b)){if(this.getNodeTarget(b)){this.onNodeContextMenu(b,this.getNode(b))
}}else{this.checkContainerEvent(b,"contextmenu")
}},checkContainerEvent:function(b,a){if(this.disabled){b.stopEvent();
return false
}this.onContainerEvent(b,a)
},onContainerEvent:function(b,a){this.tree.fireEvent("container"+a,this.tree,b)
},onNodeClick:function(b,a){a.ui.onClick(b)
},onNodeOver:function(b,a){this.lastOverNode=a;
a.ui.onOver(b)
},onNodeOut:function(b,a){a.ui.onOut(b)
},onIconOver:function(b,a){a.ui.addClass("x-tree-ec-over")
},onIconOut:function(b,a){a.ui.removeClass("x-tree-ec-over")
},onIconClick:function(b,a){a.ui.ecClick(b)
},onCheckboxClick:function(b,a){a.ui.onCheckChange(b)
},onNodeDblClick:function(b,a){a.ui.onDblClick(b)
},onNodeContextMenu:function(b,a){a.ui.onContextMenu(b)
},beforeEvent:function(b){var a=this.getNode(b);
if(this.disabled||!a||!a.ui){b.stopEvent();
return false
}return true
},disable:function(){this.disabled=true
},enable:function(){this.disabled=false
}};
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.tree.DefaultSelectionModel=CQ.Ext.extend(CQ.Ext.util.Observable,{constructor:function(a){this.selNode=null;
this.addEvents("selectionchange","beforeselect");
CQ.Ext.apply(this,a);
CQ.Ext.tree.DefaultSelectionModel.superclass.constructor.call(this)
},init:function(a){this.tree=a;
a.mon(a.getTreeEl(),"keydown",this.onKeyDown,this);
a.on("click",this.onNodeClick,this)
},onNodeClick:function(a,b){this.select(a)
},select:function(c,a){if(!CQ.Ext.fly(c.ui.wrap).isVisible()&&a){return a.call(this,c)
}var b=this.selNode;
if(c==b){c.ui.onSelectedChange(true)
}else{if(this.fireEvent("beforeselect",this,c,b)!==false){if(b&&b.ui){b.ui.onSelectedChange(false)
}this.selNode=c;
c.ui.onSelectedChange(true);
this.fireEvent("selectionchange",this,c,b)
}}return c
},unselect:function(b,a){if(this.selNode==b){this.clearSelections(a)
}},clearSelections:function(a){var b=this.selNode;
if(b){b.ui.onSelectedChange(false);
this.selNode=null;
if(a!==true){this.fireEvent("selectionchange",this,null)
}}return b
},getSelectedNode:function(){return this.selNode
},isSelected:function(a){return this.selNode==a
},selectPrevious:function(a){if(!(a=a||this.selNode||this.lastSelNode)){return null
}var c=a.previousSibling;
if(c){if(!c.isExpanded()||c.childNodes.length<1){return this.select(c,this.selectPrevious)
}else{var b=c.lastChild;
while(b&&b.isExpanded()&&CQ.Ext.fly(b.ui.wrap).isVisible()&&b.childNodes.length>0){b=b.lastChild
}return this.select(b,this.selectPrevious)
}}else{if(a.parentNode&&(this.tree.rootVisible||!a.parentNode.isRoot)){return this.select(a.parentNode,this.selectPrevious)
}}return null
},selectNext:function(b){if(!(b=b||this.selNode||this.lastSelNode)){return null
}if(b.firstChild&&b.isExpanded()&&CQ.Ext.fly(b.ui.wrap).isVisible()){return this.select(b.firstChild,this.selectNext)
}else{if(b.nextSibling){return this.select(b.nextSibling,this.selectNext)
}else{if(b.parentNode){var a=null;
b.parentNode.bubble(function(){if(this.nextSibling){a=this.getOwnerTree().selModel.select(this.nextSibling,this.selectNext);
return false
}});
return a
}}}return null
},onKeyDown:function(c){var b=this.selNode||this.lastSelNode;
var g=this;
if(!b){return
}var a=c.getKey();
switch(a){case c.DOWN:c.stopEvent();
this.selectNext();
break;
case c.UP:c.stopEvent();
this.selectPrevious();
break;
case c.RIGHT:c.preventDefault();
if(b.hasChildNodes()){if(!b.isExpanded()){b.expand()
}else{if(b.firstChild){this.select(b.firstChild,c)
}}}break;
case c.LEFT:c.preventDefault();
if(b.hasChildNodes()&&b.isExpanded()){b.collapse()
}else{if(b.parentNode&&(this.tree.rootVisible||b.parentNode!=this.tree.getRootNode())){this.select(b.parentNode,c)
}}break
}}});
CQ.Ext.tree.MultiSelectionModel=CQ.Ext.extend(CQ.Ext.util.Observable,{constructor:function(a){this.selNodes=[];
this.selMap={};
this.addEvents("selectionchange");
CQ.Ext.apply(this,a);
CQ.Ext.tree.MultiSelectionModel.superclass.constructor.call(this)
},init:function(a){this.tree=a;
a.mon(a.getTreeEl(),"keydown",this.onKeyDown,this);
a.on("click",this.onNodeClick,this)
},onNodeClick:function(a,b){if(b.ctrlKey&&this.isSelected(a)){this.unselect(a)
}else{this.select(a,b,b.ctrlKey)
}},select:function(a,c,b){if(b!==true){this.clearSelections(true)
}if(this.isSelected(a)){this.lastSelNode=a;
return a
}this.selNodes.push(a);
this.selMap[a.id]=a;
this.lastSelNode=a;
a.ui.onSelectedChange(true);
this.fireEvent("selectionchange",this,this.selNodes);
return a
},unselect:function(b){if(this.selMap[b.id]){b.ui.onSelectedChange(false);
var c=this.selNodes;
var a=c.indexOf(b);
if(a!=-1){this.selNodes.splice(a,1)
}delete this.selMap[b.id];
this.fireEvent("selectionchange",this,this.selNodes)
}},clearSelections:function(b){var g=this.selNodes;
if(g.length>0){for(var c=0,a=g.length;
c<a;
c++){g[c].ui.onSelectedChange(false)
}this.selNodes=[];
this.selMap={};
if(b!==true){this.fireEvent("selectionchange",this,this.selNodes)
}}},isSelected:function(a){return this.selMap[a.id]?true:false
},getSelectedNodes:function(){return this.selNodes.concat([])
},onKeyDown:CQ.Ext.tree.DefaultSelectionModel.prototype.onKeyDown,selectNext:CQ.Ext.tree.DefaultSelectionModel.prototype.selectNext,selectPrevious:CQ.Ext.tree.DefaultSelectionModel.prototype.selectPrevious});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.data.Tree=CQ.Ext.extend(CQ.Ext.util.Observable,{constructor:function(a){this.nodeHash={};
this.root=null;
if(a){this.setRootNode(a)
}this.addEvents("append","remove","move","insert","beforeappend","beforeremove","beforemove","beforeinsert");
CQ.Ext.data.Tree.superclass.constructor.call(this)
},pathSeparator:"/",proxyNodeEvent:function(){return this.fireEvent.apply(this,arguments)
},getRootNode:function(){return this.root
},setRootNode:function(a){this.root=a;
a.ownerTree=this;
a.isRoot=true;
this.registerNode(a);
return a
},getNodeById:function(a){return this.nodeHash[a]
},registerNode:function(a){this.nodeHash[a.id]=a
},unregisterNode:function(a){delete this.nodeHash[a.id]
},toString:function(){return"[Tree"+(this.id?" "+this.id:"")+"]"
}});
CQ.Ext.data.Node=CQ.Ext.extend(CQ.Ext.util.Observable,{constructor:function(a){this.attributes=a||{};
this.leaf=this.attributes.leaf;
this.id=this.attributes.id;
if(!this.id){this.id=CQ.Ext.id(null,"xnode-");
this.attributes.id=this.id
}this.childNodes=[];
this.parentNode=null;
this.firstChild=null;
this.lastChild=null;
this.previousSibling=null;
this.nextSibling=null;
this.addEvents({append:true,remove:true,move:true,insert:true,beforeappend:true,beforeremove:true,beforemove:true,beforeinsert:true});
this.listeners=this.attributes.listeners;
CQ.Ext.data.Node.superclass.constructor.call(this)
},fireEvent:function(b){if(CQ.Ext.data.Node.superclass.fireEvent.apply(this,arguments)===false){return false
}var a=this.getOwnerTree();
if(a){if(a.proxyNodeEvent.apply(a,arguments)===false){return false
}}return true
},isLeaf:function(){return this.leaf===true
},setFirstChild:function(a){this.firstChild=a
},setLastChild:function(a){this.lastChild=a
},isLast:function(){return(!this.parentNode?true:this.parentNode.lastChild==this)
},isFirst:function(){return(!this.parentNode?true:this.parentNode.firstChild==this)
},hasChildNodes:function(){return !this.isLeaf()&&this.childNodes.length>0
},isExpandable:function(){return this.attributes.expandable||this.hasChildNodes()
},appendChild:function(j){var k=false;
if(CQ.Ext.isArray(j)){k=j
}else{if(arguments.length>1){k=arguments
}}if(k){for(var g=0,a=k.length;
g<a;
g++){this.appendChild(k[g])
}}else{if(this.fireEvent("beforeappend",this.ownerTree,this,j)===false){return false
}var b=this.childNodes.length;
var c=j.parentNode;
if(c){if(j.fireEvent("beforemove",j.getOwnerTree(),j,c,this,b)===false){return false
}c.removeChild(j)
}b=this.childNodes.length;
if(b===0){this.setFirstChild(j)
}this.childNodes.push(j);
j.parentNode=this;
var m=this.childNodes[b-1];
if(m){j.previousSibling=m;
m.nextSibling=j
}else{j.previousSibling=null
}j.nextSibling=null;
this.setLastChild(j);
j.setOwnerTree(this.getOwnerTree());
this.fireEvent("append",this.ownerTree,this,j,b);
if(c){j.fireEvent("move",this.ownerTree,j,c,this,b)
}return j
}},removeChild:function(c,b){var a=this.childNodes.indexOf(c);
if(a==-1){return false
}if(this.fireEvent("beforeremove",this.ownerTree,this,c)===false){return false
}this.childNodes.splice(a,1);
if(c.previousSibling){c.previousSibling.nextSibling=c.nextSibling
}if(c.nextSibling){c.nextSibling.previousSibling=c.previousSibling
}if(this.firstChild==c){this.setFirstChild(c.nextSibling)
}if(this.lastChild==c){this.setLastChild(c.previousSibling)
}this.fireEvent("remove",this.ownerTree,this,c);
if(b){c.destroy(true)
}else{c.clear()
}return c
},clear:function(a){this.setOwnerTree(null,a);
this.parentNode=this.previousSibling=this.nextSibling=null;
if(a){this.firstChild=this.lastChild=null
}},destroy:function(a){if(a===true){this.purgeListeners();
this.clear(true);
CQ.Ext.each(this.childNodes,function(b){b.destroy(true)
});
this.childNodes=null
}else{this.remove(true)
}},insertBefore:function(g,a){if(!a){return this.appendChild(g)
}if(g==a){return false
}if(this.fireEvent("beforeinsert",this.ownerTree,this,g,a)===false){return false
}var b=this.childNodes.indexOf(a);
var c=g.parentNode;
var j=b;
if(c==this&&this.childNodes.indexOf(g)<b){j--
}if(c){if(g.fireEvent("beforemove",g.getOwnerTree(),g,c,this,b,a)===false){return false
}c.removeChild(g)
}if(j===0){this.setFirstChild(g)
}this.childNodes.splice(j,0,g);
g.parentNode=this;
var k=this.childNodes[j-1];
if(k){g.previousSibling=k;
k.nextSibling=g
}else{g.previousSibling=null
}g.nextSibling=a;
a.previousSibling=g;
g.setOwnerTree(this.getOwnerTree());
this.fireEvent("insert",this.ownerTree,this,g,a);
if(c){g.fireEvent("move",this.ownerTree,g,c,this,j,a)
}return g
},remove:function(a){if(this.parentNode){this.parentNode.removeChild(this,a)
}return this
},removeAll:function(a){var c=this.childNodes,b;
while((b=c[0])){this.removeChild(b,a)
}return this
},item:function(a){return this.childNodes[a]
},replaceChild:function(a,c){var b=c?c.nextSibling:null;
this.removeChild(c);
this.insertBefore(a,b);
return c
},indexOf:function(a){return this.childNodes.indexOf(a)
},getOwnerTree:function(){if(!this.ownerTree){var a=this;
while(a){if(a.ownerTree){this.ownerTree=a.ownerTree;
break
}a=a.parentNode
}}return this.ownerTree
},getDepth:function(){var b=0;
var a=this;
while(a.parentNode){++b;
a=a.parentNode
}return b
},setOwnerTree:function(a,b){if(a!=this.ownerTree){if(this.ownerTree){this.ownerTree.unregisterNode(this)
}this.ownerTree=a;
if(b!==true){CQ.Ext.each(this.childNodes,function(c){c.setOwnerTree(a)
})
}if(a){a.registerNode(this)
}}},setId:function(b){if(b!==this.id){var a=this.ownerTree;
if(a){a.unregisterNode(this)
}this.id=this.attributes.id=b;
if(a){a.registerNode(this)
}this.onIdChange(b)
}},onIdChange:CQ.Ext.emptyFn,getPath:function(c){c=c||"id";
var j=this.parentNode;
var a=[this.attributes[c]];
while(j){a.unshift(j.attributes[c]);
j=j.parentNode
}var g=this.getOwnerTree().pathSeparator;
return g+a.join(g)
},bubble:function(c,b,a){var g=this;
while(g){if(c.apply(b||g,a||[g])===false){break
}g=g.parentNode
}},cascade:function(k,j,b){if(k.apply(j||this,b||[this])!==false){var g=this.childNodes;
for(var c=0,a=g.length;
c<a;
c++){g[c].cascade(k,j,b)
}}},eachChild:function(k,j,b){var g=this.childNodes;
for(var c=0,a=g.length;
c<a;
c++){if(k.apply(j||g[c],b||[g[c]])===false){break
}}},findChild:function(b,c,a){return this.findChildBy(function(){return this.attributes[b]==c
},null,a)
},findChildBy:function(m,k,b){var j=this.childNodes,a=j.length,g=0,o,c;
for(;
g<a;
g++){o=j[g];
if(m.call(k||o,o)===true){return o
}else{if(b){c=o.findChildBy(m,k,b);
if(c!=null){return c
}}}}return null
},sort:function(j,g){var c=this.childNodes;
var a=c.length;
if(a>0){var k=g?function(){j.apply(g,arguments)
}:j;
c.sort(k);
for(var b=0;
b<a;
b++){var m=c[b];
m.previousSibling=c[b-1];
m.nextSibling=c[b+1];
if(b===0){this.setFirstChild(m)
}if(b==a-1){this.setLastChild(m)
}}}},contains:function(a){return a.isAncestor(this)
},isAncestor:function(a){var b=this.parentNode;
while(b){if(b==a){return true
}b=b.parentNode
}return false
},toString:function(){return"[Node"+(this.id?" "+this.id:"")+"]"
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.tree.TreeNode=CQ.Ext.extend(CQ.Ext.data.Node,{constructor:function(a){a=a||{};
if(CQ.Ext.isString(a)){a={text:a}
}this.childrenRendered=false;
this.rendered=false;
CQ.Ext.tree.TreeNode.superclass.constructor.call(this,a);
this.expanded=a.expanded===true;
this.isTarget=a.isTarget!==false;
this.draggable=a.draggable!==false&&a.allowDrag!==false;
this.allowChildren=a.allowChildren!==false&&a.allowDrop!==false;
this.text=a.text;
this.disabled=a.disabled===true;
this.hidden=a.hidden===true;
this.addEvents("textchange","beforeexpand","beforecollapse","expand","disabledchange","collapse","beforeclick","click","checkchange","beforedblclick","dblclick","contextmenu","beforechildrenrendered");
var b=this.attributes.uiProvider||this.defaultUI||CQ.Ext.tree.TreeNodeUI;
this.ui=new b(this)
},preventHScroll:true,isExpanded:function(){return this.expanded
},getUI:function(){return this.ui
},getLoader:function(){var a;
return this.loader||((a=this.getOwnerTree())&&a.loader?a.loader:(this.loader=new CQ.Ext.tree.TreeLoader()))
},setFirstChild:function(a){var b=this.firstChild;
CQ.Ext.tree.TreeNode.superclass.setFirstChild.call(this,a);
if(this.childrenRendered&&b&&a!=b){b.renderIndent(true,true)
}if(this.rendered){this.renderIndent(true,true)
}},setLastChild:function(b){var a=this.lastChild;
CQ.Ext.tree.TreeNode.superclass.setLastChild.call(this,b);
if(this.childrenRendered&&a&&b!=a){a.renderIndent(true,true)
}if(this.rendered){this.renderIndent(true,true)
}},appendChild:function(b){if(!b.render&&!CQ.Ext.isArray(b)){b=this.getLoader().createNode(b)
}var a=CQ.Ext.tree.TreeNode.superclass.appendChild.call(this,b);
if(a&&this.childrenRendered){a.render()
}this.ui.updateExpandIcon();
return a
},removeChild:function(b,a){this.ownerTree.getSelectionModel().unselect(b);
CQ.Ext.tree.TreeNode.superclass.removeChild.apply(this,arguments);
if(!a){var c=b.ui.rendered;
if(c){b.ui.remove()
}if(c&&this.childNodes.length<1){this.collapse(false,false)
}else{this.ui.updateExpandIcon()
}if(!this.firstChild&&!this.isHiddenRoot()){this.childrenRendered=false
}}return b
},insertBefore:function(c,a){if(!c.render){c=this.getLoader().createNode(c)
}var b=CQ.Ext.tree.TreeNode.superclass.insertBefore.call(this,c,a);
if(b&&a&&this.childrenRendered){c.render()
}this.ui.updateExpandIcon();
return b
},setText:function(b){var a=this.text;
this.text=this.attributes.text=b;
if(this.rendered){this.ui.onTextChange(this,b,a)
}this.fireEvent("textchange",this,b,a)
},setIconCls:function(b){var a=this.attributes.iconCls;
this.attributes.iconCls=b;
if(this.rendered){this.ui.onIconClsChange(this,b,a)
}},setTooltip:function(a,b){this.attributes.qtip=a;
this.attributes.qtipTitle=b;
if(this.rendered){this.ui.onTipChange(this,a,b)
}},setIcon:function(a){this.attributes.icon=a;
if(this.rendered){this.ui.onIconChange(this,a)
}},setHref:function(a,b){this.attributes.href=a;
this.attributes.hrefTarget=b;
if(this.rendered){this.ui.onHrefChange(this,a,b)
}},setCls:function(b){var a=this.attributes.cls;
this.attributes.cls=b;
if(this.rendered){this.ui.onClsChange(this,b,a)
}},select:function(){var a=this.getOwnerTree();
if(a){a.getSelectionModel().select(this)
}},unselect:function(a){var b=this.getOwnerTree();
if(b){b.getSelectionModel().unselect(this,a)
}},isSelected:function(){var a=this.getOwnerTree();
return a?a.getSelectionModel().isSelected(this):false
},expand:function(a,c,g,b){if(!this.expanded){if(this.fireEvent("beforeexpand",this,a,c)===false){return
}if(!this.childrenRendered){this.renderChildren()
}this.expanded=true;
if(!this.isHiddenRoot()&&(this.getOwnerTree().animate&&c!==false)||c){this.ui.animExpand(function(){this.fireEvent("expand",this);
this.runCallback(g,b||this,[this]);
if(a===true){this.expandChildNodes(true,true)
}}.createDelegate(this));
return
}else{this.ui.expand();
this.fireEvent("expand",this);
this.runCallback(g,b||this,[this])
}}else{this.runCallback(g,b||this,[this])
}if(a===true){this.expandChildNodes(true)
}},runCallback:function(a,c,b){if(CQ.Ext.isFunction(a)){a.apply(c,b)
}},isHiddenRoot:function(){return this.isRoot&&!this.getOwnerTree().rootVisible
},collapse:function(b,k,m,j){if(this.expanded&&!this.isHiddenRoot()){if(this.fireEvent("beforecollapse",this,b,k)===false){return
}this.expanded=false;
if((this.getOwnerTree().animate&&k!==false)||k){this.ui.animCollapse(function(){this.fireEvent("collapse",this);
this.runCallback(m,j||this,[this]);
if(b===true){this.collapseChildNodes(true)
}}.createDelegate(this));
return
}else{this.ui.collapse();
this.fireEvent("collapse",this);
this.runCallback(m,j||this,[this])
}}else{if(!this.expanded){this.runCallback(m,j||this,[this])
}}if(b===true){var g=this.childNodes;
for(var c=0,a=g.length;
c<a;
c++){g[c].collapse(true,false)
}}},delayedExpand:function(a){if(!this.expandProcId){this.expandProcId=this.expand.defer(a,this)
}},cancelExpand:function(){if(this.expandProcId){clearTimeout(this.expandProcId)
}this.expandProcId=false
},toggle:function(){if(this.expanded){this.collapse()
}else{this.expand()
}},ensureVisible:function(c,b){var a=this.getOwnerTree();
a.expandPath(this.parentNode?this.parentNode.getPath():this.getPath(),false,function(){var g=a.getNodeById(this.id);
a.getTreeEl().scrollChildIntoView(g.ui.anchor);
this.runCallback(c,b||this,[this])
}.createDelegate(this))
},expandChildNodes:function(b,j){var g=this.childNodes,c,a=g.length;
for(c=0;
c<a;
c++){g[c].expand(b,j)
}},collapseChildNodes:function(b){var g=this.childNodes;
for(var c=0,a=g.length;
c<a;
c++){g[c].collapse(b)
}},disable:function(){this.disabled=true;
this.unselect();
if(this.rendered&&this.ui.onDisableChange){this.ui.onDisableChange(this,true)
}this.fireEvent("disabledchange",this,true)
},enable:function(){this.disabled=false;
if(this.rendered&&this.ui.onDisableChange){this.ui.onDisableChange(this,false)
}this.fireEvent("disabledchange",this,false)
},renderChildren:function(b){if(b!==false){this.fireEvent("beforechildrenrendered",this)
}var g=this.childNodes;
for(var c=0,a=g.length;
c<a;
c++){g[c].render(true)
}this.childrenRendered=true
},sort:function(j,g){CQ.Ext.tree.TreeNode.superclass.sort.apply(this,arguments);
if(this.childrenRendered){var c=this.childNodes;
for(var b=0,a=c.length;
b<a;
b++){c[b].render(true)
}}},render:function(a){this.ui.render(a);
if(!this.rendered){this.getOwnerTree().registerNode(this);
this.rendered=true;
if(this.expanded){this.expanded=false;
this.expand(false,false)
}}},renderIndent:function(b,j){if(j){this.ui.childIndent=null
}this.ui.renderIndent();
if(b===true&&this.childrenRendered){var g=this.childNodes;
for(var c=0,a=g.length;
c<a;
c++){g[c].renderIndent(true,j)
}}},beginUpdate:function(){this.childrenRendered=false
},endUpdate:function(){if(this.expanded&&this.rendered){this.renderChildren()
}},destroy:function(a){if(a===true){this.unselect(true)
}CQ.Ext.tree.TreeNode.superclass.destroy.call(this,a);
CQ.Ext.destroy(this.ui,this.loader);
this.ui=this.loader=null
},onIdChange:function(a){this.ui.onIdChange(a)
}});
CQ.Ext.tree.TreePanel.nodeTypes.node=CQ.Ext.tree.TreeNode;
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.tree.AsyncTreeNode=function(a){this.loaded=a&&a.loaded===true;
this.loading=false;
CQ.Ext.tree.AsyncTreeNode.superclass.constructor.apply(this,arguments);
this.addEvents("beforeload","load")
};
CQ.Ext.extend(CQ.Ext.tree.AsyncTreeNode,CQ.Ext.tree.TreeNode,{expand:function(b,j,m,c){if(this.loading){var k;
var g=function(){if(!this.loading){clearInterval(k);
this.expand(b,j,m,c)
}}.createDelegate(this);
k=setInterval(g,200);
return
}if(!this.loaded){if(this.fireEvent("beforeload",this)===false){return
}this.loading=true;
this.ui.beforeLoad(this);
var a=this.loader||this.attributes.loader||this.getOwnerTree().getLoader();
if(a){a.load(this,this.loadComplete.createDelegate(this,[b,j,m,c]),this);
return
}}CQ.Ext.tree.AsyncTreeNode.superclass.expand.call(this,b,j,m,c)
},isLoading:function(){return this.loading
},loadComplete:function(a,c,g,b){this.loading=false;
this.loaded=true;
this.ui.afterLoad(this);
this.fireEvent("load",this);
this.expand(a,c,g,b)
},isLoaded:function(){return this.loaded
},hasChildNodes:function(){if(!this.isLeaf()&&!this.loaded){return true
}else{return CQ.Ext.tree.AsyncTreeNode.superclass.hasChildNodes.call(this)
}},reload:function(b,a){this.collapse(false,false);
while(this.firstChild){this.removeChild(this.firstChild).destroy()
}this.childrenRendered=false;
this.loaded=false;
if(this.isHiddenRoot()){this.expanded=false
}this.expand(false,false,b,a)
}});
CQ.Ext.tree.TreePanel.nodeTypes.async=CQ.Ext.tree.AsyncTreeNode;
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.tree.TreeNodeUI=CQ.Ext.extend(Object,{constructor:function(a){CQ.Ext.apply(this,{node:a,rendered:false,animating:false,wasLeaf:true,ecc:"x-tree-ec-icon x-tree-elbow",emptyIcon:CQ.Ext.BLANK_IMAGE_URL})
},removeChild:function(a){if(this.rendered){this.ctNode.removeChild(a.ui.getEl())
}},beforeLoad:function(){this.addClass("x-tree-node-loading")
},afterLoad:function(){this.removeClass("x-tree-node-loading")
},onTextChange:function(b,c,a){if(this.rendered){this.textNode.innerHTML=c
}},onIconClsChange:function(c,a,b){if(this.rendered){CQ.Ext.fly(this.iconNode).replaceClass(b,a)
}},onIconChange:function(b,a){if(this.rendered){var c=CQ.Ext.isEmpty(a);
this.iconNode.src=c?this.emptyIcon:a;
CQ.Ext.fly(this.iconNode)[c?"removeClass":"addClass"]("x-tree-node-inline-icon")
}},onTipChange:function(b,c,g){if(this.rendered){var a=CQ.Ext.isDefined(g);
if(this.textNode.setAttributeNS){this.textNode.setAttributeNS("ext","qtip",c);
if(a){this.textNode.setAttributeNS("ext","qtitle",g)
}}else{this.textNode.setAttribute("ext:qtip",c);
if(a){this.textNode.setAttribute("ext:qtitle",g)
}}}},onHrefChange:function(b,a,c){if(this.rendered){this.anchor.href=this.getHref(a);
if(CQ.Ext.isDefined(c)){this.anchor.target=c
}}},onClsChange:function(c,a,b){if(this.rendered){CQ.Ext.fly(this.elNode).replaceClass(b,a)
}},onDisableChange:function(a,b){this.disabled=b;
if(this.checkbox){this.checkbox.disabled=b
}this[b?"addClass":"removeClass"]("x-tree-node-disabled")
},onSelectedChange:function(a){if(a){this.focus();
this.addClass("x-tree-selected")
}else{this.removeClass("x-tree-selected")
}},onMove:function(a,m,j,k,g,b){this.childIndent=null;
if(this.rendered){var n=k.ui.getContainer();
if(!n){this.holder=document.createElement("div");
this.holder.appendChild(this.wrap);
return
}var c=b?b.ui.getEl():null;
if(c){n.insertBefore(this.wrap,c)
}else{n.appendChild(this.wrap)
}this.node.renderIndent(true,j!=k)
}},addClass:function(a){if(this.elNode){CQ.Ext.fly(this.elNode).addClass(a)
}},removeClass:function(a){if(this.elNode){CQ.Ext.fly(this.elNode).removeClass(a)
}},remove:function(){if(this.rendered){this.holder=document.createElement("div");
this.holder.appendChild(this.wrap)
}},fireEvent:function(){return this.node.fireEvent.apply(this.node,arguments)
},initEvents:function(){this.node.on("move",this.onMove,this);
if(this.node.disabled){this.onDisableChange(this.node,true)
}if(this.node.hidden){this.hide()
}var b=this.node.getOwnerTree();
var a=b.enableDD||b.enableDrag||b.enableDrop;
if(a&&(!this.node.isRoot||b.rootVisible)){CQ.Ext.dd.Registry.register(this.elNode,{node:this.node,handles:this.getDDHandles(),isHandle:false})
}},getDDHandles:function(){return[this.iconNode,this.textNode,this.elNode]
},hide:function(){this.node.hidden=true;
if(this.wrap){this.wrap.style.display="none"
}},show:function(){this.node.hidden=false;
if(this.wrap){this.wrap.style.display=""
}},onContextMenu:function(a){if(this.node.hasListener("contextmenu")||this.node.getOwnerTree().hasListener("contextmenu")){a.preventDefault();
this.focus();
this.fireEvent("contextmenu",this.node,a)
}},onClick:function(c){if(this.dropping){c.stopEvent();
return
}if(this.fireEvent("beforeclick",this.node,c)!==false){var b=c.getTarget("a");
if(!this.disabled&&this.node.attributes.href&&b){this.fireEvent("click",this.node,c);
return
}else{if(b&&c.ctrlKey){c.stopEvent()
}}c.preventDefault();
if(this.disabled){return
}if(this.node.attributes.singleClickExpand&&!this.animating&&this.node.isExpandable()){this.node.toggle()
}this.fireEvent("click",this.node,c)
}else{c.stopEvent()
}},onDblClick:function(a){a.preventDefault();
if(this.disabled){return
}if(this.fireEvent("beforedblclick",this.node,a)!==false){if(this.checkbox){this.toggleCheck()
}if(!this.animating&&this.node.isExpandable()){this.node.toggle()
}this.fireEvent("dblclick",this.node,a)
}},onOver:function(a){this.addClass("x-tree-node-over")
},onOut:function(a){this.removeClass("x-tree-node-over")
},onCheckChange:function(){var a=this.checkbox.checked;
this.checkbox.defaultChecked=a;
this.node.attributes.checked=a;
this.fireEvent("checkchange",this.node,a)
},ecClick:function(a){if(!this.animating&&this.node.isExpandable()){this.node.toggle()
}},startDrop:function(){this.dropping=true
},endDrop:function(){setTimeout(function(){this.dropping=false
}.createDelegate(this),50)
},expand:function(){this.updateExpandIcon();
this.ctNode.style.display=""
},focus:function(){if(!this.node.preventHScroll){try{this.anchor.focus()
}catch(c){}}else{try{var b=this.node.getOwnerTree().getTreeEl().dom;
var a=b.scrollLeft;
this.anchor.focus();
b.scrollLeft=a
}catch(c){}}},toggleCheck:function(b){var a=this.checkbox;
if(a){a.checked=(b===undefined?!a.checked:b);
this.onCheckChange()
}},blur:function(){try{this.anchor.blur()
}catch(a){}},animExpand:function(b){var a=CQ.Ext.get(this.ctNode);
a.stopFx();
if(!this.node.isExpandable()){this.updateExpandIcon();
this.ctNode.style.display="";
CQ.Ext.callback(b);
return
}this.animating=true;
this.updateExpandIcon();
a.slideIn("t",{callback:function(){this.animating=false;
CQ.Ext.callback(b)
},scope:this,duration:this.node.ownerTree.duration||0.25})
},highlight:function(){var a=this.node.getOwnerTree();
CQ.Ext.fly(this.wrap).highlight(a.hlColor||"C3DAF9",{endColor:a.hlBaseColor})
},collapse:function(){this.updateExpandIcon();
this.ctNode.style.display="none"
},animCollapse:function(b){var a=CQ.Ext.get(this.ctNode);
a.enableDisplayMode("block");
a.stopFx();
this.animating=true;
this.updateExpandIcon();
a.slideOut("t",{callback:function(){this.animating=false;
CQ.Ext.callback(b)
},scope:this,duration:this.node.ownerTree.duration||0.25})
},getContainer:function(){return this.ctNode
},getEl:function(){return this.wrap
},appendDDGhost:function(a){a.appendChild(this.elNode.cloneNode(true))
},getDDRepairXY:function(){return CQ.Ext.lib.Dom.getXY(this.iconNode)
},onRender:function(){this.render()
},render:function(c){var j=this.node,b=j.attributes;
var g=j.parentNode?j.parentNode.ui.getContainer():j.ownerTree.innerCt.dom;
if(!this.rendered){this.rendered=true;
this.renderElements(j,b,g,c);
if(b.qtip){this.onTipChange(j,b.qtip,b.qtipTitle)
}else{if(b.qtipCfg){b.qtipCfg.target=CQ.Ext.id(this.textNode);
CQ.Ext.QuickTips.register(b.qtipCfg)
}}this.initEvents();
if(!this.node.expanded){this.updateExpandIcon(true)
}}else{if(c===true){g.appendChild(this.wrap)
}}},renderElements:function(j,r,q,t){this.indentMarkup=j.parentNode?j.parentNode.ui.getChildIndent():"";
var k=CQ.Ext.isBoolean(r.checked),b,c=this.getHref(r.href),g=['<li class="x-tree-node"><div ext:tree-node-id="',j.id,'" class="x-tree-node-el x-tree-node-leaf x-unselectable ',r.cls,'" unselectable="on">','<span class="x-tree-node-indent">',this.indentMarkup,"</span>",'<img alt="" src="',this.emptyIcon,'" class="x-tree-ec-icon x-tree-elbow" />','<img alt="" src="',r.icon||this.emptyIcon,'" class="x-tree-node-icon',(r.icon?" x-tree-node-inline-icon":""),(r.iconCls?" "+r.iconCls:""),'" unselectable="on" />',k?('<input class="x-tree-node-cb" type="checkbox" '+(r.checked?'checked="checked" />':"/>")):"",'<a hidefocus="on" class="x-tree-node-anchor" href="',c,'" tabIndex="1" ',r.hrefTarget?' target="'+r.hrefTarget+'"':"",'><span unselectable="on">',j.text,"</span></a></div>",'<ul class="x-tree-node-ct" style="display:none;"></ul>',"</li>"].join("");
if(t!==true&&j.nextSibling&&(b=j.nextSibling.ui.getEl())){this.wrap=CQ.Ext.DomHelper.insertHtml("beforeBegin",b,g)
}else{this.wrap=CQ.Ext.DomHelper.insertHtml("beforeEnd",q,g)
}this.elNode=this.wrap.childNodes[0];
this.ctNode=this.wrap.childNodes[1];
var o=this.elNode.childNodes;
this.indentNode=o[0];
this.ecNode=o[1];
this.iconNode=o[2];
var m=3;
if(k){this.checkbox=o[3];
this.checkbox.defaultChecked=this.checkbox.checked;
m++
}this.anchor=o[m];
this.textNode=o[m].firstChild
},getHref:function(a){return CQ.Ext.isEmpty(a)?(CQ.Ext.isGecko?"":"#"):a
},getAnchor:function(){return this.anchor
},getTextEl:function(){return this.textNode
},getIconEl:function(){return this.iconNode
},isChecked:function(){return this.checkbox?this.checkbox.checked:false
},updateExpandIcon:function(){if(this.rendered){var k=this.node,g,c,a=k.isLast()?"x-tree-elbow-end":"x-tree-elbow",j=k.hasChildNodes();
if(j||k.attributes.expandable){if(k.expanded){a+="-minus";
g="x-tree-node-collapsed";
c="x-tree-node-expanded"
}else{a+="-plus";
g="x-tree-node-expanded";
c="x-tree-node-collapsed"
}if(this.wasLeaf){this.removeClass("x-tree-node-leaf");
this.wasLeaf=false
}if(this.c1!=g||this.c2!=c){CQ.Ext.fly(this.elNode).replaceClass(g,c);
this.c1=g;
this.c2=c
}}else{if(!this.wasLeaf){CQ.Ext.fly(this.elNode).replaceClass("x-tree-node-expanded","x-tree-node-collapsed");
delete this.c1;
delete this.c2;
this.wasLeaf=true
}}var b="x-tree-ec-icon "+a;
if(this.ecc!=b){this.ecNode.className=b;
this.ecc=b
}}},onIdChange:function(a){if(this.rendered){this.elNode.setAttribute("ext:tree-node-id",a)
}},getChildIndent:function(){if(!this.childIndent){var a=[],b=this.node;
while(b){if(!b.isRoot||(b.isRoot&&b.ownerTree.rootVisible)){if(!b.isLast()){a.unshift('<img alt="" src="'+this.emptyIcon+'" class="x-tree-elbow-line" />')
}else{a.unshift('<img alt="" src="'+this.emptyIcon+'" class="x-tree-icon" />')
}}b=b.parentNode
}this.childIndent=a.join("")
}return this.childIndent
},renderIndent:function(){if(this.rendered){var a="",b=this.node.parentNode;
if(b){a=b.ui.getChildIndent()
}if(this.indentMarkup!=a){this.indentNode.innerHTML=a;
this.indentMarkup=a
}this.updateExpandIcon()
}},destroy:function(){if(this.elNode){CQ.Ext.dd.Registry.unregister(this.elNode.id)
}CQ.Ext.each(["textnode","anchor","checkbox","indentNode","ecNode","iconNode","elNode","ctNode","wrap","holder"],function(a){if(this[a]){CQ.Ext.fly(this[a]).remove();
delete this[a]
}},this);
delete this.node
}});
CQ.Ext.tree.RootTreeNodeUI=CQ.Ext.extend(CQ.Ext.tree.TreeNodeUI,{render:function(){if(!this.rendered){var a=this.node.ownerTree.innerCt.dom;
this.node.expanded=true;
a.innerHTML='<div class="x-tree-root-node"></div>';
this.wrap=this.ctNode=a.firstChild
}},collapse:CQ.Ext.emptyFn,expand:CQ.Ext.emptyFn});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.tree.TreeLoader=function(a){this.baseParams={};
CQ.Ext.apply(this,a);
this.addEvents("beforeload","load","loadexception");
CQ.Ext.tree.TreeLoader.superclass.constructor.call(this);
if(CQ.Ext.isString(this.paramOrder)){this.paramOrder=this.paramOrder.split(/[\s,|]/)
}};
CQ.Ext.extend(CQ.Ext.tree.TreeLoader,CQ.Ext.util.Observable,{uiProviders:{},clearOnLoad:true,paramOrder:undefined,paramsAsHash:false,nodeParameter:"node",directFn:undefined,load:function(b,c,a){if(this.clearOnLoad){while(b.firstChild){b.removeChild(b.firstChild)
}}if(this.doPreload(b)){this.runCallback(c,a||b,[b])
}else{if(this.directFn||this.dataUrl||this.url){this.requestData(b,c,a||b)
}}},doPreload:function(g){if(g.attributes.children){if(g.childNodes.length<1){var c=g.attributes.children;
g.beginUpdate();
for(var b=0,a=c.length;
b<a;
b++){var j=g.appendChild(this.createNode(c[b]));
if(this.preloadChildren){this.doPreload(j)
}}g.endUpdate()
}return true
}return false
},getParams:function(k){var j=CQ.Ext.apply({},this.baseParams),m=this.nodeParameter,b=this.paramOrder;
m&&(j[m]=k.id);
if(this.directFn){var c=[k.id];
if(b){if(m&&b.indexOf(m)>-1){c=[]
}for(var g=0,a=b.length;
g<a;
g++){c.push(j[b[g]])
}}else{if(this.paramsAsHash){c=[j]
}}return c
}else{return j
}},requestData:function(c,g,b){if(this.fireEvent("beforeload",this,c,g)!==false){if(this.directFn){var a=this.getParams(c);
a.push(this.processDirectResponse.createDelegate(this,[{callback:g,node:c,scope:b}],true));
this.directFn.apply(window,a)
}else{this.transId=CQ.Ext.Ajax.request({method:this.requestMethod,url:this.dataUrl||this.url,success:this.handleResponse,failure:this.handleFailure,scope:this,argument:{callback:g,node:c,scope:b},params:this.getParams(c)})
}}else{this.runCallback(g,b||c,[])
}},processDirectResponse:function(a,b,c){if(b.status){this.handleResponse({responseData:CQ.Ext.isArray(a)?a:null,responseText:a,argument:c})
}else{this.handleFailure({argument:c})
}},runCallback:function(a,c,b){if(CQ.Ext.isFunction(a)){a.apply(c,b)
}},isLoading:function(){return !!this.transId
},abort:function(){if(this.isLoading()){CQ.Ext.Ajax.abort(this.transId)
}},createNode:function(attr){if(this.baseAttrs){CQ.Ext.applyIf(attr,this.baseAttrs)
}if(this.applyLoader!==false&&!attr.loader){attr.loader=this
}if(CQ.Ext.isString(attr.uiProvider)){attr.uiProvider=this.uiProviders[attr.uiProvider]||eval(attr.uiProvider)
}if(attr.nodeType){return new CQ.Ext.tree.TreePanel.nodeTypes[attr.nodeType](attr)
}else{return attr.leaf?new CQ.Ext.tree.TreeNode(attr):new CQ.Ext.tree.AsyncTreeNode(attr)
}},processResponse:function(g,c,q,r){var t=g.responseText;
try{var a=g.responseData||CQ.Ext.decode(t);
c.beginUpdate();
for(var j=0,k=a.length;
j<k;
j++){var b=this.createNode(a[j]);
if(b){c.appendChild(b)
}}c.endUpdate();
this.runCallback(q,r||c,[c])
}catch(m){this.handleFailure(g)
}},handleResponse:function(c){this.transId=false;
var b=c.argument;
this.processResponse(c,b.node,b.callback,b.scope);
this.fireEvent("load",this,b.node,c)
},handleFailure:function(c){this.transId=false;
var b=c.argument;
this.fireEvent("loadexception",this,b.node,c);
this.runCallback(b.callback,b.scope||b.node,[b.node])
},destroy:function(){this.abort();
this.purgeListeners()
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.tree.TreeFilter=function(a,b){this.tree=a;
this.filtered={};
CQ.Ext.apply(this,b)
};
CQ.Ext.tree.TreeFilter.prototype={clearBlank:false,reverse:false,autoClear:false,remove:false,filter:function(g,a,b){a=a||"text";
var c;
if(typeof g=="string"){var j=g.length;
if(j==0&&this.clearBlank){this.clear();
return
}g=g.toLowerCase();
c=function(k){return k.attributes[a].substr(0,j).toLowerCase()==g
}
}else{if(g.exec){c=function(k){return g.test(k.attributes[a])
}
}else{throw"Illegal filter type, must be string or regex"
}}this.filterBy(c,null,b)
},filterBy:function(g,c,b){b=b||this.tree.root;
if(this.autoClear){this.clear()
}var a=this.filtered,o=this.reverse;
var j=function(r){if(r==b){return true
}if(a[r.id]){return false
}var q=g.call(c||r,r);
if(!q||o){a[r.id]=r;
r.ui.hide();
return false
}return true
};
b.cascade(j);
if(this.remove){for(var m in a){if(typeof m!="function"){var k=a[m];
if(k&&k.parentNode){k.parentNode.removeChild(k)
}}}}},clear:function(){var b=this.tree;
var a=this.filtered;
for(var g in a){if(typeof g!="function"){var c=a[g];
if(c){c.ui.show()
}}}this.filtered={}
}};
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.tree.TreeSorter=CQ.Ext.extend(Object,{constructor:function(a,c){CQ.Ext.apply(this,c);
a.on({scope:this,beforechildrenrendered:this.doSort,append:this.updateSort,insert:this.updateSort,textchange:this.updateSortParent});
var j=this.dir&&this.dir.toLowerCase()=="desc",n=this.property||"text",g=this.sortType,m=this.folderSort,b=this.caseSensitive===true,k=this.leafAttr||"leaf";
if(CQ.Ext.isString(g)){g=CQ.Ext.data.SortTypes[g]
}this.sortFn=function(v,t){var q=v.attributes,o=t.attributes;
if(m){if(q[k]&&!o[k]){return 1
}if(!q[k]&&o[k]){return -1
}}var u=q[n],r=o[n],x=g?g(u):(b?u:u.toUpperCase()),w=g?g(r):(b?r:r.toUpperCase());
if(x<w){return j?1:-1
}else{if(x>w){return j?-1:1
}}return 0
}
},doSort:function(a){a.sort(this.sortFn)
},updateSort:function(a,b){if(b.childrenRendered){this.doSort.defer(1,this,[b])
}},updateSortParent:function(a){var b=a.parentNode;
if(b&&b.childrenRendered){this.doSort.defer(1,this,[b])
}}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
if(CQ.Ext.dd.DropZone){CQ.Ext.tree.TreeDropZone=function(a,b){this.allowParentInsert=b.allowParentInsert||false;
this.allowContainerDrop=b.allowContainerDrop||false;
this.appendOnly=b.appendOnly||false;
CQ.Ext.tree.TreeDropZone.superclass.constructor.call(this,a.getTreeEl(),b);
this.tree=a;
this.dragOverData={};
this.lastInsertClass="x-tree-no-status"
};
CQ.Ext.extend(CQ.Ext.tree.TreeDropZone,CQ.Ext.dd.DropZone,{ddGroup:"TreeDD",expandDelay:1000,expandNode:function(a){if(a.hasChildNodes()&&!a.isExpanded()){a.expand(false,null,this.triggerCacheRefresh.createDelegate(this))
}},queueExpand:function(a){this.expandProcId=this.expandNode.defer(this.expandDelay,this,[a])
},cancelExpand:function(){if(this.expandProcId){clearTimeout(this.expandProcId);
this.expandProcId=false
}},isValidDropPoint:function(a,q,m,g,c){if(!a||!c){return false
}var j=a.node;
var k=c.node;
if(!(j&&j.isTarget&&q)){return false
}if(q=="append"&&j.allowChildren===false){return false
}if((q=="above"||q=="below")&&(j.parentNode&&j.parentNode.allowChildren===false)){return false
}if(k&&(j==k||k.contains(j))){return false
}var b=this.dragOverData;
b.tree=this.tree;
b.target=j;
b.data=c;
b.point=q;
b.source=m;
b.rawEvent=g;
b.dropNode=k;
b.cancel=false;
var o=this.tree.fireEvent("nodedragover",b);
return b.cancel===false&&o!==false
},getDropPoint:function(k,j,u){var v=j.node;
if(v.isRoot){return v.allowChildren!==false?"append":false
}var c=j.ddel;
var w=CQ.Ext.lib.Dom.getY(c),o=w+c.offsetHeight;
var m=CQ.Ext.lib.Event.getPageY(k);
var r=v.allowChildren===false||v.isLeaf();
if(this.appendOnly||v.parentNode.allowChildren===false){return r?false:"append"
}var g=false;
if(!this.allowParentInsert){g=v.hasChildNodes()&&v.isExpanded()
}var a=(o-w)/(r?2:3);
if(m>=w&&m<(w+a)){return"above"
}else{if(!g&&(r||m>=o-a&&m<=o)){return"below"
}else{return"append"
}}},onNodeEnter:function(g,a,c,b){this.cancelExpand()
},onContainerOver:function(a,c,b){if(this.allowContainerDrop&&this.isValidDropPoint({ddel:this.tree.getRootNode().ui.elNode,node:this.tree.getRootNode()},"append",a,c,b)){return this.dropAllowed
}return this.dropNotAllowed
},onNodeOver:function(b,m,k,j){var q=this.getDropPoint(k,b,m);
var c=b.node;
if(!this.expandProcId&&q=="append"&&c.hasChildNodes()&&!b.node.isExpanded()){this.queueExpand(c)
}else{if(q!="append"){this.cancelExpand()
}}var g=this.dropNotAllowed;
if(this.isValidDropPoint(b,q,m,k,j)){if(q){var a=b.ddel;
var o;
if(q=="above"){g=b.node.isFirst()?"x-tree-drop-ok-above":"x-tree-drop-ok-between";
o="x-tree-drag-insert-above"
}else{if(q=="below"){g=b.node.isLast()?"x-tree-drop-ok-below":"x-tree-drop-ok-between";
o="x-tree-drag-insert-below"
}else{g="x-tree-drop-ok-append";
o="x-tree-drag-append"
}}if(this.lastInsertClass!=o){CQ.Ext.fly(a).replaceClass(this.lastInsertClass,o);
this.lastInsertClass=o
}}}return g
},onNodeOut:function(g,a,c,b){this.cancelExpand();
this.removeDropIndicators(g)
},onNodeDrop:function(m,b,k,g){var a=this.getDropPoint(k,m,b);
var j=m.node;
j.ui.startDrop();
if(!this.isValidDropPoint(m,a,b,k,g)){j.ui.endDrop();
return false
}var c=g.node||(b.getTreeNode?b.getTreeNode(g,j,a,k):null);
return this.processDrop(j,g,a,b,k,c)
},onContainerDrop:function(a,j,c){if(this.allowContainerDrop&&this.isValidDropPoint({ddel:this.tree.getRootNode().ui.elNode,node:this.tree.getRootNode()},"append",a,j,c)){var g=this.tree.getRootNode();
g.ui.startDrop();
var b=c.node||(a.getTreeNode?a.getTreeNode(c,g,"append",j):null);
return this.processDrop(g,c,"append",a,j,b)
}return false
},processDrop:function(n,k,b,a,m,g){var j={tree:this.tree,target:n,data:k,point:b,source:a,rawEvent:m,dropNode:g,cancel:!g,dropStatus:false};
var c=this.tree.fireEvent("beforenodedrop",j);
if(c===false||j.cancel===true||!j.dropNode){n.ui.endDrop();
return j.dropStatus
}n=j.target;
if(b=="append"&&!n.isExpanded()){n.expand(false,null,function(){this.completeDrop(j)
}.createDelegate(this))
}else{this.completeDrop(j)
}return true
},completeDrop:function(m){var g=m.dropNode,j=m.point,c=m.target;
if(!CQ.Ext.isArray(g)){g=[g]
}var k;
for(var b=0,a=g.length;
b<a;
b++){k=g[b];
if(j=="above"){c.parentNode.insertBefore(k,c)
}else{if(j=="below"){c.parentNode.insertBefore(k,c.nextSibling)
}else{c.appendChild(k)
}}}k.ui.focus();
if(CQ.Ext.enableFx&&this.tree.hlDrop){k.ui.highlight()
}c.ui.endDrop();
this.tree.fireEvent("nodedrop",m)
},afterNodeMoved:function(a,c,j,g,b){if(CQ.Ext.enableFx&&this.tree.hlDrop){b.ui.focus();
b.ui.highlight()
}this.tree.fireEvent("nodedrop",this.tree,g,c,a,j)
},getTree:function(){return this.tree
},removeDropIndicators:function(b){if(b&&b.ddel){var a=b.ddel;
CQ.Ext.fly(a).removeClass(["x-tree-drag-insert-above","x-tree-drag-insert-below","x-tree-drag-append"]);
this.lastInsertClass="_noclass"
}},beforeDragDrop:function(b,a,c){this.cancelExpand();
return true
},afterRepair:function(a){if(a&&CQ.Ext.enableFx){a.node.ui.highlight()
}this.hideProxy()
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
}if(CQ.Ext.dd.DragZone){CQ.Ext.tree.TreeDragZone=function(a,b){CQ.Ext.tree.TreeDragZone.superclass.constructor.call(this,a.innerCt,b);
this.tree=a
};
CQ.Ext.extend(CQ.Ext.tree.TreeDragZone,CQ.Ext.dd.DragZone,{ddGroup:"TreeDD",onBeforeDrag:function(a,b){var c=a.node;
return c&&c.draggable&&!c.disabled
},onInitDrag:function(b){var a=this.dragData;
this.tree.getSelectionModel().select(a.node);
this.tree.eventModel.disable();
this.proxy.update("");
a.node.ui.appendDDGhost(this.proxy.ghost.dom);
this.tree.fireEvent("startdrag",this.tree,a.node,b)
},getRepairXY:function(b,a){return a.node.ui.getDDRepairXY()
},onEndDrag:function(a,b){this.tree.eventModel.enable.defer(100,this.tree.eventModel);
this.tree.fireEvent("enddrag",this.tree,a.node,b)
},onValidDrop:function(a,b,c){this.tree.fireEvent("dragdrop",this.tree,this.dragData.node,a,b);
this.hideProxy()
},beforeInvalidDrop:function(a,c){var b=this.tree.getSelectionModel();
b.clearSelections();
b.select(this.dragData.node)
},afterRepair:function(){if(CQ.Ext.enableFx&&this.tree.hlDrop){CQ.Ext.Element.fly(this.dragData.ddel).highlight(this.hlColor||"c3daf9")
}this.dragging=false
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
}CQ.Ext.tree.TreeEditor=function(a,c,b){c=c||{};
var g=c.events?c:new CQ.Ext.form.TextField(c);
CQ.Ext.tree.TreeEditor.superclass.constructor.call(this,g,b);
this.tree=a;
if(!a.rendered){a.on("render",this.initEditor,this)
}else{this.initEditor(a)
}};
CQ.Ext.extend(CQ.Ext.tree.TreeEditor,CQ.Ext.Editor,{alignment:"l-l",autoSize:false,hideEl:false,cls:"x-small-editor x-tree-editor",shim:false,shadow:"frame",maxWidth:250,editDelay:350,initEditor:function(a){a.on({scope:this,beforeclick:this.beforeNodeClick,dblclick:this.onNodeDblClick});
this.on({scope:this,complete:this.updateNode,beforestartedit:this.fitToTree,specialkey:this.onSpecialKey});
this.on("startedit",this.bindScroll,this,{delay:10})
},fitToTree:function(b,c){var j=this.tree.getTreeEl().dom,g=c.dom;
if(j.scrollLeft>g.offsetLeft){j.scrollLeft=g.offsetLeft
}var a=Math.min(this.maxWidth,(j.clientWidth>20?j.clientWidth:j.offsetWidth)-Math.max(0,g.offsetLeft-j.scrollLeft)-5);
this.setSize(a,"")
},triggerEdit:function(a,c){this.completeEdit();
if(a.attributes.editable!==false){this.editNode=a;
if(this.tree.autoScroll){CQ.Ext.fly(a.ui.getEl()).scrollIntoView(this.tree.body)
}var b=a.text||"";
if(!CQ.Ext.isGecko&&CQ.Ext.isEmpty(a.text)){a.setText("&#160;")
}this.autoEditTimer=this.startEdit.defer(this.editDelay,this,[a.ui.textNode,b]);
return false
}},bindScroll:function(){this.tree.getTreeEl().on("scroll",this.cancelEdit,this)
},beforeNodeClick:function(a,b){clearTimeout(this.autoEditTimer);
if(this.tree.getSelectionModel().isSelected(a)){b.stopEvent();
return this.triggerEdit(a)
}},onNodeDblClick:function(a,b){clearTimeout(this.autoEditTimer)
},updateNode:function(a,b){this.tree.getTreeEl().un("scroll",this.cancelEdit,this);
this.editNode.setText(b)
},onHide:function(){CQ.Ext.tree.TreeEditor.superclass.onHide.call(this);
if(this.editNode){this.editNode.ui.focus.defer(50,this.editNode.ui)
}},onSpecialKey:function(c,b){var a=b.getKey();
if(a==b.ESC){b.stopEvent();
this.cancelEdit()
}else{if(a==b.ENTER&&!b.hasModifier()){b.stopEvent();
this.completeEdit()
}}},onDestroy:function(){clearTimeout(this.autoEditTimer);
CQ.Ext.tree.TreeEditor.superclass.onDestroy.call(this);
var a=this.tree;
a.un("beforeclick",this.beforeNodeClick,this);
a.un("dblclick",this.onNodeDblClick,this)
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.FlashComponent=CQ.Ext.extend(CQ.Ext.BoxComponent,{flashVersion:"9.0.115",backgroundColor:"#ffffff",wmode:"opaque",flashVars:undefined,flashParams:undefined,url:undefined,swfId:undefined,swfWidth:"100%",swfHeight:"100%",expressInstall:false,initComponent:function(){CQ.Ext.FlashComponent.superclass.initComponent.call(this);
this.addEvents("initialize")
},onRender:function(){CQ.Ext.FlashComponent.superclass.onRender.apply(this,arguments);
var b=CQ.Ext.apply({allowScriptAccess:"always",bgcolor:this.backgroundColor,wmode:this.wmode},this.flashParams),a=CQ.Ext.apply({allowedDomain:document.location.hostname,YUISwfId:this.getId(),YUIBridgeCallback:"CQ.Ext.FlashEventProxy.onEvent"},this.flashVars);
new swfobject.embedSWF(this.url,this.id,this.swfWidth,this.swfHeight,this.flashVersion,this.expressInstall?CQ.Ext.FlashComponent.EXPRESS_INSTALL_URL:undefined,a,b);
this.swf=CQ.Ext.getDom(this.id);
this.el=CQ.Ext.get(this.swf)
},getSwfId:function(){return this.swfId||(this.swfId="extswf"+(++CQ.Ext.Component.AUTO_ID))
},getId:function(){return this.id||(this.id="extflashcmp"+(++CQ.Ext.Component.AUTO_ID))
},onFlashEvent:function(a){switch(a.type){case"swfReady":this.initSwf();
return;
case"log":return
}a.component=this;
this.fireEvent(a.type.toLowerCase().replace(/event$/,""),a)
},initSwf:function(){this.onSwfReady(!!this.isInitialized);
this.isInitialized=true;
this.fireEvent("initialize",this)
},beforeDestroy:function(){if(this.rendered){swfobject.removeSWF(this.swf.id)
}CQ.Ext.FlashComponent.superclass.beforeDestroy.call(this)
},onSwfReady:CQ.Ext.emptyFn});
CQ.Ext.FlashComponent.EXPRESS_INSTALL_URL="http://swfobject.googlecode.com/svn/trunk/swfobject/expressInstall.swf";
CQ.Ext.reg("flash",CQ.Ext.FlashComponent);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.FlashEventProxy={onEvent:function(c,b){var a=CQ.Ext.getCmp(c);
if(a){a.onFlashEvent(b)
}else{arguments.callee.defer(10,this,[c,b])
}}};
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.chart.Chart=CQ.Ext.extend(CQ.Ext.FlashComponent,{refreshBuffer:100,chartStyle:{padding:10,animationEnabled:true,font:{name:"Tahoma",color:4473924,size:11},dataTip:{padding:5,border:{color:6710886,size:1},background:{color:14606046,alpha:0.9},font:{name:"Tahoma",color:1393291,size:10,bold:true}}},extraStyle:null,seriesStyles:null,disableCaching:CQ.Ext.isIE||CQ.Ext.isOpera,disableCacheParam:"_dc",initComponent:function(){CQ.Ext.chart.Chart.superclass.initComponent.call(this);
if(!this.url){this.url=CQ.Ext.chart.Chart.CHART_URL
}if(this.disableCaching){this.url=CQ.Ext.urlAppend(this.url,String.format("{0}={1}",this.disableCacheParam,new Date().getTime()))
}this.addEvents("itemmouseover","itemmouseout","itemclick","itemdoubleclick","itemdragstart","itemdrag","itemdragend","beforerefresh","refresh");
this.store=CQ.Ext.StoreMgr.lookup(this.store)
},setStyle:function(a,b){this.swf.setStyle(a,CQ.Ext.encode(b))
},setStyles:function(a){this.swf.setStyles(CQ.Ext.encode(a))
},setSeriesStyles:function(b){this.seriesStyles=b;
var a=[];
CQ.Ext.each(b,function(c){a.push(CQ.Ext.encode(c))
});
this.swf.setSeriesStyles(a)
},setCategoryNames:function(a){this.swf.setCategoryNames(a)
},setLegendRenderer:function(c,b){var a=this;
b=b||a;
a.removeFnProxy(a.legendFnName);
a.legendFnName=a.createFnProxy(function(g){return c.call(b,g)
});
a.swf.setLegendLabelFunction(a.legendFnName)
},setTipRenderer:function(c,b){var a=this;
b=b||a;
a.removeFnProxy(a.tipFnName);
a.tipFnName=a.createFnProxy(function(m,j,k){var g=a.store.getAt(j);
return c.call(b,a,g,j,k)
});
a.swf.setDataTipFunction(a.tipFnName)
},setSeries:function(a){this.series=a;
this.refresh()
},bindStore:function(a,b){if(!b&&this.store){if(a!==this.store&&this.store.autoDestroy){this.store.destroy()
}else{this.store.un("datachanged",this.refresh,this);
this.store.un("add",this.delayRefresh,this);
this.store.un("remove",this.delayRefresh,this);
this.store.un("update",this.delayRefresh,this);
this.store.un("clear",this.refresh,this)
}}if(a){a=CQ.Ext.StoreMgr.lookup(a);
a.on({scope:this,datachanged:this.refresh,add:this.delayRefresh,remove:this.delayRefresh,update:this.delayRefresh,clear:this.refresh})
}this.store=a;
if(a&&!b){this.refresh()
}},onSwfReady:function(b){CQ.Ext.chart.Chart.superclass.onSwfReady.call(this,b);
var a;
this.swf.setType(this.type);
if(this.chartStyle){this.setStyles(CQ.Ext.apply({},this.extraStyle,this.chartStyle))
}if(this.categoryNames){this.setCategoryNames(this.categoryNames)
}if(this.tipRenderer){a=this.getFunctionRef(this.tipRenderer);
this.setTipRenderer(a.fn,a.scope)
}if(this.legendRenderer){a=this.getFunctionRef(this.legendRenderer);
this.setLegendRenderer(a.fn,a.scope)
}if(!b){this.bindStore(this.store,true)
}this.refresh.defer(10,this)
},delayRefresh:function(){if(!this.refreshTask){this.refreshTask=new CQ.Ext.util.DelayedTask(this.refresh,this)
}this.refreshTask.delay(this.refreshBuffer)
},refresh:function(){if(this.fireEvent("beforerefresh",this)!==false){var r=false;
var o=[],c=this.store.data.items;
for(var m=0,q=c.length;
m<q;
m++){o[m]=c[m].data
}var k=[];
var g=0;
var t=null;
var n=0;
if(this.series){g=this.series.length;
for(n=0;
n<g;
n++){t=this.series[n];
var b={};
for(var a in t){if(a=="style"&&t.style!==null){b.style=CQ.Ext.encode(t.style);
r=true
}else{b[a]=t[a]
}}k.push(b)
}}if(g>0){for(n=0;
n<g;
n++){t=k[n];
if(!t.type){t.type=this.type
}t.dataProvider=o
}}else{k.push({type:this.type,dataProvider:o})
}this.swf.setDataProvider(k);
if(this.seriesStyles){this.setSeriesStyles(this.seriesStyles)
}this.fireEvent("refresh",this)
}},createFnProxy:function(a){var b="extFnProxy"+(++CQ.Ext.chart.Chart.PROXY_FN_ID);
CQ.Ext.chart.Chart.proxyFunction[b]=a;
return"CQ.Ext.chart.Chart.proxyFunction."+b
},removeFnProxy:function(a){if(!CQ.Ext.isEmpty(a)){a=a.replace("CQ.Ext.chart.Chart.proxyFunction.","");
delete CQ.Ext.chart.Chart.proxyFunction[a]
}},getFunctionRef:function(a){if(CQ.Ext.isFunction(a)){return{fn:a,scope:this}
}else{return{fn:a.fn,scope:a.scope||this}
}},onDestroy:function(){if(this.refreshTask&&this.refreshTask.cancel){this.refreshTask.cancel()
}CQ.Ext.chart.Chart.superclass.onDestroy.call(this);
this.bindStore(null);
this.removeFnProxy(this.tipFnName);
this.removeFnProxy(this.legendFnName)
}});
CQ.Ext.reg("chart",CQ.Ext.chart.Chart);
CQ.Ext.chart.Chart.PROXY_FN_ID=0;
CQ.Ext.chart.Chart.proxyFunction={};
CQ.Ext.chart.Chart.CHART_URL="http://yui.yahooapis.com/2.8.2/build/charts/assets/charts.swf";
CQ.Ext.chart.PieChart=CQ.Ext.extend(CQ.Ext.chart.Chart,{type:"pie",onSwfReady:function(a){CQ.Ext.chart.PieChart.superclass.onSwfReady.call(this,a);
this.setDataField(this.dataField);
this.setCategoryField(this.categoryField)
},setDataField:function(a){this.dataField=a;
this.swf.setDataField(a)
},setCategoryField:function(a){this.categoryField=a;
this.swf.setCategoryField(a)
}});
CQ.Ext.reg("piechart",CQ.Ext.chart.PieChart);
CQ.Ext.chart.CartesianChart=CQ.Ext.extend(CQ.Ext.chart.Chart,{onSwfReady:function(a){CQ.Ext.chart.CartesianChart.superclass.onSwfReady.call(this,a);
this.labelFn=[];
if(this.xField){this.setXField(this.xField)
}if(this.yField){this.setYField(this.yField)
}if(this.xAxis){this.setXAxis(this.xAxis)
}if(this.xAxes){this.setXAxes(this.xAxes)
}if(this.yAxis){this.setYAxis(this.yAxis)
}if(this.yAxes){this.setYAxes(this.yAxes)
}if(CQ.Ext.isDefined(this.constrainViewport)){this.swf.setConstrainViewport(this.constrainViewport)
}},setXField:function(a){this.xField=a;
this.swf.setHorizontalField(a)
},setYField:function(a){this.yField=a;
this.swf.setVerticalField(a)
},setXAxis:function(a){this.xAxis=this.createAxis("xAxis",a);
this.swf.setHorizontalAxis(this.xAxis)
},setXAxes:function(c){var b;
for(var a=0;
a<c.length;
a++){b=this.createAxis("xAxis"+a,c[a]);
this.swf.setHorizontalAxis(b)
}},setYAxis:function(a){this.yAxis=this.createAxis("yAxis",a);
this.swf.setVerticalAxis(this.yAxis)
},setYAxes:function(c){var b;
for(var a=0;
a<c.length;
a++){b=this.createAxis("yAxis"+a,c[a]);
this.swf.setVerticalAxis(b)
}},createAxis:function(b,g){var j=CQ.Ext.apply({},g),c,a;
if(this[b]){a=this[b].labelFunction;
this.removeFnProxy(a);
this.labelFn.remove(a)
}if(j.labelRenderer){c=this.getFunctionRef(j.labelRenderer);
j.labelFunction=this.createFnProxy(function(k){return c.fn.call(c.scope,k)
});
delete j.labelRenderer;
this.labelFn.push(j.labelFunction)
}if(b.indexOf("xAxis")>-1&&j.position=="left"){j.position="bottom"
}return j
},onDestroy:function(){CQ.Ext.chart.CartesianChart.superclass.onDestroy.call(this);
CQ.Ext.each(this.labelFn,function(a){this.removeFnProxy(a)
},this)
}});
CQ.Ext.reg("cartesianchart",CQ.Ext.chart.CartesianChart);
CQ.Ext.chart.LineChart=CQ.Ext.extend(CQ.Ext.chart.CartesianChart,{type:"line"});
CQ.Ext.reg("linechart",CQ.Ext.chart.LineChart);
CQ.Ext.chart.ColumnChart=CQ.Ext.extend(CQ.Ext.chart.CartesianChart,{type:"column"});
CQ.Ext.reg("columnchart",CQ.Ext.chart.ColumnChart);
CQ.Ext.chart.StackedColumnChart=CQ.Ext.extend(CQ.Ext.chart.CartesianChart,{type:"stackcolumn"});
CQ.Ext.reg("stackedcolumnchart",CQ.Ext.chart.StackedColumnChart);
CQ.Ext.chart.BarChart=CQ.Ext.extend(CQ.Ext.chart.CartesianChart,{type:"bar"});
CQ.Ext.reg("barchart",CQ.Ext.chart.BarChart);
CQ.Ext.chart.StackedBarChart=CQ.Ext.extend(CQ.Ext.chart.CartesianChart,{type:"stackbar"});
CQ.Ext.reg("stackedbarchart",CQ.Ext.chart.StackedBarChart);
CQ.Ext.chart.Axis=function(a){CQ.Ext.apply(this,a)
};
CQ.Ext.chart.Axis.prototype={type:null,orientation:"horizontal",reverse:false,labelFunction:null,hideOverlappingLabels:true,labelSpacing:2};
CQ.Ext.chart.NumericAxis=CQ.Ext.extend(CQ.Ext.chart.Axis,{type:"numeric",minimum:NaN,maximum:NaN,majorUnit:NaN,minorUnit:NaN,snapToUnits:true,alwaysShowZero:true,scale:"linear",roundMajorUnit:true,calculateByLabelSize:true,position:"left",adjustMaximumByMajorUnit:true,adjustMinimumByMajorUnit:true});
CQ.Ext.chart.TimeAxis=CQ.Ext.extend(CQ.Ext.chart.Axis,{type:"time",minimum:null,maximum:null,majorUnit:NaN,majorTimeUnit:null,minorUnit:NaN,minorTimeUnit:null,snapToUnits:true,stackingEnabled:false,calculateByLabelSize:true});
CQ.Ext.chart.CategoryAxis=CQ.Ext.extend(CQ.Ext.chart.Axis,{type:"category",categoryNames:null,calculateCategoryCount:false});
CQ.Ext.chart.Series=function(a){CQ.Ext.apply(this,a)
};
CQ.Ext.chart.Series.prototype={type:null,displayName:null};
CQ.Ext.chart.CartesianSeries=CQ.Ext.extend(CQ.Ext.chart.Series,{xField:null,yField:null,showInLegend:true,axis:"primary"});
CQ.Ext.chart.ColumnSeries=CQ.Ext.extend(CQ.Ext.chart.CartesianSeries,{type:"column"});
CQ.Ext.chart.LineSeries=CQ.Ext.extend(CQ.Ext.chart.CartesianSeries,{type:"line"});
CQ.Ext.chart.BarSeries=CQ.Ext.extend(CQ.Ext.chart.CartesianSeries,{type:"bar"});
CQ.Ext.chart.PieSeries=CQ.Ext.extend(CQ.Ext.chart.Series,{type:"pie",dataField:null,categoryField:null});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.menu.Menu=CQ.Ext.extend(CQ.Ext.Container,{minWidth:120,shadow:"sides",subMenuAlign:"tl-tr?",defaultAlign:"tl-bl?",allowOtherMenus:false,ignoreParentClicks:false,enableScrolling:true,maxHeight:null,scrollIncrement:24,showSeparator:true,defaultOffsets:[0,0],plain:false,floating:true,zIndex:15000,hidden:true,layout:"menu",hideMode:"offsets",scrollerHeight:8,autoLayout:true,defaultType:"menuitem",bufferResize:false,initComponent:function(){if(CQ.Ext.isArray(this.initialConfig)){CQ.Ext.apply(this,{items:this.initialConfig})
}this.addEvents("click","mouseover","mouseout","itemclick");
CQ.Ext.menu.MenuMgr.register(this);
if(this.floating){CQ.Ext.EventManager.onWindowResize(this.hide,this)
}else{if(this.initialConfig.hidden!==false){this.hidden=false
}this.internalDefaults={hideOnClick:false}
}CQ.Ext.menu.Menu.superclass.initComponent.call(this);
if(this.autoLayout){var a=this.doLayout.createDelegate(this,[]);
this.on({add:a,remove:a})
}},getLayoutTarget:function(){return this.ul
},onRender:function(b,a){if(!b){b=CQ.Util.getRoot()
}var c={id:this.getId(),cls:"x-menu "+((this.floating)?"x-menu-floating x-layer ":"")+(this.cls||"")+(this.plain?" x-menu-plain":"")+(this.showSeparator?"":" x-menu-nosep"),style:this.style,cn:[{tag:"a",cls:"x-menu-focus",href:"#",onclick:"return false;",tabIndex:"-1"},{tag:"ul",cls:"x-menu-list"}]};
if(this.floating){this.el=new CQ.Ext.Layer({shadow:this.shadow,dh:c,constrain:false,parentEl:b,zindex:this.zIndex})
}else{this.el=b.createChild(c)
}CQ.Ext.menu.Menu.superclass.onRender.call(this,b,a);
if(!this.keyNav){this.keyNav=new CQ.Ext.menu.MenuNav(this)
}this.focusEl=this.el.child("a.x-menu-focus");
this.ul=this.el.child("ul.x-menu-list");
this.mon(this.ul,{scope:this,click:this.onClick,mouseover:this.onMouseOver,mouseout:this.onMouseOut});
if(this.enableScrolling){this.mon(this.el,{scope:this,delegate:".x-menu-scroller",click:this.onScroll,mouseover:this.deactivateActive})
}},findTargetItem:function(b){var a=b.getTarget(".x-menu-list-item",this.ul,true);
if(a&&a.menuItemId){return this.items.get(a.menuItemId)
}},onClick:function(b){var a=this.findTargetItem(b);
if(a){if(a.isFormField){this.setActiveItem(a)
}else{if(a instanceof CQ.Ext.menu.BaseItem){if(a.menu&&this.ignoreParentClicks){a.expandMenu();
b.preventDefault()
}else{if(a.onClick){a.onClick(b);
this.fireEvent("click",this,a,b)
}}}}}},setActiveItem:function(a,b){if(a!=this.activeItem){this.deactivateActive();
if((this.activeItem=a).isFormField){a.focus()
}else{a.activate(b)
}}else{if(b){a.expandMenu()
}}},deactivateActive:function(){var b=this.activeItem;
if(b){if(b.isFormField){if(b.collapse){b.collapse()
}}else{b.deactivate()
}delete this.activeItem
}},tryActivate:function(k,j){var b=this.items;
for(var c=k,a=b.length;
c>=0&&c<a;
c+=j){var g=b.get(c);
if(g.isVisible()&&!g.disabled&&(g.canActivate||g.isFormField)){this.setActiveItem(g,false);
return g
}}return false
},onMouseOver:function(b){var a=this.findTargetItem(b);
if(a){if(a.canActivate&&!a.disabled){this.setActiveItem(a,true)
}}this.over=true;
this.fireEvent("mouseover",this,b,a)
},onMouseOut:function(b){var a=this.findTargetItem(b);
if(a){if(a==this.activeItem&&a.shouldDeactivate&&a.shouldDeactivate(b)){this.activeItem.deactivate();
delete this.activeItem
}}this.over=false;
this.fireEvent("mouseout",this,b,a)
},onScroll:function(g,b){if(g){g.stopEvent()
}var a=this.ul.dom,c=CQ.Ext.fly(b).is(".x-menu-scroller-top");
a.scrollTop+=this.scrollIncrement*(c?-1:1);
if(c?a.scrollTop<=0:a.scrollTop+this.activeMax>=a.scrollHeight){this.onScrollerOut(null,b)
}},onScrollerIn:function(g,b){var a=this.ul.dom,c=CQ.Ext.fly(b).is(".x-menu-scroller-top");
if(c?a.scrollTop>0:a.scrollTop+this.activeMax<a.scrollHeight){CQ.Ext.fly(b).addClass(["x-menu-item-active","x-menu-scroller-active"])
}},onScrollerOut:function(b,a){CQ.Ext.fly(a).removeClass(["x-menu-item-active","x-menu-scroller-active"])
},show:function(b,c,a){if(this.floating){this.parentMenu=a;
if(!this.el){this.render();
this.doLayout(false,true)
}this.showAt(this.el.getAlignToXY(b,c||this.defaultAlign,this.defaultOffsets),a)
}else{CQ.Ext.menu.Menu.superclass.show.call(this)
}},showAt:function(b,a){if(this.fireEvent("beforeshow",this)!==false){this.parentMenu=a;
if(!this.el){this.render()
}if(this.enableScrolling){this.el.setXY(b);
b[1]=this.constrainScroll(b[1]);
b=[this.el.adjustForConstraints(b)[0],b[1]]
}else{b=this.el.adjustForConstraints(b)
}this.el.setXY(b);
this.el.show();
CQ.Ext.menu.Menu.superclass.onShow.call(this);
if(CQ.Ext.isIE){this.fireEvent("autosize",this);
if(!CQ.Ext.isIE8){this.el.repaint()
}}this.hidden=false;
this.focus();
this.fireEvent("show",this)
}},constrainScroll:function(n){var b,g=this.ul.setHeight("auto").getHeight(),a=n,m,j,k,c;
if(this.floating){j=CQ.Ext.fly(this.el.dom.parentNode);
k=j.getScroll().top;
c=j.getViewSize().height;
m=n-k;
b=this.maxHeight?this.maxHeight:c-m;
if(g>c){b=c;
a=n-m
}else{if(b<g){a=n-(g-b);
b=g
}}}else{b=this.getHeight()
}if(this.maxHeight){b=Math.min(this.maxHeight,b)
}if(g>b&&b>0){this.activeMax=b-this.scrollerHeight*2-this.el.getFrameWidth("tb")-CQ.Ext.num(this.el.shadowOffset,0);
this.ul.setHeight(this.activeMax);
this.createScrollers();
this.el.select(".x-menu-scroller").setDisplayed("")
}else{this.ul.setHeight(g);
this.el.select(".x-menu-scroller").setDisplayed("none")
}this.ul.dom.scrollTop=0;
return a
},createScrollers:function(){if(!this.scroller){this.scroller={pos:0,top:this.el.insertFirst({tag:"div",cls:"x-menu-scroller x-menu-scroller-top",html:"&#160;"}),bottom:this.el.createChild({tag:"div",cls:"x-menu-scroller x-menu-scroller-bottom",html:"&#160;"})};
this.scroller.top.hover(this.onScrollerIn,this.onScrollerOut,this);
this.scroller.topRepeater=new CQ.Ext.util.ClickRepeater(this.scroller.top,{listeners:{click:this.onScroll.createDelegate(this,[null,this.scroller.top],false)}});
this.scroller.bottom.hover(this.onScrollerIn,this.onScrollerOut,this);
this.scroller.bottomRepeater=new CQ.Ext.util.ClickRepeater(this.scroller.bottom,{listeners:{click:this.onScroll.createDelegate(this,[null,this.scroller.bottom],false)}})
}},onLayout:function(){if(this.isVisible()){if(this.enableScrolling){this.constrainScroll(this.el.getTop())
}if(this.floating){this.el.sync()
}}},focus:function(){if(!this.hidden){this.doFocus.defer(50,this)
}},doFocus:function(){if(!this.hidden){this.focusEl.focus()
}},hide:function(a){if(!this.isDestroyed){this.deepHide=a;
CQ.Ext.menu.Menu.superclass.hide.call(this);
delete this.deepHide
}},onHide:function(){CQ.Ext.menu.Menu.superclass.onHide.call(this);
this.deactivateActive();
if(this.el&&this.floating){this.el.hide()
}var a=this.parentMenu;
if(this.deepHide===true&&a){if(a.floating){a.hide(true)
}else{a.deactivateActive()
}}},lookupComponent:function(a){if(CQ.Ext.isString(a)){a=(a=="separator"||a=="-")?new CQ.Ext.menu.Separator():new CQ.Ext.menu.TextItem(a);
this.applyDefaults(a)
}else{if(CQ.Ext.isObject(a)){a=this.getMenuItem(a)
}else{if(a.tagName||a.el){a=new CQ.Ext.BoxComponent({el:a})
}}}return a
},applyDefaults:function(b){if(!CQ.Ext.isString(b)){b=CQ.Ext.menu.Menu.superclass.applyDefaults.call(this,b);
var a=this.internalDefaults;
if(a){if(b.events){CQ.Ext.applyIf(b.initialConfig,a);
CQ.Ext.apply(b,a)
}else{CQ.Ext.applyIf(b,a)
}}}return b
},getMenuItem:function(a){a.ownerCt=this;
if(!a.isXType){if(!a.xtype&&CQ.Ext.isBoolean(a.checked)){return new CQ.Ext.menu.CheckItem(a)
}return CQ.Ext.create(a,this.defaultType)
}return a
},addSeparator:function(){return this.add(new CQ.Ext.menu.Separator())
},addElement:function(a){return this.add(new CQ.Ext.menu.BaseItem({el:a}))
},addItem:function(a){return this.add(a)
},addMenuItem:function(a){return this.add(this.getMenuItem(a))
},addText:function(a){return this.add(new CQ.Ext.menu.TextItem(a))
},onDestroy:function(){CQ.Ext.EventManager.removeResizeListener(this.hide,this);
var a=this.parentMenu;
if(a&&a.activeChild==this){delete a.activeChild
}delete this.parentMenu;
CQ.Ext.menu.Menu.superclass.onDestroy.call(this);
CQ.Ext.menu.MenuMgr.unregister(this);
if(this.keyNav){this.keyNav.disable()
}var b=this.scroller;
if(b){CQ.Ext.destroy(b.topRepeater,b.bottomRepeater,b.top,b.bottom)
}CQ.Ext.destroy(this.el,this.focusEl,this.ul)
}});
CQ.Ext.reg("menu",CQ.Ext.menu.Menu);
CQ.Ext.menu.MenuNav=CQ.Ext.extend(CQ.Ext.KeyNav,function(){function a(g,c){if(!c.tryActivate(c.items.indexOf(c.activeItem)-1,-1)){c.tryActivate(c.items.length-1,-1)
}}function b(g,c){if(!c.tryActivate(c.items.indexOf(c.activeItem)+1,1)){c.tryActivate(0,1)
}}return{constructor:function(c){CQ.Ext.menu.MenuNav.superclass.constructor.call(this,c.el);
this.scope=this.menu=c
},doRelay:function(j,g){var c=j.getKey();
if(this.menu.activeItem&&this.menu.activeItem.isFormField&&c!=j.TAB){return false
}if(!this.menu.activeItem&&j.isNavKeyPress()&&c!=j.SPACE&&c!=j.RETURN){this.menu.tryActivate(0,1);
return false
}return g.call(this.scope||this,j,this.menu)
},tab:function(g,c){g.stopEvent();
if(g.shiftKey){a(g,c)
}else{b(g,c)
}},up:a,down:b,right:function(g,c){if(c.activeItem){c.activeItem.expandMenu(true)
}},left:function(g,c){c.hide();
if(c.parentMenu&&c.parentMenu.activeItem){c.parentMenu.activeItem.activate()
}},enter:function(g,c){if(c.activeItem){g.stopPropagation();
c.activeItem.onClick(g);
c.fireEvent("click",this,c.activeItem);
return true
}}}
}());
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.menu.MenuMgr=function(){var m,j,b,g={},a=false,r=new Date();
function u(){m={};
j=new CQ.Ext.util.MixedCollection();
b=CQ.Ext.getDoc().addKeyListener(27,o);
b.disable()
}function o(){if(j&&j.length>0){var v=j.clone();
v.each(function(w){w.hide()
});
return true
}return false
}function k(v){j.remove(v);
if(j.length<1){b.disable();
CQ.Ext.getDoc().un("mousedown",t);
a=false
}}function q(v){var w=j.last();
r=new Date();
j.add(v);
if(!a){b.enable();
CQ.Ext.getDoc().on("mousedown",t);
a=true
}if(v.parentMenu){v.getEl().setZIndex(parseInt(v.parentMenu.getEl().getStyle("z-index"),10)+3);
v.parentMenu.activeChild=v
}else{if(w&&!w.isDestroyed&&w.isVisible()){v.getEl().setZIndex(parseInt(w.getEl().getStyle("z-index"),10)+3)
}}}function c(v){if(v.activeChild){v.activeChild.hide()
}if(v.autoHideTimer){clearTimeout(v.autoHideTimer);
delete v.autoHideTimer
}}function n(v){var w=v.parentMenu;
if(!w&&!v.allowOtherMenus){o()
}else{if(w&&w.activeChild){w.activeChild.hide()
}}}function t(v){if(r.getElapsed()>50&&j.length>0&&!v.getTarget(".x-menu")){o()
}}return{hideAll:function(){return o()
},register:function(v){if(!m){u()
}m[v.id]=v;
v.on({beforehide:c,hide:k,beforeshow:n,show:q})
},get:function(v){if(typeof v=="string"){if(!m){return null
}return m[v]
}else{if(v.events){return v
}else{if(typeof v.length=="number"){return new CQ.Ext.menu.Menu({items:v})
}else{return CQ.Ext.create(v,"menu")
}}}},unregister:function(v){delete m[v.id];
v.un("beforehide",c);
v.un("hide",k);
v.un("beforeshow",n);
v.un("show",q)
},registerCheckable:function(v){var w=v.group;
if(w){if(!g[w]){g[w]=[]
}g[w].push(v)
}},unregisterCheckable:function(v){var w=v.group;
if(w){g[w].remove(v)
}},onCheckChange:function(x,y){if(x.group&&y){var A=g[x.group],w=0,v=A.length,z;
for(;
w<v;
w++){z=A[w];
if(z!=x){z.setChecked(false)
}}}},getCheckedItem:function(x){var y=g[x];
if(y){for(var w=0,v=y.length;
w<v;
w++){if(y[w].checked){return y[w]
}}}return null
},setCheckedItem:function(x,z){var y=g[x];
if(y){for(var w=0,v=y.length;
w<v;
w++){if(y[w].id==z){y[w].setChecked(true)
}}}return null
}}
}();
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.menu.BaseItem=CQ.Ext.extend(CQ.Ext.Component,{canActivate:false,activeClass:"x-menu-item-active",hideOnClick:true,clickHideDelay:1,ctype:"CQ.Ext.menu.BaseItem",actionMode:"container",initComponent:function(){CQ.Ext.menu.BaseItem.superclass.initComponent.call(this);
this.addEvents("click","activate","deactivate");
if(this.handler){this.on("click",this.handler,this.scope)
}},onRender:function(b,a){CQ.Ext.menu.BaseItem.superclass.onRender.apply(this,arguments);
if(this.ownerCt&&this.ownerCt instanceof CQ.Ext.menu.Menu){this.parentMenu=this.ownerCt
}else{this.container.addClass("x-menu-list-item");
this.mon(this.el,{scope:this,click:this.onClick,mouseenter:this.activate,mouseleave:this.deactivate})
}},setHandler:function(b,a){if(this.handler){this.un("click",this.handler,this.scope)
}this.on("click",this.handler=b,this.scope=a)
},onClick:function(a){if(!this.disabled&&this.fireEvent("click",this,a)!==false&&(this.parentMenu&&this.parentMenu.fireEvent("itemclick",this,a)!==false)){this.handleClick(a)
}else{a.stopEvent()
}},activate:function(){if(this.disabled){return false
}var a=this.container;
a.addClass(this.activeClass);
this.region=a.getRegion().adjust(2,2,-2,-2);
this.fireEvent("activate",this);
return true
},deactivate:function(){this.container.removeClass(this.activeClass);
this.fireEvent("deactivate",this)
},shouldDeactivate:function(a){return !this.region||!this.region.contains(a.getPoint())
},handleClick:function(b){var a=this.parentMenu;
if(this.hideOnClick){if(a.floating){this.clickHideDelayTimer=a.hide.defer(this.clickHideDelay,a,[true])
}else{a.deactivateActive()
}}},beforeDestroy:function(){clearTimeout(this.clickHideDelayTimer);
CQ.Ext.menu.BaseItem.superclass.beforeDestroy.call(this)
},expandMenu:CQ.Ext.emptyFn,hideMenu:CQ.Ext.emptyFn});
CQ.Ext.reg("menubaseitem",CQ.Ext.menu.BaseItem);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.menu.TextItem=CQ.Ext.extend(CQ.Ext.menu.BaseItem,{hideOnClick:false,itemCls:"x-menu-text",constructor:function(a){if(typeof a=="string"){a={text:a}
}CQ.Ext.menu.TextItem.superclass.constructor.call(this,a)
},onRender:function(){var a=document.createElement("span");
a.className=this.itemCls;
a.innerHTML=this.text;
this.el=a;
CQ.Ext.menu.TextItem.superclass.onRender.apply(this,arguments)
}});
CQ.Ext.reg("menutextitem",CQ.Ext.menu.TextItem);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.menu.Separator=CQ.Ext.extend(CQ.Ext.menu.BaseItem,{itemCls:"x-menu-sep",hideOnClick:false,activeClass:"",onRender:function(a){var b=document.createElement("span");
b.className=this.itemCls;
b.innerHTML="&#160;";
this.el=b;
a.addClass("x-menu-sep-li");
CQ.Ext.menu.Separator.superclass.onRender.apply(this,arguments)
}});
CQ.Ext.reg("menuseparator",CQ.Ext.menu.Separator);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.menu.Item=CQ.Ext.extend(CQ.Ext.menu.BaseItem,{itemCls:"x-menu-item",canActivate:true,showDelay:200,altText:"",hideDelay:200,ctype:"CQ.Ext.menu.Item",initComponent:function(){CQ.Ext.menu.Item.superclass.initComponent.call(this);
if(this.menu){if(CQ.Ext.isArray(this.menu)){this.menu={items:this.menu}
}if(CQ.Ext.isObject(this.menu)){this.menu.ownerCt=this
}this.menu=CQ.Ext.menu.MenuMgr.get(this.menu);
this.menu.ownerCt=undefined
}},onRender:function(g,b){if(!this.itemTpl){this.itemTpl=CQ.Ext.menu.Item.prototype.itemTpl=new CQ.Ext.XTemplate('<a id="{id}" class="{cls}" hidefocus="true" unselectable="on" href="{href}"','<tpl if="hrefTarget">',' target="{hrefTarget}"',"</tpl>",">",'<img alt="{altText}" src="{icon}" class="x-menu-item-icon {iconCls}"/>','<span class="x-menu-item-text">{text}</span>',"</a>")
}var c=this.getTemplateArgs();
this.el=b?this.itemTpl.insertBefore(b,c,true):this.itemTpl.append(g,c,true);
this.iconEl=this.el.child("img.x-menu-item-icon");
this.textEl=this.el.child(".x-menu-item-text");
if(!this.href){this.mon(this.el,"click",CQ.Ext.emptyFn,null,{preventDefault:true})
}CQ.Ext.menu.Item.superclass.onRender.call(this,g,b)
},getTemplateArgs:function(){return{id:this.id,cls:this.itemCls+(this.menu?" x-menu-item-arrow":"")+(this.cls?" "+this.cls:""),href:this.href||"#",hrefTarget:this.hrefTarget,icon:this.icon||CQ.Ext.BLANK_IMAGE_URL,iconCls:this.iconCls||"",text:this.itemText||this.text||"&#160;",altText:this.altText||""}
},setText:function(a){this.text=a||"&#160;";
if(this.rendered){this.textEl.update(this.text);
this.parentMenu.layout.doAutoSize()
}},setIconClass:function(a){var b=this.iconCls;
this.iconCls=a;
if(this.rendered){this.iconEl.replaceClass(b,this.iconCls)
}},beforeDestroy:function(){clearTimeout(this.showTimer);
clearTimeout(this.hideTimer);
if(this.menu){delete this.menu.ownerCt;
this.menu.destroy()
}CQ.Ext.menu.Item.superclass.beforeDestroy.call(this)
},handleClick:function(a){if(!this.href){a.stopEvent()
}CQ.Ext.menu.Item.superclass.handleClick.apply(this,arguments)
},activate:function(a){if(CQ.Ext.menu.Item.superclass.activate.apply(this,arguments)){this.focus();
if(a){this.expandMenu()
}}return true
},shouldDeactivate:function(a){if(CQ.Ext.menu.Item.superclass.shouldDeactivate.call(this,a)){if(this.menu&&this.menu.isVisible()){return !this.menu.getEl().getRegion().contains(a.getPoint())
}return true
}return false
},deactivate:function(){CQ.Ext.menu.Item.superclass.deactivate.apply(this,arguments);
this.hideMenu()
},expandMenu:function(a){if(!this.disabled&&this.menu){clearTimeout(this.hideTimer);
delete this.hideTimer;
if(!this.menu.isVisible()&&!this.showTimer){this.showTimer=this.deferExpand.defer(this.showDelay,this,[a])
}else{if(this.menu.isVisible()&&a){this.menu.tryActivate(0,1)
}}}},deferExpand:function(a){delete this.showTimer;
this.menu.show(this.container,this.parentMenu.subMenuAlign||"tl-tr?",this.parentMenu);
if(a){this.menu.tryActivate(0,1)
}},hideMenu:function(){clearTimeout(this.showTimer);
delete this.showTimer;
if(!this.hideTimer&&this.menu&&this.menu.isVisible()){this.hideTimer=this.deferHide.defer(this.hideDelay,this)
}},deferHide:function(){delete this.hideTimer;
if(this.menu.over){this.parentMenu.setActiveItem(this,false)
}else{this.menu.hide()
}}});
CQ.Ext.reg("menuitem",CQ.Ext.menu.Item);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.menu.CheckItem=CQ.Ext.extend(CQ.Ext.menu.Item,{itemCls:"x-menu-item x-menu-check-item",groupClass:"x-menu-group-item",checked:false,ctype:"CQ.Ext.menu.CheckItem",initComponent:function(){CQ.Ext.menu.CheckItem.superclass.initComponent.call(this);
this.addEvents("beforecheckchange","checkchange");
if(this.checkHandler){this.on("checkchange",this.checkHandler,this.scope)
}CQ.Ext.menu.MenuMgr.registerCheckable(this)
},onRender:function(a){CQ.Ext.menu.CheckItem.superclass.onRender.apply(this,arguments);
if(this.group){this.el.addClass(this.groupClass)
}if(this.checked){this.checked=false;
this.setChecked(true,true)
}},destroy:function(){CQ.Ext.menu.MenuMgr.unregisterCheckable(this);
CQ.Ext.menu.CheckItem.superclass.destroy.apply(this,arguments)
},setChecked:function(b,a){var c=a===true;
if(this.checked!=b&&(c||this.fireEvent("beforecheckchange",this,b)!==false)){CQ.Ext.menu.MenuMgr.onCheckChange(this,b);
if(this.container){this.container[b?"addClass":"removeClass"]("x-menu-item-checked")
}this.checked=b;
if(!c){this.fireEvent("checkchange",this,b)
}}},handleClick:function(a){if(!this.disabled&&!(this.checked&&this.group)){this.setChecked(!this.checked)
}CQ.Ext.menu.CheckItem.superclass.handleClick.apply(this,arguments)
}});
CQ.Ext.reg("menucheckitem",CQ.Ext.menu.CheckItem);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.menu.DateMenu=CQ.Ext.extend(CQ.Ext.menu.Menu,{enableScrolling:false,hideOnClick:true,pickerId:null,cls:"x-date-menu",initComponent:function(){this.on("beforeshow",this.onBeforeShow,this);
if(this.strict=(CQ.Ext.isIE7&&CQ.Ext.isStrict)){this.on("show",this.onShow,this,{single:true,delay:20})
}CQ.Ext.apply(this,{plain:true,showSeparator:false,items:this.picker=new CQ.Ext.DatePicker(CQ.Ext.applyIf({internalRender:this.strict||!CQ.Ext.isIE,ctCls:"x-menu-date-item",id:this.pickerId},this.initialConfig))});
this.picker.purgeListeners();
CQ.Ext.menu.DateMenu.superclass.initComponent.call(this);
if(CQ.Ext.isIE&&!(CQ.Ext.isIE6||CQ.Ext.isIE7||CQ.Ext.isIE8||CQ.Ext.isIE9)){this.autoWidth=true;
this.autoHeight=true
}this.relayEvents(this.picker,["select"]);
this.on("show",this.picker.focus,this.picker);
this.on("select",this.menuHide,this);
if(this.handler){this.on("select",this.handler,this.scope||this)
}},menuHide:function(){if(this.hideOnClick){this.hide(true)
}},onBeforeShow:function(){if(this.picker){this.picker.hideMonthPicker(true)
}},onShow:function(){var a=this.picker.getEl();
a.setWidth(a.getWidth())
}});
CQ.Ext.reg("datemenu",CQ.Ext.menu.DateMenu);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.menu.ColorMenu=CQ.Ext.extend(CQ.Ext.menu.Menu,{enableScrolling:false,hideOnClick:true,cls:"x-color-menu",paletteId:null,initComponent:function(){CQ.Ext.apply(this,{plain:true,showSeparator:false,items:this.palette=new CQ.Ext.ColorPalette(CQ.Ext.applyIf({id:this.paletteId},this.initialConfig))});
this.palette.purgeListeners();
CQ.Ext.menu.ColorMenu.superclass.initComponent.call(this);
this.relayEvents(this.palette,["select"]);
this.on("select",this.menuHide,this);
if(this.handler){this.on("select",this.handler,this.scope||this)
}},menuHide:function(){if(this.hideOnClick){this.hide(true)
}}});
CQ.Ext.reg("colormenu",CQ.Ext.menu.ColorMenu);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.form.Field=CQ.Ext.extend(CQ.Ext.BoxComponent,{invalidClass:"x-form-invalid",invalidText:"The value in this field is invalid",focusClass:"x-form-focus",validationEvent:"keyup",validateOnBlur:true,validationDelay:250,defaultAutoCreate:{tag:"input",type:"text",size:"20",autocomplete:"off"},fieldClass:"x-form-field",msgTarget:"qtip",msgFx:"normal",readOnly:false,disabled:false,submitValue:true,isFormField:true,msgDisplay:"",hasFocus:false,initComponent:function(){CQ.Ext.form.Field.superclass.initComponent.call(this);
this.addEvents("focus","blur","specialkey","change","invalid","valid")
},getName:function(){return this.rendered&&!this.isDestroyed&&this.el.dom.name?this.el.dom.name:this.name||this.id||""
},onRender:function(c,a){if(!this.el){var b=this.getAutoCreate();
if(!b.name){b.name=this.name||this.id
}if(this.inputType){b.type=this.inputType
}this.autoEl=b
}CQ.Ext.form.Field.superclass.onRender.call(this,c,a);
if(this.submitValue===false){this.el.dom.removeAttribute("name")
}var g=this.el.dom.type;
if(g){if(g=="password"){g="text"
}this.el.addClass("x-form-"+g)
}if(this.readOnly){this.setReadOnly(true)
}if(this.tabIndex!==undefined){this.el.dom.setAttribute("tabIndex",this.tabIndex)
}this.el.addClass([this.fieldClass,this.cls])
},getItemCt:function(){return this.itemCt
},initValue:function(){if(this.value!==undefined){this.setValue(this.value)
}else{if(!CQ.Ext.isEmpty(this.el.dom.value)&&this.el.dom.value!=this.emptyText){this.setValue(this.el.dom.value)
}}this.originalValue=this.getValue()
},isDirty:function(){if(this.disabled||!this.rendered){return false
}return String(this.getValue())!==String(this.originalValue)
},setReadOnly:function(a){if(this.rendered){this.el.dom.readOnly=a
}this.readOnly=a
},afterRender:function(){CQ.Ext.form.Field.superclass.afterRender.call(this);
this.initEvents();
this.initValue()
},fireKey:function(a){if(a.isSpecialKey()){this.fireEvent("specialkey",this,a)
}},reset:function(){this.setValue(this.originalValue);
this.clearInvalid()
},initEvents:function(){this.mon(this.el,CQ.Ext.EventManager.getKeyEvent(),this.fireKey,this);
this.mon(this.el,"focus",this.onFocus,this);
this.mon(this.el,"blur",this.onBlur,this,this.inEditor?{buffer:10}:null)
},preFocus:CQ.Ext.emptyFn,onFocus:function(){this.preFocus();
if(this.focusClass){this.el.addClass(this.focusClass)
}if(!this.hasFocus){this.hasFocus=true;
this.startValue=this.getValue();
this.fireEvent("focus",this)
}},beforeBlur:CQ.Ext.emptyFn,onBlur:function(){this.beforeBlur();
if(this.focusClass){this.el.removeClass(this.focusClass)
}this.hasFocus=false;
if(this.validationEvent!==false&&(this.validateOnBlur||this.validationEvent=="blur")){this.validate()
}var a=this.getValue();
if(String(a)!==String(this.startValue)){this.fireEvent("change",this,a,this.startValue)
}this.fireEvent("blur",this);
this.postBlur()
},postBlur:CQ.Ext.emptyFn,isValid:function(a){if(this.disabled){return true
}var c=this.preventMark;
this.preventMark=a===true;
var b=this.validateValue(this.processValue(this.getRawValue()),a);
this.preventMark=c;
return b
},validate:function(){if(this.disabled||this.validateValue(this.processValue(this.getRawValue()))){this.clearInvalid();
return true
}return false
},processValue:function(a){return a
},validateValue:function(b){var a=this.getErrors(b)[0];
if(a==undefined){return true
}else{this.markInvalid(a);
return false
}},getErrors:function(){return[]
},getActiveError:function(){return this.activeError||""
},markInvalid:function(c){if(this.rendered&&!this.preventMark){c=c||this.invalidText;
var a=this.getMessageHandler();
if(a){a.mark(this,c)
}else{if(this.msgTarget){this.el.addClass(this.invalidClass);
var b=CQ.Ext.getDom(this.msgTarget);
if(b){b.innerHTML=c;
b.style.display=this.msgDisplay
}}}}this.setActiveError(c)
},clearInvalid:function(){if(this.rendered&&!this.isDestroyed&&!this.preventMark){this.el.removeClass(this.invalidClass);
var a=this.getMessageHandler();
if(a){a.clear(this)
}else{if(this.msgTarget){this.el.removeClass(this.invalidClass);
var b=CQ.Ext.getDom(this.msgTarget);
if(b){b.innerHTML="";
b.style.display="none"
}}}}this.unsetActiveError()
},setActiveError:function(b,a){this.activeError=b;
if(a!==true){this.fireEvent("invalid",this,b)
}},unsetActiveError:function(a){delete this.activeError;
if(a!==true){this.fireEvent("valid",this)
}},getMessageHandler:function(){return CQ.Ext.form.MessageTargets[this.msgTarget]
},getErrorCt:function(){return this.el.findParent(".x-form-element",5,true)||this.el.findParent(".x-form-field-wrap",5,true)
},alignErrorEl:function(){this.errorEl.setWidth(this.getErrorCt().getWidth(true)-20)
},alignErrorIcon:function(){this.errorIcon.alignTo(this.el,"tl-tr",[2,0])
},getRawValue:function(){var a=(this.rendered&&!this.isDestroyed)?this.el.getValue():CQ.Ext.value(this.value,"");
if(a===this.emptyText){a=""
}return a
},getValue:function(){if(!this.rendered){return this.value
}var a=this.el.getValue();
if(a===this.emptyText||a===undefined){a=""
}return a
},setRawValue:function(a){return this.rendered?(this.el.dom.value=(CQ.Ext.isEmpty(a)?"":a)):""
},setValue:function(a){this.value=a;
if(this.rendered){this.el.dom.value=(CQ.Ext.isEmpty(a)?"":a);
this.validate()
}return this
},append:function(a){this.setValue([this.getValue(),a].join(""))
}});
CQ.Ext.form.MessageTargets={qtip:{mark:function(a,b){a.el.addClass(a.invalidClass);
a.el.dom.qtip=b;
a.el.dom.qclass="x-form-invalid-tip";
if(CQ.Ext.QuickTips){CQ.Ext.QuickTips.enable()
}},clear:function(a){a.el.removeClass(a.invalidClass);
a.el.dom.qtip=""
}},title:{mark:function(a,b){a.el.addClass(a.invalidClass);
a.el.dom.title=b
},clear:function(a){a.el.dom.title=""
}},under:{mark:function(b,c){b.el.addClass(b.invalidClass);
if(!b.errorEl){var a=b.getErrorCt();
if(!a){b.el.dom.title=c;
return
}b.errorEl=a.createChild({cls:"x-form-invalid-msg"});
b.on("resize",b.alignErrorEl,b);
b.on("destroy",function(){CQ.Ext.destroy(this.errorEl)
},b)
}b.alignErrorEl();
b.errorEl.update(c);
CQ.Ext.form.Field.msgFx[b.msgFx].show(b.errorEl,b)
},clear:function(a){a.el.removeClass(a.invalidClass);
if(a.errorEl){CQ.Ext.form.Field.msgFx[a.msgFx].hide(a.errorEl,a)
}else{a.el.dom.title=""
}}},side:{mark:function(b,c){b.el.addClass(b.invalidClass);
if(!b.errorIcon){var a=b.getErrorCt();
if(!a){b.el.dom.title=c;
return
}b.errorIcon=a.createChild({cls:"x-form-invalid-icon"});
if(b.ownerCt){b.ownerCt.on("afterlayout",b.alignErrorIcon,b);
b.ownerCt.on("expand",b.alignErrorIcon,b)
}b.on("resize",b.alignErrorIcon,b);
b.on("destroy",function(){CQ.Ext.destroy(this.errorIcon)
},b)
}b.alignErrorIcon();
b.errorIcon.dom.qtip=c;
b.errorIcon.dom.qclass="x-form-invalid-tip";
b.errorIcon.show()
},clear:function(a){a.el.removeClass(a.invalidClass);
if(a.errorIcon){a.errorIcon.dom.qtip="";
a.errorIcon.hide()
}else{a.el.dom.title=""
}}}};
CQ.Ext.form.Field.msgFx={normal:{show:function(a,b){a.setDisplayed("block")
},hide:function(a,b){a.setDisplayed(false).update("")
}},slide:{show:function(a,b){a.slideIn("t",{stopFx:true})
},hide:function(a,b){a.slideOut("t",{stopFx:true,useDisplay:true})
}},slideRight:{show:function(a,b){a.fixDisplay();
a.alignTo(b.el,"tl-tr");
a.slideIn("l",{stopFx:true})
},hide:function(a,b){a.slideOut("l",{stopFx:true,useDisplay:true})
}}};
CQ.Ext.reg("field",CQ.Ext.form.Field);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.form.TextField=CQ.Ext.extend(CQ.Ext.form.Field,{grow:false,growMin:30,growMax:800,vtype:null,maskRe:null,disableKeyFilter:false,allowBlank:true,minLength:0,maxLength:Number.MAX_VALUE,minLengthText:"The minimum length for this field is {0}",maxLengthText:"The maximum length for this field is {0}",selectOnFocus:false,blankText:"This field is required",validator:null,regex:null,regexText:"",emptyText:null,emptyClass:"x-form-empty-field",initComponent:function(){CQ.Ext.form.TextField.superclass.initComponent.call(this);
this.addEvents("autosize","keydown","keyup","keypress")
},initEvents:function(){CQ.Ext.form.TextField.superclass.initEvents.call(this);
if(this.validationEvent=="keyup"){this.validationTask=new CQ.Ext.util.DelayedTask(this.validate,this);
this.mon(this.el,"keyup",this.filterValidation,this)
}else{if(this.validationEvent!==false&&this.validationEvent!="blur"){this.mon(this.el,this.validationEvent,this.validate,this,{buffer:this.validationDelay})
}}if(this.selectOnFocus||this.emptyText){this.mon(this.el,"mousedown",this.onMouseDown,this);
if(this.emptyText){this.applyEmptyText()
}}if(this.maskRe||(this.vtype&&this.disableKeyFilter!==true&&(this.maskRe=CQ.Ext.form.VTypes[this.vtype+"Mask"]))){this.mon(this.el,"keypress",this.filterKeys,this)
}if(this.grow){this.mon(this.el,"keyup",this.onKeyUpBuffered,this,{buffer:50});
this.mon(this.el,"click",this.autoSize,this)
}if(this.enableKeyEvents){this.mon(this.el,{scope:this,keyup:this.onKeyUp,keydown:this.onKeyDown,keypress:this.onKeyPress})
}},onMouseDown:function(a){if(!this.hasFocus){this.mon(this.el,"mouseup",CQ.Ext.emptyFn,this,{single:true,preventDefault:true})
}},processValue:function(a){if(this.stripCharsRe){var b=a.replace(this.stripCharsRe,"");
if(b!==a){this.setRawValue(b);
return b
}}return a
},filterValidation:function(a){if(!a.isNavKeyPress()){this.validationTask.delay(this.validationDelay)
}},onDisable:function(){CQ.Ext.form.TextField.superclass.onDisable.call(this);
if(CQ.Ext.isIE){this.el.dom.unselectable="on"
}},onEnable:function(){CQ.Ext.form.TextField.superclass.onEnable.call(this);
if(CQ.Ext.isIE){this.el.dom.unselectable=""
}},onKeyUpBuffered:function(a){if(this.doAutoSize(a)){this.autoSize()
}},doAutoSize:function(a){return !a.isNavKeyPress()
},onKeyUp:function(a){this.fireEvent("keyup",this,a)
},onKeyDown:function(a){this.fireEvent("keydown",this,a)
},onKeyPress:function(a){this.fireEvent("keypress",this,a)
},reset:function(){CQ.Ext.form.TextField.superclass.reset.call(this);
this.applyEmptyText()
},applyEmptyText:function(){if(this.rendered&&this.emptyText&&this.getRawValue().length<1&&!this.hasFocus){this.setRawValue(this.emptyText);
this.el.addClass(this.emptyClass)
}},preFocus:function(){var a=this.el,b;
if(this.emptyText){if(a.dom.value==this.emptyText){this.setRawValue("");
b=true
}a.removeClass(this.emptyClass)
}if(this.selectOnFocus||b){a.dom.select()
}},postBlur:function(){this.applyEmptyText()
},filterKeys:function(b){if(b.ctrlKey){return
}var a=b.getKey();
if(CQ.Ext.isGecko&&(b.isNavKeyPress()||a==b.BACKSPACE||(a==b.DELETE&&b.button==-1))){return
}var c=String.fromCharCode(b.getCharCode());
if(!CQ.Ext.isGecko&&b.isSpecialKey()&&!c){return
}if(!this.maskRe.test(c)){b.stopEvent()
}},setValue:function(a){if(this.emptyText&&this.el&&!CQ.Ext.isEmpty(a)){this.el.removeClass(this.emptyClass)
}CQ.Ext.form.TextField.superclass.setValue.apply(this,arguments);
this.applyEmptyText();
this.autoSize();
return this
},getErrors:function(a){var g=CQ.Ext.form.TextField.superclass.getErrors.apply(this,arguments);
a=CQ.Ext.isDefined(a)?a:this.processValue(this.getRawValue());
if(CQ.Ext.isFunction(this.validator)){var c=this.validator(a);
if(c!==true){g.push(c)
}}if(a.length<1||a===this.emptyText){if(this.allowBlank){return g
}else{g.push(this.blankText)
}}if(!this.allowBlank&&(a.length<1||a===this.emptyText)){g.push(this.blankText)
}if(a.length<this.minLength){g.push(String.format(this.minLengthText,this.minLength))
}if(a.length>this.maxLength){g.push(String.format(this.maxLengthText,this.maxLength))
}if(this.vtype){var b=CQ.Ext.form.VTypes;
if(!b[this.vtype](a,this)){g.push(this.vtypeText||b[this.vtype+"Text"])
}}if(this.regex&&!this.regex.test(a)){g.push(this.regexText)
}return g
},selectText:function(k,a){var c=this.getRawValue();
var g=false;
if(c.length>0){k=k===undefined?0:k;
a=a===undefined?c.length:a;
var j=this.el.dom;
if(j.setSelectionRange){j.setSelectionRange(k,a)
}else{if(j.createTextRange){var b=j.createTextRange();
b.moveStart("character",k);
b.moveEnd("character",a-c.length);
b.select()
}}g=CQ.Ext.isGecko||CQ.Ext.isOpera
}else{g=true
}if(g){this.focus()
}},autoSize:function(){if(!this.grow||!this.rendered){return
}if(!this.metrics){this.metrics=CQ.Ext.util.TextMetrics.createInstance(this.el)
}var c=this.el;
var b=c.dom.value;
var g=document.createElement("div");
g.appendChild(document.createTextNode(b));
b=g.innerHTML;
CQ.Ext.removeNode(g);
g=null;
b+="&#160;";
var a=Math.min(this.growMax,Math.max(this.metrics.getWidth(b)+10,this.growMin));
this.el.setWidth(a);
this.fireEvent("autosize",this,a)
},onDestroy:function(){if(this.validationTask){this.validationTask.cancel();
this.validationTask=null
}CQ.Ext.form.TextField.superclass.onDestroy.call(this)
}});
CQ.Ext.reg("textfield",CQ.Ext.form.TextField);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.form.TriggerField=CQ.Ext.extend(CQ.Ext.form.TextField,{defaultAutoCreate:{tag:"input",type:"text",size:"16",autocomplete:"off"},hideTrigger:false,editable:true,readOnly:false,wrapFocusClass:"x-trigger-wrap-focus",autoSize:CQ.Ext.emptyFn,monitorTab:true,deferHeight:true,mimicing:false,actionMode:"wrap",defaultTriggerWidth:17,onResize:function(a,c){CQ.Ext.form.TriggerField.superclass.onResize.call(this,a,c);
var b=this.getTriggerWidth();
if(CQ.Ext.isNumber(a)){this.el.setWidth(a-b)
}this.wrap.setWidth(this.el.getWidth()+b)
},getTriggerWidth:function(){var a=this.trigger.getWidth();
if(!this.hideTrigger&&!this.readOnly&&a===0){a=this.defaultTriggerWidth
}return a
},alignErrorIcon:function(){if(this.wrap){this.errorIcon.alignTo(this.wrap,"tl-tr",[2,0])
}},onRender:function(b,a){this.doc=CQ.Ext.isIE?CQ.Ext.getBody():CQ.Ext.getDoc();
CQ.Ext.form.TriggerField.superclass.onRender.call(this,b,a);
this.wrap=this.el.wrap({cls:"x-form-field-wrap x-form-field-trigger-wrap"});
this.trigger=this.wrap.createChild(this.triggerConfig||{tag:"img",src:CQ.Ext.BLANK_IMAGE_URL,alt:"",cls:"x-form-trigger "+this.triggerClass});
this.initTrigger();
if(!this.width){this.wrap.setWidth(this.el.getWidth()+this.trigger.getWidth())
}this.resizeEl=this.positionEl=this.wrap
},getWidth:function(){return(this.el.getWidth()+this.trigger.getWidth())
},updateEditState:function(){if(this.rendered){if(this.readOnly){this.el.dom.readOnly=true;
this.el.addClass("x-trigger-noedit");
this.mun(this.el,"click",this.onTriggerClick,this);
this.trigger.setDisplayed(false)
}else{if(!this.editable){this.el.dom.readOnly=true;
this.el.addClass("x-trigger-noedit");
this.mon(this.el,"click",this.onTriggerClick,this)
}else{this.el.dom.readOnly=false;
this.el.removeClass("x-trigger-noedit");
this.mun(this.el,"click",this.onTriggerClick,this)
}this.trigger.setDisplayed(!this.hideTrigger)
}this.onResize(this.width||this.wrap.getWidth())
}},setHideTrigger:function(a){if(a!=this.hideTrigger){this.hideTrigger=a;
this.updateEditState()
}},setEditable:function(a){if(a!=this.editable){this.editable=a;
this.updateEditState()
}},setReadOnly:function(a){if(a!=this.readOnly){this.readOnly=a;
this.updateEditState()
}},afterRender:function(){CQ.Ext.form.TriggerField.superclass.afterRender.call(this);
this.updateEditState()
},initTrigger:function(){this.mon(this.trigger,"click",this.onTriggerClick,this,{preventDefault:true});
this.trigger.addClassOnOver("x-form-trigger-over");
this.trigger.addClassOnClick("x-form-trigger-click")
},onDestroy:function(){CQ.Ext.destroy(this.trigger,this.wrap);
if(this.mimicing){this.doc.un("mousedown",this.mimicBlur,this)
}delete this.doc;
CQ.Ext.form.TriggerField.superclass.onDestroy.call(this)
},onFocus:function(){CQ.Ext.form.TriggerField.superclass.onFocus.call(this);
if(!this.mimicing){this.wrap.addClass(this.wrapFocusClass);
this.mimicing=true;
this.doc.on("mousedown",this.mimicBlur,this,{delay:10});
if(this.monitorTab){this.on("specialkey",this.checkTab,this)
}}},checkTab:function(a,b){if(b.getKey()==b.TAB){this.triggerBlur()
}},onBlur:CQ.Ext.emptyFn,mimicBlur:function(a){if(!this.isDestroyed&&!this.wrap.contains(a.target)&&this.validateBlur(a)){this.triggerBlur()
}},triggerBlur:function(){this.mimicing=false;
this.doc.un("mousedown",this.mimicBlur,this);
if(this.monitorTab&&this.el){this.un("specialkey",this.checkTab,this)
}CQ.Ext.form.TriggerField.superclass.onBlur.call(this);
if(this.wrap){this.wrap.removeClass(this.wrapFocusClass)
}},beforeBlur:CQ.Ext.emptyFn,validateBlur:function(a){return true
},onTriggerClick:CQ.Ext.emptyFn});
CQ.Ext.form.TwinTriggerField=CQ.Ext.extend(CQ.Ext.form.TriggerField,{initComponent:function(){CQ.Ext.form.TwinTriggerField.superclass.initComponent.call(this);
this.triggerConfig={tag:"span",cls:"x-form-twin-triggers",cn:[{tag:"img",src:CQ.Ext.BLANK_IMAGE_URL,alt:"",cls:"x-form-trigger "+this.trigger1Class},{tag:"img",src:CQ.Ext.BLANK_IMAGE_URL,alt:"",cls:"x-form-trigger "+this.trigger2Class}]}
},getTrigger:function(a){return this.triggers[a]
},afterRender:function(){CQ.Ext.form.TwinTriggerField.superclass.afterRender.call(this);
var c=this.triggers,b=0,a=c.length;
for(;
b<a;
++b){if(this["hideTrigger"+(b+1)]){c[b].hide()
}}},initTrigger:function(){var a=this.trigger.select(".x-form-trigger",true),b=this;
a.each(function(g,k,c){var j="Trigger"+(c+1);
g.hide=function(){var m=b.wrap.getWidth();
this.dom.style.display="none";
b.el.setWidth(m-b.trigger.getWidth());
b["hidden"+j]=true
};
g.show=function(){var m=b.wrap.getWidth();
this.dom.style.display="";
b.el.setWidth(m-b.trigger.getWidth());
b["hidden"+j]=false
};
this.mon(g,"click",this["on"+j+"Click"],this,{preventDefault:true});
g.addClassOnOver("x-form-trigger-over");
g.addClassOnClick("x-form-trigger-click")
},this);
this.triggers=a.elements
},getTriggerWidth:function(){var a=0;
CQ.Ext.each(this.triggers,function(g,c){var j="Trigger"+(c+1),b=g.getWidth();
if(b===0&&!this["hidden"+j]){a+=this.defaultTriggerWidth
}else{a+=b
}},this);
return a
},onDestroy:function(){CQ.Ext.destroy(this.triggers);
CQ.Ext.form.TwinTriggerField.superclass.onDestroy.call(this)
},onTrigger1Click:CQ.Ext.emptyFn,onTrigger2Click:CQ.Ext.emptyFn});
CQ.Ext.reg("trigger",CQ.Ext.form.TriggerField);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.form.TextArea=CQ.Ext.extend(CQ.Ext.form.TextField,{growMin:60,growMax:1000,growAppend:"&#160;\n&#160;",enterIsSpecial:false,preventScrollbars:false,onRender:function(b,a){if(!this.el){this.defaultAutoCreate={tag:"textarea",style:"width:100px;height:60px;",autocomplete:"off"}
}CQ.Ext.form.TextArea.superclass.onRender.call(this,b,a);
if(this.grow){this.textSizeEl=CQ.Ext.DomHelper.append(document.body,{tag:"pre",cls:"x-form-grow-sizer"});
if(this.preventScrollbars){this.el.setStyle("overflow","hidden")
}this.el.setHeight(this.growMin)
}},onDestroy:function(){CQ.Ext.removeNode(this.textSizeEl);
CQ.Ext.form.TextArea.superclass.onDestroy.call(this)
},fireKey:function(a){if(a.isSpecialKey()&&(this.enterIsSpecial||(a.getKey()!=a.ENTER||a.hasModifier()))){this.fireEvent("specialkey",this,a)
}},doAutoSize:function(a){return !a.isNavKeyPress()||a.getKey()==a.ENTER
},filterValidation:function(a){if(!a.isNavKeyPress()||(!this.enterIsSpecial&&a.keyCode==a.ENTER)){this.validationTask.delay(this.validationDelay)
}},autoSize:function(){if(!this.grow||!this.textSizeEl){return
}var c=this.el,a=CQ.Ext.util.Format.htmlEncode(c.dom.value),g=this.textSizeEl,b;
CQ.Ext.fly(g).setWidth(this.el.getWidth());
if(a.length<1){a="&#160;&#160;"
}else{a+=this.growAppend;
if(CQ.Ext.isIE){a=a.replace(/\n/g,"&#160;<br />")
}}g.innerHTML=a;
b=Math.min(this.growMax,Math.max(g.offsetHeight,this.growMin));
if(b!=this.lastHeight){this.lastHeight=b;
this.el.setHeight(b);
this.fireEvent("autosize",this,b)
}}});
CQ.Ext.reg("textarea",CQ.Ext.form.TextArea);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.form.NumberField=CQ.Ext.extend(CQ.Ext.form.TextField,{fieldClass:"x-form-field x-form-num-field",allowDecimals:true,decimalSeparator:".",decimalPrecision:2,allowNegative:true,minValue:Number.NEGATIVE_INFINITY,maxValue:Number.MAX_VALUE,minText:"The minimum value for this field is {0}",maxText:"The maximum value for this field is {0}",nanText:"{0} is not a valid number",baseChars:"0123456789",autoStripChars:false,initEvents:function(){var a=this.baseChars+"";
if(this.allowDecimals){a+=this.decimalSeparator
}if(this.allowNegative){a+="-"
}a=CQ.Ext.escapeRe(a);
this.maskRe=new RegExp("["+a+"]");
if(this.autoStripChars){this.stripCharsRe=new RegExp("[^"+a+"]","gi")
}CQ.Ext.form.NumberField.superclass.initEvents.call(this)
},getErrors:function(b){var c=CQ.Ext.form.NumberField.superclass.getErrors.apply(this,arguments);
b=CQ.Ext.isDefined(b)?b:this.processValue(this.getRawValue());
if(b.length<1){return c
}b=String(b).replace(this.decimalSeparator,".");
if(isNaN(b)){c.push(String.format(this.nanText,b))
}var a=this.parseValue(b);
if(a<this.minValue){c.push(String.format(this.minText,this.minValue))
}if(a>this.maxValue){c.push(String.format(this.maxText,this.maxValue))
}return c
},getValue:function(){return this.fixPrecision(this.parseValue(CQ.Ext.form.NumberField.superclass.getValue.call(this)))
},setValue:function(a){a=CQ.Ext.isNumber(a)?a:parseFloat(String(a).replace(this.decimalSeparator,"."));
a=this.fixPrecision(a);
a=isNaN(a)?"":String(a).replace(".",this.decimalSeparator);
return CQ.Ext.form.NumberField.superclass.setValue.call(this,a)
},setMinValue:function(a){this.minValue=CQ.Ext.num(a,Number.NEGATIVE_INFINITY)
},setMaxValue:function(a){this.maxValue=CQ.Ext.num(a,Number.MAX_VALUE)
},parseValue:function(a){a=parseFloat(String(a).replace(this.decimalSeparator,"."));
return isNaN(a)?"":a
},fixPrecision:function(b){var a=isNaN(b);
if(!this.allowDecimals||this.decimalPrecision==-1||a||!b){return a?"":b
}return parseFloat(parseFloat(b).toFixed(this.decimalPrecision))
},beforeBlur:function(){var a=this.parseValue(this.getRawValue());
if(!CQ.Ext.isEmpty(a)){this.setValue(a)
}}});
CQ.Ext.reg("numberfield",CQ.Ext.form.NumberField);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.form.DateField=CQ.Ext.extend(CQ.Ext.form.TriggerField,{format:"m/d/Y",altFormats:"m/d/Y|n/j/Y|n/j/y|m/j/y|n/d/y|m/j/Y|n/d/Y|m-d-y|m-d-Y|m/d|m-d|md|mdy|mdY|d|Y-m-d|n-j|n/j",disabledDaysText:"Disabled",disabledDatesText:"Disabled",minText:"The date in this field must be equal to or after {0}",maxText:"The date in this field must be equal to or before {0}",invalidText:"{0} is not a valid date - it must be in the format {1}",triggerClass:"x-form-date-trigger",showToday:true,startDay:0,defaultAutoCreate:{tag:"input",type:"text",size:"10",autocomplete:"off"},initTime:"12",initTimeFormat:"H",safeParse:function(b,c){if(Date.formatContainsHourInfo(c)){return Date.parseDate(b,c)
}else{var a=Date.parseDate(b+" "+this.initTime,c+" "+this.initTimeFormat);
if(a){return a.clearTime()
}}},initComponent:function(){CQ.Ext.form.DateField.superclass.initComponent.call(this);
this.addEvents("select");
if(CQ.Ext.isString(this.minValue)){this.minValue=this.parseDate(this.minValue)
}if(CQ.Ext.isString(this.maxValue)){this.maxValue=this.parseDate(this.maxValue)
}this.disabledDatesRE=null;
this.initDisabledDays()
},initEvents:function(){CQ.Ext.form.DateField.superclass.initEvents.call(this);
this.keyNav=new CQ.Ext.KeyNav(this.el,{down:function(a){this.onTriggerClick()
},scope:this,forceKeyDown:true})
},initDisabledDays:function(){if(this.disabledDates){var b=this.disabledDates,a=b.length-1,c="(?:";
CQ.Ext.each(b,function(j,g){c+=CQ.Ext.isDate(j)?"^"+CQ.Ext.escapeRe(j.dateFormat(this.format))+"$":b[g];
if(g!=a){c+="|"
}},this);
this.disabledDatesRE=new RegExp(c+")")
}},setDisabledDates:function(a){this.disabledDates=a;
this.initDisabledDays();
if(this.menu){this.menu.picker.setDisabledDates(this.disabledDatesRE)
}},setDisabledDays:function(a){this.disabledDays=a;
if(this.menu){this.menu.picker.setDisabledDays(a)
}},setMinValue:function(a){this.minValue=(CQ.Ext.isString(a)?this.parseDate(a):a);
if(this.menu){this.menu.picker.setMinDate(this.minValue)
}},setMaxValue:function(a){this.maxValue=(CQ.Ext.isString(a)?this.parseDate(a):a);
if(this.menu){this.menu.picker.setMaxDate(this.maxValue)
}},getErrors:function(j){var m=CQ.Ext.form.DateField.superclass.getErrors.apply(this,arguments);
j=this.formatDate(j||this.processValue(this.getRawValue()));
if(j.length<1){return m
}var c=j;
j=this.parseDate(j);
if(!j){m.push(String.format(this.invalidText,c,this.format));
return m
}var k=j.getTime();
if(this.minValue&&k<this.minValue.clearTime().getTime()){m.push(String.format(this.minText,this.formatDate(this.minValue)))
}if(this.maxValue&&k>this.maxValue.clearTime().getTime()){m.push(String.format(this.maxText,this.formatDate(this.maxValue)))
}if(this.disabledDays){var a=j.getDay();
for(var b=0;
b<this.disabledDays.length;
b++){if(a===this.disabledDays[b]){m.push(this.disabledDaysText);
break
}}}var g=this.formatDate(j);
if(this.disabledDatesRE&&this.disabledDatesRE.test(g)){m.push(String.format(this.disabledDatesText,g))
}return m
},validateBlur:function(){return !this.menu||!this.menu.isVisible()
},getValue:function(){return this.parseDate(CQ.Ext.form.DateField.superclass.getValue.call(this))||""
},setValue:function(a){return CQ.Ext.form.DateField.superclass.setValue.call(this,this.formatDate(this.parseDate(a)))
},parseDate:function(k){if(!k||CQ.Ext.isDate(k)){return k
}var b=this.safeParse(k,this.format),c=this.altFormats,j=this.altFormatsArray;
if(!b&&c){j=j||c.split("|");
for(var g=0,a=j.length;
g<a&&!b;
g++){b=this.safeParse(k,j[g])
}}return b
},onDestroy:function(){CQ.Ext.destroy(this.menu,this.keyNav);
CQ.Ext.form.DateField.superclass.onDestroy.call(this)
},formatDate:function(a){return CQ.Ext.isDate(a)?a.dateFormat(this.format):a
},onTriggerClick:function(){if(this.disabled){return
}if(this.menu==null){this.menu=new CQ.Ext.menu.DateMenu({hideOnClick:false,focusOnSelect:false})
}this.onFocus();
CQ.Ext.apply(this.menu.picker,{minDate:this.minValue,maxDate:this.maxValue,disabledDatesRE:this.disabledDatesRE,disabledDatesText:this.disabledDatesText,disabledDays:this.disabledDays,disabledDaysText:this.disabledDaysText,format:this.format,showToday:this.showToday,startDay:this.startDay,minText:String.format(this.minText,this.formatDate(this.minValue)),maxText:String.format(this.maxText,this.formatDate(this.maxValue))});
this.menu.picker.setValue(this.getValue()||new Date());
this.menu.show(this.el,"tl-bl?");
this.menuEvents("on")
},menuEvents:function(a){this.menu[a]("select",this.onSelect,this);
this.menu[a]("hide",this.onMenuHide,this);
this.menu[a]("show",this.onFocus,this)
},onSelect:function(a,b){this.setValue(b);
this.fireEvent("select",this,b);
this.menu.hide()
},onMenuHide:function(){this.focus(false,60);
this.menuEvents("un")
},beforeBlur:function(){var a=this.parseDate(this.getRawValue());
if(a){this.setValue(a)
}}});
CQ.Ext.reg("datefield",CQ.Ext.form.DateField);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.form.DisplayField=CQ.Ext.extend(CQ.Ext.form.Field,{validationEvent:false,validateOnBlur:false,defaultAutoCreate:{tag:"div"},fieldClass:"x-form-display-field",htmlEncode:false,initEvents:CQ.Ext.emptyFn,isValid:function(){return true
},validate:function(){return true
},getRawValue:function(){var a=this.rendered?this.el.dom.innerHTML:CQ.Ext.value(this.value,"");
if(a===this.emptyText){a=""
}if(this.htmlEncode){a=CQ.Ext.util.Format.htmlDecode(a)
}return a
},getValue:function(){return this.getRawValue()
},getName:function(){return this.name
},setRawValue:function(a){if(this.htmlEncode){a=CQ.Ext.util.Format.htmlEncode(a)
}return this.rendered?(this.el.dom.innerHTML=(CQ.Ext.isEmpty(a)?"":a)):(this.value=a)
},setValue:function(a){this.setRawValue(a);
return this
}});
CQ.Ext.reg("displayfield",CQ.Ext.form.DisplayField);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.form.ComboBox=CQ.Ext.extend(CQ.Ext.form.TriggerField,{defaultAutoCreate:{tag:"input",type:"text",size:"24",autocomplete:"off"},listClass:"",selectedClass:"x-combo-selected",listEmptyText:"",triggerClass:"x-form-arrow-trigger",shadow:"sides",listAlign:"tl-bl?",maxHeight:300,minHeight:90,triggerAction:"query",minChars:4,autoSelect:true,typeAhead:false,queryDelay:500,pageSize:0,selectOnFocus:false,queryParam:"query",loadingText:"Loading...",resizable:false,handleHeight:8,allQuery:"",mode:"remote",minListWidth:70,forceSelection:false,typeAheadDelay:250,lazyInit:true,clearFilterOnReset:true,submitValue:undefined,initComponent:function(){CQ.Ext.form.ComboBox.superclass.initComponent.call(this);
this.addEvents("expand","collapse","beforeselect","select","beforequery");
if(this.transform){var c=CQ.Ext.getDom(this.transform);
if(!this.hiddenName){this.hiddenName=c.name
}if(!this.store){this.mode="local";
var m=[],g=c.options;
for(var b=0,a=g.length;
b<a;
b++){var k=g[b],j=(k.hasAttribute?k.hasAttribute("value"):k.getAttributeNode("value").specified)?k.value:k.text;
if(k.selected&&CQ.Ext.isEmpty(this.value,true)){this.value=j
}m.push([j,k.text])
}this.store=new CQ.Ext.data.ArrayStore({idIndex:0,fields:["value","text"],data:m,autoDestroy:true});
this.valueField="value";
this.displayField="text"
}c.name=CQ.Ext.id();
if(!this.lazyRender){this.target=true;
this.el=CQ.Ext.DomHelper.insertBefore(c,this.autoCreate||this.defaultAutoCreate);
this.render(this.el.parentNode,c)
}CQ.Ext.removeNode(c)
}else{if(this.store){this.store=CQ.Ext.StoreMgr.lookup(this.store);
if(this.store.autoCreated){this.displayField=this.valueField="field1";
if(!this.store.expandData){this.displayField="field2"
}this.mode="local"
}}}this.selectedIndex=-1;
if(this.mode=="local"){if(!CQ.Ext.isDefined(this.initialConfig.queryDelay)){this.queryDelay=10
}if(!CQ.Ext.isDefined(this.initialConfig.minChars)){this.minChars=0
}}},onRender:function(b,a){if(this.hiddenName&&!CQ.Ext.isDefined(this.submitValue)){this.submitValue=false
}CQ.Ext.form.ComboBox.superclass.onRender.call(this,b,a);
if(this.hiddenName){this.hiddenField=this.el.insertSibling({tag:"input",type:"hidden",name:this.hiddenName,id:(this.hiddenId||CQ.Ext.id())},"before",true)
}if(CQ.Ext.isGecko){this.el.dom.setAttribute("autocomplete","off")
}if(!this.lazyInit){this.initList()
}else{this.on("focus",this.initList,this,{single:true})
}},initValue:function(){CQ.Ext.form.ComboBox.superclass.initValue.call(this);
if(this.hiddenField){this.hiddenField.value=CQ.Ext.value(CQ.Ext.isDefined(this.hiddenValue)?this.hiddenValue:this.value,"")
}},getParentZIndex:function(){var a;
if(this.ownerCt){this.findParentBy(function(b){a=parseInt(b.getPositionEl().getStyle("z-index"),10);
return !!a
})
}return a
},getZIndex:function(b){b=b||CQ.Ext.getDom(this.getListParent()||CQ.Ext.getBody());
var a=parseInt(CQ.Ext.fly(b).getStyle("z-index"),10);
if(!a){a=this.getParentZIndex()
}return(a||12000)+5
},initList:function(){if(!this.list){var a="x-combo-list",c=CQ.Ext.getDom(this.getListParent()||CQ.Ext.getBody());
this.list=new CQ.Ext.Layer({parentEl:c,shadow:this.shadow,cls:[a,this.listClass].join(" "),constrain:false,zindex:this.getZIndex(c)});
var b=this.listWidth||Math.max(this.wrap.getWidth(),this.minListWidth);
this.list.setSize(b,0);
this.list.swallowEvent("mousewheel");
this.assetHeight=0;
if(this.syncFont!==false){this.list.setStyle("font-size",this.el.getStyle("font-size"))
}if(this.title){this.header=this.list.createChild({cls:a+"-hd",html:this.title});
this.assetHeight+=this.header.getHeight()
}this.innerList=this.list.createChild({cls:a+"-inner"});
this.mon(this.innerList,"mouseover",this.onViewOver,this);
this.mon(this.innerList,"mousemove",this.onViewMove,this);
this.innerList.setWidth(b-this.list.getFrameWidth("lr"));
if(this.pageSize){this.footer=this.list.createChild({cls:a+"-ft"});
this.pageTb=new CQ.Ext.PagingToolbar({store:this.store,pageSize:this.pageSize,renderTo:this.footer});
this.assetHeight+=this.footer.getHeight()
}if(!this.tpl){this.tpl='<tpl for="."><div class="'+a+'-item">{'+this.displayField+"}</div></tpl>"
}this.view=new CQ.Ext.DataView({applyTo:this.innerList,tpl:this.tpl,singleSelect:true,selectedClass:this.selectedClass,itemSelector:this.itemSelector||"."+a+"-item",emptyText:this.listEmptyText,deferEmptyText:false});
this.mon(this.view,{containerclick:this.onViewClick,click:this.onViewClick,scope:this});
this.bindStore(this.store,true);
if(this.resizable){this.resizer=new CQ.Ext.Resizable(this.list,{pinned:true,handles:"se"});
this.mon(this.resizer,"resize",function(k,g,j){this.maxHeight=j-this.handleHeight-this.list.getFrameWidth("tb")-this.assetHeight;
this.listWidth=g;
this.innerList.setWidth(g-this.list.getFrameWidth("lr"));
this.restrictHeight()
},this);
this[this.pageSize?"footer":"innerList"].setStyle("margin-bottom",this.handleHeight+"px")
}}},getListParent:function(){return CQ.Util.getRoot()
},getStore:function(){return this.store
},bindStore:function(a,b){if(this.store&&!b){if(this.store!==a&&this.store.autoDestroy){this.store.destroy()
}else{this.store.un("beforeload",this.onBeforeLoad,this);
this.store.un("load",this.onLoad,this);
this.store.un("exception",this.collapse,this)
}if(!a){this.store=null;
if(this.view){this.view.bindStore(null)
}if(this.pageTb){this.pageTb.bindStore(null)
}}}if(a){if(!b){this.lastQuery=null;
if(this.pageTb){this.pageTb.bindStore(a)
}}this.store=CQ.Ext.StoreMgr.lookup(a);
this.store.on({scope:this,beforeload:this.onBeforeLoad,load:this.onLoad,exception:this.collapse});
if(this.view){this.view.bindStore(a)
}}},reset:function(){if(this.clearFilterOnReset&&this.mode=="local"){this.store.clearFilter()
}CQ.Ext.form.ComboBox.superclass.reset.call(this)
},initEvents:function(){CQ.Ext.form.ComboBox.superclass.initEvents.call(this);
this.keyNav=new CQ.Ext.KeyNav(this.el,{up:function(a){this.inKeyMode=true;
this.selectPrev()
},down:function(a){if(!this.isExpanded()){this.onTriggerClick()
}else{this.inKeyMode=true;
this.selectNext()
}},enter:function(a){this.onViewClick()
},esc:function(a){this.collapse()
},tab:function(a){if(this.forceSelection===true){this.collapse()
}else{this.onViewClick(false)
}return true
},scope:this,doRelay:function(c,b,a){if(a=="down"||this.scope.isExpanded()){var g=CQ.Ext.KeyNav.prototype.doRelay.apply(this,arguments);
if(!CQ.Ext.isIE&&CQ.Ext.EventManager.useKeydown){this.scope.fireKey(c)
}return g
}return true
},forceKeyDown:true,defaultEventAction:"stopEvent"});
this.queryDelay=Math.max(this.queryDelay||10,this.mode=="local"?10:250);
this.dqTask=new CQ.Ext.util.DelayedTask(this.initQuery,this);
if(this.typeAhead){this.taTask=new CQ.Ext.util.DelayedTask(this.onTypeAhead,this)
}if(!this.enableKeyEvents){this.mon(this.el,"keyup",this.onKeyUp,this)
}},onDestroy:function(){if(this.dqTask){this.dqTask.cancel();
this.dqTask=null
}this.bindStore(null);
CQ.Ext.destroy(this.resizer,this.view,this.pageTb,this.list);
CQ.Ext.destroyMembers(this,"hiddenField");
CQ.Ext.form.ComboBox.superclass.onDestroy.call(this)
},fireKey:function(a){if(!this.isExpanded()){CQ.Ext.form.ComboBox.superclass.fireKey.call(this,a)
}},onResize:function(a,b){CQ.Ext.form.ComboBox.superclass.onResize.apply(this,arguments);
if(!isNaN(a)&&this.isVisible()&&this.list){this.doResize(a)
}else{this.bufferSize=a
}},doResize:function(a){if(!CQ.Ext.isDefined(this.listWidth)){var b=Math.max(a,this.minListWidth);
this.list.setWidth(b);
this.innerList.setWidth(b-this.list.getFrameWidth("lr"))
}},onEnable:function(){CQ.Ext.form.ComboBox.superclass.onEnable.apply(this,arguments);
if(this.hiddenField){this.hiddenField.disabled=false
}},onDisable:function(){CQ.Ext.form.ComboBox.superclass.onDisable.apply(this,arguments);
if(this.hiddenField){this.hiddenField.disabled=true
}},onBeforeLoad:function(){if(!this.hasFocus){return
}this.innerList.update(this.loadingText?'<div class="loading-indicator">'+this.loadingText+"</div>":"");
this.restrictHeight();
this.selectedIndex=-1
},onLoad:function(){if(!this.hasFocus){return
}if(this.store.getCount()>0||this.listEmptyText){this.expand();
this.restrictHeight();
if(this.lastQuery==this.allQuery){if(this.editable){this.el.dom.select()
}if(this.autoSelect!==false&&!this.selectByValue(this.value,true)){this.select(0,true)
}}else{if(this.autoSelect!==false){this.selectNext()
}if(this.typeAhead&&this.lastKey!=CQ.Ext.EventObject.BACKSPACE&&this.lastKey!=CQ.Ext.EventObject.DELETE){this.taTask.delay(this.typeAheadDelay)
}}}else{this.collapse()
}},onTypeAhead:function(){if(this.store.getCount()>0){var b=this.store.getAt(0);
var c=b.data[this.displayField];
var a=c.length;
var g=this.getRawValue().length;
if(g!=a){this.setRawValue(c);
this.selectText(g,c.length)
}}},assertValue:function(){var b=this.getRawValue(),a;
if(this.valueField&&CQ.Ext.isDefined(this.value)){a=this.findRecord(this.valueField,this.value)
}if(!a||a.get(this.displayField)!=b){a=this.findRecord(this.displayField,b)
}if(!a&&this.forceSelection){if(b.length>0&&b!=this.emptyText){this.el.dom.value=CQ.Ext.value(this.lastSelectionText,"");
this.applyEmptyText()
}else{this.clearValue()
}}else{if(a&&this.valueField){if(this.value==b){return
}b=a.get(this.valueField||this.displayField)
}this.setValue(b)
}},onSelect:function(a,b){if(this.fireEvent("beforeselect",this,a,b)!==false){this.setValue(a.data[this.valueField||this.displayField]);
this.collapse();
this.fireEvent("select",this,a,b)
}},getName:function(){var a=this.hiddenField;
return a&&a.name?a.name:this.hiddenName||CQ.Ext.form.ComboBox.superclass.getName.call(this)
},getValue:function(){if(this.valueField){return CQ.Ext.isDefined(this.value)?this.value:""
}else{return CQ.Ext.form.ComboBox.superclass.getValue.call(this)
}},clearValue:function(){if(this.hiddenField){this.hiddenField.value=""
}this.setRawValue("");
this.lastSelectionText="";
this.applyEmptyText();
this.value=""
},setValue:function(a){var c=a;
if(this.valueField){var b=this.findRecord(this.valueField,a);
if(b){c=b.data[this.displayField]
}else{if(CQ.Ext.isDefined(this.valueNotFoundText)){c=this.valueNotFoundText
}}}this.lastSelectionText=c;
if(this.hiddenField){this.hiddenField.value=CQ.Ext.value(a,"")
}CQ.Ext.form.ComboBox.superclass.setValue.call(this,c);
this.value=a;
return this
},findRecord:function(c,b){var a;
if(this.store.getCount()>0){this.store.each(function(g){if(g.data[c]==b){a=g;
return false
}})
}return a
},onViewMove:function(b,a){this.inKeyMode=false
},onViewOver:function(g,b){if(this.inKeyMode){return
}var c=this.view.findItemFromChild(b);
if(c){var a=this.view.indexOf(c);
this.select(a,false)
}},onViewClick:function(b){var a=this.view.getSelectedIndexes()[0],c=this.store,g=c.getAt(a);
if(g){this.onSelect(g,a)
}else{this.collapse()
}if(b!==false){this.el.focus()
}},restrictHeight:function(){this.innerList.dom.style.height="";
var b=this.innerList.dom,j=this.list.getFrameWidth("tb")+(this.resizable?this.handleHeight:0)+this.assetHeight,c=Math.max(b.clientHeight,b.offsetHeight,b.scrollHeight),a=this.getPosition()[1]-CQ.Ext.getBody().getScroll().top,k=CQ.Ext.lib.Dom.getViewHeight()-a-this.getSize().height,g=Math.max(a,k,this.minHeight||0)-this.list.shadowOffset-j-5;
c=Math.min(c,g,this.maxHeight);
this.innerList.setHeight(c);
this.list.beginUpdate();
this.list.setHeight(c+j);
this.list.alignTo.apply(this.list,[this.el].concat(this.listAlign));
this.list.endUpdate()
},isExpanded:function(){return this.list&&this.list.isVisible()
},selectByValue:function(a,c){if(!CQ.Ext.isEmpty(a,true)){var b=this.findRecord(this.valueField||this.displayField,a);
if(b){this.select(this.store.indexOf(b),c);
return true
}}return false
},select:function(a,c){this.selectedIndex=a;
this.view.select(a);
if(c!==false){var b=this.view.getNode(a);
if(b){this.innerList.scrollChildIntoView(b,false)
}}},selectNext:function(){var a=this.store.getCount();
if(a>0){if(this.selectedIndex==-1){this.select(0)
}else{if(this.selectedIndex<a-1){this.select(this.selectedIndex+1)
}}}},selectPrev:function(){var a=this.store.getCount();
if(a>0){if(this.selectedIndex==-1){this.select(0)
}else{if(this.selectedIndex!==0){this.select(this.selectedIndex-1)
}}}},onKeyUp:function(b){var a=b.getKey();
if(this.editable!==false&&this.readOnly!==true&&(a==b.BACKSPACE||!b.isSpecialKey())){this.lastKey=a;
this.dqTask.delay(this.queryDelay)
}CQ.Ext.form.ComboBox.superclass.onKeyUp.call(this,b)
},validateBlur:function(){return !this.list||!this.list.isVisible()
},initQuery:function(){this.doQuery(this.getRawValue())
},beforeBlur:function(){this.assertValue()
},postBlur:function(){CQ.Ext.form.ComboBox.superclass.postBlur.call(this);
this.collapse();
this.inKeyMode=false
},doQuery:function(c,b){c=CQ.Ext.isEmpty(c)?"":c;
var a={query:c,forceAll:b,combo:this,cancel:false};
if(this.fireEvent("beforequery",a)===false||a.cancel){return false
}c=a.query;
b=a.forceAll;
if(b===true||(c.length>=this.minChars)){if(this.lastQuery!==c){this.lastQuery=c;
if(this.mode=="local"){this.selectedIndex=-1;
if(b){this.store.clearFilter()
}else{this.store.filter(this.displayField,c)
}this.onLoad()
}else{this.store.baseParams[this.queryParam]=c;
this.store.load({params:this.getParams(c)});
this.expand()
}}else{this.selectedIndex=-1;
this.onLoad()
}}},getParams:function(a){var b={},c=this.store.paramNames;
if(this.pageSize){b[c.start]=0;
b[c.limit]=this.pageSize
}return b
},collapse:function(){if(!this.isExpanded()){return
}this.list.hide();
CQ.Ext.getDoc().un("mousewheel",this.collapseIf,this);
CQ.Ext.getDoc().un("mousedown",this.collapseIf,this);
this.fireEvent("collapse",this)
},collapseIf:function(a){if(!this.isDestroyed&&!a.within(this.wrap)&&!a.within(this.list)){this.collapse()
}},expand:function(){if(this.isExpanded()||!this.hasFocus){return
}if(this.title||this.pageSize){this.assetHeight=0;
if(this.title){this.assetHeight+=this.header.getHeight()
}if(this.pageSize){this.assetHeight+=this.footer.getHeight()
}}if(this.bufferSize){this.doResize(this.bufferSize);
delete this.bufferSize
}this.list.alignTo.apply(this.list,[this.el].concat(this.listAlign));
this.list.setZIndex(this.getZIndex());
this.list.show();
if(CQ.Ext.isGecko2){this.innerList.setOverflow("auto")
}this.mon(CQ.Ext.getDoc(),{scope:this,mousewheel:this.collapseIf,mousedown:this.collapseIf});
this.fireEvent("expand",this)
},onTriggerClick:function(){if(this.readOnly||this.disabled){return
}if(this.isExpanded()){this.collapse();
this.el.focus()
}else{this.onFocus({});
if(this.triggerAction=="all"){this.doQuery(this.allQuery,true)
}else{this.doQuery(this.getRawValue())
}this.el.focus()
}}});
CQ.Ext.reg("combo",CQ.Ext.form.ComboBox);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.form.Checkbox=CQ.Ext.extend(CQ.Ext.form.Field,{focusClass:undefined,fieldClass:"x-form-field",checked:false,boxLabel:"&#160;",defaultAutoCreate:{tag:"input",type:"checkbox",autocomplete:"off"},actionMode:"wrap",initComponent:function(){CQ.Ext.form.Checkbox.superclass.initComponent.call(this);
this.addEvents("check")
},onResize:function(){CQ.Ext.form.Checkbox.superclass.onResize.apply(this,arguments);
if(!this.boxLabel&&!this.fieldLabel){this.el.alignTo(this.wrap,"c-c")
}},initEvents:function(){CQ.Ext.form.Checkbox.superclass.initEvents.call(this);
this.mon(this.el,{scope:this,click:this.onClick,change:this.onClick})
},markInvalid:CQ.Ext.emptyFn,clearInvalid:CQ.Ext.emptyFn,onRender:function(b,a){CQ.Ext.form.Checkbox.superclass.onRender.call(this,b,a);
if(this.inputValue!==undefined){this.el.dom.value=this.inputValue
}this.wrap=this.el.wrap({cls:"x-form-check-wrap"});
if(this.boxLabel){this.wrap.createChild({tag:"label",htmlFor:this.el.id,cls:"x-form-cb-label",html:this.boxLabel})
}if(this.checked){this.setValue(true)
}else{this.checked=this.el.dom.checked
}if(CQ.Ext.isIE&&!CQ.Ext.isStrict){this.wrap.repaint()
}this.resizeEl=this.positionEl=this.wrap
},onDestroy:function(){CQ.Ext.destroy(this.wrap);
CQ.Ext.form.Checkbox.superclass.onDestroy.call(this)
},initValue:function(){this.originalValue=this.getValue()
},getValue:function(){if(this.rendered){return this.el.dom.checked
}return this.checked
},onClick:function(){if(this.el.dom.checked!=this.checked){this.setValue(this.el.dom.checked)
}},setValue:function(a){var c=this.checked,b=this.inputValue;
if(a===false){this.checked=false
}else{this.checked=(a===true||a==="true"||a=="1"||(b?a==b:String(a).toLowerCase()=="on"))
}if(this.rendered){this.el.dom.checked=this.checked;
this.el.dom.defaultChecked=this.checked
}if(c!=this.checked){this.fireEvent("check",this,this.checked);
if(this.handler){this.handler.call(this.scope||this,this,this.checked)
}}return this
}});
CQ.Ext.reg("checkbox",CQ.Ext.form.Checkbox);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.form.CheckboxGroup=CQ.Ext.extend(CQ.Ext.form.Field,{columns:"auto",vertical:false,allowBlank:true,blankText:"You must select at least one item in this group",defaultType:"checkbox",groupCls:"x-form-check-group",initComponent:function(){this.addEvents("change");
this.on("change",this.validate,this);
CQ.Ext.form.CheckboxGroup.superclass.initComponent.call(this)
},onRender:function(n,k){if(!this.el){var u={autoEl:{id:this.id},cls:this.groupCls,layout:"column",renderTo:n,bufferResize:false};
var a={xtype:"container",defaultType:this.defaultType,layout:"form",defaults:{hideLabel:true,anchor:"100%"}};
if(this.items[0].items){CQ.Ext.apply(u,{layoutConfig:{columns:this.items.length},defaults:this.defaults,items:this.items});
for(var j=0,q=this.items.length;
j<q;
j++){CQ.Ext.applyIf(this.items[j],a)
}}else{var g,r=[];
if(typeof this.columns=="string"){this.columns=this.items.length
}if(!CQ.Ext.isArray(this.columns)){var o=[];
for(var j=0;
j<this.columns;
j++){o.push((100/this.columns)*0.01)
}this.columns=o
}g=this.columns.length;
for(var j=0;
j<g;
j++){var b=CQ.Ext.apply({items:[]},a);
b[this.columns[j]<=1?"columnWidth":"width"]=this.columns[j];
if(this.defaults){b.defaults=CQ.Ext.apply(b.defaults||{},this.defaults)
}r.push(b)
}if(this.vertical){var w=Math.ceil(this.items.length/g),t=0;
for(var j=0,q=this.items.length;
j<q;
j++){if(j>0&&j%w==0){t++
}if(this.items[j].fieldLabel){this.items[j].hideLabel=false
}r[t].items.push(this.items[j])
}}else{for(var j=0,q=this.items.length;
j<q;
j++){var v=j%g;
if(this.items[j].fieldLabel){this.items[j].hideLabel=false
}r[v].items.push(this.items[j])
}}CQ.Ext.apply(u,{layoutConfig:{columns:g},items:r})
}this.panel=new CQ.Ext.Container(u);
this.panel.ownerCt=this;
this.el=this.panel.getEl();
if(this.forId&&this.itemCls){var c=this.el.up(this.itemCls).child("label",true);
if(c){c.setAttribute("htmlFor",this.forId)
}}var m=this.panel.findBy(function(x){return x.isFormField
},this);
this.items=new CQ.Ext.util.MixedCollection();
this.items.addAll(m)
}CQ.Ext.form.CheckboxGroup.superclass.onRender.call(this,n,k)
},initValue:function(){if(this.value){this.setValue.apply(this,this.buffered?this.value:[this.value]);
delete this.buffered;
delete this.value
}},afterRender:function(){CQ.Ext.form.CheckboxGroup.superclass.afterRender.call(this);
this.eachItem(function(a){a.on("check",this.fireChecked,this);
a.inGroup=true
})
},doLayout:function(){if(this.rendered){this.panel.forceLayout=this.ownerCt.forceLayout;
this.panel.doLayout()
}},fireChecked:function(){var a=[];
this.eachItem(function(b){if(b.checked){a.push(b)
}});
this.fireEvent("change",this,a)
},getErrors:function(){var b=CQ.Ext.form.CheckboxGroup.superclass.getErrors.apply(this,arguments);
if(!this.allowBlank){var a=true;
this.eachItem(function(c){if(c.checked){return(a=false)
}});
if(a){b.push(this.blankText)
}}return b
},isDirty:function(){if(this.disabled||!this.rendered){return false
}var a=false;
this.eachItem(function(b){if(b.isDirty()){a=true;
return false
}});
return a
},setReadOnly:function(a){if(this.rendered){this.eachItem(function(b){b.setReadOnly(a)
})
}this.readOnly=a
},onDisable:function(){this.eachItem(function(a){a.disable()
})
},onEnable:function(){this.eachItem(function(a){a.enable()
})
},onResize:function(a,b){this.panel.setSize(a,b);
this.panel.doLayout()
},reset:function(){if(this.originalValue){this.eachItem(function(a){if(a.setValue){a.setValue(false);
a.originalValue=a.getValue()
}});
this.resetOriginal=true;
this.setValue(this.originalValue);
delete this.resetOriginal
}else{this.eachItem(function(a){if(a.reset){a.reset()
}})
}(function(){this.clearInvalid()
}).defer(50,this)
},setValue:function(){if(this.rendered){this.onSetValue.apply(this,arguments)
}else{this.buffered=true;
this.value=arguments
}return this
},onSetValue:function(g,c){if(arguments.length==1){if(CQ.Ext.isArray(g)){CQ.Ext.each(g,function(m,j){if(CQ.Ext.isObject(m)&&m.setValue){m.setValue(true);
if(this.resetOriginal===true){m.originalValue=m.getValue()
}}else{var k=this.items.itemAt(j);
if(k){k.setValue(m)
}}},this)
}else{if(CQ.Ext.isObject(g)){for(var a in g){var b=this.getBox(a);
if(b){b.setValue(g[a])
}}}else{this.setValueForItem(g)
}}}else{var b=this.getBox(g);
if(b){b.setValue(c)
}}},beforeDestroy:function(){CQ.Ext.destroy(this.panel);
if(!this.rendered){CQ.Ext.destroy(this.items)
}CQ.Ext.form.CheckboxGroup.superclass.beforeDestroy.call(this)
},setValueForItem:function(a){a=String(a).split(",");
this.eachItem(function(b){if(a.indexOf(b.inputValue)>-1){b.setValue(true)
}})
},getBox:function(b){var a=null;
this.eachItem(function(c){if(b==c||c.dataIndex==b||c.id==b||c.getName()==b){a=c;
return false
}});
return a
},getValue:function(){var a=[];
this.eachItem(function(b){if(b.checked){a.push(b)
}});
return a
},eachItem:function(b,a){if(this.items&&this.items.each){this.items.each(b,a||this)
}},getRawValue:CQ.Ext.emptyFn,setRawValue:CQ.Ext.emptyFn});
CQ.Ext.reg("checkboxgroup",CQ.Ext.form.CheckboxGroup);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.form.CompositeField=CQ.Ext.extend(CQ.Ext.form.Field,{defaultMargins:"0 5 0 0",skipLastItemMargin:true,isComposite:true,combineErrors:true,labelConnector:", ",initComponent:function(){var m=[],b=this.items,k;
for(var g=0,c=b.length;
g<c;
g++){k=b[g];
if(!CQ.Ext.isEmpty(k.ref)){k.ref="../"+k.ref
}m.push(k.fieldLabel);
CQ.Ext.applyIf(k,this.defaults);
if(!(g==c-1&&this.skipLastItemMargin)){CQ.Ext.applyIf(k,{margins:this.defaultMargins})
}}this.fieldLabel=this.fieldLabel||this.buildLabel(m);
this.fieldErrors=new CQ.Ext.util.MixedCollection(true,function(j){return j.field
});
this.fieldErrors.on({scope:this,add:this.updateInvalidMark,remove:this.updateInvalidMark,replace:this.updateInvalidMark});
CQ.Ext.form.CompositeField.superclass.initComponent.apply(this,arguments);
this.innerCt=new CQ.Ext.Container({layout:"hbox",items:this.items,cls:"x-form-composite",defaultMargins:"0 3 0 0",ownerCt:this});
this.innerCt.ownerCt=undefined;
var a=this.innerCt.findBy(function(j){return j.isFormField
},this);
this.items=new CQ.Ext.util.MixedCollection();
this.items.addAll(a)
},onRender:function(c,a){if(!this.el){var g=this.innerCt;
g.render(c);
this.el=g.getEl();
if(this.combineErrors){this.eachItem(function(j){CQ.Ext.apply(j,{markInvalid:this.onFieldMarkInvalid.createDelegate(this,[j],0),clearInvalid:this.onFieldClearInvalid.createDelegate(this,[j],0)})
})
}var b=this.el.parent().parent().child("label",true);
if(b){b.setAttribute("for",this.items.items[0].id)
}}CQ.Ext.form.CompositeField.superclass.onRender.apply(this,arguments)
},onFieldMarkInvalid:function(g,c){var b=g.getName(),a={field:b,errorName:g.fieldLabel||b,error:c};
this.fieldErrors.replace(b,a);
if(!g.preventMark){g.el.addClass(g.invalidClass)
}},onFieldClearInvalid:function(a){this.fieldErrors.removeKey(a.getName());
a.el.removeClass(a.invalidClass)
},updateInvalidMark:function(){var a=CQ.Ext.isIE6&&CQ.Ext.isStrict;
if(this.fieldErrors.length==0){this.clearInvalid();
if(a){this.clearInvalid.defer(50,this)
}}else{var b=this.buildCombinedErrorMessage(this.fieldErrors.items);
this.sortErrors();
this.markInvalid(b);
if(a){this.markInvalid(b)
}}},validateValue:function(c,a){var b=true;
this.eachItem(function(g){if(!g.isValid(a)){b=false
}});
return b
},buildCombinedErrorMessage:function(k){var g=[],b;
for(var c=0,a=k.length;
c<a;
c++){b=k[c];
g.push(String.format("{0}: {1}",b.errorName,b.error))
}return g.join("<br />")
},sortErrors:function(){var a=this.items;
this.fieldErrors.sort("ASC",function(k,g){var c=function(b){return function(n){return n.getName()==b
}
};
var m=a.findIndexBy(c(k.field)),j=a.findIndexBy(c(g.field));
return m<j?-1:1
})
},reset:function(){this.eachItem(function(a){a.reset()
});
(function(){this.clearInvalid()
}).defer(50,this)
},clearInvalidChildren:function(){this.eachItem(function(a){a.clearInvalid()
})
},buildLabel:function(a){return CQ.Ext.clean(a).join(this.labelConnector)
},isDirty:function(){if(this.disabled||!this.rendered){return false
}var a=false;
this.eachItem(function(b){if(b.isDirty()){a=true;
return false
}});
return a
},eachItem:function(b,a){if(this.items&&this.items.each){this.items.each(b,a||this)
}},onResize:function(j,c,a,g){var b=this.innerCt;
if(this.rendered&&b.rendered){b.setSize(j,c)
}CQ.Ext.form.CompositeField.superclass.onResize.apply(this,arguments)
},doLayout:function(c,b){if(this.rendered){var a=this.innerCt;
a.forceLayout=this.ownerCt.forceLayout;
a.doLayout(c,b)
}},beforeDestroy:function(){CQ.Ext.destroy(this.innerCt);
CQ.Ext.form.CompositeField.superclass.beforeDestroy.call(this)
},setReadOnly:function(a){if(a==undefined){a=true
}a=!!a;
if(this.rendered){this.eachItem(function(b){b.setReadOnly(a)
})
}this.readOnly=a
},onShow:function(){CQ.Ext.form.CompositeField.superclass.onShow.call(this);
this.doLayout()
},onDisable:function(){this.eachItem(function(a){a.disable()
})
},onEnable:function(){this.eachItem(function(a){a.enable()
})
}});
CQ.Ext.reg("compositefield",CQ.Ext.form.CompositeField);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.form.Radio=CQ.Ext.extend(CQ.Ext.form.Checkbox,{inputType:"radio",markInvalid:CQ.Ext.emptyFn,clearInvalid:CQ.Ext.emptyFn,getGroupValue:function(){var a=this.el.up("form")||CQ.Ext.getBody();
var b=a.child('input[name="'+this.el.dom.name+'"]:checked',true);
return b?b.value:null
},setValue:function(b){var a,g,c;
if(typeof b=="boolean"){CQ.Ext.form.Radio.superclass.setValue.call(this,b)
}else{if(this.rendered){a=this.getCheckEl();
c=a.child('input[name="'+this.el.dom.name+'"][value="'+b+'"]',true);
if(c){CQ.Ext.getCmp(c.id).setValue(true)
}}}if(this.rendered&&this.checked){a=a||this.getCheckEl();
g=this.getCheckEl().select('input[name="'+this.el.dom.name+'"]');
g.each(function(j){if(j.dom.id!=this.id){CQ.Ext.getCmp(j.dom.id).setValue(false)
}},this)
}return this
},getCheckEl:function(){if(this.inGroup){return this.el.up(".x-form-radio-group")
}return this.el.up("form")||CQ.Ext.getBody()
}});
CQ.Ext.reg("radio",CQ.Ext.form.Radio);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.form.RadioGroup=CQ.Ext.extend(CQ.Ext.form.CheckboxGroup,{allowBlank:true,blankText:"You must select one item in this group",defaultType:"radio",groupCls:"x-form-radio-group",getValue:function(){var a=null;
this.eachItem(function(b){if(b.checked){a=b;
return false
}});
return a
},onSetValue:function(c,b){if(arguments.length>1){var a=this.getBox(c);
if(a){a.setValue(b);
if(a.checked){this.eachItem(function(g){if(g!==a){g.setValue(false)
}})
}}}else{this.setValueForItem(c)
}},setValueForItem:function(a){a=String(a).split(",")[0];
this.eachItem(function(b){b.setValue(a==b.inputValue)
})
},fireChecked:function(){if(!this.checkTask){this.checkTask=new CQ.Ext.util.DelayedTask(this.bufferChecked,this)
}this.checkTask.delay(10)
},bufferChecked:function(){var a=null;
this.eachItem(function(b){if(b.checked){a=b;
return false
}});
this.fireEvent("change",this,a)
},onDestroy:function(){if(this.checkTask){this.checkTask.cancel();
this.checkTask=null
}CQ.Ext.form.RadioGroup.superclass.onDestroy.call(this)
}});
CQ.Ext.reg("radiogroup",CQ.Ext.form.RadioGroup);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.form.Hidden=CQ.Ext.extend(CQ.Ext.form.Field,{inputType:"hidden",shouldLayout:false,onRender:function(){CQ.Ext.form.Hidden.superclass.onRender.apply(this,arguments)
},initEvents:function(){this.originalValue=this.getValue()
},setSize:CQ.Ext.emptyFn,setWidth:CQ.Ext.emptyFn,setHeight:CQ.Ext.emptyFn,setPosition:CQ.Ext.emptyFn,setPagePosition:CQ.Ext.emptyFn,markInvalid:CQ.Ext.emptyFn,clearInvalid:CQ.Ext.emptyFn});
CQ.Ext.reg("hidden",CQ.Ext.form.Hidden);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.form.BasicForm=CQ.Ext.extend(CQ.Ext.util.Observable,{constructor:function(b,a){CQ.Ext.apply(this,a);
if(CQ.Ext.isString(this.paramOrder)){this.paramOrder=this.paramOrder.split(/[\s,|]/)
}this.items=new CQ.Ext.util.MixedCollection(false,function(c){return c.getItemId()
});
this.addEvents("beforeaction","actionfailed","actioncomplete");
if(b){this.initEl(b)
}CQ.Ext.form.BasicForm.superclass.constructor.call(this)
},timeout:30,paramOrder:undefined,paramsAsHash:false,waitTitle:"Please Wait...",activeAction:null,trackResetOnLoad:false,initEl:function(a){this.el=CQ.Ext.get(a);
this.id=this.el.id||CQ.Ext.id();
if(!this.standardSubmit){this.el.on("submit",this.onSubmit,this)
}this.el.addClass("x-form")
},getEl:function(){return this.el
},onSubmit:function(a){a.stopEvent()
},destroy:function(a){if(a!==true){this.items.each(function(b){CQ.Ext.destroy(b)
});
CQ.Ext.destroy(this.el)
}this.items.clear();
this.purgeListeners()
},isValid:function(){var a=true;
this.items.each(function(b){if(!b.validate()){a=false
}});
return a
},isDirty:function(){var a=false;
this.items.each(function(b){if(b.isDirty()){a=true;
return false
}});
return a
},doAction:function(b,a){if(CQ.Ext.isString(b)){b=new CQ.Ext.form.Action.ACTION_TYPES[b](this,a)
}if(this.fireEvent("beforeaction",this,b)!==false){this.beforeAction(b);
b.run.defer(100,b)
}return this
},submit:function(b){b=b||{};
if(this.standardSubmit){var a=b.clientValidation===false||this.isValid();
if(a){var c=this.el.dom;
if(this.url&&CQ.Ext.isEmpty(c.action)){c.action=this.url
}c.submit()
}return a
}var g=String.format("{0}submit",this.api?"direct":"");
this.doAction(g,b);
return this
},load:function(a){var b=String.format("{0}load",this.api?"direct":"");
this.doAction(b,a);
return this
},updateRecord:function(b){b.beginEdit();
var a=b.fields,g,c;
a.each(function(j){g=this.findField(j.name);
if(g){c=g.getValue();
if(CQ.Ext.type(c)!==false&&c.getGroupValue){c=c.getGroupValue()
}else{if(g.eachItem){c=[];
g.eachItem(function(k){c.push(k.getValue())
})
}}b.set(j.name,c)
}},this);
b.endEdit();
return this
},loadRecord:function(a){this.setValues(a.data);
return this
},beforeAction:function(a){this.items.each(function(c){if(c.isFormField&&c.syncValue){c.syncValue()
}});
var b=a.options;
if(b.waitMsg){if(this.waitMsgTarget===true){this.el.mask(b.waitMsg,"x-mask-loading")
}else{if(this.waitMsgTarget){this.waitMsgTarget=CQ.Ext.get(this.waitMsgTarget);
this.waitMsgTarget.mask(b.waitMsg,"x-mask-loading")
}else{CQ.Ext.MessageBox.wait(b.waitMsg,b.waitTitle||this.waitTitle)
}}}},afterAction:function(a,c){this.activeAction=null;
var b=a.options;
if(b.waitMsg){if(this.waitMsgTarget===true){this.el.unmask()
}else{if(this.waitMsgTarget){this.waitMsgTarget.unmask()
}else{CQ.Ext.MessageBox.updateProgress(1);
CQ.Ext.MessageBox.hide()
}}}if(c){if(b.reset){this.reset()
}CQ.Ext.callback(b.success,b.scope,[this,a]);
this.fireEvent("actioncomplete",this,a)
}else{CQ.Ext.callback(b.failure,b.scope,[this,a]);
this.fireEvent("actionfailed",this,a)
}},findField:function(c){var b=this.items.get(c);
if(!CQ.Ext.isObject(b)){var a=function(g){if(g.isFormField){if(g.dataIndex==c||g.id==c||g.getName()==c){b=g;
return false
}else{if(g.isComposite){return g.items.each(a)
}else{if(g instanceof CQ.Ext.form.CheckboxGroup&&g.rendered){return g.eachItem(a)
}}}}};
this.items.each(a)
}return b||null
},markInvalid:function(m){if(CQ.Ext.isArray(m)){for(var c=0,a=m.length;
c<a;
c++){var b=m[c];
var g=this.findField(b.id);
if(g){g.markInvalid(b.msg)
}}}else{var j,k;
for(k in m){if(!CQ.Ext.isFunction(m[k])&&(j=this.findField(k))){j.markInvalid(m[k])
}}}return this
},setValues:function(c){if(CQ.Ext.isArray(c)){for(var g=0,a=c.length;
g<a;
g++){var b=c[g];
var j=this.findField(b.id);
if(j){j.setValue(b.value);
if(this.trackResetOnLoad){j.originalValue=j.getValue()
}}}}else{var k,m;
for(m in c){if(!CQ.Ext.isFunction(c[m])&&(k=this.findField(m))){k.setValue(c[m]);
if(this.trackResetOnLoad){k.originalValue=k.getValue()
}}}}return this
},getValues:function(b){var a=CQ.Ext.lib.Ajax.serializeForm(this.el.dom);
if(b===true){return a
}return CQ.Ext.urlDecode(a)
},getFieldValues:function(a){var g={},j,b,c;
this.items.each(function(k){if(!k.disabled&&(a!==true||k.isDirty())){j=k.getName();
b=g[j];
c=k.getValue();
if(CQ.Ext.isDefined(b)){if(CQ.Ext.isArray(b)){g[j].push(c)
}else{g[j]=[b,c]
}}else{g[j]=c
}}});
return g
},clearInvalid:function(){this.items.each(function(a){a.clearInvalid()
});
return this
},reset:function(){this.items.each(function(a){a.reset()
});
return this
},add:function(){this.items.addAll(Array.prototype.slice.call(arguments,0));
return this
},remove:function(a){this.items.remove(a);
return this
},cleanDestroyed:function(){this.items.filterBy(function(a){return !!a.isDestroyed
}).each(this.remove,this)
},render:function(){this.items.each(function(a){if(a.isFormField&&!a.rendered&&document.getElementById(a.id)){a.applyToMarkup(a.id)
}});
return this
},applyToFields:function(a){this.items.each(function(b){CQ.Ext.apply(b,a)
});
return this
},applyIfToFields:function(a){this.items.each(function(b){CQ.Ext.applyIf(b,a)
});
return this
},callFieldMethod:function(b,a){a=a||[];
this.items.each(function(c){if(CQ.Ext.isFunction(c[b])){c[b].apply(c,a)
}});
return this
}});
CQ.Ext.BasicForm=CQ.Ext.form.BasicForm;
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.FormPanel=CQ.Ext.extend(CQ.Ext.Panel,{minButtonWidth:75,labelAlign:"left",monitorValid:false,monitorPoll:200,layout:"form",initComponent:function(){this.form=this.createForm();
CQ.Ext.FormPanel.superclass.initComponent.call(this);
this.bodyCfg={tag:"form",cls:this.baseCls+"-body",method:this.method||"POST",id:this.formId||CQ.Ext.id()};
if(this.fileUpload){this.bodyCfg.enctype="multipart/form-data"
}this.initItems();
this.addEvents("clientvalidation");
this.relayEvents(this.form,["beforeaction","actionfailed","actioncomplete"])
},createForm:function(){var a=CQ.Ext.applyIf({listeners:{}},this.initialConfig);
return new CQ.Ext.form.BasicForm(null,a)
},initFields:function(){var c=this.form;
var a=this;
var b=function(g){if(a.isField(g)){c.add(g)
}else{if(g.findBy&&g!=a){a.applySettings(g);
if(g.items&&g.items.each){g.items.each(b,this)
}}}};
this.items.each(b,this)
},applySettings:function(b){var a=b.ownerCt;
CQ.Ext.applyIf(b,{labelAlign:a.labelAlign,labelWidth:a.labelWidth,itemCls:a.itemCls})
},getLayoutTarget:function(){return this.form.el
},getForm:function(){return this.form
},onRender:function(b,a){this.initFields();
CQ.Ext.FormPanel.superclass.onRender.call(this,b,a);
this.form.initEl(this.body)
},beforeDestroy:function(){this.stopMonitoring();
this.form.destroy(true);
CQ.Ext.FormPanel.superclass.beforeDestroy.call(this)
},isField:function(a){return !!a.setValue&&!!a.getValue&&!!a.markInvalid&&!!a.clearInvalid
},initEvents:function(){CQ.Ext.FormPanel.superclass.initEvents.call(this);
this.on({scope:this,add:this.onAddEvent,remove:this.onRemoveEvent});
if(this.monitorValid){this.startMonitoring()
}},onAdd:function(a){CQ.Ext.FormPanel.superclass.onAdd.call(this,a);
this.processAdd(a)
},onAddEvent:function(a,b){if(a!==this){this.processAdd(b)
}},processAdd:function(a){if(this.isField(a)){this.form.add(a)
}else{if(a.findBy){this.applySettings(a);
this.form.add.apply(this.form,a.findBy(this.isField))
}}},onRemove:function(a){CQ.Ext.FormPanel.superclass.onRemove.call(this,a);
this.processRemove(a)
},onRemoveEvent:function(a,b){if(a!==this){this.processRemove(b)
}},processRemove:function(a){if(!this.destroying){if(this.isField(a)){this.form.remove(a)
}else{if(a.findBy){CQ.Ext.each(a.findBy(this.isField),this.form.remove,this.form);
this.form.cleanDestroyed()
}}}},startMonitoring:function(){if(!this.validTask){this.validTask=new CQ.Ext.util.TaskRunner();
this.validTask.start({run:this.bindHandler,interval:this.monitorPoll||200,scope:this})
}},stopMonitoring:function(){if(this.validTask){this.validTask.stopAll();
this.validTask=null
}},load:function(){this.form.load.apply(this.form,arguments)
},onDisable:function(){CQ.Ext.FormPanel.superclass.onDisable.call(this);
if(this.form){this.form.items.each(function(){this.disable()
})
}},onEnable:function(){CQ.Ext.FormPanel.superclass.onEnable.call(this);
if(this.form){this.form.items.each(function(){this.enable()
})
}},bindHandler:function(){var j=true;
this.form.items.each(function(k){if(!k.isValid(true)){j=false;
return false
}});
if(this.fbar){var b=this.fbar.items.items;
for(var g=0,a=b.length;
g<a;
g++){var c=b[g];
if(c.formBind===true&&c.disabled===j){c.setDisabled(!j)
}}}this.fireEvent("clientvalidation",this,j)
}});
CQ.Ext.reg("form",CQ.Ext.FormPanel);
CQ.Ext.form.FormPanel=CQ.Ext.FormPanel;
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.form.FieldSet=CQ.Ext.extend(CQ.Ext.Panel,{baseCls:"x-fieldset",layout:"form",animCollapse:false,onRender:function(b,a){if(!this.el){this.el=document.createElement("fieldset");
this.el.id=this.id;
if(this.title||this.header||this.checkboxToggle){this.el.appendChild(document.createElement("legend")).className=this.baseCls+"-header"
}}CQ.Ext.form.FieldSet.superclass.onRender.call(this,b,a);
if(this.checkboxToggle){var c=typeof this.checkboxToggle=="object"?this.checkboxToggle:{tag:"input",type:"checkbox",name:this.checkboxName||this.id+"-checkbox"};
this.checkbox=this.header.insertFirst(c);
this.checkbox.dom.checked=!this.collapsed;
this.mon(this.checkbox,"click",this.onCheckClick,this)
}},onCollapse:function(a,b){if(this.checkbox){this.checkbox.dom.checked=false
}CQ.Ext.form.FieldSet.superclass.onCollapse.call(this,a,b)
},onExpand:function(a,b){if(this.checkbox){this.checkbox.dom.checked=true
}CQ.Ext.form.FieldSet.superclass.onExpand.call(this,a,b)
},onCheckClick:function(){this[this.checkbox.dom.checked?"expand":"collapse"]()
}});
CQ.Ext.reg("fieldset",CQ.Ext.form.FieldSet);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.form.HtmlEditor=CQ.Ext.extend(CQ.Ext.form.Field,{enableFormat:true,enableFontSize:true,enableColors:true,enableAlignments:true,enableLists:true,enableSourceEdit:true,enableLinks:true,enableFont:true,createLinkText:"Please enter the URL for the link:",defaultLinkValue:"http://",fontFamilies:["Arial","Courier New","Tahoma","Times New Roman","Verdana"],defaultFont:"tahoma",defaultValue:(CQ.Ext.isOpera||CQ.Ext.isIE6)?"&#160;":"&#8203;",actionMode:"wrap",validationEvent:false,deferHeight:true,initialized:false,activated:false,sourceEditMode:false,onFocus:CQ.Ext.emptyFn,iframePad:3,hideMode:"offsets",defaultAutoCreate:{tag:"textarea",style:"width:500px;height:300px;",autocomplete:"off"},initComponent:function(){this.addEvents("initialize","activate","beforesync","beforepush","sync","push","editmodechange");
CQ.Ext.form.HtmlEditor.superclass.initComponent.call(this)
},createFontOptions:function(){var g=[],b=this.fontFamilies,c,k;
for(var j=0,a=b.length;
j<a;
j++){c=b[j];
k=c.toLowerCase();
g.push('<option value="',k,'" style="font-family:',c,';"',(this.defaultFont==k?' selected="true">':">"),c,"</option>")
}return g.join("")
},createToolbar:function(j){var c=[];
var a=CQ.Ext.QuickTips&&CQ.Ext.QuickTips.isEnabled();
function g(o,m,n){return{itemId:o,cls:"x-btn-icon",iconCls:"x-edit-"+o,enableToggle:m!==false,scope:j,handler:n||j.relayBtnCmd,clickEvent:"mousedown",tooltip:a?j.buttonTips[o]||undefined:undefined,overflowText:j.buttonTips[o].title||undefined,tabIndex:-1}
}if(this.enableFont&&!CQ.Ext.isSafari2){var k=new CQ.Ext.Toolbar.Item({autoEl:{tag:"select",cls:"x-font-select",html:this.createFontOptions()}});
c.push(k,"-")
}if(this.enableFormat){c.push(g("bold"),g("italic"),g("underline"))
}if(this.enableFontSize){c.push("-",g("increasefontsize",false,this.adjustFont),g("decreasefontsize",false,this.adjustFont))
}if(this.enableColors){c.push("-",{itemId:"forecolor",cls:"x-btn-icon",iconCls:"x-edit-forecolor",clickEvent:"mousedown",tooltip:a?j.buttonTips.forecolor||undefined:undefined,tabIndex:-1,menu:new CQ.Ext.menu.ColorMenu({allowReselect:true,focus:CQ.Ext.emptyFn,value:"000000",plain:true,listeners:{scope:this,select:function(n,m){this.execCmd("forecolor",CQ.Ext.isWebKit||CQ.Ext.isIE?"#"+m:m);
this.deferFocus()
}},clickEvent:"mousedown"})},{itemId:"backcolor",cls:"x-btn-icon",iconCls:"x-edit-backcolor",clickEvent:"mousedown",tooltip:a?j.buttonTips.backcolor||undefined:undefined,tabIndex:-1,menu:new CQ.Ext.menu.ColorMenu({focus:CQ.Ext.emptyFn,value:"FFFFFF",plain:true,allowReselect:true,listeners:{scope:this,select:function(n,m){if(CQ.Ext.isGecko){this.execCmd("useCSS",false);
this.execCmd("hilitecolor",m);
this.execCmd("useCSS",true);
this.deferFocus()
}else{this.execCmd(CQ.Ext.isOpera?"hilitecolor":"backcolor",CQ.Ext.isWebKit||CQ.Ext.isIE?"#"+m:m);
this.deferFocus()
}}},clickEvent:"mousedown"})})
}if(this.enableAlignments){c.push("-",g("justifyleft"),g("justifycenter"),g("justifyright"))
}if(!CQ.Ext.isSafari2){if(this.enableLinks){c.push("-",g("createlink",false,this.createLink))
}if(this.enableLists){c.push("-",g("insertorderedlist"),g("insertunorderedlist"))
}if(this.enableSourceEdit){c.push("-",g("sourceedit",true,function(m){this.toggleSourceEdit(!this.sourceEditMode)
}))
}}var b=new CQ.Ext.Toolbar({renderTo:this.wrap.dom.firstChild,items:c});
if(k){this.fontSelect=k.el;
this.mon(this.fontSelect,"change",function(){var m=this.fontSelect.dom.value;
this.relayCmd("fontname",m);
this.deferFocus()
},this)
}this.mon(b.el,"click",function(m){m.preventDefault()
});
this.tb=b;
this.tb.doLayout()
},onDisable:function(){this.wrap.mask();
CQ.Ext.form.HtmlEditor.superclass.onDisable.call(this)
},onEnable:function(){this.wrap.unmask();
CQ.Ext.form.HtmlEditor.superclass.onEnable.call(this)
},setReadOnly:function(b){CQ.Ext.form.HtmlEditor.superclass.setReadOnly.call(this,b);
if(this.initialized){if(CQ.Ext.isIE){this.getEditorBody().contentEditable=!b
}else{this.setDesignMode(!b)
}var a=this.getEditorBody();
if(a){a.style.cursor=this.readOnly?"default":"text"
}this.disableItems(b)
}},getDocMarkup:function(){var a=CQ.Ext.fly(this.iframe).getHeight()-this.iframePad*2;
return String.format('<html><head><style type="text/css">body{border: 0; margin: 0; padding: {0}px; height: {1}px; cursor: text}</style></head><body></body></html>',this.iframePad,a)
},getEditorBody:function(){var a=this.getDoc();
return a.body||a.documentElement
},getDoc:function(){return CQ.Ext.isIE?this.getWin().document:(this.iframe.contentDocument||this.getWin().document)
},getWin:function(){return CQ.Ext.isIE?this.iframe.contentWindow:window.frames[this.iframe.name]
},onRender:function(b,a){CQ.Ext.form.HtmlEditor.superclass.onRender.call(this,b,a);
this.el.dom.style.border="0 none";
this.el.dom.setAttribute("tabIndex",-1);
this.el.addClass("x-hidden");
if(CQ.Ext.isIE){this.el.applyStyles("margin-top:-1px;margin-bottom:-1px;")
}this.wrap=this.el.wrap({cls:"x-html-editor-wrap",cn:{cls:"x-html-editor-tb"}});
this.createToolbar(this);
this.disableItems(true);
this.tb.doLayout();
this.createIFrame();
if(!this.width){var c=this.el.getSize();
this.setSize(c.width,this.height||c.height)
}this.resizeEl=this.positionEl=this.wrap
},createIFrame:function(){var a=document.createElement("iframe");
a.name=CQ.Ext.id();
a.frameBorder="0";
a.style.overflow="auto";
a.src=CQ.Ext.SSL_SECURE_URL;
this.wrap.dom.appendChild(a);
this.iframe=a;
this.monitorTask=CQ.Ext.TaskMgr.start({run:this.checkDesignMode,scope:this,interval:100})
},initFrame:function(){CQ.Ext.TaskMgr.stop(this.monitorTask);
var b=this.getDoc();
this.win=this.getWin();
b.open();
b.write(this.getDocMarkup());
b.close();
var a={run:function(){var c=this.getDoc();
if(c.body||c.readyState=="complete"){CQ.Ext.TaskMgr.stop(a);
this.setDesignMode(true);
this.initEditor.defer(10,this)
}},interval:10,duration:10000,scope:this};
CQ.Ext.TaskMgr.start(a)
},checkDesignMode:function(){if(this.wrap&&this.wrap.dom.offsetWidth){var a=this.getDoc();
if(!a){return
}if(!a.editorInitialized||this.getDesignMode()!="on"){this.initFrame()
}}},setDesignMode:function(b){var a=this.getDoc();
if(a){if(this.readOnly){b=false
}a.designMode=(/on|true/i).test(String(b).toLowerCase())?"on":"off"
}},getDesignMode:function(){var a=this.getDoc();
if(!a){return""
}return String(a.designMode).toLowerCase()
},disableItems:function(a){if(this.fontSelect){this.fontSelect.dom.disabled=a
}this.tb.items.each(function(b){if(b.getItemId()!="sourceedit"){b.setDisabled(a)
}})
},onResize:function(b,c){CQ.Ext.form.HtmlEditor.superclass.onResize.apply(this,arguments);
if(this.el&&this.iframe){if(CQ.Ext.isNumber(b)){var j=b-this.wrap.getFrameWidth("lr");
this.el.setWidth(j);
this.tb.setWidth(j);
this.iframe.style.width=Math.max(j,0)+"px"
}if(CQ.Ext.isNumber(c)){var a=c-this.wrap.getFrameWidth("tb")-this.tb.el.getHeight();
this.el.setHeight(a);
this.iframe.style.height=Math.max(a,0)+"px";
var g=this.getEditorBody();
if(g){g.style.height=Math.max((a-(this.iframePad*2)),0)+"px"
}}}},toggleSourceEdit:function(b){var g,a;
if(b===undefined){b=!this.sourceEditMode
}this.sourceEditMode=b===true;
var c=this.tb.getComponent("sourceedit");
if(c.pressed!==this.sourceEditMode){c.toggle(this.sourceEditMode);
if(!c.xtbHidden){return
}}if(this.sourceEditMode){this.previousSize=this.getSize();
g=CQ.Ext.get(this.iframe).getHeight();
this.disableItems(true);
this.syncValue();
this.iframe.className="x-hidden";
this.el.removeClass("x-hidden");
this.el.dom.removeAttribute("tabIndex");
this.el.focus();
this.el.dom.style.height=g+"px"
}else{a=parseInt(this.el.dom.style.height,10);
if(this.initialized){this.disableItems(this.readOnly)
}this.pushValue();
this.iframe.className="";
this.el.addClass("x-hidden");
this.el.dom.setAttribute("tabIndex",-1);
this.deferFocus();
this.setSize(this.previousSize);
delete this.previousSize;
this.iframe.style.height=a+"px"
}this.fireEvent("editmodechange",this,this.sourceEditMode)
},createLink:function(){var a=prompt(this.createLinkText,this.defaultLinkValue);
if(a&&a!="http://"){this.relayCmd("createlink",a)
}},initEvents:function(){this.originalValue=this.getValue()
},markInvalid:CQ.Ext.emptyFn,clearInvalid:CQ.Ext.emptyFn,setValue:function(a){CQ.Ext.form.HtmlEditor.superclass.setValue.call(this,a);
this.pushValue();
return this
},cleanHtml:function(a){a=String(a);
if(CQ.Ext.isWebKit){a=a.replace(/\sclass="(?:Apple-style-span|khtml-block-placeholder)"/gi,"")
}if(a.charCodeAt(0)==this.defaultValue.replace(/\D/g,"")){a=a.substring(1)
}return a
},syncValue:function(){if(this.initialized){var g=this.getEditorBody();
var c=g.innerHTML;
if(CQ.Ext.isWebKit){var b=g.getAttribute("style");
var a=b.match(/text-align:(.*?);/i);
if(a&&a[1]){c='<div style="'+a[0]+'">'+c+"</div>"
}}c=this.cleanHtml(c);
if(this.fireEvent("beforesync",this,c)!==false){this.el.dom.value=c;
this.fireEvent("sync",this,c)
}}},getValue:function(){this[this.sourceEditMode?"pushValue":"syncValue"]();
return CQ.Ext.form.HtmlEditor.superclass.getValue.call(this)
},pushValue:function(){if(this.initialized){var a=this.el.dom.value;
if(!this.activated&&a.length<1){a=this.defaultValue
}if(this.fireEvent("beforepush",this,a)!==false){this.getEditorBody().innerHTML=a;
if(CQ.Ext.isGecko){this.setDesignMode(false);
this.setDesignMode(true)
}this.fireEvent("push",this,a)
}}},deferFocus:function(){this.focus.defer(10,this)
},focus:function(){if(this.win&&!this.sourceEditMode){this.win.focus()
}else{this.el.focus()
}},initEditor:function(){try{var c=this.getEditorBody(),a=this.el.getStyles("font-size","font-family","background-image","background-repeat","background-color","color"),j,b;
a["background-attachment"]="fixed";
c.bgProperties="fixed";
CQ.Ext.DomHelper.applyStyles(c,a);
j=this.getDoc();
if(j){try{CQ.Ext.EventManager.removeAll(j)
}catch(g){}}b=this.onEditorEvent.createDelegate(this);
CQ.Ext.EventManager.on(j,{mousedown:b,dblclick:b,click:b,keyup:b,buffer:100});
if(CQ.Ext.isGecko){CQ.Ext.EventManager.on(j,"keypress",this.applyCommand,this)
}if(CQ.Ext.isIE||CQ.Ext.isWebKit||CQ.Ext.isOpera){CQ.Ext.EventManager.on(j,"keydown",this.fixKeys,this)
}j.editorInitialized=true;
this.initialized=true;
this.pushValue();
this.setReadOnly(this.readOnly);
this.fireEvent("initialize",this)
}catch(g){}},beforeDestroy:function(){if(this.monitorTask){CQ.Ext.TaskMgr.stop(this.monitorTask)
}if(this.rendered){CQ.Ext.destroy(this.tb);
var b=this.getDoc();
if(b){try{CQ.Ext.EventManager.removeAll(b);
for(var c in b){delete b[c]
}}catch(a){}}if(this.wrap){this.wrap.dom.innerHTML="";
this.wrap.remove()
}}CQ.Ext.form.HtmlEditor.superclass.beforeDestroy.call(this)
},onFirstFocus:function(){this.activated=true;
this.disableItems(this.readOnly);
if(CQ.Ext.isGecko){this.win.focus();
var a=this.win.getSelection();
if(!a.focusNode||a.focusNode.nodeType!=3){var b=a.getRangeAt(0);
b.selectNodeContents(this.getEditorBody());
b.collapse(true);
this.deferFocus()
}try{this.execCmd("useCSS",true);
this.execCmd("styleWithCSS",false)
}catch(c){}}this.fireEvent("activate",this)
},adjustFont:function(b){var g=b.getItemId()=="increasefontsize"?1:-1,c=this.getDoc(),a=parseInt(c.queryCommandValue("FontSize")||2,10);
if((CQ.Ext.isSafari&&!CQ.Ext.isSafari2)||CQ.Ext.isChrome||CQ.Ext.isAir){if(a<=10){a=1+g
}else{if(a<=13){a=2+g
}else{if(a<=16){a=3+g
}else{if(a<=18){a=4+g
}else{if(a<=24){a=5+g
}else{a=6+g
}}}}}a=a.constrain(1,6)
}else{if(CQ.Ext.isSafari){g*=2
}a=Math.max(1,a+g)+(CQ.Ext.isSafari?"px":0)
}this.execCmd("FontSize",a)
},onEditorEvent:function(a){this.updateToolbar()
},updateToolbar:function(){if(this.readOnly){return
}if(!this.activated){this.onFirstFocus();
return
}var b=this.tb.items.map,c=this.getDoc();
if(this.enableFont&&!CQ.Ext.isSafari2){var a=(c.queryCommandValue("FontName")||this.defaultFont).toLowerCase();
if(a!=this.fontSelect.dom.value){this.fontSelect.dom.value=a
}}if(this.enableFormat){b.bold.toggle(c.queryCommandState("bold"));
b.italic.toggle(c.queryCommandState("italic"));
b.underline.toggle(c.queryCommandState("underline"))
}if(this.enableAlignments){b.justifyleft.toggle(c.queryCommandState("justifyleft"));
b.justifycenter.toggle(c.queryCommandState("justifycenter"));
b.justifyright.toggle(c.queryCommandState("justifyright"))
}if(!CQ.Ext.isSafari2&&this.enableLists){b.insertorderedlist.toggle(c.queryCommandState("insertorderedlist"));
b.insertunorderedlist.toggle(c.queryCommandState("insertunorderedlist"))
}CQ.Ext.menu.MenuMgr.hideAll();
this.syncValue()
},relayBtnCmd:function(a){this.relayCmd(a.getItemId())
},relayCmd:function(b,a){(function(){this.focus();
this.execCmd(b,a);
this.updateToolbar()
}).defer(10,this)
},execCmd:function(b,a){var c=this.getDoc();
c.execCommand(b,false,a===undefined?null:a);
this.syncValue()
},applyCommand:function(b){if(b.ctrlKey){var g=b.getCharCode(),a;
if(g>0){g=String.fromCharCode(g);
switch(g){case"b":a="bold";
break;
case"i":a="italic";
break;
case"u":a="underline";
break
}if(a){this.win.focus();
this.execCmd(a);
this.deferFocus();
b.preventDefault()
}}}},insertAtCursor:function(c){if(!this.activated){return
}if(CQ.Ext.isIE){this.win.focus();
var b=this.getDoc(),a=b.selection.createRange();
if(a){a.pasteHTML(c);
this.syncValue();
this.deferFocus()
}}else{this.win.focus();
this.execCmd("InsertHTML",c);
this.deferFocus()
}},fixKeys:function(){if(CQ.Ext.isIE){return function(j){var a=j.getKey(),g=this.getDoc(),b;
if(a==j.TAB){j.stopEvent();
b=g.selection.createRange();
if(b){b.collapse(true);
b.pasteHTML("&nbsp;&nbsp;&nbsp;&nbsp;");
this.deferFocus()
}}else{if(a==j.ENTER){b=g.selection.createRange();
if(b){var c=b.parentElement();
if(!c||c.tagName.toLowerCase()!="li"){j.stopEvent();
b.pasteHTML("<br />");
b.collapse(false);
b.select()
}}}}}
}else{if(CQ.Ext.isOpera){return function(b){var a=b.getKey();
if(a==b.TAB){b.stopEvent();
this.win.focus();
this.execCmd("InsertHTML","&nbsp;&nbsp;&nbsp;&nbsp;");
this.deferFocus()
}}
}else{if(CQ.Ext.isWebKit){return function(b){var a=b.getKey();
if(a==b.TAB){b.stopEvent();
this.execCmd("InsertText","\t");
this.deferFocus()
}else{if(a==b.ENTER){b.stopEvent();
this.execCmd("InsertHtml","<br /><br />");
this.deferFocus()
}}}
}}}}(),getToolbar:function(){return this.tb
},buttonTips:{bold:{title:"Bold (Ctrl+B)",text:"Make the selected text bold.",cls:"x-html-editor-tip"},italic:{title:"Italic (Ctrl+I)",text:"Make the selected text italic.",cls:"x-html-editor-tip"},underline:{title:"Underline (Ctrl+U)",text:"Underline the selected text.",cls:"x-html-editor-tip"},increasefontsize:{title:"Grow Text",text:"Increase the font size.",cls:"x-html-editor-tip"},decreasefontsize:{title:"Shrink Text",text:"Decrease the font size.",cls:"x-html-editor-tip"},backcolor:{title:"Text Highlight Color",text:"Change the background color of the selected text.",cls:"x-html-editor-tip"},forecolor:{title:"Font Color",text:"Change the color of the selected text.",cls:"x-html-editor-tip"},justifyleft:{title:"Align Text Left",text:"Align text to the left.",cls:"x-html-editor-tip"},justifycenter:{title:"Center Text",text:"Center text in the editor.",cls:"x-html-editor-tip"},justifyright:{title:"Align Text Right",text:"Align text to the right.",cls:"x-html-editor-tip"},insertunorderedlist:{title:"Bullet List",text:"Start a bulleted list.",cls:"x-html-editor-tip"},insertorderedlist:{title:"Numbered List",text:"Start a numbered list.",cls:"x-html-editor-tip"},createlink:{title:"Hyperlink",text:"Make the selected text a hyperlink.",cls:"x-html-editor-tip"},sourceedit:{title:"Source Edit",text:"Switch to source editing mode.",cls:"x-html-editor-tip"}}});
CQ.Ext.reg("htmleditor",CQ.Ext.form.HtmlEditor);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.form.TimeField=CQ.Ext.extend(CQ.Ext.form.ComboBox,{minValue:undefined,maxValue:undefined,minText:"The time in this field must be equal to or after {0}",maxText:"The time in this field must be equal to or before {0}",invalidText:"{0} is not a valid time",format:"g:i A",altFormats:"g:ia|g:iA|g:i a|g:i A|h:i|g:i|H:i|ga|ha|gA|h a|g a|g A|gi|hi|gia|hia|g|H|gi a|hi a|giA|hiA|gi A|hi A",increment:15,mode:"local",triggerAction:"all",typeAhead:false,initDate:"1/1/2008",initDateFormat:"j/n/Y",initComponent:function(){if(CQ.Ext.isDefined(this.minValue)){this.setMinValue(this.minValue,true)
}if(CQ.Ext.isDefined(this.maxValue)){this.setMaxValue(this.maxValue,true)
}if(!this.store){this.generateStore(true)
}CQ.Ext.form.TimeField.superclass.initComponent.call(this)
},setMinValue:function(b,a){this.setLimit(b,true,a);
return this
},setMaxValue:function(b,a){this.setLimit(b,false,a);
return this
},generateStore:function(b){var c=this.minValue||new Date(this.initDate).clearTime(),a=this.maxValue||new Date(this.initDate).clearTime().add("mi",(24*60)-1),g=[];
while(c<=a){g.push(c.dateFormat(this.format));
c=c.add("mi",this.increment)
}this.bindStore(g,b)
},setLimit:function(b,j,a){var g;
if(CQ.Ext.isString(b)){g=this.parseDate(b)
}else{if(CQ.Ext.isDate(b)){g=b
}}if(g){var c=new Date(this.initDate).clearTime();
c.setHours(g.getHours(),g.getMinutes(),g.getSeconds(),g.getMilliseconds());
this[j?"minValue":"maxValue"]=c;
if(!a){this.generateStore()
}}},getValue:function(){var a=CQ.Ext.form.TimeField.superclass.getValue.call(this);
return this.formatDate(this.parseDate(a))||""
},setValue:function(a){return CQ.Ext.form.TimeField.superclass.setValue.call(this,this.formatDate(this.parseDate(a)))
},validateValue:CQ.Ext.form.DateField.prototype.validateValue,formatDate:CQ.Ext.form.DateField.prototype.formatDate,parseDate:function(m){if(!m||CQ.Ext.isDate(m)){return m
}var n=this.initDate+" ",k=this.initDateFormat+" ",b=Date.parseDate(n+m,k+this.format),c=this.altFormats;
if(!b&&c){if(!this.altFormatsArray){this.altFormatsArray=c.split("|")
}for(var j=0,g=this.altFormatsArray,a=g.length;
j<a&&!b;
j++){b=Date.parseDate(n+m,k+g[j])
}}return b
}});
CQ.Ext.reg("timefield",CQ.Ext.form.TimeField);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.form.SliderField=CQ.Ext.extend(CQ.Ext.form.Field,{useTips:true,tipText:null,actionMode:"wrap",initComponent:function(){var b=CQ.Ext.copyTo({id:this.id+"-slider"},this.initialConfig,["vertical","minValue","maxValue","decimalPrecision","keyIncrement","increment","clickToChange","animate"]);
if(this.useTips){var a=this.tipText?{getText:this.tipText}:{};
b.plugins=[new CQ.Ext.slider.Tip(a)]
}this.slider=new CQ.Ext.Slider(b);
CQ.Ext.form.SliderField.superclass.initComponent.call(this)
},onRender:function(b,a){this.autoCreate={id:this.id,name:this.name,type:"hidden",tag:"input"};
CQ.Ext.form.SliderField.superclass.onRender.call(this,b,a);
this.wrap=this.el.wrap({cls:"x-form-field-wrap"});
this.resizeEl=this.positionEl=this.wrap;
this.slider.render(this.wrap)
},onResize:function(b,c,g,a){CQ.Ext.form.SliderField.superclass.onResize.call(this,b,c,g,a);
this.slider.setSize(b,c)
},initEvents:function(){CQ.Ext.form.SliderField.superclass.initEvents.call(this);
this.slider.on("change",this.onChange,this)
},onChange:function(b,a){this.setValue(a,undefined,true)
},onEnable:function(){CQ.Ext.form.SliderField.superclass.onEnable.call(this);
this.slider.enable()
},onDisable:function(){CQ.Ext.form.SliderField.superclass.onDisable.call(this);
this.slider.disable()
},beforeDestroy:function(){CQ.Ext.destroy(this.slider);
CQ.Ext.form.SliderField.superclass.beforeDestroy.call(this)
},alignErrorIcon:function(){this.errorIcon.alignTo(this.slider.el,"tl-tr",[2,0])
},setMinValue:function(a){this.slider.setMinValue(a);
return this
},setMaxValue:function(a){this.slider.setMaxValue(a);
return this
},setValue:function(c,b,a){if(!a){this.slider.setValue(c,b)
}return CQ.Ext.form.SliderField.superclass.setValue.call(this,this.slider.getValue())
},getValue:function(){return this.slider.getValue()
}});
CQ.Ext.reg("sliderfield",CQ.Ext.form.SliderField);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.form.Label=CQ.Ext.extend(CQ.Ext.BoxComponent,{onRender:function(b,a){if(!this.el){this.el=document.createElement("label");
this.el.id=this.getId();
this.el.innerHTML=this.text?CQ.Ext.util.Format.htmlEncode(this.text):(this.html||"");
if(this.forId){this.el.setAttribute("for",this.forId)
}}CQ.Ext.form.Label.superclass.onRender.call(this,b,a)
},setText:function(a,b){var c=b===false;
this[!c?"text":"html"]=a;
delete this[c?"text":"html"];
if(this.rendered){this.el.dom.innerHTML=b!==false?CQ.Ext.util.Format.htmlEncode(a):a
}return this
}});
CQ.Ext.reg("label",CQ.Ext.form.Label);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.form.Action=function(b,a){this.form=b;
this.options=a||{}
};
CQ.Ext.form.Action.CLIENT_INVALID="client";
CQ.Ext.form.Action.SERVER_INVALID="server";
CQ.Ext.form.Action.CONNECT_FAILURE="connect";
CQ.Ext.form.Action.LOAD_FAILURE="load";
CQ.Ext.form.Action.prototype={type:"default",run:function(a){},success:function(a){},handleResponse:function(a){},failure:function(a){this.response=a;
this.failureType=CQ.Ext.form.Action.CONNECT_FAILURE;
this.form.afterAction(this,false)
},processResponse:function(a){this.response=a;
if(!a.responseText&&!a.responseXML){return true
}this.result=this.handleResponse(a);
return this.result
},decodeResponse:function(a){try{return CQ.Ext.decode(a.responseText)
}catch(b){return false
}},getUrl:function(c){var a=this.options.url||this.form.url||this.form.el.dom.action;
if(c){var b=this.getParams();
if(b){a=CQ.Ext.urlAppend(a,b)
}}return a
},getMethod:function(){return(this.options.method||this.form.method||this.form.el.dom.method||"POST").toUpperCase()
},getParams:function(){var a=this.form.baseParams;
var b=this.options.params;
if(b){if(typeof b=="object"){b=CQ.Ext.urlEncode(CQ.Ext.applyIf(b,a))
}else{if(typeof b=="string"&&a){b+="&"+CQ.Ext.urlEncode(a)
}}}else{if(a){b=CQ.Ext.urlEncode(a)
}}return b
},createCallback:function(a){var a=a||{};
return{success:this.success,failure:this.failure,scope:this,timeout:(a.timeout*1000)||(this.form.timeout*1000),upload:this.form.fileUpload?this.success:undefined}
}};
CQ.Ext.form.Action.Submit=function(b,a){CQ.Ext.form.Action.Submit.superclass.constructor.call(this,b,a)
};
CQ.Ext.extend(CQ.Ext.form.Action.Submit,CQ.Ext.form.Action,{type:"submit",run:function(){var j=this.options,k=this.getMethod(),g=k=="GET";
if(j.clientValidation===false||this.form.isValid()){if(j.submitEmptyText===false){var a=this.form.items,c=[],b=function(m){if(m.el.getValue()==m.emptyText){c.push(m);
m.el.dom.value=""
}if(m.isComposite&&m.rendered){m.items.each(b)
}};
a.each(b)
}CQ.Ext.Ajax.request(CQ.Ext.apply(this.createCallback(j),{form:this.form.el.dom,url:this.getUrl(g),method:k,headers:j.headers,params:!g?this.getParams():null,isUpload:this.form.fileUpload}));
if(j.submitEmptyText===false){CQ.Ext.each(c,function(m){if(m.applyEmptyText){m.applyEmptyText()
}})
}}else{if(j.clientValidation!==false){this.failureType=CQ.Ext.form.Action.CLIENT_INVALID;
this.form.afterAction(this,false)
}}},success:function(b){var a=this.processResponse(b);
if(a===true||a.success){this.form.afterAction(this,true);
return
}if(a.errors){this.form.markInvalid(a.errors)
}this.failureType=CQ.Ext.form.Action.SERVER_INVALID;
this.form.afterAction(this,false)
},handleResponse:function(c){if(this.form.errorReader){var b=this.form.errorReader.read(c);
var k=[];
if(b.records){for(var g=0,a=b.records.length;
g<a;
g++){var j=b.records[g];
k[g]=j.data
}}if(k.length<1){k=null
}return{success:b.success,errors:k}
}return this.decodeResponse(c)
}});
CQ.Ext.form.Action.Load=function(b,a){CQ.Ext.form.Action.Load.superclass.constructor.call(this,b,a);
this.reader=this.form.reader
};
CQ.Ext.extend(CQ.Ext.form.Action.Load,CQ.Ext.form.Action,{type:"load",run:function(){CQ.Ext.Ajax.request(CQ.Ext.apply(this.createCallback(this.options),{method:this.getMethod(),url:this.getUrl(false),headers:this.options.headers,params:this.getParams()}))
},success:function(b){var a=this.processResponse(b);
if(a===true||!a.success||!a.data){this.failureType=CQ.Ext.form.Action.LOAD_FAILURE;
this.form.afterAction(this,false);
return
}this.form.clearInvalid();
this.form.setValues(a.data);
this.form.afterAction(this,true)
},handleResponse:function(b){if(this.form.reader){var a=this.form.reader.read(b);
var c=a.records&&a.records[0]?a.records[0].data:null;
return{success:a.success,data:c}
}return this.decodeResponse(b)
}});
CQ.Ext.form.Action.DirectLoad=CQ.Ext.extend(CQ.Ext.form.Action.Load,{constructor:function(b,a){CQ.Ext.form.Action.DirectLoad.superclass.constructor.call(this,b,a)
},type:"directload",run:function(){var a=this.getParams();
a.push(this.success,this);
this.form.api.load.apply(window,a)
},getParams:function(){var c=[],m={};
var j=this.form.baseParams;
var k=this.options.params;
CQ.Ext.apply(m,k,j);
var b=this.form.paramOrder;
if(b){for(var g=0,a=b.length;
g<a;
g++){c.push(m[b[g]])
}}else{if(this.form.paramsAsHash){c.push(m)
}}return c
},processResponse:function(a){this.result=a;
return a
},success:function(a,b){if(b.type==CQ.Ext.Direct.exceptions.SERVER){a={}
}CQ.Ext.form.Action.DirectLoad.superclass.success.call(this,a)
}});
CQ.Ext.form.Action.DirectSubmit=CQ.Ext.extend(CQ.Ext.form.Action.Submit,{constructor:function(b,a){CQ.Ext.form.Action.DirectSubmit.superclass.constructor.call(this,b,a)
},type:"directsubmit",run:function(){var a=this.options;
if(a.clientValidation===false||this.form.isValid()){this.success.params=this.getParams();
this.form.api.submit(this.form.el.dom,this.success,this)
}else{if(a.clientValidation!==false){this.failureType=CQ.Ext.form.Action.CLIENT_INVALID;
this.form.afterAction(this,false)
}}},getParams:function(){var c={};
var a=this.form.baseParams;
var b=this.options.params;
CQ.Ext.apply(c,b,a);
return c
},processResponse:function(a){this.result=a;
return a
},success:function(a,b){if(b.type==CQ.Ext.Direct.exceptions.SERVER){a={}
}CQ.Ext.form.Action.DirectSubmit.superclass.success.call(this,a)
}});
CQ.Ext.form.Action.ACTION_TYPES={load:CQ.Ext.form.Action.Load,submit:CQ.Ext.form.Action.Submit,directload:CQ.Ext.form.Action.DirectLoad,directsubmit:CQ.Ext.form.Action.DirectSubmit};
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.form.VTypes=function(){var c=/^[a-zA-Z_]+$/,g=/^[a-zA-Z0-9_]+$/,b=/^(\w+)([\-+.\'][\w]+)*@(\w[\-\w]*\.){1,5}([A-Za-z]){2,6}$/,a=/(((^https?)|(^ftp)):\/\/([\-\w]+\.)+\w{2,3}(\/[%\-\w]+(\.\w{2,})?)*(([\w\-\.\?\\\/+@&#;`~=%!]*)(\.\w{2,})?)*\/?)/i;
return{email:function(j){return b.test(j)
},emailText:'This field should be an e-mail address in the format "user@example.com"',emailMask:/[a-z0-9_\.\-\+\'@]/i,url:function(j){return a.test(j)
},urlText:'This field should be a URL in the format "http://www.example.com"',alpha:function(j){return c.test(j)
},alphaText:"This field should only contain letters and _",alphaMask:/[a-z_]/i,alphanum:function(j){return g.test(j)
},alphanumText:"This field should only contain letters, numbers and _",alphanumMask:/[a-z0-9_]/i}
}();
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.grid.GridPanel=CQ.Ext.extend(CQ.Ext.Panel,{autoExpandColumn:false,autoExpandMax:1000,autoExpandMin:50,columnLines:false,ddText:"{0} selected row{1}",deferRowRender:true,enableColumnHide:true,enableColumnMove:true,enableDragDrop:false,enableHdMenu:true,loadMask:false,minColumnWidth:25,stripeRows:false,trackMouseOver:true,stateEvents:["columnmove","columnresize","sortchange","groupchange"],view:null,bubbleEvents:[],rendered:false,viewReady:false,initComponent:function(){CQ.Ext.grid.GridPanel.superclass.initComponent.call(this);
if(this.columnLines){this.cls=(this.cls||"")+" x-grid-with-col-lines"
}this.autoScroll=false;
this.autoWidth=false;
if(CQ.Ext.isArray(this.columns)){this.colModel=new CQ.Ext.grid.ColumnModel(this.columns);
delete this.columns
}if(this.ds){this.store=this.ds;
delete this.ds
}if(this.cm){this.colModel=this.cm;
delete this.cm
}if(this.sm){this.selModel=this.sm;
delete this.sm
}this.store=CQ.Ext.StoreMgr.lookup(this.store);
this.addEvents("click","dblclick","contextmenu","mousedown","mouseup","mouseover","mouseout","keypress","keydown","cellmousedown","rowmousedown","headermousedown","groupmousedown","rowbodymousedown","containermousedown","cellclick","celldblclick","rowclick","rowdblclick","headerclick","headerdblclick","groupclick","groupdblclick","containerclick","containerdblclick","rowbodyclick","rowbodydblclick","rowcontextmenu","cellcontextmenu","headercontextmenu","groupcontextmenu","containercontextmenu","rowbodycontextmenu","bodyscroll","columnresize","columnmove","sortchange","groupchange","reconfigure","viewready")
},onRender:function(g,a){CQ.Ext.grid.GridPanel.superclass.onRender.apply(this,arguments);
var j=this.getGridEl();
this.el.addClass("x-grid-panel");
this.mon(j,{scope:this,mousedown:this.onMouseDown,click:this.onClick,dblclick:this.onDblClick,contextmenu:this.onContextMenu});
this.relayEvents(j,["mousedown","mouseup","mouseover","mouseout","keypress","keydown"]);
var b=this.getView();
b.init(this);
b.render();
this.getSelectionModel().init(this)
},initEvents:function(){CQ.Ext.grid.GridPanel.superclass.initEvents.call(this);
if(this.loadMask){this.loadMask=new CQ.Ext.LoadMask(this.bwrap,CQ.Ext.apply({store:this.store},this.loadMask))
}},initStateEvents:function(){CQ.Ext.grid.GridPanel.superclass.initStateEvents.call(this);
this.mon(this.colModel,"hiddenchange",this.saveState,this,{delay:100})
},applyState:function(a){var q=this.colModel,k=a.columns,n=this.store,t,m,r;
if(k){for(var g=0,j=k.length;
g<j;
g++){t=k[g];
m=q.getColumnById(t.id);
if(m){r=q.getIndexById(t.id);
q.setState(r,{hidden:t.hidden,width:t.width,sortable:t.sortable});
if(r!=g){q.moveColumn(r,g)
}}}}if(n){t=a.sort;
if(t){n[n.remoteSort?"setDefaultSort":"sort"](t.field,t.direction)
}t=a.group;
if(n.groupBy){if(t){n.groupBy(t)
}else{n.clearGrouping()
}}}var b=CQ.Ext.apply({},a);
delete b.columns;
delete b.sort;
CQ.Ext.grid.GridPanel.superclass.applyState.call(this,b)
},getState:function(){var k={columns:[]},b=this.store,j,a;
for(var g=0,m;
(m=this.colModel.config[g]);
g++){k.columns[g]={id:m.id,width:m.width};
if(m.hidden){k.columns[g].hidden=true
}if(m.sortable){k.columns[g].sortable=true
}}if(b){j=b.getSortState();
if(j){k.sort=j
}if(b.getGroupState){a=b.getGroupState();
if(a){k.group=a
}}}return k
},afterRender:function(){CQ.Ext.grid.GridPanel.superclass.afterRender.call(this);
var a=this.view;
this.on("bodyresize",a.layout,a);
a.layout(true);
if(this.deferRowRender){if(!this.deferRowRenderTask){this.deferRowRenderTask=new CQ.Ext.util.DelayedTask(a.afterRender,this.view)
}this.deferRowRenderTask.delay(10)
}else{a.afterRender()
}this.viewReady=true
},reconfigure:function(a,b){var c=this.rendered;
if(c){if(this.loadMask){this.loadMask.destroy();
this.loadMask=new CQ.Ext.LoadMask(this.bwrap,CQ.Ext.apply({},{store:a},this.initialConfig.loadMask))
}}if(this.view){this.view.initData(a,b)
}this.store=a;
this.colModel=b;
if(c){this.view.refresh(true)
}this.fireEvent("reconfigure",this,a,b)
},onDestroy:function(){if(this.deferRowRenderTask&&this.deferRowRenderTask.cancel){this.deferRowRenderTask.cancel()
}if(this.rendered){CQ.Ext.destroy(this.view,this.loadMask)
}else{if(this.store&&this.store.autoDestroy){this.store.destroy()
}}CQ.Ext.destroy(this.colModel,this.selModel);
this.store=this.selModel=this.colModel=this.view=this.loadMask=null;
CQ.Ext.grid.GridPanel.superclass.onDestroy.call(this)
},processEvent:function(a,b){this.view.processEvent(a,b)
},onClick:function(a){this.processEvent("click",a)
},onMouseDown:function(a){this.processEvent("mousedown",a)
},onContextMenu:function(b,a){this.processEvent("contextmenu",b)
},onDblClick:function(a){this.processEvent("dblclick",a)
},walkCells:function(q,c,b,j,o){var n=this.colModel,k=n.getColumnCount(),a=this.store,m=a.getCount(),g=true;
if(b<0){if(c<0){q--;
g=false
}while(q>=0){if(!g){c=k-1
}g=false;
while(c>=0){if(j.call(o||this,q,c,n)===true){return[q,c]
}c--
}q--
}}else{if(c>=k){q++;
g=false
}while(q<m){if(!g){c=0
}g=false;
while(c<k){if(j.call(o||this,q,c,n)===true){return[q,c]
}c++
}q++
}}return null
},getGridEl:function(){return this.body
},stopEditing:CQ.Ext.emptyFn,getSelectionModel:function(){if(!this.selModel){this.selModel=new CQ.Ext.grid.RowSelectionModel(this.disableSelection?{selectRow:CQ.Ext.emptyFn}:null)
}return this.selModel
},getStore:function(){return this.store
},getColumnModel:function(){return this.colModel
},getView:function(){if(!this.view){this.view=new CQ.Ext.grid.GridView(this.viewConfig)
}return this.view
},getDragDropText:function(){var a=this.selModel.getCount();
return String.format(this.ddText,a,a==1?"":"s")
}});
CQ.Ext.reg("grid",CQ.Ext.grid.GridPanel);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.grid.PivotGrid=CQ.Ext.extend(CQ.Ext.grid.GridPanel,{aggregator:"sum",renderer:undefined,initComponent:function(){CQ.Ext.grid.PivotGrid.superclass.initComponent.apply(this,arguments);
this.initAxes();
this.enableColumnResize=false;
this.viewConfig=CQ.Ext.apply(this.viewConfig||{},{forceFit:true});
this.colModel=new CQ.Ext.grid.ColumnModel({})
},getAggregator:function(){if(typeof this.aggregator=="string"){return CQ.Ext.grid.PivotAggregatorMgr.types[this.aggregator]
}else{return this.aggregator
}},setAggregator:function(a){this.aggregator=a
},setMeasure:function(a){this.measure=a
},setLeftAxis:function(b,a){this.leftAxis=b;
if(a){this.view.refresh()
}},setTopAxis:function(b,a){this.topAxis=b;
if(a){this.view.refresh()
}},initAxes:function(){var a=CQ.Ext.grid.PivotAxis;
if(!(this.leftAxis instanceof a)){this.setLeftAxis(new a({orientation:"vertical",dimensions:this.leftAxis||[],store:this.store}))
}if(!(this.topAxis instanceof a)){this.setTopAxis(new a({orientation:"horizontal",dimensions:this.topAxis||[],store:this.store}))
}},extractData:function(){var c=this.store.data.items,y=c.length,w=[],o,n,m,g;
if(y==0){return[]
}var q=this.leftAxis.getTuples(),u=q.length,r=this.topAxis.getTuples(),a=r.length,b=this.getAggregator();
for(n=0;
n<y;
n++){o=c[n];
for(m=0;
m<u;
m++){w[m]=w[m]||[];
if(q[m].matcher(o)===true){for(g=0;
g<a;
g++){w[m][g]=w[m][g]||[];
if(r[g].matcher(o)){w[m][g].push(o)
}}}}}var t=w.length,v,x;
for(n=0;
n<t;
n++){x=w[n];
v=x.length;
for(m=0;
m<v;
m++){w[n][m]=b(w[n][m],this.measure)
}}return w
},getView:function(){if(!this.view){this.view=new CQ.Ext.grid.PivotGridView(this.viewConfig)
}return this.view
}});
CQ.Ext.reg("pivotgrid",CQ.Ext.grid.PivotGrid);
CQ.Ext.grid.PivotAggregatorMgr=new CQ.Ext.AbstractManager();
CQ.Ext.grid.PivotAggregatorMgr.registerType("sum",function(a,c){var j=a.length,g=0,b;
for(b=0;
b<j;
b++){g+=a[b].get(c)
}return g
});
CQ.Ext.grid.PivotAggregatorMgr.registerType("avg",function(a,c){var j=a.length,g=0,b;
for(b=0;
b<j;
b++){g+=a[b].get(c)
}return(g/j)||"n/a"
});
CQ.Ext.grid.PivotAggregatorMgr.registerType("min",function(a,c){var j=[],g=a.length,b;
for(b=0;
b<g;
b++){j.push(a[b].get(c))
}return Math.min.apply(this,j)||"n/a"
});
CQ.Ext.grid.PivotAggregatorMgr.registerType("max",function(a,c){var j=[],g=a.length,b;
for(b=0;
b<g;
b++){j.push(a[b].get(c))
}return Math.max.apply(this,j)||"n/a"
});
CQ.Ext.grid.PivotAggregatorMgr.registerType("count",function(a,b){return a.length
});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.grid.GridView=CQ.Ext.extend(CQ.Ext.util.Observable,{deferEmptyText:true,scrollOffset:undefined,autoFill:false,forceFit:false,sortClasses:["sort-asc","sort-desc"],sortAscText:"Sort Ascending",sortDescText:"Sort Descending",columnsText:"Columns",selectedRowClass:"x-grid3-row-selected",borderWidth:2,tdClass:"x-grid3-cell",hdCls:"x-grid3-hd",markDirty:true,cellSelectorDepth:4,rowSelectorDepth:10,rowBodySelectorDepth:10,cellSelector:"td.x-grid3-cell",rowSelector:"div.x-grid3-row",rowBodySelector:"div.x-grid3-row-body",firstRowCls:"x-grid3-row-first",lastRowCls:"x-grid3-row-last",rowClsRe:/(?:^|\s+)x-grid3-row-(first|last|alt)(?:\s+|$)/g,headerMenuOpenCls:"x-grid3-hd-menu-open",rowOverCls:"x-grid3-row-over",constructor:function(a){CQ.Ext.apply(this,a);
this.addEvents("beforerowremoved","beforerowsinserted","beforerefresh","rowremoved","rowsinserted","rowupdated","refresh");
CQ.Ext.grid.GridView.superclass.constructor.call(this)
},masterTpl:new CQ.Ext.Template('<div class="x-grid3" hidefocus="true">','<div class="x-grid3-viewport">','<div class="x-grid3-header">','<div class="x-grid3-header-inner">','<div class="x-grid3-header-offset" style="{ostyle}">{header}</div>',"</div>",'<div class="x-clear"></div>',"</div>",'<div class="x-grid3-scroller">','<div class="x-grid3-body" style="{bstyle}">{body}</div>','<a href="#" class="x-grid3-focus" tabIndex="-1"></a>',"</div>","</div>",'<div class="x-grid3-resize-marker">&#160;</div>','<div class="x-grid3-resize-proxy">&#160;</div>',"</div>"),headerTpl:new CQ.Ext.Template('<table border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<thead>",'<tr class="x-grid3-hd-row">{cells}</tr>',"</thead>","</table>"),bodyTpl:new CQ.Ext.Template("{rows}"),cellTpl:new CQ.Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}" tabIndex="0" {cellAttr}>','<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on" {attr}>{value}</div>',"</td>"),initTemplates:function(){var c=this.templates||{},g,b,k=new CQ.Ext.Template('<td class="x-grid3-hd x-grid3-cell x-grid3-td-{id} {css}" style="{style}">','<div {tooltip} {attr} class="x-grid3-hd-inner x-grid3-hd-{id}" unselectable="on" style="{istyle}">',this.grid.enableHdMenu?'<a class="x-grid3-hd-btn" href="#"></a>':"","{value}",'<img alt="" class="x-grid3-sort-icon" src="',CQ.Ext.BLANK_IMAGE_URL,'" />',"</div>","</td>"),a=['<tr class="x-grid3-row-body-tr" style="{bodyStyle}">','<td colspan="{cols}" class="x-grid3-body-cell" tabIndex="0" hidefocus="on">','<div class="x-grid3-row-body">{body}</div>',"</td>","</tr>"].join(""),j=['<table class="x-grid3-row-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody>","<tr>{cells}</tr>",this.enableRowBody?a:"","</tbody>","</table>"].join("");
CQ.Ext.applyIf(c,{hcell:k,cell:this.cellTpl,body:this.bodyTpl,header:this.headerTpl,master:this.masterTpl,row:new CQ.Ext.Template('<div class="x-grid3-row {alt}" style="{tstyle}">'+j+"</div>"),rowInner:new CQ.Ext.Template(j)});
for(b in c){g=c[b];
if(g&&CQ.Ext.isFunction(g.compile)&&!g.compiled){g.disableFormats=true;
g.compile()
}}this.templates=c;
this.colRe=new RegExp("x-grid3-td-([^\\s]+)","")
},fly:function(a){if(!this._flyweight){this._flyweight=new CQ.Ext.Element.Flyweight(document.body)
}this._flyweight.dom=a;
return this._flyweight
},getEditorParent:function(){return this.scroller.dom
},initElements:function(){var b=CQ.Ext.Element,g=CQ.Ext.get(this.grid.getGridEl().dom.firstChild),j=new b(g.child("div.x-grid3-viewport")),c=new b(j.child("div.x-grid3-header")),a=new b(j.child("div.x-grid3-scroller"));
if(this.grid.hideHeaders){c.setDisplayed(false)
}if(this.forceFit){a.setStyle("overflow-x","hidden")
}CQ.Ext.apply(this,{el:g,mainWrap:j,scroller:a,mainHd:c,innerHd:c.child("div.x-grid3-header-inner").dom,mainBody:new b(b.fly(a).child("div.x-grid3-body")),focusEl:new b(b.fly(a).child("a")),resizeMarker:new b(g.child("div.x-grid3-resize-marker")),resizeProxy:new b(g.child("div.x-grid3-resize-proxy"))});
this.focusEl.swallowEvent("click",true)
},getRows:function(){return this.hasRows()?this.mainBody.dom.childNodes:[]
},findCell:function(a){if(!a){return false
}return this.fly(a).findParent(this.cellSelector,this.cellSelectorDepth)
},findCellIndex:function(g,c){var b=this.findCell(g),a;
if(b){a=this.fly(b).hasClass(c);
if(!c||a){return this.getCellIndex(b)
}}return false
},getCellIndex:function(b){if(b){var a=b.className.match(this.colRe);
if(a&&a[1]){return this.cm.getIndexById(a[1])
}}return false
},findHeaderCell:function(b){var a=this.findCell(b);
return a&&this.fly(a).hasClass(this.hdCls)?a:null
},findHeaderIndex:function(a){return this.findCellIndex(a,this.hdCls)
},findRow:function(a){if(!a){return false
}return this.fly(a).findParent(this.rowSelector,this.rowSelectorDepth)
},findRowIndex:function(a){var b=this.findRow(a);
return b?b.rowIndex:false
},findRowBody:function(a){if(!a){return false
}return this.fly(a).findParent(this.rowBodySelector,this.rowBodySelectorDepth)
},getRow:function(a){return this.getRows()[a]
},getCell:function(b,a){return CQ.Ext.fly(this.getRow(b)).query(this.cellSelector)[a]
},getHeaderCell:function(a){return this.mainHd.dom.getElementsByTagName("td")[a]
},addRowClass:function(b,a){var c=this.getRow(b);
if(c){this.fly(c).addClass(a)
}},removeRowClass:function(c,a){var b=this.getRow(c);
if(b){this.fly(b).removeClass(a)
}},removeRow:function(a){CQ.Ext.removeNode(this.getRow(a));
this.syncFocusEl(a)
},removeRows:function(c,a){var b=this.mainBody.dom,g;
for(g=c;
g<=a;
g++){CQ.Ext.removeNode(b.childNodes[c])
}this.syncFocusEl(c)
},getScrollState:function(){var a=this.scroller.dom;
return{left:a.scrollLeft,top:a.scrollTop}
},restoreScroll:function(a){var b=this.scroller.dom;
b.scrollLeft=a.left;
b.scrollTop=a.top
},scrollToTop:function(){var a=this.scroller.dom;
a.scrollTop=0;
a.scrollLeft=0
},syncScroll:function(){this.syncHeaderScroll();
var a=this.scroller.dom;
this.grid.fireEvent("bodyscroll",a.scrollLeft,a.scrollTop)
},syncHeaderScroll:function(){var a=this.innerHd,b=this.scroller.dom.scrollLeft;
a.scrollLeft=b;
a.scrollLeft=b
},updateSortIcon:function(g,c){var a=this.sortClasses,b=a[c=="DESC"?1:0],j=this.mainHd.select("td").removeClass(a);
j.item(g).addClass(b)
},updateAllColumnWidths:function(){var k=this.getTotalWidth(),o=this.cm.getColumnCount(),r=this.getRows(),m=r.length,b=[],q,a,n,g,c;
for(g=0;
g<o;
g++){b[g]=this.getColumnWidth(g);
this.getHeaderCell(g).style.width=b[g]
}this.updateHeaderWidth();
for(g=0;
g<m;
g++){q=r[g];
q.style.width=k;
a=q.firstChild;
if(a){a.style.width=k;
n=a.rows[0];
for(c=0;
c<o;
c++){n.childNodes[c].style.width=b[c]
}}}this.onAllColumnWidthsUpdated(b,k)
},updateColumnWidth:function(g,b){var c=this.getColumnWidth(g),n=this.getTotalWidth(),m=this.getHeaderCell(g),a=this.getRows(),j=a.length,q,k,o;
this.updateHeaderWidth();
m.style.width=c;
for(k=0;
k<j;
k++){q=a[k];
o=q.firstChild;
q.style.width=n;
if(o){o.style.width=n;
o.rows[0].childNodes[g].style.width=c
}}this.onColumnWidthUpdated(g,c,n)
},updateColumnHidden:function(b,n){var m=this.getTotalWidth(),o=n?"none":"",k=this.getHeaderCell(b),a=this.getRows(),g=a.length,q,c,j;
this.updateHeaderWidth();
k.style.display=o;
for(j=0;
j<g;
j++){q=a[j];
q.style.width=m;
c=q.firstChild;
if(c){c.style.width=m;
c.rows[0].childNodes[b].style.display=o
}}this.onColumnHiddenUpdated(b,n,m);
delete this.lastViewWidth;
this.layout()
},doRender:function(g,B,r,a,x,z){var n=this.templates,c=n.cell,E=n.row,u=x-1,b="width:"+this.getTotalWidth()+";",o=[],q=[],t={tstyle:b},w={},C=B.length,D,m,k,A,y,v;
for(y=0;
y<C;
y++){k=B[y];
q=[];
v=y+a;
for(A=0;
A<x;
A++){m=g[A];
w.id=m.id;
w.css=A===0?"x-grid3-cell-first ":(A==u?"x-grid3-cell-last ":"");
w.attr=w.cellAttr="";
w.style=m.style;
w.value=m.renderer.call(m.scope,k.data[m.name],w,k,v,A,r);
if(CQ.Ext.isEmpty(w.value)){w.value="&#160;"
}if(this.markDirty&&k.dirty&&typeof k.modified[m.name]!="undefined"){w.css+=" x-grid3-dirty-cell"
}q[q.length]=c.apply(w)
}D=[];
if(z&&((v+1)%2===0)){D[0]="x-grid3-row-alt"
}if(k.dirty){D[1]=" x-grid3-dirty-row"
}t.cols=x;
if(this.getRowClass){D[2]=this.getRowClass(k,v,t,r)
}t.alt=D.join(" ");
t.cells=q.join("");
o[o.length]=E.apply(t)
}return o.join("")
},processRows:function(a,k){if(!this.ds||this.ds.getCount()<1){return
}var g=this.getRows(),c=g.length,j,b;
k=k||!this.grid.stripeRows;
a=a||0;
for(b=0;
b<c;
b++){j=g[b];
if(j){j.rowIndex=b;
if(!k){j.className=j.className.replace(this.rowClsRe," ");
if((b+1)%2===0){j.className+=" x-grid3-row-alt"
}}}}if(a===0){CQ.Ext.fly(g[0]).addClass(this.firstRowCls)
}CQ.Ext.fly(g[c-1]).addClass(this.lastRowCls)
},afterRender:function(){if(!this.ds||!this.cm){return
}this.mainBody.dom.innerHTML=this.renderBody()||"&#160;";
this.processRows(0,true);
if(this.deferEmptyText!==true){this.applyEmptyText()
}this.grid.fireEvent("viewready",this.grid)
},afterRenderUI:function(){var a=this.grid;
this.initElements();
CQ.Ext.fly(this.innerHd).on("click",this.handleHdDown,this);
this.mainHd.on({scope:this,mouseover:this.handleHdOver,mouseout:this.handleHdOut,mousemove:this.handleHdMove});
this.scroller.on("scroll",this.syncScroll,this);
if(a.enableColumnResize!==false){this.splitZone=new CQ.Ext.grid.GridView.SplitDragZone(a,this.mainHd.dom)
}if(a.enableColumnMove){this.columnDrag=new CQ.Ext.grid.GridView.ColumnDragZone(a,this.innerHd);
this.columnDrop=new CQ.Ext.grid.HeaderDropZone(a,this.mainHd.dom)
}if(a.enableHdMenu!==false){this.hmenu=new CQ.Ext.menu.Menu({id:a.id+"-hctx"});
this.hmenu.add({itemId:"asc",text:this.sortAscText,cls:"xg-hmenu-sort-asc"},{itemId:"desc",text:this.sortDescText,cls:"xg-hmenu-sort-desc"});
if(a.enableColumnHide!==false){this.colMenu=new CQ.Ext.menu.Menu({id:a.id+"-hcols-menu"});
this.colMenu.on({scope:this,beforeshow:this.beforeColMenuShow,itemclick:this.handleHdMenuClick});
this.hmenu.add("-",{itemId:"columns",hideOnClick:false,text:this.columnsText,menu:this.colMenu,iconCls:"x-cols-icon"})
}this.hmenu.on("itemclick",this.handleHdMenuClick,this)
}if(a.trackMouseOver){this.mainBody.on({scope:this,mouseover:this.onRowOver,mouseout:this.onRowOut})
}if(a.enableDragDrop||a.enableDrag){this.dragZone=new CQ.Ext.grid.GridDragZone(a,{ddGroup:a.ddGroup||"GridDD"})
}this.updateHeaderSortState()
},renderUI:function(){var a=this.templates;
return a.master.apply({body:a.body.apply({rows:"&#160;"}),header:this.renderHeaders(),ostyle:"width:"+this.getOffsetWidth()+";",bstyle:"width:"+this.getTotalWidth()+";"})
},processEvent:function(b,k){var m=k.getTarget(),a=this.grid,g=this.findHeaderIndex(m),o,n,c,j;
a.fireEvent(b,k);
if(g!==false){a.fireEvent("header"+b,a,g,k)
}else{o=this.findRowIndex(m);
if(o!==false){n=this.findCellIndex(m);
if(n!==false){c=a.colModel.getColumnAt(n);
if(a.fireEvent("cell"+b,a,o,n,k)!==false){if(!c||(c.processEvent&&(c.processEvent(b,k,a,o,n)!==false))){a.fireEvent("row"+b,a,o,k)
}}}else{if(a.fireEvent("row"+b,a,o,k)!==false){(j=this.findRowBody(m))&&a.fireEvent("rowbody"+b,a,o,k)
}}}else{a.fireEvent("container"+b,a,k)
}}},layout:function(o){if(!this.mainBody){return
}var a=this.grid,g=a.getGridEl(),c=g.getSize(true),n=c.width,b=c.height,m=this.scroller,k,j,q;
if(n<20||b<20){return
}if(a.autoHeight){k=m.dom.style;
k.overflow="visible";
if(CQ.Ext.isWebKit){k.position="static"
}}else{this.el.setSize(n,b);
j=this.mainHd.getHeight();
q=b-j;
m.setSize(n,q);
if(this.innerHd){this.innerHd.style.width=(n)+"px"
}}if(this.forceFit||(o===true&&this.autoFill)){if(this.lastViewWidth!=n){this.fitColumns(false,false);
this.lastViewWidth=n
}}else{this.autoExpand();
this.syncHeaderScroll()
}this.onLayout(n,q)
},onLayout:function(a,b){},onColumnWidthUpdated:function(c,a,b){},onAllColumnWidthsUpdated:function(a,b){},onColumnHiddenUpdated:function(b,c,a){},updateColumnText:function(a,b){},afterMove:function(a){},init:function(a){this.grid=a;
this.initTemplates();
this.initData(a.store,a.colModel);
this.initUI(a)
},getColumnId:function(a){return this.cm.getColumnId(a)
},getOffsetWidth:function(){return(this.cm.getTotalWidth()+this.getScrollOffset())+"px"
},getScrollOffset:function(){return CQ.Ext.num(this.scrollOffset,CQ.Ext.getScrollBarWidth())
},renderHeaders:function(){var j=this.cm,k=this.templates,a=k.hcell,g={},m=j.getColumnCount(),n=m-1,o=[],c,b;
for(c=0;
c<m;
c++){if(c==0){b="x-grid3-cell-first "
}else{b=c==n?"x-grid3-cell-last ":""
}g={id:j.getColumnId(c),value:j.getColumnHeader(c)||"",style:this.getColumnStyle(c,true),css:b,tooltip:this.getColumnTooltip(c)};
if(j.config[c].align=="right"){g.istyle="padding-right: 16px;"
}else{delete g.istyle
}o[c]=a.apply(g)
}return k.header.apply({cells:o.join(""),tstyle:String.format("width: {0};",this.getTotalWidth())})
},getColumnTooltip:function(a){var b=this.cm.getColumnTooltip(a);
if(b){if(CQ.Ext.QuickTips.isEnabled()){return'ext:qtip="'+b+'"'
}else{return'title="'+b+'"'
}}return""
},beforeUpdate:function(){this.grid.stopEditing(true)
},updateHeaders:function(){this.innerHd.firstChild.innerHTML=this.renderHeaders();
this.updateHeaderWidth(false)
},updateHeaderWidth:function(c){var b=this.innerHd.firstChild,a=this.getTotalWidth();
b.style.width=this.getOffsetWidth();
b.firstChild.style.width=a;
if(c!==false){this.mainBody.dom.style.width=a
}},focusRow:function(a){this.focusCell(a,0,false)
},focusCell:function(g,b,c){this.syncFocusEl(this.ensureVisible(g,b,c));
var a=this.focusEl;
if(CQ.Ext.isGecko){a.focus()
}else{a.focus.defer(1,a)
}},resolveCell:function(m,g,k){if(!CQ.Ext.isNumber(m)){m=m.rowIndex
}if(!this.ds){return null
}if(m<0||m>=this.ds.getCount()){return null
}g=(g!==undefined?g:0);
var c=this.getRow(m),b=this.cm,j=b.getColumnCount(),a;
if(!(k===false&&g===0)){while(g<j&&b.isHidden(g)){g++
}a=this.getCell(m,g)
}return{row:c,cell:a}
},getResolvedXY:function(b){if(!b){return null
}var a=b.cell,c=b.row;
if(a){return CQ.Ext.fly(a).getXY()
}else{return[this.el.getX(),CQ.Ext.fly(c).getY()]
}},syncFocusEl:function(g,a,c){var b=g;
if(!CQ.Ext.isArray(b)){g=Math.min(g,Math.max(0,this.getRows().length-1));
if(isNaN(g)){return
}b=this.getResolvedXY(this.resolveCell(g,a,c))
}this.focusEl.setXY(b||this.scroller.getXY())
},ensureVisible:function(z,k,j){var x=this.resolveCell(z,k,j);
if(!x||!x.row){return null
}var q=x.row,m=x.cell,u=this.scroller.dom,g=q,y=0,v=this.el.dom;
while(g&&g!=v){y+=g.offsetTop;
g=g.offsetParent
}y-=this.mainHd.dom.offsetHeight;
v=parseInt(u.scrollTop,10);
var w=y+q.offsetHeight,a=u.clientHeight,t=v+a;
if(y<v){u.scrollTop=y
}else{if(w>t){u.scrollTop=w-a
}}if(j!==false){var r=parseInt(m.offsetLeft,10),o=r+m.offsetWidth,n=parseInt(u.scrollLeft,10),b=n+u.clientWidth;
if(r<n){u.scrollLeft=r
}else{if(o>b){u.scrollLeft=o-u.clientWidth
}}}return this.getResolvedXY(x)
},insertRows:function(a,n,j,m){var g=a.getCount()-1;
if(!m&&n===0&&j>=g){this.fireEvent("beforerowsinserted",this,n,j);
this.refresh();
this.fireEvent("rowsinserted",this,n,j)
}else{if(!m){this.fireEvent("beforerowsinserted",this,n,j)
}var b=this.renderRows(n,j),k=this.getRow(n);
if(k){if(n===0){CQ.Ext.fly(this.getRow(0)).removeClass(this.firstRowCls)
}CQ.Ext.DomHelper.insertHtml("beforeBegin",k,b)
}else{var c=this.getRow(g-1);
if(c){CQ.Ext.fly(c).removeClass(this.lastRowCls)
}CQ.Ext.DomHelper.insertHtml("beforeEnd",this.mainBody.dom,b)
}if(!m){this.processRows(n);
this.fireEvent("rowsinserted",this,n,j)
}else{if(n===0||n>=g){CQ.Ext.fly(this.getRow(n)).addClass(n===0?this.firstRowCls:this.lastRowCls)
}}}this.syncFocusEl(n)
},deleteRows:function(a,c,b){if(a.getRowCount()<1){this.refresh()
}else{this.fireEvent("beforerowsdeleted",this,c,b);
this.removeRows(c,b);
this.processRows(c);
this.fireEvent("rowsdeleted",this,c,b)
}},getColumnStyle:function(b,g){var a=this.cm,k=a.config,c=g?"":k[b].css||"",j=k[b].align;
c+=String.format("width: {0};",this.getColumnWidth(b));
if(a.isHidden(b)){c+="display: none; "
}if(j){c+=String.format("text-align: {0};",j)
}return c
},getColumnWidth:function(b){var c=this.cm.getColumnWidth(b),a=this.borderWidth;
if(CQ.Ext.isNumber(c)){if(CQ.Ext.isBorderBox||(CQ.Ext.isWebKit&&!CQ.Ext.isSafari2)){return c+"px"
}else{return Math.max(c-a,0)+"px"
}}else{return c
}},getTotalWidth:function(){return this.cm.getTotalWidth()+"px"
},fitColumns:function(k,n,m){var a=this.grid,q=this.cm,y=q.getTotalWidth(false),w=this.getGridInnerWidth(),x=w-y,c=[],u=0,t=0,A,g,v;
if(w<20||x===0){return false
}var j=q.getColumnCount(true),r=q.getColumnCount(false),b=j-(CQ.Ext.isNumber(m)?1:0);
if(b===0){b=1;
m=undefined
}for(v=0;
v<r;
v++){if(!q.isFixed(v)&&v!==m){A=q.getColumnWidth(v);
c.push(v,A);
if(!q.isHidden(v)){u=v;
t+=A
}}}g=(w-q.getTotalWidth())/t;
while(c.length){A=c.pop();
v=c.pop();
q.setColumnWidth(v,Math.max(a.minColumnWidth,Math.floor(A+A*g)),true)
}y=q.getTotalWidth(false);
if(y>w){var z=(b==j)?u:m,o=Math.max(1,q.getColumnWidth(z)-(y-w));
q.setColumnWidth(z,o,true)
}if(k!==true){this.updateAllColumnWidths()
}return true
},autoExpand:function(q){var a=this.grid,n=this.cm,j=this.getGridInnerWidth(),c=n.getTotalWidth(false),k=a.autoExpandColumn;
if(!this.userResized&&k){if(j!=c){var o=n.getIndexById(k),b=n.getColumnWidth(o),m=j-c+b,g=Math.min(Math.max(m,a.autoExpandMin),a.autoExpandMax);
if(b!=g){n.setColumnWidth(o,g,true);
if(q!==true){this.updateColumnWidth(o,g)
}}}}},getGridInnerWidth:function(){return this.grid.getGridEl().getWidth(true)-this.getScrollOffset()
},getColumnData:function(){var j=[],c=this.cm,k=c.getColumnCount(),a=this.ds.fields,g,b;
for(g=0;
g<k;
g++){b=c.getDataIndex(g);
j[g]={name:CQ.Ext.isDefined(b)?b:(a.get(g)?a.get(g).name:undefined),renderer:c.getRenderer(g),scope:c.getRendererScope(g),id:c.getColumnId(g),style:this.getColumnStyle(g)}
}return j
},renderRows:function(n,c){var a=this.grid,k=a.store,o=a.stripeRows,j=a.colModel,m=j.getColumnCount(),g=k.getCount(),b;
if(g<1){return""
}n=n||0;
c=CQ.Ext.isDefined(c)?c:g-1;
b=k.getRange(n,c);
return this.doRender(this.getColumnData(),b,k,n,m,o)
},renderBody:function(){var a=this.renderRows()||"&#160;";
return this.templates.body.apply({rows:a})
},refreshRow:function(k){var q=this.ds,r=this.cm.getColumnCount(),c=this.getColumnData(),t=r-1,v=["x-grid3-row"],j={tstyle:String.format("width: {0};",this.getTotalWidth())},a=[],o=this.templates.cell,n,w,b,u,m,g;
if(CQ.Ext.isNumber(k)){n=k;
k=q.getAt(n)
}else{n=q.indexOf(k)
}if(!k||n<0){return
}for(g=0;
g<r;
g++){b=c[g];
if(g==0){m="x-grid3-cell-first"
}else{m=(g==t)?"x-grid3-cell-last ":""
}u={id:b.id,style:b.style,css:m,attr:"",cellAttr:""};
u.value=b.renderer.call(b.scope,k.data[b.name],u,k,n,g,q);
if(CQ.Ext.isEmpty(u.value)){u.value="&#160;"
}if(this.markDirty&&k.dirty&&typeof k.modified[b.name]!="undefined"){u.css+=" x-grid3-dirty-cell"
}a[g]=o.apply(u)
}w=this.getRow(n);
w.className="";
if(this.grid.stripeRows&&((n+1)%2===0)){v.push("x-grid3-row-alt")
}if(this.getRowClass){j.cols=r;
v.push(this.getRowClass(k,n,j,q))
}this.fly(w).addClass(v).setStyle(j.tstyle);
j.cells=a.join("");
w.innerHTML=this.templates.rowInner.apply(j);
this.fireEvent("rowupdated",this,n,k)
},refresh:function(b){this.fireEvent("beforerefresh",this);
if(!this.grid){return
}this.grid.stopEditing(true);
var a=this.renderBody();
this.mainBody.update(a).setWidth(this.getTotalWidth());
if(b===true){this.updateHeaders();
this.updateHeaderSortState()
}this.processRows(0,true);
this.layout();
this.applyEmptyText();
this.fireEvent("refresh",this)
},applyEmptyText:function(){if(this.emptyText&&!this.hasRows()){this.mainBody.update('<div class="x-grid-empty">'+this.emptyText+"</div>")
}},updateHeaderSortState:function(){var b=this.ds.getSortState();
if(!b){return
}if(!this.sortState||(this.sortState.field!=b.field||this.sortState.direction!=b.direction)){this.grid.fireEvent("sortchange",this.grid,b)
}this.sortState=b;
var c=this.cm.findColumnIndex(b.field);
if(c!=-1){var a=b.direction;
this.updateSortIcon(c,a)
}},clearHeaderSortState:function(){if(!this.sortState){return
}this.grid.fireEvent("sortchange",this.grid,null);
this.mainHd.select("td").removeClass(this.sortClasses);
delete this.sortState
},destroy:function(){var o=this,a=o.grid,g=a.getGridEl(),n=o.dragZone,k=o.splitZone,m=o.columnDrag,j=o.columnDrop,q=o.scrollToTopTask,c,b;
if(q&&q.cancel){q.cancel()
}CQ.Ext.destroyMembers(o,"colMenu","hmenu");
o.initData(null,null);
o.purgeListeners();
CQ.Ext.fly(o.innerHd).un("click",o.handleHdDown,o);
if(a.enableColumnMove){c=m.dragData;
b=m.proxy;
CQ.Ext.destroy(m.el,b.ghost,b.el,j.el,j.proxyTop,j.proxyBottom,c.ddel,c.header);
if(b.anim){CQ.Ext.destroy(b.anim)
}delete b.ghost;
delete c.ddel;
delete c.header;
m.destroy();
delete CQ.Ext.dd.DDM.locationCache[m.id];
delete m._domRef;
delete j.proxyTop;
delete j.proxyBottom;
j.destroy();
delete CQ.Ext.dd.DDM.locationCache["gridHeader"+g.id];
delete j._domRef;
delete CQ.Ext.dd.DDM.ids[j.ddGroup]
}if(k){k.destroy();
delete k._domRef;
delete CQ.Ext.dd.DDM.ids["gridSplitters"+g.id]
}CQ.Ext.fly(o.innerHd).removeAllListeners();
CQ.Ext.removeNode(o.innerHd);
delete o.innerHd;
CQ.Ext.destroy(o.el,o.mainWrap,o.mainHd,o.scroller,o.mainBody,o.focusEl,o.resizeMarker,o.resizeProxy,o.activeHdBtn,o._flyweight,n,k);
delete a.container;
if(n){n.destroy()
}CQ.Ext.dd.DDM.currentTarget=null;
delete CQ.Ext.dd.DDM.locationCache[g.id];
CQ.Ext.EventManager.removeResizeListener(o.onWindowResize,o)
},onDenyColumnHide:function(){},render:function(){if(this.autoFill){var a=this.grid.ownerCt;
if(a&&a.getLayout()){a.on("afterlayout",function(){this.fitColumns(true,true);
this.updateHeaders();
this.updateHeaderSortState()
},this,{single:true})
}}else{if(this.forceFit){this.fitColumns(true,false)
}else{if(this.grid.autoExpandColumn){this.autoExpand(true)
}}}this.grid.getGridEl().dom.innerHTML=this.renderUI();
this.afterRenderUI()
},initData:function(a,j){var b=this;
if(b.ds){var g=b.ds;
g.un("add",b.onAdd,b);
g.un("load",b.onLoad,b);
g.un("clear",b.onClear,b);
g.un("remove",b.onRemove,b);
g.un("update",b.onUpdate,b);
g.un("datachanged",b.onDataChange,b);
if(g!==a&&g.autoDestroy){g.destroy()
}}if(a){a.on({scope:b,load:b.onLoad,add:b.onAdd,remove:b.onRemove,update:b.onUpdate,clear:b.onClear,datachanged:b.onDataChange})
}if(b.cm){var c=b.cm;
c.un("configchange",b.onColConfigChange,b);
c.un("widthchange",b.onColWidthChange,b);
c.un("headerchange",b.onHeaderChange,b);
c.un("hiddenchange",b.onHiddenChange,b);
c.un("columnmoved",b.onColumnMove,b)
}if(j){delete b.lastViewWidth;
j.on({scope:b,configchange:b.onColConfigChange,widthchange:b.onColWidthChange,headerchange:b.onHeaderChange,hiddenchange:b.onHiddenChange,columnmoved:b.onColumnMove})
}b.ds=a;
b.cm=j
},onDataChange:function(){this.refresh(true);
this.updateHeaderSortState();
this.syncFocusEl(0)
},onClear:function(){this.refresh();
this.syncFocusEl(0)
},onUpdate:function(b,a){this.refreshRow(a)
},onAdd:function(b,a,c){this.insertRows(b,c,c+(a.length-1))
},onRemove:function(b,a,c,g){if(g!==true){this.fireEvent("beforerowremoved",this,c,a)
}this.removeRow(c);
if(g!==true){this.processRows(c);
this.applyEmptyText();
this.fireEvent("rowremoved",this,c,a)
}},onLoad:function(){if(CQ.Ext.isGecko){if(!this.scrollToTopTask){this.scrollToTopTask=new CQ.Ext.util.DelayedTask(this.scrollToTop,this)
}this.scrollToTopTask.delay(1)
}else{this.scrollToTop()
}},onColWidthChange:function(a,b,c){this.updateColumnWidth(b,c)
},onHeaderChange:function(a,b,c){this.updateHeaders()
},onHiddenChange:function(a,b,c){this.updateColumnHidden(b,c)
},onColumnMove:function(a,c,b){this.indexMap=null;
this.refresh(true);
this.restoreScroll(this.getScrollState());
this.afterMove(b);
this.grid.fireEvent("columnmove",c,b)
},onColConfigChange:function(){delete this.lastViewWidth;
this.indexMap=null;
this.refresh(true)
},initUI:function(a){a.on("headerclick",this.onHeaderClick,this)
},initEvents:CQ.Ext.emptyFn,onHeaderClick:function(b,a){if(this.headersDisabled||!this.cm.isSortable(a)){return
}b.stopEditing(true);
b.store.sort(this.cm.getDataIndex(a))
},onRowOver:function(b,a){var c=this.findRowIndex(a);
if(c!==false){this.addRowClass(c,this.rowOverCls)
}},onRowOut:function(b,a){var c=this.findRowIndex(a);
if(c!==false&&!b.within(this.getRow(c),true)){this.removeRowClass(c,this.rowOverCls)
}},onRowSelect:function(a){this.addRowClass(a,this.selectedRowClass)
},onRowDeselect:function(a){this.removeRowClass(a,this.selectedRowClass)
},onCellSelect:function(c,b){var a=this.getCell(c,b);
if(a){this.fly(a).addClass("x-grid3-cell-selected")
}},onCellDeselect:function(c,b){var a=this.getCell(c,b);
if(a){this.fly(a).removeClass("x-grid3-cell-selected")
}},handleWheel:function(a){a.stopPropagation()
},onColumnSplitterMoved:function(a,b){this.userResized=true;
this.grid.colModel.setColumnWidth(a,b,true);
if(this.forceFit){this.fitColumns(true,false,a);
this.updateAllColumnWidths()
}else{this.updateColumnWidth(a,b);
this.syncHeaderScroll()
}this.grid.fireEvent("columnresize",a,b)
},beforeColMenuShow:function(){var b=this.cm,g=b.getColumnCount(),a=this.colMenu,c;
a.removeAll();
for(c=0;
c<g;
c++){if(b.config[c].hideable!==false){a.add(new CQ.Ext.menu.CheckItem({text:b.getColumnHeader(c),itemId:"col-"+b.getColumnId(c),checked:!b.isHidden(c),disabled:b.config[c].hideable===false,hideOnClick:false}))
}}},handleHdMenuClick:function(c){var a=this.ds,b=this.cm.getDataIndex(this.hdCtxIndex);
switch(c.getItemId()){case"asc":a.sort(b,"ASC");
break;
case"desc":a.sort(b,"DESC");
break;
default:this.handleHdMenuClickDefault(c)
}return true
},handleHdMenuClickDefault:function(c){var b=this.cm,g=c.getItemId(),a=b.getIndexById(g.substr(4));
if(a!=-1){if(c.checked&&b.getColumnsBy(this.isHideableColumn,this).length<=1){this.onDenyColumnHide();
return
}b.setHidden(a,c.checked)
}},handleHdDown:function(m,n){if(CQ.Ext.fly(n).hasClass("x-grid3-hd-btn")){m.stopEvent();
var o=this.cm,j=this.findHeaderCell(n),k=this.getCellIndex(j),g=o.isSortable(k),c=this.hmenu,b=c.items,a=this.headerMenuOpenCls;
this.hdCtxIndex=k;
CQ.Ext.fly(j).addClass(a);
b.get("asc").setDisabled(!g);
b.get("desc").setDisabled(!g);
c.on("hide",function(){CQ.Ext.fly(j).removeClass(a)
},this,{single:true});
c.show(n,"tl-bl?")
}},handleHdMove:function(o){var m=this.findHeaderCell(this.activeHdRef);
if(m&&!this.headersDisabled){var q=this.splitHandleWidth||5,n=this.activeHdRegion,v=m.style,r=this.cm,u="",j=o.getPageX();
if(this.grid.enableColumnResize!==false){var a=this.activeHdIndex,b=this.getPreviousVisible(a),t=r.isResizable(a),c=b&&r.isResizable(b),g=j-n.left<=q,k=n.right-j<=(!this.activeHdBtn?q:2);
if(g&&c){u=CQ.Ext.isAir?"move":CQ.Ext.isWebKit?"e-resize":"col-resize"
}else{if(k&&t){u=CQ.Ext.isAir?"move":CQ.Ext.isWebKit?"w-resize":"col-resize"
}}}v.cursor=u
}},getPreviousVisible:function(a){while(a>0){if(!this.cm.isHidden(a-1)){return a
}a--
}return undefined
},handleHdOver:function(c,b){var g=this.findHeaderCell(b);
if(g&&!this.headersDisabled){var a=this.fly(g);
this.activeHdRef=b;
this.activeHdIndex=this.getCellIndex(g);
this.activeHdRegion=a.getRegion();
if(!this.isMenuDisabled(this.activeHdIndex,a)){a.addClass("x-grid3-hd-over");
this.activeHdBtn=a.child(".x-grid3-hd-btn");
if(this.activeHdBtn){this.activeHdBtn.dom.style.height=(g.firstChild.offsetHeight-1)+"px"
}}}},handleHdOut:function(b,a){var c=this.findHeaderCell(a);
if(c&&(!CQ.Ext.isIE||!b.within(c,true))){this.activeHdRef=null;
this.fly(c).removeClass("x-grid3-hd-over");
c.style.cursor=""
}},isMenuDisabled:function(a,b){return this.cm.isMenuDisabled(a)
},hasRows:function(){var a=this.mainBody.dom.firstChild;
return a&&a.nodeType==1&&a.className!="x-grid-empty"
},isHideableColumn:function(a){return !a.hidden
},bind:function(a,b){this.initData(a,b)
}});
CQ.Ext.grid.GridView.SplitDragZone=CQ.Ext.extend(CQ.Ext.dd.DDProxy,{constructor:function(a,b){this.grid=a;
this.view=a.getView();
this.marker=this.view.resizeMarker;
this.proxy=this.view.resizeProxy;
CQ.Ext.grid.GridView.SplitDragZone.superclass.constructor.call(this,b,"gridSplitters"+this.grid.getGridEl().id,{dragElId:CQ.Ext.id(this.proxy.dom),resizeFrame:false});
this.scroll=false;
this.hw=this.view.splitHandleWidth||5
},b4StartDrag:function(a,j){this.dragHeadersDisabled=this.view.headersDisabled;
this.view.headersDisabled=true;
var g=this.view.mainWrap.getHeight();
this.marker.setHeight(g);
this.marker.show();
this.marker.alignTo(this.view.getHeaderCell(this.cellIndex),"tl-tl",[-2,0]);
this.proxy.setHeight(g);
var b=this.cm.getColumnWidth(this.cellIndex),c=Math.max(b-this.grid.minColumnWidth,0);
this.resetConstraints();
this.setXConstraint(c,1000);
this.setYConstraint(0,0);
this.minX=a-c;
this.maxX=a+1000;
this.startPos=a;
CQ.Ext.dd.DDProxy.prototype.b4StartDrag.call(this,a,j)
},allowHeaderDrag:function(a){return true
},handleMouseDown:function(a){var k=this.view.findHeaderCell(a.getTarget());
if(k&&this.allowHeaderDrag(a)){var o=this.view.fly(k).getXY(),c=o[0],m=a.getXY(),b=m[0],j=k.offsetWidth,g=false;
if((b-c)<=this.hw){g=-1
}else{if((c+j)-b<=this.hw){g=0
}}if(g!==false){this.cm=this.grid.colModel;
var n=this.view.getCellIndex(k);
if(g==-1){if(n+g<0){return
}while(this.cm.isHidden(n+g)){--g;
if(n+g<0){return
}}}this.cellIndex=n+g;
this.split=k.dom;
if(this.cm.isResizable(this.cellIndex)&&!this.cm.isFixed(this.cellIndex)){CQ.Ext.grid.GridView.SplitDragZone.superclass.handleMouseDown.apply(this,arguments)
}}else{if(this.view.columnDrag){this.view.columnDrag.callHandleMouseDown(a)
}}}},endDrag:function(j){this.marker.hide();
var a=this.view,c=Math.max(this.minX,j.getPageX()),g=c-this.startPos,b=this.dragHeadersDisabled;
a.onColumnSplitterMoved(this.cellIndex,this.cm.getColumnWidth(this.cellIndex)+g);
setTimeout(function(){a.headersDisabled=b
},50)
},autoOffset:function(){this.setDelta(0,0)
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.grid.PivotGridView=CQ.Ext.extend(CQ.Ext.grid.GridView,{colHeaderCellCls:"grid-hd-group-cell",title:"",getColumnHeaders:function(){return this.grid.topAxis.buildHeaders()
},getRowHeaders:function(){return this.grid.leftAxis.buildHeaders()
},renderRows:function(a,z){var b=this.grid,u=b.extractData(),v=u.length,m=this.templates,y=b.renderer,n=typeof y=="function",C=this.getCellCls,t=typeof C=="function",g=m.cell,D=m.row,o=[],w={},c="width:"+this.getGridInnerWidth()+"px;",q,x,k,B,r;
a=a||0;
z=CQ.Ext.isDefined(z)?z:v-1;
for(B=0;
B<v;
B++){r=u[B];
x=r.length;
q=[];
for(var A=0;
A<x;
A++){w.id=B+"-"+A;
w.css=A===0?"x-grid3-cell-first ":(A==(x-1)?"x-grid3-cell-last ":"");
w.attr=w.cellAttr="";
w.value=r[A];
if(CQ.Ext.isEmpty(w.value)){w.value="&#160;"
}if(n){w.value=y(w.value)
}if(t){w.css+=C(w.value)+" "
}q[q.length]=g.apply(w)
}o[o.length]=D.apply({tstyle:c,cols:x,cells:q.join(""),alt:""})
}return o.join("")
},masterTpl:new CQ.Ext.Template('<div class="x-grid3 x-pivotgrid" hidefocus="true">','<div class="x-grid3-viewport">','<div class="x-grid3-header">','<div class="x-grid3-header-title"><span>{title}</span></div>','<div class="x-grid3-header-inner">','<div class="x-grid3-header-offset" style="{ostyle}"></div>',"</div>",'<div class="x-clear"></div>',"</div>",'<div class="x-grid3-scroller">','<div class="x-grid3-row-headers"></div>','<div class="x-grid3-body" style="{bstyle}">{body}</div>','<a href="#" class="x-grid3-focus" tabIndex="-1"></a>',"</div>","</div>",'<div class="x-grid3-resize-marker">&#160;</div>','<div class="x-grid3-resize-proxy">&#160;</div>',"</div>"),initTemplates:function(){CQ.Ext.grid.PivotGridView.superclass.initTemplates.apply(this,arguments);
var a=this.templates||{};
if(!a.gcell){a.gcell=new CQ.Ext.XTemplate('<td class="x-grid3-hd x-grid3-gcell x-grid3-td-{id} ux-grid-hd-group-row-{row} '+this.colHeaderCellCls+'" style="{style}">','<div {tooltip} class="x-grid3-hd-inner x-grid3-hd-{id}" unselectable="on" style="{istyle}">',this.grid.enableHdMenu?'<a class="x-grid3-hd-btn" href="#"></a>':"","{value}","</div>","</td>")
}this.templates=a;
this.hrowRe=new RegExp("ux-grid-hd-group-row-(\\d+)","")
},initElements:function(){CQ.Ext.grid.PivotGridView.superclass.initElements.apply(this,arguments);
this.rowHeadersEl=new CQ.Ext.Element(this.scroller.child("div.x-grid3-row-headers"));
this.headerTitleEl=new CQ.Ext.Element(this.mainHd.child("div.x-grid3-header-title"))
},getGridInnerWidth:function(){var a=CQ.Ext.grid.PivotGridView.superclass.getGridInnerWidth.apply(this,arguments);
return a-this.getTotalRowHeaderWidth()
},getTotalRowHeaderWidth:function(){var g=this.getRowHeaders(),c=g.length,b=0,a;
for(a=0;
a<c;
a++){b+=g[a].width
}return b
},getTotalColumnHeaderHeight:function(){return this.getColumnHeaders().length*21
},getCellIndex:function(b){if(b){var a=b.className.match(this.colRe),c;
if(a&&(c=a[1])){return parseInt(c.split("-")[1],10)
}}return false
},renderUI:function(){var b=this.templates,a=this.getGridInnerWidth();
return b.master.apply({body:b.body.apply({rows:"&#160;"}),ostyle:"width:"+a+"px",bstyle:"width:"+a+"px"})
},onLayout:function(b,a){CQ.Ext.grid.PivotGridView.superclass.onLayout.apply(this,arguments);
var b=this.getGridInnerWidth();
this.resizeColumnHeaders(b);
this.resizeAllRows(b)
},refresh:function(b){this.fireEvent("beforerefresh",this);
this.grid.stopEditing(true);
var a=this.renderBody();
this.mainBody.update(a).setWidth(this.getGridInnerWidth());
if(b===true){this.updateHeaders();
this.updateHeaderSortState()
}this.processRows(0,true);
this.layout();
this.applyEmptyText();
this.fireEvent("refresh",this)
},renderHeaders:CQ.Ext.emptyFn,fitColumns:CQ.Ext.emptyFn,resizeColumnHeaders:function(b){var a=this.grid.topAxis;
if(a.rendered){a.el.setWidth(b)
}},resizeRowHeaders:function(){var a=this.getTotalRowHeaderWidth(),b=String.format("margin-left: {0}px;",a);
this.rowHeadersEl.setWidth(a);
this.mainBody.applyStyles(b);
CQ.Ext.fly(this.innerHd).applyStyles(b);
this.headerTitleEl.setWidth(a);
this.headerTitleEl.setHeight(this.getTotalColumnHeaderHeight())
},resizeAllRows:function(b){var g=this.getRows(),c=g.length,a;
for(a=0;
a<c;
a++){CQ.Ext.fly(g[a]).setWidth(b);
CQ.Ext.fly(g[a]).child("table").setWidth(b)
}},updateHeaders:function(){this.renderGroupRowHeaders();
this.renderGroupColumnHeaders()
},renderGroupRowHeaders:function(){var a=this.grid.leftAxis;
this.resizeRowHeaders();
a.rendered=false;
a.render(this.rowHeadersEl);
this.setTitle(this.title)
},setTitle:function(a){this.headerTitleEl.child("span").dom.innerHTML=a
},renderGroupColumnHeaders:function(){var a=this.grid.topAxis;
a.rendered=false;
a.render(this.innerHd.firstChild)
},isMenuDisabled:function(a,b){return true
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.grid.PivotAxis=CQ.Ext.extend(CQ.Ext.Component,{orientation:"horizontal",defaultHeaderWidth:80,paddingWidth:7,setDimensions:function(a){this.dimensions=a
},onRender:function(b,a){var c=this.orientation=="horizontal"?this.renderHorizontalRows():this.renderVerticalRows();
this.el=CQ.Ext.DomHelper.overwrite(b.dom,{tag:"table",cn:c},true)
},renderHorizontalRows:function(){var o=this.buildHeaders(),a=o.length,m=[],c,n,k,g,b;
for(g=0;
g<a;
g++){c=[];
n=o[g].items;
k=n.length;
for(b=0;
b<k;
b++){c.push({tag:"td",html:n[b].header,colspan:n[b].span})
}m[g]={tag:"tr",cn:c}
}return m
},renderVerticalRows:function(){var b=this.buildHeaders(),o=b.length,a=[],r=[],n,c,q,m,k,g;
for(k=0;
k<o;
k++){c=b[k];
m=c.width||80;
n=c.items.length;
for(g=0;
g<n;
g++){q=c.items[g];
a[q.start]=a[q.start]||[];
a[q.start].push({tag:"td",html:q.header,rowspan:q.span,width:CQ.Ext.isBorderBox?m:m-this.paddingWidth})
}}n=a.length;
for(k=0;
k<n;
k++){r[k]={tag:"tr",cn:a[k]}
}return r
},getTuples:function(){var b=new CQ.Ext.data.Store({});
b.data=this.store.data.clone();
b.fields=this.store.fields;
var q=[],a=this.dimensions,c=a.length,n;
for(n=0;
n<c;
n++){q.push({field:a[n].dataIndex,direction:a[n].direction||"ASC"})
}b.sort(q);
var j=b.data.items,t=[],o=[],u,m,g,k,r;
c=j.length;
for(n=0;
n<c;
n++){g=this.getRecordInfo(j[n]);
k=g.data;
m="";
for(r in k){m+=k[r]+"---"
}if(t.indexOf(m)==-1){t.push(m);
o.push(g)
}}b.destroy();
return o
},getRecordInfo:function(a){var j=this.dimensions,g=j.length,m={},n,c,b;
for(b=0;
b<g;
b++){n=j[b];
c=n.dataIndex;
m[c]=a.get(c)
}var k=function(o){return function(q){for(var r in o){if(q.get(r)!=o[r]){return false
}}return true
}
};
return{data:m,matcher:k(m)}
},buildHeaders:function(){var q=this.getTuples(),r=q.length,a=this.dimensions,k,x=a.length,c=[],u,y,t,w,v,b,o,n,m,g;
for(m=0;
m<x;
m++){k=a[m];
y=[];
v=0;
b=0;
for(g=0;
g<r;
g++){u=q[g];
o=g==(r-1);
t=u.data[k.dataIndex];
n=w!=undefined&&w!=t;
if(m>0&&g>0){n=n||u.data[a[m-1].dataIndex]!=q[g-1].data[a[m-1].dataIndex]
}if(n){y.push({header:w,span:v,start:b});
b+=v;
v=0
}if(o){y.push({header:t,span:v+1,start:b});
b+=v;
v=0
}w=t;
v++
}c.push({items:y,width:k.width||this.defaultHeaderWidth});
w=undefined
}return c
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.grid.HeaderDragZone=CQ.Ext.extend(CQ.Ext.dd.DragZone,{maxDragWidth:120,constructor:function(a,c,b){this.grid=a;
this.view=a.getView();
this.ddGroup="gridHeader"+this.grid.getGridEl().id;
CQ.Ext.grid.HeaderDragZone.superclass.constructor.call(this,c);
if(b){this.setHandleElId(CQ.Ext.id(c));
this.setOuterHandleElId(CQ.Ext.id(b))
}this.scroll=false
},getDragData:function(c){var a=CQ.Ext.lib.Event.getTarget(c),b=this.view.findHeaderCell(a);
if(b){return{ddel:b.firstChild,header:b}
}return false
},onInitDrag:function(a){this.dragHeadersDisabled=this.view.headersDisabled;
this.view.headersDisabled=true;
var b=this.dragData.ddel.cloneNode(true);
b.id=CQ.Ext.id();
b.style.width=Math.min(this.dragData.header.offsetWidth,this.maxDragWidth)+"px";
this.proxy.update(b);
return true
},afterValidDrop:function(){this.completeDrop()
},afterInvalidDrop:function(){this.completeDrop()
},completeDrop:function(){var a=this.view,b=this.dragHeadersDisabled;
setTimeout(function(){a.headersDisabled=b
},50)
}});
CQ.Ext.grid.HeaderDropZone=CQ.Ext.extend(CQ.Ext.dd.DropZone,{proxyOffsets:[-4,-9],fly:CQ.Ext.Element.fly,constructor:function(a,c,b){this.grid=a;
this.view=a.getView();
this.proxyTop=CQ.Ext.DomHelper.append(CQ.Util.getRoot(),{cls:"col-move-top",html:"&#160;"},true);
this.proxyBottom=CQ.Ext.DomHelper.append(CQ.Util.getRoot(),{cls:"col-move-bottom",html:"&#160;"},true);
this.proxyTop.hide=this.proxyBottom.hide=function(){this.setLeftTop(-100,-100);
this.setStyle("visibility","hidden")
};
this.ddGroup="gridHeader"+this.grid.getGridEl().id;
CQ.Ext.grid.HeaderDropZone.superclass.constructor.call(this,a.getGridEl().dom)
},getTargetFromEvent:function(c){var a=CQ.Ext.lib.Event.getTarget(c),b=this.view.findCellIndex(a);
if(b!==false){return this.view.getHeaderCell(b)
}},nextVisible:function(c){var b=this.view,a=this.grid.colModel;
c=c.nextSibling;
while(c){if(!a.isHidden(b.getCellIndex(c))){return c
}c=c.nextSibling
}return null
},prevVisible:function(c){var b=this.view,a=this.grid.colModel;
c=c.prevSibling;
while(c){if(!a.isHidden(b.getCellIndex(c))){return c
}c=c.prevSibling
}return null
},positionIndicator:function(g,o,m){var a=CQ.Ext.lib.Event.getPageX(m),j=CQ.Ext.lib.Dom.getRegion(o.firstChild),c,k,b=j.top+this.proxyOffsets[1];
if((j.right-a)<=(j.right-j.left)/2){c=j.right+this.view.borderWidth;
k="after"
}else{c=j.left;
k="before"
}if(this.grid.colModel.isFixed(this.view.getCellIndex(o))){return false
}c+=this.proxyOffsets[0];
this.proxyTop.setLeftTop(c,b);
this.proxyTop.show();
if(!this.bottomOffset){this.bottomOffset=this.view.mainHd.getHeight()
}this.proxyBottom.setLeftTop(c,b+this.proxyTop.dom.offsetHeight+this.bottomOffset);
this.proxyBottom.show();
return k
},onNodeEnter:function(g,a,c,b){if(b.header!=g){this.positionIndicator(b.header,g,c)
}},onNodeOver:function(j,b,g,c){var a=false;
if(c.header!=j){a=this.positionIndicator(c.header,j,g)
}if(!a){this.proxyTop.hide();
this.proxyBottom.hide()
}return a?this.dropAllowed:this.dropNotAllowed
},onNodeOut:function(g,a,c,b){this.proxyTop.hide();
this.proxyBottom.hide()
},onNodeDrop:function(b,t,j,c){var g=c.header;
if(g!=b){var o=this.grid.colModel,m=CQ.Ext.lib.Event.getPageX(j),a=CQ.Ext.lib.Dom.getRegion(b.firstChild),u=(a.right-m)<=((a.right-a.left)/2)?"after":"before",k=this.view.getCellIndex(g),q=this.view.getCellIndex(b);
if(u=="after"){q++
}if(k<q){q--
}o.moveColumn(k,q);
return true
}return false
}});
CQ.Ext.grid.GridView.ColumnDragZone=CQ.Ext.extend(CQ.Ext.grid.HeaderDragZone,{constructor:function(a,b){CQ.Ext.grid.GridView.ColumnDragZone.superclass.constructor.call(this,a,b,null);
this.proxy.el.addClass("x-grid3-col-dd")
},handleMouseDown:function(a){},callHandleMouseDown:function(a){CQ.Ext.grid.GridView.ColumnDragZone.superclass.handleMouseDown.call(this,a)
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.grid.SplitDragZone=CQ.Ext.extend(CQ.Ext.dd.DDProxy,{fly:CQ.Ext.Element.fly,constructor:function(a,c,b){this.grid=a;
this.view=a.getView();
this.proxy=this.view.resizeProxy;
CQ.Ext.grid.SplitDragZone.superclass.constructor.call(this,c,"gridSplitters"+this.grid.getGridEl().id,{dragElId:CQ.Ext.id(this.proxy.dom),resizeFrame:false});
this.setHandleElId(CQ.Ext.id(c));
this.setOuterHandleElId(CQ.Ext.id(b));
this.scroll=false
},b4StartDrag:function(a,g){this.view.headersDisabled=true;
this.proxy.setHeight(this.view.mainWrap.getHeight());
var b=this.cm.getColumnWidth(this.cellIndex);
var c=Math.max(b-this.grid.minColumnWidth,0);
this.resetConstraints();
this.setXConstraint(c,1000);
this.setYConstraint(0,0);
this.minX=a-c;
this.maxX=a+1000;
this.startPos=a;
CQ.Ext.dd.DDProxy.prototype.b4StartDrag.call(this,a,g)
},handleMouseDown:function(c){var b=CQ.Ext.EventObject.setEvent(c);
var a=this.fly(b.getTarget());
if(a.hasClass("x-grid-split")){this.cellIndex=this.view.getCellIndex(a.dom);
this.split=a.dom;
this.cm=this.grid.colModel;
if(this.cm.isResizable(this.cellIndex)&&!this.cm.isFixed(this.cellIndex)){CQ.Ext.grid.SplitDragZone.superclass.handleMouseDown.apply(this,arguments)
}}},endDrag:function(c){this.view.headersDisabled=false;
var a=Math.max(this.minX,CQ.Ext.lib.Event.getPageX(c));
var b=a-this.startPos;
this.view.onColumnSplitterMoved(this.cellIndex,this.cm.getColumnWidth(this.cellIndex)+b)
},autoOffset:function(){this.setDelta(0,0)
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.grid.GridDragZone=function(b,a){this.view=b.getView();
CQ.Ext.grid.GridDragZone.superclass.constructor.call(this,this.view.mainBody.dom,a);
this.scroll=false;
this.grid=b;
this.ddel=document.createElement("div");
this.ddel.className="x-grid-dd-wrap"
};
CQ.Ext.extend(CQ.Ext.grid.GridDragZone,CQ.Ext.dd.DragZone,{ddGroup:"GridDD",getDragData:function(b){var a=CQ.Ext.lib.Event.getTarget(b);
var g=this.view.findRowIndex(a);
if(g!==false){var c=this.grid.selModel;
if(!c.isSelected(g)||b.hasModifier()){c.handleMouseDown(this.grid,g,b)
}return{grid:this.grid,ddel:this.ddel,rowIndex:g,selections:c.getSelections()}
}return false
},onInitDrag:function(b){var a=this.dragData;
this.ddel.innerHTML=this.grid.getDragDropText();
this.proxy.update(this.ddel)
},afterRepair:function(){this.dragging=false
},getRepairXY:function(b,a){return false
},onEndDrag:function(a,b){},onValidDrop:function(a,b,c){this.hideProxy()
},beforeInvalidDrop:function(a,b){}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.grid.ColumnModel=CQ.Ext.extend(CQ.Ext.util.Observable,{defaultWidth:100,defaultSortable:false,constructor:function(a){if(a.columns){CQ.Ext.apply(this,a);
this.setConfig(a.columns,true)
}else{this.setConfig(a,true)
}this.addEvents("widthchange","headerchange","hiddenchange","columnmoved","configchange");
CQ.Ext.grid.ColumnModel.superclass.constructor.call(this)
},getColumnId:function(a){return this.config[a].id
},getColumnAt:function(a){return this.config[a]
},setConfig:function(g,b){var j,m,a;
if(!b){delete this.totalWidth;
for(j=0,a=this.config.length;
j<a;
j++){m=this.config[j];
if(m.setEditor){m.setEditor(null)
}}}this.defaults=CQ.Ext.apply({width:this.defaultWidth,sortable:this.defaultSortable},this.defaults);
this.config=g;
this.lookup={};
for(j=0,a=g.length;
j<a;
j++){m=CQ.Ext.applyIf(g[j],this.defaults);
if(CQ.Ext.isEmpty(m.id)){m.id=j
}if(!m.isColumn){var k=CQ.Ext.grid.Column.types[m.xtype||"gridcolumn"];
m=new k(m);
g[j]=m
}this.lookup[m.id]=m
}if(!b){this.fireEvent("configchange",this)
}},getColumnById:function(a){return this.lookup[a]
},getIndexById:function(c){for(var b=0,a=this.config.length;
b<a;
b++){if(this.config[b].id==c){return b
}}return -1
},moveColumn:function(j,b){var a=this.config,g=a[j];
a.splice(j,1);
a.splice(b,0,g);
this.dataMap=null;
this.fireEvent("columnmoved",this,j,b)
},getColumnCount:function(b){var g=this.config.length,j=0,a;
if(b===true){for(a=0;
a<g;
a++){if(!this.isHidden(a)){j++
}}return j
}return g
},getColumnsBy:function(k,j){var b=this.config,m=b.length,a=[],g,n;
for(g=0;
g<m;
g++){n=b[g];
if(k.call(j||this,n,g)===true){a[a.length]=n
}}return a
},isSortable:function(a){return !!this.config[a].sortable
},isMenuDisabled:function(a){return !!this.config[a].menuDisabled
},getRenderer:function(a){return this.config[a].renderer||CQ.Ext.grid.ColumnModel.defaultRenderer
},getRendererScope:function(a){return this.config[a].scope
},setRenderer:function(a,b){this.config[a].renderer=b
},getColumnWidth:function(a){var b=this.config[a].width;
if(typeof b!="number"){b=this.defaultWidth
}return b
},setColumnWidth:function(b,c,a){this.config[b].width=c;
this.totalWidth=null;
if(!a){this.fireEvent("widthchange",this,b,c)
}},getTotalWidth:function(b){if(!this.totalWidth){this.totalWidth=0;
for(var c=0,a=this.config.length;
c<a;
c++){if(b||!this.isHidden(c)){this.totalWidth+=this.getColumnWidth(c)
}}}return this.totalWidth
},getColumnHeader:function(a){return this.config[a].header
},setColumnHeader:function(a,b){this.config[a].header=b;
this.fireEvent("headerchange",this,a,b)
},getColumnTooltip:function(a){return this.config[a].tooltip
},setColumnTooltip:function(a,b){this.config[a].tooltip=b
},getDataIndex:function(a){return this.config[a].dataIndex
},setDataIndex:function(a,b){this.config[a].dataIndex=b
},findColumnIndex:function(g){var j=this.config;
for(var b=0,a=j.length;
b<a;
b++){if(j[b].dataIndex==g){return b
}}return -1
},isCellEditable:function(b,j){var g=this.config[b],a=g.editable;
return !!(a||(!CQ.Ext.isDefined(a)&&g.editor))
},getCellEditor:function(a,b){return this.config[a].getCellEditor(b)
},setEditable:function(a,b){this.config[a].editable=b
},isHidden:function(a){return !!this.config[a].hidden
},isFixed:function(a){return !!this.config[a].fixed
},isResizable:function(a){return a>=0&&this.config[a].resizable!==false&&this.config[a].fixed!==true
},setHidden:function(a,b){var g=this.config[a];
if(g.hidden!==b){g.hidden=b;
this.totalWidth=null;
this.fireEvent("hiddenchange",this,a,b)
}},setEditor:function(a,b){this.config[a].setEditor(b)
},destroy:function(){var b=this.config.length,a=0;
for(;
a<b;
a++){this.config[a].destroy()
}delete this.config;
delete this.lookup;
this.purgeListeners()
},setState:function(a,b){b=CQ.Ext.applyIf(b,this.defaults);
CQ.Ext.apply(this.config[a],b)
}});
CQ.Ext.grid.ColumnModel.defaultRenderer=function(a){if(typeof a=="string"&&a.length<1){return"&#160;"
}return a
};
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.grid.AbstractSelectionModel=CQ.Ext.extend(CQ.Ext.util.Observable,{constructor:function(){this.locked=false;
CQ.Ext.grid.AbstractSelectionModel.superclass.constructor.call(this)
},init:function(a){this.grid=a;
if(this.lockOnInit){delete this.lockOnInit;
this.locked=false;
this.lock()
}this.initEvents()
},lock:function(){if(!this.locked){this.locked=true;
var a=this.grid;
if(a){a.getView().on({scope:this,beforerefresh:this.sortUnLock,refresh:this.sortLock})
}else{this.lockOnInit=true
}}},sortLock:function(){this.locked=true
},sortUnLock:function(){this.locked=false
},unlock:function(){if(this.locked){this.locked=false;
var a=this.grid,b;
if(a){b=a.getView();
b.un("beforerefresh",this.sortUnLock,this);
b.un("refresh",this.sortLock,this)
}else{delete this.lockOnInit
}}},isLocked:function(){return this.locked
},destroy:function(){this.unlock();
this.purgeListeners()
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.grid.RowSelectionModel=CQ.Ext.extend(CQ.Ext.grid.AbstractSelectionModel,{singleSelect:false,constructor:function(a){CQ.Ext.apply(this,a);
this.selections=new CQ.Ext.util.MixedCollection(false,function(b){return b.id
});
this.last=false;
this.lastActive=false;
this.addEvents("selectionchange","beforerowselect","rowselect","rowdeselect");
CQ.Ext.grid.RowSelectionModel.superclass.constructor.call(this)
},initEvents:function(){if(!this.grid.enableDragDrop&&!this.grid.enableDrag){this.grid.on("rowmousedown",this.handleMouseDown,this)
}this.rowNav=new CQ.Ext.KeyNav(this.grid.getGridEl(),{up:this.onKeyPress,down:this.onKeyPress,scope:this});
this.grid.getView().on({scope:this,refresh:this.onRefresh,rowupdated:this.onRowUpdated,rowremoved:this.onRemove})
},onKeyPress:function(j,b){var a=b=="up",k=a?"selectPrevious":"selectNext",g=a?-1:1,c;
if(!j.shiftKey||this.singleSelect){this[k](false)
}else{if(this.last!==false&&this.lastActive!==false){c=this.last;
this.selectRange(this.last,this.lastActive+g);
this.grid.getView().focusRow(this.lastActive);
if(c!==false){this.last=c
}}else{this.selectFirstRow()
}}},onRefresh:function(){var k=this.grid.store,g=this.getSelections(),c=0,a=g.length,b,j;
this.silent=true;
this.clearSelections(true);
for(;
c<a;
c++){j=g[c];
if((b=k.indexOfId(j.id))!=-1){this.selectRow(b,true)
}}if(g.length!=this.selections.getCount()){this.fireEvent("selectionchange",this)
}this.silent=false
},onRemove:function(a,b,c){if(this.selections.remove(c)!==false){this.fireEvent("selectionchange",this)
}},onRowUpdated:function(a,b,c){if(this.isSelected(c)){a.onRowSelect(b)
}},selectRecords:function(b,j){if(!j){this.clearSelections()
}var g=this.grid.store,c=0,a=b.length;
for(;
c<a;
c++){this.selectRow(g.indexOf(b[c]),true)
}},getCount:function(){return this.selections.length
},selectFirstRow:function(){this.selectRow(0)
},selectLastRow:function(a){this.selectRow(this.grid.store.getCount()-1,a)
},selectNext:function(a){if(this.hasNext()){this.selectRow(this.last+1,a);
this.grid.getView().focusRow(this.last);
return true
}return false
},selectPrevious:function(a){if(this.hasPrevious()){this.selectRow(this.last-1,a);
this.grid.getView().focusRow(this.last);
return true
}return false
},hasNext:function(){return this.last!==false&&(this.last+1)<this.grid.store.getCount()
},hasPrevious:function(){return !!this.last
},getSelections:function(){return[].concat(this.selections.items)
},getSelected:function(){return this.selections.itemAt(0)
},each:function(j,g){var c=this.getSelections(),b=0,a=c.length;
for(;
b<a;
b++){if(j.call(g||this,c[b],b)===false){return false
}}return true
},clearSelections:function(a){if(this.isLocked()){return
}if(a!==true){var c=this.grid.store,b=this.selections;
b.each(function(g){this.deselectRow(c.indexOfId(g.id))
},this);
b.clear()
}else{this.selections.clear()
}this.last=false
},selectAll:function(){if(this.isLocked()){return
}this.selections.clear();
for(var b=0,a=this.grid.store.getCount();
b<a;
b++){this.selectRow(b,true)
}},hasSelection:function(){return this.selections.length>0
},isSelected:function(a){var b=CQ.Ext.isNumber(a)?this.grid.store.getAt(a):a;
return(b&&this.selections.key(b.id)?true:false)
},isIdSelected:function(a){return(this.selections.key(a)?true:false)
},handleMouseDown:function(j,m,k){if(k.button!==0||this.isLocked()){return
}var a=this.grid.getView();
if(k.shiftKey&&!this.singleSelect&&this.last!==false){var c=this.last;
this.selectRange(c,m,k.ctrlKey);
this.last=c;
a.focusRow(m)
}else{var b=this.isSelected(m);
if(k.ctrlKey&&b){this.deselectRow(m)
}else{if(!b||this.getCount()>1){this.selectRow(m,k.ctrlKey||k.shiftKey);
a.focusRow(m)
}}}},selectRows:function(c,g){if(!g){this.clearSelections()
}for(var b=0,a=c.length;
b<a;
b++){this.selectRow(c[b],true)
}},selectRange:function(b,a,g){var c;
if(this.isLocked()){return
}if(!g){this.clearSelections()
}if(b<=a){for(c=b;
c<=a;
c++){this.selectRow(c,true)
}}else{for(c=b;
c>=a;
c--){this.selectRow(c,true)
}}},deselectRange:function(c,b,a){if(this.isLocked()){return
}for(var g=c;
g<=b;
g++){this.deselectRow(g,a)
}},selectRow:function(b,g,a){if(this.isLocked()||(b<0||b>=this.grid.store.getCount())||(g&&this.isSelected(b))){return
}var c=this.grid.store.getAt(b);
if(c&&this.fireEvent("beforerowselect",this,b,g,c)!==false){if(!g||this.singleSelect){this.clearSelections()
}this.selections.add(c);
this.last=this.lastActive=b;
if(!a){this.grid.getView().onRowSelect(b)
}if(!this.silent){this.fireEvent("rowselect",this,b,c);
this.fireEvent("selectionchange",this)
}}},deselectRow:function(b,a){if(this.isLocked()){return
}if(this.last==b){this.last=false
}if(this.lastActive==b){this.lastActive=false
}var c=this.grid.store.getAt(b);
if(c){this.selections.remove(c);
if(!a){this.grid.getView().onRowDeselect(b)
}this.fireEvent("rowdeselect",this,b,c);
this.fireEvent("selectionchange",this)
}},acceptsNav:function(c,b,a){return !a.isHidden(b)&&a.isCellEditable(b,c)
},onEditorKey:function(u,q){var j=q.getKey(),m,n=this.grid,w=n.lastEdit,o=n.activeEditor,b=q.shiftKey,v,w,a,t;
if(j==q.TAB){q.stopEvent();
o.completeEdit();
if(b){m=n.walkCells(o.row,o.col-1,-1,this.acceptsNav,this)
}else{m=n.walkCells(o.row,o.col+1,1,this.acceptsNav,this)
}}else{if(j==q.ENTER){if(this.moveEditorOnEnter!==false){if(b){m=n.walkCells(w.row-1,w.col,-1,this.acceptsNav,this)
}else{m=n.walkCells(w.row+1,w.col,1,this.acceptsNav,this)
}}}}if(m){a=m[0];
t=m[1];
this.onEditorSelect(a,w.row);
if(n.isEditor&&n.editing){v=n.activeEditor;
if(v&&v.field.triggerBlur){v.field.triggerBlur()
}}n.startEditing(a,t)
}},onEditorSelect:function(b,a){if(a!=b){this.selectRow(b)
}},destroy:function(){CQ.Ext.destroy(this.rowNav);
this.rowNav=null;
CQ.Ext.grid.RowSelectionModel.superclass.destroy.call(this)
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.grid.Column=CQ.Ext.extend(CQ.Ext.util.Observable,{isColumn:true,constructor:function(b){CQ.Ext.apply(this,b);
if(CQ.Ext.isString(this.renderer)){this.renderer=CQ.Ext.util.Format[this.renderer]
}else{if(CQ.Ext.isObject(this.renderer)){this.scope=this.renderer.scope;
this.renderer=this.renderer.fn
}}if(!this.scope){this.scope=this
}var a=this.editor;
delete this.editor;
this.setEditor(a);
this.addEvents("click","contextmenu","dblclick","mousedown");
CQ.Ext.grid.Column.superclass.constructor.call(this)
},processEvent:function(b,g,c,j,a){return this.fireEvent(b,this,c,j,g)
},destroy:function(){if(this.setEditor){this.setEditor(null)
}this.purgeListeners()
},renderer:function(a){return a
},getEditor:function(a){return this.editable!==false?this.editor:null
},setEditor:function(b){var a=this.editor;
if(a){if(a.gridEditor){a.gridEditor.destroy();
delete a.gridEditor
}else{a.destroy()
}}this.editor=null;
if(b){if(!b.isXType){b=CQ.Ext.create(b,"textfield")
}this.editor=b
}},getCellEditor:function(b){var a=this.getEditor(b);
if(a){if(!a.startEdit){if(!a.gridEditor){a.gridEditor=new CQ.Ext.grid.GridEditor(a)
}a=a.gridEditor
}}return a
}});
CQ.Ext.grid.BooleanColumn=CQ.Ext.extend(CQ.Ext.grid.Column,{trueText:"true",falseText:"false",undefinedText:"&#160;",constructor:function(a){CQ.Ext.grid.BooleanColumn.superclass.constructor.call(this,a);
var c=this.trueText,g=this.falseText,b=this.undefinedText;
this.renderer=function(j){if(j===undefined){return b
}if(!j||j==="false"){return g
}return c
}
}});
CQ.Ext.grid.NumberColumn=CQ.Ext.extend(CQ.Ext.grid.Column,{format:"0,000.00",constructor:function(a){CQ.Ext.grid.NumberColumn.superclass.constructor.call(this,a);
this.renderer=CQ.Ext.util.Format.numberRenderer(this.format)
}});
CQ.Ext.grid.DateColumn=CQ.Ext.extend(CQ.Ext.grid.Column,{format:"m/d/Y",constructor:function(a){CQ.Ext.grid.DateColumn.superclass.constructor.call(this,a);
this.renderer=CQ.Ext.util.Format.dateRenderer(this.format)
}});
CQ.Ext.grid.TemplateColumn=CQ.Ext.extend(CQ.Ext.grid.Column,{constructor:function(a){CQ.Ext.grid.TemplateColumn.superclass.constructor.call(this,a);
var b=(!CQ.Ext.isPrimitive(this.tpl)&&this.tpl.compile)?this.tpl:new CQ.Ext.XTemplate(this.tpl);
this.renderer=function(g,j,c){return b.apply(c.data)
};
this.tpl=b
}});
CQ.Ext.grid.ActionColumn=CQ.Ext.extend(CQ.Ext.grid.Column,{header:"&#160;",actionIdRe:/x-action-col-(\d+)/,altText:"",constructor:function(b){var k=this,c=b.items||(k.items=[k]),a=c.length,g,j;
CQ.Ext.grid.ActionColumn.superclass.constructor.call(k,b);
k.renderer=function(m,n){m=CQ.Ext.isFunction(b.renderer)?b.renderer.apply(this,arguments)||"":"";
n.css+=" x-action-col-cell";
for(g=0;
g<a;
g++){j=c[g];
m+='<img alt="'+(j.altText||k.altText)+'" src="'+(j.icon||CQ.Ext.BLANK_IMAGE_URL)+'" class="x-action-col-icon x-action-col-'+String(g)+" "+(j.iconCls||"")+" "+(CQ.Ext.isFunction(j.getClass)?j.getClass.apply(j.scope||this.scope||this,arguments):"")+'"'+((j.tooltip)?' ext:qtip="'+j.tooltip+'"':"")+" />"
}return m
}
},destroy:function(){delete this.items;
delete this.renderer;
return CQ.Ext.grid.ActionColumn.superclass.destroy.apply(this,arguments)
},processEvent:function(c,n,g,o,b){var a=n.getTarget().className.match(this.actionIdRe),k,j;
if(a&&(k=this.items[parseInt(a[1],10)])){if(c=="click"){(j=k.handler||this.handler)&&j.call(k.scope||this.scope||this,g,o,b,k,n)
}else{if((c=="mousedown")&&(k.stopSelection!==false)){return false
}}}return CQ.Ext.grid.ActionColumn.superclass.processEvent.apply(this,arguments)
}});
CQ.Ext.grid.Column.types={gridcolumn:CQ.Ext.grid.Column,booleancolumn:CQ.Ext.grid.BooleanColumn,numbercolumn:CQ.Ext.grid.NumberColumn,datecolumn:CQ.Ext.grid.DateColumn,templatecolumn:CQ.Ext.grid.TemplateColumn,actioncolumn:CQ.Ext.grid.ActionColumn};
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.grid.RowNumberer=CQ.Ext.extend(Object,{header:"",width:23,sortable:false,constructor:function(a){CQ.Ext.apply(this,a);
if(this.rowspan){this.renderer=this.renderer.createDelegate(this)
}},fixed:true,hideable:false,menuDisabled:true,dataIndex:"",id:"numberer",rowspan:undefined,renderer:function(b,c,a,g){if(this.rowspan){c.cellAttr='rowspan="'+this.rowspan+'"'
}return g+1
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.grid.CheckboxSelectionModel=CQ.Ext.extend(CQ.Ext.grid.RowSelectionModel,{header:'<div class="x-grid3-hd-checker">&#160;</div>',width:20,sortable:false,menuDisabled:true,fixed:true,hideable:false,dataIndex:"",id:"checker",isColumn:true,constructor:function(){CQ.Ext.grid.CheckboxSelectionModel.superclass.constructor.apply(this,arguments);
if(this.checkOnly){this.handleMouseDown=CQ.Ext.emptyFn
}},initEvents:function(){CQ.Ext.grid.CheckboxSelectionModel.superclass.initEvents.call(this);
this.grid.on("render",function(){CQ.Ext.fly(this.grid.getView().innerHd).on("mousedown",this.onHdMouseDown,this)
},this)
},processEvent:function(b,g,c,j,a){if(b=="mousedown"){this.onMouseDown(g,g.getTarget());
return false
}else{return CQ.Ext.grid.Column.prototype.processEvent.apply(this,arguments)
}},onMouseDown:function(c,b){if(c.button===0&&b.className=="x-grid3-row-checker"){c.stopEvent();
var g=c.getTarget(".x-grid3-row");
if(g){var a=g.rowIndex;
if(this.isSelected(a)){this.deselectRow(a)
}else{this.selectRow(a,true);
this.grid.getView().focusRow(a)
}}}},onHdMouseDown:function(c,a){if(a.className=="x-grid3-hd-checker"){c.stopEvent();
var b=CQ.Ext.fly(a.parentNode);
var g=b.hasClass("x-grid3-hd-checker-on");
if(g){b.removeClass("x-grid3-hd-checker-on");
this.clearSelections()
}else{b.addClass("x-grid3-hd-checker-on");
this.selectAll()
}}},renderer:function(b,c,a){return'<div class="x-grid3-row-checker">&#160;</div>'
},onEditorSelect:function(b,a){if(a!=b&&!this.checkOnly){this.selectRow(b)
}}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.grid.CellSelectionModel=CQ.Ext.extend(CQ.Ext.grid.AbstractSelectionModel,{constructor:function(a){CQ.Ext.apply(this,a);
this.selection=null;
this.addEvents("beforecellselect","cellselect","selectionchange");
CQ.Ext.grid.CellSelectionModel.superclass.constructor.call(this)
},initEvents:function(){this.grid.on("cellmousedown",this.handleMouseDown,this);
this.grid.on(CQ.Ext.EventManager.getKeyEvent(),this.handleKeyDown,this);
this.grid.getView().on({scope:this,refresh:this.onViewChange,rowupdated:this.onRowUpdated,beforerowremoved:this.clearSelections,beforerowsinserted:this.clearSelections});
if(this.grid.isEditor){this.grid.on("beforeedit",this.beforeEdit,this)
}},beforeEdit:function(a){this.select(a.row,a.column,false,true,a.record)
},onRowUpdated:function(a,b,c){if(this.selection&&this.selection.record==c){a.onCellSelect(b,this.selection.cell[1])
}},onViewChange:function(){this.clearSelections(true)
},getSelectedCell:function(){return this.selection?this.selection.cell:null
},clearSelections:function(b){var a=this.selection;
if(a){if(b!==true){this.grid.view.onCellDeselect(a.cell[0],a.cell[1])
}this.selection=null;
this.fireEvent("selectionchange",this,null)
}},hasSelection:function(){return this.selection?true:false
},handleMouseDown:function(b,j,a,c){if(c.button!==0||this.isLocked()){return
}this.select(j,a)
},select:function(k,c,b,j,g){if(this.fireEvent("beforecellselect",this,k,c)!==false){this.clearSelections();
g=g||this.grid.store.getAt(k);
this.selection={record:g,cell:[k,c]};
if(!b){var a=this.grid.getView();
a.onCellSelect(k,c);
if(j!==true){a.focusCell(k,c)
}}this.fireEvent("cellselect",this,k,c);
this.fireEvent("selectionchange",this,this.selection)
}},isSelectable:function(c,b,a){return !a.isHidden(b)
},onEditorKey:function(b,a){if(a.getKey()==a.TAB){this.handleKeyDown(a)
}},handleKeyDown:function(o){if(!o.isNavKeyPress()){return
}var j=o.getKey(),n=this.grid,w=this.selection,b=this,t=function(k,c,g){return n.walkCells(k,c,g,n.isEditor&&n.editing?b.acceptsNav:b.isSelectable,b)
},v,m,a,q,u;
switch(j){case o.ESC:case o.PAGE_UP:case o.PAGE_DOWN:break;
default:o.stopEvent();
break
}if(!w){v=t(0,0,1);
if(v){this.select(v[0],v[1])
}return
}v=w.cell;
a=v[0];
q=v[1];
switch(j){case o.TAB:if(o.shiftKey){m=t(a,q-1,-1)
}else{m=t(a,q+1,1)
}break;
case o.DOWN:m=t(a+1,q,1);
break;
case o.UP:m=t(a-1,q,-1);
break;
case o.RIGHT:m=t(a,q+1,1);
break;
case o.LEFT:m=t(a,q-1,-1);
break;
case o.ENTER:if(n.isEditor&&!n.editing){n.startEditing(a,q);
return
}break
}if(m){a=m[0];
q=m[1];
this.select(a,q);
if(n.isEditor&&n.editing){u=n.activeEditor;
if(u&&u.field.triggerBlur){u.field.triggerBlur()
}n.startEditing(a,q)
}}},acceptsNav:function(c,b,a){return !a.isHidden(b)&&a.isCellEditable(b,c)
}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.grid.EditorGridPanel=CQ.Ext.extend(CQ.Ext.grid.GridPanel,{clicksToEdit:2,forceValidation:false,isEditor:true,detectEdit:false,autoEncode:false,trackMouseOver:false,initComponent:function(){CQ.Ext.grid.EditorGridPanel.superclass.initComponent.call(this);
if(!this.selModel){this.selModel=new CQ.Ext.grid.CellSelectionModel()
}this.activeEditor=null;
this.addEvents("beforeedit","afteredit","validateedit")
},initEvents:function(){CQ.Ext.grid.EditorGridPanel.superclass.initEvents.call(this);
this.getGridEl().on("mousewheel",this.stopEditing.createDelegate(this,[true]),this);
this.on("columnresize",this.stopEditing,this,[true]);
if(this.clicksToEdit==1){this.on("cellclick",this.onCellDblClick,this)
}else{var a=this.getView();
if(this.clicksToEdit=="auto"&&a.mainBody){a.mainBody.on("mousedown",this.onAutoEditClick,this)
}this.on("celldblclick",this.onCellDblClick,this)
}},onResize:function(){CQ.Ext.grid.EditorGridPanel.superclass.onResize.apply(this,arguments);
var a=this.activeEditor;
if(this.editing&&a){a.realign(true)
}},onCellDblClick:function(b,c,a){this.startEditing(c,a)
},onAutoEditClick:function(c,b){if(c.button!==0){return
}var j=this.view.findRowIndex(b),a=this.view.findCellIndex(b);
if(j!==false&&a!==false){this.stopEditing();
if(this.selModel.getSelectedCell){var g=this.selModel.getSelectedCell();
if(g&&g[0]===j&&g[1]===a){this.startEditing(j,a)
}}else{if(this.selModel.isSelected(j)){this.startEditing(j,a)
}}}},onEditComplete:function(b,g,a){this.editing=false;
this.lastActiveEditor=this.activeEditor;
this.activeEditor=null;
var c=b.record,k=this.colModel.getDataIndex(b.col);
g=this.postEditValue(g,a,c,k);
if(this.forceValidation===true||String(g)!==String(a)){var j={grid:this,record:c,field:k,originalValue:a,value:g,row:b.row,column:b.col,cancel:false};
if(this.fireEvent("validateedit",j)!==false&&!j.cancel&&String(g)!==String(a)){c.set(k,j.value);
delete j.cancel;
this.fireEvent("afteredit",j)
}}this.view.focusCell(b.row,b.col)
},startEditing:function(m,c){this.stopEditing();
if(this.colModel.isCellEditable(c,m)){this.view.ensureVisible(m,c,true);
var g=this.store.getAt(m),k=this.colModel.getDataIndex(c),j={grid:this,record:g,field:k,value:g.data[k],row:m,column:c,cancel:false};
if(this.fireEvent("beforeedit",j)!==false&&!j.cancel){this.editing=true;
var b=this.colModel.getCellEditor(c,m);
if(!b){return
}if(!b.rendered){b.parentEl=this.view.getEditorParent(b);
b.on({scope:this,render:{fn:function(n){n.field.focus(false,true)
},single:true,scope:this},specialkey:function(o,n){this.getSelectionModel().onEditorKey(o,n)
},complete:this.onEditComplete,canceledit:this.stopEditing.createDelegate(this,[true])})
}CQ.Ext.apply(b,{row:m,col:c,record:g});
this.lastEdit={row:m,col:c};
this.activeEditor=b;
b.selectSameEditor=(this.activeEditor==this.lastActiveEditor);
var a=this.preEditValue(g,k);
b.startEdit(this.view.getCell(m,c).firstChild,CQ.Ext.isDefined(a)?a:"");
(function(){delete b.selectSameEditor
}).defer(50)
}}},preEditValue:function(a,c){var b=a.data[c];
return this.autoEncode&&CQ.Ext.isString(b)?CQ.Ext.util.Format.htmlDecode(b):b
},postEditValue:function(c,a,b,g){return this.autoEncode&&CQ.Ext.isString(c)?CQ.Ext.util.Format.htmlEncode(c):c
},stopEditing:function(b){if(this.editing){var a=this.lastActiveEditor=this.activeEditor;
if(a){a[b===true?"cancelEdit":"completeEdit"]();
this.view.focusCell(a.row,a.col)
}this.activeEditor=null
}this.editing=false
}});
CQ.Ext.reg("editorgrid",CQ.Ext.grid.EditorGridPanel);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.grid.GridEditor=function(b,a){CQ.Ext.grid.GridEditor.superclass.constructor.call(this,b,a);
b.monitorTab=false
};
CQ.Ext.extend(CQ.Ext.grid.GridEditor,CQ.Ext.Editor,{alignment:"tl-tl",autoSize:"width",hideEl:false,cls:"x-small-editor x-grid-editor",shim:false,shadow:false});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.grid.PropertyRecord=CQ.Ext.data.Record.create([{name:"name",type:"string"},"value"]);
CQ.Ext.grid.PropertyStore=CQ.Ext.extend(CQ.Ext.util.Observable,{constructor:function(a,b){this.grid=a;
this.store=new CQ.Ext.data.Store({recordType:CQ.Ext.grid.PropertyRecord});
this.store.on("update",this.onUpdate,this);
if(b){this.setSource(b)
}CQ.Ext.grid.PropertyStore.superclass.constructor.call(this)
},setSource:function(c){this.source=c;
this.store.removeAll();
var b=[];
for(var a in c){if(this.isEditableValue(c[a])){b.push(new CQ.Ext.grid.PropertyRecord({name:a,value:c[a]},a))
}}this.store.loadRecords({records:b},{},true)
},onUpdate:function(j,a,g){if(g==CQ.Ext.data.Record.EDIT){var b=a.data.value;
var c=a.modified.value;
if(this.grid.fireEvent("beforepropertychange",this.source,a.id,b,c)!==false){this.source[a.id]=b;
a.commit();
this.grid.fireEvent("propertychange",this.source,a.id,b,c)
}else{a.reject()
}}},getProperty:function(a){return this.store.getAt(a)
},isEditableValue:function(a){return CQ.Ext.isPrimitive(a)||CQ.Ext.isDate(a)
},setValue:function(g,c,a){var b=this.getRec(g);
if(b){b.set("value",c);
this.source[g]=c
}else{if(a){this.source[g]=c;
b=new CQ.Ext.grid.PropertyRecord({name:g,value:c},g);
this.store.add(b)
}}},remove:function(b){var a=this.getRec(b);
if(a){this.store.remove(a);
delete this.source[b]
}},getRec:function(a){return this.store.getById(a)
},getSource:function(){return this.source
}});
CQ.Ext.grid.PropertyColumnModel=CQ.Ext.extend(CQ.Ext.grid.ColumnModel,{nameText:"Name",valueText:"Value",dateFormat:"m/j/Y",trueText:"true",falseText:"false",constructor:function(c,b){var j=CQ.Ext.grid,k=CQ.Ext.form;
this.grid=c;
j.PropertyColumnModel.superclass.constructor.call(this,[{header:this.nameText,width:50,sortable:true,dataIndex:"name",id:"name",menuDisabled:true},{header:this.valueText,width:50,resizable:false,dataIndex:"value",id:"value",menuDisabled:true}]);
this.store=b;
var a=new k.Field({autoCreate:{tag:"select",children:[{tag:"option",value:"true",html:this.trueText},{tag:"option",value:"false",html:this.falseText}]},getValue:function(){return this.el.dom.value=="true"
}});
this.editors={date:new j.GridEditor(new k.DateField({selectOnFocus:true})),string:new j.GridEditor(new k.TextField({selectOnFocus:true})),number:new j.GridEditor(new k.NumberField({selectOnFocus:true,style:"text-align:left;"})),"boolean":new j.GridEditor(a,{autoSize:"both"})};
this.renderCellDelegate=this.renderCell.createDelegate(this);
this.renderPropDelegate=this.renderProp.createDelegate(this)
},renderDate:function(a){return a.dateFormat(this.dateFormat)
},renderBool:function(a){return this[a?"trueText":"falseText"]
},isCellEditable:function(a,b){return a==1
},getRenderer:function(a){return a==1?this.renderCellDelegate:this.renderPropDelegate
},renderProp:function(a){return this.getPropertyName(a)
},renderCell:function(g,b,c){var a=this.grid.customRenderers[c.get("name")];
if(a){return a.apply(this,arguments)
}var j=g;
if(CQ.Ext.isDate(g)){j=this.renderDate(g)
}else{if(typeof g=="boolean"){j=this.renderBool(g)
}}return CQ.Ext.util.Format.htmlEncode(j)
},getPropertyName:function(b){var a=this.grid.propertyNames;
return a&&a[b]?a[b]:b
},getCellEditor:function(a,j){var b=this.store.getProperty(j),g=b.data.name,c=b.data.value;
if(this.grid.customEditors[g]){return this.grid.customEditors[g]
}if(CQ.Ext.isDate(c)){return this.editors.date
}else{if(typeof c=="number"){return this.editors.number
}else{if(typeof c=="boolean"){return this.editors["boolean"]
}else{return this.editors.string
}}}},destroy:function(){CQ.Ext.grid.PropertyColumnModel.superclass.destroy.call(this);
this.destroyEditors(this.editors);
this.destroyEditors(this.grid.customEditors)
},destroyEditors:function(b){for(var a in b){CQ.Ext.destroy(b[a])
}}});
CQ.Ext.grid.PropertyGrid=CQ.Ext.extend(CQ.Ext.grid.EditorGridPanel,{enableColumnMove:false,stripeRows:false,trackMouseOver:false,clicksToEdit:1,enableHdMenu:false,viewConfig:{forceFit:true},initComponent:function(){this.customRenderers=this.customRenderers||{};
this.customEditors=this.customEditors||{};
this.lastEditRow=null;
var b=new CQ.Ext.grid.PropertyStore(this);
this.propStore=b;
var a=new CQ.Ext.grid.PropertyColumnModel(this,b);
b.store.sort("name","ASC");
this.addEvents("beforepropertychange","propertychange");
this.cm=a;
this.ds=b.store;
CQ.Ext.grid.PropertyGrid.superclass.initComponent.call(this);
this.mon(this.selModel,"beforecellselect",function(j,g,c){if(c===0){this.startEditing.defer(200,this,[g,1]);
return false
}},this)
},onRender:function(){CQ.Ext.grid.PropertyGrid.superclass.onRender.apply(this,arguments);
this.getGridEl().addClass("x-props-grid")
},afterRender:function(){CQ.Ext.grid.PropertyGrid.superclass.afterRender.apply(this,arguments);
if(this.source){this.setSource(this.source)
}},setSource:function(a){this.propStore.setSource(a)
},getSource:function(){return this.propStore.getSource()
},setProperty:function(c,b,a){this.propStore.setValue(c,b,a)
},removeProperty:function(a){this.propStore.remove(a)
}});
CQ.Ext.reg("propertygrid",CQ.Ext.grid.PropertyGrid);
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
CQ.Ext.grid.GroupingView=CQ.Ext.extend(CQ.Ext.grid.GridView,{groupByText:"Group By This Field",showGroupsText:"Show in Groups",hideGroupedColumn:false,showGroupName:true,startCollapsed:false,enableGrouping:true,enableGroupingMenu:true,enableNoGroups:true,emptyGroupText:"(None)",ignoreAdd:false,groupTextTpl:"{text}",groupMode:"value",cancelEditOnToggle:true,initTemplates:function(){CQ.Ext.grid.GroupingView.superclass.initTemplates.call(this);
this.state={};
var a=this.grid.getSelectionModel();
a.on(a.selectRow?"beforerowselect":"beforecellselect",this.onBeforeRowSelect,this);
if(!this.startGroup){this.startGroup=new CQ.Ext.XTemplate('<div id="{groupId}" class="x-grid-group {cls}">','<div id="{groupId}-hd" class="x-grid-group-hd" style="{style}"><div class="x-grid-group-title">',this.groupTextTpl,"</div></div>",'<div id="{groupId}-bd" class="x-grid-group-body">')
}this.startGroup.compile();
if(!this.endGroup){this.endGroup="</div></div>"
}},findGroup:function(a){return CQ.Ext.fly(a).up(".x-grid-group",this.mainBody.dom)
},getGroups:function(){return this.hasRows()?this.mainBody.dom.childNodes:[]
},onAdd:function(g,a,b){if(this.canGroup()&&!this.ignoreAdd){var c=this.getScrollState();
this.fireEvent("beforerowsinserted",g,b,b+(a.length-1));
this.refresh();
this.restoreScroll(c);
this.fireEvent("rowsinserted",g,b,b+(a.length-1))
}else{if(!this.canGroup()){CQ.Ext.grid.GroupingView.superclass.onAdd.apply(this,arguments)
}}},onRemove:function(k,a,b,j){CQ.Ext.grid.GroupingView.superclass.onRemove.apply(this,arguments);
var c=document.getElementById(a._groupId);
if(c&&c.childNodes[1].childNodes.length<1){CQ.Ext.removeNode(c)
}this.applyEmptyText()
},refreshRow:function(a){if(this.ds.getCount()==1){this.refresh()
}else{this.isUpdating=true;
CQ.Ext.grid.GroupingView.superclass.refreshRow.apply(this,arguments);
this.isUpdating=false
}},beforeMenuShow:function(){var c,a=this.hmenu.items,b=this.cm.config[this.hdCtxIndex].groupable===false;
if((c=a.get("groupBy"))){c.setDisabled(b)
}if((c=a.get("showGroups"))){c.setDisabled(b);
c.setChecked(this.canGroup(),true)
}},renderUI:function(){var a=CQ.Ext.grid.GroupingView.superclass.renderUI.call(this);
if(this.enableGroupingMenu&&this.hmenu){this.hmenu.add("-",{itemId:"groupBy",text:this.groupByText,handler:this.onGroupByClick,scope:this,iconCls:"x-group-by-icon"});
if(this.enableNoGroups){this.hmenu.add({itemId:"showGroups",text:this.showGroupsText,checked:true,checkHandler:this.onShowGroupsClick,scope:this})
}this.hmenu.on("beforeshow",this.beforeMenuShow,this)
}return a
},processEvent:function(b,m){CQ.Ext.grid.GroupingView.superclass.processEvent.call(this,b,m);
var k=m.getTarget(".x-grid-group-hd",this.mainBody);
if(k){var j=this.getGroupField(),g=this.getPrefix(j),a=k.id.substring(g.length),c=new RegExp("gp-"+CQ.Ext.escapeRe(j)+"--hd");
a=a.substr(0,a.length-3);
if(a||c.test(k.id)){this.grid.fireEvent("group"+b,this.grid,j,a,m)
}if(b=="mousedown"&&m.button==0){this.toggleGroup(k.parentNode)
}}},onGroupByClick:function(){var a=this.grid;
this.enableGrouping=true;
a.store.groupBy(this.cm.getDataIndex(this.hdCtxIndex));
a.fireEvent("groupchange",a,a.store.getGroupState());
this.beforeMenuShow();
this.refresh()
},onShowGroupsClick:function(a,b){this.enableGrouping=b;
if(b){this.onGroupByClick()
}else{this.grid.store.clearGrouping();
this.grid.fireEvent("groupchange",this,null)
}},toggleRowIndex:function(c,a){if(!this.canGroup()){return
}var b=this.getRow(c);
if(b){this.toggleGroup(this.findGroup(b),a)
}},toggleGroup:function(c,b){var a=CQ.Ext.get(c),g=CQ.Ext.util.Format.htmlEncode(a.id);
b=CQ.Ext.isDefined(b)?b:a.hasClass("x-grid-group-collapsed");
if(this.state[g]!==b){if(this.cancelEditOnToggle!==false){this.grid.stopEditing(true)
}this.state[g]=b;
a[b?"removeClass":"addClass"]("x-grid-group-collapsed")
}},toggleAllGroups:function(c){var b=this.getGroups();
for(var g=0,a=b.length;
g<a;
g++){this.toggleGroup(b[g],c)
}},expandAllGroups:function(){this.toggleAllGroups(true)
},collapseAllGroups:function(){this.toggleAllGroups(false)
},getGroup:function(a,k,n,o,b,m){var c=this.cm.config[b],j=n?n.call(c.scope,a,{},k,o,b,m):String(a);
if(j===""||j==="&#160;"){j=c.emptyGroupText||this.emptyGroupText
}return j
},getGroupField:function(){return this.grid.store.getGroupState()
},afterRender:function(){if(!this.ds||!this.cm){return
}CQ.Ext.grid.GroupingView.superclass.afterRender.call(this);
if(this.grid.deferRowRender){this.updateGroupWidths()
}},afterRenderUI:function(){CQ.Ext.grid.GroupingView.superclass.afterRenderUI.call(this);
if(this.enableGroupingMenu&&this.hmenu){this.hmenu.add("-",{itemId:"groupBy",text:this.groupByText,handler:this.onGroupByClick,scope:this,iconCls:"x-group-by-icon"});
if(this.enableNoGroups){this.hmenu.add({itemId:"showGroups",text:this.showGroupsText,checked:true,checkHandler:this.onShowGroupsClick,scope:this})
}this.hmenu.on("beforeshow",this.beforeMenuShow,this)
}},renderRows:function(){var a=this.getGroupField();
var j=!!a;
if(this.hideGroupedColumn){var b=this.cm.findColumnIndex(a),g=CQ.Ext.isDefined(this.lastGroupField);
if(!j&&g){this.mainBody.update("");
this.cm.setHidden(this.cm.findColumnIndex(this.lastGroupField),false);
delete this.lastGroupField
}else{if(j&&!g){this.lastGroupField=a;
this.cm.setHidden(b,true)
}else{if(j&&g&&a!==this.lastGroupField){this.mainBody.update("");
var c=this.cm.findColumnIndex(this.lastGroupField);
this.cm.setHidden(c,false);
this.lastGroupField=a;
this.cm.setHidden(b,true)
}}}}return CQ.Ext.grid.GroupingView.superclass.renderRows.apply(this,arguments)
},doRender:function(c,m,x,a,w,y){if(m.length<1){return""
}if(!this.canGroup()||this.isUpdating){return CQ.Ext.grid.GroupingView.superclass.doRender.apply(this,arguments)
}var F=this.getGroupField(),v=this.cm.findColumnIndex(F),C,n="width:"+this.getTotalWidth()+";",k=this.cm.config[v],b=k.groupRenderer||k.renderer,z=this.showGroupName?(k.groupName||k.header)+": ":"",E=[],q,A,B,u;
for(A=0,B=m.length;
A<B;
A++){var o=a+A,t=m[A],j=t.data[F];
C=this.getGroup(j,t,b,o,v,x);
if(!q||q.group!=C){u=this.constructId(j,F,v);
this.state[u]=!(CQ.Ext.isDefined(this.state[u])?!this.state[u]:this.startCollapsed);
q={group:C,gvalue:j,text:z+C,groupId:u,startRow:o,rs:[t],cls:this.state[u]?"":"x-grid-group-collapsed",style:n};
E.push(q)
}else{q.rs.push(t)
}t._groupId=u
}var D=[];
for(A=0,B=E.length;
A<B;
A++){C=E[A];
this.doGroupStart(D,C,c,x,w);
D[D.length]=CQ.Ext.grid.GroupingView.superclass.doRender.call(this,c,C.rs,x,C.startRow,w,y);
this.doGroupEnd(D,C,c,x,w)
}return D.join("")
},getGroupId:function(a){var b=this.getGroupField();
return this.constructId(a,b,this.cm.findColumnIndex(b))
},constructId:function(c,j,a){var b=this.cm.config[a],g=b.groupRenderer||b.renderer,k=(this.groupMode=="value")?c:this.getGroup(c,{data:{}},g,0,a,this.ds);
return this.getPrefix(j)+CQ.Ext.util.Format.htmlEncode(k)
},canGroup:function(){return this.enableGrouping&&!!this.getGroupField()
},getPrefix:function(a){return this.grid.getGridEl().id+"-gp-"+a+"-"
},doGroupStart:function(a,j,b,k,c){a[a.length]=this.startGroup.apply(j)
},doGroupEnd:function(a,j,b,k,c){a[a.length]=this.endGroup
},getRows:function(){if(!this.canGroup()){return CQ.Ext.grid.GroupingView.superclass.getRows.call(this)
}var o=[],c=this.getGroups(),n,m=0,a=c.length,k,b;
for(;
m<a;
++m){n=c[m].childNodes[1];
if(n){n=n.childNodes;
for(k=0,b=n.length;
k<b;
++k){o[o.length]=n[k]
}}}return o
},updateGroupWidths:function(){if(!this.canGroup()||!this.hasRows()){return
}var c=Math.max(this.cm.getTotalWidth(),this.el.dom.offsetWidth-this.getScrollOffset())+"px";
var b=this.getGroups();
for(var g=0,a=b.length;
g<a;
g++){b[g].firstChild.style.width=c
}},onColumnWidthUpdated:function(c,a,b){CQ.Ext.grid.GroupingView.superclass.onColumnWidthUpdated.call(this,c,a,b);
this.updateGroupWidths()
},onAllColumnWidthsUpdated:function(a,b){CQ.Ext.grid.GroupingView.superclass.onAllColumnWidthsUpdated.call(this,a,b);
this.updateGroupWidths()
},onColumnHiddenUpdated:function(b,c,a){CQ.Ext.grid.GroupingView.superclass.onColumnHiddenUpdated.call(this,b,c,a);
this.updateGroupWidths()
},onLayout:function(){this.updateGroupWidths()
},onBeforeRowSelect:function(b,a){this.toggleRowIndex(a,true)
}});
CQ.Ext.grid.GroupingView.GROUP_ID=1000;
CQ.data.SlingStore=function(a){CQ.data.SlingStore.superclass.constructor.call(this,CQ.Ext.apply(a,{proxy:!a.data?new CQ.Ext.data.HttpProxy({url:a.url}):undefined,reader:new CQ.data.SlingReader(a)}))
};
CQ.Ext.extend(CQ.data.SlingStore,CQ.Ext.data.Store);
CQ.data.SlingReader=function(){CQ.data.SlingReader.superclass.constructor.call(this,{})
};
CQ.Ext.extend(CQ.data.SlingReader,CQ.Ext.data.JsonReader,{read:function(response){var json=response.responseText;
var rootData=eval("("+json+")");
if(!rootData){throw {message:"SlingReader.read: Json object not found"}
}var fields=[];
var data={};
for(var propName in rootData){var mappedName=propName.replace(/\./g,"%2e");
if(mappedName!=propName){fields.push({name:propName,mapping:mappedName})
}else{fields.push(propName)
}data[mappedName]=rootData[propName]
}var o={root:[data],results:1,success:true,metaData:{successProperty:"success",totalProperty:"results",root:"root",fields:fields}};
delete this.ef;
this.meta=o.metaData;
this.onMetaChange(this.meta,this.recordType,o);
this.recordType=CQ.data.SlingRecord.create(o.metaData.fields);
delete o.metaData;
return this.readRecords(o)
}});
CQ.data.SlingRecord=CQ.Ext.extend(CQ.Ext.data.Record,{get:function(a){var j;
if(a&&a.indexOf("/")>=0){var g=this.data;
a=a.replace("./","");
var k=a.split("/");
for(var b=0;
b<k.length;
b++){if(g){var c=k[b];
if(b==k.length-1){j=g[c]
}else{g=g[c]
}}}}else{j=this.data[a]
}j=CQ.Sling.processBinaryData(j);
return j
}});
CQ.data.SlingRecord.create=function(j){var c=CQ.Ext.extend(CQ.data.SlingRecord,{});
var g=c.prototype;
g.fields=new CQ.Ext.util.MixedCollection(false,function(k){return k.name
});
for(var b=0,a=j.length;
b<a;
b++){g.fields.add(new CQ.Ext.data.Field(j[b]))
}c.getField=function(k){return g.fields.get(k)
};
return c
};
CQ.data.SlingRecord.AUTO_ID=1000;
CQ.Ext.override(CQ.Ext.Element,{setWidth:function(b,a){if(isNaN(b)&&typeof b!="string"){b="auto"
}var c=this;
b=c.adjustWidth(b);
!a||!c.anim?c.dom.style.width=c.addUnits(b):c.anim({width:{to:b}},c.preanim(arguments,1));
return c
},isScrollable:function(){var a=this.dom;
if(CQ.Ext.isIE6||CQ.Ext.isIE7){if((a.clientHeight==0)&&(a.clientWidth==0)){return false
}}return a.scrollHeight>a.clientHeight||a.scrollWidth>a.clientWidth
}});
CQ.Ext.Updater.defaults.timeout=CQ.REQUEST_TIMEOUT/1000;
CQ.Ext.override(CQ.Ext.util.MixedCollection,{_sort:function(o,a,n){var g,j,b=String(a).toUpperCase()=="DESC"?-1:1,m=[],q=this.keys,k=this.items;
n=n||function(r,c){return r-c
};
for(g=0,j=k.length;
g<j;
g++){m[m.length]={key:q[g],value:k[g],index:g}
}m.sort(function(r,c){var t=n(r[o],c[o])*b;
if(t===0){t=(r.index<c.index?1:-1)
}return t
});
for(g=0,j=m.length;
g<j;
g++){k[g]=m[g].value;
q[g]=m[g].key
}this.fireEvent("sort",this)
}});
CQ.Ext.dd.DragDropMgr.getLocation=function(n){if(!this.isTypeOfDD(n)){return null
}var j=n.getEl(),v,g,c,x,w,y,a,u,k,q;
try{v=CQ.Ext.lib.Dom.getXY(j)
}catch(o){}if(!v){return null
}g=v[0];
c=g+j.offsetWidth;
x=v[1];
w=x+j.offsetHeight;
y=x-n.padding[0];
a=c+n.padding[1];
u=w+n.padding[2];
k=g-n.padding[3];
q=new CQ.Ext.lib.Region(y,a,u,k);
j=CQ.Ext.get(j.parentNode);
while(j&&j.dom.tagName.toUpperCase()!="HTML"&&q){if(j.isScrollable()){var m=q.intersect(j.getRegion());
if(m){q=m
}}j=j.parent()
}return q
};
CQ.Ext.dd.DragDropMgr.fireEvents=function(r,t){var v=this.dragCurrent;
if(!v||v.isLocked()){return
}var w=r.getPoint();
var a=[];
var j=[];
var o=[];
var m=[];
var c=[];
for(var k in this.dragOvers){var b=this.dragOvers[k];
if(!this.isTypeOfDD(b)){continue
}if(!this.isOverTarget(w,b,this.mode)){j.push(b)
}a[k]=true;
delete this.dragOvers[k]
}var g=[];
for(var u in v.groups){if("string"!=typeof u){continue
}for(k in this.ids[u]){var n=this.ids[u][k];
if(!this.isTypeOfDD(n)){continue
}if(n.isTarget&&!n.isLocked()&&((n!=v)||(v.ignoreSelf===false))){if(this.isOverTarget(w,n,this.mode)){if(v.enableMultipleEventsFiring){g.push(n)
}else{if(g.length==0){g.push(n)
}else{g[0]=this.getTopfrontElement(g[0],n)
}}}}}}for(var k=0;
k<g.length;
k++){var n=g[k];
if(t&&m.indexOf(n)==-1){m.push(n)
}else{if(!a[n.id]&&c.indexOf(n)==-1){c.push(n)
}else{if(o.indexOf(n)==-1){o.push(n)
}}this.dragOvers[n.id]=n
}}if(this.mode){if(j.length){v.b4DragOut(r,j);
v.onDragOut(r,j)
}if(c.length){v.onDragEnter(r,c)
}if(o.length){v.b4DragOver(r,o);
v.onDragOver(r,o)
}if(m.length){v.b4DragDrop(r,m);
v.onDragDrop(r,m)
}}else{delete v.cachedTarget;
var q=0;
for(k=0,q=j.length;
k<q;
++k){v.b4DragOut(r,j[k].id);
v.onDragOut(r,j[k].id)
}for(k=0,q=c.length;
k<q;
++k){v.onDragEnter(r,c[k].id)
}for(k=0,q=o.length;
k<q;
++k){v.b4DragOver(r,o[k].id);
v.onDragOver(r,o[k].id)
}for(k=0,q=m.length;
k<q;
++k){v.b4DragDrop(r,m[k].id);
v.onDragDrop(r,m[k].id)
}}if(t&&!m.length){v.onInvalidDrop(r)
}};
CQ.Ext.dd.DragDropMgr.getTopfrontElement=function(z,y){var k=CQ.Ext.get(z.getEl());
var j=CQ.Ext.get(y.getEl());
var g=0;
var b=k.getStyle("z-index");
var c=k;
while((b=="auto")&&g++<30){c=c.parent();
if(c!=null){b=c.getStyle("z-index")
}else{break
}}g=0;
var u=j.getStyle("z-index");
c=j;
while((u=="auto")&&g++<30){c=c.parent();
if(c!=null){u=c.getStyle("z-index")
}else{break
}}if(b!="auto"&&!isNaN(b)&&parseInt(b)!=0){if(u!="auto"&&!isNaN(u)){if(parseInt(b)!=parseInt(u)){if(parseInt(b)>parseInt(u)){return z
}return y
}}else{if(parseInt(b)>0){return z
}return y
}}else{if(u!="auto"&&!isNaN(u)&&parseInt(u)!=0){if(parseInt(u)>0){return y
}return z
}}if(k.up("[id="+j.id+"]")){return z
}if(j.up("[id="+k.id+"]")){return y
}var x=function(A){var n="";
if(A){n+=x(A.parent())+"/"+A.id
}return n
};
var w=x(k);
var t=x(j);
var q=w.split("/"),o=t.split("/"),v,r;
for(var m=0;
m<q.length&&m<o.length;
m++){if(q[m]!=o[m]){v=q[m];
r=o[m];
break
}}if(v&&r){var a=CQ.Ext.get(v);
if(a.next("[id="+r+"]")){return y
}else{return z
}}return z
};
var BEFOREREQUEST="beforerequest",UNDEFINED=undefined,POST="POST",GET="GET",WINDOW=window;
CQ.Ext.override(CQ.Ext.data.Connection,{timeout:CQ.REQUEST_TIMEOUT,request:function(j){var n=this;
if(n.fireEvent(BEFOREREQUEST,n,j)){if(j.el){if(!CQ.Ext.isEmpty(j.indicatorText)){n.indicatorText='<div class="loading-indicator">'+j.indicatorText+"</div>"
}if(n.indicatorText){CQ.Ext.getDom(j.el).innerHTML=n.indicatorText
}j.success=(CQ.Ext.isFunction(j.success)?j.success:function(){}).createInterceptor(function(o){CQ.Ext.getDom(j.el).innerHTML=o.responseText
})
}var c=j.params,b=j.url||n.url,a,k={success:n.handleResponse,failure:function(o,r){if(!o.argument.options.callback){CQ.shared.HTTP.handleForbidden(o)
}n.handleFailure(o,r)
},scope:n,argument:{options:j},timeout:j.timeout||n.timeout},g,q;
if(CQ.Ext.isFunction(c)){c=c.call(j.scope||WINDOW,j)
}c=CQ.Ext.urlEncode(n.extraParams,CQ.Ext.isObject(c)?CQ.Ext.urlEncode(c):c);
if(CQ.Ext.isFunction(b)){b=b.call(j.scope||WINDOW,j)
}b=CQ.HTTP.externalize(b,true);
if((g=CQ.Ext.getDom(j.form))){b=b||g.action;
if(j.isUpload||/multipart\/form-data/i.test(g.getAttribute("enctype"))){return n.doFormUpload.call(n,j,c,b)
}q=CQ.Ext.lib.Ajax.serializeForm(g);
c=c?(c+"&"+q):q
}a=j.method||n.method||((c||j.xmlData||j.jsonData)?POST:GET);
if(a===GET&&(n.disableCaching&&j.disableCaching!==false)||j.disableCaching===true){var m=j.disableCachingParam||n.disableCachingParam;
b=CQ.Ext.urlAppend(b,m+"="+(new Date().getTime()))
}j.headers=CQ.Ext.apply(j.headers||{},n.defaultHeaders||{});
if(j.autoAbort===true||n.autoAbort){n.abort()
}if((a==GET||j.xmlData||j.jsonData)&&c){b=CQ.Ext.urlAppend(b,c);
c=""
}return(n.transId=CQ.Ext.lib.Ajax.request(a,CQ.shared.HTTP.getXhrHookedURL(b),k,c,j))
}else{return j.callback?j.callback.apply(j.scope,[j,UNDEFINED,UNDEFINED]):null
}}});
CQ.Ext.override(CQ.Ext.data.DataProxy,{buildUrl:function(g,b){b=b||null;
var c=(this.conn&&this.conn.url)?this.conn.url:(this.api[g])?this.api[g].url:this.url;
if(!c){throw new CQ.Ext.data.Api.Error("invalid-url",g)
}var j=null;
var a=c.match(/(.*)(\.json|\.xml|\.html)$/);
if(a){j=a[2];
c=a[1]
}if((this.restful===true||this.prettyUrls===true)&&b instanceof CQ.Ext.data.Record&&!b.phantom){c+="/"+b.id
}if(j!==null){c+=j
}return CQ.shared.HTTP.getXhrHookedURL(CQ.shared.HTTP.externalize(c))
}});
CQ.Ext.override(CQ.Ext.data.Node,{getPath:function(c){c=c||"name";
var k=this.parentNode;
var a=[this.attributes[c]];
while(k){if(k.attributes[c]!=""){a.unshift(k.attributes[c])
}k=k.parentNode
}var j=this.getOwnerTree();
var g=j?j.pathSeparator:"/";
return g+a.join(g)
}});
CQ.Ext.override(CQ.Ext.state.CookieProvider,{set:function(a,b){if(a.indexOf("cq-comp-")==0||typeof b=="undefined"||b===null){this.clear(a);
return
}this.setCookie(a,b);
CQ.Ext.state.CookieProvider.superclass.set.call(this,a,b)
}});
CQ.Ext.override(CQ.Ext.Component,{fieldSubLabel:null,fieldDescription:"",stateful:false,hasClass:function(a){if(this.el){return this.el.hasClass(a)
}else{if(this.cls){if(this.cls.indexOf(" ")!=-1){return this.cls.indexOf(a+" ")!=-1||this.cls.indexOf(" "+a)!=-1
}else{return this.cls==a
}}}return false
},focus:function(b,a){if(a){this.focusTask=new CQ.Ext.util.DelayedTask(this.focus,this,[b,false]);
this.focusTask.delay(CQ.Ext.isNumber(a)?a:10);
return this
}if(this.rendered&&!this.isDestroyed){this.el.focus();
if(b===true){if(this.el.dom.select){this.el.dom.select()
}}}return this
}});
CQ.Ext.override(CQ.Ext.DatePicker,{update:function(N,H){if(this.rendered){var a=this.activeDate,x=this.isVisible();
this.activeDate=N;
if(!H&&a&&this.el){var v=N.getTime();
if(a.getMonth()==N.getMonth()&&a.getFullYear()==N.getFullYear()){this.cells.removeClass("x-date-selected");
this.cells.each(function(t){if(t.dom.firstChild.dateValue==v){t.addClass("x-date-selected");
if(x&&!this.cancelFocus){CQ.Ext.fly(t.dom.firstChild).focus(50)
}return false
}},this);
return
}}var o=N.getDaysInMonth(),y=N.getFirstDateOfMonth(),k=y.getDay()-this.startDay;
if(k<0){k+=7
}o+=k;
var I=N.add("mo",-1),m=I.getDaysInMonth()-k,j=this.cells.elements,z=this.textNodes,F=86400000,K=(new Date(I.getFullYear(),I.getMonth(),m)).clearTime(),J=new Date().clearTime().getTime(),C=N.clearTime(true).getTime(),B=this.minDate?this.minDate.clearTime(true):Number.NEGATIVE_INFINITY,E=this.maxDate?this.maxDate.clearTime(true):Number.POSITIVE_INFINITY,M=this.disabledDatesRE,A=this.disabledDatesText,P=this.disabledDays?this.disabledDays.join(""):false,L=this.disabledDaysText,G=this.format;
if(this.showToday){var r=new Date().clearTime(),g=(r<B||r>E||(M&&G&&M.test(r.dateFormat(G)))||(P&&P.indexOf(r.getDay())!=-1));
if(!this.disabled){this.todayBtn.setDisabled(g);
this.todayKeyListener[g?"disable":"enable"]()
}}var q=function(S,w){w.title="";
var Q=K.getTime();
w.firstChild.dateValue=Q;
if(Q==J){w.className+=" x-date-today";
w.title=S.todayText
}if(Q==C){w.className+=" x-date-selected";
if(x){CQ.Ext.fly(w.firstChild).focus(50)
}}if(Q<B){w.className=" x-date-disabled";
w.title=S.minText;
return
}if(Q>E){w.className=" x-date-disabled";
w.title=S.maxText;
return
}if(P){if(P.indexOf(K.getDay())!=-1){w.title=L;
w.className=" x-date-disabled"
}}if(M&&G){var R=K.dateFormat(G);
if(M.test(R)){w.title=A.replace("%0",R);
w.className=" x-date-disabled"
}}};
var D=0;
for(;
D<k;
D++){z[D].innerHTML=(++m);
K.setDate(K.getDate()+1);
j[D].className="x-date-prevday";
q(this,j[D])
}for(;
D<o;
D++){var c=D-k+1;
z[D].innerHTML=(c);
K.setDate(K.getDate()+1);
j[D].className="x-date-active";
q(this,j[D])
}var O=0;
for(;
D<42;
D++){z[D].innerHTML=(++O);
K.setDate(K.getDate()+1);
j[D].className="x-date-nextday";
q(this,j[D])
}var b=CQ.I18n.getMessage("{0} {1}",[this.monthNames[N.getMonth()],N.getFullYear()],"date display order: {0} is the month (ex: November), {1} is the year (ex: 2011). Should be '{1} {0}' in Japanese.");
this.mbtn.setText(b);
if(!this.internalRender){var n=this.el.dom.firstChild,u=n.offsetWidth;
this.el.setWidth(u+this.el.getBorderWidth("lr"));
CQ.Ext.fly(n).setWidth(u);
this.internalRender=true;
if(CQ.Ext.isOpera&&!this.secondPass){n.rows[0].cells[1].style.width=(u-(n.rows[0].cells[0].offsetWidth+n.rows[0].cells[2].offsetWidth))+"px";
this.secondPass=true;
this.update.defer(10,this,[N])
}}}}});
CQ.Ext.override(CQ.Ext.Panel,{createElement:function(a,c){if(this[a]){c.appendChild(this[a].dom);
return
}if(a==="bwrap"||this.elements.indexOf(a)!=-1){if(this[a+"Cfg"]){this[a]=CQ.Ext.fly(c).createChild(this[a+"Cfg"])
}else{var b=document.createElement("div");
b.className=this[a+"Cls"];
this[a]=CQ.Ext.get(c.tagName.toLowerCase()=="iframe"?b:c.appendChild(b))
}if(this[a+"CssClass"]){this[a].addClass(this[a+"CssClass"])
}if(this[a+"Style"]){this[a].applyStyles(this[a+"Style"])
}}}});
CQ.Ext.override(CQ.Ext.Shadow,{realign:function(b,x,v,j){if(!this.el){return
}var q=this.adjusts,n=this.el.dom,y=n.style,k=0,u=(v+q.w),g=(j+q.h),m=(u>0?u:0)+"px",r=(g>0?g:0)+"px",o,c;
y.left=(b+q.l)+"px";
y.top=(x+q.t)+"px";
if(y.width!=m||y.height!=r){y.width=m;
y.height=r;
if(!CQ.Ext.isIE){o=n.childNodes;
c=Math.max(0,(u-12))+"px";
o[0].childNodes[1].style.width=c;
o[1].childNodes[1].style.width=c;
o[2].childNodes[1].style.width=c;
o[1].style.height=Math.max(0,(g-12))+"px"
}}}});
CQ.Ext.override(CQ.Ext.TabPanel,{stateful:false,stateEvents:["tabchange"],getState:function(){var a=this.getActiveTab();
if(a.items.get(0)){a=a.items.get(0)
}return{activeTab:a.id}
},applyState:function(c){try{var g=c.activeTab;
this.setActiveTab(g);
if(this.getActiveTab()!=g){if(c.activeTab){var b=CQ.Ext.getCmp(g);
if(b){var g=b.ownerCt||0;
this.setActiveTab(g)
}}if(this.getActiveTab()!=g){this.setActiveTab(this.initialConfig.activeTab||0)
}}}catch(a){this.setActiveTab(0)
}}});
CQ.Ext.override(CQ.Ext.Viewport,{debug:false,initComponent:function(){CQ.Ext.Viewport.superclass.initComponent.call(this);
document.getElementsByTagName("html")[0].className+=" x-viewport";
this.el=CQ.Ext.getBody();
this.el.setHeight=CQ.Ext.emptyFn;
this.el.setWidth=CQ.Ext.emptyFn;
this.el.setSize=CQ.Ext.emptyFn;
this.el.dom.scroll="no";
this.allowDomMove=false;
this.autoWidth=true;
this.autoHeight=true;
CQ.Ext.EventManager.onWindowResize(this.fireResize,this);
this.renderTo=this.el;
this.on("render",function(){if(!this.debug){if(!CQ.HTTP.getCookie("cq-firebug-warn")&&window.console&&window.console.firebug){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Warning"),CQ.I18n.getMessage("Firebug is known to cause performance issues. ")+CQ.I18n.getMessage("Disable Firebug if you experience performance problems."));
CQ.HTTP.setCookie("cq-firebug-warn","1",CQ.HTTP.externalize("/"),1)
}}},this)
}});
CQ.Ext.override(CQ.Ext.FlashComponent,{onRender:function(){CQ.Ext.FlashComponent.superclass.onRender.apply(this,arguments);
var b=CQ.Ext.apply({allowScriptAccess:"sameDomain",bgcolor:this.backgroundColor,wmode:this.wmode},this.flashParams),a=CQ.Ext.apply({allowedDomain:document.location.hostname,YUISwfId:this.getId(),YUIBridgeCallback:"CQ.Ext.FlashEventProxy.onEvent"},this.flashVars);
new CQ_swfobject.embedSWF(this.url,this.id,this.swfWidth,this.swfHeight,this.flashVersion,this.expressInstall?CQ.Ext.FlashComponent.EXPRESS_INSTALL_URL:undefined,a,b);
this.swf=CQ.Ext.getDom(this.id);
this.el=CQ.Ext.get(this.swf)
},beforeDestroy:function(){if(this.rendered){CQ_swfobject.removeSWF(this.swf.id)
}CQ.Ext.FlashComponent.superclass.beforeDestroy.call(this)
}});
CQ.Ext.override(CQ.Ext.form.Action,{getUrl:function(g){var a=this.options.url||this.form.url||this.form.el.dom.action;
if(g){var c=this.getParams();
if(c){a=CQ.Ext.urlAppend(a,c)
}}try{a=CQ.shared.HTTP.getXhrHookedURL(a,this.getMethod())
}catch(b){console.log("Unable to get XHR hooked URL: "+b)
}return a
}});
CQ.Ext.override(CQ.Ext.form.BasicForm,{timeout:CQ.REQUEST_TIMEOUT/1000});
CQ.Ext.override(CQ.Ext.form.Field,{ignoreData:false,defaultValue:null,readOnlyClass:"x-form-disabled",dropTargets:null,processRecord:function(a,c){if(this.fireEvent("beforeloadcontent",this,a,c)!==false){var b=a.get(this.getName());
if(b==undefined&&this.defaultValue!=null){if(this.isApplyDefault(a,c)){this.setValue(this.defaultValue)
}}else{this.setValue(b)
}this.fireEvent("loadcontent",this,a,c)
}},processParentRecord:function(a,c){if(this.fireEvent("beforeloadcontent",this,a,c)!==false){var b=a.get(this.getName().substring(3));
if(b==undefined&&this.defaultValue!=null){if(this.isApplyDefault(a,c)){this.setValue(this.defaultValue)
}}else{this.setValue(b)
}this.fireEvent("loadcontent",this,a,c)
}},processPath:function(b,a){},isApplyDefault:function(a,c){var g=a.get("jcr:created");
if(!g&&a.data.length==0){return false
}var b=a.get("jcr:lastModified");
if(!b){b=a.get("cq:lastModified")
}return g==b
},getDropTargets:function(){return this.dropTargets
},afterRender:function(){CQ.Ext.form.Field.superclass.afterRender.call(this);
if(this.tooltip){var b=this.getEl().up("div.x-form-item");
if(b){var a=b.child("label");
if(a){CQ.Ext.QuickTips.register({target:a,title:"",text:this.tooltip,enabled:true})
}}}if(this.readOnly&&this.readOnlyClass){this.el.addClass(this.readOnlyClass)
}this.initEvents();
this.initValue()
},setReadOnly:function(a){if(this.rendered){this.el.dom.readOnly=a
}this.readOnly=a;
if(this.readOnlyClass&&this.el){if(this.readOnly){this.el.addClass(this.readOnlyClass)
}else{this.el.removeClass(this.readOnlyClass)
}}}});
CQ.Ext.override(CQ.Ext.form.TextField,{evaluateValidatorsFirst:false,executeCustomValidators:function(a,g){if(this.vtype){var c=CQ.Ext.form.VTypes;
if(!c[this.vtype](a,this)){g.push(this.vtypeText||c[this.vtype+"Text"]);
return
}}if(CQ.Ext.isFunction(this.validator)){var b=this.validator(a);
if(b!==true){g.push(b)
}}},getErrors:function(a){var g=[];
if(this.evaluateValidatorsFirst){this.executeCustomValidators(a,g)
}g=g.concat(CQ.Ext.form.TextField.superclass.getErrors.apply(this,arguments));
a=CQ.Ext.isDefined(a)?a:this.processValue(this.getRawValue());
if(CQ.Ext.isFunction(this.validator)){var c=this.validator(a);
if(c!==true){g.push(c)
}}if(a.length<1||a===this.emptyText){if(this.allowBlank){return g
}else{g.push(this.blankText)
}}if(!this.allowBlank&&(a.length<1||a===this.emptyText)){g.push(this.blankText)
}if(a.length<this.minLength){g.push(String.format(this.minLengthText,this.minLength))
}if(a.length>this.maxLength){g.push(String.format(this.maxLengthText,this.maxLength))
}if(this.vtype){var b=CQ.Ext.form.VTypes;
if(!b[this.vtype](a,this)){g.push(this.vtypeText||b[this.vtype+"Text"])
}}if(this.regex&&!this.regex.test(a)){g.push(this.regexText)
}return g
},getCaretPosition:function(){var b=this.getRawValue();
if(b.length==0){return 0
}var c=this.el.dom;
if(document.selection!=undefined){c.focus();
var a=document.selection.createRange();
a.moveStart("character",-b.length);
return a.text.length
}else{if(c.selectionStart!=undefined){return c.selectionStart
}else{return b.length
}}},setCaretPosition:function(g){var c=this.el.dom;
if(document.selection!=undefined){var b=this.getRawValue();
c.focus();
var a=document.selection.createRange();
a.moveStart("character",-b.length);
a.moveStart("character",g);
a.moveEnd("character",0)
}else{if(c.selectionStart!=undefined){c.selectionStart=g;
c.selectionEnd=g;
c.focus()
}else{c.focus()
}}},getTermAtCaret:function(){return this.getTermAt(this.getCaretPosition())
},getTermAt:function(g){var b=this.getRawValue();
if(b.charAt(g)==" "){g-=1
}var c=b.lastIndexOf(" ",g)+1;
var a=b.indexOf(" ",g);
if(a==-1){return b.substring(c)
}else{return b.substring(c,a)
}}});
CQ.Ext.override(CQ.Ext.form.NumberField,{getErrors:function(b){var c=CQ.Ext.form.NumberField.superclass.getErrors.apply(this,arguments);
b=CQ.Ext.isDefined(b)?b:this.processValue(this.getRawValue());
if(b.length<1){return c
}b=String(b).replace(this.decimalSeparator,".");
if(isNaN(b)){c.push(String.format(this.nanText,CQ.shared.XSS.getXSSValue(b)))
}var a=this.parseValue(b);
if(a<this.minValue){c.push(String.format(this.minText,this.minValue))
}if(a>this.maxValue){c.push(String.format(this.maxText,this.maxValue))
}return c
}});
CQ.Ext.form.VTypes.digitsMask=/^\d*$/;
CQ.Ext.form.VTypes.digits=function(a){return/^\d*$/.test(a)
};
CQ.Ext.form.VTypes.percentMask=/[\d\%]/;
CQ.Ext.form.VTypes.percent=function(a){return/^\d.*\%?$/.test(a)
};
CQ.Ext.form.VTypes.itemnameMask=/[a-z0-9_\-]/i;
CQ.Ext.form.VTypes.itemname=function(a){return/^[a-zA-Z0-9_\-]+$/.test(a)
};
CQ.Ext.form.VTypes.makeItemname=function(a,g){if(CQ.Ext.form.VTypes.itemname(a)){return a
}g=g==undefined?"-":g;
var c="";
for(var b=0;
b<a.length;
b++){c+=/^[a-zA-Z0-9_\-]$/.test(a[b])?a[b]:g
}if(c.length==0){c=g==""?"-":g
}return c
};
CQ.Ext.form.VTypes.authorizableIdMask=/[a-z0-9@_\-\.]/;
CQ.Ext.form.VTypes.authorizableId=function(a){return/^[a-z0-9@_\-\.]+$/.test(a)
};
CQ.Ext.form.VTypes.makeAuthorizableId=function(c,b){if(CQ.Ext.form.VTypes.authorizableId(c)){return c
}b=b==undefined?"-":b;
var g="";
for(var a=0;
a<c.length;
a++){if(/^[a-z0-9@_\-\.]$/.test(c[a])){g+=c[a]
}else{if(/^[A-Z]$/.test(c[a])){g+=c[a].toLowerCase()
}else{g+=b
}}}if(g.length==0){g=b==""?"-":b
}return g
};
CQ.Ext.form.VTypes.nameMaskTerm=/^([^\|\[\]\*\/: \.]+|[^\|\[\]\*\/: \.]+[^\|\[\]\*\/:]*[^\|\[\]\*\/: ]+)$/;
CQ.Ext.form.VTypes.nameMask=/^[^\|\[\]\*\/:]$/;
CQ.Ext.form.VTypes.name=function(a){return CQ.Ext.form.VTypes.nameMaskTerm.test(a)
};
CQ.Ext.form.VTypes.makeName=function(a,g){if(CQ.Ext.form.VTypes.name(a)){return a
}g=g==undefined?"-":g;
var c="";
for(var b=0;
b<a.length;
b++){if(b==0){c+=/^[^\|\[\]\*\/: \.]$/.test(a.charAt(b))?a.charAt(b):""
}else{if(b==a.length-1){c+=/^[^\|\[\]\*\/: ]$/.test(a.charAt(b))?a.charAt(b):""
}else{c+=/^[^\|\[\]\*\/:]$/.test(a.charAt(b))?a.charAt(b):g
}}}if(c.length==0){c=g==""?"-":g
}return c
};
CQ.Ext.form.VTypes.requiredOnLinkedData=function(o,n){var j=n.findParentByType("dialog");
var g=CQ.utils.Util.findFormFields(j);
var b=n.linkedComponent;
var a=g[b];
if(a){var c=false;
var q=a.length;
for(var m=0;
m<q;
m++){var k=a[m];
if(k.hasData){if(k.hasData()){c=true;
break
}}}if(!c){return true
}return(o.length>0)
}return true
};
CQ.Ext.form.VTypes.daterange=function(c,g){var b=g.parseDate(c);
if(!b){return
}if(g.startDateField&&(!this.dateRangeMax||(b.getTime()!=this.dateRangeMax.getTime()))){var j=CQ.Ext.getCmp(g.startDateField);
j.setMaxValue(b);
j.validate();
this.dateRangeMax=b
}else{if(g.endDateField&&(!this.dateRangeMin||(b.getTime()!=this.dateRangeMin.getTime()))){var a=CQ.Ext.getCmp(g.endDateField);
a.setMinValue(b);
a.validate();
this.dateRangeMin=b
}}return true
};
CQ.Ext.apply(CQ.Ext.form.VTypes,{pollingInterval:function(value){if(!this.minInterval){var response=CQ.HTTP.get("/etc/importers/polling/list.mininterval.json");
var interval=CQ.HTTP.eval(response).minInterval;
this.minInterval=(interval)?interval:null
}var isValid=!this.minInterval||(this.minInterval<=value);
if(!isValid){this.pollingIntervalText=CQ.I18n.getMessage("Invalid Configuration: Interval {0} is smaller than configured global minimum interval of {1}. Polling will be executed with the global minimum interval instead.",[value,this.minInterval])
}return isValid
}});
CQ.Ext.override(CQ.Ext.form.ComboBox,{doQuery:function(c,b){c=CQ.Ext.isEmpty(c)?"":c;
var a={query:c,forceAll:b,combo:this,cancel:false};
if(this.fireEvent("beforequery",a)===false||a.cancel){return false
}c=a.query;
b=a.forceAll;
if(b===true||(this.getByteLength(c)>=this.minChars)){if(this.lastQuery!==c){this.lastQuery=c;
if(this.mode=="local"){this.selectedIndex=-1;
if(b){this.store.clearFilter()
}else{this.store.filter(this.displayField,c,this.anyMatch)
}this.onLoad()
}else{this.store.baseParams[this.queryParam]=c;
this.store.load({params:this.getParams(c)});
this.expand()
}}else{this.selectedIndex=-1;
this.onLoad()
}}},getByteLength:function(g){var a=encodeURI(g);
if(a.indexOf("%")!=-1){var c=a.split("%").length-1;
if(c==0){c++
}var b=a.length-(c*3);
c=c+b
}else{c=a.length
}return c
},setValue:function(a){this.setDisplayValue(a,true);
if(this.hiddenField){this.hiddenField.value=CQ.Ext.value(a,"")
}this.value=a;
return this
},setDisplayValue:function(a,g){var b=a;
if(this.valueField){var c=this.findRecord(this.valueField,a);
if(c){b=c.data[this.displayField]
}else{if(this.mode!="local"&&g){this.asyncSetDisplayValue(a);
return
}else{if(CQ.Ext.isDefined(this.valueNotFoundText)){b=this.valueNotFoundText
}}}}this.lastSelectionText=b;
CQ.Ext.form.ComboBox.superclass.setValue.call(this,b)
},asyncSetDisplayValue:function(a){var b=CQ.Ext.isEmpty(a)?"":a;
var c=this;
this.store.baseParams[this.queryParam]=b;
var g=this.store.load({params:this.getParams(b),callback:function(){c.setDisplayValue(c.value,false)
}});
if(!g){c.setDisplayValue(c.value,false)
}}});
CQ.Ext.override(CQ.Ext.form.Checkbox,{onRender:function(c,a){CQ.Ext.form.Checkbox.superclass.onRender.call(this,c,a);
if(this.inputValue!==undefined){this.el.dom.value=this.inputValue
}this.wrap=this.el.wrap({cls:"x-form-check-wrap"});
if(this.boxLabel){var b="x-form-cb-label";
if(this.hideLabel){b="x-form-cb-label-hidden"
}this.wrap.createChild({tag:"label",htmlFor:this.el.id,cls:b,html:this.boxLabel})
}if(this.checked){this.setValue(true)
}else{this.checked=this.el.dom.checked
}if(CQ.Ext.isIE&&!CQ.Ext.isStrict){this.wrap.repaint()
}this.resizeEl=this.positionEl=this.wrap
},setValue:function(a,g){var c=this.checked,b=this.inputValue;
if(a===false){this.checked=false
}else{this.checked=(a===true||a==="true"||a=="1"||(b?a==b:String(a).toLowerCase()=="on"))
}if(this.rendered){this.el.dom.checked=this.checked;
this.el.dom.defaultChecked=this.checked
}if(!g){if(c!=this.checked){this.fireEvent("check",this,this.checked);
if(this.handler){this.handler.call(this.scope||this,this,this.checked)
}}}return this
}});
CQ.Ext.override(CQ.Ext.form.DateField,{getErrors:function(j){var m=CQ.Ext.form.DateField.superclass.getErrors.apply(this,arguments);
j=this.formatDate(j||this.processValue(this.getRawValue()));
if(j.length<1){return m
}var c=j;
j=this.parseDate(j);
if(!j){m.push(String.format(this.invalidText,CQ.shared.Util.htmlEncode(c),this.format));
return m
}var k=j.getTime();
if(this.minValue&&k<this.minValue.clearTime().getTime()){m.push(String.format(this.minText,this.formatDate(this.minValue)))
}if(this.maxValue&&k>this.maxValue.clearTime().getTime()){m.push(String.format(this.maxText,this.formatDate(this.maxValue)))
}if(this.disabledDays){var a=j.getDay();
for(var b=0;
b<this.disabledDays.length;
b++){if(a===this.disabledDays[b]){m.push(this.disabledDaysText);
break
}}}var g=this.formatDate(j);
if(this.disabledDatesRE&&this.disabledDatesRE.test(g)){m.push(String.format(this.disabledDatesText,g))
}return m
}});
CQ.Ext.override(CQ.Ext.grid.GridView,{getColumnStyle:function(b,g){var a=this.cm,k=a.config,c=g?(k[b].headerStyle||""):(k[b].cellStyle||k[b].css||""),j=k[b].align;
c+=String.format("width: {0};",this.getColumnWidth(b));
if(a.isHidden(b)){c+="display: none; "
}if(j){c+=String.format("text-align: {0};",j)
}return c
},getColumnData:function(){var j=[],c=this.cm,k=c.getColumnCount(),a=this.ds.fields,g,b;
for(g=0;
g<k;
g++){b=c.getDataIndex(g);
j[g]={name:CQ.Ext.isDefined(b)?b:(a.get(g)?a.get(g).name:undefined),renderer:c.getRenderer(g),scope:c.getRendererScope(g),id:c.getColumnId(g),style:this.getColumnStyle(g),css:c.config[g].cellCls}
}return j
},renderHeaders:function(){var j=this.cm,k=this.templates,a=k.hcell,g={},m=j.getColumnCount(),n=m-1,o=[],c,b;
for(c=0;
c<m;
c++){if(c==0){b="x-grid3-cell-first "
}else{b=c==n?"x-grid3-cell-last ":""
}g={id:j.getColumnId(c),value:j.getColumnHeader(c)||"",style:this.getColumnStyle(c,true),css:b,tooltip:this.getColumnTooltip(c)};
g.css+=j.config[c].headerCls?j.config[c].headerCls+" ":"";
if(j.config[c].align=="right"){g.istyle="padding-right: 16px;"
}else{delete g.istyle
}o[c]=a.apply(g)
}return k.header.apply({cells:o.join(""),tstyle:String.format("width: {0};",this.getTotalWidth())})
},doRender:function(g,B,r,a,x,z){var n=this.templates,c=n.cell,E=n.row,u=x-1,b="width:"+this.getTotalWidth()+";",o=[],q=[],t={tstyle:b},w={},C=B.length,D,m,k,A,y,v;
for(y=0;
y<C;
y++){k=B[y];
q=[];
v=y+a;
for(A=0;
A<x;
A++){m=g[A];
w.id=m.id;
w.css=A===0?"x-grid3-cell-first ":(A==u?"x-grid3-cell-last ":"");
w.css+=(m.css?m.css+" ":"");
w.attr=w.cellAttr="";
w.style=m.style;
w.value=m.renderer.call(m.scope,k.data[m.name],w,k,v,A,r);
if(CQ.Ext.isEmpty(w.value)){w.value="&#160;"
}if(this.markDirty&&k.dirty&&typeof k.modified[m.name]!="undefined"){w.css+=" x-grid3-dirty-cell"
}q[q.length]=c.apply(w)
}D=[];
if(z&&((v+1)%2===0)){D[0]="x-grid3-row-alt"
}if(k.dirty){D[1]=" x-grid3-dirty-row"
}t.cols=x;
if(this.getRowClass){D[2]=this.getRowClass(k,v,t,r)
}t.alt=D.join(" ");
t.cells=q.join("");
o[o.length]=E.apply(t)
}return o.join("")
}});
CQ.Ext.override(CQ.Ext.grid.GridView.SplitDragZone,{b4StartDrag:function(a,j){this.dragHeadersDisabled=this.view.headersDisabled;
this.view.headersDisabled=true;
var g=this.view.mainWrap.getHeight();
this.marker.setHeight(g);
this.marker.show();
this.marker.alignTo(this.view.getHeaderCell(this.cellIndex),"tl-tl",[-2,0]);
this.proxy.setHeight(g);
var b=this.cm.getColumnWidth(this.cellIndex),c=Math.max(b-this.grid.minColumnWidth,0);
this.resetConstraints();
this.setXConstraint(c,1000);
this.setYConstraint(0,0);
this.minX=a-c;
this.maxX=a+1000;
this.startPos=a;
CQ.Ext.dd.DDProxy.prototype.b4StartDrag.call(this,a,j);
if(this.enableTooltip&&this.showTooltip){this.showTooltip(a,j)
}},endDrag:function(j){this.marker.hide();
var a=this.view,c=Math.max(this.minX,j.getPageX()),g=c-this.startPos,b=this.dragHeadersDisabled;
a.onColumnSplitterMoved(this.cellIndex,this.cm.getColumnWidth(this.cellIndex)+g);
setTimeout(function(){a.headersDisabled=b
},50);
if(this.enableTooltip&&this.hideTooltip){this.hideTooltip(j.getPageX(),j.getPageY())
}}});
CQ.Ext.override(CQ.Ext.grid.Column,{renderer:function(a){if(typeof a=="string"&&a.length<1){return"&#160;"
}return CQ.shared.XSS.getXSSValue(a)
}});
CQ.Ext.override(CQ.Ext.grid.ColumnModel,{setConfig:function(j,g){var k,n,a;
if(!g){delete this.totalWidth;
for(k=0,a=this.config.length;
k<a;
k++){n=this.config[k];
if(n.setEditor){n.setEditor(null)
}n.destroy()
}}this.defaults=CQ.Ext.apply({width:this.defaultWidth,sortable:this.defaultSortable},this.defaults);
this.config=j;
this.lookup={};
for(k=0,a=j.length;
k<a;
k++){n=CQ.Ext.applyIf(j[k],this.defaults);
if(CQ.Ext.isEmpty(n.id)){n.id=k
}if(!n.isColumn){if(n.xtype=="nt:unstructured"){n.xtype="gridcolumn"
}if(n.width){try{n.width=parseInt(n.width)
}catch(b){}}var m=CQ.Ext.grid.Column.types[n.xtype||"gridcolumn"];
n=new m(n);
j[k]=n
}this.lookup[n.id]=n
}if(!g){this.fireEvent("configchange",this)
}},defaultRenderer:function(a){if(typeof a=="string"&&a.length<1){return"&#160;"
}return CQ.shared.XSS.getXSSValue(a)
}});
CQ.Ext.override(CQ.Ext.layout.FormLayout,{labelSeparator:"",getTemplateArgs:function(c){var a=!c.fieldLabel||c.hideLabel,b=(c.itemCls||this.container.itemCls||"")+(c.hideLabel?" x-hide-label":"");
if(CQ.Ext.isIE9&&CQ.Ext.isIEQuirks&&c instanceof CQ.Ext.form.TextField){b+=" x-input-wrapper"
}return{id:c.id,label:(!c.fieldLabel&&!c.allowBlank)?"&nbsp;":c.fieldLabel,itemCls:b,clearCls:c.clearCls||"x-form-clear-left",labelStyle:this.getLabelStyle(c.labelStyle),elementStyle:this.elementStyle||"",labelSeparator:a?"":(CQ.Ext.isDefined(c.labelSeparator)?c.labelSeparator:this.labelSeparator),fieldSubLabel:c.fieldSubLabel?'<br><span class="sub-label">'+c.fieldSubLabel+"</span>":"",fieldDescription:c.fieldDescription?'<div style="'+(this.elementStyle||"")+'" class="x-form-item-description">'+c.fieldDescription+"</div>":"",asterisk:c.allowBlank===false?'<span class="cq-asterisk">*</span>':""}
},fieldTpl:(function(){var a=new CQ.Ext.Template('<div class="x-form-item {itemCls}" tabIndex="-1">','<label for="{id}" style="{labelStyle}" class="x-form-item-label">{label}{labelSeparator}{fieldSubLabel}{asterisk}</label>','<div class="x-form-element" id="x-form-el-{id}" style="{elementStyle}">','</div>{fieldDescription}<div class="{clearCls}"></div>',"</div>");
a.disableFormats=true;
return a.compile()
})()});
CQ.Ext.override(CQ.Ext.layout.TableLayout,{getNextCell:function(o){var a=this.getNextNonSpan(this.currentColumn,this.currentRow);
var k=this.currentColumn=a[0],j=this.currentRow=a[1];
for(var n=j;
n<j+(o.rowspan||1);
n++){if(!this.cells[n]){this.cells[n]=[]
}for(var g=k;
g<k+(o.colspan||1);
g++){this.cells[n][g]=true
}}var m=document.createElement("td");
if(o.cellId){m.id=o.cellId
}var b="x-table-layout-cell";
if(o.cellCls){b+=" "+o.cellCls
}if(o.cellStyle){CQ.Ext.DomHelper.applyStyles(m,o.cellStyle)
}m.className=b;
if(o.colspan){m.colSpan=o.colspan
}if(o.rowspan){m.rowSpan=o.rowspan
}this.getRow(j).appendChild(m);
return m
}});
CQ.Ext.override(CQ.Ext.layout.ToolbarLayout,{insertCell:function(k,g,a){var b=(CQ.Ext.isIE6||CQ.Ext.isIE7?g.ownerDocument||document:document);
var j=b.createElement("td");
j.className="x-toolbar-cell";
g.insertBefore(j,g.childNodes[a]||null);
return j
}});
CQ.Ext.override(CQ.Ext.menu.Menu,{constrainScroll:function(n){var b,g=this.ul.setHeight("auto").getHeight(),a=n,m,j,k,c;
if(this.floating){j=CQ.Ext.fly(this.el.dom.parentNode);
k=j.getScroll().top;
c=j.getViewSize().height;
if(j.dom.id==CQ.utils.Util.ROOT_ID){k=CQ.Ext.getBody().getScroll().top;
c=CQ.Ext.getBody().getViewSize().height
}m=n-k;
b=this.maxHeight?this.maxHeight:c-m;
if(g>c){b=c;
a=n-m
}else{if(b<g){a=n-(g-b);
b=g
}}}else{b=this.getHeight()
}if(this.maxHeight){b=Math.min(this.maxHeight,b)
}if(g>b&&b>0){this.activeMax=b-this.scrollerHeight*2-this.el.getFrameWidth("tb")-CQ.Ext.num(this.el.shadowOffset,0);
this.ul.setHeight(this.activeMax);
this.createScrollers();
this.el.select(".x-menu-scroller").setDisplayed("")
}else{this.ul.setHeight(g);
this.el.select(".x-menu-scroller").setDisplayed("none")
}this.ul.dom.scrollTop=0;
return a
}});
CQ.Ext.override(CQ.Ext.ToolTip,{initTarget:function(b){var a;
if((a=CQ.Ext.get(b))){this.cleanupTarget();
this.mon(a,{mouseover:this.onTargetOver,mouseout:this.onTargetOut,mousemove:this.onMouseMove,scope:this});
this.target=a
}if(this.anchor){this.anchorTarget=this.target
}},cleanupTarget:function(){if(this.target){var a=CQ.Ext.get(this.target);
this.mun(a,"mouseover",this.onTargetOver,this);
this.mun(a,"mouseout",this.onTargetOut,this);
this.mun(a,"mousemove",this.onMouseMove,this)
}}});
CQ.Ext.override(CQ.Ext.tree.TreePanel,{stateful:false,stateEvents:["selectionchange"],getState:function(){var a=this.getBox();
return{width:a.width,selectedPath:this.selectedPath}
},initComponent:function(){CQ.Ext.tree.TreePanel.superclass.initComponent.call(this);
if(!this.eventModel){this.eventModel=new CQ.Ext.tree.TreeEventModel(this)
}var a=this.loader;
if(!a){a=new CQ.Ext.tree.TreeLoader({dataUrl:this.dataUrl,requestMethod:this.requestMethod})
}else{if(CQ.Ext.isObject(a)&&!a.load){a=new CQ.Ext.tree.TreeLoader(a)
}}this.loader=a;
this.nodeHash={};
if(this.root){var b=this.root;
delete this.root;
this.setRootNode(b)
}this.addEvents("append","remove","movenode","insert","beforeappend","beforeremove","beforemovenode","beforeinsert","beforeload","load","textchange","beforeexpandnode","beforecollapsenode","expandnode","disabledchange","collapsenode","beforeclick","click","containerclick","checkchange","beforedblclick","dblclick","containerdblclick","contextmenu","containercontextmenu","beforechildrenrendered","startdrag","enddrag","dragdrop","beforenodedrop","nodedrop","nodedragover","selectionchange");
if(this.singleExpand){this.on("beforeexpandnode",this.restrictExpand,this)
}if(this.getSelectionModel()){this.getSelectionModel().on("selectionchange",function(c,g){if(g){this.selectedPath=g.getPath();
this.fireEvent("selectionchange",this,this.selectedPath)
}},this)
}this.on("render",function(c){if(c.selectedPath){window.setTimeout(function(){c.selectPath(c.selectedPath)
},0)
}},this)
},splitPath:function(j,a){a=a||"name";
var c=j.split(this.pathSeparator);
var b=this.root.attributes[a];
var g=b.split("/").length;
if(g>1){c.splice(1,g,b)
}return c
},expandPath:function(k,a,m){a=a||"name";
var g=this.splitPath(k,a);
var c=this.root;
if(c.attributes[a]!=g[1]){if(m){m(false,null)
}return
}var b=1;
var j=function(){if(++b==g.length){if(m){m(true,c)
}return
}var n=c.findChild(a,g[b]);
if(!n){if(m){m(false,c)
}return
}c=n;
n.expand(false,false,j)
};
c.expand(false,false,j)
},selectPath:function(j,a,k){if(CQ.Ext.isEmpty(j)){if(k){k(false,undefined)
}return
}a=a||"name";
var c=j.split(this.pathSeparator),b=c.pop();
if(c.length>1){var g=function(o,m){if(o&&m){var q=m.findChild(a,b);
if(q){q.select();
if(k){k(true,q)
}}else{if(k){k(false,q)
}}}else{if(k){k(false,q)
}}};
this.expandPath(c.join(this.pathSeparator),a,g)
}else{this.root.select();
if(k){k(true,this.root)
}}}});
CQ.Ext.tree.TreeNodeUI.prototype.onClick=function(c){if(this.dropping){c.stopEvent();
return
}if(this.fireEvent("beforeclick",this.node,c)!==false){var b=c.getTarget("a");
if(!this.disabled&&this.node.attributes.href&&b){this.fireEvent("click",this.node,c);
return
}else{if(b&&c.ctrlKey){c.stopEvent()
}}c.preventDefault();
if(this.disabled){return
}if(this.node.attributes.singleClickExpand&&!this.animating&&this.node.isExpandable()){if(!this.node.isExpanded()){if(!this.node.attributes.autoExpandMax||this.node.attributes.sub<=this.node.attributes.autoExpandMax){this.node.toggle()
}}}this.fireEvent("click",this.node,c)
}else{c.stopEvent()
}};
CQ.Ext.tree.TreeNodeUI.prototype.renderElements=function(j,r,q,t){this.indentMarkup=j.parentNode?j.parentNode.ui.getChildIndent():"";
var k=CQ.Ext.isBoolean(r.checked),b,c=r.href?r.href:CQ.Ext.isGecko?"":"#",g=['<li class="x-tree-node"><div ext:tree-node-id="',j.id,'" class="x-tree-node-el x-tree-node-leaf x-unselectable ',r.cls,'" unselectable="on">','<span class="x-tree-node-indent">',this.indentMarkup,"</span>",'<img src="',this.emptyIcon,'" class="x-tree-ec-icon x-tree-elbow" />','<img src="',r.icon||this.emptyIcon,'" class="x-tree-node-icon',(r.icon?" x-tree-node-inline-icon":""),(r.iconCls?" "+r.iconCls:""),'" unselectable="on" />',k?('<input class="x-tree-node-cb" type="checkbox" '+(r.checked?'checked="checked" />':"/>")):"",'<a hidefocus="on" class="x-tree-node-anchor" href="',c,'" tabIndex="1" ',r.hrefTarget?' target="'+r.hrefTarget+'"':"",'><span unselectable="on">',CQ.shared.XSS.getXSSValue(j.text.replace(/&lt;/g,"<")),"</span></a></div>",'<ul class="x-tree-node-ct" style="display:none;"></ul>',"</li>"].join("");
if(t!==true&&j.nextSibling&&(b=j.nextSibling.ui.getEl())){this.wrap=CQ.Ext.DomHelper.insertHtml("beforeBegin",b,g)
}else{this.wrap=CQ.Ext.DomHelper.insertHtml("beforeEnd",q,g)
}this.elNode=this.wrap.childNodes[0];
this.ctNode=this.wrap.childNodes[1];
var o=this.elNode.childNodes;
this.indentNode=o[0];
this.ecNode=o[1];
this.iconNode=o[2];
var m=3;
if(k){this.checkbox=o[3];
this.checkbox.defaultChecked=this.checkbox.checked;
m++
}this.anchor=o[m];
this.textNode=o[m].firstChild
};
CQ.Ext.override(CQ.Ext.PagingToolbar,{updateInfo:function(){if(this.displayItem){var b=this.store.getCount();
var a=this.store.getTotalCount();
if(a==-1){this.last.setDisabled(true);
a="unknown"
}var c=b==0?this.emptyMsg:String.format(this.displayMsg,this.cursor+1,this.cursor+b,a);
this.displayItem.setText(c)
}},getPageData:function(){var b=this.store.getTotalCount();
if(b==-1){var c=Math.ceil((this.cursor+this.pageSize)/this.pageSize);
var a=c+1;
if(this.store.getCount()!=this.pageSize){a=c
}return{total:"unknown",activePage:Math.ceil((this.cursor+this.pageSize)/this.pageSize),pages:"unknown"}
}return{total:b,activePage:Math.ceil((this.cursor+this.pageSize)/this.pageSize),pages:b<this.pageSize?1:Math.ceil(b/this.pageSize)}
},onPagingKeyDown:function(j,g){var b=g.getKey(),m=this.getPageData(),c;
if(b==g.RETURN){g.stopEvent();
c=this.readPage(m);
if(c!==false){if(m.total!="unknown"){c=Math.min(Math.max(1,c),m.pages)-1
}else{c=c-1
}this.doLoad(c*this.pageSize)
}}else{if(b==g.HOME||b==g.END){g.stopEvent();
c=b==g.HOME?1:m.pages;
j.setValue(c)
}else{if(b==g.UP||b==g.PAGEUP||b==g.DOWN||b==g.PAGEDOWN){g.stopEvent();
if((c=this.readPage(m))){var a=g.shiftKey?10:1;
if(b==g.DOWN||b==g.PAGEDOWN){a*=-1
}c+=a;
if(c>=1&c<=m.pages){j.setValue(c)
}}}}}}});
CQ.state.PreferencesProvider=function(b){if(b.data){var a=CQ.data.SlingRecord.create({name:"data"});
this.data=new a(b.data)
}else{if(b.url){this.url=b.url
}}CQ.state.PreferencesProvider.superclass.constructor.call(this)
};
CQ.Ext.extend(CQ.state.PreferencesProvider,CQ.Ext.state.Provider,{url:null,data:null,get:function(a){if(!this.data){this.loadPreferences()
}if(this.data){return this.data.get(a)
}else{CQ.Log.warn("CQ.state.PreferencesProvider#get failed: could not load data")
}},set:function(a,b){this.data.beginEdit();
this.data.set(a,b);
this.data.endEdit()
},loadPreferences:function(){try{if(this.url){var prefs=CQ.HTTP.eval(this.url);
if(prefs){var con=CQ.data.SlingRecord.create({name:"data"});
this.data=new con(prefs)
}else{CQ.Log.debug("CQ.state.PreferencesProvider#loadPreferences: no response for {0}, empty data}",this.url)
}}}catch(e){CQ.Log.warn("CQ.state.PreferencesProvider#loadPreferences: {0}",e.message)
}}});
CQ.utils.Util=function(){var observations={};
var pins=[];
var scrollInterval=null;
var busyCheckingPins=false;
var checkPinsNow=false;
var winWidth=-1;
var idCounter={};
var checkPins=function(){var vpw=CQ.Ext.lib.Dom.getViewportWidth();
winWidth=winWidth>0?winWidth:vpw;
if(!checkPinsNow&&(CQ.utils.Util.docScrolling||vpw<winWidth)){checkPinsNow=true
}else{if(!busyCheckingPins&&checkPinsNow){busyCheckingPins=true;
for(var i=0;
i<pins.length;
i++){var el=pins[i].pin;
if(el.getEl){el=el.getEl()
}var box=el.getBox();
var offsetLeft=0;
var totalWidth=box.x+box.width+CQ.themes.Dialog.CORNER_X;
if(winWidth<totalWidth){offsetLeft=winWidth-totalWidth
}var curScroll=CQ.Ext.getDoc().getScroll();
var lastScroll=pins[i].scroll;
var offsetTop=curScroll.top-lastScroll.top;
offsetLeft+=curScroll.left-lastScroll.left;
var x=(box.x+offsetLeft);
var y=(box.y+offsetTop);
el.shift({x:x,y:y,duration:0.2});
pins[i].scroll=curScroll
}busyCheckingPins=false;
checkPinsNow=false
}}winWidth=vpw
};
var getObservation=function(interval){var name;
if(!interval){name=CQ.SHORT_INTERVAL
}else{if(typeof interval=="number"&&interval>0){name="CUSTOM_INTERVAL_"+interval
}else{name=interval
}}if(!observations[name]){var time;
if(typeof interval=="number"&&interval>0){time=interval
}else{switch(interval){case CQ.VERY_SHORT_INTERVAL:time=CQ.VERY_SHORT_INTERVAL_VALUE;
break;
case CQ.LONG_INTERVAL:time=CQ.LONG_INTERVAL_VALUE;
break;
case CQ.VERY_LONG_INTERVAL:time=CQ.VERY_LONG_INTERVAL_VALUE;
break;
default:time=CQ.SHORT_INTERVAL_VALUE
}}observations[name]={components:[],name:name,time:time,started:false}
}return observations[name]
};
var isCqInstance=function(item){return item instanceof CQ.Ext.util.Observable||item instanceof CQ.Ext.Element||item instanceof CQ.Ext.data.DataReader||item instanceof CQ.Class
};
var processIncludes=function(data){if(typeof(data)!="object"){return data
}if(data.xtype=="cqinclude"){if(data.path){CQ.Log.debug("CQ.utils.Util#processIncludes: processing include: {0}",data);
var path=CQ.HTTP.externalize(data.path);
path=CQ.HTTP.addSelector(path,"overlay");
data=CQ.Util.eval(path)
}else{CQ.Log.debug("CQ.utils.Util#processIncludes: no include path defined in {0}",data[i])
}return processIncludes(data)
}else{for(var i in data){if(!data[i]){continue
}if(typeof(data[i])=="object"){if(data[i].xtype){if(data[i].xtype=="cqinclude"){if(data[i].path){CQ.Log.debug("CQ.utils.Util#processIncludes: processing include: {0}",data[i]);
var path=CQ.HTTP.externalize(data[i].path);
path=CQ.HTTP.addSelector(path,"overlay");
data[i]=CQ.Util.eval(path)
}else{CQ.Log.debug("CQ.utils.Util#processIncludes: no include path defined in {0}",data[i])
}}data[i]=processIncludes(data[i])
}}}}return data
};
return{ROOT_ID:"CQ",I18N_ONLY:1,FORMAT_ONLY:2,NO_I18N_SUFFIX:"_noI18n",COMMENT_I18N_SUFFIX:"_commentI18n",docScrolling:false,createRoot:function(){var root=new CQ.Ext.Element(document.createElement("div"));
root.dom.id=CQ.utils.Util.ROOT_ID;
try{document.body.appendChild(root.dom);
return root
}catch(e){return null
}},getRoot:function(){return CQ.Ext.get(CQ.utils.Util.ROOT_ID)
},isRoot:function(item){return item==document.body||item==CQ.utils.Util.ROOT_ID||item==CQ.Ext.getBody()
},build:function(data,noFormatting,callback,debug,extensions){if(typeof data!="object"){CQ.Log.debug("CQ.utils.Util.build: retrieving component data from {0}",data);
try{if(callback){var buildCallback=function(options,success,xhr,response){if(success){var component=CQ.utils.Util.build(CQ.HTTP.eval(response),noFormatting,callback,debug,extensions);
callback(component)
}else{CQ.Log.error("CQ.utils.Util.build: callback failed to fetch data ({0})",response.statusText)
}};
return CQ.HTTP.get(data,buildCallback)
}else{return CQ.utils.Util.build(CQ.HTTP.eval(data),noFormatting,callback,debug,extensions)
}}catch(e){CQ.Log.error("CQ.utils.Util.build: failed to fetch data ({0})",e.message);
return null
}}else{if(!noFormatting){data=CQ.utils.Util.formatData(data)
}if(debug){data.debug=debug
}if(extensions){if(!data.extensions){data.extensions={}
}for(var xnName in extensions){data.extensions[xnName]=[];
for(var i=0;
i<extensions[xnName].length;
i++){var xn=extensions[xnName][i];
data.extensions[xnName].push(xn)
}}}CQ.Log.info("CQ.utils.Util.build: building component of type '{0}'",data.xtype);
return CQ.Ext.ComponentMgr.create(data)
}},formatData:function(data,mode){if(!data||data.nodeType||isCqInstance(data)){return data
}if(data instanceof Array){for(var i=0;
i<data.length;
i++){data[i]=CQ.utils.Util.formatData(data[i])
}return data
}if(mode!=CQ.Util.I18N_ONLY){if(!data.xtype&&data["jcr:primaryType"]&&!data["jcr:primaryType"].match(/cq\:Widget/)&&data["jcr:primaryType"].indexOf("cq:")==0){data.xtype=data["jcr:primaryType"].toLowerCase().replace("cq:","")
}if(data["jcr:title"]&&!data.title){data.title=data["jcr:title"]
}}data=processIncludes(data);
for(var i in data){if(!data[i]){continue
}if(typeof(data[i])=="object"){data[i]=CQ.utils.Util.formatData(data[i]);
if(mode==CQ.Util.I18N_ONLY){continue
}if(data[i]["jcr:primaryType"]){if(data[i]["jcr:primaryType"].match(/cq\:.*Collection/)){var array=[];
for(var j in data[i]){if(typeof(data[i][j])=="object"||(j!="xtype"&&j!="jcr:primaryType")){array.push(data[i][j])
}}if(i=="items"&&array.length==1){data[i]=array[0]
}else{data[i]=array
}}}}else{if(typeof data[i]=="string"){if(i=="emptyText"){data[i]=data[i]+"  "
}else{if(data[i]=="true"){data[i]=true
}else{if(data[i]=="false"){data[i]=false
}else{if(i=="regex"){try{data[i]=eval(data[i])
}catch(e){}}else{if(data[i]==="0"||/^[1-9]\d+$/.test(data[i])){data[i]=parseInt(data[i])
}else{if(/function\(.*/.test(data[i])){try{eval("data[i] = "+data[i]+";")
}catch(e){}}}}}}}}}}if(mode!=CQ.Util.FORMAT_ONLY){var names=["title","text","tooltip","qtip","tabTip","fieldLabel","fieldSubLabel","fieldDescription","boxLabel","regexText","vtypeText","emptyText","cq:emptyText","rootTitle","widthPrefix","widthSuffix","heightPrefix","heightSuffix","displayMsg","pageText","maxMsg","emptyMsg","beforePageText","afterPageText","firstText","prevText","nextText","lastText","refreshText"];
if(data.header&&typeof data.header=="string"){names.push("header")
}for(var i=0;
i<names.length;
i++){var name=names[i];
if(data[name+CQ.utils.Util.NO_I18N_SUFFIX]){data[name]=data[name+CQ.utils.Util.NO_I18N_SUFFIX];
delete data[name+CQ.utils.Util.NO_I18N_SUFFIX]
}else{if(data[name]&&(typeof(data[name])=="string")){data[name]=CQ.I18n.getVarMessage(data[name],data[name+CQ.utils.Util.COMMENT_I18N_SUFFIX])
}}if(data[name+CQ.utils.Util.COMMENT_I18N_SUFFIX]){delete data[name+CQ.utils.Util.COMMENT_I18N_SUFFIX]
}}}return data
},addListenerToConfig:function(obj,event,handler){if(!obj.listeners){obj.listeners={}
}if(typeof obj.listeners!=="object"){return
}var originalHandler=obj.listeners[event];
if(typeof originalHandler==="string"){originalHandler=CQ.Util.formatData({fn:originalHandler}).fn
}if(typeof originalHandler==="function"){obj.listeners[event]=function(){originalHandler.apply(this,arguments);
handler.apply(this,arguments)
}
}else{obj.listeners[event]=handler
}},merge:function(base,upgrade){if(!upgrade){return base
}if(!base){if(upgrade instanceof Array){return upgrade
}base=new Object()
}for(var name in upgrade){var value=upgrade[name];
if(value instanceof CQ.Ext.Component){base[name]=value
}else{if(value&&typeof value=="object"){if(value instanceof Array){base[name]=value
}else{base[name]=CQ.utils.Util.merge(base[name],value)
}}else{base[name]=value
}}}return base
},applyDefaults:function(base,defaults){if(!defaults){return base
}if(defaults instanceof Array||typeof defaults!="object"){if(typeof base=="undefined"){return defaults
}else{return base
}}if(!base){base=new Object()
}for(var name in defaults){var value=defaults[name];
if(value&&typeof value=="object"&&!(value instanceof Array)&&!isCqInstance(value)){base[name]=CQ.utils.Util.applyDefaults(base[name],value)
}else{if(typeof base[name]=="undefined"){base[name]=value
}}}return base
},patchText:function(text,snippets){return CQ.shared.Util.patchText(text,snippets)
},trim:function(str){return(str?str.trim():str)
},unwrapParens:function(str){if(str&&str.charAt(0)=="("&&str.charAt(str.length-1)==")"){return str.slice(1,str.length-1).trim()
}else{return str
}},isLiteral:function(str){if(!str){return false
}return((str.charAt(0)=='"'&&str.charAt(str.length-1)=='"')||(str.charAt(0)=="'"&&str.charAt(str.length-1)=="'"))
},quote:function(str){return str?'"'+str+'"':str
},unquote:function(str){if((str&&str.charAt(0)=="'"&&str.charAt(str.length-1)=="'")||(str&&str.charAt(0)=='"'&&str.charAt(str.length-1)=='"')){return str.slice(1,str.length-1)
}else{return str
}},eval:function(response){return CQ.HTTP.eval(response)
},evalHTML:function(html){try{var node=document.createElement("div");
node.innerHTML=html;
var obj=CQ.utils.Util.evalNode(node);
node=null;
return obj
}catch(e){return{}
}},evalNode:function(node,obj){if(!node){return null
}if(obj==undefined){obj=new Object()
}try{for(var i=0;
i<node.childNodes.length;
i++){var child=node.childNodes[i];
if(child.tagName){if(child.id){if(child.href){obj[child.id]=child.href
}else{obj[child.id]=child.innerHTML
}}obj=CQ.utils.Util.evalNode(child,obj)
}}}catch(e){}return obj
},reload:function(win,url){if(!win){win=window
}if(CQ.WCM.getTopWindow()!==win){CQ.WCM.setContentWindowLoading(true)
}CQ.shared.Util.reload(win,url)
},clearDocumentSelection:function(win){CQ.DOM.clearDocumentSelection(win)
},getContextPath:function(){return CQ.HTTP.getContextPath()
},detectContextPath:function(){CQ.HTTP.detectContextPath()
},externalize:function(url){return CQ.HTTP.externalize(url)
},internalize:function(url,doc){return CQ.HTTP.internalize(url,doc)
},getPath:function(url){return CQ.HTTP.getPath(url)
},getSingleItemConfig:function(config,xtype){try{if(config.items.xtype==xtype){return config.items
}}catch(e){return null
}},copyObject:function(object){var newObj;
if(object instanceof Array||CQ.Ext.isArray(object)){newObj=new Array();
for(var i=0;
i<object.length;
i++){if(typeof object[i]=="object"&&!isCqInstance(object[i])){newObj.push(CQ.utils.Util.copyObject(object[i]))
}else{newObj.push(object[i])
}}}else{newObj=new Object();
for(var i in object){if(typeof object[i]=="object"&&!isCqInstance(object[i])&&!(object[i] instanceof RegExp)){newObj[i]=CQ.utils.Util.copyObject(object[i])
}else{newObj[i]=object[i]
}}}return newObj
},indexInArray:function(array,value){for(var i=0;
i<array.length;
i++){if(array[i]==value){return i
}}return -1
},compareValues:function(v1,v2){if(v1 instanceof Array&&v2 instanceof Array){if(v1.length==v2.length){for(var i=0;
i<v1.length;
i++){var check=CQ.utils.Util.compareValues(v1[i],v2[i]);
if(check!=0){return check
}}return 0
}else{return v1.length>v1.length?1:-1
}}else{return v1>v2?1:(v1<v2?-1:0)
}},pin:function(item){pins.push({pin:item,scroll:{top:0,left:0}});
if(!scrollInterval){CQ.Ext.EventManager.on(window,"scroll",function(){docScrolling=true;
window.setTimeout(function(){docScrolling=false
},274)
});
scrollInterval=window.setInterval(function(){checkPins()
},195)
}},unpin:function(item){for(var i=0;
i<pins.length;
i++){if(pins[i].pin==item){pins.splice(i,1);
break
}}},createId:function(id){id=id?id:"cq-id";
if(!idCounter[id]){idCounter[id]=0
}return id+"-"+idCounter[id]++
},isIntersecting:function(firstObj,secondObj,exclude){if(firstObj&&secondObj){for(var prop in firstObj){if((!exclude||!exclude[prop])&&secondObj[prop]==firstObj[prop]){return true
}}}return false
},runComponentObservation:function(interval,rerun){var obs=getObservation(interval);
for(var i=0;
i<obs.components.length;
i++){try{if(obs.components[i].observe){obs.components[i].observe(obs.name)
}else{CQ.Log.warn("CQ.Util#runComponentObservation: component has no method observe")
}}catch(e){CQ.Log.error("CQ.Util#runComponentObservation: observe method throws an exception: {0}",e.message)
}}if(rerun){window.setTimeout("CQ.Util.runComponentObservation('"+obs.name+"', true);",obs.time)
}},observeComponent:function(component,interval){var obs=getObservation(interval);
for(var i=0;
i<obs.components.length;
i++){if(obs.components[i]==component){return
}}obs.components.push(component);
if(!obs.started){obs.started=true;
CQ.Util.runComponentObservation(obs.name,true)
}},cancelObservation:function(component,interval){var obs=getObservation(interval);
for(var i=0;
i<obs.components.length;
i++){if(obs.components[i]==component){obs.components.splice(i,1);
return
}}},getFlashVersion:function(){var flashVer=null;
if(navigator.plugins!=null&&navigator.plugins.length>0){if(navigator.plugins["Shockwave Flash 2.0"]||navigator.plugins["Shockwave Flash"]){var swVer2=navigator.plugins["Shockwave Flash 2.0"]?" 2.0":"";
var flashDescription=navigator.plugins["Shockwave Flash"+swVer2].description;
var descArray=flashDescription.split(" ");
var tempArrayMajor=descArray[2].split(".");
var versionMajor=tempArrayMajor[0];
var versionMinor=tempArrayMajor[1];
var versionRevision=descArray[3];
if(versionRevision==""){versionRevision=descArray[4]
}if(versionRevision[0]=="d"){versionRevision=versionRevision.substring(1)
}else{if(versionRevision[0]=="r"){versionRevision=versionRevision.substring(1);
if(versionRevision.indexOf("d")>0){versionRevision=versionRevision.substring(0,versionRevision.indexOf("d"))
}}}flashVer=[parseInt(versionMajor),parseInt(versionMinor),parseInt(versionRevision)]
}}else{if(CQ.Ext.isIE&&CQ.Ext.isWindows&&!CQ.Ext.isOpera){var version;
var axo;
try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");
version=axo.GetVariable("$version")
}catch(e){}if(!version){try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");
version="WIN 6,0,21,0";
axo.AllowScriptAccess="sameDomain";
version=axo.GetVariable("$version")
}catch(e){}}if(!version){try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.3");
version=axo.GetVariable("$version")
}catch(e){}}if(!version){try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.3");
version="WIN 3,0,18,0"
}catch(e){}}if(!version){try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");
version="WIN 2,0,0,11"
}catch(e){}}if(version){var platformSplit=version.split(" ");
if(platformSplit.length==2){flashVer=platformSplit[1].split(",");
for(var i=0;
i<flashVer.length;
i++){flashVer[i]=parseInt(flashVer[i])
}}}}}return flashVer
},isEqualPosition:function(position1,position2,tolerance){if(!tolerance){tolerance=0
}if(position1&&position2){var xdiff=Math.abs(position1[0]-position2[0]);
var ydiff=Math.abs(position1[1]-position2[1]);
return(xdiff<=tolerance)&&(ydiff<=tolerance)
}return false
},findFormFields:function(container,fields){if(!container){return{}
}if(!fields){fields=new Object()
}if(container.items&&container.items.length){for(var i=0;
i<container.items.length;
i++){var item=container.getComponent(i);
if(item.isFormField){var name=item.getName();
if(!name){name=item.name
}if(fields[name]==undefined){fields[name]=new Array()
}fields[name].push(item)
}else{if(item.items){fields=CQ.Util.findFormFields(item,fields)
}}}}return fields
},enableFields:function(container){var fields=CQ.Util.findFormFields(container);
for(var name in fields){for(var i=0;
i<fields[name].length;
i++){var field=fields[name][i];
if(field){if(field.enable){field.enable()
}if(field.dropTargets){for(var i=0;
i<field.dropTargets.length;
i++){if(field.dropTargets[i].unlock){field.dropTargets[i].unlock()
}}}}}}},disableFields:function(container){var fields=CQ.Util.findFormFields(container);
for(var name in fields){for(var i=0;
i<fields[name].length;
i++){var field=fields[name][i];
if(field){if(field.disable){field.disable()
}if(field.dropTargets){for(var i=0;
i<field.dropTargets.length;
i++){if(field.dropTargets[i].lock){field.dropTargets[i].lock()
}}}}}}},toggleComponent:function(component,enableCondition){if(component){enableCondition?component.enable():component.disable()
}},logout:function(){CQ.User.logout()
},isAcceptedMimeType:function(acceptPatternArray,mimeType){for(var i=0;
i<acceptPatternArray.length;
i++){var acceptPattern=acceptPatternArray[i];
if(mimeType.match(acceptPattern)){return true
}}return false
},escapePath:function(path){var pathComponents=path.split("/");
CQ.Ext.each(pathComponents,function(item,index){pathComponents[index]=encodeURIComponent(item)
});
return pathComponents.join("/")
},sortByRanking:function(array){try{array.sort(function(a,b){try{var result=a.ranking-b.ranking;
if(!isNaN(result)){return result
}}catch(e){}var ar=isNaN(a.ranking)?"X":parseInt(a.ranking);
var br=isNaN(b.ranking)?"X":parseInt(b.ranking);
ar=ar!="X"?ar:(br=="X"?0:br+1);
br=br!="X"?br:ar+1;
return ar-br
})
}catch(e){}return array
},isEmptyObject:function(obj){if(!obj){return false
}for(var p in obj){return false
}return true
},renderDate:function(date){if(!date){return""
}var ms=new Date(date).getElapsed();
var seconds=Math.floor(ms/1000);
var minutes=Math.floor(ms/(60*1000));
var hours=Math.floor(ms/(60*60*1000));
var days=Math.floor(ms/(24*60*60*1000));
var weeks=Math.floor(ms/(7*24*60*60*1000));
var months=Math.floor(ms/(30*24*60*60*1000));
var years=Math.floor(ms/(365*24*60*60*1000));
if(seconds<80){return CQ.I18n.getMessage("now")
}else{if(minutes<2){return CQ.I18n.getMessage("{0} seconds ago",""+seconds)
}else{if(hours<2){return CQ.I18n.getMessage("{0} minutes ago",""+minutes)
}else{if(days<2){return CQ.I18n.getMessage("{0} hours ago",""+hours)
}else{if(weeks<2){return CQ.I18n.getMessage("{0} days ago",""+days)
}else{if(months<2){return CQ.I18n.getMessage("{0} weeks ago",""+weeks)
}else{if(years<2){return CQ.I18n.getMessage("{0} months ago",""+months)
}else{return CQ.I18n.getMessage("{0} years ago",""+years)
}}}}}}}},formatFileSize:function(size){var unit;
if(size<1000){unit="bytes"
}else{if(size<1048576){size=Math.round(size/1024);
unit="KB"
}else{if(size<1073741824){size=new String(size/1048576);
unit="MB"
}else{size=new String(size/1073741824);
unit="GB"
}var point=size.indexOf(".");
if(point>0){if(size.charAt(point+1)=="0"){size=size.substring(0,point)
}else{size=size.substring(0,point+2)
}}}}return size+" "+unit
},getAbsoluteParent:function(path,level){if(path&&path.indexOf("/")==0&&level>0){var newPath="";
var segments=path.split("/");
segments.splice(0,1);
if(level>segments.length){return path
}var i=0;
while(i<=level-1&&i<segments.length){newPath+="/"+segments[i];
i++
}return newPath
}return path
}}
}();
CQ.Util=CQ.utils.Util;
CQ.utils.Log=function(){var logCounter=0;
var logLevelNames={0:" OFF ",1:"FATAL",2:"ERROR",3:"WARN ",4:"INFO ",5:"DEBUG",6:"TRACE",7:" ALL "};
var getInitialLogLevel=function(){if(window.CQ_initial_log_level){if(typeof window.CQ_initial_log_level==="string"){for(var i in logLevelNames){if(logLevelNames[i].indexOf(window.CQ_initial_log_level)>=0){return i
}}}else{if(typeof window.CQ_initial_log_level==="number"){return window.CQ_initial_log_level
}}}return 0
};
var logLevel=getInitialLogLevel();
var log=function(level,message,snippets){if(logLevel>=level){var text=(++logCounter)+"";
var i=text.length;
while((4-i)>0){text="0"+text;
i++
}text+=" "+logLevelNames[level];
text+=" "+CQ.Ext.util.Format.date(new Date(),"H:m:s");
text+=" "+CQ.Util.patchText(message,snippets);
try{console.log(text)
}catch(e){}}};
return{OFF:0,FATAL:1,ERROR:2,WARN:3,INFO:4,DEBUG:5,TRACE:6,ALL:7,setLevel:function(level){logLevel=level;
try{var console=CQ.Ext.get("x-debug-browser");
if(level==CQ.utils.Log.OFF){console.hide()
}else{console.show()
}}catch(e){}},fatal:function(message,snippets){log(CQ.utils.Log.FATAL,message,snippets)
},error:function(message,snippets){log(CQ.utils.Log.ERROR,message,snippets)
},warn:function(message,snippets){log(CQ.utils.Log.WARN,message,snippets)
},info:function(message,snippets){log(CQ.utils.Log.INFO,message,snippets)
},debug:function(message,snippets){log(CQ.utils.Log.DEBUG,message,snippets)
},trace:function(message,snippets){log(CQ.utils.Log.TRACE,message,snippets)
},traceMethodCalls:function(obj,xtype,onlyOwnMethods,loggerFunc){loggerFunc=loggerFunc||function(objName,methodName,argList,args){console.log(">> "+objName+"."+methodName+"("+argList+")")
};
function functionLogger(objName,funcName){return function(){var argList="";
CQ.Ext.each(arguments,function(o,i,array){var arg;
if(typeof o==="string"){arg='"'+o+'"'
}else{if(typeof o==="function"){arg="function("+o.length+")"
}else{arg=o
}}argList=argList+arg;
if(i<(array.length-1)){argList+=", "
}});
loggerFunc(objName,funcName,argList,arguments)
}
}var objName=(typeof obj==="string"?obj:xtype||"");
var clazz;
if(typeof obj==="string"){eval("clazz = "+obj+".prototype; var tmp = "+obj+"; "+obj+" = "+obj+".createInterceptor(functionLogger('"+obj+"', 'constructor')); for (var x in tmp) {     "+obj+"[x] = tmp[x]; } if (xtype) {     CQ.Ext.reg(xtype, "+obj+"); } ")
}else{clazz=obj
}var logInheritedMethods=onlyOwnMethods?false:true;
for(var i in clazz){if(logInheritedMethods||clazz.hasOwnProperty(i)){var o=clazz[i];
if(typeof o==="function"&&o.createInterceptor){clazz[i]=o.createInterceptor(functionLogger(objName,i))
}}}}}
}();
CQ.Log=CQ.utils.Log;
CQ.utils.HTTP=function(){var createResponse=function(){var response=new Object();
response.headers=new Object();
response.body=new Object();
return response
};
return{EXTENSION_HTML:CQ.shared.HTTP.EXTENSION_HTML,EXTENSION_JSON:CQ.shared.HTTP.EXTENSION_JSON,EXTENSION_RES:CQ.shared.HTTP.EXTENSION_RES,HEADER_STATUS:CQ.shared.HTTP.HEADER_STATUS,HEADER_MESSAGE:CQ.shared.HTTP.HEADER_MESSAGE,HEADER_LOCATION:CQ.shared.HTTP.HEADER_LOCATION,HEADER_PATH:CQ.shared.HTTP.HEADER_PATH,PARAM_NO_CACHE:CQ.shared.HTTP.PARAM_NO_CACHE,get:function(url,callback,scope){url=CQ.HTTP.externalize(url,true);
if(typeof CQ_XHR_HOOK!="undefined"&&CQ.Ext.isFunction(CQ_XHR_HOOK)){var p={url:url,method:"GET"};
try{var out=CQ_XHR_HOOK(p);
if(out){url=out.url
}}catch(e){CQ.Log.error("CQ.utils.HTTP#get: error during CQ_XHR_HOOK call: {0}",[url,e.message])
}}if(callback!=undefined){CQ.Log.debug("CQ.utils.HTTP#get: requesting {0} asynchronously",url);
return CQ.Ext.Ajax.request({url:url,callback:callback,scope:scope})
}else{CQ.Log.debug("CQ.utils.HTTP#get: requesting {0} synchronously",url);
var request=document.all?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest();
try{request.open("GET",url,false);
request.send(null);
var response=createResponse();
response.body=request.responseText;
response.headers[CQ.utils.HTTP.HEADER_STATUS]=request.status;
response.responseText=request.responseText;
response.status=request.status;
CQ.shared.HTTP.handleForbidden(response);
return response
}catch(e){CQ.Log.error("CQ.utils.HTTP#get: failed to get {0}: {1}",[url,e.message]);
return null
}}},post:function(url,callback,params,scope,suppressErrorMsg){url=CQ.HTTP.externalize(url,true);
if(typeof CQ_XHR_HOOK!="undefined"&&CQ.Ext.isFunction(CQ_XHR_HOOK)){var p={url:url,method:"POST",params:params};
try{var out=CQ_XHR_HOOK(p);
if(out){url=out.url;
params=out.params
}}catch(e){CQ.Log.error("CQ.utils.HTTP#get: error during CQ_XHR_HOOK call: {0}",[url,e.message])
}}if(callback!=undefined){CQ.Log.debug("CQ.utils.HTTP#post: requesting {0} asynchronously",url);
return CQ.Ext.Ajax.request({url:url,method:"POST",callback:function(options,success,xhr){var response=CQ.HTTP.buildPostResponseFromHTML(xhr.responseText);
if(!CQ.utils.HTTP.isOk(response)&&!suppressErrorMsg){CQ.Notification.notifyFromResponse(response)
}callback.call(this,options,success,xhr,response)
},params:params,scope:scope})
}else{CQ.Log.debug("CQ.utils.HTTP#post: requesting {0} synchronously",url);
var response=null;
var request=document.all?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest();
var tmp=url.split("?");
var url0=tmp[0];
var body=tmp[1]?tmp[1]:"";
var p=CQ.Ext.urlEncode(params);
body+=(p?(body?"&":"")+p:"");
try{request.open("post",url0,false);
request.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
request.send(body);
response=CQ.HTTP.buildPostResponseFromHTML(request.responseText);
if(CQ.shared.HTTP.handleForbidden(request)){}else{if(!CQ.utils.HTTP.isOk(response)&&!suppressErrorMsg){CQ.Notification.notifyFromResponse(response)
}}return response
}catch(e){CQ.Log.error("CQ.utils.HTTP#post: failed to post {0}: {1}",[url,e.message])
}return response
}},getParameter:function(url,name){return CQ.shared.HTTP.getParameter(url,name)
},getParameters:function(url,name){return CQ.shared.HTTP.getParameters(url,name)
},addParameter:function(url,name,value){return CQ.shared.HTTP.addParameter(url,name,value)
},setParameter:function(url,name,value){return CQ.shared.HTTP.setParameter(url,name,value)
},removeParameter:function(url,name){return CQ.shared.HTTP.removeParameter(url,name)
},removeParameters:function(url){return CQ.shared.HTTP.removeParameters(url)
},addSelector:function(url,selector,index){return CQ.shared.HTTP.addSelector(url,selector,index)
},setSelector:function(url,selector,index){return CQ.shared.HTTP.setSelector(url,selector,index)
},getAnchor:function(url){return CQ.shared.HTTP.getAnchor(url)
},setAnchor:function(url,anchor){return CQ.shared.HTTP.setAnchor(url,anchor)
},removeAnchor:function(url){return CQ.shared.HTTP.removeAnchor(url)
},noCaching:function(url){return CQ.shared.HTTP.noCaching(url)
},buildPostResponseFromNode:function(node,response){if(!node){return null
}if(response==undefined){response=createResponse()
}try{for(var i=0;
i<node.childNodes.length;
i++){var child=node.childNodes[i];
if(child.tagName){if(child.id){if(child.href){response.headers[child.id]=child.href
}else{response.headers[child.id]=child.innerHTML
}}response=CQ.utils.HTTP.buildPostResponseFromNode(child,response)
}}}catch(e){CQ.Log.error("CQ.utils.HTTP#buildPostResponseFromNode: "+e.message)
}return response
},buildPostResponseFromHTML:function(html){var response=createResponse();
try{if(html.responseText!=undefined){html=html.responseText
}else{if(typeof html!="string"){html=html.toString()
}}var div=document.createElement("div");
div.innerHTML=html;
response=CQ.utils.HTTP.buildPostResponseFromNode(div,response);
div=null
}catch(e){}return response
},isOkStatus:function(status){return CQ.shared.HTTP.isOkStatus(status)
},isOk:function(response){return CQ.shared.HTTP.isOk(response)
},getCookie:function(name){return CQ.shared.HTTP.getCookie(name)
},setCookie:function(name,value,path,days,domain,secure){return CQ.shared.HTTP.setCookie(name,value,path,days,domain,secure)
},clearCookie:function(name,path,domain,secure){return CQ.shared.HTTP.clearCookie(name,path,domain,secure)
},getSchemeAndAuthority:function(url){return CQ.shared.HTTP.getSchemeAndAuthority(url)
},getContextPath:function(){return CQ.shared.HTTP.getContextPath()
},detectContextPath:function(){return CQ.shared.HTTP.detectContextPath()
},externalize:function(url,encode){return CQ.shared.HTTP.externalize(url,encode)
},internalize:function(url,doc){return CQ.shared.HTTP.internalize(url,doc)
},getPath:function(url){return CQ.shared.HTTP.getPath(url)
},getSuffix:function(){return CQ.shared.HTTP.getSuffix()
},getSelectors:function(url){return CQ.shared.HTTP.getSelectors(url)
},getExtension:function(url){return CQ.shared.HTTP.getExtension(url)
},encodePathOfURI:function(url){return CQ.shared.HTTP.encodePathOfURI(url)
},encodePath:function(path){return CQ.shared.HTTP.encodePath(path)
},eval:function(response){return CQ.shared.HTTP.eval(response)
}}
}();
CQ.HTTP=CQ.utils.HTTP;
CQ.utils.I18n=CQ.shared.I18n;
CQ.utils.DOM=function(){var DEFAULT_STYLES={"font-weight":"normal","font-style":"normal","font-variant":"normal","text-transform":"none","text-decoration":"none","text-indent":"0","letter-spacing":"normal","word-spacing":"normal","line-height":"normal","text-align":"left","vertical-align":"baseline",direction:"ltr","background-color":"transparent","background-image":"none","background-repeat":"repeat","background-attachment":"scroll","background-position":"top left",opacity:"1",width:"auto",height:"auto",top:"auto",right:"auto",bottom:"auto",left:"auto",margin:"0",padding:"0","border-style":"none","border-width":"0",position:"static",display:"inline",visibility:"visible",overflow:"visible","white-space":"normal","float":"none",clear:"none",cursor:"auto","list-style":"disc outside none"};
var buildDefaultStyles=function(styles){var defaults=CQ.Util.copyObject(DEFAULT_STYLES);
return CQ.Util.merge(defaults,styles)
};
var DEFAULT_STYLES_BLOCK=buildDefaultStyles({display:"block"});
var DEFAULT_STYLES_TABLE=buildDefaultStyles({display:"table","white-space":"nowrap","vertical-align":"middle"});
var DEFAULT_STYLES_TBODY=buildDefaultStyles({display:"table-row-group","white-space":"nowrap","vertical-align":"middle"});
var DEFAULT_STYLES_TR=buildDefaultStyles({display:"table-row","white-space":"nowrap","vertical-align":"middle"});
var DEFAULT_STYLES_TD=buildDefaultStyles({display:"table-cell","white-space":"nowrap","vertical-align":"middle"});
var DEFAULT_STYLES_INPUT=buildDefaultStyles({"background-color":"#FF0000",padding:"1px 0 1px 0","border-width":"2px","border-color":"#F0F0F0","border-style":"inset"});
return{getBlockDefaultStyles:function(){return CQ.Util.copyObject(DEFAULT_STYLES_BLOCK)
},executeScripts:function(element){if(!element&&!element.dom){return
}var scripts=CQ.Ext.DomQuery.select("script",element.dom);
for(var i=0;
i<scripts.length;
i++){if(scripts[i].src){try{var response=CQ.HTTP.get(scripts[i].src);
if(CQ.HTTP.isOk(response)){var responseBody=response.body?response.body:response.responseText;
if(window.execScript){window.execScript(responseBody)
}else{eval.call(null,responseBody)
}}}catch(err){}}var script=scripts[i].innerHTML;
if(script){script=script.replace(/^\s*<!--/,"");
try{if(window.execScript){window.execScript(script)
}else{eval.call(null,script)
}}catch(err){}}}},encodeId:function(str){if(!str){return""
}var encStr="";
for(var i=0;
i<str.length;
i++){var c=str.charCodeAt(i);
if(c==45||c==46||c==95||c>=97&&c<=122||c>=65&&c<=90||c>=48&&c<=57){encStr+=str.charAt(i)
}else{encStr+=":"+str.charCodeAt(i)
}}return encStr
},encodeClass:function(str,prefix){if(!str){return""
}var encStr="";
for(var i=0;
i<str.length;
i++){var c=str.charCodeAt(i);
if(c==45||c>=97&&c<=122||c>=65&&c<=90||c>=48&&c<=57){encStr+=str.charAt(i)
}else{encStr+="_"+str.charCodeAt(i)
}}if(prefix==undefined){prefix="cq"
}prefix=prefix?prefix+"-":"";
return prefix+encStr
},clearDocumentSelection:function(win){if(!win){win=window
}if(CQ.Ext.isIE){win.document.selection.empty()
}else{win.getSelection().removeAllRanges()
}},createFullUrl:function(absPath){if((absPath.length>0)&&(absPath.charAt(0)!="/")){return absPath
}var prefix=document.location.protocol+"//"+document.location.hostname;
var port=document.location.port;
if(port!=80){prefix+=":"+port
}return prefix+absPath
},prepareForCloning:function(dom,deep){if(!CQ.Ext.isIE||(document.location.protocol!="https:")){return dom
}var cud=CQ.utils.DOM;
if(dom.nodeType==1){var bgImage=dom.style.backgroundImage;
if(bgImage){bgImage=bgImage.replace(/(url\()(\/.*?)(\).*)/gi,"$1"+cud.createFullUrl("")+"$2$3");
dom.style.backgroundImage=bgImage
}}if(deep){var childCnt=dom.childNodes.length;
for(var c=0;
c<childCnt;
c++){cud.prepareForCloning(dom.childNodes[c],true)
}}return dom
}}
}();
CQ.DOM=CQ.utils.DOM;
CQ.utils.Notification=function(){var b;
var c=4;
function a(m,k,j){var g='<div class="cq-notification-msg">';
g+='<div class="x-box-tl"><div class="x-box-tr"><div class="x-box-tc"></div></div></div>';
g+='<div class="x-box-ml"><div class="x-box-mr"><div class="x-box-mc">';
if(m){if(j){m=CQ.shared.XSS.getXSSValue(m)
}g+='<span class="cq-notification-msg-title">'+m+"</span>"
}if(j){k=CQ.shared.XSS.getXSSValue(k)
}g+='<span class="cq-notification-msg-content">'+k+"</span>";
g+="</div></div></div>";
g+='<div class="x-box-bl"><div class="x-box-br"><div class="x-box-bc"></div></div></div></div>';
return g
}return{notify:function(o,n,k,m){if(!b){b=CQ.Ext.DomHelper.insertFirst(CQ.Util.ROOT_ID,{id:"cq-notification-div"},true)
}b.alignTo(document,"tr-tr",[-20,4]);
var g=CQ.Ext.DomHelper.append(b,{html:a(o,n,m)},true);
b.on("click",function(){g.stopFx()
});
var j=k?k:c;
g.slideIn("t").pause(j).ghost("t",{remove:true})
},notifyFromResponse:function(g,j,m){var k=g.headers[CQ.HTTP.HEADER_MESSAGE];
k=k!=undefined?k:CQ.I18n.getMessage("Unspecified error");
CQ.Notification.notify(null,k,j,m)
}}
}();
CQ.Notification=CQ.utils.Notification;
CQ.utils.Sling=CQ.shared.Sling;
CQ.utils.WCM=function(){var currentMode=null;
var currentPreviewMode=null;
var editConfigs=[];
var editPathStack=null;
var editables={};
var pagePath=null;
var dialogs={};
var dropTargetComponents=[];
var defaultEditConfig={xtype:"editrollover"};
var readOnly=false;
var defaultSidekickConfig={xtype:"sidekick"};
var layers=null;
var getCurrentElement=function(path,finder){var scripts=document.getElementsByTagName("script");
try{var toFind=finder.replace("$PATH$",path);
var testScript=function(script){return(script.innerHTML.indexOf(toFind)!=-1)
};
var selectedScript=scripts[scripts.length-1];
if(!testScript(selectedScript)){for(var i=0;
i<scripts.length;
i++){if(testScript(scripts[i])){selectedScript=scripts[i];
break
}}}if(selectedScript){var element=selectedScript.parentNode;
return element.tagName!="head"?element:null
}return null
}catch(e){return null
}};
var clearSelection=function(e){if(window.CQ_selectionLocked){window.CQ_selectionLocked=false;
return
}if(!e.shiftKey&&!e.ctrlKey){CQ.utils.WCM.getSelection().clear()
}else{CQ.DOM.clearDocumentSelection(CQ.utils.WCM.getContentWindow())
}};
var isFormElement=function(elem){return elem&&elem.tagName&&(elem.tagName.toLowerCase()=="input"||elem.tagName.toLowerCase()=="textarea"||elem.tagName.toLowerCase()=="select")
};
var processKeyDown=function(e){if(isFormElement(e.getTarget())){return
}try{var contentWin=CQ.utils.WCM.getContentWindow();
if(contentWin&&contentWin.CQ_inplaceEditComp){return
}CQ.utils.WCM.altKey=e.altKey;
if(e.ctrlKey&&e.getCharCode()==67){CQ.utils.WCM.copy(CQ.utils.WCM.getSelectedItems())
}else{if(e.ctrlKey&&e.getCharCode()==88){CQ.utils.WCM.cut(CQ.utils.WCM.getSelectedItems())
}else{if(e.ctrlKey&&e.getCharCode()==86){var targets=CQ.utils.WCM.getSelectedItems();
if(targets.length>0){var muu=CQ.undo.util.MultiUndoUtils;
var undoCfg=muu.begin();
var target=targets[0];
var toPaste=CQ.utils.WCM.paste();
while(toPaste.length>0){var item=toPaste.shift();
if(e.altKey){target.referenceParagraph(item.path,undoCfg)
}else{if(item.action!=CQ.utils.WCM.ACTION_CUT){target.copyParagraph(item.path,item.resourceType,false,undoCfg)
}else{muu.determineMoveInformation(undoCfg,item);
var newPath=target.moveParagraph(item.path,item.resourceType);
if(newPath){muu.addMoveAction(undoCfg,newPath,target)
}}}}muu.reverseActions(undoCfg);
muu.commit(undoCfg);
CQ.utils.WCM.deselect()
}}else{if(e.getCharCode()==e.DELETE){CQ.utils.WCM.remove(CQ.utils.WCM.getSelectedItems());
CQ.utils.WCM.getContentWindow().CQ.wcm.Annotation.removeSelectedSketch()
}else{if(e.ctrlKey&&!e.shiftKey&&e.getCharCode()==90){if(CQ.undo.UndoManager.isEnabled()){var history=CQ.undo.UndoManager.getHistory();
if(history.canUndo()){history.undo()
}e.preventDefault()
}}else{if((e.ctrlKey&&e.getCharCode()==89)||(e.ctrlKey&&e.shiftKey&&e.getCharCode()==90)){if(CQ.undo.UndoManager.isEnabled()){history=CQ.undo.UndoManager.getHistory();
if(history.canRedo()){history.redo()
}e.preventDefault()
}}}}}}}}catch(e){}};
var processKeyUp=function(e){CQ.utils.WCM.altKey=e.altKey
};
var editablesConfigSorter=function(a,b){if(a.path.lastIndexOf("/")>b.path.lastIndexOf("/")){return 1
}if(b.path.lastIndexOf("/")>a.path.lastIndexOf("/")){return -1
}return 0
};
var editableReadyListeners={};
var editableBeforeRenderListeners={};
var editablesReady=false;
var sidekickReady=false;
return CQ.Ext.apply(new CQ.Ext.util.Observable(),{initComponent:function(){CQ.utils.WCM.superclass.initComponent.call(this);
this.addEvents("sidekickready","editablesready","editableready","pageinfoloaded","wcmmodechange")
},pageInfos:{},componentLists:{},TIMEWARP_COOKIE:"timewarp",MODE_TIMEWARP:"timewarp",MODE_COOKIE:"wcmmode",MODE_COOKIE_PATH:CQ.HTTP.externalize("/"),MODE_EDIT:"edit",MODE_PREVIEW:"preview",MODE_DESIGN:"design",MODE_ANALYTICS:"analytics",ACTION_COPY:"COPY",ACTION_CUT:"CUT",LAYERS_COOKIE:"wcmlayers",LAYERS_COOKIE_PATH:CQ.HTTP.externalize("/"),LAYER_LCSTATUS:"liveCopyStatusLayer",EDITABLE_SCRIPT_FINDER:'CQ.WCM.edit({"path":"$PATH$"',PREVIEW_RESPONSIVE:"responsive",altKey:false,getMode:function(force){var currentMode;
if(force||!currentMode){currentMode=CQ.HTTP.getCookie(CQ.utils.WCM.MODE_COOKIE)
}if(CQ.HTTP.getCookie(CQ.utils.WCM.TIMEWARP_COOKIE)){return CQ.utils.WCM.MODE_TIMEWARP
}return currentMode
},setMode:function(mode){CQ.utils.WCM.setModeCss(mode);
CQ.HTTP.setCookie(CQ.utils.WCM.MODE_COOKIE,mode,CQ.utils.WCM.MODE_COOKIE_PATH);
CQ.HTTP.clearCookie(CQ.utils.WCM.TIMEWARP_COOKIE,"/");
currentMode=mode;
this.fireEvent("wcmmodechange",currentMode);
return currentMode
},setModeCss:function(mode){var doc=CQ.utils.WCM.getContentWindow().document;
var body=doc.body||doc.getElementsByTagName("body")[0];
if(!body){CQ.utils.WCM.setModeCss.defer(300,this,[mode]);
return
}if(!mode){if(CQ.utils.WCM.isEditMode()){mode=CQ.utils.WCM.MODE_EDIT
}else{if(CQ.utils.WCM.isDesignMode()){mode=CQ.utils.WCM.MODE_DESIGN
}else{if(CQ.utils.WCM.isPreviewMode()){mode=CQ.utils.WCM.MODE_PREVIEW
}else{if(CQ.utils.WCM.isAnalyticsMode()){mode=CQ.utils.WCM.MODE_ANALYTICS
}}}}}var pre="cq-wcm-";
var b=CQ.Ext.get(body);
b.removeClass([pre+CQ.utils.WCM.MODE_EDIT,pre+CQ.utils.WCM.MODE_DESIGN,pre+CQ.utils.WCM.MODE_PREVIEW]);
b.addClass(pre+mode)
},getPreviewMode:function(){return currentPreviewMode
},setPreviewMode:function(mode){currentPreviewMode=mode;
return currentPreviewMode
},isTimewarpMode:function(force){if(force){CQ.utils.WCM.getMode(force)
}var cookie=CQ.HTTP.getCookie(CQ.utils.WCM.TIMEWARP_COOKIE);
return(cookie&&cookie!="")
},isPreviewMode:function(force){return(CQ.utils.WCM.getMode(force)==CQ.utils.WCM.MODE_PREVIEW)
},isResponsiveMode:function(){return(CQ.utils.WCM.getPreviewMode()==CQ.utils.WCM.PREVIEW_RESPONSIVE)
},isEditMode:function(force){var mode=CQ.utils.WCM.getMode(force);
return(!mode||mode==CQ.utils.WCM.MODE_EDIT)
},isDesignMode:function(force){return(CQ.utils.WCM.getMode(force)==CQ.utils.WCM.MODE_DESIGN)
},isAnalyticsMode:function(force){return(CQ.utils.WCM.getMode(force)==CQ.utils.WCM.MODE_ANALYTICS)
},getLayers:function(){if(!layers){layers=CQ.Ext.state.Manager.get(CQ.utils.WCM.LAYERS_COOKIE)
}return(layers=(layers?layers:{}))
},isShownLayer:function(layer){return CQ.utils.WCM.getContentWindow().CQ.WCM.getLayers()[layer]===true
},showLayer:function(layer){CQ.utils.WCM.getContentWindow().CQ.WCM.getLayers()[layer]=true;
CQ.Ext.state.Manager.set(CQ.utils.WCM.LAYERS_COOKIE,CQ.utils.WCM.getContentWindow().CQ.WCM.getLayers())
},hideLayer:function(layer){delete CQ.utils.WCM.getContentWindow().CQ.WCM.getLayers()[layer];
CQ.Ext.state.Manager.set(CQ.utils.WCM.LAYERS_COOKIE,CQ.utils.WCM.getContentWindow().CQ.WCM.getLayers())
},remove:function(item){if(!item){return
}try{if(item instanceof Array&&item.length>0){for(var i=0;
i<item.length;
i++){CQ.utils.WCM.getClipboard().remove(item[i])
}item[0].removeParagraph();
return
}else{CQ.utils.WCM.getClipboard().remove(item);
item.removeParagraph()
}}catch(e){}CQ.utils.WCM.deselect()
},copy:function(item,additive,move){var clipboard=CQ.utils.WCM.getClipboard();
if(!item){clipboard.clear();
return null
}if(item instanceof Array){if(item.length>0){for(var i=0;
i<item.length;
i++){CQ.utils.WCM.copy(item[i],additive,move);
if(!additive){additive=true
}}}else{clipboard.clear()
}return item
}if(!additive){clipboard.clear()
}if(!item.isActionCopyMove()){return item
}clipboard.add({path:item.path,title:item.path.substring(item.path.lastIndexOf("/")+1),icon:item.getIconPath(),resourceType:item.getResourceType(),xtype:item.xtype,action:move?CQ.utils.WCM.ACTION_CUT:CQ.utils.WCM.ACTION_COPY,hasAnnotations:item.hasAnnotations()});
return item
},cut:function(item,additive){return CQ.utils.WCM.copy(item,additive,true)
},paste:function(){var clipboard=CQ.utils.WCM.getClipboard();
var items=[];
var cutItems=[];
for(var i=0;
i<clipboard.items.length;
i++){var item=clipboard.items[i];
items.push(item);
if(item.action==CQ.utils.WCM.ACTION_CUT){cutItems.push(item)
}}for(var i=0;
i<cutItems.length;
i++){clipboard.remove(cutItems[i])
}return items
},getClipboardRecords:function(){var clipboard=CQ.utils.WCM.getClipboard();
var records=[];
for(var i=0;
i<clipboard.items.length;
i++){var item=clipboard.items[i];
records.push(new CQ.Ext.data.Record(item))
}return records
},getClipboard:function(finder){if(!finder&&CQ.utils.WCM.getContentFinder()){return CQ.utils.WCM.getContentFinder().getClipboard()
}else{if(!window.CQ_Clipboard){window.CQ_Clipboard=new CQ.Ext.util.MixedCollection()
}}return window.CQ_Clipboard
},clearClipboard:function(){var clipboard=CQ.utils.WCM.getClipboard();
clipboard.clear()
},onClipboardChange:function(listener){var clipboard=CQ.utils.WCM.getClipboard();
clipboard.on("add",listener);
clipboard.on("remove",listener);
clipboard.on("clear",listener);
CQ.Ext.EventManager.on(window.document,"unload",function(){CQ.utils.WCM.unClipboardChange(listener)
})
},unClipboardChange:function(listener){var clipboard=CQ.utils.WCM.getClipboard();
clipboard.un("add",listener);
clipboard.un("remove",listener);
clipboard.un("clear",listener)
},select:function(item,additive,lock){var selection=CQ.utils.WCM.getSelection();
if(item&&selection.contains(item)){return item
}if(additive){CQ.DOM.clearDocumentSelection(CQ.utils.WCM.getContentWindow())
}else{selection.clear()
}if(!item){selection.clear();
return item
}if(item instanceof Array){for(var i=0;
i<item.length;
i++){CQ.utils.WCM.select(item[i],true)
}return item
}selection.add(item);
if(lock){window.CQ_selectionLocked=true
}if(!window.CQ_selectionObserved){CQ.Ext.EventManager.on(document.body,"click",clearSelection);
window.CQ_selectionObserved=1
}return item
},deselect:function(item,additive){var selection=CQ.utils.WCM.getSelection();
if(!item||!additive){selection.clear()
}else{if(item){selection.remove(item)
}}if(additive){CQ.DOM.clearDocumentSelection(CQ.utils.WCM.getContentWindow())
}if(!selection.getCount()&&window.CQ_selectionObserved){CQ.Ext.EventManager.un(document.body,"click",clearSelection);
window.CQ_selectionObserved=0
}return item
},getSelectedItems:function(){var selection=CQ.utils.WCM.getSelection();
var items=[];
for(var i=0;
i<selection.items.length;
i++){items.push(selection.items[i])
}return items
},getSelection:function(){var win=CQ.utils.WCM.getContentWindow();
if(!win.CQ_Selection){win.CQ_Selection=new CQ.Ext.util.MixedCollection()
}return win.CQ_Selection
},onSelectionChange:function(listener){var selection=CQ.utils.WCM.getSelection();
selection.on("add",listener);
selection.on("remove",listener);
selection.on("clear",listener)
},unSelectionChange:function(listener){var selection=CQ.utils.WCM.getSelection();
selection.un("add",listener);
selection.un("remove",listener);
selection.un("clear",listener)
},getEditable:function(path){return editables[path]
},getEditableFromDOM:function(element){var path=CQ.utils.WCM.getEditablePathFromDOM(element);
if(path){return editables[path]
}else{return null
}},getEditablePathFromDOM:function(element){function matches(editObj,element){if(editObj&&editObj.element){if(editObj.element.dom&&element===editObj.element.dom){return true
}else{if(element===editObj.element){return true
}}}return false
}var i;
while(element){for(var path in editables){if(editables.hasOwnProperty(path)){if(matches(editables[path],element)){return path
}}}if(this.editablesQueue){for(i=0;
i<this.editablesQueue.length;
i++){if(matches(this.editablesQueue[i],element)){return this.editablesQueue[i].path
}}}for(i=0;
i<editConfigs.length;
i++){if(matches(editConfigs[i],element)){return editConfigs[i].path
}}element=element.parentNode
}return null
},getNestedEditables:function(path){var res=[];
var parentSelector;
if(editables[path]&&editables[path].element){parentSelector="[id="+editables[path].element.id+"]"
}for(var p in editables){if(parentSelector&&CQ.Ext.get(editables[p].element).up(parentSelector)){res.push(p)
}else{if(p.indexOf(path+"/")==0){res.push(p)
}}}return res
},getEditables:function(){return editables
},unregisterEditable:function(path){delete editables[path]
},onEditableBeforeRender:function(path,listener,scope){if(listener){if(!editableBeforeRenderListeners[path]){editableBeforeRenderListeners[path]=[]
}editableBeforeRenderListeners[path].push({fct:listener,scope:scope})
}},onEditableReady:function(path,listener,scope){if(listener){if(!editableReadyListeners[path]){editableReadyListeners[path]=[]
}editableReadyListeners[path].push({fct:listener,scope:scope})
}},areEditablesReady:function(){return editablesReady
},isSidekickReady:function(){return sidekickReady
},toggleEditables:function(show,filter){var editables=CQ.WCM.getEditables();
for(var path in editables){var editable=editables[path];
if(!filter||editable.path.indexOf(filter)!=-1){if(show){editable.show()
}else{editable.hide()
}}}},makeEditable:function(config){if(!config.path){CQ.Log.error("CQ.util.WCM#makeEditable: path null or undefined");
return null
}var display=config.dialog||config.editConfig;
var editConfig=config.editConfig;
if(!editConfig){editConfig=CQ.Util.copyObject(defaultEditConfig)
}else{if(!editConfig.xtype){editConfig.xtype=defaultEditConfig.xtype
}}if(config.dialog){editConfig.dialog=config.dialog
}if(!display){editConfig.inactiveMode=true
}editConfig.path=config.path;
editConfig.cellSearchPath=config.csp;
editConfig.isContainer=config.isContainer;
editConfig.emptyText=CQ.I18n.getVarMessage(editConfig.emptyText);
if(config.type){if(!editConfig.params){editConfig.params={}
}if(!editConfig.params["./sling:resourceType"]){editConfig.params["./sling:resourceType"]=config.type
}}if(config.childConfig){editConfig.childConfig=config.childConfig
}if(!editConfig.element){if(config.element){editConfig.element=config.element
}else{editConfig.element=getCurrentElement(editConfig.path,this.EDITABLE_SCRIPT_FINDER)
}}if(config[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP]){editConfig[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP]=CQ.Util.copyObject(config[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP])
}if(this.enableEditablesQueue===true){this.editablesQueue.push(editConfig)
}else{if(CQ.Ext.isLoaded){return CQ.utils.WCM.createEditable(editConfig)
}else{editConfigs.push(editConfig);
if(editConfigs.length==1){CQ.Ext.onReady(function(){editConfigs.sort(editablesConfigSorter);
CQ.Timing.stamp("start building editings","SBE",true);
(function(){CQ.utils.WCM.buildEditables.defer(16)
}).defer(16)
})
}}}return null
},startMakeEditablesQueue:function(){this.enableEditablesQueue=true;
this.editablesQueue=[]
},endMakeEditablesQueue:function(){this.enableEditablesQueue=false;
this.editablesQueue.sort(editablesConfigSorter);
for(var i=0;
i<this.editablesQueue.length;
i++){CQ.utils.WCM.createEditable.defer(16,this,[this.editablesQueue[i]])
}this.editablesQueue=[]
},createEditable:function(config){if(config&&config.path){var beforeRenderListeners=editableBeforeRenderListeners[config.path];
while(beforeRenderListeners&&beforeRenderListeners.length>0){var listenerObj=editableBeforeRenderListeners[config.path].shift();
if(listenerObj.fct.call(listenerObj.scope?listenerObj.scope:this,config)===false){return null
}}if(editables[config.path]&&!editables[config.path].isReady()){return editables[config.path]
}CQ.Util.addListenerToConfig(config,"ready",function(editable){if(readOnly&&!editable.hidden){editable.hide()
}var readyListeners=editableReadyListeners[editable.path];
while(readyListeners&&readyListeners.length>0){var listenerObj=editableReadyListeners[editable.path].shift();
listenerObj.fct.call(listenerObj.scope?listenerObj.scope:editable,editable)
}if(editPathStack){var epindex=-1;
while((epindex=editPathStack.indexOf(editable.path))!=-1){editPathStack.splice(epindex,1)
}if(editPathStack.length==0){editPathStack=null;
editablesReady=true;
CQ.utils.WCM.fireEvent("editablesready")
}}CQ.utils.WCM.fireEvent("editableready",editable)
});
var editable=CQ.Util.build(config);
editables[config.path]=editable;
return editable
}return null
},buildEditables:function(){if(editConfigs.length==0){CQ.Timing.stamp("finished building editings","WCM#makeEditable");
return
}var editConfig=editConfigs.shift(editConfigs.length-1);
if(!editPathStack){editPathStack=[]
}editPathStack.push(editConfig.path);
CQ.utils.WCM.createEditable(editConfig);
CQ.utils.WCM.buildEditables()
},show:function(){var refresh=true;
for(var i in editables){editables[i].show();
refresh=false
}if(refresh){CQ.Util.reload()
}},hide:function(){CQ.utils.WCM.deselect();
for(var i in editables){editables[i].hide()
}for(var i in dialogs){dialogs[i].hide()
}},hidePlaceholders:function(element){element=CQ.Ext.get(element);
var placeholders=element.query("*[class*='-placeholder']");
for(var i=0;
i<placeholders.length;
i++){var clazz=placeholders[i].className;
if(clazz){var repl=clazz.replace(/(cq-.+-placeholder)(-off)?\b/,"$1-off");
if(repl!=clazz){placeholders[i].className=repl
}}}},showPlaceholders:function(element){element=CQ.Ext.get(element);
var placeholders=element.query("*[class*='-placeholder']");
for(var i=0;
i<placeholders.length;
i++){var clazz=placeholders[i].className;
if(clazz){var repl=clazz.replace(/(cq-.+-placeholder)-off/,"$1");
if(repl!=clazz){placeholders[i].className=repl
}}}},getDialog:function(config,key,nocreate){if(nocreate){return key?dialogs[key]:null
}var dialogConfig,dialogKey,dialog;
if(typeof config=="string"&&dialogs[config]&&key!="NEW"){return dialogs[config]
}else{if(key&&dialogs[key]){return dialogs[key]
}else{if(typeof config!="object"||config.xtype!="dialog"){dialogConfig=CQ.utils.WCM.getDialogConfig(config)
}else{dialogConfig=config
}}}if(!dialogConfig){return null
}dialogKey=key;
if(!dialogKey){dialogKey=(typeof config=="string")?config:dialogConfig.path
}if(!dialogKey){dialogKey="dialog-"+new Date().valueOf()
}dialog=CQ.Util.build(dialogConfig,true);
if(dialogKey!="NEW"){dialogs[dialogKey]=dialog
}return dialog
},unregisterDialog:function(key){if(dialogs[key]&&dialogs[key].destroy){dialogs[key].destroy()
}delete dialogs[key]
},registerDialog:function(key,dlg){dialogs[key]=dlg
},getDialogConfig:function(config){var url;
var snippet;
if(typeof config=="string"){url=config
}else{if(config.url){url=config.url
}}if(url){var ext=CQ.HTTP.EXTENSION_JSON;
if(url.indexOf(ext)!=(url.length-ext.length)){url+=CQ.Sling.SELECTOR_INFINITY+ext
}url=CQ.HTTP.addSelector(url,"overlay");
try{var json=CQ.HTTP.eval(url);
snippet=CQ.Util.formatData(json)
}catch(e){CQ.Log.error("CQ.utils.WCM#getDialogConfig failed: "+e.message);
return null
}}else{snippet=CQ.Util.formatData(config)
}if(!snippet){CQ.Log.error("CQ.utils.WCM#getDialogConfig failed");
return null
}var dialogConfig;
if(snippet.xtype.indexOf("dialog")!=-1||snippet.xtype.indexOf("wizard")!=-1){dialogConfig=snippet
}else{dialogConfig={xtype:"dialog"};
if(snippet.xtype=="panel"&&snippet.title){dialogConfig.items={xtype:"tabpanel",items:snippet}
}else{dialogConfig.items=snippet
}}if(dialogConfig.buttons==undefined){dialogConfig.buttons=CQ.Dialog.OKCANCEL
}dialogConfig.helpPath=snippet.helpPath?snippet.helpPath:config.helpPath;
dialogConfig.responseScope=snippet.responseScope?snippet.responseScope:config.responseScope;
dialogConfig.success=snippet.success?snippet.success:config.success;
dialogConfig.failure=snippet.failure?snippet.failure:config.failure;
dialogConfig.params=snippet.params?snippet.params:config.params;
return dialogConfig
},getDialogs:function(){return dialogs
},launchSidekick:function(path,config,setup){CQ.utils.WCM.setPreviewMode(null);
CQ.utils.WCM.internalLaunchSidekick.defer(32,this,[path,config,setup])
},internalLaunchSidekick:function(path,config,setup){CQ.utils.WCM.setModeCss();
if(path){pagePath=path;
var page=CQ.utils.WCM.getPage(path);
if(page.isReadOnly()){CQ.utils.WCM.setReadOnly(true);
config.readOnly=true
}}if(config&&config.url){var url=config.url;
var ext=CQ.HTTP.EXTENSION_JSON;
if(url.indexOf(ext)!=(url.length-ext.length)){url+=CQ.Sling.SELECTOR_INFINITY+ext
}try{var json=CQ.HTTP.eval(url);
var snippet=CQ.Util.formatData(json);
config=CQ.utils.Util.applyDefaults(snippet,config)
}catch(e){CQ.Log.error("CQ.utils.WCM#launchSidekick failed: "+e.message);
return null
}}if(!CQ.WCM.getSidekick()){var createSidekick=function(){CQ.WCM.getTopWindow().CQ.utils.WCM.createSidekick(path,config,setup)
};
if(CQ.Ext.isReady){createSidekick.defer(16)
}else{CQ.Ext.onReady(function(){createSidekick.defer(16)
});
return null
}}else{var wcm=this;
(function(){CQ.WCM.getSidekick().loadContent(path,config)
}).defer(16)
}},getSidekick:function(){return CQ.WCM.getTopWindow().CQ_Sidekick
},createSidekick:function(path,config,setup){if(typeof config!="string"){config=CQ.utils.Util.merge(config,defaultSidekickConfig)
}var sidekick=CQ.utils.Util.build(config);
if(setup){setup.call(sidekick)
}if(path){sidekick.loadContent(path,config)
}sidekick.show();
CQ.WCM.getTopWindow().CQ_Sidekick=sidekick;
sidekickReady=true;
this.fireEvent("sidekickready",CQ.WCM.getSidekick())
},getPage:function(path){var info=CQ.utils.WCM.getPageInfo(path);
info=info.status?info:path;
return new CQ.wcm.Page(info,CQ.User.getCurrentUser())
},getDesign:function(path){if(!path){path=CQ.utils.WCM.getPagePath()
}var info=CQ.utils.WCM.getPageInfo(path);
if(!info.designObject){if(info.design.path){var url=CQ.HTTP.externalize(info.design.path+"/_jcr_content."+info.design.lastModified+".json/");
var res=CQ.HTTP.get(url);
if(CQ.HTTP.isOk(res)){info.designObject=new CQ.wcm.Design(info.design.path,CQ.Util.eval(res))
}}}return info.designObject
},getPageInfo:function(path,forceLoad){if(path){var index=path.lastIndexOf("/jcr:content");
if(index>0){path=path.substring(0,index)
}}var contentWin=CQ.utils.WCM.getContentWindow();
if(contentWin&&contentWin.CQ&&contentWin.CQ.utils){var info=contentWin.CQ.utils.WCM.pageInfos[path];
if(!info||forceLoad){var url=CQ.HTTP.externalize("/libs/wcm/core/content/pageinfo.json");
url=CQ.HTTP.addParameter(url,"path",path);
url=CQ.HTTP.addParameter(url,"_charset_","utf8");
url=CQ.HTTP.noCaching(url);
var res=CQ.HTTP.get(url);
if(CQ.HTTP.isOk(res)){info=CQ.Util.eval(res)
}else{info={}
}contentWin.CQ.utils.WCM.pageInfos[path]=info;
this.fireEvent("pageinfoloaded",contentWin.CQ.utils.WCM.pageInfos[path])
}}else{info={}
}return info
},getPageLanguage:function(path){return CQ.utils.WCM.getPageInfo(path).language
},getPageLocale:function(path){return CQ.I18n.parseLocale(CQ.utils.WCM.getPageInfo(path).language)
},getContentFinder:function(){return CQ.WCM.getTopWindow().CQ_ContentFinder
},getContentWindow:function(){var finder=CQ.utils.WCM.getContentFinder();
return finder?finder.getContentWindow():window
},getTopWindow:CQ.shared.Util.getTopWindow,isContentWindow:function(win){if(!win){win=window
}return win==CQ.utils.WCM.getContentWindow()
},getContentUrl:function(){return CQ.utils.WCM.getContentWindow().location.href
},loadToolbar:function(toolbar){var finder=CQ.utils.WCM.getContentFinder();
if(finder){finder.loadToolbar(toolbar)
}else{CQ.Log.info("CQ.utils.WCM#loadToolbar: unable to load toolbar without content finder")
}if(!CQ.utils.WCM.getContentWindow().CQ_toolbarObserved){CQ.Ext.EventManager.on(CQ.utils.WCM.getContentWindow(),"unload",function(){CQ.utils.WCM.unloadToolbar()
},this);
CQ.utils.WCM.getContentWindow().CQ_toolbarObserved=1
}},unloadToolbar:function(){var finder=CQ.utils.WCM.getContentFinder();
if(finder){finder.unloadToolbar()
}else{CQ.Log.info("CQ.utils.WCM#loadToolbar: unable to unload toolbar without content finder")
}CQ.utils.WCM.getContentWindow().CQ_toolbarObserved=0
},getPagePath:function(){if(window!=CQ.utils.WCM.getContentWindow()){try{return CQ.utils.WCM.getContentWindow().CQ.WCM.getPagePath()
}catch(e){return""
}}if(pagePath){return pagePath
}else{return CQ.shared.HTTP.getPath()
}},setReadOnly:function(mode){readOnly=mode
},getDesignStyleOptions:function(contentPath){this.setOptions(CQ.utils.WCM.getStyleOptions.call(this,contentPath))
},getStyleOptions:function(contentPath){var dlg=this.findParentByType("dialog");
var cell=dlg?dlg.cell:null;
var value=null;
if(cell){var design=CQ.utils.WCM.getDesign();
if(design){value=design.getStyleProperty(cell,this.initialConfig.newStylePath)
}}try{if(!value){var suffix="";
if(contentPath.lastIndexOf("/*")>0){contentPath=contentPath.substring(0,contentPath.length-2);
if(this.initialConfig.newStylePath){suffix="/"+this.initialConfig.newStylePath
}}else{if(this.initialConfig.stylePath){suffix="/"+this.initialConfig.stylePath
}}var url=contentPath+".style.json"+suffix;
var json=CQ.Util.eval(url);
for(var a in json){value=json[a];
break
}}if(value){if(typeof value=="string"){value=value.split("\n")
}var opts=[];
for(var i=0;
i<value.length;
i++){var nm=value[i];
if(typeof nm=="string"){nm=nm.split("\t")
}opts.push({value:nm[0],text:nm[1]?nm[1]:nm[0]})
}return opts
}}catch(e){CQ.Log.error("CQ.utils.WCM#getStyleOptions failed: "+e.message)
}return[]
},setContentLanguageOptionsCB:function(){this.setOptions(CQ.utils.WCM.getLanguageOptions())
},getLanguageOptions:function(){try{var languages=CQ.I18n.getLanguages();
var opts=[];
for(var name in languages){var lang=languages[name];
if(lang.title){opts.push({value:name,text:lang.title})
}}opts.sort(function(l1,l2){if(l1.text<l2.text){return -1
}else{if(l1.text==l2.text){return 0
}else{return 1
}}});
return opts
}catch(e){CQ.Log.error("CQ.utils.WCM#getLanguageOptions failed: "+e.message)
}return[]
},getWorkflowPackageOptions:function(packages){try{var options=[];
for(var i=0;
i<packages.length;
i++){var wp=packages[i];
options.push({value:wp.path,text:wp.title})
}options.sort(function(l1,l2){if(l1.text<l2.text){return -1
}else{if(l1.text==l2.text){return 0
}else{return 1
}}});
return options
}catch(e){CQ.Log.error("CQ.utils.WCM#getWorkflowPackageOptions failed: "+e.message)
}return[]
},getContainerStepOptions:function(path,record){try{var options=[];
var json=CQ.HTTP.eval("/libs/cq/workflow/content/console/models.json");
var models=json.models;
if(models){var ommit="";
if(path){var index=path.indexOf("/jcr:content");
ommit=path.substring(0,index)
}for(var model in models){var modelObject=models[model];
var item=modelObject.item;
var doOmmit=0;
if(item){var doOmmit=item.search(ommit)
}if(doOmmit==-1){options.push({value:modelObject.item,text:modelObject.title,qtip:modelObject.description})
}}}return options
}catch(e){CQ.Log.error("CQ.utils.WCM#getContainerWorkflowOptions failed: "+e.message)
}return[]
},observeKeypress:function(win){if(!CQ.Ext.isReady){CQ.Ext.onReady(function(){CQ.utils.WCM.observeKeypress(win)
})
}else{if(!win){win=window
}var target=CQ.Ext.isIE?win.document:win;
if(!win.CQ_keypressObserved){CQ.Ext.EventManager.on(target,"keydown",processKeyDown);
CQ.Ext.EventManager.on(target,"keyup",processKeyUp);
win.CQ_keypressObserved=1;
CQ.Ext.EventManager.on(win.document,"unload",function(){CQ.Ext.EventManager.un(target,"keydown",processKeyDown);
CQ.Ext.EventManager.un(target,"keyup",processKeyUp)
})
}}},getComponentList:function(path){var contentWin=this.getContentWindow();
var list=contentWin.CQ.utils.WCM.componentLists[""];
if(!list){if(!path){path=CQ.utils.WCM.getPagePath()
}var info=CQ.utils.WCM.getPageInfo(path);
var compsRef=info.componentsRef;
if(!compsRef){compsRef="/libs/wcm/core/content/components.json"
}var url=CQ.HTTP.externalize(compsRef);
var res=CQ.HTTP.get(url);
if(CQ.HTTP.isOk(res)){if(!path){path=CQ.utils.WCM.getPagePath()
}var idx=path.indexOf("/jcr:content");
if(idx>0){path=path.substring(0,idx)
}list=new CQ.wcm.ComponentList(path,CQ.Util.eval(res));
contentWin.CQ.utils.WCM.componentLists[""]=list
}}return list
},getComponentConfig:function(resourceType){try{var cl=CQ.utils.WCM.getComponentList();
var config=cl.getComponent(resourceType);
return CQ.Util.copyObject(config)
}catch(e){CQ.Log.error("CQ.util.WCM#getComponentConfig: unable to load components.");
return null
}},setContentWindowLoading:function(loading){CQ.WCM.getTopWindow().CQ_isContentWindowLoading=loading
},isContentWindowLoading:function(){return CQ.WCM.getTopWindow().CQ_isContentWindowLoading
},registerDropTargetComponent:function(dropTargetComp){dropTargetComponents.push(dropTargetComp)
},unregisterDropTargetComponent:function(dropTarget){var i=dropTargetComponents.indexOf(dropTarget);
if(i>=0){dropTargetComponents.splice(i,1)
}},getDropTargetComponents:function(){return dropTargetComponents
},getEmulatorManager:function(config){var cw=this.getContentWindow();
try{return cw.CQ.wcm.emulator.EmulatorManager.getInstance(config)
}catch(e){return null
}},getDeviceSimulator:function(config){var cw=this.getContentWindow();
try{return cw.CQ.wcm.mobile.simulator.DeviceSimulator.getInstance(config)
}catch(e){return null
}}})
}();
CQ.WCM=CQ.utils.WCM;
CQ.WCM.edit=CQ.utils.WCM.makeEditable;
CQ.utils.Date=function(){var b=86400000;
var a=function(c){return c?c:new Date()
};
return{TODAY:CQ.I18n.getMessage("today"),YESTERDAY:CQ.I18n.getMessage("yesterday"),THIS_WEEK:CQ.I18n.getMessage("this week"),LAST_WEEK:CQ.I18n.getMessage("last week"),THIS_MONTH:CQ.I18n.getMessage("this month"),LAST_MONTH:CQ.I18n.getMessage("last month"),isToday:function(g,c){c=a(c);
return g.getTime()+b>c.getTime()&&g.getDate()==c.getDate()
},isYesterday:function(g,c){c=a(c);
return g.getTime()+(2*b)>c.getTime()&&!CQ.Date.isToday(g,c)
},isThisWeek:function(m,j,k){j=a(j);
var g=m.getDay();
var c=j.getDay();
if(k){g=g==0?7:g;
c=c==0?7:c
}if(m<=j){return(m.getTime()+(7*b)>j.getTime()&&g<c)||CQ.Date.isToday(m,j)
}else{return j.getTime()+(7*b)>m.getTime()&&c<=g
}},isLastWeek:function(j,c,g){c=a(c);
return !CQ.Date.isToday(j,c)&&CQ.Date.isThisWeek(j,new Date(c.getTime()-(7*b)),g)
},isThisMonth:function(g,c){c=a(c);
return g.getMonth()==c.getMonth()&&g.getFullYear()==c.getFullYear()
},isThisYear:function(g,c){return g.getFullYear()==a(c).getFullYear()
}}
}();
CQ.Date=CQ.utils.Date;
CQ.utils.WindowEventManager=function(){var b=[];
var a=function(){var n=b.length;
for(var m=0;
m<n;
m++){var c=b[m];
var g=c.name;
if(g!="unload"){var k=c.fn;
var j=c.scope;
CQ.Ext.EventManager.removeListener(window,g,k,j)
}}};
CQ.Ext.EventManager.addListener(window,"unload",a);
return{addListener:function(c,j,g){b.push({name:c,fn:j,scope:g});
CQ.Ext.EventManager.addListener(window,c,j,g)
},removeListener:function(c,k,j){var n=b.length;
for(var g=0;
g<n;
g++){var m=b[g];
if((m.name==c)&&(m.fn==k)&&(m.scope==j)){b.splice(g,1);
CQ.Ext.EventManager.removeListener(window,c,k,j);
break
}}}}
}();
CQ.WindowEventManager=CQ.utils.WindowEventManager;
CQ.Ext.apply(CQ.shared.Form,function(){var b=function(k,g){k=CQ.Util.unwrapParens(k.trim());
var j=k.split(g);
var c=null;
if(j.length==2){c={left:CQ.Util.trim(j[0]),right:CQ.Util.trim(j[1])}
}return c
};
var a=function(m,j){var c=null;
m=CQ.Util.unwrapParens(m.trim());
if(CQ.shared.String.startsWith(m,j)){var g=CQ.Util.trim(m.substring(j.length));
g=CQ.Util.unwrapParens(g);
var k=g.split(",");
if(k.length==2){c={left:CQ.Util.trim(k[0]),right:CQ.Util.trim(k[1])}
}}return c
};
return{operators:{"==":{label:CQ.I18n.getMessage("is equal to"),template:"({0} == {1})",parse:function(c){return b(c,"==")
}},"!=":{label:CQ.I18n.getMessage("is not equal to"),template:"({0} != {1})",parse:function(c){return b(c,"!=")
}},"<":{label:CQ.I18n.getMessage("is less than"),template:"({0} < {1})",parse:function(c){return b(c,"<")
}},"<=":{label:CQ.I18n.getMessage("is less or equal to"),template:"({0} <= {1})",parse:function(c){return b(c,"<=")
}},">":{label:CQ.I18n.getMessage("is greater than"),template:"({0} > {1})",parse:function(c){return b(c,">")
}},">=":{label:CQ.I18n.getMessage("is greater or equal to"),template:"({0} >= {1})",parse:function(c){return b(c,">=")
}},startsWith:{label:CQ.I18n.getMessage("starts with"),template:"CQ.shared.String.startsWith({0},{1})",parse:function(c){return a(c,"CQ.shared.String.startsWith")
}},endsWith:{label:CQ.I18n.getMessage("ends with"),template:"CQ.shared.String.endsWith({0},{1})",parse:function(c){return a(c,"CQ.shared.String.endsWith")
}},contains:{label:CQ.I18n.getMessage("contains"),template:"CQ.shared.String.contains({0},{1})",parse:function(c){return a(c,"CQ.shared.String.contains")
}}},parseCondition:function(k){var g=CQ.Util.unwrapParens(CQ.Util.trim(k));
if(!g){return null
}for(var j in this.operators){var c=this.operators[j].parse(g);
if(c){c.operator=j;
return c
}}return null
},requiresReloadForPreview:function(){if(typeof(cq5forms_reloadForPreview)!="undefined"){return cq5forms_reloadForPreview
}return false
}}
}());
CQ.utils.Form=CQ.shared.Form;
CQ.utils.S7={THUMBS_TEMPLATE:'<tpl for="."><tpl if="CQ.S7.hasQuery(values.thumb)"><div class="thumb-wrap"><div class="thumb" style="background-image:url(\'{[values.thumb]}&wid=152&nanos={[values.nanos]}\');" ondblclick="CQ.wcm.ContentFinderTab.resultDblClick(event, \'{id}\',\'{pathEncoded}\',{isFolder},\'{ddGroups}\');" qtip="<nobr>{[CQ.shared.Util.htmlEncode(CQ.shared.XSS.getXSSTablePropertyValue(values, "type"))]}</nobr>{[values.type ? "<br/>" : ""]}<nobr>{[CQ.shared.XSS.getXSSValue(CQ.shared.Util.htmlEncode(values.name))]}</nobr>"></div><span>{shortTitle}</span></div></tpl><tpl if="CQ.S7.hasQuery(values.thumb)==false"><div class="thumb-wrap"><div class="thumb" style="background-image:url(\'{[values.thumb]}?wid=152&nanos={[values.nanos]}\');" ondblclick="CQ.wcm.ContentFinderTab.resultDblClick(event, \'{id}\',\'{pathEncoded}\',{isFolder},\'{ddGroups}\');" qtip="<nobr>{[CQ.shared.Util.htmlEncode(CQ.shared.XSS.getXSSTablePropertyValue(values, "type"))]}</nobr>{[values.type ? "<br/>" : ""]}<nobr>{[CQ.shared.XSS.getXSSValue(CQ.shared.Util.htmlEncode(values.name))]}</nobr>"></div><span>{shortTitle}</span></div></tpl></tpl><div class="x-clear"></div>',DETAILS_TEMPLATE:'<tpl for="."><tpl if="CQ.S7.hasQuery(values.thumb)"><div class="cq-cft-search-item" ondblclick="CQ.wcm.ContentFinderTab.resultDblClick(event, \'{id}\', \'{pathEncoded}\', {isFolder}, \'{ddGroups}\');"><div title="{pathEncodedTitle}" class="cq-cft-search-thumb" style="background-image:url(\'{[values.thumb]}&wid=64\');"></div><div class="cq-cft-search-text-wrapper"><div class="cq-cft-search-title">{[CQ.shared.XSS.getXSSValue(values.name)]}</div>{[CQ.shared.XSS.getXSSTablePropertyValue(values, "type") ? "<div>" + CQ.shared.XSS.getXSSTablePropertyValue(values, "type") + " " + (CQ.shared.XSS.getXSSTablePropertyValue(values, "cqContent") == "true" ? "(CQ)" : "") + "</div>" : ""]}{[CQ.shared.XSS.getXSSTablePropertyValue(values, "lastModified") ? "<div>" + CQ.shared.XSS.getXSSTablePropertyValue(values, "lastModified") + "</div>" : ""]}</div><div class="cq-cft-search-separator"></div></div></tpl><tpl if="CQ.S7.hasQuery(values.thumb)==false"><div class="cq-cft-search-item" ondblclick="CQ.wcm.ContentFinderTab.resultDblClick(event, \'{id}\', \'{pathEncoded}\', {isFolder}, \'{ddGroups}\');"><div title="{pathEncodedTitle}" class="cq-cft-search-thumb" style="background-image:url(\'{[values.thumb]}?wid=64\');"></div><div class="cq-cft-search-text-wrapper"><div class="cq-cft-search-title">{[CQ.shared.XSS.getXSSValue(values.name)]}</div>{[CQ.shared.XSS.getXSSTablePropertyValue(values, "type") ? "<div>" + CQ.S7.mapType(CQ.shared.XSS.getXSSTablePropertyValue(values, "type")) + " " + (CQ.shared.XSS.getXSSTablePropertyValue(values, "cqContent") == "true" ? "(CQ)" : "") + "</div>" : ""]}{[CQ.shared.XSS.getXSSTablePropertyValue(values, "lastModified") ? "<div>" + CQ.shared.XSS.getXSSTablePropertyValue(values, "lastModified") + "</div>" : ""]}</div><div class="cq-cft-search-separator"></div></div></tpl></tpl>',dynamicMediaConfig:{},hasQuery:function(a){return a.indexOf("?")==-1?false:true
},getCqRootPath:function(g){var j="";
var b="";
if(g&&g!=""){b=CQ.HTTP.addParameter(g+"/jcr:content.config.json","prop","cqRootPath");
var c=CQ.HTTP.get(b);
var a=$CQ.parseJSON(c.responseText);
if(a!=null&&a.cqRootPath){j=a.cqRootPath.substring(0,a.cqRootPath.length-1)
}}return j
},getRootPath:function(j){var g="";
var b="";
if(j&&j!=""){b=CQ.HTTP.addParameter(j+"/jcr:content.config.json","prop","rootPath");
var c=CQ.HTTP.get(b);
var a=$CQ.parseJSON(c.responseText);
if(a!=null&&a.rootPath){g=a.rootPath.substring(0,a.rootPath.indexOf("/"))
}}return g
},getDefaultSearchQualifiers:function(){return{assetType:"Flash,Image,Fxg,Template,Video,MasterVideo,MbrSet,AnimatedGif"}
},getSearchQualifiers:function(){var c=new Object();
var g=CQ.Ext.getCmp("cfTab-S7Browse-Tree").getSelectionModel().getSelectedNode();
if(g!=null){c.path=CQ.shared.HTTP.encodePath(g.getPath()+"/")
}var b=CQ.Ext.getCmp("cfTab-S7Browse-searchField").getRawValue();
if(b!=""){c.searchTerm=CQ.shared.HTTP.encodePath(b)
}var a=CQ.Ext.getCmp("cfTab-S7Browse-assetType").getValue();
if(a!=""&&a!="None"){if(a=="Video"){a="Video,MasterVideo"
}c.assetType=a
}else{c.assetType="Flash,Image,Fxg,Template,Video,MasterVideo,MbrSet,AnimatedGif"
}return c
},getSelectedConfigPath:function(){var b="";
var a=CQ.Ext.getCmp("cfTab-S7Browse-S7ConfigSelector");
if(typeof a!="undefined"){b=a.value
}return b
},setSearchQualifiers:function(a){var b=CQ.S7.getSearchQualifiers();
a.baseParams=null;
a.lastOptions=null;
if(b.path!=null){a.setBaseParam("path",b.path)
}if(b.searchTerm!=null){a.setBaseParam("searchTerm",b.searchTerm)
}if(b.assetType!=null){a.setBaseParam("assetType",b.assetType)
}},checkStoreOptions:function(b,g){var j=true;
var c=["path","searchTerm","assetType"];
for(var a=0;
a<c.length;
a++){j=j&&((!b.params[c[a]]&&!g.baseParams[c[a]])||(b.params[c[a]]===g.baseParams[c[a]]))
}return j
},appendQuery:function(b,g){if(g==null||g==""){return b
}var a=(g.charAt(0)=="&");
var c=(g.charAt(0)=="?");
if(b.indexOf("?")==-1){if(a){return b+"?"+g.substring(1)
}else{if(c){return b+g
}else{return b+"?"+g
}}}else{if(CQ.S7.endsWith(b,"?")){if(a||c){return b+g.substring(1)
}else{return b+g
}}else{if(a){return b+g
}else{if(c){return b+"&"+g.substring(1)
}else{return b+"&"+g
}}}}},endsWith:function(c,b){var a=c.lastIndexOf(b);
return(a>=0&&a==c.length-b.length)
},findLimits:function(j,g,c){var b=j.indexOf(g);
var a=-1;
if(b!=-1){a=j.indexOf(c,b)
}return[b,a]
},mapType:function(a){if(a=="MbrSet"){return CQ.I18n.getMessage("Adaptive Video Set")
}else{return a
}},isDynamicMediaEnabled:function(){CQ.S7.updateDynamicMediaConfiguration();
var a=false;
if(this.dynamicMediaConfig&&typeof this.dynamicMediaConfig.dynamicMediaEnabled!="undefined"){a=this.dynamicMediaConfig.dynamicMediaEnabled
}return a
},updateDynamicMediaConfiguration:function(){if(this.dynamicMediaConfig&&typeof this.dynamicMediaConfig.dynamicMediaEnabled!="undefined"){return
}var b=CQ.HTTP.externalize("/etc/dam/dynamicmediaconfig.1.json");
var c=CQ.HTTP.get(b);
if(CQ.HTTP.isOk(c)){var a=$CQ.parseJSON(c.responseText);
if(a&&a.dynamicMediaEnabled){this.dynamicMediaConfig={dynamicMediaEnabled:a.dynamicMediaEnabled==true||a.dynamicMediaEnabled=="true",oldComponentGroup:a.oldGroup,dynamicMediaGroupName:a.dynamicMediaGroupName,dynamicMediaS7Components:a.dynamicMediaS7Components}
}}},getSearchStoreOptionArray:function(){var a=[["None",CQ.I18n.getMessage("None")],["Flash",CQ.I18n.getMessage("Flash")],["Image",CQ.I18n.getMessage("Image")],["Fxg",CQ.I18n.getMessage("FXG")],["Template",CQ.I18n.getMessage("Template")],["Video",CQ.I18n.getMessage("Video")],["MbrSet",CQ.I18n.getMessage("Adaptive Video Set")]];
return a
}};
CQ.S7=CQ.utils.S7;
CQ.undo.util.OriginalData=CQ.Ext.extend(CQ.Ext.emptyFn,{path:null,records:null,blobs:null,isGlobalUpdate:false,constructor:function(t,g,k,u){this.path=t;
this.records=g;
this.blobs=[];
this.isGlobalUpdate=(u===true);
if(k){var m=(k.isXType!=undefined);
var a=(m&&k.isXType("dialog")?k.form:(m&&k.isXType("form")?k.getForm():null));
if(a){var o=a.getValues();
if(o.hasOwnProperty(CQ.undo.UndoDefs.BLOB_MARKER_FIELD)){var j=o[CQ.undo.UndoDefs.BLOB_MARKER_FIELD];
var r=this;
var q=function(v){var b=new CQ.undo.util.Blob();
b.createFromFieldDef(v,t);
r.blobs.push(b)
};
if(CQ.Ext.isArray(j)){var c=j.length;
for(var n=0;
n<c;
n++){q(j[n])
}}else{q(j)
}}}}}});
CQ.undo.util.Blob=CQ.Ext.extend(CQ.Ext.emptyFn,{op:null,path:null,field:null,isDirty:false,id:null,deleted:false,unchanged:false,constructor:function(a){a=a||{};
CQ.Ext.apply(this,a)
},createFromFieldDef:function(b,g){var j=b.indexOf(":");
var c=b.substring(j+1);
this.op=b.substring(0,j);
var a=g.length;
this.field=c.substring(a+1);
this.path=this.field
},save:function(a,j,g){var c=CQ.undo.util.UndoUtils;
if(this.op=="update"){var b=c.saveBinary(a,j,this.path,g);
if(b!=null){this.id=b.id;
this.deleted=b.deleted;
this.unchanged=b.unchanged
}this.isDirty=(b==null)
}else{this.id=null;
this.isDirty=false;
this.deleted=true
}},saveCloned:function(a,b){var c=new CQ.undo.util.Blob({op:this.op,field:this.field,path:this.path});
c.save(a,b,this.id);
return c
},restore:function(b,c,a){if(!this.isDirty&&!this.unchanged){if(this.deleted){CQ.undo.util.UndoUtils.restoreBinary(b,null,c,this.path,a)
}else{CQ.undo.util.UndoUtils.restoreBinary(b,this.id,c,this.path,a)
}return true
}return false
},createSerializable:function(){return{op:this.op,path:this.path,field:this.field,id:this.id,isDirty:this.isDirty,deleted:this.deleted,unchanged:this.unchanged}
}});
CQ.undo.util.FormStub=CQ.Ext.extend(CQ.Ext.util.Observable,{data:null,constructor:function(a){this.data={};
if(a){this.data["./sling:resourceType"]=this.getFormValue(a,"./sling:resourceType");
this.data.oldCqCssClass=this.getFormValue(a,"oldCqCssClass");
this.data["./cq:cssClass"]=this.getFormValue(a,"./cq:cssClass")
}CQ.undo.util.FormStub.superclass.constructor.call(this,{});
this.addEvents("actioncomplete","actionfailed")
},getFormValue:function(b,a){var c=b.findField(a);
if(!c){return null
}return c.getValue()
},findField:function(a){if(!this.data.hasOwnProperty(a)){return null
}var b=this.data;
return{getValue:function(){return b[a]
}}
},reverseStub:function(){var a=new CQ.undo.util.FormStub();
a.data["./sling:resourceType"]=this.data["./sling:resourceType"];
a.data.oldCqCssClass=this.data["./cq:cssClass"];
a.data["./cq:cssClass"]=this.data.oldCqCssClass;
return a
}});
CQ.undo.util.UndoUtils=function(){var b="/jcr:content/";
var a=["D M d Y H:i:s \\G\\M\\TO","Y-m-d\\TH:i:s.uP","m/d/Y"];
return{strStartsWith:function(k,j){if(CQ.Ext.isArray(j)){var m=j.length;
for(var g=0;
g<m;
g++){if(CQ.undo.util.UndoUtils.strStartsWith(k,j[g])){return true
}}return false
}var c=j.length;
if(k.length>=c){return(k.substring(0,c)==j)
}return false
},strEndsWith:function(m,k){if(CQ.Ext.isArray(k)){var n=k.length;
for(var j=0;
j<n;
j++){if(CQ.undo.util.UndoUtils.strEndsWith(m,k[j])){return true
}}return false
}var g=m.length;
var c=k.length;
if(g>=c){return(m.substring(g-c,g)==k)
}return false
},strReplace:function(n,g,m,k){var c="";
if(g>0){c=n.substring(0,g)
}var j="";
if((m+1)<n.length){j=n.substring(m+1,n.length)
}return c+k+j
},getParentPath:function(g){var c;
if(g.getParentPath){c=g.getParentPath()
}else{var j=g.path.lastIndexOf("/");
c=(j>=0?g.path.substring(0,j):"/")
}return c
},getCurrentData:function(A,q){var w=A.path.lastIndexOf("/");
var r=CQ.undo.util.UndoUtils.getParentPath(A);
var G=(w>=0?A.path.substring(w+1):A.path);
var g=CQ.HTTP.get(CQ.HTTP.externalize(CQ.HTTP.noCaching(r+".infinity"+CQ.HTTP.EXTENSION_JSON)));
if(!CQ.HTTP.isOk(g)){throw new Error("Could not read paragraph data for undo.")
}var E=CQ.Ext.util.JSON.decode(g.responseText);
var D=false;
var n=null;
for(var F in E){if(E.hasOwnProperty(F)){if(F==G){D=true
}else{if(D){n=r+"/"+F;
break
}}}}E=E[G];
var B=null;
var t=null;
if(q!==true){B=[];
CQ.undo.util.UndoUtils.determineBlobs(E,B);
t={dialog:A.dialog};
var z=A.getEl().dom;
var k=z.getAttribute(CQ.Ext.isIE6||CQ.Ext.isIE7?"className":"class");
k=(k!=null?k:(CQ.Ext.isIE8?z.className:""));
var u=k.indexOf("section");
if(u>=0){var x=u+"section".length-1;
k=CQ.undo.util.UndoUtils.strReplace(k,u,x,"")
}t.divAttributes={"class":k};
var j=B.length;
for(var C=0;
C<j;
C++){var c=B[C];
var o=c.field.split("/");
var v=o.length-1;
var m=E;
for(var y=0;
y<v;
y++){m=m[o[y]]
}delete m[o[v]]
}}CQ.undo.util.UndoUtils.filterJSON(E);
return{insertBefore:n,data:E,compInfo:t,blobs:B}
},addDefaultFields:function(c){c[CQ.Sling.CHARSET]="UTF-8";
c["cq:lastModified"]="";
c["cq:lastModifiedBy"]=""
},filterJSON:function(j,o){var m=CQ.undo.util.UndoUtils;
if(CQ.Ext.isObject(j)){for(var g in j){if(j.hasOwnProperty(g)){if(m.isFiltered(g)){if((g!="jcr:primaryType")||!o){delete j[g]
}}else{var k=m.filterJSON(j[g],o);
if(k!=null){j[g]=k
}}}}}else{if(CQ.Ext.isArray(j)){var n=j.length;
for(var c=0;
c<n;
c++){m.filterJSON(j[c],o)
}}else{if(CQ.Ext.isString(j)){return m.parseDate(j)
}}}return null
},parseDate:function(k){var c=null;
var j=a.length;
for(var g=0;
g<j;
g++){c=Date.parseDate(k,a[g]);
if(c){return c
}}return null
},toDateStr:function(c){return(c?c.format(a[0]):"")
},isFiltered:function(c){var g=c.lastIndexOf("/");
if(g>=0){c=c.substring(g+1)
}switch(c){case"jcr:primaryType":case"jcr:lastModified":case"jcr:lastModifiedBy":case"jcr:created":case"jcr:createdBy":case":jcr:data":case"jcr:uuid":return true
}var j=CQ.undo.util.UndoUtils;
return j.strEndsWith(c,["@Delete","@MoveFrom"])
},createTypeHint:function(j,c){var g=j[c];
var k=CQ.undo.util.UndoUtils.getTypeForHint(g);
if(k=="Date"){j[c]=CQ.undo.util.UndoUtils.toDateStr(g)
}if(k){j[c]=String(j[c]);
j[c+CQ.Sling.TYPEHINT_SUFFIX]=k
}},getTypeForHint:function(c){var g=null;
if(CQ.Ext.isNumber(c)){if(parseInt(c)==parseFloat(c)){g="Long"
}else{g="Double"
}}else{if(CQ.Ext.isDate(c)){g="Date"
}else{if(CQ.Ext.isBoolean(c)){g="Boolean"
}}}return g
},jsonToSlingParameters:function(j,n,m,c){var k=CQ.undo.util.UndoUtils;
m=m||{};
n=n||"./";
if(CQ.Ext.isObject(j)){for(var g in j){if(j.hasOwnProperty(g)){if(g=="jcr:primaryType"){var q=(k.strEndsWith(n,"/")?n.substring(0,n-1):n)+CQ.Sling.TYPEHINT_SUFFIX;
m[q]=j[g]
}else{var o=n+(k.strEndsWith(n,"/")?"":"/")+g;
k.jsonToSlingParameters(j[g],o,m,true)
}}}}else{if(c||!k.strEndsWith(n,"sling:resourceType")){m[n]=j;
k.createTypeHint(m,n)
}}return m
},diffObject:function(w,c){var j=CQ.undo.util.UndoUtils;
var m={};
var o={};
var t={};
var g={};
var q=0;
var k=0;
var n=0;
var v;
for(v in w){if(w.hasOwnProperty(v)&&!j.isFiltered(v)){if(c.hasOwnProperty(v)){var u=w[v];
var r=c[v];
if(u!=r){m[v]=u;
o[v]=r;
q++
}}else{g[v]=w[v];
n++
}}}for(v in c){if(c.hasOwnProperty(v)&&!w.hasOwnProperty(v)){if(!j.isFiltered(v)){t[v]=c[v];
k++
}}}return{original:m,changed:o,added:t,deleted:g,changeCnt:q,addCnt:k,deleteCnt:n}
},createPostData:function(c,t,q,n,g){var m=CQ.undo.util.UndoUtils;
var o={};
if(c){for(var k in c){if(c.hasOwnProperty(k)){o[k]=c[k];
m.createTypeHint(o,k)
}}}if(t){for(var r in t){if(t.hasOwnProperty(r)){o[r]=t[r];
m.createTypeHint(o,r)
}}}if(q){for(var j in q){if(q.hasOwnProperty(j)){o[j+CQ.Sling.DELETE_SUFFIX]=""
}}}if(n===true){o["./jcr:lastModified"]="";
o["./jcr:lastModifiedBy"]=""
}if(g===true){o[CQ.Sling.CHARSET]="UTF-8"
}return o
},sortRemoveParagraphActions:function(j){var o=j.undoActions;
var x=[];
var n=o.length;
for(var v=n-1;
v>=0;
v--){var k=o[v];
if(k instanceof CQ.undo.actions.RemoveParagraphAction){x.push(k);
o.splice(v,1)
}}var m=[];
var w=function(c){var A=c.insertPath;
for(var B=0;
B<x.length;
B++){if(x[B].path==A){return false
}}return true
};
while(x.length>0){var z=x.length;
var u=0;
for(var g=z-1;
g>=0;
g--){var y=x[g];
if(w(y)){m.push(y);
x.splice(g,1);
u++
}}if(u==0){throw new Error("Could not sort RemoveParagraphActions.")
}}var t=m.length;
for(var q=0;
q<t;
q++){o.push(m[q])
}},isValidForTarget:function(o,k){if(!o){return true
}if(o.target=="others"){return(o.action!=k)
}var j=CQ.undo.UndoManager.getHistory();
var n=j.getStepForAction(o.action);
if(!n){return false
}var g=j.getStepForAction(k);
if(!g){throw new Error("Invalid step to check.")
}var c=j.getStepIndex(n);
var m=j.getStepIndex(g);
switch(o.target){case"previousSteps":return(m<c);
break
}return false
},resolveMultiValuePlaceholder:function(k){var m=[];
for(var g in k){if(k.hasOwnProperty(g)){var j=k[g];
if((g.indexOf("$")>0)&&CQ.Ext.isArray(j)){var o=j.length;
for(var c=0;
c<o;
c++){var n=g.replace("$",(c+1));
k[n]=j[c];
m.push({property:n,resolved:true})
}delete k[g]
}else{m.push({property:g,resolved:false})
}}}return m
},addBlobMarkerField:function(c,m){if(c){var o=c.getXType();
var k=(o=="dialog"?c.formPanel:(o=="form"?c:null));
if(k){var n=m.field;
if(CQ.undo.util.UndoUtils.strStartsWith(n,"./")){n=n.substring(2)
}var g=m.type+":"+m.path+"/"+n;
var j=new CQ.Ext.form.Hidden({name:CQ.undo.UndoDefs.BLOB_MARKER_FIELD,value:g});
k.add(j);
j.render(k.getForm().getEl())
}}},addUndoMarker:function(c){if(c){var k=c.getXType();
var j=(k=="dialog"?c.formPanel:(k=="form"?c:null));
if(j){var g=new CQ.Ext.form.Hidden({name:CQ.undo.UndoDefs.UNDO_MARKER_FIELD,value:""});
j.add(g);
g.render(j.getForm().getEl())
}}},removeBlobMarkerFields:function(g){if(g){var q=g.getXType();
var o=(q=="dialog"?g.formPanel:(q=="form"?g:null));
if(o){var j=o.items;
var c=[];
j.each(function(r){if(r.getName){if(r.getName()==CQ.undo.UndoDefs.BLOB_MARKER_FIELD){c.push(r)
}}});
var k=c.length;
for(var n=0;
n<k;
n++){var m=c[n];
o.remove(m,true)
}}}},determineBlobs:function(k,o,m,j){if(m==null){m=""
}if(k){var g=false;
if(k["sling:resourceType"]){g=true
}else{if(k["jcr:primaryType"]=="nt:resource"){o.push(new CQ.undo.util.Blob({op:"update",path:j,field:j}))
}}for(var c in k){if(k.hasOwnProperty(c)){var n=k[c];
if(CQ.Ext.isObject(n)){if(g){j=m+c
}CQ.undo.util.UndoUtils.determineBlobs(n,o,m+c+"/",j)
}}}}},saveBinary:function(c,q,k,o){var r=null;
var m={operation:"save",par:q,srcPath:k};
if(o){m.originalBlob=o
}var n=CQ.HTTP.post(c,null,m,null,true);
if(CQ.HTTP.isOk(n)){var j=n.headers.Path;
if((j!=null)&&(j.length==0)){j=null
}var g=(j==o);
r={id:(g?null:j),deleted:(j==null),unchanged:g}
}return r
},restoreBinary:function(k,j,m,c,g){var n=CQ.HTTP.post(k,null,{operation:"restore",srcPath:(j!=null?j:""),par:m,targetPath:c,global:(g===true?"true":"false")},null,true);
return CQ.HTTP.isOk(n)
},deleteBinaries:function(g,c){c=CQ.Ext.isArray(c)?c:[c];
if(c.length==0){return true
}var j=CQ.HTTP.post(g,null,{operation:"delete",deletePaths:c},null,true);
return CQ.HTTP.isOk(j)
},createSerializableBlobs:function(k){var j=[];
if(k){var g=k.length;
for(var c=0;
c<g;
c++){j.push(k[c].createSerializable())
}}return j
},createBlobsFromSerialized:function(j){var k=[];
if(j){var g=j.length;
for(var c=0;
c<g;
c++){k.push(new CQ.undo.util.Blob(j[c]))
}}return k
},createChangedBlobs:function(k,m,n){var o=[];
if(k&&(k.length>0)){var j=k.length;
for(var g=0;
g<j;
g++){var c=k[g];
o.push(c.saveCloned(m,n))
}for(g=(j-1);
g>=0;
g--){if(o[g].unchanged){o.splice(g,1);
k.splice(g,1)
}else{k[g].unchanged=false
}}}return o
},moveParagraph:function(c,r,j){var q=null;
var k=r;
var m=r.lastIndexOf("/");
var g="*";
if(m>=0){k=r.substring(0,m+1);
g=r.substring(m+1,r.length)
}else{k="/"
}var n={_charset_:"utf-8","./sling:resourceType":j,"./jcr:lastModified":"","./jcr:lastModifiedBy":"","./jcr:created":"","./jcr:createdBy":"",parentResourceType:""};
n["./"+CQ.Sling.MOVE_SUFFIX]=c;
n[CQ.Sling.ORDER]=(g=="*"?CQ.wcm.EditBase.INSERT_LAST:CQ.wcm.EditBase.INSERT_BEFORE+" "+g);
if(j){n[":nameHint"]=j.substring(j.lastIndexOf("/")+1)
}var o=CQ.utils.HTTP.post(k,null,n,null,true);
if(CQ.utils.HTTP.isOk(o)&&o.headers){q=o.headers.Path
}return q
},getPagePath:function(g){var c=g.indexOf(b);
if(c<0){return null
}return g.substring(0,c)
},getComponentPath:function(g){var c=g.indexOf(b);
if(c<0){return null
}return g.substring(c+b.length)
},blockPath:function(n,k){var g=CQ.undo.util.UndoUtils.getPagePath(n);
if(!g){throw new Error("Could not determine page for path '"+g+"'.")
}var c=CQ.undo.UndoManager.getOriginalConfig();
var m=new CQ.undo.UndoHistory(c);
m.loadHistory(g);
var j=m.blockPath(n,k);
m.saveHistory(g);
return j
},unblockPath:function(m,j){var g=CQ.undo.util.UndoUtils.getPagePath(m);
if(!g){throw new Error("Could not determine page for path '"+g+"'.")
}var c=CQ.undo.UndoManager.getOriginalConfig();
var k=new CQ.undo.UndoHistory(c);
k.loadHistory(g);
k.unblockPath(m,j);
k.saveHistory(g)
},messageBox:function(x,j,k,u,c,w){var q=true;
if(!u){u=CQ.Ext.MessageBox.OK
}else{if(u._customized){u=u._customized;
q=false
}}var o={title:x,msg:j,buttons:u,width:!isNaN(c)?c:400};
if(k){o.fn=k
}if(w){o.icon=w
}if(q){CQ.Ext.MessageBox.show(o)
}else{u=o.buttons;
var n=u.length;
var g=function(z){var y;
if(CQ.Ext.isObject(z)){o.fn(z.id)
}else{if(CQ.Ext.isString(z)){if(z=="ok"){for(y=0;
y<n;
y++){if(u[y].defaultOk){o.fn(u[y].id)
}}}else{if(z=="cancel"){for(y=0;
y<n;
y++){if(u[y].defaultCancel){o.fn(u[y].id)
}}}}}}t.hide()
};
var r=[];
for(var v=0;
v<n;
v++){var m=u[v];
r.push(new CQ.Ext.Button({text:m.text,handler:g.createCallback(m),hideMode:"offsets"}))
}var t=new CQ.Ext.Window({autoCreate:true,title:(x?x:"&nbsp;"),resizable:false,id:CQ.Util.createId("cq-msgbox"),minimizable:false,maximizable:false,stateful:false,modal:true,shim:true,buttonAlign:"center",width:o.width,minHeight:80,plain:true,footer:true,closable:true,close:function(){g("cancel")
},fbar:new CQ.Ext.Toolbar({items:r,enableOverflow:false}),center:function(){var y=this.el.getAlignToXY(CQ.Ext.getBody(),"c-c");
this.setPagePosition(y[0],y[1]-40);
return this
}});
t.render(CQ.Util.getRoot());
t.getEl().addClass("x-window-dlg");
t.body.createChild({html:'<div class="ext-mb-content" style="padding: 4px 8px 4px 4px; "><span class="ext-mb-text">'+o.msg+"</span></div>"});
t.show();
t.center()
}}}
}();
CQ.undo.util.MultiUndoUtils=function(){return{begin:function(){var b,a;
var c=false;
if(CQ.undo.UndoManager.isEnabled()){a=CQ.undo.UndoManager.getHistory();
b=a.createUndoStep(a.createStepConfig());
c=true
}return{enabled:c,step:b,history:a}
},commit:function(a){if(a.enabled){if(a.step.undoActions.length>0){a.step.commit()
}else{a.history.removeStep(a.step)
}}},determineInsertPath:function(a,c){if(a.enabled){var b=CQ.undo.util.UndoUtils.getCurrentData(c,true).insertBefore;
if(!b){b=CQ.undo.util.UndoUtils.getParentPath(c)+"/*"
}a.insertPath=b
}},determineMoveInformation:function(a,b){if(a.enabled){CQ.undo.util.MultiUndoUtils.determineInsertPath(a,b);
a.srcPath=b.path;
a.resourceType=(b.getResourceType?b.getResourceType():b.resourceType);
a.isMovePrepared=true
}},reverseActions:function(a){if(a.enabled){a.step.undoActions.reverse()
}},addMoveAction:function(b,g,j){if(b.enabled){if(!b.isMovePrepared){throw new Error("Move not prepared. Use #determineMoveInformation before.")
}var a=CQ.WCM.getComponentList();
var c=a.getComponent(b.resourceType);
b.step.addUndoAction(new CQ.undo.actions.MoveParagraphAction(b.history.getIdManager(),g,b.srcPath,b.insertPath,j.path,b.resourceType,{divAttributes:(c?c.divAttributes:null),dialog:(c?c.dialog:null)}));
b.isMovePrepared=false
}}}
}();
CQ.undo.util.IdRewriteManager=CQ.Ext.extend(CQ.Ext.util.Observable,{constructor:function(){CQ.undo.util.IdRewriteManager.superclass.constructor.call(this,{});
this.addEvents("paragraph","annotation","sketch")
}});
CQ.undo.util.UndoMask=CQ.Ext.extend(CQ.Ext.emptyFn,{maskEl:null,shown:false,clientSize:null,message:null,showMessage:function(){if(this.shown&&this.maskEl){var c,b;
if(CQ.Ext.isIE){if(this.clientSize){var a=CQ.Ext.getBody().dom;
c=a.scrollTop+Math.round(this.clientSize.height/2);
b=a.scrollLeft+Math.round(this.clientSize.width/2)
}}else{c=window.scrollY+Math.round(window.innerHeight/2);
b=window.scrollX+Math.round(window.innerWidth/2)
}var g=CQ.Ext.DomHelper.createDom({tag:"div",cls:"ext-el-mask-msg",style:{position:"absolute",top:c+"px",left:b+"px"},cn:{tag:"div",html:this.message}});
this.maskEl.appendChild(g)
}},show:function(){var b=CQ.Util.getRoot();
var a=document.createElement("div");
b.dom.appendChild(a);
this.maskEl=CQ.Ext.get(a);
var c;
if(CQ.Ext.isIE){this.maskEl.setStyle("height","100%");
(function(){var g=CQ.Ext.getBody().dom;
var j=this.maskEl.dom.clientHeight;
this.clientSize={width:this.maskEl.dom.clientWidth,height:j};
c=g.scrollHeight;
c=(j>c?j:c);
this.maskEl.setStyle("height",c+"px")
}).defer(1,this)
}else{c=(window.innerHeight+window.scrollMaxY);
this.maskEl.setStyle("height",c+"px")
}this.maskEl.setStyle("position","absolute");
this.maskEl.setStyle("display","block");
this.maskEl.setStyle("top",0);
this.maskEl.setStyle("left",0);
this.maskEl.setStyle("width","100%");
this.maskEl.setStyle("zIndex",10000);
this.shown=true;
this.showMessage.defer(1000,this)
},hide:function(){this.maskEl.remove();
this.maskEl=null;
this.clientSize=null;
this.shown=false
}});
CQ.undo.persistence.Serializer=CQ.Ext.extend(CQ.Ext.emptyFn,{serialize:function(a){throw new Error("serialize must be implemented by Serializer class.")
},deserialize:function(a,b){throw new Error("deserialize must be implemented by Serializer class.")
}});
CQ.undo.persistence.UrlEncodedStringSerializer=CQ.Ext.extend(CQ.undo.persistence.Serializer,{serialize:function(a){return encodeURIComponent(CQ.Ext.util.JSON.encode(a.serialize()))
},deserialize:function(a,g){var b=null;
try{b=CQ.Ext.util.JSON.decode(decodeURIComponent(g))
}catch(c){}if((b!=null)&&(b!="")){a.deserialize(b)
}}});
CQ.undo.persistence.Cookies={clear:CQ.Ext.util.Cookies.clear,get:CQ.Ext.util.Cookies.get,set:function(c,j){var a=arguments;
var n=arguments.length;
var b=(n>2)?a[2]:null;
var m=(n>3)?a[3]:"/";
var g=(n>4)?a[4]:null;
var k=(n>5)?a[5]:false;
document.cookie=c+"="+encodeURIComponent(j)+((b===null)?"":("; expires="+b.toGMTString()))+((m===null)?"":("; path="+m))+((g===null)?"":("; domain="+g))+((k===true)?"; secure":"")
},getCookieVal:function(b){var a=document.cookie.indexOf(";",b);
if(a==-1){a=document.cookie.length
}return decodeURIComponent(document.cookie.substring(b,a))
}};
CQ.undo.persistence.PersistenceRegistry=function(){var a={};
return{register:function(c,b){a[c]=b
},create:function(b,c){if(!a.hasOwnProperty(b)){throw new Error("Unknown persistence: "+b)
}return new a[b](c)
}}
}();
CQ.undo.persistence.PersistenceMode=function(){return{ON_UNLOAD:"unload",ON_STEP:"step"}
}();
CQ.undo.persistence.Persistence=CQ.Ext.extend(CQ.Ext.emptyFn,{load:function(a){throw new Error("load must be implemented by Persistence class.")
},saveHistoryData:function(b,a){throw new Error("save must be implemented by Persistence class.")
},getSerializer:function(){throw new Error("getSerializer must be implemented by Serializer class.")
}});
CQ.undo.persistence.UrlEncodedPersistence=CQ.Ext.extend(CQ.undo.persistence.Persistence,{serializer:null,constructor:function(a){this.serializer=new CQ.undo.persistence.UrlEncodedStringSerializer()
},extractPathData:function(j,m){if(j&&m){var g=CQ.undo.persistence.UrlEncodedPersistence;
var k=g.PATH_PREFIX+m+g.PATH_SEPARATOR;
var c=j.indexOf(k);
if(c<0){j=null
}else{var a=c+k.length;
var b=j.indexOf(g.PATH_SUFFIX,a);
if(b<a){j=null
}else{j=j.substring(a,b)
}}}return j
},replacePathData:function(j,m,c){var g=CQ.undo.persistence.UrlEncodedPersistence;
var b=-1;
var k=g.PATH_PREFIX+m+g.PATH_SEPARATOR;
if(j){b=j.indexOf(k);
if(b>=0){b+=k.length;
var a=j.indexOf(g.PATH_SUFFIX,b);
j=j.substring(0,b)+c+j.substring(a)
}else{j=j+k+c+g.PATH_SUFFIX
}}else{j=k+c+g.PATH_SUFFIX
}return j
},getSerializer:function(){return this.serializer
}});
CQ.undo.persistence.UrlEncodedPersistence.PATH_PREFIX="path[";
CQ.undo.persistence.UrlEncodedPersistence.PATH_SUFFIX="]";
CQ.undo.persistence.UrlEncodedPersistence.PATH_SEPARATOR=":";
CQ.undo.persistence.CookiePersistence=CQ.Ext.extend(CQ.undo.persistence.UrlEncodedPersistence,{cookieName:null,constructor:function(a){a=a||{};
this.cookieName=a.cookieName||CQ.undo.persistence.CookiePersistence.DEFAULT_COOKIE_NAME;
CQ.undo.persistence.CookiePersistence.superclass.constructor.call(this,a)
},load:function(m){var k=CQ.undo.persistence.CookiePersistence;
var g=CQ.undo.util.UndoUtils;
var j=CQ.undo.persistence.Cookies.get(this.cookieName);
if(j){if(g.strStartsWith(j,k.SEQUENCE_PREFIX)){var a=j.indexOf(k.SEQUENCE_SUFFIX,k.SEQUENCE_PREFIX.length);
var n=parseInt(j.substring(k.SEQUENCE_PREFIX.length,a));
j=j.substring(a+k.SEQUENCE_SUFFIX.length);
for(var o=1;
o<n;
o++){var b=CQ.undo.persistence.Cookies.get(this.cookieName+"-"+(o+1));
if(!b){j=null;
break
}j+=b
}}j=this.extractPathData(j,m)
}return j
},save:function(n,j){var m=CQ.undo.persistence.CookiePersistence;
j=this.replacePathData(this.load(null),n,j);
var k;
if(encodeURIComponent(j).length<m.COOKIE_LEN){CQ.undo.persistence.Cookies.set(this.cookieName,j);
k=1
}else{k=0;
var c;
var a=m.COOKIE_LEN-(m.SEQUENCE_PREFIX.length+m.SEQUENCE_SUFFIX.length+20);
while(j.length>0){var g=j.substring(0,a);
while(encodeURIComponent(g).length>a){g=g.substring(0,g.length-2)
}j=j.substring(g.length);
if(k==0){c=g;
a=m.COOKIE_LEN
}else{CQ.Ext.util.Cookies.set(this.cookieName+"-"+(k+1),g)
}k++
}c=m.SEQUENCE_PREFIX+k+m.SEQUENCE_SUFFIX+c;
CQ.undo.persistence.Cookies.set(this.cookieName,c)
}while(true){var b=this.cookieName+"-"+(k+1);
if(CQ.undo.persistence.Cookies.get(b)==null){break
}CQ.undo.persistence.Cookies.set(b,"");
k++
}}});
CQ.undo.persistence.CookiePersistence.DEFAULT_COOKIE_NAME="cq-undo-history";
CQ.undo.persistence.CookiePersistence.COOKIE_LEN=3800;
CQ.undo.persistence.CookiePersistence.SEQUENCE_PREFIX="seq[";
CQ.undo.persistence.CookiePersistence.SEQUENCE_SUFFIX="]";
CQ.undo.persistence.PersistenceRegistry.register("cookie",CQ.undo.persistence.CookiePersistence);
CQ.undo.persistence.WindowNamePersistence=CQ.Ext.extend(CQ.undo.persistence.UrlEncodedPersistence,{win:null,UNDO_CONTAINER:"UndoHistory",persistence:null,constructor:function(a){a=a||{win:CQ.WCM.getContentWindow()};
this.win=a.win;
this.persistence=new CQ.shared.ClientSidePersistence({container:this.UNDO_CONTAINER});
CQ.undo.persistence.WindowNamePersistence.superclass.constructor.call(this,a)
},load:function(a){return this.extractPathData(this.persistence.get("path"),a)
},save:function(b,a){this.persistence.set("path",this.replacePathData(this.load(null),b,a))
}});
CQ.undo.persistence.PersistenceRegistry.register("window.name",CQ.undo.persistence.WindowNamePersistence);
CQ.undo.UndoDefs=function(){return{UNDO_MARKER_FIELD:":cq:undoable",BLOB_MARKER_FIELD:":cq:undoblobs",DEFAULT_SERVLET_URL:"/libs/wcm/undo/bvm",MARKER_MODE_SELECT:"select",MARKER_MODE_FLASH:"flash"}
}();
CQ.undo.UndoHistory=CQ.Ext.extend(CQ.Ext.util.Observable,{undoSteps:null,maxUndoSteps:0,activeStep:0,persistence:null,persistenceMode:null,markerMode:null,whitelist:null,blacklist:null,binaryServletUrl:null,idManager:null,stepProcessed:null,operationEvent:null,undoMask:null,isOperationActive:false,blocked:false,pageVersion:null,edited:false,blockedPaths:null,constructor:function(b){b=b||{};
var c=(CQ.WCM.getContentFinder()?CQ.WCM.getTopWindow():CQ.WCM.getContentWindow());
var a=CQ.undo.UndoDefs;
CQ.Util.applyDefaults(b,{maxUndoSteps:30,persistence:"window.name",persistenceMode:CQ.undo.persistence.PersistenceMode.ON_STEP,markerMode:CQ.undo.UndoDefs.MARKER_MODE_FLASH,binaryServletUrl:a.DEFAULT_SERVLET_URL,whitelist:[],blacklist:[]});
if(!b.persistenceCfg){b.persistenceCfg={win:c}
}this.undoSteps=[];
this.activeStep=-1;
this.edited=false;
this.blockedPaths=[];
this.idManager=new CQ.undo.util.IdRewriteManager();
this.maxUndoSteps=b.maxUndoSteps;
this.persistence=CQ.undo.persistence.PersistenceRegistry.create(b.persistence,b.persistenceCfg);
this.persistenceMode=b.persistenceMode;
this.markerMode=b.markerMode;
this.binaryServletUrl=b.binaryServletUrl;
this.blacklist=b.blacklist;
this.whitelist=b.whitelist;
CQ.undo.UndoHistory.superclass.constructor.call(this,b);
this.addEvents("undostep","redostep")
},createUndoStep:function(a){if(this.canRedo()){var g=this.activeStep+1;
this.undoSteps.splice(g,this.undoSteps.length-g)
}var b=new CQ.undo.UndoStep(a);
var c=function(){b.un("committed",c,this);
var j=(this.maxUndoSteps>=0?this.undoSteps.length-this.maxUndoSteps:0);
if(j>0){if((this.activeStep-j)>=-1){this.undoSteps.splice(0,j);
this.activeStep-=j
}}this.edited=true;
if(this.persistenceMode==CQ.undo.persistence.PersistenceMode.ON_STEP){this.saveHistory(CQ.undo.UndoManager.getPagePath())
}};
b.on("committed",c,this);
this.undoSteps.push(b);
this.activeStep++;
return b
},removeStep:function(a){for(var b=this.undoSteps.length-1;
b>=0;
b--){if(this.undoSteps[b]==a){this.undoSteps.splice(b,1);
break
}}},canUndo:function(){return !this.isOperationActive&&!this.blocked&&(this.activeStep>=0)
},canRedo:function(){return !this.isOperationActive&&!this.blocked&&(this.activeStep<(this.undoSteps.length-1))
},undo:function(){if(!this.canUndo()){throw new Error("Cannot undo.")
}if(this.activeStep>=this.undoSteps.length){throw new Error("Invalid undo position: "+this.activeStep+"; max: "+this.undoSteps.length)
}this.stepProcessed=this.undoSteps[this.activeStep];
var a=this.stepProcessed.getValidity(this);
if(a!=CQ.undo.UndoStep.VALID){this.handleInvalidContext(a,false);
if(a!=CQ.undo.UndoStep.NOT_WHITELISTED){return
}}var b;
var c=function(g){this.activeStep--;
this.edited=true;
if(this.persistenceMode==CQ.undo.persistence.PersistenceMode.ON_STEP){this.saveHistory(CQ.undo.UndoManager.getPagePath())
}if(g=="true"){this.operationEvent="undostep";
this.prepareScreen(true);
this.isOperationActive=true;
this.stepProcessed.on("completed",this.onStepCompleted,this);
this.stepProcessed.on("error",this.onStepFailed,this);
this.stepProcessed.undo()
}else{this.onStepIgnored("undostep")
}}.createDelegate(this);
b=this.handlePreconditions(this.stepProcessed,true,c);
if(b=="false"){return
}if(b!="confirm"){c(b)
}},redo:function(){if(!this.canRedo()){throw new Error("Cannot redo.")
}this.activeStep++;
if(this.activeStep>=this.undoSteps.length){throw new Error("Invalid redo position: "+(this.activeStep-1)+"; max: "+this.undoSteps.length)
}this.stepProcessed=this.undoSteps[this.activeStep];
var b=this.stepProcessed.getValidity(this);
if(b!=CQ.undo.UndoStep.VALID){this.handleInvalidContext(b,true);
if(b!=CQ.undo.UndoStep.NOT_WHITELISTED){this.activeStep--;
return
}}var c;
var a=function(g){this.edited=true;
if(this.persistenceMode==CQ.undo.persistence.PersistenceMode.ON_STEP){this.saveHistory(CQ.undo.UndoManager.getPagePath())
}if(g=="true"){this.isOperationActive=true;
this.operationEvent="redostep";
this.prepareScreen(false);
this.stepProcessed.on("completed",this.onStepCompleted,this);
this.stepProcessed.on("error",this.onStepFailed,this);
this.stepProcessed.redo()
}else{this.onStepIgnored("redostep")
}}.createDelegate(this);
c=this.handlePreconditions(this.stepProcessed,false,a);
if(c=="false"){this.activeStep--;
return
}if(c!="confirm"){a(c)
}},clear:function(){this.undoSteps.length=0;
this.activeStep=-1;
this.blockedPaths.length=0;
this.idManager=new CQ.undo.util.IdRewriteManager()
},removeHandlers:function(){this.stepProcessed.un("completed",this.onStepCompleted,this);
this.stepProcessed.un("error",this.onStepFailed,this)
},onStepCompleted:function(a){this.removeHandlers();
if(this.persistenceMode==CQ.undo.persistence.PersistenceMode.ON_STEP){this.saveHistory(CQ.undo.UndoManager.getPagePath())
}this.fireEvent(this.operationEvent,this.stepProcessed);
this.restoreScreen(this.stepProcessed,(this.operationEvent=="undostep"));
if(a.config.refreshPage===true){CQ.Util.reload()
}this.isOperationActive=false
},onStepIgnored:function(a){this.fireEvent(a,this.stepProcessed)
},onStepFailed:function(){this.undoMask.hide();
this.removeHandlers();
this.isOperationActive=false;
var b=(this.operationEvent=="undostep");
var j=(b?CQ.I18n.getMessage("Undo failed"):CQ.I18n.getMessage("Redo failed"));
var g;
var c=this.stepProcessed.config.messages;
var k=c.length;
if(k>0){g="";
for(var a=0;
a<k;
a++){g+=c[a];
g+="<br>"
}CQ.undo.util.UndoUtils.messageBox(j,g,undefined,CQ.Ext.MessageBox.OK,undefined,CQ.Ext.MessageBox.ERROR);
return
}g=(b?CQ.I18n.getMessage("The undo operation has failed."):CQ.I18n.getMessage("The redo operation has failed."));
g+=CQ.I18n.getMessage("The reason could be a concurrent page edit, a redone cross-page move operation, a network issue or other circumstances.");
g+="<br><br>";
g+=CQ.I18n.getMessage("You have the following options:");
g+="<br><br>";
g+=CQ.I18n.getMessage("Continue: The problem will be ignored, and you can try to continue undoing earlier actions. Note that follow-up problems may occur.");
g+="<br><br>";
g+=CQ.I18n.getMessage("Clear History: The undo history will be cleared, and you won't be able to undo or redo previously recorded actions.");
g+="<br><br>";
g+=CQ.I18n.getMessage("Cancel: The undo history will be left unchanged, and you will still be able to redo previously undone operations.");
g+="<br><br>";
g+=CQ.I18n.getMessage("How would you like to proceed?");
CQ.undo.util.UndoUtils.messageBox(j,g,function(n){var m=false;
switch(n){case"ignore":break;
case"cancel":if(b){this.activeStep++
}else{this.activeStep--
}m=true;
break;
case"clear":this.clear();
m=true;
break
}if(m){if(this.persistenceMode==CQ.undo.persistence.PersistenceMode.ON_STEP){this.saveHistory(CQ.undo.UndoManager.getPagePath())
}}}.createDelegate(this),{_customized:[{id:"ignore",text:CQ.I18n.getMessage("Continue")},{id:"clear",text:CQ.I18n.getMessage("Clear History")},{id:"cancel",text:CQ.I18n.getMessage("Cancel"),defaultCancel:true}]},CQ.Ext.MessageBox.ERROR)
},block:function(){this.blocked=true
},unblock:function(){this.blocked=false
},saveHistory:function(b){b=(b?b:CQ.WCM.getPagePath());
var a=this.persistence.getSerializer();
var c=a.serialize(this);
if(c!=null){this.persistence.save(b,c)
}},loadHistory:function(c){c=(c?c:CQ.WCM.getPagePath());
var a=this.persistence.load(c);
if(a!=null){this.undoSteps.length=0;
this.activeStep=-1;
var b=this.persistence.getSerializer();
b.deserialize(this,a)
}},serialize:function(){var g=this.undoSteps.length;
var c={a:this.activeStep,s:g,pv:this.pageVersion,pe:this.edited,bp:this.blockedPaths};
for(var b=0;
b<g;
b++){var a=this.undoSteps[b];
c["s"+b]=a.serialize()
}return c
},deserialize:function(g){try{this.pageVersion=g.pv;
this.edited=g.pe;
this.activeStep=parseInt(g.a);
this.blockedPaths=g.bp;
this.undoSteps.length=0;
var k=g.s;
for(var b=0;
b<k;
b++){var a=g["s"+b];
var c=new CQ.undo.UndoStep(this.createStepConfig());
this.undoSteps.push(c);
c.deserialize(a)
}}catch(j){this.activeStep=-1;
this.undoSteps.length=0;
console.log("Error deserializing:",j)
}},setPageVersion:function(a){this.pageVersion=a;
this.edited=false
},getPageVersion:function(){return this.pageVersion
},hasEdits:function(){return this.edited
},handlePreconditions:function(g,m,q){var z=["false","ignore","confirm","true"];
var o=g.undoActions;
var k=o.length;
var t=z.indexOf("true");
var y="";
var x=[];
for(var w=0;
w<k;
w++){var u=o[w].checkPreconditions(m);
var b=z.indexOf(u.execute);
var j=u.message;
if(b<t){y="";
t=b
}if(j&&(y.indexOf(j)<0)){if(y.length>0){y+="<br>"
}y+=j
}if(u.confirm){x.push(u.confirm)
}}if(y){this.isOperationActive=true;
var c=CQ.undo.util.UndoUtils;
var v=(m?CQ.I18n.getMessage("Undo"):CQ.I18n.getMessage("Redo"));
var n=function(){this.isOperationActive=false
}.createDelegate(this);
var r=function(a){var B=x.length;
for(var A=0;
A<B;
A++){x[A](a===true)
}n()
};
switch(t){case 0:c.messageBox(CQ.I18n.getMessage("{0} cannot be executed",[v]),y,n,CQ.Ext.MessageBox.CANCEL,undefined,CQ.Ext.MessageBox.ERROR);
break;
case 1:c.messageBox(CQ.I18n.getMessage("{0} ignored",[v]),y,r,CQ.Ext.MessageBox.OK,undefined,CQ.Ext.MessageBox.ERROR);
break;
case 2:c.messageBox(CQ.I18n.getMessage("Please confirm"),y+"<br><br>"+CQ.I18n.getMessage("Do you really want to continue?"),function(A){var a=(A=="yes");
r(a);
q(a?"true":"ignore")
},CQ.Ext.MessageBox.YESNO,undefined,CQ.Ext.MessageBox.QUESTION);
break;
case 3:c.messageBox(CQ.I18n.getMessage("Info"),y,n);
break
}}return z[t]
},handleInvalidContext:function(c,j){var k=CQ.undo.UndoStep;
var b=(j?CQ.I18n.getMessage("This operation can currently not be redone."):CQ.I18n.getMessage("This operation can currently not be undone."));
var g=(j?CQ.I18n.getMessage("This operation can not be redone."):CQ.I18n.getMessage("This operation can not be undone."));
var n=(j?CQ.I18n.getMessage("Redo unavailable"):CQ.I18n.getMessage("Undo unavailable"));
var m;
var a=true;
switch(c){case k.BLACKLISTED:m=g+"<br>";
m+=CQ.I18n.getMessage("The operation references an item that is known to cause problems with undo.");
break;
case k.NOT_WHITELISTED:a=false;
n=(j?CQ.I18n.getMessage("Redo"):CQ.I18n.getMessage("Undo"));
m=CQ.I18n.getMessage("The operation references an item that may cause problems with undo. Proceed at your own risk.");
break;
case k.INVALID_WCM_MODE:m=b+"<br>";
m+=CQ.I18n.getMessage("Please change the edit mode back to the original one, then try again.");
break;
case k.BLOCKED_PATH:m=b+"<br>";
m+=CQ.I18n.getMessage("The operation references an item that has been moved to a different page by cutting and pasting. Please navigate to that page and undo the paste operation first.");
break
}if(a){CQ.undo.util.UndoUtils.messageBox(n,m)
}else{CQ.Notification.notify(n,m,10)
}},prepareScreen:function(a){this.undoMask=new CQ.undo.util.UndoMask();
this.undoMask.message=(a?CQ.I18n.getMessage("Undoing ..."):CQ.I18n.getMessage("Redoing ..."));
this.undoMask.show()
},restoreScreen:function(k,g){var a=k.getScrollOffsets();
if(a){var m=CQ.WCM.getContentWindow();
m.scrollTo(a.left,a.top)
}this.undoMask.hide();
CQ.WCM.deselect();
var c=k.getSelection(g);
if(this.markerMode==CQ.undo.UndoDefs.MARKER_MODE_SELECT){CQ.WCM.select(c)
}else{if(this.markerMode==CQ.undo.UndoDefs.MARKER_MODE_FLASH){var n=c.length;
for(var j=0;
j<n;
j++){var b=new CQ.Highlight({element:c[j].el,cls:"cq-editbase-droptarget-highlight"});
b.addListener("afterflash",function(o){o.destroy()
});
b.flash()
}}}},createStepConfig:function(c){var b=CQ.WCM.getContentWindow();
var a=(this.scrollOffsets?this.scrollOffsets:{left:b.scrollX,top:b.scrollY});
return{scrollOffsets:a,idManager:this.idManager,binaryServletUrl:this.binaryServletUrl}
},getStepForAction:function(k){var n=this.undoSteps.length;
for(var c=0;
c<n;
c++){var j=this.undoSteps[c];
var m=j.undoActions;
var g=m.length;
for(var b=0;
b<g;
b++){if(m[b]==k){return j
}}}return null
},getStepIndex:function(b){var c=this.undoSteps.length;
for(var a=0;
a<c;
a++){if(b==this.undoSteps[a]){return a
}}return -1
},getIdManager:function(){return this.idManager
},prepareUndo:function(k){this.originalData=k;
var j=CQ.WCM.getContentWindow();
this.scrollOffsets={left:j.scrollX,top:j.scrollY};
var m=k.blobs;
if(m&&(m.length>0)){var g=m.length;
for(var a=0;
a<g;
a++){var c=m[a];
c.save(this.binaryServletUrl,this.originalData.path)
}}},preventUndo:function(){this.originalData=null
},isNamedItem:function(a){return(a.getEl()!=undefined)&&(a.getName()==a.getEl().dom.name)&&!a.disabled
},convertOriginalValue:function(a,g){var c=CQ.undo.util.UndoUtils;
if(CQ.Ext.isBoolean(g)){if(CQ.Ext.isString(a)){if(a=="true"){a=true
}else{if(a=="false"){a=false
}}}}else{if(CQ.Ext.isDate(g)){if(CQ.Ext.isString(a)){var b=c.parseDate(a);
a=(b?b:a)
}}}return a
},onSuccessfulFormSubmit:function(J){var w=J.items;
if(!this.originalData){return
}var H=CQ.undo.util.UndoUtils;
var aa=J.getValues();
if(aa.hasOwnProperty("./sling:resourceType")||aa.hasOwnProperty(H.UNDO_MARKER_FIELD)){var y=aa["./sling:resourceType"];
var u=w.length;
var k={};
var v={};
var M=[];
var P=[];
var x=false;
var r,V,F,o,B,E;
for(V=0;
V<u;
V++){F=w.get(V);
o=F.getName();
if(o&&(o.length>2)&&(o.substring(0,2)=="./")){B=o.substring(2);
E=this.isNamedItem(F);
if(E&&!H.isFiltered(B)){r=this.originalData.records.get(B);
var Q=F.getValue();
if((r==undefined)&&CQ.Ext.isString(Q)&&(Q.length==0)){Q=undefined
}r=this.convertOriginalValue(r,Q);
if(k.hasOwnProperty(o)){var Y=k[o];
if(!CQ.Ext.isArray(Y)){Y=[Y];
k[o]=Y
}Y.push(Q)
}else{k[o]=Q
}v[o]=r
}else{if(E&&H.strEndsWith(o,CQ.Sling.DELETE_SUFFIX)){M.push(o.substring(0,o.length-CQ.Sling.DELETE_SUFFIX.length))
}}}}var K=function(j,a){if(!a){delete v[j];
P.push(j)
}};
for(var D in k){if(k.hasOwnProperty(D)&&v.hasOwnProperty(D)){r=v[D];
var n=k[D];
if(CQ.Ext.isArray(n)){var I=true;
if(CQ.Ext.isArray(r)){var Z=r.length;
if(Z==n.length){I=false;
for(V=0;
V<Z;
V++){if(r[V]!=n[V]){I=true;
break
}}}}if(I){x=true;
K(D,r)
}else{delete k[D];
delete v[D]
}}else{if(CQ.Ext.isDate(r)){r=r.getTime()
}if(CQ.Ext.isDate(n)){n=n.getTime()
}else{if(CQ.Ext.isBoolean(n)){if(r==undefined){r=false
}}}if(r!=n){x=true;
K(D,r)
}else{delete k[D];
delete v[D]
}}}}var N=[];
var g=H.jsonToSlingParameters(this.originalData.records.data);
for(var ab=P.length-1;
ab>=0;
ab--){var S=P[ab];
var G=S.split("/");
G.splice(0,1);
var c=null;
for(var R=G.length-2;
R>=0;
R--){var t=".";
for(var T=0;
T<=R;
T++){t+="/"+G[T]
}var q=true;
for(var A in g){if(g.hasOwnProperty(A)){if(H.strStartsWith(A,t+"/")||H.strStartsWith(A,t+"@")){q=false;
break
}}}if(q){c=t
}}var z=(c?c:S);
if(N.indexOf(z)<0){N.push(z);
v[z+CQ.Sling.DELETE_SUFFIX]="true"
}}var U=M.length;
for(var X=0;
X<U;
X++){var C=M[X];
k[C+CQ.Sling.DELETE_SUFFIX]="true";
r=this.originalData.records.get(C.substring(2));
if(CQ.Ext.isObject(r)){r=CQ.Util.copyObject(r);
H.filterJSON(r,true)
}H.jsonToSlingParameters(r,C,v);
x=true
}var b=this.originalData.blobs;
var W=H.createChangedBlobs(b,this.binaryServletUrl,this.originalData.path);
var O=function(ah,ae){var ad=ae.length;
var ac=[];
for(var af=0;
af<ad;
af++){var j=ae[af];
var ag="./"+j.path;
for(var ai in ah){if(ah.hasOwnProperty(ai)){if((ai==ag)||H.strStartsWith(ai,ag+"/")||H.strStartsWith(ai,ag+"@")){ac.push(ai)
}}}}var aj=ac.length;
for(var a=0;
a<aj;
a++){delete ah[ac[a]]
}};
O(v,b);
O(k,W);
x|=(W.length>0);
if(x){var L=new CQ.undo.util.FormStub(J);
var m=this.createUndoStep(this.createStepConfig());
m.addUndoAction(new CQ.undo.actions.UpdateParagraphAction(this.idManager,this.originalData.path,y,v,k,L,b,W,(this.originalData.isGlobalUpdate===true)));
m.commit()
}}else{}this.cancelUndo(true)
},createBlobsFromCreateParams:function(j,k){var n=[];
var g=CQ.undo.util.UndoUtils;
for(var c in k){if(k.hasOwnProperty(c)){if(g.strEndsWith(c,"@MoveFrom")){var a=c.lastIndexOf("@");
var m=c.substring(0,a);
m=(g.strStartsWith(m,"./")?m.substring(2):m);
var b=new CQ.undo.util.Blob({op:"update",path:m,field:m});
b.save(this.binaryServletUrl,j);
n.push(b);
delete k[c]
}}}return n
},cancelUndo:function(j){if(!j&&(this.originalData!=null)){var m=this.originalData.blobs;
if(m){var c=[];
var k=m.length;
for(var a=0;
a<k;
a++){var g=m[a];
if(g.id){c.push(g.id)
}}CQ.undo.util.UndoUtils.deleteBinaries(this.binaryServletUrl,c)
}}this.originalData=null;
this.scrollOffset=null;
this.undoFormStub=null
},blockPath:function(c,a){if(isNaN(a)){a=this.activeStep
}var b={path:c,step:a};
this.blockedPaths.push(b);
return b
},unblockPath:function(g,b){if(isNaN(b)){b=this.activeStep
}var a=this.blockedPaths.length;
for(var j=(a-1);
j>=0;
j--){var c=this.blockedPaths[j];
if((c.path==g)&&(c.step==b)){this.blockedPaths.splice(j,1);
break
}}},isPathBlocked:function(k,g){if(isNaN(g)){g=this.activeStep
}var j=this.blockedPaths.length;
for(var a=0;
a<j;
a++){var c=this.blockedPaths[a];
if((c.path==k)&&(c.step>=g)){return true
}}return false
}});
CQ.undo.UndoStep=CQ.Ext.extend(CQ.Ext.util.Observable,{undoActions:null,wcmMode:null,config:null,isExecuting:false,execConfig:null,constructor:function(a){this.undoActions=[];
this.wcmMode=CQ.WCM.getMode(true);
this.config=a;
this.config.step=this;
this.addEvents("committed","completed","error")
},execUndoRedo:function(b,a,g,c){this.isExecuting=true;
this.execConfig={actionProcessed:(c?this.undoActions.length-1:0),isReverseOrder:c,actionsExecuted:[],fn:b,counterFn:a,fnName:g,idMap:{}};
this.executeSingleAction()
},executeSingleAction:function(){var a=this.undoActions[this.execConfig.actionProcessed];
try{(this.execConfig.fn).call(a)
}catch(b){console.log("Error executing UndoAction",b);
this.notifyActionCompleted(a,false)
}},getValidity:function(r){var n=CQ.undo.UndoStep;
var j=CQ.undo.util.UndoUtils;
if(this.wcmMode!=CQ.WCM.getMode(true)){return n.INVALID_WCM_MODE
}var C=this.undoActions.length;
for(var E=0;
E<C;
E++){var t=this.undoActions[E];
var y=t.getRelevantPaths();
var A=y.length;
for(var x=0;
x<A;
x++){if(r.isPathBlocked(y[x])){return n.BLOCKED_PATH
}}var z=t.getComponentType();
if(z){var v=r.blacklist.length;
for(var D=0;
D<v;
D++){var k=r.blacklist[D];
var m=k.lastIndexOf(":");
var c;
var g=null;
if(m>=0){c=k.substring(0,m);
g=k.substring(m+1)
}else{c=k
}if(c==z){if(g==null){return n.BLACKLISTED
}var o=CQ.undo.actions.ActionRegistry.determineType(t);
if(g==o){return n.BLACKLISTED
}}}var u=r.whitelist.length;
for(var q=0;
q<u;
q++){var B=r.whitelist[q];
if(j.strEndsWith(B,"*")){if(j.strStartsWith(z,B.substring(0,B.length-1))){return n.VALID
}}else{if(B==z){return n.VALID
}}}return n.NOT_WHITELISTED
}}return n.VALID
},addUndoAction:function(a){this.undoActions.push(a)
},getActionIndex:function(g){var c=this.undoActions.length;
for(var b=0;
b<c;
b++){if(this.undoActions[b]==g){return b
}}return -1
},undo:function(){var a=this.config;
a.refreshPage=false;
a.messages=[];
this.execUndoRedo(function(){this.undo(a)
},function(){this.redo(a)
},CQ.I18n.getMessage("undo"),false)
},redo:function(){var a=this.config;
a.refreshPage=false;
a.messages=[];
this.execUndoRedo(function(){this.redo(a)
},function(){this.undo(a)
},CQ.I18n.getMessage("redo"),true)
},getScrollOffsets:function(){if(this.config&&this.config.scrollOffsets){return this.config.scrollOffsets
}return null
},getSelection:function(c){var g=[];
var j=this.undoActions.length;
for(var b=0;
b<j;
b++){this.undoActions[b].addToSelection(g,c)
}return g
},commit:function(){var c=this.undoActions.length;
for(var b=0;
b<c;
b++){this.undoActions[b].notifyStepCommitted()
}this.fireEvent("committed",this)
},notifyActionCompleted:function(a,j){var g=(function(){var m=this.undoActions.length;
for(var k=0;
k<m;
k++){var n=this.undoActions[k];
n.notifyStepCompleted(this.config,j)
}}).createDelegate(this);
if(j){var c=this.execConfig.isReverseOrder;
this.execConfig.actionsExecuted.push(a);
this.execConfig.actionProcessed+=(c?-1:1);
var b=!(c?(this.execConfig.actionProcessed>=0):(this.execConfig.actionProcessed<this.undoActions.length));
if(!b){this.executeSingleAction()
}else{g();
this.fireEvent.defer(1,this,["completed",this]);
this.isExecuting=false;
this.execConfig=null
}}else{g();
this.fireEvent("error",this)
}},serialize:function(){var g={};
g.m=this.wcmMode;
var c=this.undoActions.length;
g.a=this.undoActions.length;
for(var b=0;
b<c;
b++){g["a"+b]=this.undoActions[b].serialize()
}return g
},deserialize:function(k){this.undoActions.length=0;
var j=k.a;
for(var b=0;
b<j;
b++){var c=k["a"+b];
var g=CQ.undo.actions.ActionRegistry.create(c.t);
g.deserialize(c,this.config.idManager);
this.undoActions.push(g)
}this.wcmMode=k.m
}});
CQ.undo.UndoStep.VALID=0;
CQ.undo.UndoStep.INVALID_WCM_MODE=1;
CQ.undo.UndoStep.BLOCKED_PATH=2;
CQ.undo.UndoStep.BLACKLISTED=3;
CQ.undo.UndoStep.NOT_WHITELISTED=4;
CQ.undo.UndoAction=CQ.Ext.extend(CQ.Ext.emptyFn,{getRelevantPaths:function(){throw new Error("CQ.undo.UndoAction#getRelevantPaths must be implemented.")
},getComponentType:function(){throw new Error("CQ.undo.UndoAction#getComponentType must be implemented.")
},checkPreconditions:function(a){throw new Error("CQ.undo.UndoAction#checkPreconditions must be implemented.")
},undo:function(a){throw new Error("CQ.undo.UndoAction#undo must be implemented.")
},redo:function(a){throw new Error("CQ.undo.UndoAction#redo must be implemented.")
},notifyStepCommitted:function(){throw new Error("CQ.undo.UndoAction#notifyStepCommitted must be implemented.")
},notifyStepCompleted:function(a,b){throw new Error("CQ.undo.UndoAction#notifyStepCompleted must be implemented.")
},addToSelection:function(b,a){throw new Error("CQ.undo.UndoAction#addToSelection must be implemented.")
},serialize:function(){throw new Error("CQ.undo.UndoAction#serialize must be implemented.")
},deserialize:function(a){throw new Error("CQ.undo.UndoAction#deserialize must be implemented.")
}});
CQ.undo.UndoManager=function(){var a=null;
var b=true;
var c=null;
var g=null;
return{getHistory:function(){return a
},getOriginalConfig:function(){return g
},initialize:function(j){g=CQ.Util.copyObject(j);
if(CQ.WCM.isContentWindow()){b=j.enabled!==false;
if(b){delete j.enabled;
c=j.pagePath;
a=new CQ.undo.UndoHistory(j);
if(a.persistenceMode==CQ.undo.persistence.PersistenceMode.ON_UNLOAD){CQ.WindowEventManager.addListener("beforeunload",function(){a.saveHistory(c)
})
}a.loadHistory(c)
}}},isEnabled:function(){return a&&b
},isDisabled:function(){return !CQ.undo.UndoManager.isEnabled()
},getPagePath:function(){return c
},setEnabled:function(j){b=j
},detectCachedPage:function(k){if(CQ.undo.UndoManager.isEnabled()){var n=a.getPageVersion();
var j=(n!=null)&&(k<=n);
var m=a.hasEdits();
if(j&&m){CQ.undo.util.UndoUtils.messageBox(CQ.I18n.getMessage("Warning"),CQ.I18n.getMessage("This page seems to be outdated, most probably because it was taken from the browser cache.<br><br>A reload of the page is strongly recommended.<br><br>Do you want to reload the page?"),function(o){if(o=="yes"){CQ.Util.reload()
}},CQ.Ext.MessageBox.YESNO,300,CQ.Ext.MessageBox.QUESTION)
}else{a.setPageVersion(k);
a.saveHistory(CQ.undo.UndoManager.getPagePath())
}}}}
}();
CQ.undo.actions.ActionRegistry=function(){var a={};
return{register:function(c,b){a[c]=b
},create:function(b){if(!a.hasOwnProperty(b)){throw new Error("Unknown action type: "+b)
}return new a[b]
},determineType:function(c){var b=null;
for(var g in a){if(a.hasOwnProperty(g)){if(a[g]===c.constructor){b=g;
break
}}}if(b==null){throw new Error("The provided action is not of a registered type.")
}return b
}}
}();
CQ.undo.actions.AbstractAction=CQ.Ext.extend(CQ.undo.UndoAction,{path:null,isPathDeleted:false,idManager:null,componentType:null,constructor:function(b,a){if(arguments.length==0){return
}this.path=b;
this.idManager=a;
this.componentType=null;
this.initializePathRewriting()
},initializePathRewriting:function(){},getEditable:function(){var a=CQ.WCM.getEditable(this.path);
if(!a){throw new Error("No editable found for path '"+this.path+"'.")
}return a
},createUpdateParagraphParameters:function(n,o){var j=undefined;
var b=null;
var m=null;
var c=true;
for(var g in n){if(n.hasOwnProperty(g)){var k=n[g];
var a=CQ.undo.util.UndoUtils.getTypeForHint(k);
if(a=="Date"){k=CQ.undo.util.UndoUtils.toDateStr(k)
}if(c&&!o){b=g;
m=k;
c=false
}else{if(j==undefined){j={}
}j[g]=k
}if(a){if(j==undefined){j={}
}j[g+CQ.Sling.TYPEHINT_SUFFIX]=a
}}}return{name:b,value:m,extraParams:j}
},changePath:function(c,a){var g=a.oldPath;
if(c==g){return a.newPath
}var b=g.length;
if((c.length>b)&&(c.substring(0,b)==g)){c=a.newPath+c.substring(b)
}return c
},getRelevantPaths:function(){var a=[];
if(this.path){a.push(this.path)
}return a
},getComponentType:function(){return this.componentType
},checkPreconditions:function(a){return{execute:"true"}
},notifyStepCommitted:function(){},notifyStepCompleted:function(a,b){},serialize:function(){return{t:CQ.undo.actions.ActionRegistry.determineType(this),p:this.path,ct:this.componentType,ipd:this.isPathDeleted,spc:this.serializeSpecific()}
},serializeSpecific:function(){throw new Error("CQ.undo.actions.AbstractAction#serializeSpecific must be implemented.")
},deserialize:function(b,a){this.path=b.p;
this.isPathDeleted=b.ipd;
this.idManager=a;
this.componentType=b.ct;
this.deserializeSpecific(b.spc);
this.initializePathRewriting()
},deserializeSpecific:function(a){throw new Error("CQ.undo.actions.AbstractAction#deserializeSpecific must be implemented.")
}});
CQ.undo.actions.AbstractParagraphAction=CQ.Ext.extend(CQ.undo.actions.AbstractAction,{constructor:function(c,b,a){CQ.undo.actions.AbstractParagraphAction.superclass.constructor.call(this,c,a);
this.componentType=b
},restoreBlobs:function(c,o,n){var m=false;
var g=o.length;
for(var a=0;
a<g;
a++){m|=o[a].restore(c.binaryServletUrl,this.path,n)
}try{var j=this.getEditable();
if(m){j.refresh()
}}catch(k){}}});
CQ.undo.actions.UpdateParagraphAction=CQ.Ext.extend(CQ.undo.actions.AbstractParagraphAction,{originalData:null,changedData:null,originalBlobs:null,changedBlobs:null,undoFormStub:null,redoFormStub:null,isGlobalUpdate:false,constructor:function(g,o,c,m,b,k,j,a,n){if(arguments.length==0){return
}CQ.undo.actions.UpdateParagraphAction.superclass.constructor.call(this,o,c,g);
this.originalData=m;
this.changedData=b;
this.setRedoFormStub(k);
this.originalBlobs=j;
this.changedBlobs=a;
this.isGlobalUpdate=n
},initializePathRewriting:function(){this.idManager.on("paragraph",this.onParagraphIdChanged,this)
},onParagraphIdChanged:function(a,b){if(CQ.undo.util.UndoUtils.isValidForTarget(b,this)){if(this.path==a.oldPath){if(a.deleted){this.isPathDeleted=true
}else{if(this.isPathDeleted){this.path=a.newPath;
this.isPathDeleted=false
}}}}},setRedoFormStub:function(a){this.redoFormStub=a;
this.undoFormStub=(a?a.reverseStub():null)
},undo:function(a){var g=this.createUpdateParagraphParameters(this.originalData,this.isGlobalUpdate);
if(this.isGlobalUpdate){var m=g.extraParams;
CQ.undo.util.UndoUtils.addDefaultFields(m);
var k=CQ.HTTP.post(this.path,null,m,this,true);
if(CQ.HTTP.isOk(k)){if(this.originalBlobs){this.restoreBlobs(a,this.originalBlobs,true)
}a.step.notifyActionCompleted(this,true);
a.refreshPage=true
}else{a.step.notifyActionCompleted(this,false)
}return
}var c=this.getEditable();
if(g.name){var j=function(){this.undoFormStub.removeListener("actioncomplete",j,this);
if(this.originalBlobs){this.restoreBlobs(a,this.originalBlobs)
}a.step.notifyActionCompleted(this,true)
};
this.undoFormStub.addListener("actioncomplete",j,this);
var b=function(){this.undoFormStub.removeListener("actionfailed",j,this);
a.step.notifyActionCompleted(this,false)
};
this.undoFormStub.addListener("actionfailed",b,this);
c.updateParagraph(g.name,g.value,g.extraParams,true,this.undoFormStub)
}else{if(this.originalBlobs){this.restoreBlobs(a,this.originalBlobs)
}a.step.notifyActionCompleted(this,true)
}},redo:function(a){var g=this.createUpdateParagraphParameters(this.changedData,this.isGlobalUpdate);
if(this.isGlobalUpdate){var m=g.extraParams;
CQ.undo.util.UndoUtils.addDefaultFields(m);
var k=CQ.HTTP.post(this.path,null,m,this,true);
if(CQ.HTTP.isOk(k)){if(this.changedBlobs){this.restoreBlobs(a,this.changedBlobs,true)
}a.step.notifyActionCompleted(this,true);
a.refreshPage=true
}else{a.step.notifyActionCompleted(this,false)
}return
}var c=this.getEditable();
if(g.name){var j=function(){this.redoFormStub.removeListener("actioncomplete",j,this);
if(this.changedBlobs){this.restoreBlobs(a,this.changedBlobs)
}a.step.notifyActionCompleted(this,true)
};
this.redoFormStub.addListener("actioncomplete",j,this);
var b=function(){this.redoFormStub.removeListener("actionfailed",j,this);
a.step.notifyActionCompleted(this,false)
};
this.redoFormStub.addListener("actionfailed",b);
c.updateParagraph(g.name,g.value,g.extraParams,true,this.redoFormStub)
}else{if(this.changedBlobs){this.restoreBlobs(a,this.changedBlobs)
}a.step.notifyActionCompleted(this,true)
}},addToSelection:function(b,a){try{b.push(this.getEditable())
}catch(c){}},serializeSpecific:function(){var a=CQ.undo.util.UndoUtils;
return{od:this.createUpdateParagraphParameters(this.originalData),cd:this.createUpdateParagraphParameters(this.changedData),rfs:this.redoFormStub.data,ob:a.createSerializableBlobs(this.originalBlobs),cb:a.createSerializableBlobs(this.changedBlobs),gu:this.isGlobalUpdate}
},deserializeSpecific:function(g){var a=CQ.undo.util.UndoUtils;
var c=function(n){var j={};
j[n.name]=n.value;
var m=n.extraParams;
for(var k in m){if(m.hasOwnProperty(k)){j[k]=m[k]
}}return j
};
this.originalData=c(g.od);
this.changedData=c(g.cd);
var b=new CQ.undo.util.FormStub();
b.data=g.rfs;
this.setRedoFormStub(b);
this.originalBlobs=a.createBlobsFromSerialized(g.ob);
this.changedBlobs=a.createBlobsFromSerialized(g.cb);
this.isGlobalUpdate=g.gu
}});
CQ.undo.actions.ActionRegistry.register("updateParagraph",CQ.undo.actions.UpdateParagraphAction);
CQ.undo.actions.InsertParagraphAction=CQ.Ext.extend(CQ.undo.actions.AbstractParagraphAction,{insertPath:null,isInsertPathDeleted:false,createParams:null,blobs:null,constructor:function(a,g,b,c,j){if(arguments.length==0){return
}CQ.undo.actions.InsertParagraphAction.superclass.constructor.call(this,g,c.definition.resourceType,a);
this.insertPath=b;
this.createParams=c;
this.blobs=j
},initializePathRewriting:function(){this.idManager.on("paragraph",this.onParagraphIdChanged,this)
},onParagraphIdChanged:function(a,b){if(CQ.undo.util.UndoUtils.isValidForTarget(b,this)){if(this.path==a.oldPath){if(a.deleted){this.isPathDeleted=true
}else{if(this.isPathDeleted){this.path=a.newPath;
this.isPathDeleted=false
}}}if(this.insertPath==a.oldPath){if(a.deleted){this.isInsertPathDeleted=true
}else{if(this.isInsertPathDeleted){this.insertPath=a.newPath;
this.isInsertPathDeleted=false
}}}}},onEditableReady:function(a){if(this.createParams.loadAnnotations){var b=this.getEditable();
b.loadAnnotations(true)
}if(this.blobs){this.restoreBlobs(a,this.blobs)
}a.step.notifyActionCompleted(this,true)
},undo:function(a){var b=this.getEditable();
CQ.wcm.EditBase.doRemoveParagraph(b);
var c={oldPath:this.path,newPath:null,deleted:true};
this.idManager.fireEvent("paragraph",c);
a.step.execConfig.idMap[this.path]=c;
a.step.notifyActionCompleted(this,true)
},redo:function(a){var g=CQ.WCM.getEditable(this.insertPath);
if(!g){throw new Error("No editable found for inserting to path '"+this.insertPath+"'.")
}var c=g.createParagraph(this.createParams.definition,this.createParams.extraParams,this.createParams.noEvent,false,this.createParams.ignoreTemplate,true);
if(c){CQ.WCM.onEditableReady(c,function(){this.onEditableReady(a)
},this);
var b={oldPath:this.path,newPath:c,deleted:false};
this.idManager.fireEvent("paragraph",b);
a.step.execConfig.idMap[this.path]=b
}else{a.step.notifyActionCompleted(this,false)
}},addToSelection:function(b,a){try{if(!a){b.push(this.getEditable())
}}catch(c){}},serializeSpecific:function(){var a=CQ.undo.util.UndoUtils;
return{ip:this.insertPath,iipd:this.isInsertPathDeleted,cp:this.createParams,b:a.createSerializableBlobs(this.blobs)}
},deserializeSpecific:function(b){var a=CQ.undo.util.UndoUtils;
this.insertPath=b.ip;
this.isInsertPathDeleted=b.iipd;
this.createParams=b.cp;
this.blobs=a.createBlobsFromSerialized(b.b)
}});
CQ.undo.actions.ActionRegistry.register("insertParagraph",CQ.undo.actions.InsertParagraphAction);
CQ.undo.actions.RemoveParagraphAction=CQ.Ext.extend(CQ.undo.actions.AbstractParagraphAction,{insertPath:null,isInsertPathDeleted:false,parData:null,blobs:null,compInfo:null,dropTarget:null,hasAnnotations:false,constructor:function(b,j,c,g,n,m,k,a){if(arguments.length==0){return
}CQ.undo.actions.RemoveParagraphAction.superclass.constructor.call(this,j,g["sling:resourceType"],b);
this.insertPath=c;
this.parData=g;
this.blobs=n;
this.compInfo=m;
this.dropTarget=k;
this.hasAnnotations=a
},initializePathRewriting:function(){this.idManager.on("paragraph",this.onParagraphIdChanged,this)
},onParagraphIdChanged:function(a,b){if(CQ.undo.util.UndoUtils.isValidForTarget(b,this)){if(this.path==a.oldPath){if(a.deleted){this.isPathDeleted=true
}else{if(this.isPathDeleted){this.path=a.newPath;
this.isPathDeleted=false
}}}if(this.insertPath==a.oldPath){if(a.deleted){this.isInsertPathDeleted=true
}else{if(this.isInsertPathDeleted){this.insertPath=a.newPath;
this.isInsertPathDeleted=false
}}}}},onEditableReady:function(a){var b=this.getEditable();
if(this.hasAnnotations){b.loadAnnotations(true)
}if(this.blobs){this.restoreBlobs(a,this.blobs)
}b.fireEvent(CQ.wcm.EditBase.EVENT_AFTER_EDIT,b);
a.step.notifyActionCompleted(this,true)
},undo:function(r){var b=this.parData["sling:resourceType"];
var a,t;
if(!this.insertPath){var c=this.path;
var m=c.lastIndexOf("/");
if((m<0)&&(m>=(c.length-1))){throw new Error("No parent path detectable for '"+this.path+"'.")
}c=c.substring(0,m)+"/*";
t=CQ.wcm.EditBase.INSERT_LAST;
a=CQ.WCM.getEditable(c)
}else{a=CQ.WCM.getEditable(this.insertPath);
t=CQ.wcm.EditBase.INSERT_BEFORE
}var u=CQ.WCM.getComponentList();
var o=u.getComponent(b);
var v=CQ.undo.util.UndoUtils.jsonToSlingParameters(this.parData);
var j={params:v,dropTarget:this.dropTarget};
if(o){if(o.config){CQ.Util.applyDefaults(j,o.config)
}}var k=null;
if(o&&o.templatePath){k=o.templatePath
}var g={resourceType:b,insertBehavior:t,config:j,templatePath:k};
CQ.Ext.apply(g,this.compInfo);
var q=a.createParagraph(g,undefined,undefined,false,undefined,true);
if(q){CQ.WCM.onEditableReady(q,function(){this.onEditableReady(r)
},this);
var n={oldPath:this.path,newPath:q,deleted:false};
r.step.execConfig.idMap[this.path]=n;
this.idManager.fireEvent("paragraph",n)
}else{r.step.notifyActionCompleted(this,false)
}},redo:function(a){CQ.wcm.EditBase.doRemoveParagraph(this.getEditable());
var b={oldPath:this.path,newPath:null,deleted:true};
this.idManager.fireEvent("paragraph",b);
a.step.execConfig.idMap[this.path]=b;
a.step.notifyActionCompleted(this,true)
},notifyStepCommitted:function(){var a={oldPath:this.path,newPath:null,deleted:true};
this.idManager.fireEvent("paragraph",a)
},addToSelection:function(b,a){try{if(a){b.push(this.getEditable())
}}catch(c){}},serializeSpecific:function(){var a=CQ.undo.util.UndoUtils;
return{ip:this.insertPath,pd:this.parData,b:a.createSerializableBlobs(this.blobs),ci:this.compInfo,dt:this.dropTarget,ann:this.hasAnnotations}
},deserializeSpecific:function(b){var a=CQ.undo.util.UndoUtils;
this.insertPath=b.ip;
this.parData=b.pd;
this.blobs=a.createBlobsFromSerialized(b.b);
this.compInfo=b.ci;
this.dropTarget=b.dt;
this.hasAnnotations=b.ann
}});
CQ.undo.actions.ActionRegistry.register("removeParagraph",CQ.undo.actions.RemoveParagraphAction);
CQ.undo.actions.MoveParagraphAction=CQ.Ext.extend(CQ.undo.actions.AbstractAction,{srcPath:null,srcInsertPath:null,destInsertPath:null,isSrcPathDeleted:false,isSrcInsertPathDeleted:false,isDestInsertPathDeleted:false,resourceType:null,compInfo:null,crossPageStep:0,isDirty:false,constructor:function(k,t,g,q,b,c,n){if(arguments.length==0){return
}var j=CQ.undo.util.UndoUtils;
CQ.undo.actions.MoveParagraphAction.superclass.constructor.call(this,t,k);
this.srcPath=g;
this.srcInsertPath=q;
this.destInsertPath=b;
this.resourceType=c;
this.compInfo=n;
var r=j.getPagePath(g);
var a=j.getPagePath(t);
if(r!=a){var o=j.blockPath(g);
this.crossPageStep=o.step
}else{this.crossPageStep=-2
}var m={oldPath:g,newPath:this.path,moved:true};
this.idManager.fireEvent("paragraph",m,{target:"others",action:this})
},initializePathRewriting:function(){this.idManager.on("paragraph",this.onParagraphIdChanged,this)
},onParagraphIdChanged:function(a,b){if(CQ.undo.util.UndoUtils.isValidForTarget(b,this)){if(this.path==a.oldPath){if(a.deleted){this.isPathDeleted=true
}else{if(this.isPathDeleted){this.path=a.newPath;
this.isPathDeleted=false
}}}if(this.srcPath==a.oldPath){if(a.deleted){this.isSrcPathDeleted=true
}else{if(this.isSrcPathDeleted){this.srcPath=a.newPath;
this.isSrcPathDeleted=false
}}}if(this.srcInsertPath==a.oldPath){if(a.deleted){this.isSrcInsertPathDeleted=true
}else{if(this.isSrcInsertPathDeleted||a.moved){this.srcInsertPath=a.newPath;
this.isSrcInsertPathDeleted=false
}}}if(this.destInsertPath==a.oldPath){if(a.deleted){this.isDestInsertPathDeleted=true
}else{if(this.isDestInsertPathDeleted||a.moved){this.destInsertPath=a.newPath;
this.isDestInsertPathDeleted=false
}}}}},undo:function(a){var b=this.getEditable();
if(b==null){throw new Error("Could not determine editable to move.")
}var g=null;
var j=CQ.WCM.getEditable(this.srcInsertPath);
if(j==null){g=CQ.undo.util.UndoUtils.moveParagraph(this.path,this.srcInsertPath,this.resourceType);
b.deleted=true;
b.fireEvent(CQ.wcm.EditBase.EVENT_AFTER_DELETE,b);
CQ.undo.util.UndoUtils.unblockPath(this.srcPath,this.crossPageStep)
}else{g=j.moveParagraph(this.path,this.resourceType,b.hasAnnotations())
}if(g){var c={oldPath:this.path,newPath:g,moved:true};
this.path=g;
this.idManager.fireEvent("paragraph",c);
a.step.notifyActionCompleted(this,true)
}else{a.step.notifyActionCompleted(this,false)
}},redo:function(m){var c=CQ.WCM.getEditable(this.path);
var k;
if(c==null){k=CQ.undo.util.UndoUtils.moveParagraph(this.path,this.destInsertPath,this.resourceType);
if(k){var n=CQ.WCM.getEditable(this.destInsertPath);
var b={resourceType:this.resourceType};
CQ.Ext.apply(b,this.compInfo);
var o=CQ.WCM.getComponentList();
var j=o.getComponent(this.resourceType);
if(j&&j.config){b.config=CQ.Util.copyObject(j.config)
}n.refreshCreated(k,b,n.hasAnnotations());
CQ.undo.util.UndoUtils.blockPath(this.srcPath,this.crossPageStep)
}}else{var a=CQ.WCM.getEditable(this.destInsertPath);
if(a==null){throw new Error("Could not determine editable for move target.")
}k=a.moveParagraph(c.path,this.resourceType,c.hasAnnotations())
}if(k){var g={oldPath:this.path,newPath:k,moved:true};
this.path=k;
this.idManager.fireEvent("paragraph",g);
m.step.notifyActionCompleted(this,true)
}else{m.step.notifyActionCompleted(this,false)
}},addToSelection:function(b,a){try{b.push(this.getEditable())
}catch(c){}},serializeSpecific:function(){return{sp:this.srcPath,sip:this.srcInsertPath,dip:this.destInsertPath,ispd:this.isSrcPathDeleted,isipd:this.isSrcInsertPathDeleted,idipd:this.isDestInsertPathDeleted,rt:this.resourceType,ci:this.compInfo,cps:this.crossPageStep,id:this.isDirty}
},deserializeSpecific:function(a){this.srcPath=a.sp;
this.srcInsertPath=a.sip;
this.destInsertPath=a.dip;
this.isSrcPathDeleted=a.ispd;
this.isSrcInsertPathDeleted=a.isipd;
this.isDestInsertPathDeleted=a.idipd;
this.resourceType=a.rt;
this.compInfo=a.ci;
this.crossPageStep=a.cps;
this.isDirty=a.id
}});
CQ.undo.actions.ActionRegistry.register("moveParagraph",CQ.undo.actions.MoveParagraphAction);
CQ.undo.actions.AnnotationHelpers=function(){var g=function(j,k,m,n){if(!n){n=m
}if(!CQ.undo.util.UndoUtils.strStartsWith(m,"jcr:")){m="./"+m
}if(k[m]){j[n]=k[m]
}};
var c=function(j,k,m){if(!CQ.undo.util.UndoUtils.strStartsWith(k,"jcr:")){k="./"+k
}if(j.hasOwnProperty(k)){j[k+CQ.Sling.TYPEHINT_SUFFIX]=m
}};
var a=function(j){j["./jcr:lastModified"]="";
j["./jcr:lastModifiedBy"]=""
};
var b=function(j){j[CQ.Sling.CHARSET]="UTF-8"
};
return{recreateFromSnapshot:function(n,m){var o={path:n.path+"/"+CQ.wcm.EditBase.ANNOTATIONS+"/",editComponent:n};
g(o,m,"text");
g(o,m,"x","offsetX");
g(o,m,"y","offsetY");
g(o,m,"w","width");
g(o,m,"h","height");
g(o,m,"minimized");
g(o,m,"color");
var j=n.addAnnotation(o,undefined,true);
var k=CQ.Util.copyObject(m);
c(k,"x","Long");
c(k,"y","Long");
c(k,"w","Long");
c(k,"h","Long");
c(k,"minimized","Boolean");
a(k);
b(k);
var q=j.post(k,true,true);
return(q?j:null)
},recreateSketchFromSnapshot:function(j,m){var o=j.addSketch({data:m["./data"],offsetX:m["./x"],offsetY:m["./y"],width:m["./w"],height:m["./h"],hidden:j.minimized});
o.align();
var k=CQ.Util.copyObject(m);
c(k,"x","Long");
c(k,"y","Long");
c(k,"w","Long");
c(k,"h","Long");
var n=o.post(k,true,true);
return(n?o:null)
}}
}();
CQ.undo.actions.CreateAnnotationAction=CQ.Ext.extend(CQ.undo.actions.AbstractAction,{annotationPath:null,isAnnotationDeleted:false,params:null,constructor:function(c,b,a,g){if(arguments.length==0){return
}CQ.undo.actions.CreateAnnotationAction.superclass.constructor.call(this,c.path,b);
this.params=g;
this.annotationPath=a.path
},initializePathRewriting:function(){this.idManager.on("paragraph",this.onPathChanged,this);
this.idManager.on("annotation",this.onAnnotationIdChanged,this)
},onPathChanged:function(a,b){if(CQ.undo.util.UndoUtils.isValidForTarget(b,this)){if(this.path==a.oldPath){if(a.deleted){this.isPathDeleted=true
}else{if(this.isPathDeleted){this.path=a.newPath;
this.annotationPath=this.changePath(this.annotationPath,a);
this.isPathDeleted=false
}}}}},onAnnotationIdChanged:function(a,b){if(CQ.undo.util.UndoUtils.isValidForTarget(b,this)){if(this.annotationPath==a.oldPath){if(a.deleted){this.isAnnotationDeleted=true
}else{if(this.isAnnotationDeleted){this.annotationPath=a.newPath;
this.isAnnotationDeleted=false
}}}}},undo:function(a){var b=this.getEditable();
var g=b.getAnnotationAt(this.annotationPath);
if(!g){throw new Error("Could not find annotation at '"+this.annotationPath+"'.")
}var k={};
k[CQ.Sling.OPERATION]=CQ.Sling.OPERATION_DELETE;
var j=g.post(k,true);
if(j){var c={oldPath:this.annotationPath,newPath:null,deleted:true};
this.idManager.fireEvent("annotation",c)
}a.step.notifyActionCompleted(this,j)
},redo:function(b){var c=this.getEditable();
var a=CQ.undo.actions.AnnotationHelpers.recreateFromSnapshot(c,this.params);
if(a!=null){this.idManager.fireEvent("annotation",{newId:a.id,oldPath:this.annotationPath,newPath:a.path})
}b.step.notifyActionCompleted(this,(a!=null))
},addToSelection:function(b,a){},serializeSpecific:function(){return{ap:this.annotationPath,iad:this.isAnnotationDeleted,p:this.params}
},deserializeSpecific:function(a){this.annotationPath=a.ap;
this.isAnnotationDeleted=a.iad;
this.params=a.p
}});
CQ.undo.actions.ActionRegistry.register("createAnnotation",CQ.undo.actions.CreateAnnotationAction);
CQ.undo.actions.UpdateAnnotationAction=CQ.Ext.extend(CQ.undo.actions.AbstractAction,{annotationPath:null,isAnnotationDeleted:false,diffData:null,constructor:function(g,b,a,c){if(arguments.length==0){return
}CQ.undo.actions.UpdateAnnotationAction.superclass.constructor.call(this,g.path,b);
this.diffData=c;
this.annotationPath=a.path
},initializePathRewriting:function(){this.idManager.on("paragraph",this.onPathChanged,this);
this.idManager.on("annotation",this.onAnnotationIdChanged,this)
},onPathChanged:function(a,b){if(CQ.undo.util.UndoUtils.isValidForTarget(b,this)){if(this.path==a.oldPath){if(a.deleted){this.isPathDeleted=true
}else{if(this.isPathDeleted){this.path=a.newPath;
this.annotationPath=this.changePath(this.annotationPath,a);
this.isPathDeleted=false
}}}}},onAnnotationIdChanged:function(a,b){if(CQ.undo.util.UndoUtils.isValidForTarget(b,this)){if(this.annotationPath==a.oldPath){if(a.deleted){this.isAnnotationDeleted=true
}else{if(this.isAnnotationDeleted){this.annotationPath=a.newPath;
this.isAnnotationDeleted=false
}}}}},adjustAnnotation:function(a,g){for(var b in g){if(g.hasOwnProperty(b)){var c=g[b];
if(b=="./text"){a.setText(c)
}else{if(b=="./x"){a.setOffset(parseInt(c),undefined)
}else{if(b=="./y"){a.setOffset(undefined,parseInt(c))
}else{if(b=="./w"){a.setWidth(parseInt(c),true)
}else{if(b=="./h"){a.setHeight(parseInt(c),true)
}else{if(b=="./color"){a.setColor(c)
}else{if(b=="./minimized"){a.setMinimized((c==="true")||(c===true))
}}}}}}}}}},undo:function(c){var g=this.getEditable();
var a=g.getAnnotationAt(this.annotationPath);
if(!a){throw new Error("No annotation found at '"+this.annotationPath+".")
}var b=CQ.undo.util.UndoUtils.createPostData(this.diffData.original,this.diffData.deleted,this.diffData.added,true,true);
var j=a.post(b,true,true);
if(j){this.adjustAnnotation(a,b)
}c.step.notifyActionCompleted(this,j)
},redo:function(c){var g=this.getEditable();
var a=g.getAnnotationAt(this.annotationPath);
if(!a){throw new Error("No annotation found at '"+this.annotationPath+".")
}var b=CQ.undo.util.UndoUtils.createPostData(this.diffData.changed,this.diffData.added,this.diffData.deleted,true,true);
var j=a.post(b,true,true);
if(j){this.adjustAnnotation(a,b)
}c.step.notifyActionCompleted(this,j)
},addToSelection:function(b,a){},serializeSpecific:function(){return{ap:this.annotationPath,iad:this.isAnnotationDeleted,dd:this.diffData}
},deserializeSpecific:function(a){this.annotationPath=a.ap;
this.isAnnotationDeleted=a.iad;
this.diffData=a.dd
}});
CQ.undo.actions.ActionRegistry.register("updateAnnotation",CQ.undo.actions.UpdateAnnotationAction);
CQ.undo.actions.RemoveAnnotationAction=CQ.Ext.extend(CQ.undo.actions.AbstractAction,{annotationPath:null,isAnnotationDeleted:null,removedData:null,constructor:function(c,b,a,g){if(arguments.length==0){return
}CQ.undo.actions.RemoveAnnotationAction.superclass.constructor.call(this,c.path,b);
this.annotationPath=a.path;
this.removedData=g
},initializePathRewriting:function(){this.idManager.on("paragraph",this.onPathChanged,this);
this.idManager.on("annotation",this.onAnnotationIdChanged,this)
},onPathChanged:function(a,b){if(CQ.undo.util.UndoUtils.isValidForTarget(b,this)){if(this.path==a.oldPath){if(a.deleted){this.isPathDeleted=true
}else{if(this.isPathDeleted){this.path=a.newPath;
this.annotationPath=this.changePath(this.annotationPath,a);
this.isPathDeleted=false
}}}}},onAnnotationIdChanged:function(a,b){if(CQ.undo.util.UndoUtils.isValidForTarget(b,this)){if(this.annotationPath==a.oldPath){if(a.deleted){this.isAnnotationDeleted=true
}else{if(this.isAnnotationDeleted){this.annotationPath=a.newPath;
this.isAnnotationDeleted=false
}}}}},undo:function(b){var c=this.getEditable();
var a=CQ.undo.actions.AnnotationHelpers.recreateFromSnapshot(c,this.removedData);
if(a){this.idManager.fireEvent("annotation",{oldPath:this.annotationPath,newPath:a.path})
}b.step.notifyActionCompleted(this,(a!=null))
},redo:function(a){var b=this.getEditable();
var g=b.getAnnotationAt(this.annotationPath);
if(!g){throw new Error("Could not find annotation at '"+this.annotationPath+"'.")
}var k={};
k[CQ.Sling.OPERATION]=CQ.Sling.OPERATION_DELETE;
var j=g.post(k,true);
if(j){var c={oldPath:this.annotationPath,newPath:null,deleted:true};
this.idManager.fireEvent("annotation",c)
}a.step.notifyActionCompleted(this,j)
},notifyStepCommitted:function(){var a={oldPath:this.annotationPath,newPath:null,deleted:true};
this.idManager.fireEvent("annotation",a)
},addToSelection:function(b,a){},serializeSpecific:function(){return{ap:this.annotationPath,iad:this.isAnnotationDeleted,rd:this.removedData}
},deserializeSpecific:function(a){this.annotationPath=a.ap;
this.isAnnotationDeleted=a.iad;
this.removedData=a.rd
}});
CQ.undo.actions.ActionRegistry.register("removeAnnotation",CQ.undo.actions.RemoveAnnotationAction);
CQ.undo.actions.CreateSketchAction=CQ.Ext.extend(CQ.undo.actions.AbstractAction,{sketchPath:null,isSketchDeleted:false,annotationPath:null,isAnnotationDeleted:false,params:null,constructor:function(b,a,g,c){if(arguments.length==0){return
}CQ.undo.actions.CreateAnnotationAction.superclass.constructor.call(this,b.path,a);
this.params=c;
this.sketchPath=g.path;
this.annotationPath=g.annotation.path
},initializePathRewriting:function(){this.idManager.on("paragraph",this.onPathChanged,this);
this.idManager.on("annotation",this.onAnnotationIdChanged,this);
this.idManager.on("sketch",this.onSketchIdChanged,this)
},onPathChanged:function(a,b){if(CQ.undo.util.UndoUtils.isValidForTarget(b,this)){if(this.path==a.oldPath){if(a.deleted){this.isPathDeleted=true
}else{if(this.isPathDeleted){this.path=a.newPath;
this.annotationPath=this.changePath(this.annotationPath,a);
this.sketchPath=this.changePath(this.sketchPath,a);
this.isPathDeleted=false
}}}}},onAnnotationIdChanged:function(a,b){if(CQ.undo.util.UndoUtils.isValidForTarget(b,this)){if(this.annotationPath==a.oldPath){if(a.deleted){this.isAnnotationDeleted=true
}else{if(this.isAnnotationDeleted){this.annotationPath=a.newPath;
this.sketchPath=this.changePath(this.sketchPath,a);
this.isAnnotationDeleted=false
}}}}},onSketchIdChanged:function(a,b){if(CQ.undo.util.UndoUtils.isValidForTarget(b,this)){if(this.sketchPath==a.oldPath){if(a.deleted){this.isSketchDeleted=true
}else{if(this.isSketchDeleted){this.sketchPath=a.newPath;
this.isSketchDeleted=false
}}}}},undo:function(b){var c=this.getEditable();
var a=c.getAnnotationAt(this.annotationPath);
var j=(a?a.getSketchAt(this.sketchPath):null);
if(!j){throw new Error("Could not find sketch at '"+this.sketchPath+"' for annotation '"+this.annotationPath+"'.")
}var m={};
m[CQ.Sling.OPERATION]=CQ.Sling.OPERATION_DELETE;
var k=j.post(m,true);
if(k){var g={oldPath:this.sketchPath,newPath:null,deleted:true};
this.idManager.fireEvent("sketch",g)
}b.step.notifyActionCompleted(this,k)
},redo:function(b){var c=this.getEditable();
var a=c.getAnnotationAt(this.annotationPath);
if(!a){throw new Error("Annotation '"+this.annotationPath+"' not found.")
}var g=CQ.undo.actions.AnnotationHelpers.recreateSketchFromSnapshot(a,this.params);
if(g){this.idManager.fireEvent("sketch",{newId:g.id,oldPath:this.sketchPath,newPath:g.path})
}b.step.notifyActionCompleted(this,(g!=null))
},addToSelection:function(b,a){},serializeSpecific:function(){return{sp:this.sketchPath,isd:this.isSketchDeleted,ap:this.annotationPath,iad:this.isAnnotationDeleted,p:this.params}
},deserializeSpecific:function(a){this.sketchPath=a.sp;
this.isSketchDeleted=a.isd;
this.annotationPath=a.ap;
this.isAnnotationDeleted=a.iad;
this.params=a.p
}});
CQ.undo.actions.ActionRegistry.register("createSketch",CQ.undo.actions.CreateSketchAction);
CQ.undo.actions.UpdateSketchAction=CQ.Ext.extend(CQ.undo.actions.AbstractAction,{sketchPath:null,isSketchDeleted:false,annotationPath:null,isAnnotationDeleted:null,diffData:null,constructor:function(c,a,g,b){if(arguments.length==0){return
}CQ.undo.actions.UpdateSketchAction.superclass.constructor.call(this,c.path,a);
this.diffData=b;
this.sketchPath=g.path;
this.annotationPath=g.annotation.path
},initializePathRewriting:function(){this.idManager.on("paragraph",this.onPathChanged,this);
this.idManager.on("annotation",this.onAnnotationIdChanged,this);
this.idManager.on("sketch",this.onSketchIdChanged,this)
},onPathChanged:function(a,b){if(CQ.undo.util.UndoUtils.isValidForTarget(b,this)){if(this.path==a.oldPath){if(a.deleted){this.isPathDeleted=true
}else{if(this.isPathDeleted){this.path=a.newPath;
this.annotationPath=this.changePath(this.annotationPath,a);
this.sketchPath=this.changePath(this.sketchPath,a);
this.isPathDeleted=false
}}}}},onAnnotationIdChanged:function(a,b){if(CQ.undo.util.UndoUtils.isValidForTarget(b,this)){if(this.annotationPath==a.oldPath){if(a.deleted){this.isAnnotationDeleted=true
}else{if(this.isAnnotationDeleted){this.annotationPath=a.newPath;
this.sketchPath=this.changePath(this.sketchPath,a);
this.isAnnotationDeleted=false
}}}}},onSketchIdChanged:function(a,b){if(CQ.undo.util.UndoUtils.isValidForTarget(b,this)){if(this.sketchPath==a.oldPath){if(a.deleted){this.isSketchDeleted=true
}else{if(this.isSketchDeleted){this.sketchPath=a.newPath;
this.isSketchDeleted=false
}}}}},adjustSketch:function(g,c){for(var a in c){if(c.hasOwnProperty(a)){var b=c[a];
if(a=="./x"){g.setOffset(parseInt(b),undefined)
}else{if(a=="./y"){g.setOffset(undefined,parseInt(b))
}else{if(a=="./w"){g.setWidth(parseInt(b),true)
}else{if(a=="./h"){g.setHeight(parseInt(b),true)
}}}}}}},undo:function(c){var g=this.getEditable();
var a=g.getAnnotationAt(this.annotationPath);
var k=(a?a.getSketchAt(this.sketchPath):null);
if(!k){throw new Error("Could not find sketch at '"+this.sketchPath+"' for annotation '"+this.annotationPath+"'.")
}var b=CQ.undo.util.UndoUtils.createPostData(this.diffData.original,this.diffData.deleted,this.diffData.added);
var j=k.post(b,true,true);
if(j){this.adjustSketch(k,b)
}c.step.notifyActionCompleted(this,j)
},redo:function(c){var g=this.getEditable();
var a=g.getAnnotationAt(this.annotationPath);
var k=(a?a.getSketchAt(this.sketchPath):null);
if(!k){throw new Error("Could not find sketch at '"+this.sketchPath+"' for annotation '"+this.annotationPath+"'.")
}var b=CQ.undo.util.UndoUtils.createPostData(this.diffData.changed,this.diffData.added,this.diffData.deleted);
var j=k.post(b,true,true);
if(j){this.adjustSketch(k,b)
}c.step.notifyActionCompleted(this,j)
},addToSelection:function(b,a){},serializeSpecific:function(){return{sp:this.sketchPath,isd:this.isSketchDeleted,ap:this.annotationPath,iad:this.isAnnotationDeleted,dd:this.diffData}
},deserializeSpecific:function(a){this.sketchPath=a.sp;
this.isSketchDeleted=a.isd;
this.annotationPath=a.ap;
this.isAnnotationDeleted=a.iad;
this.diffData=a.dd
}});
CQ.undo.actions.ActionRegistry.register("updateSketch",CQ.undo.actions.UpdateSketchAction);
CQ.undo.actions.RemoveSketchAction=CQ.Ext.extend(CQ.undo.actions.AbstractAction,{sketchPath:null,isSketchDeleted:false,annotationPath:null,isAnnotationDeleted:null,removedData:null,constructor:function(b,a,g,c){if(arguments.length==0){return
}CQ.undo.actions.RemoveSketchAction.superclass.constructor.call(this,b.path,a);
this.removedData=c;
this.sketchPath=g.path;
this.annotationPath=g.annotation.path
},initializePathRewriting:function(){this.idManager.on("paragraph",this.onPathChanged,this);
this.idManager.on("annotation",this.onAnnotationIdChanged,this);
this.idManager.on("sketch",this.onSketchIdChanged,this)
},onPathChanged:function(a,b){if(CQ.undo.util.UndoUtils.isValidForTarget(b,this)){if(this.path==a.oldPath){if(a.deleted){this.isPathDeleted=true
}else{if(this.isPathDeleted){this.path=a.newPath;
this.annotationPath=this.changePath(this.annotationPath,a);
this.sketchPath=this.changePath(this.sketchPath,a);
this.isPathDeleted=false
}}}}},onAnnotationIdChanged:function(a,b){if(CQ.undo.util.UndoUtils.isValidForTarget(b,this)){if(this.annotationPath==a.oldPath){if(a.deleted){this.isAnnotationDeleted=true
}else{if(this.isAnnotationDeleted){this.annotationPath=a.newPath;
this.isAnnotationDeleted=false
}}}}},onSketchIdChanged:function(a,b){if(CQ.undo.util.UndoUtils.isValidForTarget(b,this)){if(this.sketchPath==a.oldPath){if(a.deleted){this.isSketchDeleted=true
}else{if(this.isSketchDeleted){this.sketchPath=a.newPath;
this.isSketchDeleted=false
}}}}},undo:function(b){var c=this.getEditable();
var a=c.getAnnotationAt(this.annotationPath);
if(!a){throw new Error("Annotation '"+this.annotationPath+"' not found.")
}var g=CQ.undo.actions.AnnotationHelpers.recreateSketchFromSnapshot(a,this.removedData);
if(g){this.idManager.fireEvent("sketch",{oldPath:this.sketchPath,newPath:g.path})
}b.step.notifyActionCompleted(this,(g!=null))
},redo:function(b){var c=this.getEditable();
var a=c.getAnnotationAt(this.annotationPath);
var j=(a?a.getSketchAt(this.sketchPath):null);
if(!j){console.log("No sketch @"+this.sketchPath+"/"+this.annotationPath);
throw new Error("Could not find sketch at '"+this.sketchPath+"' for annotation '"+this.annotationPath+"'.")
}var m={};
m[CQ.Sling.OPERATION]=CQ.Sling.OPERATION_DELETE;
var k=j.post(m,true);
if(k){var g={oldPath:this.sketchPath,newPath:null,deleted:true};
this.idManager.fireEvent("sketch",g)
}b.step.notifyActionCompleted(this,k)
},notifyStepCommitted:function(){var a={oldPath:this.sketchPath,newPath:null,deleted:true};
this.idManager.fireEvent("sketch",a)
},addToSelection:function(b,a){},serializeSpecific:function(){return{sp:this.sketchPath,isd:this.isSketchDeleted,ap:this.annotationPath,iad:this.isAnnotationDeleted,rd:this.removedData}
},deserializeSpecific:function(a){this.sketchPath=a.sp;
this.isSketchDeleted=a.isd;
this.annotationPath=a.ap;
this.isAnnotationDeleted=a.iad;
this.removedData=a.rd
}});
CQ.undo.actions.ActionRegistry.register("removeSketch",CQ.undo.actions.RemoveSketchAction);
CQ.undo.actions.CannotUndoAction=CQ.Ext.extend(CQ.undo.UndoAction,{undoMessage:null,redoMessage:null,constructor:function(b,a){this.undoMessage=b;
this.redoMessage=a
},undo:function(a){if(this.undoMessage!=null){CQ.Ext.MessageBox.alert(CQ.I18n.getMessage("Undo"),this.undoMessage)
}a.step.notifyActionCompleted(this,true)
},redo:function(a){if(this.redoMessage!=null){CQ.Ext.MessageBox.alert(CQ.I18n.getMessage("Redo"),this.redoMessage)
}a.step.notifyActionCompleted(this,true)
},notifyStepCommitted:function(){},notifyStepCompleted:function(a,b){},addToSelection:function(b,a){},serialize:function(){return{t:CQ.undo.actions.ActionRegistry.determineType(this),u:this.undoMessage,r:this.redoMessage}
},deserialize:function(a){this.undoMessage=a.u;
this.redoMessage=a.r
}});
CQ.undo.actions.ActionRegistry.register("cannotUndo",CQ.undo.actions.CannotUndoAction);
CQ.User=function(g){this.data=CQ.shared.User.init(g);
if(this.data){if(this.data.preferences){this.preferencesProvider=new CQ.state.PreferencesProvider({data:this.data.preferences,id:CQ.User.PREFERENCES_PROVIDER_ID})
}var j=new Object();
var a=new Array();
if(this.data.permissions){var b=this.data.permissions;
var c=0;
for(var k in b){j[c++]=k;
a.push(k)
}}this.permissionStore=new CQ.Ext.data.SimpleStore({id:0,data:[j],fields:a,autoLoad:false})
}else{this.data={}
}};
CQ.User.prototype=function(){return{data:null,language:null,preferencesProvider:null,userPropsPath:null,permissionStore:null,isImpersonated:function(){return this.data.impersonated
},isImperonated:function(){return this.isImpersonated()
},getUserID:function(){return this.data.userID
},getAuthType:function(){return null
},getUserName:function(a){return a&&this.data[CQ.shared.XSS.getXSSPropertyName("userName")]?this.data[CQ.shared.XSS.getXSSPropertyName("userName")]:this.data.userName
},getHome:function(){return CQ.HTTP.encodePath(this.data.home)
},getLanguage:function(){if(!this.language&&this.preferencesProvider){var a=this.preferencesProvider.get(CQ.User.LANGUAGE);
if(!a){a=this.preferencesProvider.get(CQ.User.PLATFORM_LANGUAGE)
}this.language=a||"en"
}return this.language
},getLocale:function(){return CQ.WCM.parseLocale(this.getLanguage())
},getAllowedApps:function(){return this.data.allowedApps
},getPreference:function(a){return this.preferencesProvider?this.preferencesProvider.get(a):null
},hasPermission:function(a){return this.hasPermissionOn(a)
},hasPermissionOn:function(a,c){var b=CQ.Ext.StoreMgr.lookup(CQ.User.PRIVILEGES_STORE_ID);
if(!b){b=this.permissionStore
}if(!c){c="/"
}var g=b.getById(c);
return g!=undefined&&g&&g.get(a)
},sudoAs:function(a){this.postImpersonation(a)
},revertSelf:function(){this.postImpersonation("-")
},login:function(a){CQ.User.login(null,a)
},getUserPropsUrl:function(){if(!this.userPropsPath){this.userPropsPath=CQ.shared.User.PROXY_URI
}return this.userPropsPath
},postImpersonation:function(b){var c=this.getHome()+".impersonate"+CQ.HTTP.EXTENSION_JSON;
c=CQ.HTTP.addParameter(c,"impersonate",b);
var a=CQ.Ext.getDoc().dom.URL;
c=CQ.HTTP.addParameter(c,"path",CQ.HTTP.getPath(a));
c=CQ.HTTP.noCaching(CQ.HTTP.externalize(c)+CQ.HTTP.EXTENSION_HTML);
CQ.shared.Util.reload(document,c)
},setPermissionStore:function(a){this.permissionStore=a
},getPath:function(a){var b=a.replace(/.*\:[\/][\/]/,"");
b=b.substring(b.indexOf("/"));
if(b.indexOf("?")>=0){b=b.substring(0,b.indexOf("?"))
}if(b.indexOf("#")>=0){b=b.substring(0,b.indexOf("#"))
}if(b.indexOf(".")>-1){b=b.substring(0,b.indexOf("."))
}return b
}}
}();
CQ.User.getCurrentUser=function(){var a=CQ.WCM.getTopWindow();
if(!a.CQ_User){a.CQ_User=new CQ.User()
}return a.CQ_User
};
CQ.User.getUserID=function(){return CQ.User.getCurrentUser().getUserID()
};
CQ.User.getUserName=function(a){return CQ.User.getCurrentUser().getUserName(a)
};
CQ.User.PREFERENCES_PROVIDER_ID="cq-security-preferences-provider";
CQ.User.PRIVILEGES_STORE_ID="cq-security-privileges-store";
CQ.User.PERMISSION_UPDATE="update";
CQ.User.ADMIN="admin";
CQ.User.ANONYMOUS="anonymous";
CQ.User.LANGUAGE="language";
CQ.User.PLATFORM_LANGUAGE="platform/language";
CQ.User.LOGIN_SERVLET_URL=CQ.Sling.LOGIN_URL;
CQ.User.TOKEN_LOGIN_SERVLET_URL=CQ.Sling.LOGIN_URL;
CQ.User.LOGOUT_URL=CQ.Sling.LOGOUT_URL;
CQ.User.login=function(c,m){var a=CQ.HTTP.externalize(CQ.Sling.LOGIN_URL);
var g=CQ.HTTP.addParameter(a,"resource",CQ.utils.WCM.getPagePath()||"/");
if(navigator.userAgent.indexOf("MSIE")>0||navigator.userAgent.indexOf("Firefox")>0){var k;
if(window.XMLHttpRequest){k=new XMLHttpRequest()
}else{if(window.ActiveXObject){try{k=new ActiveXObject("Msxml2.XMLHTTP")
}catch(j){k=new ActiveXObject("Microsoft.XMLHTTP")
}}}if(k.readyState<4){k.abort()
}if(!c){c=CQ.User.getCurrentUser().getUserID()
}k.open("POST",g,false,c,m);
k.send("");
return k.status==200
}else{var b=CQ.HTTP.post(g,callback,{_charset_:"utf-8",resource:CQ.utils.WCM.getPagePath(),j_username:c.getUserID(),j_password:m});
return CQ.HTTP.isOk(b)
}};
CQ.User.logout=function(){if(CQ.shared.ClientSidePersistence){CQ.shared.ClientSidePersistence.clearAllMaps()
}CQ.Util.reload(null,CQ.HTTP.externalize(CQ.Sling.LOGOUT_URL))
};
CQ.utils.User=CQ.User;
if(!CQ.Ext.QuickTips.isEnabled()){CQ.Ext.QuickTips.init(false)
}CQ.Ext.state.Manager.setProvider(new CQ.Ext.state.CookieProvider({path:document.location.pathname.substring(0,document.location.pathname.lastIndexOf("/"))}));
CQ.Ext.BLANK_IMAGE_URL=CQ.shared.HTTP.getXhrHookedURL(CQ.HTTP.externalize("/libs/cq/ui/resources/0.gif"));
CQ.Ext.SSL_SECURE_URL=CQ.shared.HTTP.getXhrHookedURL(CQ.HTTP.externalize("/libs/cq/ui/resources/0.html"));
CQ.I18n.init({locale:function(){return CQ.User.getCurrentUser().getLanguage()
}});
CQ.WindowEventManager.addListener("beforeunload",function(){CQ.WCM.deselect()
});
CQ.WindowEventManager.addListener("unload",function(){CQ.WCM.setContentWindowLoading(true);
try{var b=CQ.WCM.getContentFinder().contentWindow;
if(CQ.WCM.isContentWindow()){if(b){b.onscroll=null;
b.CQ_Selection=null
}}if(window==CQ.WCM.getTopWindow()){if(b){b.onscroll=null;
b.CQ_Selection=null
}CQ.WCM.getContentFinder().contentWindow=null
}}catch(a){}if(CQ.Ext.isIE&&!CQ.Ext.isIE8){window.console=null
}window.CQ_Selection=null;
window.CQ_inplaceEditDialog=null;
window.CQ_Clipboard=null;
window.jQuery=null;
window.$=null;
window.$CQ=null;
window.CQ_Analytics=null;
window.CQ_Analytics=null
});
CQ.WCM.setContentWindowLoading(true);
if(CQ.WCM.isContentWindow()){CQ.Ext.onLoad(function(){CQ.WCM.setContentWindowLoading(false)
})
}CQ.WCM.observeKeypress();
if(CQ.HEARTBEAT_INTERVAL!=0){window.setInterval(function(){CQ.shared.HTTP.get(CQ.shared.HTTP.noCaching(CQ.HEARTBEAT_URL),undefined,undefined,true)
},CQ.HEARTBEAT_INTERVAL)
}CQ.Ext.UpdateManager.defaults.indicatorText='<div class="loading-indicator">'+CQ.I18n.getMessage("Loading...")+"</div>";
if(CQ.Ext.View){CQ.Ext.View.prototype.emptyText=""
}if(CQ.Ext.grid.Grid){CQ.Ext.grid.Grid.prototype.ddText=CQ.I18n.getMessage("{0} selected row(s)")
}if(CQ.Ext.TabPanelItem){CQ.Ext.TabPanelItem.prototype.closeText=CQ.I18n.getMessage("Close this tab")
}if(CQ.Ext.data.Types){CQ.Ext.data.Types.stripRe=/[\$,%]/g
}if(CQ.Ext.DataView){CQ.Ext.DataView.prototype.emptyText=""
}if(CQ.Ext.grid.GridPanel){CQ.Ext.grid.GridPanel.prototype.ddText=CQ.I18n.getMessage("{0} selected row{1}")
}if(CQ.Ext.LoadMask){CQ.Ext.LoadMask.prototype.msg=CQ.I18n.getMessage("Loading...")
}Date.monthNames=[CQ.I18n.getMessage("January"),CQ.I18n.getMessage("February"),CQ.I18n.getMessage("March"),CQ.I18n.getMessage("April"),CQ.I18n.getMessage("May"),CQ.I18n.getMessage("June"),CQ.I18n.getMessage("July"),CQ.I18n.getMessage("August"),CQ.I18n.getMessage("September"),CQ.I18n.getMessage("October"),CQ.I18n.getMessage("November"),CQ.I18n.getMessage("December")];
Date.shortMonthNames=[CQ.I18n.getMessage("Jan",null,"January short name"),CQ.I18n.getMessage("Feb",null,"February short name"),CQ.I18n.getMessage("Mar",null,"March short name"),CQ.I18n.getMessage("Apr",null,"April short name"),CQ.I18n.getMessage("May",null,"May short name"),CQ.I18n.getMessage("Jun",null,"June short name"),CQ.I18n.getMessage("Jul",null,"July short name"),CQ.I18n.getMessage("Aug",null,"August short name"),CQ.I18n.getMessage("Sep",null,"September short name"),CQ.I18n.getMessage("Oct",null,"October short name"),CQ.I18n.getMessage("Nov",null,"November short name"),CQ.I18n.getMessage("Dec",null,"December short name")];
Date.getShortMonthName=function(a){return Date.shortMonthNames[a]
};
Date.monthNumbers={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11};
Date.getMonthNumber=function(a){return Date.monthNumbers[a.substring(0,1).toUpperCase()+a.substring(1,3).toLowerCase()]
};
Date.dayNames=[CQ.I18n.getMessage("Sunday"),CQ.I18n.getMessage("Monday"),CQ.I18n.getMessage("Tuesday"),CQ.I18n.getMessage("Wednesday"),CQ.I18n.getMessage("Thursday"),CQ.I18n.getMessage("Friday"),CQ.I18n.getMessage("Saturday")];
Date.getShortDayName=function(a){return Date.dayNames[a].substring(0,3)
};
Date.parseCodes.S.s=CQ.I18n.getMessage("(?:st|nd|rd|th)",null,"Regex to parse numeric suffices (like 1st, 2nd, etc.)");
if(CQ.Ext.MessageBox){CQ.Ext.MessageBox.buttonText={ok:CQ.I18n.getMessage("OK"),cancel:CQ.I18n.getMessage("Cancel"),yes:CQ.I18n.getMessage("Yes"),no:CQ.I18n.getMessage("No")}
}if(CQ.Ext.util.Format){CQ.Ext.util.Format.date=function(a,b){if(!a){return""
}if(!(a instanceof Date)){a=new Date(Date.parse(a))
}return a.dateFormat(b||CQ.I18n.getMessage("m/d/Y",null,"General date format for ExtJS (http://extjs.com/deploy/ext/docs/output/Date.html)"))
}
}if(CQ.Ext.DatePicker){CQ.Ext.apply(CQ.Ext.DatePicker.prototype,{todayText:CQ.I18n.getMessage("Today"),minText:CQ.I18n.getMessage("This date is before the minimum date"),maxText:CQ.I18n.getMessage("This date is after the maximum date"),disabledDaysText:"",disabledDatesText:"",monthNames:Date.monthNames,dayNames:Date.dayNames,nextText:CQ.I18n.getMessage("Next Month (Control+Right)"),prevText:CQ.I18n.getMessage("Previous Month (Control+Left)"),monthYearText:CQ.I18n.getMessage("Choose a month (Control+Up/Down to move years)"),todayTip:CQ.I18n.getMessage("{0} (Spacebar)"),format:CQ.I18n.getMessage("m/d/y",null,"Date format for ExtJS DatePicker (short, eg. two-digit year, http://extjs.com/deploy/ext/docs/output/Date.html)"),okText:CQ.I18n.getMessage("&#160;OK&#160;"),cancelText:CQ.I18n.getMessage("Cancel"),startDay:Number(CQ.I18n.getMessage("0",null,"Start day for week view in calendar (0=Sunday, 1=Monday, etc.)"))})
}if(CQ.Ext.PagingToolbar){CQ.Ext.apply(CQ.Ext.PagingToolbar.prototype,{beforePageText:CQ.I18n.getMessage("Page"),afterPageText:CQ.I18n.getMessage("of {0}"),firstText:CQ.I18n.getMessage("First Page"),prevText:CQ.I18n.getMessage("Previous Page"),nextText:CQ.I18n.getMessage("Next Page"),lastText:CQ.I18n.getMessage("Last Page"),refreshText:CQ.I18n.getMessage("Refresh"),displayMsg:CQ.I18n.getMessage("Displaying {0} - {1} of {2}"),emptyMsg:CQ.I18n.getMessage("No data to display")})
}if(CQ.Ext.form.BasicForm){CQ.Ext.form.BasicForm.prototype.waitTitle=CQ.I18n.getMessage("Please wait...")
}if(CQ.Ext.form.Field){CQ.Ext.form.Field.prototype.invalidText=CQ.I18n.getMessage("The value in this field is invalid")
}if(CQ.Ext.form.TextField){CQ.Ext.apply(CQ.Ext.form.TextField.prototype,{minLengthText:CQ.I18n.getMessage("The minimum length for this field is {0}"),maxLengthText:CQ.I18n.getMessage("The maximum length for this field is {0}"),blankText:CQ.I18n.getMessage("This field is required"),regexText:"",emptyText:null})
}if(CQ.Ext.form.NumberField){CQ.Ext.apply(CQ.Ext.form.NumberField.prototype,{decimalSeparator:CQ.I18n.getMessage(".",null,"Decimal separator for NumberField"),decimalPrecision:2,minText:CQ.I18n.getMessage("The minimum value for this field is {0}"),maxText:CQ.I18n.getMessage("The maximum value for this field is {0}"),nanText:CQ.I18n.getMessage("{0} is not a valid number")})
}if(CQ.Ext.form.DateField){CQ.Ext.apply(CQ.Ext.form.DateField.prototype,{disabledDaysText:CQ.I18n.getMessage("Disabled"),disabledDatesText:CQ.I18n.getMessage("Disabled"),minText:CQ.I18n.getMessage("The date in this field must be after {0}"),maxText:CQ.I18n.getMessage("The date in this field must be before {0}"),invalidText:CQ.I18n.getMessage("{0} is not a valid date - it must be in the format {1}"),format:CQ.I18n.getMessage("m/d/y",null,"Date format for ExtJS DateField (short, eg. two-digit year, http://extjs.com/deploy/ext/docs/output/Date.html)"),altFormats:CQ.I18n.getMessage("m/d/Y|m-d-y|m-d-Y|m/d|m-d|md|mdy|mdY|d|Y-m-d",null,"Date formats to try when parsing input from ExtJS DateField, in order (http://extjs.com/deploy/ext/docs/output/Date.html)"),startDay:Number(CQ.I18n.getMessage("0",null,"Start day for week view in date field (0=Sunday, 1=Monday, etc.)"))})
}if(CQ.Ext.form.ComboBox){CQ.Ext.apply(CQ.Ext.form.ComboBox.prototype,{loadingText:CQ.I18n.getMessage("Loading..."),valueNotFoundText:undefined})
}if(CQ.Ext.form.VTypes){CQ.Ext.apply(CQ.Ext.form.VTypes,{emailText:CQ.I18n.getMessage('This field should be an e-mail address in the format "user@domain.com"'),urlText:CQ.I18n.getMessage('This field should be a URL in the format "http://www.domain.com"'),alphaText:CQ.I18n.getMessage("This field should only contain letters and _"),alphanumText:CQ.I18n.getMessage("This field should only contain letters, numbers and _"),nameText:CQ.I18n.getMessage("The name must not contain<br><br>/ : [ ] * |<br><br>nor must it start with a space or a period<br>nor end with a space."),itemnameText:CQ.I18n.getMessage("This field should only contain numbers, letters, dashes and underscores"),percentText:CQ.I18n.getMessage("This field should only contain a percentage in the format '50%'"),digitsText:CQ.I18n.getMessage("This field should only contain numbers"),requiredOnLinkedDataText:CQ.I18n.getMessage("This field must not be empty when data in the linked field is available."),authorizableIdText:CQ.I18n.getMessage('This field should only contain lowercase letters, numbers, ".", "-", "_" and "@".')})
}if(CQ.Ext.form.HtmlEditor){CQ.Ext.apply(CQ.Ext.form.HtmlEditor.prototype,{createLinkText:CQ.I18n.getMessage("Please enter the URL for the link:"),buttonTips:{bold:{title:CQ.I18n.getMessage("Bold (Ctrl+B)"),text:CQ.I18n.getMessage("Make the selected text bold."),cls:"x-html-editor-tip"},italic:{title:CQ.I18n.getMessage("Italic (Ctrl+I)"),text:CQ.I18n.getMessage("Make the selected text italic."),cls:"x-html-editor-tip"},underline:{title:CQ.I18n.getMessage("Underline (Ctrl+U)"),text:CQ.I18n.getMessage("Underline the selected text."),cls:"x-html-editor-tip"},increasefontsize:{title:CQ.I18n.getMessage("Grow Text"),text:CQ.I18n.getMessage("Increase the font size."),cls:"x-html-editor-tip"},decreasefontsize:{title:CQ.I18n.getMessage("Shrink Text"),text:CQ.I18n.getMessage("Decrease the font size."),cls:"x-html-editor-tip"},backcolor:{title:CQ.I18n.getMessage("Text Highlight Color"),text:CQ.I18n.getMessage("Change the background color of the selected text."),cls:"x-html-editor-tip"},forecolor:{title:CQ.I18n.getMessage("Font Color"),text:CQ.I18n.getMessage("Change the color of the selected text."),cls:"x-html-editor-tip"},justifyleft:{title:CQ.I18n.getMessage("Align Text Left"),text:CQ.I18n.getMessage("Align text to the left."),cls:"x-html-editor-tip"},justifycenter:{title:CQ.I18n.getMessage("Center Text"),text:CQ.I18n.getMessage("Center text in the editor."),cls:"x-html-editor-tip"},justifyright:{title:CQ.I18n.getMessage("Align Text Right"),text:CQ.I18n.getMessage("Align text to the right."),cls:"x-html-editor-tip"},insertunorderedlist:{title:CQ.I18n.getMessage("Bullet List"),text:CQ.I18n.getMessage("Start a bulleted list."),cls:"x-html-editor-tip"},insertorderedlist:{title:CQ.I18n.getMessage("Numbered List"),text:CQ.I18n.getMessage("Start a numbered list."),cls:"x-html-editor-tip"},createlink:{title:CQ.I18n.getMessage("Hyperlink"),text:CQ.I18n.getMessage("Make the selected text a hyperlink."),cls:"x-html-editor-tip"},sourceedit:{title:CQ.I18n.getMessage("Source Edit"),text:CQ.I18n.getMessage("Switch to source editing mode."),cls:"x-html-editor-tip"}}})
}if(CQ.Ext.grid.GridView){CQ.Ext.apply(CQ.Ext.grid.GridView.prototype,{sortAscText:CQ.I18n.getMessage("Sort Ascending"),sortDescText:CQ.I18n.getMessage("Sort Descending"),lockText:CQ.I18n.getMessage("Lock Column"),unlockText:CQ.I18n.getMessage("Unlock Column"),columnsText:CQ.I18n.getMessage("Columns")})
}if(CQ.Ext.grid.GroupingView){CQ.Ext.apply(CQ.Ext.grid.GroupingView.prototype,{emptyGroupText:CQ.I18n.getMessage("(None)"),groupByText:CQ.I18n.getMessage("Group By This Field"),showGroupsText:CQ.I18n.getMessage("Show in Groups")})
}if(CQ.Ext.grid.PropertyColumnModel){CQ.Ext.apply(CQ.Ext.grid.PropertyColumnModel.prototype,{nameText:CQ.I18n.getMessage("Name"),valueText:CQ.I18n.getMessage("Value"),dateFormat:CQ.I18n.getMessage("m/j/Y",null,"Date format for ExtJS grid columns (http://extjs.com/deploy/ext/docs/output/Date.html)"),trueText:CQ.I18n.getMessage("true"),falseText:CQ.I18n.getMessage("false")})
}if(CQ.Ext.grid.BooleanColumn){CQ.Ext.apply(CQ.Ext.grid.BooleanColumn.prototype,{trueText:CQ.I18n.getMessage("true"),falseText:CQ.I18n.getMessage("false"),undefinedText:"&#160;"})
}if(CQ.Ext.grid.NumberColumn){CQ.Ext.apply(CQ.Ext.grid.NumberColumn.prototype,{format:CQ.I18n.getMessage("0,000.00",null,"Number format for ExtJS number columns")})
}if(CQ.Ext.grid.DateColumn){CQ.Ext.apply(CQ.Ext.grid.DateColumn.prototype,{format:CQ.I18n.getMessage("m/d/Y",null,"Date format for ExtJS date columns (http://extjs.com/deploy/ext/docs/output/Date.html)")})
}if(CQ.Ext.layout.BorderLayout&&CQ.Ext.layout.BorderLayout.SplitRegion){CQ.Ext.apply(CQ.Ext.layout.BorderLayout.SplitRegion.prototype,{splitTip:CQ.I18n.getMessage("Drag to resize."),collapsibleSplitTip:CQ.I18n.getMessage("Drag to resize. Double click to hide.")})
}if(CQ.Ext.form.TimeField){CQ.Ext.apply(CQ.Ext.form.TimeField.prototype,{minText:CQ.I18n.getMessage("The time in this field must be equal to or after {0}"),maxText:CQ.I18n.getMessage("The time in this field must be equal to or before {0}"),invalidText:CQ.I18n.getMessage("{0} is not a valid time"),format:CQ.I18n.getMessage("g:i A",null,"Time format for ExtJS TimeField (http://extjs.com/deploy/ext/docs/output/Date.html)"),altFormats:CQ.I18n.getMessage("g:ia|g:iA|g:i a|g:i A|h:i|g:i|H:i|ga|ha|gA|h a|g a|g A|gi|hi|gia|hia|g|H",null,"Alternative time formats for ExtJS TimeField (http://extjs.com/deploy/ext/docs/output/Date.html)")})
}if(CQ.Ext.form.CheckboxGroup){CQ.Ext.apply(CQ.Ext.form.CheckboxGroup.prototype,{blankText:"You must select at least one item in this group"})
}if(CQ.Ext.form.RadioGroup){CQ.Ext.apply(CQ.Ext.form.RadioGroup.prototype,{blankText:"You must select one item in this group"})
}if(CQ.I18n&&CQ.Ext.DatePicker){if((CQ.I18n.getLocale().toLowerCase()==="zh-cn")||(CQ.I18n.getLocale().toLowerCase()==="zh-tw")){CQ.Ext.apply(CQ.Ext.DatePicker.prototype,{dayNames:["","","","","","",""]})
}}CQ.PrivilegedAction=CQ.Ext.extend(CQ.Ext.Action,{privileges:null,conditions:null,path:null,isChecked:false,allowed:false,constructor:function(a){CQ.Ext.applyIf(a,{path:"/",disabled:false});
this.privileges=a.privileges;
this.conditions=a.conditions;
CQ.PrivilegedAction.superclass.constructor.call(this,a);
this.path=this.initialConfig.path
},setPath:function(a,c){var b=c?false:a==this.path;
this.isChecked=false;
this.path=a;
this.setDisabled(!this.isAllowed(b))
},isDisabled:function(){return this.initialConfig.disabled||!this.isAllowed()
},enable:function(){this.setDisabled(!this.isAllowed())
},addComponent:function(a){a.disabled=this.isDisabled();
CQ.PrivilegedAction.superclass.addComponent.call(this,a)
},isAllowed:function(a){if(this.isChecked){return this.allowed
}if(this.path==null){return false
}this.conditionsAllowed=this.checkConditions();
if(!a){this.permissionsAllowed=this.hasPermission()
}this.allowed=this.conditionsAllowed&&this.permissionsAllowed;
this.isChecked=true;
return this.allowed
},hasPermission:function(){var c=!this.privileges;
if(!c){var a=CQ.User.getCurrentUser();
if(typeof this.privileges=="object"){for(var b=0;
b<this.privileges.length;
b++){c=a.hasPermissionOn(this.privileges[b],this.path);
if(!c){break
}}}else{c=CQ.User.hasPermissionOn(this.privileges,this.path)
}}return c
},checkConditions:function(){var allowed=!this.conditions;
if(!allowed){for(var i=0;
i<this.conditions.length;
i++){if(typeof(this.conditions[i])=="string"){this.conditions[i]=eval(this.conditions[i])
}allowed=this.conditions[i].call(this);
if(!allowed){break
}}}return allowed
}});
CQ.Highlight=CQ.Ext.extend(CQ.Ext.Component,{frameCls:null,frameWidth:null,framePadding:null,zIndex:null,frameLeft:null,frameRight:null,frameBottom:null,frameTop:null,constructor:function(a){CQ.Util.applyDefaults(a,{frameCls:"cq-highlight",frameWidth:CQ.themes.Highlight.FRAME_WIDTH,framePadding:CQ.themes.Highlight.FRAME_PADDING});
CQ.Highlight.superclass.constructor.call(this);
this.initialConfig=a;
this.frameLeft=this.createFrame("left");
this.frameRight=this.createFrame("right");
this.frameTop=this.createFrame("top");
this.frameBottom=this.createFrame("bottom");
this.addEvents("beforeshowframe","beforehideframe","afterflash");
if(a.cls){this.addClass(a.cls)
}},createFrame:function(b){var a=this.initialConfig;
return new CQ.Ext.BoxComponent({autoEl:"div",cls:a.frameCls+" "+b})
},showFrame:function(){if(!this.frameLeft.rendered){this.frameLeft.render(CQ.Util.ROOT_ID)
}if(!this.frameRight.rendered){this.frameRight.render(CQ.Util.ROOT_ID)
}if(!this.frameTop.rendered){this.frameTop.render(CQ.Util.ROOT_ID)
}if(!this.frameBottom.rendered){this.frameBottom.render(CQ.Util.ROOT_ID)
}var b=this.initialConfig;
if(b.listeners&&b.listeners.beforeshowframe){var k=b.listeners.beforeshowframe.handler?b.listeners.beforeshowframe.handler:b.listeners.beforeshowframe;
var j=b.listeners.beforeshowframe.scope?b.listeners.beforeshowframe.scope:this;
k.call(j)
}var c=CQ.Ext.get(b.element);
var g=c.getWidth();
var a=c.getHeight();
var n=c.getLeft();
var m=c.getTop();
this.frameLeft.setWidth(b.frameWidth);
this.frameLeft.setHeight(a+(2*b.framePadding));
this.frameLeft.setPosition(n-b.frameWidth-b.framePadding,m-b.framePadding);
this.frameRight.setWidth(b.frameWidth);
this.frameRight.setHeight(a+(2*b.framePadding));
this.frameRight.setPosition(n+g+b.framePadding,m-b.framePadding);
this.frameTop.setWidth(g+(2*b.frameWidth)+(2*b.framePadding));
this.frameTop.setHeight(b.frameWidth);
this.frameTop.setPosition(n-b.frameWidth-b.framePadding,m-b.frameWidth-b.framePadding);
this.frameBottom.setWidth(g+(2*b.frameWidth)+(2*b.framePadding));
this.frameBottom.setHeight(b.frameWidth);
this.frameBottom.setPosition(n-b.frameWidth-b.framePadding,m+a+b.framePadding);
this.frameLeft.show();
this.frameRight.show();
this.frameTop.show();
this.frameBottom.show();
if(this.zIndex){this.frameLeft.el.setStyle("z-index",this.zIndex);
this.frameRight.el.setStyle("z-index",this.zIndex);
this.frameTop.el.setStyle("z-index",this.zIndex);
this.frameBottom.el.setStyle("z-index",this.zIndex)
}},hideFrame:function(){var a=this.initialConfig;
if(a.listeners&&a.listeners.beforehideframe){var c=a.listeners.beforehideframe.handler?a.listeners.beforehideframe.handler:a.listeners.beforehideframe;
var b=a.listeners.beforehideframe.scope?a.listeners.beforehideframe.scope:this;
c.call(b)
}this.frameLeft.hide();
this.frameRight.hide();
this.frameBottom.hide();
this.frameTop.hide()
},flash:function(){var a=this.initialConfig;
var b=this;
CQ.Ext.get(a.element).frame(CQ.themes.Highlight.FLASH_COLOR,CQ.themes.Highlight.FLASH_NUM,{duration:CQ.themes.Highlight.FLASH_DURATION,callback:function(){b.fireEvent("afterflash",b)
}})
},addClass:function(a){this.frameLeft.addClass(a);
this.frameRight.addClass(a);
this.frameBottom.addClass(a);
this.frameTop.addClass(a)
},removeClass:function(a){this.frameLeft.removeClass(a);
this.frameRight.removeClass(a);
this.frameBottom.removeClass(a);
this.frameTop.removeClass(a)
},on:function(a,c,b){this.frameLeft.on(a,c,b);
this.frameRight.on(a,c,b);
this.frameBottom.on(a,c,b);
this.frameTop.on(a,c,b)
},un:function(a,c,b){this.frameLeft.un(a,c,b);
this.frameRight.un(a,c,b);
this.frameBottom.un(a,c,b);
this.frameTop.un(a,c,b)
}});
CQ.Static=CQ.Ext.extend(CQ.Ext.BoxComponent,{text:"",html:"",tag:"div",href:null,target:null,small:false,bold:false,italic:false,right:false,topmargin:false,bottommargin:false,noWrap:false,constructor:function(a){CQ.Static.superclass.constructor.call(this,a)
},initComponent:function(){CQ.Static.superclass.initComponent.call(this);
this.addClass("cq-static");
if(this.small){this.addClass("cq-static-small")
}if(this.bold){this.addClass("cq-static-bold")
}if(this.italic){this.addClass("cq-static-italic")
}if(this.right){this.addClass("cq-static-right")
}if(this.topmargin){this.addClass("cq-static-topmargin")
}if(this.bottommargin){this.addClass("cq-static-bottommargin")
}if(this.noWrap){this.addClass("cq-static-nowrap")
}},onRender:function(b,a){if(!this.el){var c=document.createElement(this.href?"a":this.tag);
if(this.href){c.href=this.href;
if(this.target){c.target=this.target
}}c.id=this.getId();
this.el=new CQ.Ext.Element(c);
if(this.text){this.updateText(this.text)
}else{if(this.html){this.updateHtml(this.html)
}}}CQ.Static.superclass.onRender.call(this,b,a)
},updateHtml:function(a){this.el.dom.innerHTML=a
},updateText:function(a){this.updateHtml(CQ.Ext.util.Format.htmlEncode(CQ.I18n.getVarMessage(a)))
}});
CQ.Ext.reg("static",CQ.Static);
CQ.TextButton=CQ.Ext.extend(CQ.Ext.Button,{scale:"medium",buttonSelector:"span:first-child",getTemplateArgs:function(){return[this.id,"cq-tbtn-"+this.scale,this.cls]
},onRender:function(b,a){if(!this.template){if(!CQ.TextButton.buttonTemplate){CQ.TextButton.buttonTemplate=new CQ.Ext.Template('<span id="{0}" class="cq-tbtn {1} {2}">',"<span></span>","</span>");
CQ.TextButton.buttonTemplate.compile()
}this.template=CQ.TextButton.buttonTemplate
}CQ.TextButton.superclass.onRender.call(this,b,a)
}});
CQ.Ext.reg("textbutton",CQ.TextButton);
CQ.PropertyGrid=function(a){a=CQ.Util.applyDefaults(a,{region:"east",title:CQ.I18n.getMessage("Properties"),collapsible:true,collapsed:true,split:true,autoScroll:true,containerScroll:true,animate:true,width:240,margins:"5 5 5 0"});
CQ.PropertyGrid.superclass.constructor.call(this,a)
};
CQ.Ext.extend(CQ.PropertyGrid,CQ.Ext.grid.PropertyGrid,{listeners:{afteredit:function(a){this.srcComp.setProperties(a.grid.getSource());
this.srcComp.afterPropChange()
}},showProperties:function(a){this.srcComp=a;
this.customEditors=a.getPropertyEditors();
this.setSource(a.getProperties());
if(this.collapsed){this.expand()
}}});
CQ.Ext.reg("propgrid",CQ.PropertyGrid);
CQ.Dialog=CQ.Ext.extend(CQ.Ext.Window,{okText:null,cancelText:null,buttons:[],params:{},responseScope:null,success:null,failure:null,formUrl:null,path:null,helpPath:null,editLockMode:null,editLock:null,formPanel:null,form:null,titleFromConfig:false,formUrlFromConfig:false,configDefaults:null,isPinned:false,warnIfModified:true,processedValues:null,setElId:function(a){this.el.dom.id=a
},loadContent:function(b,c){if(typeof(b)=="string"){this.path=b;
var a=CQ.HTTP.externalize(this.path,true);
c=c||CQ.Sling.SELECTOR_INFINITY+CQ.HTTP.EXTENSION_JSON;
this.store=new CQ.data.SlingStore({url:a+c});
if(!this.formUrlFromConfig){if(a.substring(a.length-2)=="/*"){a=a.substring(0,a.length-1)
}this.form.url=a
}if(!this.titleFromConfig){this.setTitle(a)
}if(CQ.Ext.isIE6&&this.title&&this.title.length>CQ.themes.Dialog.IE6_TITLE_MAX_CHAR){this.setTitle(this.title.substring(0,CQ.themes.Dialog.IE6_TITLE_MAX_CHAR))
}}else{if(b instanceof CQ.Ext.data.Store){this.store=b
}}if(this.store){this.store.load({callback:this.processRecords,scope:this})
}},focusFirstField:function(b){if(!b){b=this.getActiveTab()
}var a=CQ.Util.findFormFields(b);
for(var c in a){if(a[c][0].focus){a[c][0].focus(true,400);
break
}}},processRecords:function(r,a,t){var g=this.getRecord(r,t);
CQ.Log.debug("CQ.Dialog#processRecords: processing records for fields");
var c=false;
var n=g.get("jcr:mixinTypes");
if(n&&((n.indexOf(CQ.wcm.msm.MSM.MIXIN_LIVE_RELATIONSHIP)!=-1)||(n.indexOf(CQ.wcm.msm.MSM.MIXIN_LIVE_SYNC)!=-1))){c=true
}if(CQ.undo.UndoManager.isEnabled()){CQ.undo.util.UndoUtils.removeBlobMarkerFields(this)
}var m=CQ.Util.findFormFields(this.formPanel);
this.processedValues={};
for(var b in m){for(var k=0;
k<m[b].length;
k++){try{if(m[b][k].processPath){CQ.Log.debug("CQ.Dialog#processRecords: calling processPath of field '{0}'",[b]);
m[b][k].processPath(this.path,m[b][k].initialConfig.ignoreData)
}if(!m[b][k].initialConfig.ignoreData){CQ.Log.debug("CQ.Dialog#processRecords: calling processRecord of field '{0}'",[b]);
m[b][k].processRecord(g,this.path)
}if(!this.processedValues[b]){this.processedValues[b]=[]
}this.processedValues[b].push({field:m[b][k],value:m[b][k].getValue()});
if(this.fieldEditLockMode&&c){CQ.Log.debug("CQ.Dialog#processRecords: process fieldEditLock for field '{0}'",[b]);
this.handleFieldLock(m[b][k],g)
}}catch(o){CQ.Log.debug("CQ.Dialog#processRecords: {0}",o.message)
}}}if(CQ.undo.UndoManager.isEnabled()){var j=m.hasOwnProperty("./sling:resourceType")||m.hasOwnProperty(CQ.undo.UndoDefs.UNDO_MARKER_FIELD);
var q=CQ.undo.UndoManager.getHistory();
if(j){q.prepareUndo(new CQ.undo.util.OriginalData(this.path,g,this))
}else{q.preventUndo()
}}this.fireEvent("loadcontent",this,r,a,t);
this.focusFirstField()
},updateEnableInheritanceLockState:function(g){var a=CQ.Util.findFormFields(this.formPanel);
this.blueprintExists=g;
for(var b in a){for(var c=0;
c<a[b].length;
c++){this.updateEnableInheritanceFieldLockState(a[b][c])
}}},updateEnableInheritanceFieldLockState:function(a){var b=undefined;
if(a){b=a.fieldEditLockBtn
}if(b&&b.iconCls=="cq-dialog-unlocked"){b.setDisabled(this.blueprintExists===false)
}},handleFieldLock:function(q,b){if(q.getName().match("^\\./")!="./"){return
}var c=q.getName().substr(q.getName().lastIndexOf("/")+1);
var g=true;
var a=false;
var t="cq-dialog-locked";
var j=b.get("jcr:mixinTypes");
if(j&&(j.indexOf(CQ.wcm.msm.MSM.MIXIN_LIVE_SYNC_CANCELLED)!=-1)){g=false;
a=true;
t="cq-dialog-unlocked"
}var m=q.getName().substring(2,q.getName().length-c.length);
var o=b.get(m+CQ.wcm.msm.MSM.PARAM_PROPERTY_INHERITANCE_CANCELED);
if(o&&o.indexOf(c)!=-1){g=false;
t="cq-dialog-unlocked"
}q.editLock=g;
if(q.handleFieldLock){q.handleFieldLock(t,g,a,b)
}else{if(q.fieldEditLockBtn){q.setDisabled(g);
q.fieldEditLockBtn.setIconClass(t);
q.fieldEditLockBtn.setTooltip(t=="cq-dialog-unlocked"?CQ.Dialog.REVERT_INHERITANCE:CQ.Dialog.CANCEL_INHERITANCE);
q.fieldEditLockBtn.setDisabled(a)
}else{var r="";
if(a){r=CQ.Dialog.INHERITANCE_BROKEN
}else{r=g?CQ.Dialog.CANCEL_INHERITANCE:CQ.Dialog.REVERT_INHERITANCE
}try{q.setDisabled(g);
var n=this;
q.fieldEditLockBtn=new CQ.TextButton({disabled:a,tooltip:r,cls:"cq-dialog-editlock",iconCls:t,handleMouseEvents:false,handler:function(){n.switchPropertyInheritance(q,c,function(v,u){q.fieldEditLockBtn.setIconClass(v);
q.fieldEditLockBtn.setTooltip(v=="cq-dialog-unlocked"?CQ.Dialog.REVERT_INHERITANCE:CQ.Dialog.CANCEL_INHERITANCE);
q.setDisabled(u);
q.editLock=u;
n.updateEnableInheritanceFieldLockState(q)
},n)
}});
if(q.rendered){this.renderFieldLock(q)
}else{q.on("render",this.renderFieldLock)
}}catch(k){}}}},renderFieldLock:function(a){var c=CQ.Ext.get("x-form-el-"+a.id);
var b=c.parent().first();
c.parent().first().dom.style.width=(parseInt(b.dom.style.width)-CQ.themes.Dialog.LOCK_WIDTH)+"px";
a.fieldEditLockBtn.render(c.parent(),b.next())
},switchPropertyInheritance:function(c,b,g,a){CQ.Ext.Msg.confirm(c.editLock?CQ.I18n.getMessage("Cancel inheritance"):CQ.I18n.getMessage("Revert inheritance"),c.editLock?CQ.I18n.getMessage("Do you really want to cancel the inheritance?"):CQ.I18n.getMessage("Do you really want to revert the inheritance?"),function(t){if(t=="yes"){var k=false;
var m="cq-dialog-unlocked";
var q={};
q.cmd="cancelPropertyInheritance";
if(!c.editLock){var k=true;
var m="cq-dialog-locked";
q.cmd="reenablePropertyInheritance"
}q[CQ.wcm.msm.MSM.PARAM_PROPERTY_NAME]=[];
if(c.getFieldLockParameters){q=c.getFieldLockParameters(q)
}else{q[CQ.wcm.msm.MSM.PARAM_PROPERTY_NAME].push(b)
}var o=this;
var n=o.path;
if(c.getFieldLockTarget){n=c.getFieldLockTarget(n)
}else{var j=c.getName().substr(0,c.getName().length-b.length);
if(j.lastIndexOf("./",0)===0){j=j.substr(2)
}if(j.length>0){n+="/"+j
}}var r=CQ.utils.HTTP.post(n+".msm.conf",null,q,this);
if(CQ.utils.HTTP.isOk(r)){if(g){g.call(c,m,k)
}if(k){o.store.reload({callback:function(v,u,x){var w=o.getRecord(v,x);
c.processRecord(w,o.path);
if(!w.get(b)&&(c.getValue()!=c.defaultValue)){c.setValue(null)
}}})
}}}},a||this)
},getRecord:function(a,c){var b;
if(c&&this.path.charAt(this.path.length-1)!="/"&&this.path.charAt(this.path.length-1)!="*"){b=a[0]
}else{if(!c){CQ.Log.warn("CQ.Dialog#processRecords: retrieval of records unsuccessful")
}else{CQ.Log.info("CQ.Dialog#processRecords: skipping paths ending in '/' or /*'")
}b=new CQ.data.SlingRecord();
b.data={}
}return b
},processPath:function(j){CQ.Log.debug("CQ.Dialog#processPath: processing path for fields");
var a=CQ.Util.findFormFields(this.formPanel);
for(var b in a){for(var c=0;
c<a[b].length;
c++){try{if(a[b][c].processPath){CQ.Log.debug("CQ.Dialog#processPath: field '{0}'",[b]);
a[b][c].processPath(j)
}}catch(g){CQ.Log.debug("CQ.Dialog#processPath: {0}",g.message)
}}}},addHidden:function(g,b){for(var a in g){var c=CQ.Util.build({xtype:"hidden",name:a,value:g[a],ignoreData:b!==false});
this.formPanel.add(c);
g[a]=c
}this.formPanel.doLayout();
return g
},addParams:function(j,c){var g={};
var a=CQ.Util.findFormFields(this.formPanel);
for(var b in j){if(!a[b]){g[b]=j[b]
}}this.addHidden(g,c)
},getField:function(b){var a=CQ.Util.findFormFields(this.formPanel);
if(a[b]&&a[b].length==1){return a[b][0]
}else{return a[b]
}},enableFields:function(){var a=CQ.Util.findFormFields(this.formPanel);
for(var b in a){for(var c=0;
c<a[b].length;
c++){var g=a[b][c];
if(g){if(g.enable){g.enable()
}}}}},disableFields:function(){var a=CQ.Util.findFormFields(this.formPanel);
for(var b in a){for(var c=0;
c<a[b].length;
c++){var g=a[b][c];
if(g){if(g.disable){g.disable()
}}}}},applySingleConfigDefaults:function(b,c,g){var a=CQ.Util.getSingleItemConfig(b,g);
if(a){return CQ.Util.applyDefaults(a,c)
}return b
},applyConfigDefaults:function(config,defaults){CQ.Util.applyDefaults(config,defaults.dialog);
if(config.items.xtype=="tabpanel"){var tabPanel=this.applySingleConfigDefaults(config,defaults.tabpanel,"tabpanel");
if(tabPanel&&tabPanel.items){if(tabPanel.items instanceof Array){for(var i=0;
i<tabPanel.items.length;
i++){var tab=CQ.Util.applyDefaults(tabPanel.items[i],defaults.panel)
}}else{var tab=CQ.Util.applyDefaults(tabPanel.items,defaults.panel)
}}}else{var singlePanel=this.applySingleConfigDefaults(config,defaults.panel,"panel")
}if(config.buttons){if(typeof config.buttons=="string"){config.buttons=[config.buttons]
}var buttons=[];
if(config.editLockMode){config.buttonAlign="left";
var cls,tip;
if(config.editLock){cls="cq-dialog-locked";
tip=CQ.I18n.getMessage("Cancel inheritance")
}else{cls="cq-dialog-unlocked";
tip=CQ.I18n.getMessage("Revert inheritance")
}var dlg=this;
var cfg={iconCls:cls,cls:"cq-dialog-editlock",tooltip:tip,enableToggle:true,handleMouseEvents:false,toggleHandler:function(button){if(dlg.editLock){dlg.enableFields(dlg.formPanel);
button.setIconClass("cq-dialog-unlocked");
button.setTooltip(CQ.Dialog.REVERT_INHERITANCE);
dlg.fireEvent("beforeeditunlocked",dlg)
}else{dlg.disableFields(dlg.formPanel);
button.setIconClass("cq-dialog-locked");
button.setTooltip(CQ.Dialog.CANCEL_INHERITANCE);
dlg.fireEvent("beforeeditlocked",dlg)
}}};
if(config.editLockDisabled===true||config.editLockDisabled=="true"){cfg.disabled=true;
cfg.tooltip=config.editLockDisabledTitle
}buttons.push(cfg)
}if(config.params){var dialogType=config.params["./sling:resourceType"];
if(dialogType&&config.helpPath){buttons.push(CQ.Util.applyDefaults(CQ.wcm.HelpBrowser.createHelpButton(config.helpPath),defaults.button))
}}for(var i=0;
i<config.buttons.length;
i++){if(typeof config.buttons[i]=="string"){if(config.buttons[i]==CQ.Dialog.OK){var okButton=this.getOkConfig();
buttons.push(CQ.Util.applyDefaults(okButton,defaults.button))
}if(config.buttons[i]==CQ.Dialog.CANCEL){var cancelButton=this.getCancelConfig();
buttons.push(CQ.Util.applyDefaults(cancelButton,defaults.button))
}if(config.buttons[i]=="-"||config.buttons[i]=="->"){buttons.push(config.buttons[i])
}}else{if(config.buttons[i]){if(typeof config.buttons[i].handler=="string"){config.buttons[i].handler=eval(config.buttons[i].handler)
}if(config.buttons[i].menu){CQ.Util.applyDefaults(config.buttons[i].menu,defaults.menu)
}buttons.push(CQ.Util.applyDefaults(config.buttons[i],defaults.button))
}}}config.buttons=buttons
}},getOkConfig:function(){return{text:this.okText,cls:"cq-btn-ok",handler:function(a){this.ok(a)
}}
},getCancelConfig:function(){return{text:this.cancelText,cls:"cq-btn-cancel",handler:function(a){if(CQ.undo.UndoManager.isEnabled()){CQ.undo.UndoManager.getHistory().cancelUndo()
}this[this.closeAction]()
}}
},getActiveTab:function(){var a=this.formPanel.getComponent(0).getComponent(0);
if(a.xtype=="tabpanel"){a=a.getActiveTab()
}return a
},setFormUrl:function(a){this.form.url=a
},ok:function(g,m,c){var b={};
var j;
var a;
if(this.responseScope){b.scope=this.responseScope;
j=this.responseScope.success;
a=this.responseScope.failure
}b.success=m?m:this.success?this.success:j;
b.failure=c?c:this.failure?this.failure:a;
if(this.form.isValid()){if(this.fireEvent("beforesubmit",this)===false){return false
}this.form.items.each(function(n){if(n.emptyText&&n.el&&n.el.dom&&n.el.dom.value==n.emptyText){n.setRawValue("")
}});
var k=new CQ.form.SlingSubmitAction(this.form,b);
this.form.doAction(k);
this[this.closeAction]()
}else{CQ.Ext.Msg.show({title:CQ.I18n.getMessage("Validation Failed"),msg:CQ.I18n.getMessage("Verify the values of the marked fields."),buttons:CQ.Ext.Msg.OK,icon:CQ.Ext.Msg.ERROR})
}},pin:function(a){this.alignToViewport(a);
if(!this.isPinned){CQ.Util.pin(this);
this.isPinned=true
}},unpin:function(){if(this.isPinned){CQ.Util.unpin(this);
this.isPinned=false
}},alignToViewport:function(m){if(!m){return
}var o,n=0;
var j=CQ.Ext.lib.Dom.getViewportWidth();
var b=CQ.Ext.lib.Dom.getViewportHeight();
var k=CQ.themes.Dialog.CORNER_X;
var g=CQ.themes.Dialog.CORNER_Y;
var c=this.getBox();
switch(m){case"tl":o=k;
n=g;
break;
case"tr":o=j-c.width-k;
n=g;
break;
case"bl":o=k;
n=b-c.height-k;
break;
case"br":o=j-c.width-k;
n=b-c.height-g;
break;
case"c":default:var a=this.getEl().getCenterXY();
o=a[0];
n=a[1]
}this.setPosition(o,n)
},overridePosition:function(){if(!this.disableOverridePosition){var a=CQ.Ext.getDoc().getScroll();
if(this.x){this.originalX=this.x;
this.x+=a.left
}if(this.y){this.originalY=this.y;
this.y+=a.top
}}},resetPosition:function(){if(this.originalX){this.x=this.originalX
}if(this.originalY){this.y=this.originalY
}},destroy:function(){CQ.Dialog.superclass.destroy.call(this);
CQ.Ext.destroy(this.formPanel)
},constructor:function(a){if(a.header===false||a.title){this.titleFromConfig=true
}this.okText=a.okText?a.okText:CQ.I18n.getMessage("OK");
this.cancelText=a.cancelText?a.cancelText:CQ.I18n.getMessage("Cancel");
this.configDefaults={dialog:{xtype:"dialog",closable:true,closeAction:"hide",width:CQ.themes.Dialog.WIDTH,height:CQ.themes.Dialog.HEIGHT,minWidth:CQ.themes.Dialog.MIN_WIDTH,minHeight:CQ.themes.Dialog.MIN_HEIGHT,y:20,title:"&nbsp;",layout:"fit",plain:CQ.themes.Dialog.PLAIN,bodyStyle:CQ.themes.Dialog.BODY_STYLE,buttonAlign:CQ.themes.Dialog.BUTTON_ALIGN,minButtonWidth:CQ.themes.Dialog.MIN_BUTTON_WIDTH,stateful:false,disableOverridePosition:false},tabpanel:{xtype:"tabpanel",activeTab:0,deferredRender:false,plain:CQ.themes.Dialog.TABPANEL_PLAIN,border:CQ.themes.Dialog.TABPANEL_BORDER,enableTabScroll:true,stateful:false,listeners:{tabchange:{fn:function(g,c){if(g.rendered){if(CQ.Ext.isIE){c.hide();
c.show()
}this.focusFirstField(c)
}},scope:this}}},panel:{layout:"form",autoScroll:true,bodyStyle:CQ.themes.Dialog.TAB_BODY_STYLE,labelWidth:CQ.themes.Dialog.LABEL_WIDTH,defaultType:"textfield",stateful:false,defaults:{msgTarget:CQ.themes.Dialog.MSG_TARGET,anchor:CQ.themes.Dialog.ANCHOR,stateful:false}},button:{xtype:"button",scope:this},menu:{defaults:{scope:this}}};
this.applyConfigDefaults(a,this.configDefaults);
CQ.Dialog.superclass.constructor.call(this,a);
var b={xtype:"form",renderTo:CQ.Util.ROOT_ID,baseCls:"x-window-plain",items:this};
if(this.fileUpload){b.fileUpload=this.fileUpload
}this.formPanel=new CQ.Ext.form.FormPanel(b);
this.form=this.formPanel.getForm();
if(a.formUrl){this.form.url=a.formUrl;
this.formUrlFromConfig=true
}if(!a.params){a.params=new Object()
}if(a.params[CQ.Sling.CHARSET]==undefined){a.params[CQ.Sling.CHARSET]=CQ.Dialog.DEFAULT_ENCODING
}if(a.params[CQ.Sling.STATUS]==undefined){a.params[CQ.Sling.STATUS]=CQ.Sling.STATUS_BROWSER
}this.addParams(a.params);
if(a.content){this.loadContent(a.content)
}this.success=a.success;
this.failure=a.failure;
this.responseScope=a.responseScope;
this.on("beforeshow",this.overridePosition);
this.on("hide",this.resetPosition);
this.on("show",function(c){c.focusFirstField()
});
this.addEvents("beforesubmit","loadContent","loadcontent","beforeeditlocked","editLocked","editlocked","beforeeditunlocked","editUnlocked","editunlocked");
if(this.warnIfModified){if(!window.CQ_Dialog_checkBeforeUnload){window.CQ_Dialog_checkBeforeUnload=[];
window.onbeforeunload=CQ.Dialog.checkModified;
CQ.Ext.EventManager.addListener(window,"unload",function(){window.CQ_Dialog_checkBeforeUnload=null;
window.onbeforeunload=null
})
}window.CQ_Dialog_checkBeforeUnload.push(this)
}},observe:function(){if(!this.hidden){if(this.anchoredTo){var b=this.anchoredTo.getInlinePlaceholder();
if(b){var c=this.anchoredTo.getInlinePlaceholderInitialHeight();
var g=this.getPosition();
var a=b.getXY();
if(g[0]!=a[0]||g[1]!=a[1]+c){this.alignTo(b,"tl",[0,c])
}}}}},initComponent:function(){CQ.Dialog.superclass.initComponent.call(this);
if(this.editLockMode){this.editLockButton=this.buttons[0];
this.on("show",function(){this.setEditLock(this.editLock,true,true)
},this)
}},setEditLock:function(b,c,a){if(b){this.disableFields();
this.editLockButton.setIconClass("cq-dialog-locked");
this.editLockButton.setTooltip(CQ.Dialog.CANCEL_INHERITANCE)
}else{this.enableFields();
this.editLockButton.setIconClass("cq-dialog-unlocked");
this.editLockButton.setTooltip(CQ.Dialog.REVERT_INHERITANCE)
}this.editLockButton.toggle(!b,true);
this.editLock=b;
if(a){this.fireEvent((this.editLock?"editlocked":"editunlocked"),this,c)
}}});
CQ.Dialog.checkModified=function(){if(this.CQ_Dialog_checkBeforeUnload){for(var k=0;
k<this.CQ_Dialog_checkBeforeUnload.length;
k++){var c=this.CQ_Dialog_checkBeforeUnload[k];
if(!c.hidden&&c.processedValues){for(var a in c.processedValues){for(var b=0;
b<c.processedValues[a].length;
b++){var j=c.processedValues[a][b].field;
var g=c.processedValues[a][b].value;
if(CQ.Util.compareValues(j.getValue(),g)!=0){return CQ.I18n.getMessage("There are unsaved changes in the currently open dialog(s)")
}}}}}}};
CQ.Dialog.DEFAULT_ENCODING="utf-8";
CQ.Dialog.OK="OK";
CQ.Dialog.CANCEL="CANCEL";
CQ.Dialog.OKCANCEL=[CQ.Dialog.OK,CQ.Dialog.CANCEL];
CQ.Dialog.CANCEL_INHERITANCE=CQ.I18n.getMessage("Cancel inheritance");
CQ.Dialog.REVERT_INHERITANCE=CQ.I18n.getMessage("Revert inheritance");
CQ.Dialog.INHERITANCE_BROKEN=CQ.I18n.getMessage("Inheritance is broken at the page level");
CQ.Ext.reg("dialog",CQ.Dialog);
CQ.DialogEditor=CQ.Ext.extend(CQ.Ext.Viewport,{fieldCount:0,constructor:function(b){this.debug=b.debug;
var c=this;
b=CQ.Util.applyDefaults(b,{treeRoot:{name:"dialog",text:CQ.I18n.getMessage("Dialog"),draggable:false,expanded:true,editor:this}});
this.preview=new CQ.Ext.Panel({id:"cq-dialogeditor-preview-wrapper",region:"center",bodyStyle:"padding:12px",margins:"5 0 5 0",autoScroll:true,containerScroll:true,collapsible:true,collapseMode:"mini",hideCollapseTool:true,listeners:{render:function(j){j.loadMask=new CQ.Ext.LoadMask(j.bwrap)
}},tbar:[{id:"cq-dialogeditor-save",text:CQ.I18n.getMessage("Save"),handler:function(){c.fireEvent("save",c.getDialog())
},tooltip:{title:CQ.I18n.getMessage("Save Dialog"),text:CQ.I18n.getMessage("Save the current dialog"),autoHide:true}}]});
this.dialogTree=new CQ.Ext.tree.TreePanel({id:"cq-dialogeditor-structure",title:CQ.I18n.getMessage("Structure"),region:"center",autoScroll:true,containerScroll:true,split:true,enableDD:true,ddScroll:true,ddGroup:CQ.DialogEditor.DD_GROUP,root:new CQ.DialogEditor.DialogTreeNode(b.treeRoot),listeners:{click:function(k,j){if(k.getProperties){c.props.showProperties(k)
}},beforenodedrop:function(j){if(j.dropNode instanceof CQ.DialogEditor.TreeNode){j.target.handleReorder(j)
}else{j.target.handleDrop(j);
j.dropStatus=true;
return false
}},nodedragover:function(j){if(j.dropNode instanceof CQ.DialogEditor.TreeNode){return j.target.isReorderAllowed(j)
}else{return j.target.isInsertAllowed(j)
}},contextmenu:function(k,j){var o=k.getContextMenuActions();
if(o&&(o.length>0)){var n=new CQ.Ext.menu.Menu({items:o});
var m=j.getXY();
n.showAt(m)
}j.stopEvent()
}}});
var g=CQ.Ext.data.Record.create([{name:"title"},{name:"category"},{name:"insertCfg"}]);
var a=new CQ.Ext.XTemplate('<tpl for=".">','<div class="x-control">{text}</div>',"</tpl>");
this.tools=new CQ.Ext.Panel({id:"cq-dialogeditor-tools",title:CQ.I18n.getMessage("Palette"),autoScroll:true,layout:"accordion",region:"north",height:320,stateful:true,split:true,collapsible:true,collapseMode:"mini",hideCollapseTool:true,listeners:{render:function(k){var r=[];
for(var n in CQ.DialogEditor.MAPPINGS){var q=CQ.DialogEditor.MAPPINGS[n].text;
var o=CQ.DialogEditor.MAPPINGS[n].category;
if(CQ.DialogEditor.MAPPINGS[n].hideInList){continue
}var m;
if(r[o]){m=r[o]
}else{m=new CQ.Ext.data.Store({sortInfo:{field:"title",direction:"ASC"},reader:new CQ.Ext.data.DataReader({},g)});
r[o]=m;
var j=new CQ.Ext.DataView({store:m,tpl:a,autoHeight:true,autoWidth:true,border:false,singleSelect:true,multiSelect:false,overClass:"x-control-over",selectedClass:"x-control-selected",itemSelector:"div.x-control",loadingText:CQ.I18n.getMessage("Loading controls"),prepareData:function(t){t.title=CQ.I18n.getVarMessage(t.title);
return t
},listeners:{render:function(u){var t=new CQ.DialogEditor.DragZone(u,{containerScroll:true,ddGroup:CQ.DialogEditor.DD_GROUP})
}}});
k.add(new CQ.Ext.Panel({title:CQ.I18n.getVarMessage(o),autoScroll:true,containerScroll:true,border:false,layout:"fit",items:j}))
}m.addSorted(new CQ.Ext.data.Record(CQ.DialogEditor.MAPPINGS[n],o+"#"+q))
}}}});
this.props=new CQ.PropertyGrid({region:"east",margins:"5 5 5 0",width:320,collapsible:true,collapseMode:"mini",animate:true,collapsed:false,hideCollapseTool:true});
this.props.on("rowcontextmenu",function(j,q,k){var o=j.getSource();
if((j.getStore().getAt(q).data.name.indexOf(CQ.DialogEditor.NT_JCR_NS_PREFIX)==-1)||(j.getStore().getAt(q).data.name=="xtype")){var n=new CQ.Ext.menu.Menu({items:[{text:CQ.I18n.getMessage("Remove"),handler:function(){delete o[j.getStore().getAt(q).data.name];
c.props.setSource(o);
c.updatePreview()
},tooltip:{title:CQ.I18n.getMessage("Remove Property"),text:CQ.I18n.getMessage("Remove selected property"),autoHide:true}}]});
var m=k.getXY();
n.showAt(m)
}k.stopEvent()
});
CQ.DialogEditor.superclass.constructor.call(this,{id:"cq-dialogeditor",layout:"border",renderTo:"CQ",items:[{xtype:"panel",id:"cq-dialogeditor-wrapper",layout:"border",region:"center",border:false,items:[{id:"cq-header",xtype:"container",autoEl:"div",region:"north",items:[{xtype:"panel",border:false,layout:"column",cls:"cq-header-toolbar"}]},{xtype:"panel",region:"west",layout:"border",margins:"5 0 5 5",width:320,collapsible:true,collapseMode:"mini",hideCollapseTool:true,animate:true,split:true,border:false,items:[this.dialogTree,this.tools]},this.preview,this.props]}]})
},initComponent:function(){CQ.DialogEditor.superclass.initComponent.call(this);
this.addEvents("save")
},updatePreview:function(){this.preview.loadMask.show();
var a=CQ.Util.copyObject(this.getDialog());
CQ.Ext.apply(a,{y:0,draggable:false,floating:false,closeAction:"closeCallback",closeCallback:CQ.Ext.emptyFn,resizable:false});
CQ.Util.formatData(a);
if(a.buttons==undefined){a.buttons=CQ.Dialog.OKCANCEL
}var c=CQ.WCM.getDialog(a);
for(var b=0;
b<c.buttons.length;
b++){c.buttons[b].setHandler(function(){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Button clicked"),this.text+CQ.I18n.getMessage(" was clicked."))
},c.buttons[b])
}if(this.preview.items&&(this.preview.items.getCount()>0)){this.preview.remove(this.preview.items.get(0))
}this.preview.add(c);
this.preview.doLayout();
this.preview.loadMask.hide()
},getDialog:function(){return this.dialogTree.getRootNode().getWidgetConfig()
},loadDialog:function(config){var dlgConfig;
if(typeof(config)=="string"){config=CQ.HTTP.eval(config)
}if(typeof config!="object"||config.xtype!="dialog"){dlgConfig=this.getDialogConfig(config)
}else{dlgConfig=config
}var root=this.dialogTree.getRootNode();
if(dlgConfig.title){root.setText(dlgConfig.title)
}root.setWidgetConfig(dlgConfig);
this.loadDialogTree(dlgConfig,root);
this.loadButtons(dlgConfig,root);
root.expand(true);
this.updatePreview()
},getDialogConfig:function(b){var a;
if(CQ.DialogEditor.getXType(b)=="dialog"){a=b
}else{a={xtype:"dialog","jcr:primaryType":"cq:Dialog"};
if(b["jcr:primaryType"]=="cq:Dialog"){delete b["jcr:primaryType"]
}if(b.xtype=="panel"&&b.title){a.items={xtype:"tabpanel",items:b}
}else{a.items=b
}}a.responseScope=b.responseScope;
a.success=b.success;
a.failure=b.failure;
a.params=b.params;
return a
},loadDialogTree:function(o,c){if(CQ.DialogEditor.getXType(o)=="dialog"){this.loadDialogTree(o.items,c)
}else{if(CQ.DialogEditor.getXType(o)=="widgetcollection"){for(var m in o){if(typeof(o[m])!="object"){continue
}var b=CQ.DialogEditor.getXType(o[m]);
var j=o[m].fieldLabel?o[m].fieldLabel:null;
var g=o[m].title?o[m].title:j;
var a=CQ.DialogEditor.MAPPINGS[b];
if(a){var k=CQ.DialogEditor.createDialogTreeNode(a,m,g,this);
k.setWidgetConfig(o[m]);
c.appendChild(k);
if(m.match("^"+CQ.DialogEditor.PROP_PREFIX)==CQ.DialogEditor.PROP_PREFIX){var n=parseInt(m.substring(CQ.DialogEditor.PROP_PREFIX.length));
if(n>this.fieldCount){this.fieldCount=n
}}if(o[m].items){this.loadDialogTree(o[m].items,k)
}}}}else{var b=CQ.DialogEditor.getXType(o);
var j=o.fieldLabel?o.fieldLabel:null;
var g=o.title?o.title:j;
var a=CQ.DialogEditor.MAPPINGS[b];
if(a){var k=CQ.DialogEditor.createDialogTreeNode(a,b,g,this);
k.setWidgetConfig(o);
c.appendChild(k);
if(o.items){this.loadDialogTree(o.items,k)
}}}}},loadButtons:function(g,k){if(g.buttons){var j=new CQ.DialogEditor.ButtonsTreeNode({name:"buttons",text:CQ.I18n.getMessage("Buttons"),editor:this});
j.setWidgetConfig(g.buttons);
k.appendChild(j);
for(var a in g.buttons){if(typeof(g.buttons[a])=="string"){continue
}g.buttons[a].xtype="button";
var c=CQ.DialogEditor.createButtonTreeNode(g.buttons[a].text,this);
c.setWidgetConfig(g.buttons[a]);
j.appendChild(c)
}}},getNextPropName:function(){this.fieldCount++;
return CQ.DialogEditor.PROP_PREFIX+this.fieldCount
}});
CQ.Ext.reg("dialogeditor",CQ.DialogEditor);
CQ.DialogEditor.getXType=function(a){if(a.xtype){return a.xtype
}else{if(a[CQ.DialogEditor.JCR_PRIMARY_TYPE]){return a[CQ.DialogEditor.JCR_PRIMARY_TYPE].substring(CQ.DialogEditor.NT_CQ_NS_PREFIX.length).toLowerCase()
}else{return CQ.DialogEditor.DEFAULT_FIELD_TYPE
}}};
CQ.DialogEditor.createDialogTreeNode=function(c,b,j,g){var a={name:b,text:(j!=null)?j:c.text,category:c.category,allowedChilds:c.allowedChilds,editor:g};
if(c.category==CQ.DialogEditor.CONTAINER){return new CQ.DialogEditor.ContainerTreeNode(a)
}else{return new CQ.DialogEditor.FieldTreeNode(a)
}};
CQ.DialogEditor.createButtonTreeNode=function(g,c){var b=CQ.DialogEditor.MAPPINGS.button;
var a={name:c.getNextPropName(),text:(g!=null)?g:b.text,category:b.category,editor:c};
return new CQ.DialogEditor.ButtonTreeNode(a)
};
CQ.DialogEditor.DD_GROUP="cq.dialogeditor";
CQ.DialogEditor.DEFAULT_FIELD_TYPE="textfield";
CQ.DialogEditor.PROP_PREFIX="prop";
CQ.DialogEditor.NT_CQ_NS_PREFIX="cq:";
CQ.DialogEditor.NT_DIALOG=CQ.DialogEditor.NT_CQ_NS_PREFIX+"Dialog";
CQ.DialogEditor.NT_COLLECTION=CQ.DialogEditor.NT_CQ_NS_PREFIX+"WidgetCollection";
CQ.DialogEditor.NT_TABPANEL=CQ.DialogEditor.NT_CQ_NS_PREFIX+"TabPanel";
CQ.DialogEditor.NT_PANEL=CQ.DialogEditor.NT_CQ_NS_PREFIX+"Panel";
CQ.DialogEditor.NT_JCR_NS_PREFIX="jcr:";
CQ.DialogEditor.JCR_PRIMARY_TYPE=CQ.DialogEditor.NT_JCR_NS_PREFIX+"primaryType";
CQ.DialogEditor.CONTAINER=CQ.I18n.getMessage("Container");
CQ.DialogEditor.FIELD=CQ.I18n.getMessage("Fields");
CQ.DialogEditor.BUTTON=CQ.I18n.getMessage("Buttons");
CQ.DialogEditor.MAPPINGS={dialog:{hideInList:true,category:CQ.DialogEditor.CONTAINER,text:CQ.I18n.getMessage("Dialog"),insertCfg:{"jcr:primaryType":"cq:Dialog",xtype:"dialog",title:"Dialog",items:{"jcr:primaryType":"cq:WidgetCollection"}},propList:{title:"",width:"",height:"",okText:"",cancelText:""}},panel:{category:CQ.DialogEditor.CONTAINER,text:CQ.I18n.getMessage("Panel"),insertCfg:{"jcr:primaryType":"cq:Panel",xtype:"panel",title:"Panel"},allowedChilds:["textfield","textarea","numberfield","selection","combo","hidden","richtext"],propList:{title:"",width:"",height:"",border:false}},tabpanel:{category:CQ.DialogEditor.CONTAINER,text:CQ.I18n.getMessage("Tab Panel"),insertCfg:{xtype:"tabpanel"},allowedChilds:["panel"],propsList:{width:"",height:"",border:false}},selection:{category:CQ.DialogEditor.CONTAINER,text:CQ.I18n.getMessage("Selection"),insertCfg:{xtype:"selection"},propList:{fieldLabel:"",fieldSubLabel:"",fieldDescription:"",name:"",allowBlank:false}},widgetcollection:{hideInList:true,category:CQ.DialogEditor.CONTAINER,text:CQ.I18n.getMessage("Collection"),insertCfg:{"jcr:primaryType":"cq:WidgetCollection"},propList:{}},buttons:{category:CQ.DialogEditor.CONTAINER,text:CQ.I18n.getMessage("Buttons"),insertCfg:{"jcr:primaryType":"cq:WidgetCollection"},propList:{}},textfield:{category:CQ.DialogEditor.FIELD,text:CQ.I18n.getMessage("Text Field"),insertCfg:{xtype:"textfield"},propList:{fieldLabel:"",fieldSubLabel:"",fieldDescription:"",name:"",allowBlank:false,blankText:"",disabled:false,emptyText:"",grow:false,hideLabel:false,hideMode:"",inputType:"",maxLength:"",maxLengthText:"",minLength:"",minLengthText:"",msgTarget:"",readOnly:false,selectOnFocus:false,regex:"",regexText:"",validateOnBlur:true,validationDelay:"",validationEvent:"",validator:"",vtype:"",vtypeText:""}},textarea:{category:CQ.DialogEditor.FIELD,text:CQ.I18n.getMessage("Text Area"),insertCfg:{xtype:"textarea"},propList:{fieldLabel:"",fieldSubLabel:"",fieldDescription:"",name:"",allowBlank:false,blankText:"",disabled:false,emptyText:"",grow:false,hideLabel:false,hideMode:"",inputType:"",maxLength:"",maxLengthText:"",minLength:"",minLengthText:"",msgTarget:"",readOnly:false,selectOnFocus:false,regex:"",regexText:"",validateOnBlur:true,validationDelay:"",validationEvent:"",validator:"",vtype:"",vtypeText:""}},richtext:{category:CQ.DialogEditor.FIELD,text:CQ.I18n.getMessage("Rich Text"),insertCfg:{xtype:"richtext"},propList:{fieldLabel:"",fieldSubLabel:"",fieldDescription:"",name:"",allowBlank:false,blankText:"",disabled:false,emptyText:"",grow:false,hideLabel:false,hideMode:"",inputType:"",maxLength:"",maxLengthText:"",minLength:"",minLengthText:"",msgTarget:"",readOnly:false,selectOnFocus:false,regex:"",regexText:"",validateOnBlur:true,validationDelay:"",validationEvent:"",validator:"",vtype:"",vtypeText:""}},numberfield:{category:CQ.DialogEditor.FIELD,text:CQ.I18n.getMessage("Number Field"),insertCfg:{xtype:"numberfield"},propList:{fieldLabel:"",fieldSubLabel:"",fieldDescription:"",name:"",allowBlank:false,blankText:"",disabled:false,emptyText:"",grow:false,hideLabel:false,hideMode:"",inputType:"",maxLength:"",maxLengthText:"",minLength:"",minLengthText:"",msgTarget:"",readOnly:false,selectOnFocus:false,regex:"",regexText:"",validateOnBlur:true,validationDelay:"",validationEvent:"",validator:"",vtype:"",vtypeText:""}},tableedit:{category:CQ.DialogEditor.FIELD,text:CQ.I18n.getMessage("Table"),insertCfg:{xtype:"tableedit"},propList:{fieldLabel:"",fieldSubLabel:"",fieldDescription:"",name:"",allowBlank:false,blankText:"",disabled:false,emptyText:"",grow:false,hideLabel:false,hideMode:"",inputType:"",maxLength:"",maxLengthText:"",minLength:"",minLengthText:"",msgTarget:"",readOnly:false,selectOnFocus:false,regex:"",regexText:"",validateOnBlur:true,validationDelay:"",validationEvent:"",validator:"",vtype:"",vtypeText:""}},combo:{category:CQ.DialogEditor.FIELD,text:CQ.I18n.getMessage("Combo Box"),insertCfg:{xtype:"combo"},propList:{fieldLabel:"",fieldSubLabel:"",fieldDescription:"",name:"",allowBlank:false,blankText:"",disabled:false,emptyText:"",grow:false,hideLabel:false,hideMode:"",inputType:"",maxLength:"",maxLengthText:"",minLength:"",minLengthText:"",msgTarget:"",readOnly:false,selectOnFocus:false,regex:"",regexText:"",validateOnBlur:true,validationDelay:"",validationEvent:"",validator:"",vtype:"",vtypeText:""}},hidden:{category:CQ.DialogEditor.FIELD,text:CQ.I18n.getMessage("Hidden"),insertCfg:{xtype:"hidden"},propList:{fieldLabel:"",fieldSubLabel:"",fieldDescription:"",name:"",allowBlank:false,blankText:"",disabled:false,emptyText:"",grow:false,hideLabel:false,hideMode:"",inputType:"",maxLength:"",maxLengthText:"",minLength:"",minLengthText:"",msgTarget:"",readOnly:false,selectOnFocus:false,regex:"",regexText:"",validateOnBlur:true,validationDelay:"",validationEvent:"",validator:"",vtype:"",vtypeText:""}},button:{category:CQ.DialogEditor.BUTTON,text:CQ.I18n.getMessage("Button"),insertCfg:{xtype:"button"},propList:{text:"",handler:""}}};
CQ.DialogEditor.TreeNode=CQ.Ext.extend(CQ.Ext.tree.TreeNode,{afterPropChange:function(){this.updatePreview()
},getEditor:function(){return this.attributes.editor
},getEventRecord:function(a){return a.data.records[0]
},getCategory:function(){return this.attributes.category
},getContextMenuActions:function(){return null
},getWidgetConfig:function(){return this.attributes.widget
},setWidgetConfig:function(a){this.attributes.widget=a
},isInsertAllowed:function(a){return false
},isReorderAllowed:function(a){return false
},handleDrop:function(a){this.updatePreview()
},handleReorder:function(a){this.updatePreview()
},updatePreview:function(){this.getEditor().updatePreview()
},setText:function(a){if(a){CQ.DialogEditor.TreeNode.superclass.setText.call(this,a)
}else{var b=CQ.DialogEditor.getXType(this.getWidgetConfig());
var a=CQ.DialogEditor.MAPPINGS[b].text;
CQ.DialogEditor.TreeNode.superclass.setText.call(this,a)
}},setProperties:function(a){for(var b in a){if(a[b]==""){delete a[b]
}}this.setWidgetConfig(a)
},getProperties:function(){var a=CQ.DialogEditor.getXType(this.getWidgetConfig());
return CQ.Ext.applyIf(this.getWidgetConfig(),CQ.DialogEditor.MAPPINGS[a].propList)
},getPropertyEditors:function(){return{"jcr:primaryType":new CQ.Ext.grid.GridEditor(new CQ.Ext.form.Hidden({})),xtype:new CQ.Ext.grid.GridEditor(new CQ.Ext.form.Hidden({})),height:new CQ.Ext.grid.GridEditor(new CQ.Ext.form.NumberField({allowNegative:false})),width:new CQ.Ext.grid.GridEditor(new CQ.Ext.form.NumberField({allowNegative:false})),minLength:new CQ.Ext.grid.GridEditor(new CQ.Ext.form.NumberField({allowNegative:false})),maxLength:new CQ.Ext.grid.GridEditor(new CQ.Ext.form.NumberField({allowNegative:false})),validationDelay:new CQ.Ext.grid.GridEditor(new CQ.Ext.form.NumberField({allowNegative:false})),layout:new CQ.Ext.grid.GridEditor(new CQ.Ext.form.ComboBox({triggerAction:"all",selectOnFocus:true,store:["form","border","fit"]})),inputType:new CQ.Ext.grid.GridEditor(new CQ.Ext.form.ComboBox({triggerAction:"all",selectOnFocus:true,editable:false,store:["text","password","file"]})),hideMode:new CQ.Ext.grid.GridEditor(new CQ.Ext.form.ComboBox({triggerAction:"all",selectOnFocus:true,editable:false,store:["display","offests","visibility"]})),msgTarget:new CQ.Ext.grid.GridEditor(new CQ.Ext.form.ComboBox({triggerAction:"all",selectOnFocus:true,store:["qtip","title","under","side"]}))}
},containsObjects:function(a){for(var b in a){if(typeof(a[b])=="object"){return true
}}return false
},getPropertyIndex:function(c,g){var a=0;
for(var b in c){if(g==c[b]){break
}a++
}return a
},insertProperty:function(m,c,k,b){var a={};
var j=0;
var g=false;
for(var n in m){if(j==b){a[c]=k;
g=true
}a[n]=m[n];
j++
}if(!g){a[c]=k
}return a
},removeProperty:function(c,g){var b=true;
for(var a in c){if(typeof(c[a])!="object"){continue
}if(c[a]==g){delete c[a]
}else{b=false
}}if(b){delete c
}}});
CQ.DialogEditor.ContainerTreeNode=CQ.Ext.extend(CQ.DialogEditor.TreeNode,{isInsertAllowed:function(b){var a=this.getEventRecord(b);
var c=a.get("insertCfg").xtype;
if(b.point=="append"){return this.isDropAllowed(c)
}else{return(this.parentNode instanceof CQ.DialogEditor.ContainerTreeNode)?this.parentNode.isDropAllowed(c):false
}},isReorderAllowed:function(a){var b=CQ.DialogEditor.getXType(a.dropNode.getWidgetConfig());
if(a.point=="append"){return this.isDropAllowed(b)
}else{return(this.parentNode instanceof CQ.DialogEditor.ContainerTreeNode)?this.parentNode.isDropAllowed(b):false
}},isDropAllowed:function(b){var c=false;
if(this.attributes.allowedChilds){for(var a=0;
a<this.attributes.allowedChilds.length;
a++){if(this.attributes.allowedChilds[a]==b){c=true;
break
}}}else{c=true
}return c
},handleDrop:function(c){var a=this.getEventRecord(c);
var b=CQ.Util.copyObject(a.get("insertCfg"));
if(c.point=="append"){this.insert(b,c.point)
}else{this.parentNode.insert(b,c.point,this)
}CQ.DialogEditor.ContainerTreeNode.superclass.handleDrop.call(this)
},handleReorder:function(g){var b=g.dropNode.parentNode.getWidgetConfig();
var a=g.dropNode.getWidgetConfig();
var j=g.target.getWidgetConfig();
var c;
if(g.point=="append"){c=g.target.getWidgetConfig()
}else{c=g.target.parentNode.getWidgetConfig()
}this.reorder(a,j,b,c,g.point);
CQ.DialogEditor.ContainerTreeNode.superclass.handleReorder.call(this)
},reorder:function(b,n,j,o,k){for(var c in j.items){if(j.items[c]==b){delete j.items[c]
}}var a=this.getEditor().getNextPropName();
if(k=="append"){if(!o.items){o.items=b
}else{if(o.items[CQ.DialogEditor.JCR_PRIMARY_TYPE]==CQ.DialogEditor.NT_COLLECTION){o.items[a]=b
}else{var q=o.items;
o.items={};
o.items[CQ.DialogEditor.JCR_PRIMARY_TYPE]=CQ.DialogEditor.NT_COLLECTION;
o.items[a]=q;
o.items[this.getEditor().getNextPropName()]=b
}}}else{if(k=="above"){var g=this.getPropertyIndex(o.items,n);
var m=this.insertProperty(o.items,a,b,g);
o.items=m
}else{if(k=="below"){var g=this.getPropertyIndex(o.items,n)+1;
var m=this.insertProperty(o.items,a,b,g);
o.items=m
}}}},remove:function(a){this.removeProperty(this.getWidgetConfig().items,a.getWidgetConfig());
if(this.getWidgetConfig().items[CQ.DialogEditor.JCR_PRIMARY_TYPE]!=CQ.DialogEditor.NT_COLLECTION){delete this.getWidgetConfig().items
}else{if(!this.containsObjects(this.getWidgetConfig().items)){delete this.getWidgetConfig().items
}}this.removeChild(a);
this.updatePreview()
},insert:function(j,a,b){var n=this.getEditor().getNextPropName();
var m=CQ.DialogEditor.createDialogTreeNode(CQ.DialogEditor.MAPPINGS[j.xtype],n,null,this.getEditor());
m.setWidgetConfig(j);
if(a=="append"){this.appendChild(m);
if(!this.getWidgetConfig().items){this.getWidgetConfig().items=j
}else{if(this.getWidgetConfig().items[CQ.DialogEditor.JCR_PRIMARY_TYPE]==CQ.DialogEditor.NT_COLLECTION){this.getWidgetConfig().items[n]=j
}else{var k=this.getWidgetConfig().items;
this.getWidgetConfig().items={};
this.getWidgetConfig().items[CQ.DialogEditor.JCR_PRIMARY_TYPE]=CQ.DialogEditor.NT_COLLECTION;
this.getWidgetConfig().items[n]=k;
this.getWidgetConfig().items[this.getEditor().getNextPropName()]=j
}}}else{if(a=="above"){this.insertBefore(m,b);
var g=this.getPropertyIndex(this.getWidgetConfig().items,b.getWidgetConfig());
var c=this.insertProperty(this.getWidgetConfig().items,n,j,g);
this.getWidgetConfig().items=c
}else{if(a=="below"){if(b.nextSibling){this.insertBefore(m,b.nextSibling);
var g=this.getPropertyIndex(this.getWidgetConfig().items,b.getWidgetConfig())+1;
var c=this.insertProperty(this.getWidgetConfig().items,n,j,g);
this.getWidgetConfig().items=c
}else{this.appendChild(m);
this.getWidgetConfig().items[n]=j
}}}}m.select();
this.getEditor().props.showProperties(m)
},getContextMenuActions:function(){if(CQ.DialogEditor.getXType(this.parentNode.getWidgetConfig())=="dialog"){return[]
}return[{text:CQ.I18n.getMessage("Remove"),handler:function(){this.parentNode.remove(this)
},scope:this,tooltip:{title:CQ.I18n.getMessage("Remove Container"),text:CQ.I18n.getMessage("Removes the container widget from the dialog"),autoHide:true}}]
},afterPropChange:function(){this.setText(this.getWidgetConfig().title);
CQ.DialogEditor.ContainerTreeNode.superclass.updatePreview.call(this)
}});
CQ.DialogEditor.FieldTreeNode=CQ.Ext.extend(CQ.DialogEditor.TreeNode,{isInsertAllowed:function(b){var a=this.getEventRecord(b);
var c;
if(a&&a.get("insertCfg")){c=a.get("insertCfg").xtype
}else{c=CQ.DialogEditor.getXType(b.dropNode.getWidgetConfig())
}return(b.point!="append")&&this.parentNode.isDropAllowed(c)
},isReorderAllowed:function(a){var b;
if(a.dropNode.attributes.insertCfg){b=a.dropNode.attributes.insertCfg.xtype
}else{b=CQ.DialogEditor.getXType(a.dropNode.getWidgetConfig())
}return(a.point!="append")&&this.parentNode.isDropAllowed(b)
},handleDrop:function(c){var a=this.getEventRecord(c);
var b=a.get("insertCfg");
this.parentNode.insert(b,c.point,this);
CQ.DialogEditor.FieldTreeNode.superclass.handleDrop.call(this)
},handleReorder:function(g){var b=g.dropNode.parentNode.getWidgetConfig();
var c=g.target.parentNode.getWidgetConfig();
var a=g.dropNode.getWidgetConfig();
var j=g.target.getWidgetConfig();
this.parentNode.reorder(a,j,b,c,g.point);
CQ.DialogEditor.FieldTreeNode.superclass.handleReorder.call(this)
},getContextMenuActions:function(){return[{text:CQ.I18n.getMessage("Remove"),handler:function(){this.parentNode.remove(this)
},scope:this,tooltip:{title:CQ.I18n.getMessage("Remove Field"),text:CQ.I18n.getMessage("Removes the field from the dialog"),autoHide:true}}]
},afterPropChange:function(){this.setText(this.getWidgetConfig().fieldLabel);
CQ.DialogEditor.FieldTreeNode.superclass.updatePreview.call(this)
}});
CQ.DialogEditor.DialogTreeNode=CQ.Ext.extend(CQ.DialogEditor.TreeNode,{afterPropChange:function(){this.setText(this.getWidgetConfig().title);
CQ.DialogEditor.DialogTreeNode.superclass.updatePreview.call(this)
},remove:function(a){this.removeProperty(this.getWidgetConfig(),a.getWidgetConfig());
this.removeChild(a);
this.updatePreview()
},isInsertAllowed:function(b){var a=this.getEventRecord(b);
if(a&&a.get("text")&&(a.get("text")==CQ.I18n.getMessage("Buttons"))&&(!this.getWidgetConfig().buttons)){return true
}return false
},handleDrop:function(c){var a=this.getEventRecord(c);
this.getWidgetConfig().buttons=a.get("insertCfg");
var b=new CQ.DialogEditor.ButtonsTreeNode({name:"buttons",text:CQ.I18n.getMessage("Buttons"),editor:this.getEditor()});
b.setWidgetConfig(this.getWidgetConfig().buttons);
this.appendChild(b);
CQ.DialogEditor.DialogTreeNode.superclass.handleDrop.call(this)
}});
CQ.DialogEditor.ButtonsTreeNode=CQ.Ext.extend(CQ.DialogEditor.TreeNode,{isInsertAllowed:function(b){var a=this.getEventRecord(b);
if(a&&(a.get("category")==CQ.DialogEditor.BUTTON)){return true
}return false
},handleDrop:function(j){if(!this.getWidgetConfig()){this.setWidgetConfig({});
this.getWidgetConfig()[CQ.DialogEditor.JCR_PRIMARY_TYPE]=CQ.DialogEditor.NT_WIDGET_COLLECTION
}var a=this.getEventRecord(j);
var c=CQ.Util.copyObject(a.get("insertCfg"));
var b=this.getEditor().getNextPropName();
this.getWidgetConfig()[b]=c;
var g=CQ.DialogEditor.createButtonTreeNode(c.text,this.getEditor());
g.setWidgetConfig(c);
this.appendChild(g);
CQ.DialogEditor.ButtonsTreeNode.superclass.handleDrop.call(this)
},getContextMenuActions:function(){return[{text:CQ.I18n.getMessage("Remove"),handler:function(){this.parentNode.remove(this)
},scope:this,tooltip:{title:CQ.I18n.getMessage("Remove Buttons Container"),text:CQ.I18n.getMessage("Removes the buttons container from the dialog"),autoHide:true}}]
},remove:function(a){this.removeProperty(this.getWidgetConfig(),a.getWidgetConfig());
this.removeChild(a);
this.updatePreview()
}});
CQ.DialogEditor.ButtonTreeNode=CQ.Ext.extend(CQ.DialogEditor.TreeNode,{afterPropChange:function(){this.setText.call(this,this.getWidgetConfig().text);
CQ.DialogEditor.DialogTreeNode.superclass.updatePreview.call(this)
},getProperties:function(){return CQ.Ext.applyIf(this.getWidgetConfig(),CQ.DialogEditor.MAPPINGS.button.propList)
},getContextMenuActions:function(){return[{text:CQ.I18n.getMessage("Remove"),handler:function(){this.parentNode.remove(this)
},scope:this,tooltip:{title:CQ.I18n.getMessage("Remove Button"),text:CQ.I18n.getMessage("Removes the button from the dialog"),autoHide:true}}]
}});
CQ.DialogEditor.DragZone=function(a,b){this.view=a;
CQ.DialogEditor.DragZone.superclass.constructor.call(this,a.getEl(),b)
};
CQ.Ext.extend(CQ.DialogEditor.DragZone,CQ.Ext.dd.DragZone,{getDragData:function(k){var j=k.getTarget(".x-control");
if(j){var a=this.view;
if(!a.isSelected(j)){a.onClick(k)
}var c=a.getSelectedNodes();
var b=a.getSelectedRecords();
var g={nodes:c,records:b};
g.ddel=j;
g.single=true;
return g
}return false
},afterRepair:function(){for(var b=0,a=this.dragData.nodes.length;
b<a;
b++){CQ.Ext.fly(this.dragData.nodes[b]).frame("#8db2e3",1)
}this.dragging=false
},getRepairXY:function(b){if(!this.dragData.multi){var a=CQ.Ext.Element.fly(this.dragData.ddel).getXY();
a[0]+=3;
a[1]+=3;
return a
}return false
}});
CQ.MediaBrowseDialog=CQ.Ext.extend(CQ.Dialog,{deleteButton:null,getSelectedPath:function(){try{return this.tree.getSelectionModel().getSelectedNode().getPath()
}catch(a){return""
}},loadContent:function(a){if(typeof a=="string"){this.path=a;
this.tree.selectPath(a)
}},constructor:function(a){var b=this;
if(!a){a=new Object()
}CQ.Ext.applyIf(a,{title:CQ.I18n.getMessage("Select a media item")});
this.mediaView=new CQ.Ext.DataView({cls:"cq-media-view",loadingText:CQ.I18n.getMessage("Loading media..."),templates:{thumbs:{itemSelector:".thumb-wrap",tpl:new CQ.Ext.XTemplate('<tpl for=".">','<div class="thumb-wrap">','<div class="thumb">','<img src="{[CQ.HTTP.externalize(values.path + values.img140Postfix)]}"',' qtip="{qtipTitle}: {name}<br/>',"{qtipSize}: {sizeString}<br/>","{qtipCreated}: {createdString}<br/>",'{qtipModified}: {modifiedString}"/>',"</div>","<span>{shortName}</span>","</div>","</tpl>",'<div class="x-clear"></div>')},details:{itemSelector:".detail-wrap",tpl:new CQ.Ext.XTemplate('<tpl for=".">','<div class="detail-wrap">','<div class="detail">','<img src="{[CQ.HTTP.externalize(values.path + values.img70Postfix)]}"/>','<div><span class="bold">{qtipTitle}:</span> {name}</div>','<div><span class="bold">{qtipSize}:</span> {sizeString}</div>','<div><span class="bold">{qtipCreated}:</span> {createdString}</div>','<div><span class="bold">{qtipModified}:</span> {modifiedString}</div>',"</div>","</div>",'<div class="x-clear"></div>',"</tpl>")}},multiSelect:false,singleSelect:true,overClass:"x-view-over",emptyText:CQ.I18n.getMessage("No media items to display"),prepareData:function(c){c.qtipTitle=CQ.I18n.getMessage("Title");
c.shortName=CQ.Ext.util.Format.ellipsis(c.name,15);
c.qtipSize=CQ.I18n.getMessage("Size");
c.sizeString=CQ.Ext.util.Format.fileSize(c.size);
c.qtipCreated=CQ.I18n.getMessage("Created");
c.createdString=c.created.format(CQ.themes.MediaBrowseDialog.MEDIA_DATE);
c.qtipModified=CQ.I18n.getMessage("Last Modified");
c.modifiedString=c.lastmod.format(CQ.themes.MediaBrowseDialog.MEDIA_DATE);
c.img140Postfix=".thumb.100.140.png";
c.img70Postfix=".thumb.50.70.png";
return c
},listeners:{render:function(c){c.loadMask=new CQ.Ext.LoadMask(c.getEl(),{store:this.store});
c.dragZone=new CQ.MediaBrowseDialog.DragZone(c,{containerScroll:true});
c.dragZone.addToGroup(CQ.wcm.EditBase.DD_GROUP_ASSET);
c.dragZone.removeFromGroup(CQ.wcm.EditBase.DD_GROUP_DEFAULT)
},selectionchange:function(g,c){if(!b.deleteButton){b.deleteButton=b.findByType("panel")[1].getTopToolbar().items.get(1)
}if(c.length==0){b.deleteButton.disable()
}else{b.deleteButton.enable()
}}}});
this.mediaView.tpl=this.mediaView.templates.thumbs.tpl;
this.mediaView.itemSelector=this.mediaView.templates.thumbs.itemSelector;
if(!a.treeRoot){a.treeRoot=new Object()
}this.treeRootConfig=CQ.Ext.applyIf(a.treeRoot,{name:"content/dam",text:CQ.I18n.getMessage("Media"),draggable:false,expanded:true});
if(!a.treeLoader){a.treeLoader=new Object()
}this.treeLoaderConfig=CQ.Ext.applyIf(a.treeLoader,{baseParams:{predicate:"hierarchy"},requestMethod:"GET",dataUrl:"/bin/tree/ext.json",baseAttrs:{singleClickExpand:true,draggable:false},listeners:{beforeload:function(c,g){this.baseParams.path=g.getPath()
}}});
this.tree=new CQ.Ext.tree.TreePanel({lines:false,animate:true,enableDD:false,containerScroll:true,autoScroll:true,split:true,region:"north",height:115,loader:new CQ.Ext.tree.TreeLoader(this.treeLoaderConfig),root:new CQ.Ext.tree.AsyncTreeNode(this.treeRootConfig),listeners:{click:function(g,c){b.loadMedia.call(b,g.getPath())
}}});
a=CQ.Util.merge(a,{closable:true,cls:"cq-mediabrowse",height:CQ.themes.MediaBrowseDialog.HEIGHT,minHeight:CQ.themes.MediaBrowseDialog.MIN_HEIGHT,width:CQ.themes.MediaBrowseDialog.WIDTH,minWidth:CQ.themes.MediaBrowseDialog.MIN_WIDTH,autoHeight:false,autoWidth:false,resizable:CQ.themes.MediaBrowseDialog.RESIZABLE,resizeHandles:CQ.themes.MediaBrowseDialog.RESIZE_HANDLES,items:{xtype:"panel",layout:"border",autoScroll:false,border:false,items:[this.tree,new CQ.Ext.Panel({autoEl:"div",region:"center",autoScroll:true,collapsible:true,items:[this.mediaView],tbar:[{text:CQ.I18n.getMessage("Upload"),tooltip:{title:CQ.I18n.getMessage("Upload Media"),text:CQ.I18n.getMessage("Allows uploading media items to the selected location"),autoHide:true},handler:function(){var g=CQ.utils.Util.getFlashVersion();
var c=(g!=null)&&(g[0]>=9);
var k;
c=false;
if(c){k={"jcr:primaryType":"cq:Dialog",title:CQ.I18n.getMessage("Upload Media to")+": "+b.getSelectedPath(),formUrl:b.getSelectedPath(),items:{"jcr:primaryType":"cq:Panel",items:{"jcr:primaryType":"cq:WidgetCollection",file:{xtype:"html5smartfile",allowUploadOnly:true,simpleUpload:true,fieldLabel:CQ.I18n.getMessage("File"),autoUploadDelay:"-1",sizeLimit:"1000",name:"./*",uploadUrl:"/tmp/media_upload"+b.getSelectedPath()}}}}
}else{k={"jcr:primaryType":"cq:Dialog",title:CQ.I18n.getMessage("Upload Media to")+": "+b.getSelectedPath(),formUrl:b.getSelectedPath(),fileUpload:true,items:{"jcr:primaryType":"cq:Panel",items:{"jcr:primaryType":"cq:WidgetCollection",file:{xtype:"fileuploadfield",fieldLabel:CQ.I18n.getMessage("File"),name:"./*"}}}}
}var j=CQ.WCM.getDialog(k);
j.failure=function(){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not upload media."))
};
j.success=function(){if(b.mediaView.store!=null){b.mediaView.store.reload()
}};
j.show()
}},{text:CQ.I18n.getMessage("Delete"),disabled:true,tooltip:{title:CQ.I18n.getMessage("Delete Media"),text:CQ.I18n.getMessage("Deletes the selected media"),autoHide:true},handler:function(){var n=CQ.I18n.getMessage("You are going to delete the following media: ")+"<br/>";
var j=b.mediaView;
var m=j.getSelectedRecords();
var o=j.getSelectedNodes();
for(var g=0;
g<m.length;
g++){n+=(m[g].data.name?m[g].data.name:m[g].data.path)+"<br/>"
}n+="<br/>"+CQ.I18n.getMessage("Are you sure?");
var k=CQ.I18n.getMessage("Delete Page?");
var c=this;
CQ.Ext.Msg.show({title:k,msg:n,buttons:CQ.Ext.Msg.YESNO,icon:CQ.Ext.MessageBox.QUESTION,fn:function(v){if(v=="yes"){var u=[];
var r=[];
for(var t=0;
t<m.length;
t++){var q=m[t];
u.push(q.data.path)
}CQ.HTTP.post("/bin/wcmcommand",function(x,A,w){if(A){for(var y=0;
y<o.length;
y++){var z=o[y];
j.deselect(z);
z.style.display="none"
}}else{CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getVarMessage(w.message))
}},{path:u,_charset_:"utf-8",cmd:"deletePage",deep:true})
}},scope:this})
}},"->",{text:CQ.I18n.getMessage("Thumbnails"),toggleGroup:"view",view:"thumbs",enableToggle:true,toggleHandler:b.switchView,scope:b,pressed:true,allowDepress:false,tooltip:{title:CQ.I18n.getMessage("Thumbnails View"),text:CQ.I18n.getMessage("Switch to thumbnails view"),autoHide:true}},{text:CQ.I18n.getMessage("Details"),toggleGroup:"view",view:"details",enableToggle:true,toggleHandler:b.switchView,scope:b,pressed:false,allowDepress:false,tooltip:{title:CQ.I18n.getMessage("Details View"),text:CQ.I18n.getMessage("Switch to details view"),autoHide:true}}]})]}});
CQ.MediaBrowseDialog.superclass.constructor.call(this,a);
this.tree.selectPath(this.tree.getRootNode().id);
this.loadMedia(this.tree.getRootNode().getPath())
},loadMedia:function(b){var a=new CQ.Ext.data.JsonStore({url:b+".media.json",root:"items",fields:["name","path",{name:"size",type:"float"},{name:"created",type:"date",dateFormat:"timestamp"},{name:"lastmod",type:"date",dateFormat:"timestamp"}]});
this.mediaView.setStore(a);
this.mediaView.store.reload()
},switchView:function(a,b){if(b){this.mediaView.tpl=this.mediaView.templates[a.view].tpl;
this.mediaView.itemSelector=this.mediaView.templates[a.view].itemSelector
}if(this.mediaView.store!=null){this.mediaView.refresh()
}}});
CQ.Ext.reg("mediabrowsedialog",CQ.MediaBrowseDialog);
CQ.MediaBrowseDialog.DragZone=CQ.Ext.extend(CQ.Ext.dd.DragZone,{constructor:function(a,b){this.view=a;
CQ.MediaBrowseDialog.DragZone.superclass.constructor.call(this,a.getEl(),b)
},getDragData:function(m){var n=m.getTarget(this.view.itemSelector);
if(n){var o=this.view;
if(!o.isSelected(n)){o.onClick(m)
}var b=o.getSelectedNodes();
var j=o.getSelectedRecords();
var c={nodes:b,records:j};
if(b.length==1){c.ddel=n.firstChild.firstChild;
c.single=true
}else{var a=document.createElement("div");
a.className="multi-proxy";
for(var g=0,k=b.length;
g<k;
g++){a.appendChild(b[g].firstChild.firstChild.cloneNode(true));
if((g+1)%2==0){a.appendChild(document.createElement("br"))
}}c.ddel=a;
c.multi=true
}return c
}return false
},afterRepair:function(){for(var b=0,a=this.dragData.nodes.length;
b<a;
b++){CQ.Ext.fly(this.dragData.nodes[b]).frame("#8db2e3",1)
}this.dragging=false
},getRepairXY:function(b){if(!this.dragData.multi){var a=CQ.Ext.Element.fly(this.dragData.ddel).getXY();
a[0]+=3;
a[1]+=3;
return a
}return false
},notifyDropDT:function(c,b,a){if(this.isDropAllowed(c)){if(c.groups){if(c.groups[CQ.wcm.EditBase.DD_GROUP_ASSET]){return c.editComponent.updateParagraph(c.propertyName,a.records[0].data.path,c.postParams)
}}else{return c.editComponent.updateParagraph(c.propertyName,a.records[0].data.path,c.postParams)
}}return false
},notifyEnterDT:function(c,b,a){return""
},notifyOutDT:function(c,b,a){return""
},notifyOverDT:function(c,b,a){if(this.isDropAllowed(c)){return this.dropAllowed
}else{return this.dropNotAllowed
}},isDropAllowed:function(a){if(a&&a.groups&&CQ.Util.isIntersecting(this.groups,a.groups)){return true
}return false
}});
CQ.Switcher=CQ.Ext.extend(CQ.Ext.Toolbar,{constructor:function(a){try{a=CQ.Util.applyDefaults(a,{id:"cq-switcher",columnWidth:0.8});
a.items=this.setUpButtons(a);
CQ.Switcher.superclass.constructor.call(this,a)
}catch(b){CQ.Log.error(b.message)
}},setUpButtons:function(j){var g=CQ.User.getCurrentUser().getAllowedApps();
var c=new Array();
var m=this;
for(var k in g){if(!g.hasOwnProperty(k)){continue
}var n=g[k];
var b=n.appName?n.appName:CQ.I18n.getMessage("AEM Console");
var a=n.iconClass?n.iconClass:"siteadmin";
a=(this.isActive(n))?a:a+"-inactive";
if(CQ.Ext.isIE6){a+="-ie6"
}c.push(new CQ.Ext.Toolbar.Button({tooltip:CQ.I18n.getVarMessage(b),iconCls:"cq-switcher-"+a,disabled:false,scope:this,handler:this.doSwitch,app:n,scale:"large",handleMouseEvents:false}))
}return c
},isActive:function(b){var a=window.location.pathname;
return((a.match("^"+b.path)==b.path)||(a.match("^"+b.vanityPath)==b.vanityPath))
},doSwitch:function(c,a){var j=c.app;
var g=j.vanityPath?j.vanityPath:j.path;
if(!this.isActive(j)){var b=CQ.Util.externalize(g);
if(a.shiftKey){CQ.shared.Util.open(b)
}else{CQ.shared.Util.load(b)
}}}});
CQ.Ext.reg("switcher",CQ.Switcher);
CQ.HistoryButton=CQ.Ext.extend(CQ.Ext.Toolbar.Button,{id:null,forwardId:null,forwardHandler:null,backHandler:null,historyId:null,pos:0,stack:null,constructor:function(a){if(a.historyId){a=CQ.Util.applyDefaults(a,{tooltip:CQ.I18n.getMessage("Go Forward"),disabled:true,scope:this,forwardHandler:a.forwardHandler,handler:function(){try{var c=CQ.Ext.getCmp(this.historyId);
c.goForward()
}catch(b){}},text:"&raquo;"})
}else{a=CQ.Util.applyDefaults(a,{tooltip:CQ.I18n.getMessage("Go Back"),disabled:true,scope:this,backHandler:a.backHandler,handler:this.goBack,text:"&laquo;"});
this.stack=new Array()
}CQ.HistoryButton.superclass.constructor.call(this,a)
},goForward:function(){if(this.forwardHandler){this.pos=this.pos+1;
this.forwardHandler(this.stack[this.pos]);
if(this.pos==(this.stack.length-1)){this.forwardButton.setDisabled(true)
}this.setDisabled(false)
}},goBack:function(){if(this.backHandler){this.pos=this.pos-1;
var a=this.stack[this.pos];
this.backHandler(a);
if(this.pos==0){this.setDisabled(true)
}this.forwardButton.setDisabled(false)
}},addHistory:function(a){if(this.pos+1!=this.stack.length){this.stack.splice(this.pos+1)
}this.stack.push(a);
this.pos=this.stack.length-1;
if(!this.forwardButton){this.forwardButton=CQ.Ext.getCmp(this.forwardId)
}this.setDisabled(false);
this.forwardButton.setDisabled(true)
}});
CQ.Ext.reg("historybutton",CQ.HistoryButton);
CQ.CustomContentPanel=CQ.Ext.extend(CQ.Ext.Panel,{urlGET:null,pathGet:null,urlPOST:null,pathPost:null,urlExtensionGET:null,extensionGet:null,urlExtensionPOST:null,extensionPost:null,executePost:true,urlGet:null,urlPost:null,constructor:function(a){a=(!a?{}:a);
var b={};
CQ.Util.applyDefaults(a,b);
this.formPanel=this;
CQ.CustomContentPanel.superclass.constructor.call(this,a)
},initComponent:function(){CQ.CustomContentPanel.superclass.initComponent.call(this);
var a=this;
this.on("render",function(){this.parentDialog=this.findParentByType("dialog");
if(this.parentDialog){this.parentDialog.on("loadcontent",function(b){a.computeUrlGET(this.path);
a.loadContent()
},this.parentDialog);
this.parentDialog.on("beforesubmit",function(){a.computeUrlPOST(this.path);
a.submitPanel(a.urlPost)
},this.parentDialog)
}},this)
},computeUrlGET:function(a){this.urlGet=(this.pathGet||this.urlGET)?this.pathGet||this.urlGET:a;
if(this.extensionGet||this.urlExtensionGET){this.urlGet+=this.extensionGet||this.urlExtensionGET
}},computeUrlPOST:function(a){this.urlPost=(this.pathPost||this.urlPOST)?this.pathPost||this.urlPOST:a;
if(this.extensionPost||this.urlExtensionPost){this.urlPost+=this.extensionPost||this.urlExtensionPost
}},submitPanel:function(){var a=CQ.Util.findFormFields(this.formPanel);
if(!this.disabled){var g={};
for(var b in a){for(var c=0;
c<a[b].length;
c++){if(!a[b][c].disabled){if(!g[b]){g[b]=new Array()
}g[b]=g[b].concat(a[b][c].getValue());
a[b][c].disable()
}}}if(this.executePost){var j=CQ.utils.HTTP.post(this.urlPost,null,g,this);
return CQ.utils.HTTP.isOk(j)
}}else{for(var b in a){for(var c=0;
c<a[b].length;
c++){a[b][c].disable()
}}}return false
},loadContent:function(){var a=null;
if(!this.content){var b=CQ.HTTP.externalize(this.urlGet);
a=new CQ.data.SlingStore({url:b})
}else{if(this.content instanceof CQ.Ext.data.Store){a=this.content
}}a.load({callback:this.processRecords,scope:this})
},processRecords:function(j,g,n){var m;
if(n){m=j[0]
}else{CQ.Log.warn("CQ.CustomContentPanel#processRecords: retrieval of records unsuccessful");
m=new CQ.data.SlingRecord();
m.data={}
}CQ.Log.debug("CQ.CustomContentPanel#processRecords: processing records for fields");
var a=CQ.Util.findFormFields(this.formPanel);
for(var b in a){for(var c=0;
c<a[b].length;
c++){try{if((!a[b][c].initialConfig||!a[b][c].initialConfig.disabled)&&a[b][c].enable){a[b][c].enable()
}if(a[b][c].processPath){CQ.Log.debug("CQ.CustomContentPanel#processRecords: calling processPath of field '{0}'",[b]);
a[b][c].processPath(this.path)
}if(!a[b][c].initialConfig.ignoreData){CQ.Log.debug("CQ.CustomContentPanel#processRecords: calling processRecord of field '{0}'",[b]);
a[b][c].processRecord(m,this.path)
}}catch(k){CQ.Log.debug("CQ.CustomContentPanel#processRecords: {0}",k.message)
}}}this.fireEvent("loadcontent",this)
}});
CQ.Ext.reg("customcontentpanel",CQ.CustomContentPanel);
CQ.WrappingToolbar=CQ.Ext.extend(CQ.Ext.Toolbar,{rewrapWidth:null,constructor:function(a){CQ.WrappingToolbar.superclass.constructor.call(this,a)
},getTableCells:function(a,c){var b=CQ.Ext.DomQuery.select("td[class=x-toolbar-cell]",a);
c.push.apply(c,b)
},rewrap:function(x){var n=this.el.dom;
var B=n.childNodes;
var m=[];
for(var u=0;
u<B.length;
u++){var o=B[u];
this.getTableCells(o,m)
}var G=[];
var b={width:0,cells:[],sepWidth:0,sepCell:null};
G.push(b);
for(var A=0;
A<m.length;
A++){var z=m[A].clientWidth;
var D=(CQ.Ext.DomQuery.select("span[class=xtb-sep]",m[A]).length==1);
if(D){b.sepWidth=z;
b.sepCell=m[A];
b={width:0,cells:[],sepWidth:0,sepCell:0};
G.push(b)
}else{b.width+=z;
b.cells.push(m[A])
}}var F=CQ.Ext.DomQuery.select("td[class=x-toolbar-left]>table",n);
var y=F.length;
for(var v=0;
v<y;
v++){F[v].parentNode.removeChild(F[v])
}var w=CQ.Ext.DomQuery.select("td[class=x-toolbar-left]",n)[0];
var a=0;
var k=null;
var C=0;
while(C<G.length){if(a==0){var E=document.createElement("table");
E.cellSpacing=0;
w.appendChild(E);
var j=document.createElement("tbody");
E.appendChild(j);
k=document.createElement("tr");
var I=CQ.Ext.get(k);
I.addClass("x-toolbar-left-row");
j.appendChild(k)
}var q=a+G[C].width+G[C].sepWidth;
if((a>0)&&(q>x)){a=0
}else{for(var H=0;
H<G[C].cells.length;
H++){k.appendChild(G[C].cells[H])
}if(G[C].sepCell){k.appendChild(G[C].sepCell)
}a=q;
C++
}}},onResize:function(a,b){if(typeof(a)=="object"){a=a.width
}if(a&&(a!=this.rewrapWidth)){this.rewrap(a);
this.rewrapWidth=a
}CQ.WrappingToolbar.superclass.onResize.call(this,a,b)
}});
CQ.IframePanel=CQ.Ext.extend(CQ.Ext.Panel,{iframe:null,setUrl:function(a){var b=this.getIframe();
if(b){b.src=a
}},getUrl:function(){var a=this.getIframe();
if(a){return a.src
}return null
},getIframe:function(){if(!this.iframe){if(this.iframeID){this.iframe=document.getElementById(this.iframeID)
}}return this.iframe
},getDoc:function(){var a=this.getIframe();
if(a){return a.contentWindow.document
}return null
},getContentWin:function(){var a=this.getIframe();
if(a){return a.contentWindow
}return null
},constructor:function(c){var j=c.id;
if(!j){j=CQ.Ext.id()
}this.iframeID=j+"-iframe";
var b='CQ.Ext.getCmp("'+j+'").onIframeLoad(this, event)';
var a=c.iframeStyle||"width:100%; height:100%; border:0px;";
var g="<iframe id='"+this.iframeID+"' onload='"+b+"' style='"+a+"' ";
if(CQ.Ext.isIE){g=g+"frameborder='0' "
}if(c.url){g=g+"src='"+c.url+"'"
}g=g+"/>";
CQ.Util.applyDefaults(c,{cls:"cq-iframe-panel",id:j,html:g});
CQ.IframePanel.superclass.constructor.call(this,c)
},initComponent:function(){CQ.IframePanel.superclass.initComponent.call(this);
this.addEvents("iframeload")
},onIframeLoad:function(a,b){this.iframe=a;
this.fireEvent("iframeload",this,a,b)
},onDestroy:function(){var a=this.getIframe();
if(a&&a.parentNode){a.parentNode.removeChild(a);
this.iframe=null
}CQ.IframePanel.superclass.onDestroy.call(this)
}});
CQ.Ext.reg("iframepanel",CQ.IframePanel);
CQ.IframeDialog=CQ.Ext.extend(CQ.Dialog,{iframePanel:null,submitted:false,getIframePanel:function(){if(!this.iframePanel){this.iframePanel=this.findByType("iframepanel")[0]
}return this.iframePanel
},getDoc:function(){var a=this.getIframePanel();
if(a){return a.getDoc()
}return null
},getContentWin:function(){var a=this.getIframePanel();
if(a){return a.getContentWin()
}return null
},getIframeForm:function(){var a=this.getIframePanel();
if(a){var b=a.getContentWin();
if(b[this.iframeFormName]){return b[this.iframeFormName]
}else{var c=a.getDoc().forms[this.iframeFormName];
return new CQ.form.FormWrapper({form:c})
}}return null
},buildIframeUrl:function(b){if(this.pathSuffix){var a=(b.charAt(b.length-1)==="/");
var c=(this.pathSuffix.charAt(0)==="/");
if(a&&c){b=b+this.pathSuffix.substr(1)
}else{if(a||c){b=b+this.pathSuffix
}else{b=b+"/"+this.pathSuffix
}}}if(this.formPath){if(b.charAt(b.length-1)==="/"){b=b+".form.create.html"+this.formPath
}else{b=b+".form.html"+this.formPath
}}if(window.location.search&&window.location.search.indexOf("debugClientLibs=true")!=-1){b=CQ.HTTP.addParameter(b,"debugClientLibs","true")
}if(!this.allowEditMode){b=CQ.HTTP.addParameter(b,CQ.WCM.MODE_COOKIE,"disabled")
}return b
},constructor:function(a){this.formPath=a.formPath;
this.allowEditMode=a.allowEditMode;
this.pathSuffix=a.pathSuffix;
this.iframeFormName=a.iframeFormName||"formpage_form";
this.okText=a.okText?a.okText:CQ.I18n.getMessage("OK");
this.cancelText=a.cancelText?a.cancelText:CQ.I18n.getMessage("Cancel");
CQ.Util.applyDefaults(a,{cls:"cq-iframe-dialog",plain:false,bodyStyle:"",maskMsg:CQ.I18n.getMessage("Loading..."),maskCls:"x-mask-loading"});
var b={xtype:"iframepanel",border:false,listeners:{iframeload:this.onIframeLoad,scope:this}};
if(a.iframeStyle){b.iframeStyle=a.iframeStyle
}a.items=b;
CQ.IframeDialog.superclass.constructor.call(this,a)
},initComponent:function(){CQ.IframeDialog.superclass.initComponent.call(this);
this.setButtonsDisabled(true);
this.addEvents("iframeformload")
},loadContent:function(b){if(typeof b==="string"){this.setButtonsDisabled(true);
if(this.maskMsg){this.body.mask(this.maskMsg,this.maskCls)
}var c=this.getIframePanel();
if(c){var a=this.buildIframeUrl(b);
if(a){a=CQ.HTTP.externalize(a);
this.submitted=false;
c.setUrl(a)
}}}},setButtonsDisabled:function(a){CQ.Ext.each(this.buttons,function(c){c.setDisabled(a)
})
},onIframeLoad:function(a,c,j){CQ.WCM.setContentWindowLoading(false);
if(this.submitted){var b={};
if(this.responseScope){b={scope:this.responseScope,success:this.success?this.success:this.responseScope.success,failure:this.failure?this.failure:this.responseScope.failure}
}else{if(this.success){b.success=this.success
}if(this.failure){b.failure=this.failure
}}if(typeof b.success==="function"){b.success.apply(b.scope,[this,{}])
}}else{this.setButtonsDisabled(false);
if(this.maskMsg){this.body.unmask()
}var g=this.getIframeForm();
if(g){g.on("beforesubmit",function(){if(this.fireEvent("beforesubmit",this)===false){return false
}this.submitted=true;
this.hide()
},this)
}this.fireEvent("loadContent",this)
}},ok:function(){this.submit()
},submit:function(b){var a=this.getIframeForm();
if(a&&a.submit(b)){this.submitted=true;
this.hide();
return true
}return false
},onDestroy:function(){var a=this.getIframePanel();
if(a){a.destroy();
this.iframePanel=null
}CQ.IframeDialog.superclass.onDestroy.call(this)
}});
CQ.Ext.reg("iframedialog",CQ.IframeDialog);
CQ.form.SlingSubmitAction=CQ.Ext.extend(CQ.Ext.form.Action.Submit,{type:"slingsubmit",success:function(b){var a=this.processResponse(b);
if(a.Status&&a.Status.indexOf("2")==0){if(CQ.undo.UndoManager.isEnabled()){CQ.undo.UndoManager.getHistory().onSuccessfulFormSubmit(this.form)
}this.form.afterAction(this,b,true);
return
}this.form.afterAction(this,false)
},handleResponse:function(g){if(this.form.errorReader){var c=this.form.errorReader.read(g);
var m=[];
if(c.records){for(var j=0,a=c.records.length;
j<a;
j++){var k=c.records[j];
m[j]=k.data
}}if(m.length<1){m=null
}return{success:c.success,errors:m}
}var b=CQ.Util.evalHTML(g.responseText);
return b
}});
CQ.form.UploadSubmitAction=CQ.Ext.extend(CQ.form.SlingSubmitAction,{type:"uploadsubmit",loginToken:null,run:function(){var b=this.options;
var c=this.getMethod();
var a=c=="GET";
if(b.clientValidation===false||this.form.isValid()){if(this.form.flashUpload){this.form.flashUpload.setUploadURL(this.getUrl(a));
this.form.flashUpload.startUpload()
}else{CQ.Ext.Ajax.request(CQ.Ext.apply(this.createCallback(b),{form:this.form.el.dom,url:this.getUrl(a),method:c,headers:b.headers,params:!a?this.getParams():null,isUpload:true,success:b.success?b.success:this.success,failure:b.failure?b.failure:this.failure}))
}}else{if(b.clientValidation!==false){this.failureType=CQ.Ext.form.Action.CLIENT_INVALID;
this.form.afterAction(this,false)
}}return false
}});
if(!CQ.form.Action){CQ.form.Action={}
}CQ.form.Action.Submit=CQ.Ext.extend(CQ.form.SlingSubmitAction,{type:"cqsubmit"});
CQ.form.CompositeField=CQ.Ext.extend(CQ.Ext.Panel,{allowBlank:true,blankText:CQ.Ext.form.TextField.prototype.blankText,readOnly:false,defaultValue:null,ignoreData:false,invalidClass:"x-form-invalid",invalidText:"The value of this field is invalid",layout:"form",value:null,isFormField:true,dropTargets:null,initComponent:function(){CQ.form.CompositeField.superclass.initComponent.call(this);
this.addEvents("invalid","valid","beforeloadcontent","loadcontent")
},getName:function(){return this.name
},getRawValue:function(){return this.value
},getValue:function(){return this.value!=null?this.value:""
},setValue:function(a){this.value=a
},isValid:function(a){return CQ.Ext.form.Field.prototype.isValid(a)
},processRecord:function(a,c){if(this.fireEvent("beforeloadcontent",this,a,c)!==false){var b=a.get(this.getName());
if(b==undefined&&this.defaultValue!=null){if(this.isApplyDefault(a,c)){this.setValue(this.defaultValue)
}}else{this.setValue(b)
}this.fireEvent("loadcontent",this,a,c)
}},processPath:function(b,a){},isApplyDefault:function(a,c){var g=a.get("jcr:created");
if(!g&&a.data.length==0){return false
}var b=a.get("jcr:lastModified");
if(!b){b=a.get("cq:lastModified")
}return g==b
},getDropTargets:function(){return this.dropTargets
},validate:function(){if(this.disabled||this.validateValue(this.processValue(this.getRawValue()))){this.clearInvalid();
return true
}return false
},processValue:function(a){if((a===undefined)||(a===null)){a=""
}return a
},validateValue:function(a){if(a.length<1){if(this.allowBlank){this.clearInvalid();
return true
}else{this.markInvalid(this.blankText);
return false
}}if(this.vtype){var c=CQ.Ext.form.VTypes;
if(!c[this.vtype](a,this)){this.markInvalid(this.vtypeText||c[this.vtype+"Text"]);
return false
}}if(typeof this.validator=="function"){var b=this.validator(a);
if(b!==true){this.markInvalid(b);
return false
}}if(this.regex&&!this.regex.test(a)){this.markInvalid(this.regexText);
return false
}return true
},markInvalid:function(a){this.fireEvent("invalid",this,a)
},clearInvalid:function(){this.fireEvent("valid",this)
},getMessageHandler:function(){return CQ.Ext.form.MessageTargets[this.msgTarget]
},afterRender:function(){CQ.form.CompositeField.superclass.afterRender.call(this);
this.initValue()
},reset:function(){this.setValue(this.originalValue);
this.clearInvalid()
},initValue:function(){this.originalValue=this.getValue()
}});
CQ.Ext.reg("cq.compositefield",CQ.form.CompositeField);
CQ.form.ClearableComboBox=CQ.Ext.extend(CQ.Ext.form.ComboBox,{editable:false,triggerAction:"all",initComponent:function(){CQ.Ext.form.TwinTriggerField.prototype.initComponent.call(this);
CQ.Ext.form.ComboBox.prototype.initComponent.call(this)
},setValue:function(a){CQ.form.ClearableComboBox.superclass.setValue.call(this,a);
if(this.triggers&&a&&(a!="")){this.triggers[0].show()
}},listeners:{render:function(a){var b=this.getValue();
if(b&&(b!="")){this.triggers[0].show()
}}},getTrigger:CQ.Ext.form.TwinTriggerField.prototype.getTrigger,initTrigger:CQ.Ext.form.TwinTriggerField.prototype.initTrigger,trigger1Class:"x-form-clear-trigger",trigger2Class:CQ.Ext.form.ComboBox.prototype.triggerClass,hideTrigger1:true,onTrigger2Click:CQ.Ext.form.ComboBox.prototype.onTriggerClick,onTrigger1Click:function(){if(!this.disabled){this.clearValue();
this.triggers[0].hide();
this.fireEvent("clear",this)
}}});
CQ.Ext.reg("clearcombo",CQ.form.ClearableComboBox);
CQ.form.ColorField=CQ.Ext.extend(CQ.Ext.form.TriggerField,{colors:undefined,paletteCls:"x-color-palette",paletteStyle:"",constructor:function(a){a=CQ.Util.applyDefaults(a,{showHexValue:false,triggerClass:"x-form-color-trigger",defaultAutoCreate:{tag:"input",type:"text",size:"10",autocomplete:"off",maxlength:"6"},lengthText:CQ.I18n.getMessage("Hexadecimal color values must have either 3 or 6 characters."),blankText:CQ.I18n.getMessage("Must have a hexidecimal value of the format ABCDEF."),defaultColor:"FFFFFF",curColor:"ffffff",colors:new CQ.Ext.ColorPalette().colors.slice(0),maskRe:/[a-f0-9]/i,regex:/[a-f0-9]/i});
CQ.form.ColorField.superclass.constructor.call(this,a);
this.on("render",this.setDefaultColor)
},validateValue:function(a){if(!this.showHexValue){return true
}if(a.length<1){this.el.setStyle({"background-color":"#"+this.defaultColor});
if(!this.allowBlank){this.markInvalid(String.format(this.blankText,a));
return false
}return true
}if(a.length!=3&&a.length!=6){this.markInvalid(String.format(this.lengthText,a));
return false
}this.setColor(a);
return true
},validateBlur:function(){return !this.menu||!this.menu.isVisible()
},getValue:function(){return this.curColor||this.defaultColor
},setValue:function(a){CQ.form.ColorField.superclass.setValue.call(this,a);
this.setColor(a)
},setColor:function(a){this.curColor=a;
this.el.setStyle({"background-color":"#"+a,"background-image":"none"});
if(!this.showHexValue){this.el.setStyle({"text-indent":"-100px"});
if(CQ.Ext.isIE){this.el.setStyle({"margin-left":"100px"})
}}},setDefaultColor:function(){this.setValue(this.defaultColor)
},menuListeners:{select:function(a,b){this.setValue(b)
},show:function(){this.onFocus()
},hide:function(){this.focus();
var a=this.menuListeners;
this.menu.un("select",a.select,this);
this.menu.un("show",a.show,this);
this.menu.un("hide",a.hide,this)
}},handleSelect:function(b,a){this.setValue(a)
},onTriggerClick:function(){if(this.disabled){return
}if(this.menu==null){var a={colors:this.colors.slice(0),itemCls:this.paletteCls,style:this.paletteStyle};
this.menu=new CQ.Ext.menu.ColorMenu(a);
this.menu.palette.on("select",this.handleSelect,this)
}this.menu.on(CQ.Ext.apply({},this.menuListeners,{scope:this}));
this.menu.show(this.el,"tl-bl?")
}});
CQ.Ext.reg("colorfield",CQ.form.ColorField);
CQ.form.ColorList=CQ.Ext.extend(CQ.form.CompositeField,{constructor:function(a){var b=this;
this.valueField=new CQ.Ext.form.Hidden({name:a.name});
a=CQ.Util.applyDefaults(a,{items:[{xtype:"panel",border:false,bodyStyle:"padding:4px",items:[{xtype:"button",text:CQ.I18n.get("Add"),handler:function(){b.addItem()
}},this.valueField]}],listeners:{render:function(c){var g=c.findParentByType("dialog");
if(g){g.on("beforesubmit",function(k){var j=b.getValue();
b.valueField.setValue(j)
})
}}}});
CQ.form.ColorList.superclass.constructor.call(this,a)
},addItem:function(b){var a=this.insert(this.items.getCount()-1,{xtype:"colorlistitem"});
this.doLayout();
if(b){a.setValue(b)
}},getValue:function(){var a="";
var b="";
this.items.each(function(j,c,g){if(j instanceof CQ.form.ColorList.Item){a=a+b+j.getValue();
b=":"
}},this);
return a
},setValue:function(c){if((c!=null)&&(c!="")){var a=c.split(":");
for(var b=0;
b<a.length;
b++){this.addItem(a[b])
}this.doLayout()
}}});
CQ.Ext.reg("colorlist",CQ.form.ColorList);
CQ.form.ColorList.Item=CQ.Ext.extend(CQ.Ext.Panel,{constructor:function(a){this.field=new CQ.form.ColorField({width:60,name:""});
this.field.isFormField=false;
var b=this;
a=CQ.Util.applyDefaults(a,{layout:"table",border:false,layoutConfig:{columns:4},defaults:{bodyStyle:"padding:4px"},items:[{xtype:"panel",border:false,width:90,items:this.field},{xtype:"panel",border:false,items:{xtype:"button",text:"Up",handler:function(){var g=b.ownerCt;
var c=g.items.indexOf(b)-1;
if(c>=0){b.reorder(b,g,c)
}}}},{xtype:"panel",border:false,items:{xtype:"button",text:"Down",handler:function(){var g=b.ownerCt;
var c=g.items.indexOf(b)+1;
if(c<g.items.getCount()-1){b.reorder(b,g,c)
}}}},{xtype:"panel",border:false,items:{xtype:"button",text:"Remove",handler:function(){b.ownerCt.remove(b)
}}}]});
CQ.form.ColorList.superclass.constructor.call(this,a);
if(a.value){this.field.setValue(a.value)
}},reorder:function(g,c,b){var j=g.field.getValue();
c.remove(g);
var a=c.insert(b,{xtype:"colorlistitem"});
c.doLayout();
a.setValue(j)
},getValue:function(){return this.field.getValue()
},setValue:function(a){this.field.setValue(a)
}});
CQ.Ext.reg("colorlistitem",CQ.form.ColorList.Item);
CQ.form.ComponentStyles=CQ.Ext.extend(CQ.form.CompositeField,{styles:null,initialValue:null,constructor:function(b){var a=this;
this.name=b.name||"./cq:cssClass";
this.valueField=new CQ.Ext.form.Hidden({name:this.name});
this.oldValueField=new CQ.Ext.form.Hidden({name:"oldCqCssClass"});
b=CQ.Util.applyDefaults(b,{title:CQ.I18n.getMessage("Styles"),items:[this.valueField,this.oldValueField],listeners:{render:function(c){var g=c.findParentByType("dialog");
if(g){g.on("beforesubmit",function(k){var j=a.getValue();
a.valueField.setValue(j);
a.oldValueField.setValue(a.initialValue)
})
}}}});
CQ.form.ComponentStyles.superclass.constructor.call(this,b)
},getValue:function(){if(!this.styles){return
}var b="";
var g="";
for(var a in this.styles){var c=this.styles[a];
g=g+b+c.field.getValue();
b=" "
}return g
},setValue:function(k){this.value=k;
if(!this.styles){return
}for(var c in this.styles){this.styles[c].initialized=false
}if(k){var b=k.split(" ");
for(var g=0;
g<b.length;
g++){var a=b[g];
for(var c in this.styles){var j=this.styles[c];
if(j.values[a]){j.field.setValue(a);
j.initialized=true
}}}}for(var c in this.styles){var j=this.styles[c];
if(!j.initialized){j.field.setValue(j.defaultValue)
}}},processPath:function(path){if(this.styles){return
}var url=path+".style.json/cq:styles";
var self=this;
CQ.HTTP.get(url,function(opts,success,response){if(success){var json=eval("("+response.responseText+")");
self.setStyles(json)
}})
},processRecord:function(a,b){this.initialValue=a.get(this.getName());
CQ.form.ComponentStyles.superclass.processRecord.call(this,a,b)
},setStyles:function(j){this.styles=j;
for(var b in j){var g=j[b];
g.field=new CQ.form.Selection({type:"select",fieldLabel:CQ.I18n.getVarMessage((g.title||g.name)),fieldDescription:CQ.I18n.getVarMessage(g.description),options:g.options});
this.add(g.field);
g.values={};
for(var c=0;
c<g.options.length;
c++){var a=g.options[c].value;
if(g.defaultValue==undefined){g.defaultValue=a
}if(a){g.values[g.options[c].value]=true
}}}this.setValue(this.value);
this.doLayout()
}});
CQ.Ext.reg("componentstyles",CQ.form.ComponentStyles);
CQ.form.MultiField=CQ.Ext.extend(CQ.form.CompositeField,{fieldConfig:null,path:"",bodyPadding:4,fieldWidth:0,constructor:function(b){var c=this;
if(typeof b.orderable==="undefined"){b.orderable=true
}if(!b.fieldConfig){b.fieldConfig={}
}if(!b.fieldConfig.xtype){b.fieldConfig.xtype="textfield"
}b.fieldConfig.name=b.name;
b.fieldConfig.ownerCt=this;
b.fieldConfig.orderable=b.orderable;
b.fieldConfig.dragDropMode=b.dragDropMode;
if(!b.addItemLabel){b.addItemLabel=CQ.I18n.getMessage("Add Item")
}var a=new Array();
if(b.readOnly){b.fieldConfig.readOnly=true
}else{a.push({xtype:"toolbar",cls:"cq-multifield-toolbar",items:["->",{xtype:"textbutton",text:b.addItemLabel,style:"padding-right:6px",handler:function(){c.addItem()
}},{xtype:"button",iconCls:"cq-multifield-add",template:new CQ.Ext.Template('<span><button class="x-btn" type="{0}"></button></span>'),handler:function(){c.addItem()
}}]})
}this.hiddenDeleteField=new CQ.Ext.form.Hidden({name:b.name+CQ.Sling.DELETE_SUFFIX});
a.push(this.hiddenDeleteField);
if(b.typeHint){this.typeHintField=new CQ.Ext.form.Hidden({name:b.name+CQ.Sling.TYPEHINT_SUFFIX,value:b.typeHint+"[]"});
a.push(this.typeHintField)
}b=CQ.Util.applyDefaults(b,{defaults:{xtype:"multifielditem",fieldConfig:b.fieldConfig},items:[{xtype:"panel",border:false,bodyStyle:"padding:"+this.bodyPadding+"px",items:a}]});
CQ.form.MultiField.superclass.constructor.call(this,b);
if(this.defaults.fieldConfig.regex){this.defaults.fieldConfig.regex=b.fieldConfig.regex
}this.addEvents("change","removeditem")
},initComponent:function(){CQ.form.MultiField.superclass.initComponent.call(this);
this.on("resize",function(){var b=this.items.get(0);
this.calculateFieldWidth(b);
if(this.fieldWidth>0){for(var a=0;
a<this.items.length;
a++){try{this.items.get(a).field.setWidth(this.fieldWidth)
}catch(c){CQ.Log.debug("CQ.form.MultiField#initComponent: "+c.message)
}}}});
this.on("disable",function(){this.hiddenDeleteField.disable();
if(this.typeHintField){this.typeHintField.disable()
}this.items.each(function(a){if(a instanceof CQ.form.MultiField.Item){a.field.disable()
}},this)
});
this.on("enable",function(){this.hiddenDeleteField.enable();
if(this.typeHintField){this.typeHintField.enable()
}this.items.each(function(a){if(a instanceof CQ.form.MultiField.Item){a.field.enable()
}},this)
})
},afterRender:function(){CQ.form.MultiField.superclass.afterRender.call(this);
this.doLayout()
},calculateFieldWidth:function(g){try{this.fieldWidth=this.getSize().width-2*this.bodyPadding;
for(var c=0;
c<g.items.length;
c++){var b=g.items.get(c);
if(b.items&&b.items.length>0&&b.items.get(0)===g.field){continue
}var a=g.items.get(c).getSize().width;
if(a==0){this.fieldWidth=0;
return
}this.fieldWidth-=g.items.get(c).getSize().width
}}catch(j){this.fieldWidth=0
}},addItem:function(c){var b=this.insert(this.items.getCount()-1,{});
var a=this.findParentByType("form");
if(a){a.getForm().add(b.field)
}this.doLayout();
if(b.field.processPath){b.field.processPath(this.path)
}if(c){b.setValue(c)
}if(this.fieldWidth<0){return
}if(!this.fieldWidth){this.calculateFieldWidth(b)
}try{b.field.setWidth(this.fieldWidth)
}catch(g){CQ.Log.debug("CQ.form.MultiField#addItem: "+g.message)
}},processPath:function(a){this.path=a
},getValue:function(){var a=new Array();
this.items.each(function(c,b){if(c instanceof CQ.form.MultiField.Item){a[b]=c.getValue();
b++
}},this);
return a
},setValue:function(b){this.fireEvent("change",this,b,this.getValue());
var c=this.items;
c.each(function(g){if(g instanceof CQ.form.MultiField.Item){this.remove(g,true);
this.findParentByType("form").getForm().remove(g)
}},this);
this.doLayout();
if((b!=null)&&(b!="")){if(b instanceof Array||CQ.Ext.isArray(b)){for(var a=0;
a<b.length;
a++){this.addItem(b[a])
}}else{this.addItem(b)
}}}});
CQ.Ext.reg("multifield",CQ.form.MultiField);
CQ.form.MultiField.Item=CQ.Ext.extend(CQ.Ext.Panel,{constructor:function(b){var c=CQ.Util.copyObject(b.fieldConfig);
var a=new Array();
if(c.dragDropMode){this.constructDrapDropConfig(a,c)
}else{this.constructButtonConfig(a,c)
}b=CQ.Util.applyDefaults(b,{layout:"table",anchor:"100%",border:false,layoutConfig:{columns:4},defaults:{bodyStyle:"padding:3px"},items:a});
CQ.form.MultiField.Item.superclass.constructor.call(this,b);
if(b.value){this.field.setValue(b.value)
}},constructButtonConfig:function(a,b){var c=this;
this.field=CQ.Util.build(b,true);
a.push({xtype:"panel",border:false,cellCls:"cq-multifield-itemct",items:c.field});
if(!b.readOnly){if(b.orderable){a.push({xtype:"panel",border:false,items:{xtype:"button",iconCls:"cq-multifield-up",template:new CQ.Ext.Template('<span><button class="x-btn" type="{0}"></button></span>'),handler:function(){var j=c.ownerCt;
var g=j.items.indexOf(c);
if(g>0){c.reorder(j.items.itemAt(g-1))
}}}});
a.push({xtype:"panel",border:false,items:{xtype:"button",iconCls:"cq-multifield-down",template:new CQ.Ext.Template('<span><button class="x-btn" type="{0}"></button></span>'),handler:function(){var j=c.ownerCt;
var g=j.items.indexOf(c);
if(g<j.items.getCount()-1){c.reorder(j.items.itemAt(g+1))
}}}})
}a.push({xtype:"panel",border:false,items:{xtype:"button",iconCls:"cq-multifield-remove",template:new CQ.Ext.Template('<span><button class="x-btn" type="{0}"></button></span>'),handler:function(){var g=c.ownerCt;
g.remove(c);
g.fireEvent("removeditem",g)
}}})
}},constructDrapDropConfig:function(b,c){var g=this;
this.field=CQ.Util.build(c,true);
if(!c.readOnly){if(c.orderable){var a=CQ.Util.build({xtype:"button",iconCls:"cq-multifield-drag-handle",template:new CQ.Ext.Template('<span><button class="x-btn" type="{0}"></button></span>')},true);
b.push(a);
a.on("render",function(){a.dragZone=new CQ.Ext.dd.DragZone(a.getEl(),{item:g,ddGroup:c.name,getDragData:function(k){var j=a.ownerCt.getEl();
j.setVisibilityMode(CQ.Ext.Element.DISPLAY);
if(j){d=j.dom.cloneNode(true);
d.id=CQ.Ext.id();
return{ddel:d,sourceEl:j,repairXY:CQ.Ext.fly(j).getXY()}
}},getRepairXY:function(){return this.dragData.repairXY
},onDrag:function(){g.dropTarget.lock()
},onInvalidDrop:function(k,j,m){CQ.Ext.dd.DragZone.superclass.onInvalidDrop.call(this,k,j,m);
g.dropTarget.unlock()
}})
});
this.field.on("render",function(){g.createDropTarget()
})
}}b.push({xtype:"panel",border:false,cellCls:"cq-multifield-itemct",items:g.field});
if(!c.readOnly){b.push({xtype:"panel",border:false,items:{xtype:"button",iconCls:"cq-multifield-remove",template:new CQ.Ext.Template('<span><button class="x-btn" type="{0}"></button></span>'),handler:function(){var j=g.ownerCt;
j.remove(g);
j.fireEvent("removeditem",j)
}}})
}},createDropTarget:function(){if(!this.field){return
}if(this.dropTarget){this.dropTarget.destroy()
}var a=this;
this.dropTarget=new CQ.Ext.dd.DropTarget(this.getEl(),{item:a,ddGroup:this.field.getName(),getPosition:function(j,b){var m=j.getXY()[1];
var g=CQ.Ext.fly(b).getRegion();
var c=g.bottom-g.top;
var k=g.bottom-m;
if(k>=(c/2)){return"before"
}else{return"after"
}},showTargetLine:function(j,g){var c=2;
var k=CQ.Ext.fly(j).getRegion();
var b=k.left;
var m=k.bottom-1;
if(g=="before"){m=k.top-1
}CQ.form.MultiField.getTargetLine().setWidth(j.getWidth());
CQ.form.MultiField.getTargetLine().show();
CQ.form.MultiField.getTargetLine().setPosition(b,m)
},notifyOver:function(b,g,c){this.lastPosition=this.getPosition(g,this.el);
this.showTargetLine(this.el,this.lastPosition);
return this.dropAllowed
},notifyOut:function(b,g,c){CQ.form.MultiField.getTargetLine().hide();
if(this.overClass){this.el.removeClass(this.overClass)
}},notifyDrop:function(c,j,g){CQ.form.MultiField.getTargetLine().hide();
var k=c.item;
var b=this.item;
k.move(b,this.lastPosition);
return true
}})
},remove:function(){this.ownerCt.remove(this,true)
},move:function(g,a){var j=this;
var c=j.ownerCt;
var b=c.items.indexOf(g);
if(a=="before"){b--
}else{b++
}b=b==-1?0:b;
b=b>c.items.getCount()?c.items.getCount():b;
c.items.insert(b,j);
if(a=="before"){j.getEl().insertBefore(g.getEl())
}else{j.getEl().insertAfter(g.getEl())
}j.createDropTarget();
c.doLayout(false,true)
},reorder:function(a){var b=a.field.getValue();
a.field.setValue(this.field.getValue());
this.field.setValue(b)
},getValue:function(){return this.field.getValue()
},setValue:function(a){this.field.setValue(a)
}});
CQ.Ext.reg("multifielditem",CQ.form.MultiField.Item);
CQ.form.MultiField.getTargetLine=function(){if(!CQ.form.MultiField.TargetLine){CQ.form.MultiField.TargetLine=CQ.Util.build({xtype:"box",renderTo:"CQ",html:"<div class='cq-multifield-targetline-top-shadow-penumbra'></div><div class='cq-multifield-targetline-top-shadow'></div><div class='cq-multifield-targetline-bottom-shadow'></div><div class='cq-multifield-targetline-bottom-shadow-penumbra'></div>",cls:"cq-multifield-targetline",hidden:true,hideMode:"display"},true);
CQ.form.MultiField.TargetLine.getEl().setVisibilityMode(CQ.Ext.Element.DISPLAY)
}return CQ.form.MultiField.TargetLine
};
CQ.form.InlineTextField=CQ.Ext.extend(CQ.Ext.form.TextField,{enabledCls:"cq-inline-textfield",disabledCls:"cq-inline-textfield-disabled",onRender:function(){CQ.form.InlineTextField.superclass.onRender.apply(this,arguments);
this.el.addClass(this.enabledCls)
},onFocus:function(){CQ.form.InlineTextField.superclass.onFocus.apply(this,arguments);
this.el.removeClass(this.enabledCls)
},onBlur:function(){CQ.form.InlineTextField.superclass.onBlur.apply(this,arguments);
if(this.isValid()&&!this.el.hasClass(this.enabledCls)){this.el.addClass(this.enabledCls)
}},constructor:function(a){CQ.Util.applyDefaults(a,{listeners:{specialkey:function(b,c){if(c.getKey()==c.ENTER){b.blur()
}else{if(c.getKey()==c.ESC){b.setValue(this.startValue);
b.blur()
}}}}});
CQ.form.InlineTextField.superclass.constructor.call(this,a)
}});
CQ.Ext.reg("inlinetextfield",CQ.form.InlineTextField);
CQ.form.Password=CQ.Ext.extend(CQ.Ext.form.TextField,{defaultAutoCreate:{tag:"input",type:"password",size:"20",autocomplete:"off"}});
CQ.Ext.reg("password",CQ.form.Password);
CQ.form.Spinner=function(a){CQ.form.Spinner.superclass.constructor.call(this,a);
this.addEvents({spinup:true,spindown:true})
};
CQ.Ext.extend(CQ.form.Spinner,CQ.Ext.form.TriggerField,{triggerClass:"x-form-spinner-trigger",splitterClass:"x-form-spinner-splitter",alternateKey:CQ.Ext.EventObject.shiftKey,strategy:undefined,onRender:function(b,a){CQ.form.Spinner.superclass.onRender.call(this,b,a);
this.splitter=this.wrap.createChild({tag:"div",cls:this.splitterClass,style:"width:13px; height:2px;"});
this.splitter.show().setRight((CQ.Ext.isIE)?1:2);
this.splitter.show().setTop(10);
this.proxy=this.trigger.createProxy("",this.splitter,true);
this.proxy.addClass("x-form-spinner-proxy");
this.proxy.setStyle("left","0px");
this.proxy.setSize(14,1);
this.proxy.hide();
this.dd=new CQ.Ext.dd.DDProxy(this.splitter.dom.id,"SpinnerDrag",{dragElId:this.proxy.id});
this.initSpinner()
},initSpinner:function(){this.keyNav=new CQ.Ext.KeyNav(this.el,{up:function(a){a.preventDefault();
this.onSpinUp()
},down:function(a){a.preventDefault();
this.onSpinDown()
},pageUp:function(a){a.preventDefault();
this.onSpinUpAlternate()
},pageDown:function(a){a.preventDefault();
this.onSpinDownAlternate()
},scope:this});
this.trigger.un("click",this.onTriggerClick);
this.repeater=new CQ.Ext.util.ClickRepeater(this.trigger);
this.repeater.on("click",this.onTriggerClick,this,{preventDefault:true});
this.trigger.on("mouseover",this.onMouseOver,this,{preventDefault:true});
this.trigger.on("mouseout",this.onMouseOut,this,{preventDefault:true});
this.trigger.on("mousemove",this.onMouseMove,this,{preventDefault:true});
this.trigger.on("mousedown",this.onMouseDown,this,{preventDefault:true});
this.trigger.on("mouseup",this.onMouseUp,this,{preventDefault:true});
this.wrap.on("mousewheel",this.handleMouseWheel,this);
this.dd.setXConstraint(0,0,10);
this.dd.setYConstraint(1500,1500,10);
this.dd.endDrag=this.endDrag.createDelegate(this);
this.dd.startDrag=this.startDrag.createDelegate(this);
this.dd.onDrag=this.onDrag.createDelegate(this);
if("object"==typeof this.strategy&&this.strategy.xtype){switch(this.strategy.xtype){case"number":this.strategy=new CQ.form.Spinner.NumberStrategy(this.strategy);
break;
case"date":this.strategy=new CQ.form.Spinner.DateStrategy(this.strategy);
break;
case"time":this.strategy=new CQ.form.Spinner.TimeStrategy(this.strategy);
break;
default:delete (this.strategy);
break
}delete (this.strategy.xtype)
}if(this.strategy==undefined){this.strategy=new CQ.form.Spinner.NumberStrategy()
}},onMouseOver:function(){if(this.disabled){return
}var a=this.getMiddle();
this.__tmphcls=(CQ.Ext.EventObject.getPageY()<a)?"x-form-spinner-overup":"x-form-spinner-overdown";
this.trigger.addClass(this.__tmphcls)
},onMouseOut:function(){this.trigger.removeClass(this.__tmphcls)
},onMouseMove:function(){if(this.disabled){return
}var a=this.getMiddle();
if(((CQ.Ext.EventObject.getPageY()>a)&&this.__tmphcls=="x-form-spinner-overup")||((CQ.Ext.EventObject.getPageY()<a)&&this.__tmphcls=="x-form-spinner-overdown")){}},onMouseDown:function(){if(this.disabled){return
}var a=this.getMiddle();
this.__tmpccls=(CQ.Ext.EventObject.getPageY()<a)?"x-form-spinner-clickup":"x-form-spinner-clickdown";
this.trigger.addClass(this.__tmpccls)
},onMouseUp:function(){this.trigger.removeClass(this.__tmpccls)
},onTriggerClick:function(){if(this.disabled||this.getEl().dom.readOnly){return
}var b=this.getMiddle();
var a=(CQ.Ext.EventObject.getPageY()<b)?"Up":"Down";
this["onSpin"+a]()
},getMiddle:function(){var b=this.trigger.getTop();
var c=this.trigger.getHeight();
var a=b+(c/2);
return a
},handleMouseWheel:function(a){if(this.disabled||this.getEl().dom.readOnly){CQ.Ext.EventObject.preventDefault();
return
}var b=a.getWheelDelta();
if(b>0){this.onSpinUp();
a.stopEvent()
}else{if(b<0){this.onSpinDown();
a.stopEvent()
}}},startDrag:function(){this.proxy.show();
this._previousY=CQ.Ext.fly(this.dd.getDragEl()).getTop()
},endDrag:function(){this.proxy.hide()
},onDrag:function(){if(this.disabled){return
}var b=CQ.Ext.fly(this.dd.getDragEl()).getTop();
var a="";
if(this._previousY>b){a="Up"
}if(this._previousY<b){a="Down"
}if(a!=""){this["onSpin"+a]()
}this._previousY=b
},onSpinUp:function(){if(CQ.Ext.EventObject.shiftKey==true){this.onSpinUpAlternate();
return
}else{this.strategy.onSpinUp(this)
}this.fireEvent("spinup",this)
},onSpinDown:function(){if(CQ.Ext.EventObject.shiftKey==true){this.onSpinDownAlternate();
return
}else{this.strategy.onSpinDown(this)
}this.fireEvent("spindown",this)
},onSpinUpAlternate:function(){this.strategy.onSpinUpAlternate(this);
this.fireEvent("spinup",this)
},onSpinDownAlternate:function(){this.strategy.onSpinDownAlternate(this);
this.fireEvent("spindown",this)
}});
CQ.Ext.reg("spinner",CQ.form.Spinner);
CQ.form.Spinner.Strategy=function(a){CQ.Ext.apply(this,a)
};
CQ.Ext.extend(CQ.form.Spinner.Strategy,CQ.Ext.util.Observable,{defaultValue:0,minValue:undefined,maxValue:undefined,incrementValue:1,alternateIncrementValue:5,onSpinUp:function(a){this.spin(a,false,false)
},onSpinDown:function(a){this.spin(a,true,false)
},onSpinUpAlternate:function(a){this.spin(a,false,true)
},onSpinDownAlternate:function(a){this.spin(a,true,true)
},spin:function(a,c,b){},fixBoundries:function(a){return a
}});
CQ.form.Spinner.NumberStrategy=function(a){CQ.form.Spinner.NumberStrategy.superclass.constructor.call(this,a)
};
CQ.Ext.extend(CQ.form.Spinner.NumberStrategy,CQ.form.Spinner.Strategy,{allowDecimals:true,decimalPrecision:2,spin:function(b,j,c){CQ.form.Spinner.NumberStrategy.superclass.spin.call(this,b,j,c);
var a=parseFloat(b.getValue());
var g=(c==true)?this.alternateIncrementValue:this.incrementValue;
(j==true)?a-=g:a+=g;
a=(isNaN(a))?this.defaultValue:a;
a=this.fixBoundries(a);
b.setRawValue(a)
},fixBoundries:function(b){var a=b;
if(this.minValue!=undefined&&a<this.minValue){a=this.minValue
}if(this.maxValue!=undefined&&a>this.maxValue){a=this.maxValue
}return this.fixPrecision(a)
},fixPrecision:function(b){var a=isNaN(b);
if(!this.allowDecimals||this.decimalPrecision==-1||a||!b){return a?"":b
}return parseFloat(parseFloat(b).toFixed(this.decimalPrecision))
}});
CQ.form.Spinner.DateStrategy=function(a){CQ.form.Spinner.DateStrategy.superclass.constructor.call(this,a)
};
CQ.Ext.extend(CQ.form.Spinner.DateStrategy,CQ.form.Spinner.Strategy,{defaultValue:new Date(),format:"Y-m-d",incrementValue:1,incrementConstant:Date.DAY,alternateIncrementValue:1,alternateIncrementConstant:Date.MONTH,spin:function(g,m,j){CQ.form.Spinner.DateStrategy.superclass.spin.call(this);
var a=g.getRawValue();
a=Date.parseDate(a,this.format);
var c=(m==true)?-1:1;
var k=(j==true)?this.alternateIncrementValue:this.incrementValue;
var b=(j==true)?this.alternateIncrementConstant:this.incrementConstant;
if(typeof this.defaultValue=="string"){this.defaultValue=Date.parseDate(this.defaultValue,this.format)
}a=(a)?a.add(b,c*k):this.defaultValue;
a=this.fixBoundries(a);
g.setRawValue(CQ.Ext.util.Format.date(a,this.format))
},fixBoundries:function(b){var g=b;
var c=(typeof this.minValue=="string")?Date.parseDate(this.minValue,this.format):this.minValue;
var a=(typeof this.maxValue=="string")?Date.parseDate(this.maxValue,this.format):this.maxValue;
if(this.minValue!=undefined&&g<c){g=c
}if(this.maxValue!=undefined&&g>a){g=a
}return g
}});
CQ.form.Spinner.TimeStrategy=function(a){CQ.form.Spinner.TimeStrategy.superclass.constructor.call(this,a)
};
CQ.Ext.extend(CQ.form.Spinner.TimeStrategy,CQ.form.Spinner.DateStrategy,{format:"H:i",incrementValue:1,incrementConstant:Date.MINUTE,alternateIncrementValue:1,alternateIncrementConstant:Date.HOUR});
CQ.form.DateTime=CQ.Ext.extend(CQ.Ext.form.Field,{defaultAutoCreate:{tag:"input",type:"hidden"},hideTime:false,timeWidth:100,dateWidth:200,dtSeparator:" ",hiddenFormat:"Y-m-d\\TH:i:s.000P",defaultValue:"",allowBlank:true,timePosition:"right",disableTypeHint:false,valueAsString:false,typeHint:null,defaultTriggerWidth:17,initComponent:function(){CQ.form.DateTime.superclass.initComponent.call(this);
if(this.dateConfig&&CQ.Ext.isString(this.dateConfig.minValue)){if(this.dateConfig.minValue=="now"){this.dateConfig.minValue=new Date()
}}var b=CQ.Ext.apply({},{id:this.id+"-date",format:this.dateFormat||CQ.Ext.form.DateField.prototype.format,width:this.readOnly?this.dateWidth-this.defaultTriggerWidth:this.dateWidth,selectOnFocus:this.selectOnFocus,allowBlank:this.allowBlank,hideTrigger:this.readOnly,readOnly:this.readOnly,listeners:{blur:{scope:this,fn:this.onBlur},focus:{scope:this,fn:this.onFocus}}},this.dateConfig);
this.df=new CQ.Ext.form.DateField(b);
delete (this.dateFormat);
var a=CQ.Ext.apply({},{id:this.id+"-time",format:this.timeFormat||CQ.Ext.form.TimeField.prototype.format,width:this.readOnly?this.timeWidth-this.defaultTriggerWidth:this.timeWidth,hideTrigger:this.readOnly,minListWidth:this.timeWidth,selectOnFocus:this.selectOnFocus,allowBlank:this.allowBlank,readOnly:this.readOnly,listeners:{blur:{scope:this,fn:this.onBlur},focus:{scope:this,fn:this.onFocus}}},this.timeConfig);
this.tf=new CQ.Ext.form.TimeField(a);
delete (this.timeFormat);
this.relayEvents(this.df,["focus","specialkey","invalid","valid"]);
this.relayEvents(this.tf,["focus","specialkey","invalid","valid"])
},onRender:function(c,a){if(this.isRendered){return
}CQ.form.DateTime.superclass.onRender.call(this,c,a);
var b;
if("below"===this.timePosition||"bellow"===this.timePosition){b=CQ.Ext.DomHelper.append(c,{tag:"table",style:"border-collapse:collapse",children:[{tag:"tr",children:[{tag:"td",style:"padding-bottom:1px",cls:"ux-datetime-date"}]},{tag:"tr",children:[{tag:"td",style:this.hideTime?"display:none;":"",cls:"ux-datetime-time"}]}]},true)
}else{b=CQ.Ext.DomHelper.append(c,{tag:"table",style:"border-collapse:collapse",children:[{tag:"tr",children:[{tag:"td",style:"padding-right:"+(this.readOnly?this.defaultTriggerWidth:"0")+"px",cls:"ux-datetime-date"},{tag:"td",style:this.hideTime?"display:none;":"",cls:"ux-datetime-time"}]}]},true)
}this.tableEl=b;
this.wrap=b.wrap();
this.wrap.on("mousedown",this.onMouseDown,this,{delay:10});
this.df.render(b.child("td.ux-datetime-date"));
this.tf.render(b.child("td.ux-datetime-time"));
if(CQ.Ext.isIE&&CQ.Ext.isStrict){b.select("input").applyStyles({top:0})
}this.on("specialkey",this.onSpecialKey,this);
this.df.el.swallowEvent(["keydown","keypress"]);
this.tf.el.swallowEvent(["keydown","keypress"]);
if("side"===this.msgTarget){var j=this.el.findParent(".x-form-element",10,true);
this.errorIcon=j.createChild({cls:"x-form-invalid-icon"});
this.df.errorIcon=this.errorIcon;
this.tf.errorIcon=this.errorIcon
}this.el.dom.name=this.hiddenName||this.name||this.id;
this.df.el.dom.removeAttribute("name");
this.tf.el.dom.removeAttribute("name");
if(!this.disableTypeHint){var g=new CQ.Ext.form.Hidden({name:this.name+"@TypeHint",value:this.typeHint?this.typeHint:"Date",ignoreDate:true,renderTo:c})
}this.isRendered=true;
this.updateHidden()
},adjustSize:CQ.Ext.BoxComponent.prototype.adjustSize,alignErrorIcon:function(){this.errorIcon.alignTo(this.tableEl,"tl-tr",[2,0])
},initDateValue:function(){if(this.defaultValue=="now"){this.dateValue=new Date()
}else{if(this.defaultValue){this.dateValue=Date.parseDate(this.defaultValue,this.hiddenFormat);
if(!this.dateValue){this.dateValue=new Date()
}}else{this.dateValue=new Date()
}}},clearInvalid:function(){this.df.clearInvalid();
this.tf.clearInvalid()
},disable:function(){if(this.isRendered){this.onDisable();
this.df.disabled=this.disabled;
this.df.onDisable();
this.tf.onDisable()
}this.disabled=true;
this.df.disabled=true;
this.tf.disabled=true;
this.fireEvent("disable",this);
return this
},enable:function(){if(this.rendered){this.onEnable();
this.df.onEnable();
this.tf.onEnable()
}this.disabled=false;
this.df.disabled=false;
this.tf.disabled=false;
this.fireEvent("enable",this);
return this
},focus:function(){this.df.focus()
},getPositionEl:function(){return this.wrap
},getResizeEl:function(){return this.wrap
},getValue:function(){if(this.valueAsString){return(this.dateValue&&(typeof this.dateValue.format==="function"))?this.dateValue.format(this.hiddenFormat):""
}else{return this.dateValue?this.dateValue.clone():""
}},getDateValue:function(){return this.dateValue?this.dateValue.clone():null
},valueToDate:function(a){return Date.parseDate(a,this.hiddenFormat)
},isValid:function(){return this.df.isValid()&&this.tf.isValid()
},isVisible:function(){return this.df.rendered&&this.df.getActionEl().isVisible()
},onBlur:function(a){if(this.wrapClick){a.focus();
this.wrapClick=false
}if(a===this.df){this.updateDate()
}else{this.updateTime()
}this.updateHidden();
(function(){if(!this.df.hasFocus&&!this.tf.hasFocus){this.checkIfChanged(true);
this.hasFocus=false;
this.fireEvent("blur",this)
}}).defer(100,this)
},checkIfChanged:function(b){if(!b){this.updateValue()
}var a=this.getValue();
if(this.startValue!==undefined&&String(a)!==String(this.startValue)){this.fireEvent("change",this,a,this.startValue);
this.startValue=a;
return true
}return false
},onFocus:function(){if(!this.hasFocus){this.hasFocus=true;
this.startValue=this.getValue();
this.fireEvent("focus",this)
}},onMouseDown:function(a){if(!this.disabled){this.wrapClick="td"===a.target.nodeName.toLowerCase()
}},onSpecialKey:function(b,c){var a=c.getKey();
if(a===c.TAB){if(b===this.df&&!c.shiftKey){c.stopEvent();
this.tf.focus()
}if(b===this.tf&&c.shiftKey){c.stopEvent();
this.df.focus()
}}if(a===c.ENTER){this.updateValue()
}},setDate:function(a){this.df.setValue(a)
},setTime:function(a){this.tf.setValue(a)
},setSize:function(a,b){if(!a){return
}if(typeof a=="object"){b=a.height;
a=a.width
}if("below"===this.timePosition){this.df.setSize(a,b);
this.tf.setSize(a,b);
if(CQ.Ext.isIE){this.df.el.up("td").setWidth(a);
this.tf.el.up("td").setWidth(a)
}}else{this.df.setSize(a-this.timeWidth,b);
this.tf.setSize(this.timeWidth,b);
if(CQ.Ext.isIE){this.df.el.up("td").setWidth(a-this.timeWidth);
this.tf.el.up("td").setWidth(this.timeWidth)
}}this.fireEvent("resize",this,a,b,a,b)
},setValue:function(c){if(!c){this.setDate("");
this.setTime("");
this.updateValue();
return
}if("number"===typeof c){c=new Date(c)
}if("string"===typeof c){if(c=="now"){c=new Date()
}else{var a=Date.parse(c);
if(!a){a=Date.parseDate(c,this.hiddenFormat)
}if(a){c=new Date(a)
}}}c=c?c:new Date();
if(typeof c.setDate=="function"&&typeof c.setTime=="function"){this.setDate(c);
this.setTime(c);
this.dateValue=c.clone()
}else{var b=c.split(this.dtSeparator);
this.setDate(b[0]);
if(b[1]){this.setTime(b[1])
}}this.updateValue();
this.startValue=this.getValue()
},setVisible:function(a){if(a){this.df.show();
this.tf.show()
}else{this.df.hide();
this.tf.hide()
}return this
},show:function(){return this.setVisible(true)
},hide:function(){return this.setVisible(false)
},updateDate:function(){var a=this.df.getValue();
if(a){if(!this.isDate(this.dateValue)){this.initDateValue();
if(!this.tf.getValue()){this.setTime(this.dateValue)
}}this.dateValue.setDate(1);
this.dateValue.setFullYear(a.getFullYear());
this.dateValue.setMonth(a.getMonth());
this.dateValue.setDate(a.getDate())
}else{this.dateValue="";
this.setTime("")
}},isDate:function(a){return(typeof(a)!="undefined")&&((typeof a.setDate==="function")&&(typeof a.setTime==="function")&&(typeof a.getFirstDateOfMonth==="function")&&(typeof a.getFirstDayOfMonth==="function"))
},updateTime:function(){var a=this.tf.getValue();
if(a&&!this.isDate(a)){if(a=="now"){a=new Date()
}else{a=Date.parseDate(a,this.tf.format)
}}if(a&&!this.df.getValue()){this.initDateValue();
this.setDate(this.dateValue)
}if((typeof this.dateValue.setHours==="function")&&(typeof this.dateValue.setMinutes==="function")&&(typeof this.dateValue.setSeconds==="function")){if(a){this.dateValue.setHours(a.getHours());
this.dateValue.setMinutes(a.getMinutes());
this.dateValue.setSeconds(a.getSeconds())
}else{this.dateValue.setHours(0);
this.dateValue.setMinutes(0);
this.dateValue.setSeconds(0)
}}},updateHidden:function(){if(this.isRendered){this.el.dom.value=(this.dateValue&&(typeof this.dateValue.format==="function"))?this.dateValue.format(this.hiddenFormat):""
}},updateValue:function(){this.updateDate();
this.updateTime();
this.updateHidden()
},validate:function(){var b=this.df.validate()&&this.tf.validate();
if(this.validator){var a=this.validator.call(this,this.getValue(),this);
if(a!==true){this.df.markInvalid(a);
this.tf.markInvalid(a)
}b&=a===true
}return b
},renderer:function(b){var a=b.editor.dateFormat||CQ.Ext.form.DateField.prototype.format;
a+=" "+(b.editor.timeFormat||CQ.Ext.form.TimeField.prototype.format);
return function(c){return CQ.Ext.util.Format.date(c,a)
}
}});
CQ.Ext.reg("datetime",CQ.form.DateTime);
CQ.form.DialogFieldSet=CQ.Ext.extend(CQ.Ext.form.FieldSet,{constructor:function(a){if(a.collapsed===false&&a.autoHeight==undefined){a.autoHeight=true
}if(!a.labelWidth){a.labelWidth=CQ.themes.DialogFieldSet.LABEL_WIDTH
}if(!a.defaults){a.defaults={}
}if(!a.defaults.anchor){a.defaults.anchor=CQ.themes.DialogFieldSet.ANCHOR
}CQ.form.DialogFieldSet.superclass.constructor.call(this,a)
}});
CQ.Ext.reg("dialogfieldset",CQ.form.DialogFieldSet);
CQ.form.FileUploadField=CQ.Ext.extend(CQ.Ext.form.TextField,{buttonText:null,buttonOnly:false,buttonOffset:3,removable:false,useFlash:false,readOnly:true,valueUpdated:false,autoSize:CQ.Ext.emptyFn,fileNameParameter:null,placeHolder:null,allowEnctypeSetting:true,constructor:function(a){if(a.fileNameParameter){this.readOnly=false
}CQ.form.FileUploadField.superclass.constructor.call(this,a)
},initComponent:function(){CQ.form.FileUploadField.superclass.initComponent.call(this);
this.addEvents("fileselected","fileremoved","flashfilesselected","flashdialogcomplete","flashuploadstart","flashuploadsuccess","flashuploaderror","flashuploadcomplete")
},setName:function(a){if(a){this.fileInput.dom.setAttribute("name",a);
this.name=a
}},swfu:null,onRender:function(k,b){var c=this;
CQ.form.FileUploadField.superclass.onRender.call(this,k,b);
this.wrap=this.el.wrap({cls:"x-form-field-wrap x-form-file-wrap cq-fileupload-wrapper"});
this.el.addClass("x-form-file-text");
if(this.fileNameParameter){this.el.dom.setAttribute("name",this.fileNameParameter)
}else{this.el.dom.setAttribute("name","")
}if(CQ.endorsed.swfobject.getFlashPlayerVersion().major<9){this.useFlash=false
}if(this.placeHolder){this.useFlash=false
}var g=this.name||this.getId();
if(this.useFlash){var n="swf"+new Date().getTime();
this.fileInput=this.wrap.createChild({cls:"x-form-file",tag:"div",children:{id:n}});
this.swfu=new SWFUpload({flash_url:CQ.HTTP.externalize("/libs/cq/ui/resources/swfupload")+"/swfupload.swf",button_placeholder_id:n,button_text_left_padding:34,button_text_top_padding:10,button_width:70,button_height:20,file_post_name:c.getName(),file_queued_handler:function(o){c.fireEvent("fileselected",c,{flash:c.swfu,file:o});
return true
},files_selected_handler:function(){var o=c.delegatee?c.delegatee:c;
o.fireEvent("flashfilesselected",o)
},file_dialog_complete_handler:function(t,r,o){var q=c.delegatee?c.delegatee:c;
q.fireEvent("flashdialogcomplete",q)
},upload_start_handler:function(o){c.button.disable();
c.swfu.setButtonDisabled(true);
c.swfu.setFilePostName(encodeURIComponent(o.name));
try{c.delegatee=c.findParentByType("form").getForm().findField(o.id)
}catch(r){}var q=c.delegatee?c.delegatee:c;
try{c.swfu.addPostParam(CQ.Sling.CHARSET,"utf-8");
c.swfu.addPostParam("fileName",q.fileInput.dom.name)
}catch(r){}q.fireEvent("flashuploadstart",q,o);
return true
},upload_progress_handler:function(q,o,r){var t=c.delegatee?c.delegatee:c;
if(t.getName()!=q.id){return true
}return true
},upload_success_handler:function(q,o,t){var r=c.delegatee?c.delegatee:c;
if(r.getName()!=q.id){return true
}r.fireEvent("flashuploadsuccess",r,q);
return true
},upload_error_handler:function(r,q,u){var t=c.delegatee?c.delegatee:c;
if(t.getName()!=r.id){return true
}if(u==201){var o=c.swfu.getStats();
o.upload_errors--;
o.successful_uploads++;
c.swfu.setStats(o);
t.fireEvent("flashuploadsuccess",t,r);
return true
}t.markInvalid();
t.fireEvent("flashuploaderror",t,r,u);
return true
},upload_complete_handler:function(o){var q=c.delegatee?c.delegatee:c;
if(q.getName()!=o.id){return true
}if(c.swfu.getStats().files_queued>0){c.swfu.startUpload()
}else{c.fireEvent("flashuploadcomplete",c)
}return true
},swfupload_loaded_handler:function(){this.setButtonDimensions(c.button.getEl().getWidth(),c.button.getEl().getHeight())
}});
CQ.swfu=this.swfu
}else{if(this.placeHolder){this.fileInput=this.wrap.createChild({id:this.getFileInputId(),name:this.placeHolder.id||this.getId(),cls:"x-form-file",tag:"input",type:"hidden",value:this.placeHolder.name});
this.el.dom.name=this.placeHolder.id;
this.setValue(this.placeHolder.name)
}else{this.fileInput=this.wrap.createChild({id:this.getFileInputId(),name:this.name||this.getId(),cls:"x-form-file",tag:"input",type:"file",size:1,title:CQ.I18n.getMessage("No file chosen")})
}}if(!this.useFlash){var m={name:g+"@TypeHint",tag:"input",type:"hidden",value:"nt:file"};
this.wrap.createChild(m)
}var j=CQ.Ext.applyIf(this.buttonCfg||{},{text:this.buttonText?this.buttonText:CQ.I18n.getMessage("Browse...")});
this.button=new CQ.Ext.Button(CQ.Ext.apply(j,{renderTo:this.wrap,cls:"x-form-file-btn"+(j.iconCls?" x-btn-icon":"")}));
if(this.buttonOnly){this.el.hide();
this.wrap.setWidth(this.button.getEl().getWidth())
}this.fileInput.setWidth((this.button.getEl().getComputedWidth()||55));
if(this.placeHolder){this.button.setText(CQ.I18n.getMessage("Clear"));
this.button.on("click",this.clearFile,this)
}else{if(this.useFlash){var a=this.findParentByType("form");
a.getForm().flashUpload=this.swfu
}else{if(!this.useFlash){this.fileInput.on("change",function(){var o=this.fileInput.dom.value;
if(CQ.Ext.isIE&&o.lastIndexOf("\\")!=-1){o=o.substring(o.lastIndexOf("\\")+1)
}this.setValue(o);
if(this.allowEnctypeSetting){try{var q=this.findParentByType("form").getForm().el.dom;
q.enctype="multipart/form-data";
q.encoding="multipart/form-data"
}catch(r){}}this.fireEvent("fileselected",this,o);
this.valueUpdated=true;
if(this.removable){this.button.setText(CQ.I18n.getMessage("Clear"));
this.button.on("click",this.clearFile,this);
this.fileInput.applyStyles("z-index:-100")
}},this)
}}}},clearFile:function(){var a=this.ownerCt;
var c=this.getName();
this.fireEvent("fileremoved",this.getValue());
a.remove(this,true);
a.ownerCt.doLayout();
try{CQ.swfu.cancelUpload(c)
}catch(b){}},destroy:function(){var a=this.getEl().dom.parentNode;
this.fileInput.remove();
this.button.destroy();
CQ.form.FileUploadField.superclass.destroy.call(this);
a.parentNode.removeChild(a)
},getFileInputId:function(){return this.id+"-file"
},initProgressBar:function(){this.progressBar=new CQ.Ext.ProgressBar({text:"&nbsp;"});
this.progressText=new CQ.Static({cls:"cq-fileuploadfield-progress-text"});
new CQ.Ext.Panel({renderTo:this.wrap.insertSibling({tag:"div",cls:"cq-fileupload-progress-wrapper"}),border:false,bodyStyle:"width:"+this.wrap.getWidth(true)+"px;",anchorTo:this.wrap,items:[this.progressBar,this.progressText]});
new CQ.Ext.Button({renderTo:this.progressBar.wrap,text:CQ.I18n.getMessage("Cancel")});
this.wrap.remove()
},handleUploadProgress:function(b,c,k){if(!this.progressBar){this.initProgressBar()
}var j=Math.round(100*c/k);
var g=CQ.I18n.getMessage("{0} of {1}",[CQ.Util.formatFileSize(c),CQ.Util.formatFileSize(k)],"file upload progress");
var a=b.name;
try{a=this.fileInput.dom.name
}catch(m){}this.progressBar.updateProgress(j/100,CQ.shared.XSS.getXSSValue(a).replace("\\\\\\\\","\\"));
this.progressText.updateText(g)
},handleUploadComplete:function(a){if(!this.progressBar){this.initProgressBar()
}this.progressBar.updateProgress(1);
this.progressText.updateText(CQ.I18n.getMessage("Complete",null,"adjective"))
},onResize:function(a,b){CQ.form.FileUploadField.superclass.onResize.call(this,a,b);
this.wrap.setWidth(a);
if(!this.buttonOnly){var a=this.wrap.getWidth()-this.button.getEl().getWidth()-this.buttonOffset;
this.el.setWidth(a)
}},preFocus:CQ.Ext.emptyFn,getResizeEl:function(){return this.wrap
},getPositionEl:function(){return this.wrap
},alignErrorIcon:function(){this.errorIcon.alignTo(this.wrap,"tl-tr",[2,0])
}});
CQ.Ext.reg("fileuploadfield",CQ.form.FileUploadField);
CQ.form.FileUploadDialogButton=CQ.Ext.extend(CQ.Ext.Button,{constructor:function(a){a=CQ.Util.applyDefaults(a,{formUrl:window.location,fileNameParameter:"file",text:CQ.I18n.getMessage("Upload file"),fileLabel:CQ.I18n.getMessage("File"),fileDescription:"",okText:CQ.I18n.getMessage("Upload"),cancelText:CQ.I18n.getMessage("Cancel"),listeners:{scope:this,click:this.handleClick},success:this.handleSuccess,failure:this.handleFailure});
if(!a.dialogTitle){a.dialogTitle=a.text
}this.dialogConfig=CQ.WCM.getDialogConfig({xtype:"panel",items:{name:a.fileNameParameter,xtype:"fileuploadfield",fieldLabel:a.fileLabel,fieldDescription:a.fileDescription}});
this.dialogConfig=CQ.Util.applyDefaults(this.dialogConfig,{title:a.dialogTitle,formUrl:a.formUrl,fileUpload:true,height:180,okText:a.okText,cancelText:a.cancelText,buttons:CQ.Dialog.OKCANCEL,responseScope:this,success:a.success,failure:a.failure});
CQ.form.FileUploadDialogButton.superclass.constructor.call(this,a)
},handleClick:function(){if(!this.dialog){this.dialog=CQ.Util.build(this.dialogConfig,true)
}this.dialog.show()
},handleSuccess:function(){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Success"),CQ.I18n.getMessage("File was successfully uploaded."))
},handleFailure:function(){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not upload file."))
}});
CQ.Ext.reg("fileuploaddialogbutton",CQ.form.FileUploadDialogButton);
CQ.form.Selection=CQ.Ext.extend(CQ.form.CompositeField,{allowBlank:true,type:"radio",options:null,optionsRoot:null,optionsTextField:null,optionsValueField:null,optionsQTipField:null,optionsCallback:null,optionsProvider:null,optionsConfig:null,checkboxBoolTypeHint:false,blankText:CQ.I18n.getMessage("You must select at least one item in this group"),sortDir:null,comboBox:null,hiddenField:null,optionItems:null,isComboBox:false,isSelect:false,isCheckbox:false,isRadio:false,getValue:function(){if(!this.rendered){return this.value!=null?this.value:""
}if(this.isComboBox||this.isSelect){if(this.isSelect){return this.hiddenField.getValue()
}return this.comboBox.getValue()
}if(this.isRadio){if(this.optionItems){for(var b=0;
b<this.optionItems.length;
b++){var c=this.optionItems.itemAt(b);
if(c.getValue()){return c.inputValue
}}}return""
}var a=[];
if(this.optionItems){for(var b=0;
b<this.optionItems.length;
b++){var c=this.optionItems.itemAt(b);
if(c.getValue()){a.push(c.inputValue)
}}}else{return a[this.initialValue]
}return a
},getRawValue:function(){if(this.isRadio||this.isCheckbox){return this.getValue()
}else{return this.comboBox.getRawValue()
}},processPath:function(path){if(this.optionsProvider){if(path==undefined){path=null
}var options=[];
try{if(typeof this.optionsProvider!="function"){try{var p;
eval("p = "+this.optionsProvider);
options=p.call(this,path)
}catch(e){CQ.Log.warn("Selection#processPath: failed to evaluate optionsProvider: "+e.message)
}}else{options=this.optionsProvider.call(this,path)
}this.setOptions(options)
}catch(e){CQ.Log.warn("Selection#processPath: "+e.message)
}}else{if(this.optionsCallback){if(path==undefined){path=null
}try{if(typeof this.optionsCallback!="function"){try{eval(this.optionsCallback).call(this,path)
}catch(e){CQ.Log.warn("Selection#processPath: failed to evaluate optionsCallback: "+e.message)
}}else{this.optionsCallback.call(this,path)
}}catch(e){CQ.Log.warn("Selection#processPath: failed to call optionsCallback: "+e.message)
}}else{if(this.contentBasedOptionsURL){var url=this.contentBasedOptionsURL;
url=url.replace(CQ.form.Selection.PATH_PLACEHOLDER_REGEX,path);
this.setOptions(this.fetchOptions(url,this))
}}}},setOptions:function(b){if(this.isCheckbox||this.isRadio){if(this.optionItems&&this.optionItems.getCount()>0){var a=this.optionItems.getCount();
for(var c=0;
c<a;
c++){var k=this.optionItems.itemAt(c);
this.remove(k);
if(k.rendered&&k.dom){k.dom.setStyle("display","none")
}k.destroy()
}this.optionItems.clear()
}if(this.sortDir){this.sortOptions(b)
}for(var c=0;
c<b.length;
c++){var g=b[c];
this.optionsConfig.inputValue=g.value==undefined?"":g.value;
this.optionsConfig.boxLabel=g.text?g.text:"&nbsp;";
this.optionsConfig.checked=g.checked?g.checked:false;
var k;
if(this.isRadio){k=new CQ.Ext.form.Radio(this.optionsConfig)
}else{k=new CQ.Ext.form.Checkbox(this.optionsConfig)
}this.add(k);
this.optionItems.add(g.value,k)
}}else{var j={fields:["value","text",CQ.shared.XSS.getXSSPropertyName("text"),"qtip"],data:[]};
for(var c=0;
c<b.length;
c++){var k=b[c];
if(k.text=="-"){k.value="menu-separator-item-value"
}else{k.value=k.value!=undefined?k.value:""
}k[CQ.shared.XSS.getXSSPropertyName("text")]=CQ.shared.XSS.getXSSTablePropertyValue(k,"text")?CQ.I18n.getVarMessage(CQ.shared.XSS.getXSSTablePropertyValue(k,"text")):k.value;
k.text=k.text?CQ.I18n.getVarMessage(k.text):k.value;
k.qtip=k.qtip?k.qtip:""
}if(this.sortDir){this.sortOptions(b)
}for(var c=0;
c<b.length;
c++){var k=b[c];
j.data.push([k.value,k.text,k[CQ.shared.XSS.getXSSPropertyName("text")],k.qtip])
}if(!this.comboBox){this.optionsConfig.store=new CQ.Ext.data.SimpleStore(j);
this.optionsConfig.listClass=CQ.Util.createId(CQ.DOM.encodeClass(this.name));
this.comboBox=new CQ.Ext.form.ComboBox(this.optionsConfig);
this.add(this.comboBox)
}else{this.optionsConfig.store.loadData(j.data)
}}if(this.rendered){this.doLayout()
}},sortOptions:function(b){if(this.sortDir!="ASC"&&this.sortDir!="DESC"){return
}var a=this.sortDir=="ASC"?1:-1;
b.sort(function(j,c){var k=j.text.toLowerCase();
var g=c.text.toLowerCase();
if(k>g){return a
}if(k<g){return -a
}return 0
})
},setValue:function(k){if(k instanceof Array&&(this.isRadio||this.isComboBox||this.isSelect)){k=k[0]
}this.value=k;
if(this.rendered){if(this.isRadio){if(this.value instanceof Array){this.value=k[0]
}if(this.value==null){this.optionItems.itemAt(0).setValue(true);
for(var b=1;
b<this.optionItems.length;
b++){this.optionItems.itemAt(b).setValue(false)
}}else{for(var b=0;
b<this.optionItems.length;
b++){var g=this.optionItems.itemAt(b);
if(g.inputValue.toString()==this.value.toString()){g.setValue(true)
}else{g.setValue(false)
}}}}else{if(this.isCheckbox){var a;
if(this.value instanceof Array){a="|"+k.join("|")+"|"
}else{a="|"+k+"|"
}for(var b=0;
b<this.optionItems.length;
b++){var g=this.optionItems.itemAt(b);
if(a.indexOf("|"+g.inputValue+"|")!=-1){g.setValue(true)
}else{g.setValue(false)
}}}else{if(this.isSelect){var c=this.comboBox.store.getTotalCount();
var b=0;
for(;
b<c;
b++){var j=this.comboBox.store.getAt(b).data;
if(j.value==this.value){this.hiddenField.setValue(j.value);
this.comboBox.setValue(j.text);
break
}}if(b==c){if(!this.comboBox.editable){if(this.defaultValue){this.value=this.defaultValue
}else{this.value=""
}}this.hiddenField.setValue(this.value);
this.comboBox.setValue(this.value)
}}else{this.comboBox.setValue(this.value)
}}}}},validateValue:function(a){if(this.isRadio||this.isCheckbox){if(a.length<1){if(this.allowBlank){this.clearInvalid();
return true
}else{this.markInvalid(this.blankText);
return false
}}else{this.clearInvalid();
return true
}}else{return this.comboBox.validateValue(a)
}},markInvalid:function(b){if(this.isRadio||this.isCheckbox){this.el.addClass(this.invalidClass);
b=b||this.invalidText;
var a=this.getMessageHandler();
if(a){a.mark(this,b)
}}this.fireEvent("invalid",this,b)
},clearInvalid:function(){if(this.isRadio||this.isCheckbox){this.el.removeClass(this.invalidClass);
var a=this.getMessageHandler();
if(a){a.clear(this)
}}this.fireEvent("valid",this)
},afterrenderCombo:function(){if(this.optionsConfig.emptyText&&this.comboBox&&this.comboBox.el){this.comboBox.mun(this.comboBox.el,"focus",this.comboBox.onFocus,this.comboBox);
this.comboBox.mon(this.comboBox.el,"focus",this.comboBox.onFocus,this.comboBox,{buffer:500})
}},preselectCombo:function(k,b,g){var a=g;
var c=k.getStore();
for(var j=0;
j<=a&&j<c.getTotalCount();
j++){if(c.getAt(j).data.text=="-"){a++
}}if(g!=a){b=c.getAt(a);
k.setValue(b.data.value);
k.collapse();
k.fireEvent("select",k,b,a);
return false
}return true
},selectCombo:function(c,a,b){if(a.data.text=="&nbsp;"){this.comboBox.setValue("")
}this.hiddenField.setValue(a.data.value);
this.fireComboboxSelectionChanged(c,a,b)
},changeCombo:function(j,g,a){var c=j.store.getTotalCount();
var b=0;
for(;
b<c;
b++){var k=j.store.getAt(b);
if(k&&k.data&&(k.data.text==g||k.data.value==g)){g=k.data.value;
break
}}this.hiddenField.setValue(g);
this.fireComboboxContentChanged(j,g,a)
},fireBoxSelectionChanged:function(b,c){this.validateValue(this.getValue());
var a;
if(b.constructor==CQ.Ext.form.Radio){a=c
}else{a=true
}if(a){this.fireEvent(CQ.form.Selection.EVENT_SELECTION_CHANGED,this,b.getRawValue(),c)
}},fireComboboxSelectionChanged:function(c,a,b){this.fireEvent(CQ.form.Selection.EVENT_SELECTION_CHANGED,this,a.data.value,true)
},fireComboboxContentChanged:function(c,b,a){this.fireEvent(CQ.form.Selection.EVENT_SELECTION_CHANGED,this,b,true)
},fetchOptions:function(url,config){var options=[];
try{var json=CQ.HTTP.eval(url);
if(config.optionsRoot){var optVF=config.optionsValueField||"value";
var optTF=config.optionsTextField||"text";
var optTFXSS=CQ.shared.XSS.getXSSPropertyName(optTF);
var optQF=config.optionsQTipField||"qtip";
var root=(config.optionsRoot==".")?json:json[config.optionsRoot];
for(var i=0;
i<root.length;
i++){var opt={value:root[i][optVF],text:root[i][optTF],text_xss:root[i][optTFXSS]};
if(root[i][optQF]){opt.qtip=root[i][optQF]
}options.push(opt)
}}else{options=CQ.Util.formatData(json)
}}catch(e){CQ.Log.warn("CQ.form.Selection#fetchOptions failed: "+e.message);
options=[]
}return options
},constructor:function(c){if(c.type){this.type=c.type
}switch(this.type){case"combobox":this.isComboBox=true;
break;
case"checkbox":this.isCheckbox=true;
break;
case"select":this.isSelect=true;
break;
default:this.isRadio=true
}if(c.allowBlank!=undefined){this.allowBlank=c.allowBlank
}if(c.optionsCallback){this.optionsCallback=c.optionsCallback;
if(!c.options){c.options=[]
}}if(typeof c.options=="string"){if(c.options.indexOf(CQ.form.Selection.PATH_PLACEHOLDER)>=0){this.contentBasedOptionsURL=c.options;
c.options=[]
}else{c.options=this.fetchOptions(c.options,c)
}}else{if(!c.options){if(this.isCheckbox){c.options=[{value:c.inputValue?c.inputValue:"true",text:c.boxLabel?c.boxLabel:""}]
}else{c.options=[]
}}}this.optionsConfig=c.optionsConfig?c.optionsConfig:{};
var g={height:"auto",border:this.isCheckbox||this.isRadio,style:"padding:0;margin-bottom:0;",hideMode:"display",defaults:{msgTarget:CQ.themes.Dialog.MSG_TARGET}};
CQ.Util.applyDefaults(c,g);
CQ.form.CompositeField.superclass.constructor.call(this,c);
if(this.isCheckbox||this.isRadio){this.optionItems=new CQ.Ext.util.MixedCollection();
var b={xtype:"checkbox",name:c.name,fieldLabel:"&nbsp;",hideLabel:true,hideMode:"display",anchor:CQ.themes.Dialog.SELECT_CHECKBOX_ANCHOR,stateful:false};
CQ.Util.applyDefaults(this.optionsConfig,b);
this.optionsConfig.listeners={render:function(k){var m=k.getEl().dom.parentNode.parentNode.parentNode;
m.style.overflow="hidden"
},check:{fn:this.fireBoxSelectionChanged,scope:this}};
this.setOptions(c.options);
if(!this.isRadio){this.hiddenField=new CQ.Ext.form.Hidden({name:c.name+CQ.Sling.DELETE_SUFFIX,value:"true"});
this.add(this.hiddenField);
if(c.checkboxBoolTypeHint){var j=new CQ.Ext.form.Hidden({name:c.name+CQ.Sling.TYPEHINT_SUFFIX,value:"Boolean"});
this.add(j)
}}}else{var a={xtype:"combo",name:this.name,fieldLabel:"&nbsp;",hideLabel:true,anchor:"100%",tpl:new CQ.Ext.XTemplate('<tpl for="."><tpl if="text == &quot;-&quot;"><div class="cq-panel-divider"><hr/></div></tpl><tpl if="text != &quot;-&quot;"><div ext:qtip="{[CQ.shared.Util.htmlEncode(values["qtip"])]}" class="x-combo-list-item">{[CQ.shared.XSS.getXSSTablePropertyValue(values, "text")]}</div></tpl></tpl>'),displayField:"text",typeAhead:false,mode:"local",emptyText:"",triggerAction:"all",allowBlank:this.allowBlank,hideMode:"display",stateful:false,vtype:c.vtype};
if(this.isSelect){a.selectOnFocus=false;
a.editable=this.editable===true||this.editable=="true";
a.listeners={afterrender:{fn:this.afterrenderCombo,scope:this},beforeselect:{fn:this.preselectCombo,scope:this},select:{fn:this.selectCombo,scope:this},change:{fn:this.changeCombo,scope:this},render:function(k){k.getEl().dom.removeAttribute("name")
}};
this.hiddenField=new CQ.Ext.form.Hidden({name:this.name});
this.add(this.hiddenField)
}else{a.listeners={afterrender:{fn:this.afterrenderCombo,scope:this},beforeselect:{fn:this.preselectCombo,scope:this},select:{fn:this.fireComboboxSelectionChanged,scope:this},change:{fn:this.fireComboboxContentChanged,scope:this}}
}CQ.Util.applyDefaults(this.optionsConfig,a);
this.setOptions(c.options)
}},initComponent:function(){CQ.form.Selection.superclass.initComponent.call(this);
this.addClass(CQ.DOM.encodeClass(this.name)+" cq-selection");
this.addEvents(CQ.form.Selection.EVENT_SELECTION_CHANGED)
},onRender:function(a,b){CQ.form.Selection.superclass.onRender.call(this,a,b);
if(this.value!=null){this.setValue(this.value)
}},disable:function(){CQ.form.Selection.superclass.disable.call(this);
for(var b=0;
b<this.items.getCount();
b++){var a=this.items.itemAt(b);
if(a.disable){a.disable()
}}return this
},enable:function(){CQ.form.Selection.superclass.enable.call(this);
for(var b=0;
b<this.items.getCount();
b++){var a=this.items.itemAt(b);
if(a.enable){a.enable()
}}return this
},focus:function(c,a){if(this.isComboBox||this.isSelect){return this.comboBox.focus(c,a)
}if(this.optionItems&&this.optionItems.length>0){var b=this.optionItems.itemAt(0);
return b.focus()
}return this
}});
CQ.form.Selection.EVENT_SELECTION_CHANGED="selectionchanged";
CQ.form.Selection.PATH_PLACEHOLDER="$PATH";
CQ.form.Selection.PATH_PLACEHOLDER_REGEX=/\$PATH/g;
CQ.Ext.reg("selection",CQ.form.Selection);
CQ.form.SuggestField=CQ.Ext.extend(CQ.Ext.form.ComboBox,{url:"",minTermLength:3,suggestDelay:500,searchDelay:0,suggestIntervalId:0,searchIntervalId:0,lastTerm:null,constructor:function(a){CQ.Util.applyDefaults(a,{tpl:new CQ.Ext.XTemplate("<div>",'<tpl for=".">','<div class="x-combo-list-item">','<div ext:qtip="{value}" class="name {cls}">{name}</div>','<div ext:qtip="{value}" class="title">{[values.title && values.title != "null" ? values.title : ""]}</div>','<div class="nav">','<tpl if="up === true">&laquo;</tpl>','<tpl if="up === false"><span style="color:gray">&laquo;</span></tpl>','<tpl if="down === true">&raquo;</tpl>','<tpl if="down === false"><span style="color:gray">&raquo;</span></tpl>',"</div>","</div>","</tpl>","</div>"),autoSelect:false,displayField:"value",triggerClass:"x-form-search-trigger",listWidth:CQ.themes.SuggestField.LIST_WIDTH,maxHeight:CQ.themes.SuggestField.MAX_HEIGHT,listClass:"cq-suggestions",mode:"local",selectOnFocus:true,enableKeyEvents:true,validationEvent:false,validateOnBlur:false});
if(!(a.store instanceof CQ.Ext.data.Store)){var b=CQ.Util.applyDefaults(a.store,{proxy:new CQ.Ext.data.HttpProxy({url:a.url,method:"GET"}),baseParams:{_charset_:"utf-8"},reader:new CQ.Ext.data.JsonReader({totalProperty:"results",root:"suggestions",id:"value",fields:["value","name","title","up","down","pre","post","cls"]})});
a.store=new CQ.Ext.data.Store(b)
}this.store=a.store;
CQ.form.SuggestField.superclass.constructor.call(this,a)
},initComponent:function(){CQ.form.SuggestField.superclass.initComponent.call(this);
this.addListener("keyup",this.keyupListener,this);
this.addListener("keydown",this.keydownListener,this);
this.addListener("beforeSelect",this.beforeSelectListener,this);
this.addEvents("search")
},keydownListener:function(k,t){var q=t.getKey();
if((q==39||q==37)&&this.isExpanded()){var j=this.store.getAt(this.selectedIndex);
var o=j.get("value");
var b=j.get("pre");
var r=j.get("post");
var m=-1;
var a=false;
var g=true;
if(q==39){if(j.get("down")===false){a=true;
g=false
}}else{if(j.get("up")===false){return
}var c=o.lastIndexOf("/",o.lastIndexOf("/")-1);
o=o.substring(0,c);
m+=2;
if(r==""){r=" "
}}this.setRawValue(b+o+r);
var n=b.length+o.length+m;
if(this.getRawValue().charAt(n)=='"'){n--
}this.setCaretPosition(n);
if(g){this.requestSuggestions(o,b,r)
}else{this.collapse()
}if(a){this.fireEvent("search",this,b+o+r)
}}},keyupListener:function(c,a){var k=this.getRawValue();
var g=this.getCaretPosition();
var b=this.getTermAt(g);
var j=a.getKey();
if(a.isSpecialKey()){if(j==13){this.fireEvent("search",this,k);
if(this.isExpanded&&this.selectedIndex==-1){this.collapse()
}return
}if(!this.isExpanded()){if(j==40){this.suggest(b,k,g);
return
}}return
}if(this.getByteLength(b)<this.minTermLength){return
}if(j==8&&/\/$/.test(b)==false){return
}var m=this;
window.clearTimeout(this.suggestIntervalId);
this.suggestIntervalId=window.setTimeout(function(){m.suggest(b,k,g)
},this.suggestDelay);
if(this.searchDelay){window.clearTimeout(this.searchIntervalId);
this.searchIntervalId=window.setTimeout(function(){m.fireEvent("search",m,k)
},this.searchDelay)
}},getByteLength:function(g){var a=encodeURI(g);
if(a.indexOf("%")!=-1){var c=a.split("%").length-1;
if(c==0){c++
}var b=a.length-(c*3);
c=c+b
}else{c=a.length
}return c
},suggest:function(g,j,a){this.lastTerm=g;
this.caretPos=a;
var k=j.substring(0,(j.lastIndexOf(g,a)));
var c=j.indexOf(" ",a);
var b=c==-1?"":j.substring(c);
this.requestSuggestions(g,k,b)
},requestSuggestions:function(c,g,b){var a=this.name?this.name:this.id;
var j={pre:g,post:b};
j[a]=g+c+b;
j[a+"_term"]=c;
this.store.load({params:j})
},beforeSelectListener:function(j,a,b){var g=a.get("pre");
var c=a.get("value");
this.setRawValue(g+c+a.get("post"));
var k=g.length+c.length;
if(this.getRawValue().charAt(k)=='"'){k--
}this.setCaretPosition(k);
this.collapse();
return false
},getTermAt:function(m){var a=this.getRawValue();
if(a.charAt(m)==" "){m-=1
}var j=false;
var g="";
for(var b=0;
b<a.length;
b++){var k=a.charAt(b);
if(k==" "){if(j){g+=k
}else{if(b>=m){return g
}else{g=""
}}}else{if(k=='"'){j=!j
}else{g+=k
}}}return g
}});
CQ.Ext.reg("suggestfield",CQ.form.SuggestField);
CQ.form.PathCompletion=CQ.Ext.extend(CQ.Ext.form.ComboBox,{searchDelay:200,rootPath:"",lastValue:null,searchIntervalId:0,constructor:function(a){CQ.Util.applyDefaults(a,{tpl:new CQ.Ext.XTemplate('<tpl for=".">','<div ext:qtip="{path}" class="x-combo-list-item">','<span class="cq-pathcompletion-list-name">{label}</span>','<span class="cq-pathcompletion-list-title">{title}</span>',"</div>","</tpl>"),displayField:"path",triggerClass:"x-form-search-trigger",typeAhead:true,mode:"local",selectOnFocus:true,enableKeyEvents:true,validationEvent:false,validateOnBlur:false});
if(!(a.store instanceof CQ.Ext.data.Store)){var b=CQ.Util.applyDefaults(a.store,{proxy:new CQ.Ext.data.HttpProxy({url:"/",method:"GET"}),baseParams:{predicate:"hierarchyNotFile"},reader:new CQ.Ext.data.JsonReader({totalProperty:"results",root:"pages",id:"path",fields:["label","title","path"]})});
a.store=new CQ.Ext.data.Store(b)
}this.store=a.store;
CQ.form.PathCompletion.superclass.constructor.call(this,a)
},initComponent:function(){CQ.form.PathCompletion.superclass.initComponent.call(this);
this.addListener("keyup",this.keyup,this);
this.addEvents("search")
},adjustNewValue:function(a,b){if(/^path:"/.test(a)){b='"'+b+'"'
}return b
},keyup:function(b,a){var j=this.getRawValue();
var g=a.getKey();
if(g==13){this.fireEvent("search",this,j)
}if(j==this.lastValue){return
}this.lastValue=j;
var k=j;
if(/^\//.test(k)&&/\/$/.test(k)){if(k=="/"){k=this.rootPath?this.rootPath:"/"
}else{k=k.replace(/\/$/,"")
}this.loadStore(k)
}else{if(this.searchDelay){window.clearTimeout(this.searchIntervalId);
var c=this;
this.searchIntervalId=window.setTimeout(function(){c.fireEvent("search",c,j)
},this.searchDelay)
}}},loadStore:function(a){this.store.proxy.api.read.url=a+".pages.json";
this.store.reload()
}});
CQ.Ext.reg("pathcompletion",CQ.form.PathCompletion);
CQ.form.HtmlUpload=CQ.Ext.extend(CQ.form.FileUploadField,{initComponent:function(){CQ.form.HtmlUpload.superclass.initComponent.call(this)
},onRender:function(c,a){CQ.form.HtmlUpload.superclass.onRender.call(this,c,a);
var b=this.findParentByType("dialog");
if(b){b.on("beforesubmit",function(){},this)
}}});
CQ.Ext.reg("htmlupload",CQ.form.HtmlUpload);
CQ.form.SizeField=CQ.Ext.extend(CQ.form.CompositeField,{widthParameter:null,widthPrefix:null,widthSuffix:null,heightParameter:null,heightPrefix:null,heightSuffix:null,fieldWidth:0,widthField:null,heightField:null,widthPrefixStyle:null,widthInputClass:null,heightPrefixStyle:null,heightInputClass:null,constructor:function(a){a=a||{};
var b={widthParameter:"./width",heightParameter:"./height",fieldWidth:"40",border:false,layout:"column",widthSuffix:"px",widthSuffixStyle:"padding-top: 3px; padding-left: 4px;",widthInputClass:"cq-sif-widthinput",heightPrefix:"&times;",heightPrefixStyle:"padding-top: 3px; padding-left: 15px; padding-right: 15px;",heightSuffix:"px",heightSuffixStyle:"padding-top: 3px; padding-left: 4px;",heightInputClass:"cq-sif-heightinput",fieldConfig:{vtype:"percent"},stateful:false};
a=CQ.Util.applyDefaults(a,b);
CQ.form.SizeField.superclass.constructor.call(this,a)
},initComponent:function(){CQ.form.SizeField.superclass.initComponent.call(this);
var a;
if(this.widthPrefix){this.add(new CQ.Ext.Panel({html:CQ.I18n.getVarMessage(this.widthPrefix),border:false,style:(this.widthPrefixStyle?this.widthPrefixStyle:null)}))
}a={name:this.widthParameter,maxLength:5,width:this.fieldWidth,cls:(this.widthInputClass?this.widthInputClass:""),stateful:false};
CQ.Ext.apply(a,this.fieldConfig);
this.widthField=new CQ.Ext.form.TextField(a);
this.add(this.widthField);
if(this.widthSuffix){this.add(new CQ.Ext.Panel({html:CQ.I18n.getVarMessage(this.widthSuffix),border:false,style:(this.widthSuffixStyle?this.widthSuffixStyle:null)}))
}if(this.heightPrefix){this.add(new CQ.Ext.Panel({html:CQ.I18n.getVarMessage(this.heightPrefix),border:false,style:(this.heightPrefixStyle?this.heightPrefixStyle:null)}))
}a={name:this.heightParameter,maxLength:5,width:this.fieldWidth,cls:(this.heightInputClass?this.heightInputClass:""),stateful:false};
CQ.Ext.apply(a,this.fieldConfig);
this.heightField=new CQ.Ext.form.TextField(a);
this.add(this.heightField);
if(this.heightSuffix){this.add(new CQ.Ext.Panel({html:CQ.I18n.getVarMessage(this.heightSuffix),border:false,style:(this.heightSuffixStyle?this.heightSuffixStyle:null)}))
}},processRecord:function(c,m){if(this.fireEvent("beforeloadcontent",this,c,m)!==false){var n=null;
var k=null;
if(this.defaultValue){var b=this.defaultValue.split(",");
if(b.length==2){try{n=parseInt(b[0]);
k=parseInt(b[1])
}catch(j){}}}var g=c.get(this.widthParameter);
if(g==undefined&&n!=null){if(this.isApplyDefault(c,m)){this.widthField.setValue(n)
}}else{this.widthField.setValue(g)
}var a=c.get(this.heightParameter);
if(a==undefined&&k!=null){if(this.isApplyDefault(c,m)){this.heightField.setValue(k)
}}else{this.heightField.setValue(a)
}this.fireEvent("loadcontent",this,c,m)
}},setValue:function(g){var b=null;
var a=null;
if(g){var c=g.split(",");
if(c.length==2){try{b=parseInt(c[0]);
a=parseInt(c[1])
}catch(j){}}}this.widthField.setValue(b);
this.heightField.setValue(a)
},getValue:function(){return this.getRawValue()
},getRawValue:function(){var b=this.widthField.getValue()||"";
var a=this.heightField.getValue()||"";
if((b.length==0)&&(a.length==0)){return""
}return b+","+a
},markInvalid:function(a){this.widthField.markInvalid(a);
this.heightField.markInvalid(a)
},clearInvalid:function(){this.widthField.clearInvalid();
this.heightField.clearInvalid()
}});
CQ.Ext.reg("sizefield",CQ.form.SizeField);
CQ.form.ConditionField=CQ.Ext.extend(CQ.form.CompositeField,{expression:"",localFields:undefined,allFields:undefined,rightOperandCtrl:undefined,operandWidth:175,deleteHandler:function(a){},constructor:function(a){if(!a.deleteHandler){a.deleteHandler=this.deleteHandler
}if(!a.expression){expression="null = null"
}var c=this;
var b={xtype:"compositefield",layout:"hbox",bodyStyle:"border:none; padding-bottom:4px",hideLabel:true,items:[{xtype:"selection",type:"select",name:"leftOperand",editable:false,hideLabel:true,flex:this.operandWidth,optionsConfig:{emptyText:CQ.I18n.getMessage("Select a condition field...")},listeners:{selectionchanged:function(){c.updateRightOperandEnumeration(this.getValue(),null)
}}},{xtype:"static",width:5},{xtype:"selection",type:"select",name:"operator",editable:false,hideLabel:true,flex:145},{xtype:"static",width:5,flex:0},{xtype:"textfield",name:"rightOperandTextField",hideLabel:true,flex:this.operandWidth},{xtype:"selection",type:"select",name:"rightOperandDropdown",hideLabel:true,flex:0},{xtype:"static",width:5,flex:0},{xtype:"button",name:"deleteButton",iconCls:"cq-condition-remove",template:new CQ.Ext.Template('<span><button class="x-btn" type="{0}"></button></span>'),scope:this,handler:function(){this.deleteHandler(this)
},flex:0}]};
CQ.Util.applyDefaults(a,b);
CQ.form.ConditionField.superclass.constructor.call(this,a);
this.initFromExpression()
},getExpression:function(){var g=this.find("name","leftOperand")[0].getValue();
var a=this.find("name","operator")[0].getValue();
var c=this.rightOperandCtrl.getValue();
if(!g||!CQ.utils.Form.operators[a]){return null
}if(c){c=CQ.Util.quote(c)
}else{c='""'
}var b=CQ.utils.Form.operators[a].template;
return CQ.Util.patchText(b,[g,c])
},updateRightOperandEnumeration:function(g,n){var b=null;
for(var c=0;
c<this.allFields.length;
c++){var k=this.allFields[c];
if(k.value==g&&k.enumeration){b=k.enumeration.slice(0);
break
}}var a=this.find("name","rightOperandDropdown")[0];
var o=this.find("name","rightOperandTextField")[0];
var m,j;
if(this.rightOperandCtrl){if(this.rightOperandCtrl.getResizeEl()){this.operandWidth=this.rightOperandCtrl.getSize().width
}if(this.rightOperandCtrl.x){m=this.rightOperandCtrl.x;
j=this.rightOperandCtrl.y
}else{if(this.rightOperandCtrl.container){m=this.rightOperandCtrl.container.getX();
j=this.rightOperandCtrl.container.getY()
}}}if(b){a.setOptions(b);
if(m){a.setPosition(m,j)
}a.setWidth(this.operandWidth);
a.flex=o.flex;
o.flex=0;
o.hide();
a.show();
this.rightOperandCtrl=a
}else{if(m){o.setPosition(m,j)
}o.setWidth(this.operandWidth);
o.flex=a.flex;
a.flex=0;
a.hide();
o.show();
this.rightOperandCtrl=o
}if(n){this.rightOperandCtrl.setValue(n)
}},initFromExpression:function(){var c=this.find("name","leftOperand")[0];
var g=this.find("name","operator")[0];
var k=this.find("name","rightOperandDropdown")[0];
var m=this.find("name","rightOperandTextField")[0];
var j=[];
for(var b in CQ.utils.Form.operators){j.push({text:CQ.utils.Form.operators[b].label,value:b})
}g.setOptions(j);
c.setOptions(this.localFields);
k.setOptions([]);
m.setValue("");
var a=CQ.utils.Form.parseCondition(this.expression);
if(!a){g.setValue(j[0].value);
this.updateRightOperandEnumeration("","")
}else{g.setValue(a.operator);
c.setValue(a.left);
this.updateRightOperandEnumeration(a.left,CQ.Util.unquote(a.right))
}}});
CQ.form.ShowHideField=CQ.Ext.extend(CQ.form.CompositeField,{constructor:function(a){var b=this;
var c={xtype:"compositefield",layout:"hbox",bodyBorder:false,fieldLabel:CQ.I18n.getMessage("Show / Hide"),items:[{xtype:"selection",type:"checkbox",itemId:"showHideCheckbox",width:20,listeners:{selectionchanged:function(){var g=b.find("name","./showHideExpression")[0];
if(this.getValue()[0]){if(g.getValue()==""){b.editShowHideRules()
}}else{b.setExpression("")
}CQ.WCM.getSidekick().previewReload=true
}}},{xtype:"textbutton",itemId:"editRulesTextButton",text:CQ.I18n.getMessage("Edit Rules..."),handler:function(){b.editShowHideRules()
},style:"padding-top:5px"},{xtype:"hidden",name:"./showHideExpression"}],listeners:{loadcontent:function(k,g,j){k.loadContent(g)
}}};
CQ.Util.applyDefaults(a,c);
CQ.form.ShowHideField.superclass.constructor.call(this,a)
},loadContent:function(a){this.setExpression(a.data.showHideExpression)
},updateShowHideCheckbox:function(){var c=this.find("itemId","showHideCheckbox")[0];
var b=this.find("name","./showHideExpression")[0];
var a=[b.getValue()!=""];
c.setValue(a)
},setExpression:function(b){var a=this.find("name","./showHideExpression")[0];
a.setValue(b);
this.doValidate()
},doValidate:function(){this.updateShowHideCheckbox();
this.updateEditRulesTextButton()
},updateEditRulesTextButton:function(){var b=this.find("itemId","editRulesTextButton")[0];
var a=this.find("name","./showHideExpression")[0];
if(a.getValue()!=""){b.show()
}else{b.hide()
}},getComponentLabel:function(b){var a=b.find("name","./jcr:title")[0];
if(!a||!a.getValue()){a=b.find("name","./jcr:description")[0]
}if(!a||!a.getValue()){a=b.find("name","./name")[0]
}if(a&&a.getValue()){return a.getValue()
}return CQ.I18n.getMessage("Current component")
},getComponentName:function(c){if(c.store){var a=c.store.getAt(0);
if(a&&a.data.name){return a.data.name
}var b=c.store.url;
if(b){var g=b.substring(b.lastIndexOf("/")+1,b.length-".infinity.json".length);
if(g){return g
}}}return""
},editShowHideRules:function(){var g=this;
var j=this.findParentByType(CQ.Dialog);
var b=this.find("name","./showHideExpression")[0];
var a={componentName:this.getComponentName(j),componentLabel:this.getComponentLabel(j),expression:b.getValue(),okHandler:function(k){g.setExpression(k)
},cancelHandler:function(){g.doValidate()
}};
var c=new CQ.ShowHideRuleEditor(a)
}});
CQ.Ext.reg("showhide",CQ.form.ShowHideField);
CQ.form.SmartFile=CQ.Ext.extend(CQ.form.CompositeField,{resourcePath:null,iconResources:null,extensionToIcon:null,defaultIcon:null,useFlash:true,mimeTypes:null,mimeTypesDescription:null,ddGroups:null,ddAccept:null,sizeLimit:0,fileLimit:0,invalidClass:null,fixedHeight:null,compWidth:0,compHeight:0,fileNameParameter:null,fileReferenceParameter:null,fileNameInputField:null,moveParameter:null,deleteFileParameter:null,deletePathParameter:null,lockIconCls:null,lockPanelCls:null,lockHintCls:null,cancelInheritanceText:null,revertInheritanceText:null,uploadText:null,uploadTextUpload:null,uploadTextReference:null,uploadTextFallback:null,uploadIconCls:null,uploadPanelCls:null,uploadHintCls:null,removeUploadPanelClsOnProgress:false,validateOnSubmitOnly:false,allowUpload:false,allowFileReference:false,allowFileNameEditing:false,transferFileName:false,noFileNameText:"",isUploaded:false,flash:null,flashEl:null,textEl:null,lockTextEl:null,swfEl:null,queuedFlashCommands:null,uploadPanel:null,fileInfo:null,serverFileInstance:null,referencedFileInfo:null,renditionSuffix:null,fallbackRenditionSuffix:null,headPanel:null,footPanel:null,instanceId:0,loginToken:null,constructor:function(a){this.instanceId=CQ.form.SmartFile.ID_COUNTER++;
a=a||{};
var b={hideBorders:true,border:false,anchor:CQ.themes.Dialog.ANCHOR,resourcePath:CQ.form.SmartFile.RESOURCE_PATH,mimeTypes:"*.*",mimeTypesDescription:CQ.I18n.getMessage("All files"),ddAccept:"*",sizeLimit:0,fileLimit:100,stateful:false,allowBlank:true,validateOnSubmitOnly:false,invalidClass:"cq-smartfile-invalid",allowUpload:true,allowFileReference:true,allowFileNameEditing:true,transferFileName:true,noFileNameText:"???",uploadPanelCls:"cq-upload-border",uploadHintCls:"cq-upload-hint",removeUploadPanelClsOnProgress:true,lockIconCls:"cq-lock-placeholder",lockHintCls:"cq-lock-hint",lockPanelCls:"cq-lock-panel",uploadIconCls:"cq-file-placeholder",uploadTextUpload:CQ.I18n.getMessage("Click to upload"),uploadTextReference:CQ.I18n.getMessage("Drop an asset"),uploadTextFallback:CQ.I18n.getMessage("Upload file"),uploadText:CQ.I18n.getMessage("Drop an asset or click to upload"),cancelInheritanceText:CQ.I18n.getMessage("Click to cancel inheritance"),revertInheritanceText:CQ.I18n.getMessage("Click here to revert inheritance"),iconResources:CQ.themes.SmartFile.ICON_RESOURCES,extensionToIcon:CQ.themes.SmartFile.EXTENSION_TO_ICON,defaultIcon:CQ.themes.SmartFile.DEFAULT_ICON,renditionSuffix:CQ.form.SmartFile.DAM_RENDITIONS_PATH+CQ.form.SmartFile.DAM_WEB_RENDITION_NAME,fallbackRenditionSuffix:CQ.form.SmartFile.DAM_RENDITION_SUFFIX,height:120,listeners:{resize:this.onComponentResize},useFlash:true};
if(a.allowFileReferenceOnly!==undefined){a.allowFileReference=!a.allowFileReferenceOnly;
delete a.allowFileReferenceOnly
}if(this.allowUploadOnly!==undefined){a.allowUpload=!a.allowUploadOnly;
delete a.allowUploadOnly
}if(!a.allowFileReference&&!a.allowUpload){a.allowFileReference=true
}a.autoScroll=false;
a.bodyStyle="padding: 0px; overflow: hidden;";
a.layout="border";
CQ.Util.applyDefaults(a,b);
if(a.height&&(a.height!="auto")){this.fixedHeight=a.height
}else{this.fixedHeight=null
}if(CQ.endorsed.swfobject.getFlashPlayerVersion().major<9){a.useFlash=false
}CQ.form.SmartFile.superclass.constructor.call(this,a)
},initComponent:function(){CQ.form.SmartFile.superclass.initComponent.call(this);
var b=this;
this.containerPanel=new CQ.Ext.Panel({region:"center",ctCls:CQ.DOM.encodeClass("smartfile-"+this.name),activeItem:0,autoScroll:false,bodyStyle:"padding: 0px; overflow: hidden;",layout:"card"});
this.add(this.containerPanel);
this.lockPanel=new CQ.Ext.Panel({itemId:"lock",cls:this.lockPanelCls,layout:"fit",border:false,style:"padding: 0;",bodyStyle:"position: relative; top: 0; left: 0;",listeners:{resize:function(j,k,g){if(typeof k=="object"){g=k.height;
k=k.width
}this._width=k;
this._height=g;
if(this.rendered){b.setTextElSize(b.lockTextEl,k,g)
}}},afterRender:function(){CQ.Ext.Panel.prototype.afterRender.call(this);
this.el.setVisibilityMode(CQ.Ext.Element.DISPLAY);
this.body.setVisibilityMode(CQ.Ext.Element.DISPLAY);
if(b.fixedHeight){var g=b.fixedHeight;
this.el.setHeight(g);
this.body.setHeight(g-this.el.getBorderWidth("tb"))
}}});
this.containerPanel.add(this.lockPanel);
this.uploadPanel=new CQ.Ext.Panel({itemId:"upload",cls:this.uploadPanelCls,layout:"fit",border:false,style:"padding: 0;",bodyStyle:"position: relative; top: 0; left: 0;",listeners:{resize:function(j,m,g){if(typeof m=="object"){g=m.height;
m=m.width
}this._width=m;
this._height=g;
if(this.rendered){b.setTextElSize(b.textEl,m,g);
b.setProgressBarSize(m,g);
var k=(b.textEl)?b.textEl.getHeight():g;
b.setFlashSize(m,k)
}}},afterRender:function(){CQ.Ext.Panel.prototype.afterRender.call(this);
this.el.setVisibilityMode(CQ.Ext.Element.DISPLAY);
this.body.setVisibilityMode(CQ.Ext.Element.DISPLAY);
if(b.fixedHeight){var g=b.fixedHeight;
this.el.setHeight(g);
this.body.setHeight(g-this.el.getBorderWidth("tb"))
}}});
this.containerPanel.add(this.uploadPanel);
this.createFileNameEditingCapability();
this.processingPanel=this.createProcessingPanel();
this.containerPanel.add(this.processingPanel);
this.createHiddenInterfaceFields();
if(this.headPanel){this.headPanel.region="north";
this.add(this.headPanel)
}if(this.footPanel){this.footPanel.region="south";
this.add(this.footPanel)
}if(!this.useFlash){var a={name:this.name,fieldLabel:this.uploadTextFallback,fileNameParameter:this.fileNameParameter,allowFileNameEditing:this.allowFileNameEditing};
if(this.fullTab){a.fieldLabel=this.uploadTextFallback
}this.fallbackFileField=new CQ.form.FileUploadField(a);
var c={itemId:"fallback",layout:"form",defaults:{anchor:CQ.themes.Dialog.ANCHOR},hideMode:"offsets",border:false,items:this.fallbackFileField};
if(this.fullTab){c.bodyStyle=CQ.themes.Dialog.TAB_BODY_STYLE
}else{c.defaults.hideLabel=true
}this.fallbackPanel=new CQ.Ext.Panel(c);
this.containerPanel.add(this.fallbackPanel)
}},getToplevel:function(){var a=this.findParentByType("dialog");
if(!a){a=this.findParentByType(CQ.Ext.form.FormPanel)
}return a
},onRender:function(b,j){CQ.form.SmartFile.superclass.onRender.call(this,b,j);
this.el.setVisibilityMode(CQ.Ext.Element.DISPLAY);
this.body.setVisibilityMode(CQ.Ext.Element.DISPLAY);
var a=this.findParentByType("dialog");
if(a){a.on("beforesubmit",function(){this.syncFormElements();
return this.onBeforeSubmit()
},this)
}else{var c=this.findParentByType(CQ.Ext.form.FormPanel);
if(c){var g=c.getForm();
g.on("beforeaction",function(){this.syncFormElements();
return this.onBeforeSubmit()
},this)
}}},afterRender:function(){CQ.form.SmartFile.superclass.afterRender.call(this);
this.initializeDragAndDrop()
},onComponentResize:function(b,a){if(typeof b=="object"){a=b.height;
b=b.width
}this.compWidth=b;
this.compHeight=a
},switchPropertyInheritance:function(){},markInvalid:function(a){if(!this.rendered||this.preventMark){return
}a=a||this.invalidText;
this.uploadPanel.body.addClass(this.invalidClass);
this.processingPanel.markInvalid(this.invalidClass);
this.uploadPanel.body.dom.qtip=a;
this.uploadPanel.body.dom.qclass="x-form-invalid-tip";
if(CQ.Ext.QuickTips){CQ.Ext.QuickTips.enable()
}this.fireEvent("invalid",this,a)
},clearInvalid:function(){if(!this.rendered||this.preventMark){return
}this.uploadPanel.body.removeClass(this.invalidClass);
this.processingPanel.clearInvalid(this.invalidClass);
this.fireEvent("valid",this)
},validateOnStateChange:function(){if(!this.validateOnSubmitOnly){this.validate()
}this.validateLinkingFieldsOnStateChange()
},validateLinkingFieldsOnStateChange:function(){var g=this.getToplevel();
if(g){var b=CQ.Util.findFormFields(g);
if(b){for(var a in b){if(b.hasOwnProperty(a)){var k=b[a];
var j=k.length;
for(var m=0;
m<j;
m++){var c=k[m];
if(c.linkedComponent==this.name){c.validate()
}}}}}}},hasData:function(){return(this.fileInfo!=null)||(this.referencedFileInfo!=null)
},hasUploadedData:function(){return(this.fileInfo!=null)
},hasReferencedData:function(){return(this.referencedFileInfo!=null)
},createFileNameEditingCapability:function(){if(!this.allowFileNameEditing){this.fileNameField=new CQ.Ext.form.Hidden({disabled:!this.transferFileName})
}else{this.fileNameField=new CQ.Ext.form.TextField({autoHeight:false});
this.transferFileName=true
}this.containerPanel.add(this.fileNameField)
},createHiddenInterfaceFields:function(){this.fileReferenceField=new CQ.Ext.form.Hidden({disabled:true});
this.containerPanel.add(this.fileReferenceField);
this.moveParameter=new CQ.Ext.form.Hidden({disabled:true});
this.containerPanel.add(this.moveParameter);
this.deleteFileParameter=new CQ.Ext.form.Hidden({disabled:true,value:"true"});
this.containerPanel.add(this.deleteFileParameter);
this.deletePathParameter=new CQ.Ext.form.Hidden({disabled:true,value:"true"});
this.containerPanel.add(this.deletePathParameter);
this.lastModifiedParameter=new CQ.Ext.form.Hidden({disabled:true,value:""});
this.containerPanel.add(this.lastModifiedParameter);
this.lastModifiedByParameter=new CQ.Ext.form.Hidden({disabled:true,value:""});
this.containerPanel.add(this.lastModifiedByParameter)
},onBeforeSubmit:function(){return true
},getRawValue:function(){var a="";
if(this.fileInfo){a+='[instance:"'+this.fileInfo.dataPath+'" "'+this.fileInfo.mimeType+'" '+this.fileInfo.size+"]"
}if(this.referencedFileInfo){a+='[reference:"'+this.referencedFileInfo.dataPath+'" "'+this.referencedFileInfo.mimeType+'" '+this.referencedFileInfo.size+"]"
}if(this.fileNameInputField){a+='[fileName:"'+this.fileNameInputField.getValue()+'"]'
}return a
},createRefUrl:function(a){var c="";
for(var g in a.renditions){var j=CQ.form.SmartFile.DAM_RENDITIONS_PATH+g;
if(j==this.renditionSuffix){break
}if(j.indexOf(this.renditionSuffix)==0){c=g.substring(g.lastIndexOf("."));
break
}}var b=a.dataPath+this.renditionSuffix+c;
return CQ.HTTP.externalize(CQ.shared.HTTP.encodePath(b),true)
},createFallbackRefUrl:function(a){var b=a.dataPath+this.fallbackRenditionSuffix;
return CQ.HTTP.externalize(CQ.shared.HTTP.encodePath(b),true)
},getSuitableFileInfo:function(){if(this.referencedFileInfo!=null){return this.referencedFileInfo
}return this.fileInfo
},processPath:function(b,a){if(a){this.dataPath=b;
this.isUploaded=false;
this.fileInfo=null;
this.referencedFileInfo=null;
this.validateOnStateChange();
this.syncFormElements();
this.updateView();
if(CQ.undo.UndoManager.isEnabled()){CQ.undo.util.UndoUtils.addBlobMarkerField(this.getToplevel(),{type:"create",path:b,field:this.getName()})
}}},processRecord:function(b,m){if(this.fireEvent("beforeloadcontent",this,b,m)!==false){if("allowUpload" in b.data){this.allowUpload=b.data.allowUpload
}this.dataPath=m;
this.isUploaded=false;
this.fileInfo=null;
this.referencedFileInfo=null;
var n;
if(this.fileNameParameter){n=b.get(this.fileNameParameter)
}if(this.fileReferenceParameter){var c=b.get(this.fileReferenceParameter);
if(c){this.referencedFileInfo=this.resolveReference(c,m);
if(n){this.referencedFileInfo.fileName=n
}this.referencedFileInfo.url=this.createRefUrl(this.referencedFileInfo);
this.referencedFileInfo.fallbackUrl=this.createFallbackRefUrl(this.referencedFileInfo)
}}var k=b.get(this.name);
if(k){if(k["jcr:content"]){k=CQ.Sling.processBinaryData(k["jcr:content"])
}else{k=CQ.Sling.processBinaryData(k)
}if(k){var g=CQ.Sling.getContentPath(this.name,m);
this.fileInfo={fileName:n,dataPath:g,mimeType:k.type,size:k.size,url:CQ.HTTP.externalize(g,true)};
this.serverFileInstance=this.fileInfo
}}this.postProcessRecord(b,m);
this.validateOnStateChange();
this.syncFormElements();
this.updateView();
if(CQ.undo.UndoManager.isEnabled()){var a=this.getToplevel();
CQ.undo.util.UndoUtils.addBlobMarkerField(this.getToplevel(),{type:"update",path:m,field:this.getName()});
var j=(a.getXType()=="dialog"?a.form:(a.getXType()=="form"?a.getForm():null));
if(j){if(this.fileNameField&&!j.items.contains(this.fileNameField)){j.add(this.fileNameField)
}}}this.fireEvent("loadcontent",this,b,m)
}},postProcessRecord:function(a,b){},resolveReference:function(fileRef,basePath){var refFileInfo=null;
var originalFileRef=fileRef;
try{if(fileRef.indexOf("/")==0){fileRef=fileRef+"/jcr:content.infinity";
var json=CQ.HTTP.eval(CQ.shared.HTTP.encodePath(fileRef)+CQ.HTTP.EXTENSION_JSON);
var refValue=CQ.Util.formatData(json);
if(refValue){refFileInfo=CQ.Sling.processBinaryData(refValue);
if(refFileInfo.renditions&&refFileInfo.renditions.original&&refFileInfo.renditions.original["jcr:content"]){refFileInfo.size=refFileInfo.renditions.original["jcr:content"][":jcr:data"];
refFileInfo.mimeType=refFileInfo.renditions.original["jcr:content"]["jcr:mimeType"]
}if(!refFileInfo.mimeType&&refFileInfo.metadata){refFileInfo.mimeType=refFileInfo.metadata["dc:format"]
}if(basePath){refFileInfo.dataPath=CQ.Sling.getContentPath(originalFileRef,basePath);
refFileInfo.url=CQ.HTTP.externalize(refFileInfo.dataPath)
}else{refFileInfo.dataPath=originalFileRef;
refFileInfo.url=originalFileRef
}}}else{refFileInfo={dataPath:fileRef,url:fileRef}
}}catch(e){CQ.Log.error("SmartFile#resolveReference: failed to resolve reference: "+e.message)
}return refFileInfo
},syncFormElements:function(){var k=this.uploadName?this.uploadName:this.name;
if(k.length<2||k.substring(0,2)!="./"){k="./"+k
}if(this.fileNameField){if(!this.fileNameParameter){this.fileNameParameter=k+CQ.form.SmartFile.PARAM_FILENAME_SUFFIX
}if(this.useFlash||this.containerPanel.layout.activeItem.itemId!="fallback"){this.fileNameField.getEl().dom.name=this.fileNameParameter;
if(this.fallbackFileField){this.fallbackFileField.getEl().dom.name="";
this.fallbackFileField.fileInput.dom.name=""
}}else{this.fileNameField.getEl().dom.name="";
if(this.fallbackFileField){this.fallbackFileField.getEl().dom.name=this.fileNameParameter
}}}if(this.fileReferenceField){if(!this.fileReferenceParameter){this.fileReferenceParameter=k+CQ.form.SmartFile.PARAM_REFERENCE_SUFFIX
}this.fileReferenceField.getEl().dom.name=this.fileReferenceParameter
}if(this.moveParameter){this.moveParameter.getEl().dom.name=k+CQ.Sling.MOVE_SUFFIX
}if(this.deleteFileParameter){this.deleteFileParameter.getEl().dom.name=k+CQ.Sling.DELETE_SUFFIX
}if(this.fileReferenceField){var c=(this.referencedFileInfo?this.referencedFileInfo.dataPath:"");
this.fileReferenceField.setValue(c);
this.fileReferenceField.enable()
}if(this.moveParameter){if(this.fileInfo&&this.isUploaded){this.moveParameter.setValue(this.fileInfo.dataPath);
this.moveParameter.enable()
}else{this.moveParameter.disable()
}}if(this.useFlash&&this.deleteFileParameter){if(this.serverFileInstance&&!this.fileInfo){this.deleteFileParameter.enable()
}else{this.deleteFileParameter.disable()
}}var a=false;
var b;
var j=k.lastIndexOf("/");
if(j>0){var g=k.substring(0,j);
if(g!="."){a=true;
b=g
}}if(a){this.lastModifiedParameter.getEl().dom.name=b+"/jcr:lastModified";
this.lastModifiedByParameter.getEl().dom.name=b+"/jcr:lastModifiedBy";
this.lastModifiedParameter.enable();
this.lastModifiedByParameter.enable()
}else{this.lastModifiedParameter.getEl().dom.name=null;
this.lastModifiedByParameter.getEl().dom.name=null;
this.lastModifiedParameter.disable();
this.lastModifiedByParameter.disable()
}},flush:function(){if(this.referencedFileInfo){this.referencedFileInfo=null
}else{if(this.fileInfo){this.fileInfo=null
}}if((this.referencedFileInfo==null)&&(this.fileInfo==null)&&this.fileNameField){this.fileNameField.setValue("")
}this.validateOnStateChange();
if(!this.useFlash){this.deleteFileParameter.enable();
this.fallbackFileField.fileInput.dom.name="";
this.fallbackFileField.setValue("")
}},createLockPanel:function(){this.isLockPanelCreated=true;
var c=this.lockPanel.body;
var k=this.lockPanel.items.getCount();
for(var b=k-1;
b>=0;
b--){this.remove(this.lockPanel.items.itemAt(b))
}var a;
if(this.lockIconCls){a='<img src="'+CQ.Ext.BLANK_IMAGE_URL+'" alt="" border="0" class="'+this.lockIconCls+'"><br>'
}else{a=""
}var g=this.cancelInheritanceText;
var j=a+g;
this.lockTextEl=c.createChild({tag:"div",html:j});
this.lockTextEl.addListener("click",function(){this.switchPropertyInheritance()
},this);
this.lockTextEl.setVisibilityMode(CQ.Ext.Element.DISPLAY);
if(this.lockPanel._width&&this.lockPanel._height){this.setTextElSize(this.lockTextEl,this.lockPanel._width,this.lockPanel._height)
}if(this.lockHintCls){this.lockTextEl.addClass(this.lockHintCls)
}},updateView:function(){if(this.editLock){this.containerPanel.getLayout().setActiveItem("lock");
if(!this.isLockPanelCreated){this.createLockPanel()
}}else{var a=(this.fileInfo!=null)||(this.referencedFileInfo!=null);
this.updateViewBasics(a);
if(a){this.createProcessingPanelContents()
}}this.doLayout()
},updateViewBasics:function(a){if(!a){this.containerPanel.getLayout().setActiveItem("upload");
if(!this.isUploadPanelCreated){this.createUploadPanel()
}else{this.switchToUploadBase()
}if(this.uploadHintCls){this.body.addClass(this.uploadHintCls);
if(this.textEl){this.textEl.addClass(this.uploadHintCls)
}}}else{if(CQ.Ext.isIE){if(this.flash){this.flash.destroy();
this.flash=null
}}if(this.uploadHintCls){this.body.removeClass(this.uploadHintCls);
if(this.textEl){this.textEl.removeClass(this.uploadHintCls)
}}this.containerPanel.getLayout().setActiveItem("processing")
}},createProcessingPanel:function(){return new CQ.form.SmartFile.FileInfoDisplay({itemId:"processing",fileNameField:(this.allowFileNameEditing&&this.fileNameField?this.fileNameField:null),parentComponent:this})
},createProcessingPanelContents:function(){var g=this.getSuitableFileInfo();
var c=g.fileName;
var n=null;
if(c){var j=c.lastIndexOf(".");
if((j>=0)&&(j<(c.length-1))){n=c.substring(j+1,c.length).toLowerCase()
}}var k=this.defaultIcon;
if(n&&this.extensionToIcon[n]){k=this.extensionToIcon[n]
}var m=this.iconResources;
if(m.charAt(m.length-1)!="/"){m+="/"
}var a=CQ.HTTP.externalize(m+k);
var q=CQ.I18n.getMessage("unknown");
if(g.mimeType){q=g.mimeType
}var b=CQ.I18n.getMessage("unknown");
if(g.size){b=CQ.Util.formatFileSize(g.size)
}var o=CQ.I18n.getMessage("MIME type: {0}<br>Size: {1}",[q,b]);
if(this.referencedFileInfo){o+="<br>"+this.getRefText(this.referencedFileInfo.dataPath,c)
}if(!this.transferFileName){c=this.noFileNameText
}this.processingPanel.updateContent(c,o,a)
},getRefText:function(b,c){var a=CQ.User.getCurrentUser().hasPermissionOn("update",b);
var j=CQ.HTTP.externalize(CQ.shared.XSS.getXSSValue(CQ.shared.HTTP.encodePath(b),true));
var g=CQ.I18n.getMessage("Referenced from:")+" ";
if(a){g+='<a href="'+j+'" target="_blank" title="'+CQ.I18n.getMessage("Click here to open referenced file")+'" style="cursor:pointer;">'
}g+=CQ.shared.XSS.getXSSValue(c?c:b);
if(a){g+="</a>"
}return g
},createRevertInheritanceHint:function(){var a=this.uploadPanel.body.createChild({tag:"div",cls:this.lockHintCls,html:this.revertInheritanceText});
a.addListener("click",function(){this.switchPropertyInheritance()
},this)
},createUploadPanel:function(){this.isUploadPanelCreated=true;
var c=this.uploadPanel.body;
var m=this.uploadPanel.items.getCount();
for(var b=m-1;
b>=0;
b--){this.remove(this.uploadPanel.items.itemAt(b))
}var a;
if(this.uploadIconCls){a='<img src="'+CQ.Ext.BLANK_IMAGE_URL+'" alt="" border="0" class="'+this.uploadIconCls+'"><br>'
}else{a=""
}var g=this.uploadText;
if(!this.allowUpload){g=this.uploadTextReference
}if(!this.allowFileReference){g=this.uploadTextUpload
}var k=a+g;
this.textEl=c.createChild({tag:"div",html:k});
if(this.delayedCreateRevertInheritanceHint&&!this.isLockHintCreated){this.createRevertInheritanceHint();
this.delayedCreateRevertInheritanceHint=false;
this.isLockHintCreated=true
}if(!this.useFlash&&this.allowUpload){this.textEl.addListener("click",function(){this.containerPanel.getLayout().setActiveItem("fallback");
this.fallbackFileField.fileInput.dom.name=this.name;
this.deleteFileParameter.disable()
},this)
}if(this.uploadHintCls){this.textEl.addClass(this.uploadHintCls)
}this.textEl.setVisibilityMode(CQ.Ext.Element.DISPLAY);
if(this.uploadPanel._width&&this.uploadPanel._height){this.setTextElSize(this.textEl,this.uploadPanel._width,this.uploadPanel._height)
}if(this.useFlash){this.flashEl=c.createChild({tag:"div",id:"_"+this.getXType()+"_"+this.instanceId+"_upload",cls:"cq-smartfile-upload",style:"position: absolute; top: 0px; left: 0px;"});
var j=this.flashEl.createChild({tag:"span"});
this.swfEl=null;
if(this.uploadHintCls){this.body.addClass(this.uploadHintCls)
}if(this.allowUpload){this.initFlash(j);
if(this.flash){this.swfEl=CQ.Ext.get(this.flash.movieName)
}}}},switchToUploadProgress:function(){if(this.removeUploadPanelClsOnProgress&&this.uploadPanelCls){this.uploadPanel.removeClass(this.uploadPanelCls)
}var b=this.uploadPanel.body;
this.textEl.setVisible(false);
if(this.flash){this.flash.setButtonDisabled(true)
}if(!this.progressBar){this.progressBar=new CQ.Ext.ProgressBar({text:"&nbsp;"});
var a="padding-left: 5px; padding-right: 5px; position: absolute; top: 0px; left: 0px;";
if(this.fixedHeight){a+=" height: "+this.fixedHeight+"px"
}this.progressBarDiv=b.createChild({tag:"div",style:a});
this.progressBarDiv.setVisibilityMode(CQ.Ext.Element.DISPLAY);
if(this.uploadPanel._width&&this.uploadPanel._height){this.setProgressBarSize(this.uploadPanel._width,this.uploadPanel._height)
}this.progressBar.render(this.progressBarDiv);
this.progressBar.updateProgress(0,"Uploading ...")
}else{this.progressBarDiv.setVisible(true)
}},switchToUploadBase:function(){if(this.allowUpload){if(CQ.Ext.isIE){if(this.useFlash){var a=this.flashEl.dom;
if(this.swfEl){try{a.removeChild(this.swfEl.dom)
}catch(g){}this.swfEl=null
}var c=document.createElement("span");
c.id="__ieworkaround_"+new Date().getTime();
a.appendChild(c);
if(!a.parentNode){this.textEl.dom.parentNode.appendChild(a)
}this.initFlash(c);
if(this.flash){this.swfEl=CQ.Ext.get(this.flash.movieName)
}}}else{if(this.uploadPanel._width&&this.uploadPanel._height){this.textEl.setVisible(true);
var b=(this.textEl)?this.textEl.getHeight():this.uploadPanel._height;
this.setFlashSize(this.uploadPanel._width,b)
}if(this.flash){this.executeFlashCommand(this.flash.setButtonDisabled,[false])
}}}if(this.progressBarDiv){this.progressBarDiv.setVisible(false)
}if(this.removeUploadPanelClsOnProgress&&this.uploadPanelCls){this.uploadPanel.addClass(this.uploadPanelCls)
}this.textEl.setVisible(true)
},setTextElSize:function(b,c,a){if(b){if(!this.msgHeight){this.msgHeight=b.getHeight()
}var g=Math.round((a-this.msgHeight)/2);
if(g>0){b.setStyle("padding-top",g+"px")
}}},setProgressBarSize:function(b,a){if(this.progressBarDiv){this.progressBarDiv.setSize(b,a)
}},setFlashSize:function(b,a){if(this.flashEl){this.flashEl.setSize(b,a);
if(this.swfEl){this.swfEl.setSize(b,a)
}if(this.flash){this.executeFlashCommand(this.flash.setButtonDimensions,[b,a])
}}},flushFile:function(){this.flush();
this.syncFormElements();
this.updateView()
},initializeDragAndDrop:function(){if(this.allowFileReference&&this.ddGroups){if(typeof(this.ddGroups)=="string"){this.ddGroups=[this.ddGroups]
}var j=this;
var k=new CQ.wcm.EditBase.DropTarget(this.el,{notifyDrop:function(q,m,o){if(q&&q.clearAnimations){q.clearAnimations(this)
}if(q.isDropAllowed(this)){var n=j.handleDrop(o);
if(n){m.stopEvent()
}return n
}}});
var c=this.getToplevel();
if(c){c.on("activate",function(n){if(n&&n.el&&this.highlight){var m=parseInt(n.el.getStyle("z-index"),10);
if(!isNaN(m)){this.highlight.zIndex=m+1
}}},k);
c.on("deactivate",function(n){if(n&&n.el&&this.highlight){var m=parseInt(n.el.getStyle("z-index"),10);
if(!isNaN(m)){this.highlight.zIndex=m+1
}}},k)
}for(var b=0;
b<this.ddGroups.length;
b++){k.addToGroup(this.ddGroups[b])
}k.removeFromGroup(CQ.wcm.EditBase.DD_GROUP_DEFAULT);
var a=this.ddAccept;
if(a){if(!CQ.Ext.isArray(a)){var g=new RegExp("[ ;]+","g");
a=a.split(g)
}k.ddAccept=a
}this.dropTargets=[];
this.dropTargets.push(k)
}},handleDrop:function(a){if(this.handleDropBasics(a)){this.syncFormElements();
this.updateView();
return true
}return false
},handleDropBasics:function(c){if(c.records&&c.single){var a=c.records[0];
var b=a.get("path");
this.referencedFileInfo=this.resolveReference(b,this.dataPath);
var g=a.get("name");
if(g){this.referencedFileInfo.fileName=g
}this.referencedFileInfo.url=this.createRefUrl(this.referencedFileInfo);
this.referencedFileInfo.fallbackUrl=this.createFallbackRefUrl(this.referencedFileInfo);
this.validateOnStateChange();
return true
}return false
},mask:function(){if(!this.loadMask){this.loadMask=new CQ.Ext.LoadMask(this.flashEl.id,{msg:CQ.I18n.getMessage("Loading file...")})
}this.loadMask.show()
},unmask:function(){if(this.loadMask){this.loadMask.hide()
}},onUploaded:function(){this.syncFormElements();
this.updateView();
return true
},correctFileSize:function(a){if(a===0){return a
}return a+"MB"
},formatTimeLeft:function(b){if(b>86399){b=Math.round(b/86400);
if(b==1){return CQ.I18n.getMessage("{0} day",[b])
}else{return CQ.I18n.getMessage("{0} days",[b])
}}else{if(b>3599){b=new String(b/3600);
var a=b.indexOf(".");
if(a>0){if(b.charAt(a+1)=="0"){b=b.substring(0,a)
}else{b=b.substring(0,a+2)
}}if(b==1){return CQ.I18n.getMessage("{0} hour",[b])
}else{return CQ.I18n.getMessage("{0} hours",[b])
}}else{if(b<=3600&&b>59){b=Math.round(b/60)+"";
if(b==1){return CQ.I18n.getMessage("{0} minute",[b])
}else{return CQ.I18n.getMessage("{0} minutes",[b])
}}else{if(b==1){return CQ.I18n.getMessage("{0} second",[b])
}else{return CQ.I18n.getMessage("{0} seconds",[b])
}}}}},estimateTimeLeft:function(a,b){var c=new Date().valueOf()-this.startTime;
var g=Math.round(c*(b-a)/a/1000);
return this.formatTimeLeft(g)
},handleDialogStart:function(){if(this.pendingFiles>0){this.flash.cancelUpload();
this.pendingFiles=0
}},handleQueueSuccess:function(a){},handleQueueError:function(a,c,b){b=a.name+": "+b;
switch(c){case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:b+=" ("+this.sizeLimit+" MB)";
break;
case SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED:b+=" ("+this.fileLimit+")";
break
}this.notify(b,CQ.form.SmartFile.STATUS_ERROR)
},handleFilesSelected:function(){this.mask()
},handleDialogComplete:function(){var a=this;
if(a.name){a.flash.setFilePostName(a.name+CQ.form.SmartFile.PARAM_TEMP_NODE_SUFFIX)
}a.flash.startUpload()
},handleUploadStart:function(a){this.startTime=new Date().valueOf();
return true
},handleUploadProgress:function(a,j,g){if(this.progressBar){var c=Math.round(100*j/g);
var b=CQ.I18n.getMessage("{0} of {1} - {2}",[CQ.Util.formatFileSize(j),CQ.Util.formatFileSize(g),this.estimateTimeLeft(j,g)]);
this.progressBar.updateProgress(c/100,b)
}},handleUploadSuccess:function(c,g){var b=false;
var m=this.fileInfo;
try{var o=this.dataPath;
var j;
if(this.name=="./*"){j=c.name
}else{j=this.name;
var a=this.name.indexOf("/");
if(a>=0){j=this.name.substring(a+1)
}}o=CQ.Sling.getContentPath(j+CQ.html5.form.SmartFile.PARAM_TEMP_NODE_SUFFIX,o);
try{this.fileInfo=this.resolveReference(o,this.dataPath);
this.fileInfo.fileName=c.name
}catch(k){this.fileInfo={fileName:c.name,dataPath:o,url:CQ.HTTP.externalize(o),size:c.size}
}this.isUploaded=true;
b=(this.onUploaded()!==false);
if(this.transferFileName&&this.fileNameField){this.fileNameField.setValue(this.fileInfo.fileName)
}else{this.fileNameField.setValue("")
}this.validateOnStateChange();
this.unmask()
}catch(k){CQ.Log.error("CQ.form.SmartFile#handleUploadSuccess: "+k.message)
}var n;
if(!b){this.fileInfo=m;
n=CQ.I18n.getMessage("Error uploading '{0}'",[c.name]);
this.notify(n,CQ.form.SmartFile.STATUS_ERROR)
}},handleUploadError:function(a,c,b){b=CQ.I18n.getMessage("Failed to upload '{0}': {1}",[a.name,b]);
this.notify(b,CQ.form.SmartFile.STATUS_ERROR);
if(c!=SWFUpload.UPLOAD_ERROR.FILE_CANCELLED){}},handleUploadComplete:function(){this.startTime=0;
this.pendingFiles=0
},initFlash:function(a){this.flashReady=false;
this.queuedFlashCommands=null;
var b=new Object();
b[CQ.Sling.STATUS]=CQ.Sling.STATUS_BROWSER;
this.flash=new SWFUpload({upload_url:CQ.HTTP.externalize(this.dataPath.replace("jcr:content","_jcr_content")),file_post_name:this.name+CQ.form.SmartFile.PARAM_TEMP_NODE_SUFFIX,flash_url:CQ.HTTP.externalize(this.resourcePath)+"/swfupload.swf",file_size_limit:this.correctFileSize(this.sizeLimit),file_upload_limit:this.fileLimit,file_queue_limit:this.fileLimit,file_types:this.mimeTypes,file_types_description:this.mimeTypesDescription,post_params:b,button_placeholder_id:(a.dom?a.dom.id:a.id),button_width:this.uploadPanel.el.getWidth(),button_height:this.textEl.getHeight(),debug:false,use_query_string:false,swfupload_loaded_handler:function(){this.processFlashCommandQueue();
this.flashReady=true
}.createDelegate(this),file_dialog_start_handler:this.handleDialogStart.createDelegate(this),files_selected_handler:this.handleFilesSelected.createDelegate(this),file_dialog_complete_handler:this.handleDialogComplete.createDelegate(this),file_queued_handler:this.handleQueueSuccess.createDelegate(this),file_queue_error_handler:this.handleQueueError.createDelegate(this),upload_start_handler:this.handleUploadStart.createDelegate(this),upload_progress_handler:this.handleUploadProgress.createDelegate(this),upload_error_handler:this.handleUploadError.createDelegate(this),upload_success_handler:this.handleUploadSuccess.createDelegate(this),upload_complete_handler:this.handleUploadComplete.createDelegate(this),debug_handler:function(g){g=g.split("\n");
for(var c in g){}}})
},executeFlashCommand:function(b,a){if(this.flashReady){try{b.apply(this.flash,a)
}catch(c){this.queueDeferredFlashCommand(b,a)
}}else{if(!this.queuedFlashCommands){this.queuedFlashCommands=[]
}this.queuedFlashCommands.push({fn:b,args:a})
}},queueDeferredFlashCommand:function(b,a){if(!this.queuedFlashCommands){this.queuedFlashCommands=[]
}this.queuedFlashCommands.push({fn:b,args:a});
if(this.intervalId==null){this.intervalId=window.setInterval(function(){this.processFlashCommandQueue();
if(!this.queuedFlashCommands||(this.queuedFlashCommands.length==0)){window.clearInterval(this.intervalId);
this.intervalId=null
}}.createDelegate(this),50)
}},processFlashCommandQueue:function(){if(this.queuedFlashCommands){var a=false;
while((this.queuedFlashCommands.length>0)&&(!a)){var b=this.queuedFlashCommands[0];
try{b.fn.apply(this.flash,b.args);
this.queuedFlashCommands.splice(0,1)
}catch(c){a=true
}}}},reset:function(){this.flush();
CQ.form.SmartFile.superclass.reset.call(this)
},notify:function(b,a){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Upload"),b)
},validateValue:function(a){if(!this.useFlash){a=this.fallbackFileField.getValue()
}return CQ.html5.form.SmartFile.superclass.validateValue.call(this,a)
}});
CQ.form.SmartFile.RESOURCE_PATH="/libs/cq/ui/resources/swfupload";
CQ.form.SmartFile.PARAM_TEMP_NODE_SUFFIX=".sftmp";
CQ.form.SmartFile.PARAM_FILENAME_SUFFIX="Name";
CQ.form.SmartFile.PARAM_REFERENCE_SUFFIX="Reference";
CQ.form.SmartFile.DAM_RENDITION_SUFFIX="/jcr:content/renditions/original";
CQ.form.SmartFile.DAM_WEB_RENDITION_NAME="cq5dam.web.1280.1280";
CQ.form.SmartFile.DAM_RENDITIONS_PATH="/jcr:content/renditions/";
CQ.form.SmartFile.STATUS_SUCCESS=0;
CQ.form.SmartFile.STATUS_ERROR=1;
CQ.form.SmartFile.STATUS_SUBMISSION=2;
CQ.form.SmartFile.ID_COUNTER=0;
CQ.Ext.reg("smartfile",CQ.form.SmartFile);
CQ.form.SmartFile.FileInfoDisplay=CQ.Ext.extend(CQ.Ext.Panel,{constructor:function(a){a=a||{};
var b={fullTab:false,hideBorders:true,border:false,basicPadding:5,afterRender:function(){CQ.form.SmartFile.FileInfoDisplay.superclass.afterRender.call(this);
this.el.setVisibilityMode(CQ.Ext.Element.DISPLAY);
this.body.setVisibilityMode(CQ.Ext.Element.DISPLAY)
}};
CQ.Util.applyDefaults(a,b);
CQ.form.SmartFile.FileInfoDisplay.superclass.constructor.call(this,a)
},initComponent:function(){CQ.form.SmartFile.FileInfoDisplay.superclass.initComponent.call(this);
this.iconPanel=new CQ.Ext.Panel({hideBorders:true,border:false,html:"&nbsp;",fixedWidth:CQ.themes.SmartFile.ICON_COLUMN_WIDTH});
this.basicPanel=new CQ.Ext.Panel({hideBorders:true,border:false,autoHeight:false});
if(this.fileNameField){this.basicPanel.add(this.fileNameField)
}else{this.fileNameDisplay=new CQ.Ext.Panel({hideBorders:true,border:false,cls:"x-form-field",html:"&nbsp;"});
this.basicPanel.add(this.fileNameDisplay)
}this.fileInfoDisplay=new CQ.Ext.Panel({hideBorders:true,border:false,html:"&nbsp;"});
this.basicPanel.add(this.fileInfoDisplay);
this.buttonsPanel=new CQ.Ext.Panel({hideBorders:true,border:false,autoHeight:false,fixedWidth:CQ.themes.SmartFile.BUTTONS_COLUMN_WIDTH});
this.flushButton=new CQ.Ext.Button({text:CQ.I18n.getMessage("Clear"),minWidth:CQ.themes.SmartFile.BUTTONS_COLUMN_WIDTH,listeners:{click:{fn:this.parentComponent.flushFile,scope:this.parentComponent}}});
this.buttonsPanel.add(this.flushButton)
},onRender:function(a,b){CQ.form.SmartFile.FileInfoDisplay.superclass.onRender.call(this,a,b);
this.iconPanel.render(this.body);
this.iconPanel.getEl().setStyle("position","absolute");
this.iconPanel.getEl().setStyle("top","0px");
this.iconPanel.getEl().setStyle("left","0px");
this.iconPanel.setWidth(this.iconPanel.fixedWidth);
this.basicPanel.render(this.body);
this.basicPanel.getEl().setStyle("position","absolute");
this.basicPanel.getEl().setStyle("top","0px");
this.basicPanel.getEl().setStyle("left",this.iconPanel.fixedWidth+"px");
this.buttonsPanel.render(this.body);
this.buttonsPanel.setWidth(this.buttonsPanel.fixedWidth);
this.buttonsPanel.getEl().setStyle("position","absolute");
this.buttonsPanel.getEl().setStyle("top","0px")
},onResize:function(c,a){CQ.form.SmartFile.FileInfoDisplay.superclass.onResize.call(this,c,a);
if(typeof c=="object"){a=c.height;
c=c.width
}var b=c-this.iconPanel.fixedWidth-this.buttonsPanel.fixedWidth-this.basicPadding;
this.basicPanel.setWidth(b);
if(this.fileNameField){this.fileNameField.setWidth(b)
}this.buttonsPanel.getEl().setStyle("left",(c-this.buttonsPanel.fixedWidth)+"px")
},updateContent:function(c,a,b){b=CQ.shared.HTTP.getXhrHookedURL(b);
this.iconPanel.body.dom.innerHTML='<img src="'+b+'" border="0" alt="">';
if(this.fileNameField){this.fileNameField.setValue(c)
}else{this.fileNameDisplay.body.dom.innerHTML=c
}this.fileInfoDisplay.body.dom.innerHTML=a
},markInvalid:function(a){if(this.rendered){this.body.addClass(a);
this.iconPanel.body.addClass(a);
this.fileInfoDisplay.body.addClass(a);
this.basicPanel.body.addClass(a);
this.buttonsPanel.body.addClass(a)
}},clearInvalid:function(a){if(this.rendered){this.body.removeClass(a);
this.iconPanel.body.removeClass(a);
this.fileInfoDisplay.body.removeClass(a);
this.basicPanel.body.removeClass(a);
this.buttonsPanel.body.removeClass(a)
}}});
CQ.form.SmartImage=CQ.Ext.extend(CQ.form.SmartFile,{originalImage:null,processedImage:null,originalRefImage:null,processedRefImage:null,requestSuffix:null,imageToolDefs:null,mapParameter:null,cropParameter:null,rotateParameter:null,disableFlush:null,disableZoom:null,toolComponents:null,pathProvider:null,hideMainToolbar:false,imagesPending:0,disableInfo:false,infoTip:null,constructor:function(b){b=b||{};
var g={fullTab:true,mimeTypes:"*.jpg;*.jpeg;*.gif;*.png",mimeTypesDescription:CQ.I18n.getMessage("Images"),ddAccept:"image/",uploadPanelCls:null,removeUploadPanelClsOnProgress:false,allowFileNameEditing:false,transferFileName:false,uploadIconCls:"cq-image-placeholder",uploadTextReference:CQ.I18n.getMessage("Drop an image"),uploadTextFallback:CQ.I18n.getMessage("Upload image"),uploadText:CQ.I18n.getMessage("Drop an image or click to upload"),height:"auto",anchor:null,pathProvider:CQ.form.SmartImage.defaultPathProvider,hideMainToolbar:false};
this.imageToolDefs=[];
if(b.mapParameter){this.imageToolDefs.push(new CQ.form.ImageMap(b.mapParameter));
delete b.mapParameter
}if(b.cropParameter){this.imageToolDefs.push(new CQ.form.ImageCrop(b.cropParameter));
delete b.cropParameter
}if(b.rotateParameter){this.imageToolDefs.push(new CQ.form.SmartImage.Tool.Rotate(b.rotateParameter));
delete b.rotateParameter
}CQ.Util.applyDefaults(b,g);
CQ.form.SmartImage.superclass.constructor.call(this,b);
this.addEvents("beforeloadimage","loadimage","imagestate");
var a=this.imageToolDefs.length;
for(var c=0;
c<a;
c++){this.imageToolDefs[c].initialize(b)
}},initComponent:function(){CQ.form.SmartImage.superclass.initComponent.call(this);
this.workingAreaContainer=new CQ.Ext.Panel({itemId:"workingArea",border:false,layout:"border"});
this.processingPanel.add(this.workingAreaContainer);
this.workingArea=new CQ.Ext.Panel({border:false,layout:"card",region:"center",activeItem:0,listeners:{beforeadd:function(c,g){if(c._width&&c._height&&g.notifyResize){g.notifyResize.call(g,this._width,this._height)
}},bodyresize:function(g,k,c){if(typeof k=="object"){c=k.height;
k=k.width
}if(k&&c){g._width=k;
g._height=c;
var n=g.items.getCount();
for(var j=0;
j<n;
j++){var m=g.items.get(j);
if(m.notifyResize){m.notifyResize.call(m,k,c)
}}}}},afterRender:function(){CQ.Ext.Panel.prototype.afterRender.call(this);
this.el.setVisibilityMode(CQ.Ext.Element.DISPLAY)
}});
this.workingAreaContainer.add(this.workingArea);
this.imagePanel=new CQ.form.SmartImage.ImagePanel({itemId:"imageview",listeners:{"smartimage.zoomchange":{fn:function(c){if(this.zoomSlider){this.suspendEvents();
this.zoomSlider.setValue(c*10);
this.resumeEvents()
}},scope:this},"smartimage.defaultview":{fn:this.disableTools,scope:this}}});
this.workingArea.add(this.imagePanel);
if(this.topPanel){this.topPanel.region="north";
this.workingAreaContainer.add(this.topPanel)
}var a=this.imageToolDefs.length;
for(var b=0;
b<a;
b++){this.imageToolDefs[b].initComponent(this)
}this.on("loadimage",this.adjustUI,this)
},onRender:function(b,c){CQ.form.SmartImage.superclass.onRender.call(this,b,c);
var a=this.getToplevel();
if(a){a.on("hide",function(){this.hideTools();
this.imagePanel.ignoreRotation=false;
this.toolSelector.disable();
this.imagePanel.disablePanelTemporaryily()
},this);
a.on("editlocked",function(g,j){if(this.savedDropTargets==null){this.savedDropTargets=this.dropTargets
}this.dropTargets=null
},this);
a.on("editunlocked",function(g,j){if(this.savedDropTargets!=null){this.dropTargets=this.savedDropTargets
}},this)
}},handleFieldLock:function(q,g,b,c){var k=this;
var o=this.getName();
var m=this.getBaseNodeName();
if(c.get(m)){var a=c.get(m);
var j=a["jcr:mixinTypes"];
if(j&&(j.indexOf(CQ.wcm.msm.MSM.MIXIN_LIVE_SYNC_CANCELLED)!=-1)){g=false;
q="cq-dialog-unlocked"
}if(a[CQ.wcm.msm.MSM.PARAM_PROPERTY_INHERITANCE_CANCELED]){g=false;
q="cq-dialog-unlocked"
}}k.editLock=g;
k.editLockDisabled=b;
this.setToolbarEnabled(!(g&&!b));
if(g&&!b){this.dropTargets[0].lock();
this.processingPanel.body.mask()
}var n="";
if(b){n=CQ.Dialog.INHERITANCE_BROKEN
}else{n=g?CQ.Dialog.CANCEL_INHERITANCE:CQ.Dialog.REVERT_INHERITANCE
}if(!this.isUploadPanelCreated){this.delayedCreateRevertInheritanceHint=true
}else{if(!this.isLockHintCreated){this.createRevertInheritanceHint();
this.isLockHintCreated=true
}}if(!this.fieldEditLockBtn){k.fieldEditLockBtn=new CQ.Ext.Button({disabled:b,tooltip:n,cls:"cq-dialog-editlock cq-smartimage-editlock",iconCls:q,handler:function(){this.switchPropertyInheritance()
},scope:this});
this.toolSelector.add(this.fieldEditLockBtn)
}else{this.fieldEditLockBtn.setDisabled(b);
this.fieldEditLockBtn.setIconClass(q);
this.fieldEditLockBtn.setTooltip(q=="cq-dialog-unlocked"?CQ.Dialog.REVERT_INHERITANCE:CQ.Dialog.CANCEL_INHERITANCE)
}this.updateView()
},switchPropertyInheritance:function(){var a=this.findParentByType("dialog");
a.switchPropertyInheritance(this,null,function(c,b){this.editLock=b;
this.fieldEditLockBtn.setIconClass(c);
this.fieldEditLockBtn.setTooltip(c=="cq-dialog-unlocked"?CQ.Dialog.REVERT_INHERITANCE:CQ.Dialog.CANCEL_INHERITANCE);
if(b){this.dropTargets[0].lock();
this.processingPanel.body.mask()
}else{this.dropTargets[0].unlock();
this.processingPanel.body.unmask()
}this.setToolbarEnabled(!b);
this.updateView()
})
},getFieldLockParameters:function(a){delete a.cmd;
a[CQ.wcm.msm.MSM.PARAM_STATUS+"/"+CQ.wcm.msm.MSM.PARAM_IS_CANCELLED]=this.editLock;
a[CQ.wcm.msm.MSM.PARAM_STATUS+"/"+CQ.wcm.msm.MSM.PARAM_IS_CANCELLED_FOR_CHILDREN]=true;
return a
},getFieldLockTarget:function(a){return a+="/"+this.getBaseNodeName()
},getPropertyName:function(a){return a.substr(a.lastIndexOf("/")+1)
},getBaseNodeName:function(){var a=this.getName();
return a.replace(/^([^\/]*)\/([^\/]*)(.*)/,"$2")
},markInvalid:function(a){if(!this.rendered||this.preventMark){return
}a=a||this.invalidText;
this.uploadPanel.body.addClass(this.invalidClass);
this.imagePanel.addCanvasClass(this.invalidClass);
this.uploadPanel.body.dom.qtip=a;
this.uploadPanel.body.dom.qclass="x-form-invalid-tip";
if(CQ.Ext.QuickTips){CQ.Ext.QuickTips.enable()
}this.fireEvent("invalid",this,a)
},clearInvalid:function(){if(!this.rendered||this.preventMark){return
}this.uploadPanel.body.removeClass(this.invalidClass);
this.imagePanel.removeCanvasClass(this.invalidClass);
this.fireEvent("valid",this)
},postProcessRecord:function(b,k){this.dataRecord=b;
if(this.originalImage!=null){this.fireEvent("statechange","originalremoved",true)
}this.originalImage=null;
if(this.processedImage!=null){this.fireEvent("statechange","processedremoved",true)
}this.processedImage=null;
if(this.originalRefImage!=null){this.fireEvent("statechange","originalremoved",false)
}this.originalRefImage=null;
if(this.processedRefImage!=null){this.fireEvent("statechange","processedremoved",false)
}this.processedRefImage=null;
var j=null;
this.fireEvent("beforeloadimage",this);
if(this.referencedFileInfo){this.originalRefImage=new CQ.form.SmartImage.Image({dataPath:this.referencedFileInfo.dataPath,url:this.referencedFileInfo.url,fallbackUrl:this.referencedFileInfo.fallbackUrl});
this.notifyImageLoad(this.originalRefImage);
j=this.createProcessedImageConfig(this.referencedFileInfo.dataPath);
if(j){this.processedRefImage=new CQ.form.SmartImage.Image(j);
this.notifyImageLoad(this.processedRefImage)
}this.originalRefImage.load();
if(j){this.processedRefImage.load()
}}if(this.fileInfo){this.originalImage=new CQ.form.SmartImage.Image({dataPath:this.fileInfo.dataPath,url:this.fileInfo.url});
this.notifyImageLoad(this.originalImage);
j=this.createProcessedImageConfig(k);
if(j){this.processedImage=new CQ.form.SmartImage.Image(this.createProcessedImageConfig(k));
this.notifyImageLoad(this.processedImage)
}this.originalImage.load();
if(j){this.processedImage.load()
}}var a=this.imageToolDefs.length;
for(var g=0;
g<a;
g++){var c=this.imageToolDefs[g];
c.processRecord(b)
}},notifyImageLoad:function(a){if(!this.toolSelector.disabled&&!this.hideMainToolbar){this.toolSelector.disable()
}this.imagesPending++;
a.addToolLoadHandler(function(){this.imagesPending--;
if(this.imagesPending==0){this.fireEvent("loadimage",this)
}if(a==this.processedImage){this.fireEvent("imagestate",this,"processedavailable",true)
}else{if(a==this.processedRefImage){this.fireEvent("imagestate",this,"processedavailable",false)
}else{if(a==this.originalImage){this.fireEvent("imagestate",this,"originalavailable",true)
}else{if(a==this.originalRefImage){this.fireEvent("imagestate",this,"originalavailable",false)
}}}}}.createDelegate(this),true)
},createProcessedImageConfig:function(g){var j="";
if(g){var b=g.lastIndexOf(".");
var a=g.lastIndexOf("/");
if((b>0)&&(b>(a+1))){j=g.substring(b,g.length)
}}var c=this.pathProvider.call(this,this.dataPath,this.requestSuffix,j,this.dataRecord,this);
if(c==null){return null
}return{url:c}
},syncFormElements:function(){CQ.form.SmartImage.superclass.syncFormElements.call(this);
var a=this.imageToolDefs.length;
for(var b=0;
b<a;
b++){var c=this.imageToolDefs[b];
c.transferToField()
}},usesProcessedImage:function(){var a=this.getSuitableImage(false);
return(a==this.processedImage)||(a==this.processedRefImage)
},invalidateProcessedImages:function(){if(this.processedImage!=null){this.processedImage=null;
this.fireEvent("imagestate",this,"processedremoved",true)
}if(this.processedRefImage!=null){this.processedRefImage=null;
this.fireEvent("imagestate",this,"processedremoved",false)
}},createProcessingPanel:function(){if(!this.hideMainToolbar){var a,c;
this.imageTools=[];
var b=[];
a=this.imageToolDefs.length;
for(c=0;
c<a;
c++){var g=this.imageToolDefs[c];
var j;
if(!g.isCommandTool){j=new CQ.Ext.Toolbar.Button({text:g.toolName,itemId:g.toolId,toolRef:g,iconCls:g.iconCls,actionHandler:this.toolClicked.createDelegate(this),enableToggle:true,toggleGroup:"imageTools",allowDepress:true,listeners:{click:function(){this.actionHandler(this.toolRef)
}}})
}else{j=new CQ.Ext.Toolbar.Button({text:g.toolName,itemId:g.toolId,toolRef:g,iconCls:g.iconCls,actionHandler:this.commandToolClicked.createDelegate(this),enableToggle:false,listeners:{click:function(){this.actionHandler(this.toolRef)
}}})
}g.buttonComponent=j;
this.imageTools.push(j);
g.createTransferField(this);
b.push(j)
}if(!this.disableFlush){b.push({xtype:"tbseparator"});
b.push({xtype:"tbbutton",text:CQ.I18n.getMessage("Clear"),iconCls:"cq-image-icon-clear",listeners:{click:{fn:this.flushImage,scope:this}}})
}if(!this.disableInfo){b.push({xtype:"tbseparator"});
b.push({itemId:"infoTool",xtype:"tbbutton",iconCls:"cq-image-icon-info",listeners:{click:{fn:this.showImageInfo,scope:this}}})
}b.push({xtype:"tbfill"});
if(!this.disableZoom){this.zoomSlider=new CQ.Ext.Slider({width:CQ.Ext.isIE7?150:200,minValue:0,maxValue:90,vertical:false,listeners:{change:{fn:function(k,m){this.imagePanel.setZoom(m/10)
},scope:this}}});
b.push(this.zoomSlider)
}}this.toolSelector=new CQ.Ext.Toolbar(b);
this.toolSelector.disable();
return new CQ.Ext.Panel({itemId:"processing",layout:"fit",border:false,bbar:(!this.hideMainToolbar?this.toolSelector:null),afterRender:function(){CQ.Ext.Panel.prototype.afterRender.call(this);
this.el.setVisibilityMode(CQ.Ext.Element.DISPLAY);
this.body.setVisibilityMode(CQ.Ext.Element.DISPLAY)
}})
},updateView:function(){if(this.editLock){this.containerPanel.getLayout().setActiveItem("lock");
if(!this.isLockPanelCreated){this.createLockPanel()
}}else{var a=this.originalImage||this.originalRefImage||this.processedImage||this.processedRefImage;
this.updateViewBasics(a);
if(a){this.workingArea.getLayout().setActiveItem("imageview");
this.resetTools();
this.resetZoomSlider()
}this.updateImageInfoState()
}this.doLayout();
if(this.processedRefImage){this.imagePanel.updateImage(this.processedRefImage)
}else{if(this.originalRefImage){this.imagePanel.updateImage(this.originalRefImage)
}else{if(this.processedImage){this.imagePanel.updateImage(this.processedImage)
}else{if(this.originalImage){this.imagePanel.updateImage(this.originalImage)
}}}}},resetTools:function(){if(!this.hideMainToolbar){var a=this.imageTools.length;
for(var c=0;
c<a;
c++){var b=this.imageTools[c];
if(b.enableToggle){b.toggle(false)
}}}this.imagePanel.hideAllShapeSets(false)
},resetZoomSlider:function(){if(this.zoomSlider){this.zoomSlider.suspendEvents();
this.zoomSlider.setValue(0);
this.zoomSlider.resumeEvents()
}},getImagePanel:function(){return this.imagePanel
},adjustUI:function(){if(!this.hideMainToolbar){var a;
if(!this.disableInfo){a=this.toolSelector.items.get("infoTool");
var b=a.disabled
}if(!this.editLock||this.editLockDisabled){this.toolSelector.enable();
this.enableToolbar();
if(!this.disableInfo){a.setDisabled(b)
}}if(this.fieldEditLockBtn){this.fieldEditLockBtn.setDisabled(this.editLockDisabled)
}}},setToolbarEnabled:function(a){(a?this.enableToolbar():this.disableToolbar())
},disableToolbar:function(){this.toolSelector.items.each(function(a){if(a!=this.fieldEditLockBtn){a.setDisabled(true)
}},this)
},enableToolbar:function(){this.toolSelector.items.each(function(b){if(b!=this.fieldEditLockBtn){var a=(!this.editLock||this.editLockDisabled);
if(a&&b.toolRef){a=b.toolRef.isEnabled()
}b.setDisabled(!a)
}},this)
},onUploaded:function(){this.originalImage=new CQ.form.SmartImage.Image(this.fileInfo);
this.originalImage.loadHandler=function(){var a=this.imageToolDefs.length;
for(var b=0;
b<a;
b++){this.imageToolDefs[b].onImageUploaded(this.originalImage)
}this.syncFormElements();
this.updateView()
}.createDelegate(this);
this.fireEvent("beforeloadimage",this);
this.notifyImageLoad(this.originalImage);
this.originalImage.load();
if(this.processedImage!=null){this.processedImage=null;
this.fireEvent("imagestate",this,"processedremoved",true)
}return true
},toolClicked:function(j){var c;
var n=j.buttonComponent;
if(n.pressed){var m=false;
if(this.toolComponents==null){this.toolComponents={}
}if(!this.toolComponents[j.toolId]){this.toolComponents[j.toolId]={isVisible:false,toolRef:j};
m=true
}var g=this.toolComponents[j.toolId];
c=this.hideTools(j.toolId);
if(j.userInterface&&(!j.userInterface.rendered)){j.userInterface.render(CQ.Util.getRoot())
}if(c){c.onDeactivation()
}if(j.userInterface){j.userInterface.show();
g.isVisible=true;
if(!(j.userInterface.saveX&&j.userInterface.saveY)){var o=j.userInterface.getSize().height;
var k=this.getPosition();
var b=k[0];
var a=k[1]-(o+4);
if(b<0){b=0
}if(a<0){a=0
}j.userInterface.setPosition(b,a)
}else{j.userInterface.setPosition(j.userInterface.saveX,j.userInterface.saveY)
}}j.onActivation()
}else{c=this.hideTools();
if(c){c.onDeactivation()
}this.imagePanel.drawImage()
}},commandToolClicked:function(a){a.onCommand()
},hideTools:function(c){if(!this.hideMainToolbar){var g;
for(var b in this.toolComponents){var a=this.toolComponents[b];
if(b!=c){if(a.isVisible){a.toolRef.userInterface.hide();
a.isVisible=false;
g=a.toolRef
}}}}return g
},disableTools:function(){if(!this.hideMainToolbar){var g=this.hideTools();
if(g){g.onDeactivation()
}var a=this.imageTools.length;
for(var b=0;
b<a;
b++){var c=this.imageTools[b];
if(c.pressed){c.suspendEvents();
c.toggle(false);
c.resumeEvents()
}}}},updateImageInfoState:function(){if(!this.disableInfo&&!this.hideMainToolbar){var a=this.toolSelector.items.get("infoTool");
var b=(this.referencedFileInfo!=null);
(b?a.enable():a.disable())
}},showImageInfo:function(){if(this.infoTip!=null){var b=this.infoTip.hidden==false;
this.infoTip.hide();
if(b){return
}}var c=function(){if(this.infoTip!=null){this.infoTip.hide();
this.infoTip=null
}};
var a=this.toolSelector.items.get("infoTool");
this.infoTip=new CQ.Ext.Tip({title:CQ.I18n.getMessage("Image info"),html:'<span class="cq-smartimage-refinfo">'+this.getRefText(this.referencedFileInfo.dataPath)+"</span>",maxWidth:500,autoHide:false,closable:true,listeners:{hide:function(){CQ.Ext.EventManager.un(document,"click",c,this)
},scope:this}});
CQ.Ext.EventManager.on.defer(10,this,[document,"click",c,this]);
this.infoTip.showBy(a.el,"tl-tr")
},flushImage:function(a){this.flush();
if(this.processedRefImage!=null){this.processedRefImage=null;
this.fireEvent("imagestate",this,"processedremoved",false)
}if(this.processedImage!=null){this.processedImage=null;
this.fireEvent("imagestate",this,"processedremoved",true)
}this.processedImage=null;
if(this.originalRefImage){this.originalRefImage=null;
this.fireEvent("imagestate",this,"originalremoved",false)
}else{if(this.originalImage){this.originalImage=null;
this.fireEvent("imagestate",this,"originalremoved",true)
}}if(a!==true){this.syncFormElements();
this.notifyToolsOnFlush();
this.hideTools();
this.updateView()
}},reset:function(){this.flushImage();
CQ.form.SmartImage.superclass.reset.call(this)
},notifyToolsOnFlush:function(){var a=this.imageToolDefs.length;
for(var b=0;
b<a;
b++){this.imageToolDefs[b].onImageFlushed()
}},getSuitableImage:function(a){var b;
if(this.processedRefImage&&!a){b=this.processedRefImage
}else{if(this.originalRefImage){b=this.originalRefImage
}else{if(this.processedImage&&!a){b=this.processedImage
}else{if(this.originalImage){b=this.originalImage
}}}}return b
},handleDrop:function(a){if(this.handleDropBasics(a)){this.originalRefImage=new CQ.form.SmartImage.Image(this.referencedFileInfo);
this.originalRefImage.loadHandler=function(){this.hideTools();
var b=this.imageToolDefs.length;
for(var c=0;
c<b;
c++){this.imageToolDefs[c].onImageUploaded(this.originalRefImage)
}this.syncFormElements();
this.updateView()
}.createDelegate(this);
if(this.processedRefImage!=null){this.processedRefImage=null;
this.fireEvent("imagestate",this,"processedremoved",false)
}this.fireEvent("beforeloadimage",this);
this.notifyImageLoad(this.originalRefImage);
this.originalRefImage.load();
return true
}return false
}});
CQ.form.SmartImage.defaultPathProvider=function(c,b,g,a){if(!b){return null
}return CQ.HTTP.externalize(c+b)
};
CQ.Ext.reg("smartimage",CQ.form.SmartImage);
CQ.form.SmartImage.Image=CQ.Ext.extend(CQ.Ext.emptyFn,{dataPath:null,url:null,image:null,width:null,height:null,isLoaded:false,loadHandler:null,toolLoadHandlers:null,constructor:function(a){this.url=a.url;
this.dataPath=a.dataPath;
this.fallbackUrl=a.fallbackUrl;
this.isLoaded=false;
this.loadHandler=a.loadHandler;
this.toolLoadHandlers=[]
},load:function(){this.image=new Image();
CQ.Ext.EventManager.on(this.image,"load",function(){this.width=this.image.naturalWidth||this.image.width;
this.height=this.image.naturalHeight||this.image.height;
this.isLoaded=true;
if(this.loadHandler){this.loadHandler(this)
}var c=this.toolLoadHandlers.length;
for(var b=c-1;
b>=0;
b--){var a=this.toolLoadHandlers[b];
a.fn(this);
if(a.runOnce){this.toolLoadHandlers.splice(b,1)
}}},this,{single:true});
CQ.Ext.EventManager.on(this.image,"error",function(){if(this.fallbackUrl!=null){this.image.src=CQ.shared.HTTP.getXhrHookedURL(CQ.HTTP.noCaching(this.fallbackUrl))
}},this,{single:true});
if(CQ.Ext.isIE){this.image.galleryimg=false
}this.image.src=CQ.shared.HTTP.getXhrHookedURL(CQ.HTTP.noCaching(this.url))
},addToolLoadHandler:function(c,a){var b={fn:c,runOnce:a};
this.toolLoadHandlers.push(b)
}});
CQ.form.SmartImage.ImagePanel=CQ.Ext.extend(CQ.Ext.Panel,{isInitialized:false,backgroundColor:null,imageToDisplay:null,zoom:0,rotation:0,ignoreRotation:false,basicSize:null,workingAreaSize:null,originalImageSize:null,basicImageSize:null,zoomedImageSize:null,centerPoint:null,internalOffset:null,internalPadding:null,positioningContainer:null,scollerDiv:null,spacerImage:null,canvasDiv:null,imageCanvas:null,imageOffsets:null,shapeSets:null,shapeDefs:null,rolledOverShapes:null,selectedShapes:null,scheduledDragShapes:null,tolerance:0,canvasClass:null,zoomedTolerance:0,isRollOverHandlingBlocked:false,doc:null,temporaryHandlers:null,constructor:function(a){if(!a){a={}
}var b={backgroundColor:CQ.themes.SmartImage.BACKGROUND_COLOR,canvasClass:CQ.themes.SmartImage.CANVAS_CLASS,border:false,layout:"fit",zoom:0,tolerance:3,internalPadding:{width:8,height:8}};
this.addEvents("smartimage.zoomchange","zoomchange","smartimage.addrequest","addrequest","smartimage.custom","smartimage.selchanged","selectionchange","smartimage.rollover","rollover","smartimage.dragchange","dragchange","smartimage.contentchange","contentchange","smartimage.defaultview","defaultview");
CQ.Util.applyDefaults(a,b);
CQ.form.SmartImage.ImagePanel.superclass.constructor.call(this,a);
this.shapeSets={};
this.rolledOverShapes=[];
this.selectedShapes=[];
this.scheduledDragShapes=[];
this.internalOffset={x:0,y:0}
},onRender:function(a,b){CQ.form.SmartImage.ImagePanel.superclass.onRender.call(this,a,b);
this.el.setVisibilityMode(CQ.Ext.Element.DISPLAY);
this.positioningContainer=document.createElement("div");
this.positioningContainer.style.position="relative";
this.positioningContainer.style.top="0";
this.positioningContainer.style.left="0";
this.body.dom.appendChild(this.positioningContainer);
this.canvasDiv=document.createElement("div");
this.canvasDiv.style.position="absolute";
this.canvasDiv.style.top="0";
this.canvasDiv.style.left="0";
this.positioningContainer.appendChild(this.canvasDiv);
this.scrollerDiv=document.createElement("div");
this.scrollerDiv.style.position="absolute";
this.scrollerDiv.style.top="0";
this.scrollerDiv.style.left="0";
this.scrollerDiv.style.overflow="scroll";
CQ.Ext.EventManager.on(this.scrollerDiv,"scroll",this.handleScroll,this);
this.positioningContainer.appendChild(this.scrollerDiv);
this.spacerImage=document.createElement("img");
this.spacerImage.src=CQ.Ext.BLANK_IMAGE_URL;
this.scrollerDiv.appendChild(this.spacerImage);
this.spacerImage.style.display="block";
if(CQ.Ext.isIE){this.spacerImage.galleryimg=false
}this.imageCanvas=this.createCanvas(this.canvasDiv,1,1);
this.doc=CQ.Ext.get(document);
if(this.canvasClass){CQ.Ext.get(this.imageCanvas).addClass(this.canvasClass)
}if(this.backgroundColor!=null){this.imageCanvas.style.backgroundColor=this.backgroundColor
}CQ.Ext.EventManager.on(this.spacerImage,"mousemove",this.onMouseMove,this);
CQ.Ext.EventManager.on(this.spacerImage,"mousedown",this.onMouseDown,this);
CQ.Ext.EventManager.on(this.spacerImage,"mouseup",this.onMouseUp,this);
CQ.Ext.EventManager.on(this.spacerImage,"mouseout",this.onComponentLeave,this)
},addCanvasClass:function(a){CQ.Ext.get(this.imageCanvas).addClass(a)
},removeCanvasClass:function(a){CQ.Ext.get(this.imageCanvas).removeClass(a)
},updateImage:function(b){this.imageToDisplay=b;
if(this.rendered){if(this.imageToDisplay.isLoaded){this.handleImageLoaded()
}else{var a=this.imageToDisplay.loadHandler;
this.imageToDisplay.loadHandler=function(){this.handleImageLoaded();
if(a){a(this.imageToDisplay)
}}.createDelegate(this)
}}},switchToDefaultView:function(){this.fireEvent("defaultview");
this.fireEvent("smartimage.defaultview");
this.setZoom(0);
this.fireEvent("zoomchange",0);
this.fireEvent("smartimage.zoomchange",0)
},notifyResize:function(b,a){this.body.setSize(b,a);
this.calculateBasicSize();
this.propagateWorkingArea(this.notifyResizeAsync.createDelegate(this))
},notifyResizeAsync:function(){if(CQ.Ext.isIE&&this.shapeDefs){var b=this.shapeDefs.length;
for(var a=0;
a<b;
a++){var c=this.shapeDefs[a];
this.setCanvasSize(c.canvas,this.workingAreaSize)
}}if(this.imageToDisplay&&this.imageToDisplay.isLoaded){this.calculateBasicImageSize();
this.calculateZoomedImageSize();
this.adjustSpacerImage();
this.propagateImage()
}this.isInitialized=true
},onMouseMove:function(g){if(!this.zoomedImageSize){return
}var j=false;
var c=this.calculateTransformedCoords(g);
if(this.deferredDragShapes!=null){j=true;
if(c.isVirtual){return
}var m=this.calculateDistance(this.draggingBaseCoords.unzoomedUnclipped,c.unzoomedUnclipped);
if(m>=this.zoomedTolerance){this.directDragShapes=this.deferredDragShapes;
this.fireDragStart(this.draggingBaseCoords);
this.deferredDragShapes=null
}}if(this.directDragShapes!=null){var a=c.unzoomedUnclipped;
var k=a.x-this.draggingBaseCoords.unzoomed.x;
var b=a.y-this.draggingBaseCoords.unzoomed.y;
this.fireMove(k,b,c);
this.fireEvent("dragchange",this.directDragShapes,false);
this.fireEvent("smartimage.dragchange",this.directDragShapes,false)
}else{if(!j&&!this.isRollOverHandlingBlocked){this.executeFnOnShapes(function(n){var o=(this.rolledOverShapes.indexOf(n)>=0);
var q=n.isTouched(c,this.zoomedTolerance);
if(q!=o){if(q){this.addShapeToRollovers(n,c)
}else{this.removeShapeFromRollovers(n,c)
}}else{if(q){if(n.onRolledOver(c)){this.drawImage()
}}}}.createDelegate(this),true);
this.fireEvent("rollover",this.rolledOverShapes);
this.fireEvent("smartimage.rollover",this.rolledOverShapes)
}}if(!CQ.Ext.isIE){g.stopPropagation()
}else{return false
}},onComponentLeave:function(){if(this.directDragShapes==null){var a=false;
var c=this.rolledOverShapes.length;
for(var b=0;
b<c;
b++){var g=this.rolledOverShapes[b];
if(g.onRollOut()){a=true
}}this.rolledOverShapes.length=0;
if(a){this.drawImage()
}this.fireEvent("rollover",[]);
this.fireEvent("smartimage.rollover",[])
}},onMouseDown:function(a){if(!this.zoomedImageSize){return
}var n=this.calculateTransformedCoords(a);
this.scheduledDragShapes.length=0;
this.fireEvent("addrequest",n);
this.fireEvent("smartimage.addrequest",n);
var k=this.scheduledDragShapes.length;
if((this.rolledOverShapes.length>0)||(k>0)){var j=[];
var b=[];
var m=this.rolledOverShapes.length;
for(var q=0;
q<m;
q++){var c=this.rolledOverShapes[q];
if(c.isDirectlyDraggable(n,this.zoomedTolerance)){j.push(c)
}else{if(c.isDeferredDraggable(n,this.zoomedTolerance)){b.push(c)
}}}for(var o=0;
o<k;
o++){var g=this.scheduledDragShapes[o];
g.onAddForDrag(n);
j.push(g)
}if(j.length>0){this.directDragShapes=j;
this.deferredDragShapes=null;
this.draggingBaseCoords=n;
this.fireDragStart(n);
this.fireEvent("dragchange",this.directDragShapes,false);
this.fireEvent("smartimage.dragchange",this.directDragShapes,false)
}else{if(b.length>0){this.directDragShapes=null;
this.deferredDragShapes=b;
this.draggingBaseCoords=n
}else{this.directDragShapes=null;
this.deferredDragShapes=null;
this.draggingBaseCoords=null
}}}this.addTemporaryHandler(this.doc,"mousemove",this.onMouseMove,this);
if(CQ.Ext.isGecko){this.addTemporaryHandler(this.doc,"mouseup",this.onMouseUp,this)
}},onMouseUp:function(g){if(!this.zoomedImageSize){return
}var j=this.calculateTransformedCoords(g);
var c=j.unzoomedUnclipped;
var b=false;
if((this.directDragShapes!=null)||(this.deferredDragShapes!=null)){if(this.directDragShapes!=null){b=true;
var k=c.x-this.draggingBaseCoords.unzoomedUnclipped.x;
var a=c.y-this.draggingBaseCoords.unzoomedUnclipped.y;
this.fireMove(k,a,j);
this.fireDragEnd(j);
this.fireEvent("dragchange",this.directDragShapes,true);
this.fireEvent("smartimage.dragchange",this.directDragShapes,true);
this.directDragShapes=null
}this.deferredDragShapes=null;
this.draggingBaseCoords=null
}if(!b){this.selectRollovers()
}else{this.onMouseMove(g)
}if(!CQ.Ext.isIE){g.stopPropagation()
}this.removeTemporaryHandlers()
},fireMove:function(m,b,j){var k=false;
var g=this.directDragShapes.length;
for(var a=0;
a<g;
a++){var c=this.directDragShapes[a];
if(c.moveShapeBy(m,b,j)){k=true
}}if(k){this.drawImage()
}},fireDragStart:function(g){var j=false;
var c=this.directDragShapes.length;
for(var a=0;
a<c;
a++){var b=this.directDragShapes[a];
if(b.onDragStart(g,this.zoomedTolerance)){j=true
}}if(j){this.drawImage()
}},fireDragEnd:function(g){var j=false;
var c=this.directDragShapes.length;
for(var a=0;
a<c;
a++){var b=this.directDragShapes[a];
if(b.onDragEnd(g,this.zoomedTolerance)){j=true
}}if(j){this.drawImage()
}},addTemporaryHandler:function(j,b,g,c){if(this.temporaryHandlers==null){this.temporaryHandlers=[]
}var a={el:j,handlerName:b,fn:g,scope:c};
this.temporaryHandlers.push(a);
j.on(b,g,c)
},removeTemporaryHandlers:function(){if(this.temporaryHandlers!=null){var b=this.temporaryHandlers.length;
for(var c=0;
c<b;
c++){var a=this.temporaryHandlers[c];
a.el.un(a.handlerName,a.fn,a.scope)
}this.temporaryHandlers=null
}},blockRollOver:function(){this.isRollOverHandlingBlocked=true;
var a=this.rolledOverShapes.length;
for(var b=a-1;
b>=0;
b--){this.removeShapeFromRollovers(this.rolledOverShapes[b])
}this.drawImage();
this.fireEvent("rollover",this.rolledOverShapes);
this.fireEvent("smartimage.rollover",this.rolledOverShapes)
},unblockRollOver:function(){this.isRollOverHandlingBlocked=false
},addShapeToRollovers:function(a,b){this.rolledOverShapes.push(a);
if(a.onRollOver(b)){this.drawImage()
}},removeShapeFromRollovers:function(a,g,c){var b=this.rolledOverShapes.indexOf(a);
if(b>=0){this.rolledOverShapes.splice(b,1);
if(a.onRollOut(g)&&!c){this.drawImage()
}}},getRolledOverShapes:function(){var a=[];
var c=this.rolledOverShapes.length;
for(var b=0;
b<c;
b++){a.push(this.rolledOverShapes[b])
}return a
},selectRollovers:function(){var k=false;
var c=false;
var g;
var b=this.selectedShapes.length;
for(g=0;
g<b;
g++){var m=this.selectedShapes[g];
if(this.rolledOverShapes.indexOf(m)<0){k=true;
if(m.onUnSelect()){c=true
}}}var a=[];
var n=this.rolledOverShapes.length;
for(g=0;
g<n;
g++){k=true;
var j=this.rolledOverShapes[g];
a.push(j);
if(this.selectedShapes.indexOf(j)<0){if(j.onSelect()){c=true
}}if(j.onClick()){c=true
}}this.selectedShapes=a;
if(c){this.drawImage()
}CQ.Log.debug("Firing selection change event.");
this.fireEvent("selectionchange",a);
this.fireEvent("smartimage.selchanged",a);
return k
},clearSelection:function(){var b=false;
var a=this.selectedShapes.length;
for(var c=0;
c<a;
c++){var j=this.selectedShapes[c];
if(j.onUnSelect()){b=true
}}var g=this.selectedShapes;
this.selectedShapes=[];
this.fireEvent("selectionchange",this.selectedShapes);
this.fireEvent("smartimage.selchanged",this.selectedShapes);
return g
},deleteSelectedShapes:function(){var b=this.selectedShapes.length;
if(b>0){for(var a=0;
a<b;
a++){var g=this.selectedShapes[a];
var c=this.getSuitableShapeSet(g);
c.removeShape(g)
}this.drawImage();
this.selectedShapes.length=0;
this.fireEvent("selectionchange",this.selectedShapes);
this.fireEvent("smartimage.selchanged",this.selectedShapes)
}},getSelectedShapes:function(){var c=[];
var b=this.selectedShapes.length;
for(var a=0;
a<b;
a++){c.push(this.selectedShapes[a])
}return c
},selectShape:function(j,k){if(k===true){var b=this.selectedShapes.length;
for(var a=0;
a<b;
a++){var g=this.selectedShapes[a];
var c=this.getSuitableShapeSet(g);
c.removeShape(g)
}this.selectedShapes.length=0
}j.onSelect();
this.selectedShapes.push(j);
this.fireEvent("selectionchange",this.selectedShapes);
this.fireEvent("smartimage.selchanged",this.selectedShapes)
},getTolerance:function(){return this.zoomedTolerance
},calculateBasicSize:function(){this.basicSize={width:this.body.dom.clientWidth,height:this.body.dom.clientHeight}
},calculateWorkingAreaSize:function(){this.workingAreaSize={width:this.scrollerDiv.clientWidth,height:this.scrollerDiv.clientHeight}
},calculateOriginalImageSize:function(){this.originalImageSize={width:this.imageToDisplay.width,height:this.imageToDisplay.height,ratio:(this.imageToDisplay.width/this.imageToDisplay.height)}
},calculateZoom:function(a,b){if(b.width!==undefined){return{width:Math.round((a+1)*b.width),height:Math.round((a+1)*b.height)}
}else{if(b.x!==undefined){return{x:Math.round((a+1)*b.x),y:Math.round((a+1)*b.y)}
}}return null
},calculateAbsoluteZoom:function(){return((this.zoom+1)*this.basicImageSize.baseZoom)-1
},calculateInverseZoom:function(b,a){if(a.width!==undefined){return{width:Math.round(a.width/(b+1)),height:Math.round(a.height/(b+1))}
}else{if(a.x!==undefined){return{x:Math.round(a.x/(b+1)),y:Math.round(a.y/(b+1))}
}}return null
},calculateBasicImageSizeForAngle:function(g){while(g<0){g+=360
}g=g%360;
var b=this.originalImageSize.width;
var o=this.originalImageSize.height;
var k=this.originalImageSize.ratio;
if((g==90)||(g==270)){var n=b;
b=o;
o=n;
k=1/k
}var a=b;
var q=b+(this.internalPadding.width*2);
var c=o+(this.internalPadding.height*2);
var j=this.workingAreaSize.width;
var m=this.workingAreaSize.height;
if(q>j){q=j;
b=q-this.internalPadding.width*2;
o=Math.round(b/k);
c=o+this.internalPadding.height*2
}if(c>m){c=m;
o=c-this.internalPadding.height*2;
b=Math.round(o*k);
q=b+this.internalPadding.width*2
}if(b<1){b=1
}if(o<1){o=1
}return{width:b,height:o,displayWidth:q,displayHeight:c,baseZoom:(b/a)}
},calculateBasicImageSize:function(){this.basicImageSize=this.calculateBasicImageSizeForAngle(this.getActualRotation())
},calculateZoomedImageSize:function(){this.zoomedImageSize=this.calculateZoom(this.zoom,this.basicImageSize);
this.zoomedTolerance=this.tolerance/(this.calculateAbsoluteZoom()+1);
this.zoomedImageSize.displayWidth=this.zoomedImageSize.width+(this.internalPadding.width*2);
this.zoomedImageSize.displayHeight=this.zoomedImageSize.height+(this.internalPadding.height*2)
},precalculateRotatedSize:function(c){var a=this.calculateBasicImageSizeForAngle(c);
var b=this.calculateZoom(this.zoom,a);
b.displayWidth=b.width+(this.internalPadding.width*2);
b.displayHeight=b.height+(this.internalPadding.height*2);
return b
},calculateSpacerSize:function(){var b=this.workingAreaSize.width;
var a=this.workingAreaSize.height;
if(this.zoomedImageSize){if(this.zoomedImageSize.displayWidth>b){b=this.zoomedImageSize.displayWidth
}if(this.zoomedImageSize.height>a){a=this.zoomedImageSize.displayHeight
}}return{width:b,height:a}
},calculateTransformedCoords:function(c){var q=this.calcCompFromMouseCoords(c);
if(this.imageOffsets){q.x-=this.imageOffsets.x;
q.y-=this.imageOffsets.y
}var b=this.zoomedImageSize.width;
var a=this.zoomedImageSize.height;
q.isVirtual=(q.x<0)||(q.x>=b)||(q.y<0)||(q.y>=a);
var m=this.calculateAbsoluteZoom();
var o=this.calculateInverseZoom(m,q);
var g=this.getActualRotation();
var n=(g==90)||(g==270);
o.zoom=this.zoom;
o.absoluteZoom=m;
o.imageSize=this.originalImageSize;
o.rotatedImageSize={width:(n?this.originalImageSize.height:this.originalImageSize.width),height:(n?this.originalImageSize.width:this.originalImageSize.height)};
var k={x:o.x,y:o.y,zoom:o.zoom,absoluteZoom:o.absoluteZoom,imageSize:o.imageSize,rotatedImageSize:o.rotatedImageSize};
if(o.x<0){o.x=0
}if(o.y<0){o.y=0
}if(n){if(o.y>=this.originalImageSize.width){o.y=this.originalImageSize.width-1
}if(o.x>=this.originalImageSize.height){o.x=this.originalImageSize.height-1
}}else{if(o.x>=this.originalImageSize.width){o.x=this.originalImageSize.width-1
}if(o.y>=this.originalImageSize.height){o.y=this.originalImageSize.height-1
}}var j;
switch(g){case 0:j={x:o.x,y:o.y};
break;
case 90:j={x:o.y,y:this.originalImageSize.height-o.x};
break;
case 180:j={x:this.originalImageSize.width-o.x,y:this.originalImageSize.height-o.y};
break;
case 270:j={x:this.originalImageSize.width-o.y,y:o.x};
break
}return{screen:q,unzoomed:o,unzoomedUnclipped:k,unrotated:j}
},calcCompFromMouseCoords:function(c){var a=new Object();
var g=CQ.Ext.get(this.canvasDiv).getXY();
var b={hOffset:g[0],vOffset:g[1]};
a.x=c.getPageX();
a.y=c.getPageY();
a.x-=b.hOffset;
a.y-=b.vOffset;
a.x+=this.scrollerDiv.scrollLeft;
a.y+=this.scrollerDiv.scrollTop;
c.preventDefault();
if(this.scrollerDiv.clientWidth<this.scrollerDiv.scrollWidth){a.x-=this.internalPadding.width
}if(this.scrollerDiv.clientHeight<this.scrollerDiv.scrollHeight){a.y-=this.internalPadding.height
}return a
},propagateImage:function(){this.blockRedraw=true;
this.calculateInternalOffset();
var k=this.workingAreaSize.width;
var c=this.workingAreaSize.height;
var j=this.zoomedImageSize.displayWidth;
var a=this.zoomedImageSize.displayHeight;
if((this.internalOffset.x+k)>j){this.internalOffset.x=j-k
}if((this.internalOffset.y+c)>a){this.internalOffset.y=a-c
}if(this.internalOffset.x<0){this.internalOffset.x=0
}else{if(this.internalOffset.y<0){this.internalOffset.y=0
}}var g=(this.internalOffset.x!=this.scrollerDiv.scrollLeft);
var b=(this.internalOffset.y!=this.scrollerDiv.scrollTop);
if(b){this.scrollerDiv.scrollTop=this.internalOffset.y
}if(g){this.scrollerDiv.scrollLeft=this.internalOffset.x
}this.drawImage();
this.blockRedraw=false
},propagateWorkingArea:function(b){this.setCSSSize(this.positioningContainer,this.basicSize);
this.setCSSSize(this.scrollerDiv,this.basicSize);
var a=this.propagateWorkingAreaAsync.createDelegate(this,[b]);
a.defer(1)
},propagateWorkingAreaAsync:function(a){this.calculateWorkingAreaSize();
this.adjustSpacerImage();
this.setCanvasSize(this.imageCanvas,this.workingAreaSize);
if(a){a()
}},setZoom:function(a){this.calculateCenterPoint();
this.zoom=a;
this.calculateZoomedImageSize();
this.adjustSpacerImage();
this.propagateImage()
},calculateCenterPoint:function(){var k=this.workingAreaSize.width;
var a=this.workingAreaSize.height;
var j=this.scrollerDiv.scrollLeft;
var g=this.scrollerDiv.scrollTop;
var b={x:j+(k/2)-this.internalPadding.width,y:g+(a/2)-this.internalPadding.height};
if(b.x<0){b=0
}if(b.y<0){b=0
}var c=this.calculateAbsoluteZoom();
this.centerPoint=this.calculateInverseZoom(c,b)
},calculateInternalOffset:function(){var k=this.workingAreaSize.width;
var a=this.workingAreaSize.height;
if(this.centerPoint){var b=this.calculateAbsoluteZoom();
var c=this.calculateZoom(b,this.centerPoint);
var j=Math.round(c.x+this.internalPadding.width-(k/2));
var g=Math.round(c.y+this.internalPadding.height-(a/2));
if(j<0){j=0
}if(g<0){g=0
}this.internalOffset.x=j;
this.internalOffset.y=g
}else{this.internalOffset.x=0;
this.internalOffset.y=0
}},handleScroll:function(){if(!this.blockRedraw){var c=this.scrollerDiv.scrollLeft;
var b=this.scrollerDiv.scrollTop;
var a=(this.internalOffset.x!=c)||(this.internalOffset.y!=b);
if(a){this.internalOffset.x=c;
this.internalOffset.y=b;
this.calculateCenterPoint();
this.drawImage()
}}},setRotation:function(a){this.calculateCenterPoint();
this.rotation=a;
this.calculateBasicImageSize();
this.calculateZoomedImageSize();
this.adjustSpacerImage();
this.propagateImage()
},getActualRotation:function(){return(this.ignoreRotation?0:this.rotation)
},setImageSize:function(a,b){a.width=b.width;
a.height=b.height;
a.style.width=b.width+"px";
a.style.height=b.height+"px"
},setCSSSize:function(b,a){b.style.width=a.width+"px";
b.style.height=a.height+"px"
},setCanvasSize:function(b,a){b.width=a.width;
b.height=a.height
},calculateDistance:function(b,a){return Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2))
},handleImageLoaded:function(){this.zoom=0;
this.internalOffset.x=0;
this.internalOffset.y=0;
this.centerPoint=null;
this.calculateOriginalImageSize();
if(this.isInitialized){this.calculateBasicImageSize();
this.calculateZoomedImageSize();
this.adjustSpacerImage();
this.propagateImage()
}},adjustSpacerImage:function(){this.setImageSize(this.spacerImage,this.calculateSpacerSize())
},addShapeSet:function(b){this.shapeSets[b.id]=b;
b.imageComponent=this;
var c=b.getShapeCount();
for(var a=0;
a<c;
a++){this.addShapeToDOM(b.getShapeAt(a))
}if(b.isVisible){this.drawImage()
}},drawShapeSets:function(g,j){var b=this.calculateAbsoluteZoom()+1;
for(var c in this.shapeSets){if(this.shapeSets.hasOwnProperty(c)){var a=this.shapeSets[c];
if(a.isVisible){a.drawShapes(g,b,j)
}}}},executeFnOnShapes:function(c,b){for(var a in this.shapeSets){if(this.shapeSets.hasOwnProperty(a)){var g=this.shapeSets[a];
if(g.isVisible||!b){g.executeFnOnShapes(c)
}}}},getShapeSet:function(a){if(this.shapeSets.hasOwnProperty(a)){return this.shapeSets[a]
}return null
},getSuitableShapeSet:function(b){for(var k in this.shapeSets){if(this.shapeSets.hasOwnProperty(k)){var a=this.shapeSets[k];
var j=a.getShapeCount();
for(var c=0;
c<j;
c++){var g=a.getShapeAt(c);
if(g==b){return a
}}}}return null
},setShapeSetVisible:function(c,a,g){var b=this.shapeSets[c];
if(b){b.executeFnOnShapes(function(k){if(!a){var m=(this.rolledOverShapes.indexOf(k)>=0);
var j=(this.selectedShapes.indexOf(k)>=0);
if(m){this.removeShapeFromRollovers(k,null,true)
}if(j>=0){k.onUnSelect();
this.selectedShapes.splice(j,1)
}}}.createDelegate(this),true);
b.setVisible(a);
if(g){this.drawImage()
}}},hideAllShapeSets:function(c){for(var a in this.shapeSets){var b=this.shapeSets[a];
if(b.isVisible){this.setShapeSetVisible(a,false,false)
}}if(c){this.drawImage()
}},scheduleForDragging:function(a){this.scheduledDragShapes.push(a)
},createCanvas:function(j,c,a){var b;
CQ.Log.debug("SmartImage.Image#createCanvas: Started.");
b=document.createElement("canvas");
j.appendChild(b);
if(b){if(c){b.width=c
}if(a){b.height=a
}if(CQ.Ext.isIE6||CQ.Ext.isIE7||CQ.Ext.isIE8){try{b=G_vmlCanvasManager.initElement(b)
}catch(g){b=null
}if(!b){CQ.Log.fatal("SmartImage.Image#createCanvas: Could not create Canvas emulation for Internet Explorer.")
}}}CQ.Log.debug("SmartImage.Image#createCanvas:Finished; creating canvas "+(b?"was successful":"failed")+".");
return b
},disablePanelTemporaryily:function(){if(!this.workingAreaSize&&this.scrollerDiv){this.calculateWorkingAreaSize()
}if(this.imageCanvas&&this.workingAreaSize){var b=this.imageCanvas.getContext("2d");
b.save();
b.globalCompositeOperation="source-over";
var c=this.workingAreaSize.width;
var a=this.workingAreaSize.height;
if(CQ.Ext.isIE6||CQ.Ext.isIE7||CQ.Ext.isIE8){b.clearRect()
}else{b.clearRect(0,0,c,a)
}b.restore()
}},drawImage:function(){var v=this.getActualRotation();
var D=this.imageCanvas.getContext("2d");
D.save();
D.globalCompositeOperation="source-over";
var G=this.workingAreaSize.width;
var j=this.workingAreaSize.height;
var n=Math.floor(G/2);
var k=Math.floor(j/2);
D.translate(n,k);
D.rotate((v*Math.PI)/180);
var y=0,g=0;
var c=0,M=0;
var A=0,b=0;
var u=G;
var E=this.zoomedImageSize.displayWidth-G-this.internalPadding.width;
var L=this.zoomedImageSize.displayHeight-j-this.internalPadding.height;
if(G>=this.zoomedImageSize.displayWidth){u=this.zoomedImageSize.width;
y=Math.round((G-u)/2)
}else{c=(this.internalOffset.x<this.internalPadding.width?this.internalPadding.width-this.internalOffset.x:0);
if(this.internalOffset.x>E){M=this.internalOffset.x-E
}u-=c+M
}var r=j;
if(j>=this.zoomedImageSize.displayHeight){r=this.zoomedImageSize.height;
g=Math.round((j-r)/2)
}else{A=(this.internalOffset.y<this.internalPadding.height?this.internalPadding.height-this.internalOffset.y:0);
if(this.internalOffset.y>L){b=this.internalOffset.y-L
}r-=A+b
}this.imageOffsets={x:y,y:g};
var H=-n;
var m=-k;
var w=(v==90)||(v==270);
if(CQ.Ext.isIE6||CQ.Ext.isIE7||CQ.Ext.isIE8){D.clearRect()
}else{if(w){D.clearRect(m,H,j,G)
}else{D.clearRect(H,m,G,j)
}}var K={x:0,y:0};
var o=this.calculateAbsoluteZoom();
var B={x:this.internalOffset.x-this.internalPadding.width,y:this.internalOffset.y-this.internalPadding.height};
if(B.x<0){B.x=0
}if(B.y<0){B.y=0
}var C=this.calculateInverseZoom(o,B);
switch(v){case 90:B.x=this.zoomedImageSize.width-B.x-u;
break;
case 180:B.x=this.zoomedImageSize.width-B.x-u;
B.y=this.zoomedImageSize.height-B.y-r;
break;
case 270:B.y=this.zoomedImageSize.height-B.y-r;
break
}K=this.calculateInverseZoom(o,B);
var F=this.calculateInverseZoom(o,{width:u,height:r});
var a=(w?K.y:K.x);
var P=(w?K.x:K.y);
if(a<0){a=0
}if(P<0){P=0
}var z=(w?F.height:F.width);
var J=(w?F.width:F.height);
if(z>this.originalImageSize.width){z=this.originalImageSize.width
}if(J>this.originalImageSize.height){J=this.originalImageSize.height
}var O,N,t,x;
switch(v){case 0:O=H+y+c;
N=m+g+A;
t=u;
x=r;
break;
case 90:O=m+g+A;
N=H+y+M;
t=r;
x=u;
break;
case 180:O=H+y+M;
N=m+g+b;
t=u;
x=r;
break;
case 270:O=m+g+b;
N=H+y+c;
t=r;
x=u;
break
}var q=false;
try{D.drawImage(this.imageToDisplay.image,a,P,z,J,O,N,t,x)
}catch(I){window.setTimeout(this.drawImage.createDelegate(this),1);
q=true
}D.restore();
if(!q){this.drawShapeSets(D,{destX:y+c,destY:g+A,srcX:C.x,srcY:C.y,imageSize:this.originalImageSize,zoomedSize:this.zoomedImageSize})
}},addShapeToDOM:function(b){if(CQ.Ext.isIE){var a=CQ.Ext.DomHelper.insertBefore(this.scrollerDiv,{tag:"div"},false);
a.style.position="absolute";
a.style.top="0";
a.style.left="0";
var c=this.createCanvas(a,this.workingAreaSize.width,this.workingAreaSize.height);
var g={container:a,canvas:c,shape:b};
if(!this.shapeDefs){this.shapeDefs=new Array()
}this.shapeDefs.push(g);
b.shapeDef=g
}},removeShapeFromDOM:function(c){if(CQ.Ext.isIE){var g=c.shapeDef;
var b=CQ.Ext.get(g.canvas);
var a=CQ.Ext.get(g.container);
b.remove();
a.remove()
}},getCanvasContext:function(){return this.imageCanvas.getContext("2d")
}});
CQ.form.SmartImage.Tool=CQ.Ext.extend(CQ.Ext.emptyFn,{toolId:null,toolName:null,transferFieldName:null,transferField:null,isCommandTool:false,userInterface:null,imageComponent:null,buttonComponent:null,constructor:function(a){a=a||{};
CQ.Ext.apply(this,a)
},initialize:function(a){},initComponent:function(a){this.imageComponent=a
},onActivation:function(){},onDeactivation:function(){},onCommand:function(){},onImageUploaded:function(a){},onImageFlushed:function(){this.resetToolValue()
},createTransferField:function(a){this.transferField=new CQ.Ext.form.Hidden({name:this.transferFieldName});
a.add(this.transferField)
},transferToField:function(){var a=this.serialize();
if(a==null){a=this.initialValue
}this.transferField.setValue(a)
},resetToolValue:function(){this.transferField.setValue("")
},processRecord:function(a){this.initialValue=a.get(this.transferFieldName);
if(this.initialValue==null){this.initialValue=""
}},serialize:function(){return null
},deserialize:function(a){},isEnabled:function(){return true
}});
CQ.form.SmartImage.Tool.UserInterface=CQ.Ext.extend(CQ.Ext.Panel,{constructor:function(a){var b={title:CQ.I18n.getMessage("Tool options"),floating:true,draggable:{insertProxy:false,onDrag:function(j){var g=this.proxy.getEl();
this.x=g.getLeft(true);
this.y=g.getTop(true);
var c=this.panel.getEl().shadow;
if(c){c.realign(this.x,this.y,g.getWidth(),g.getHeight())
}},endDrag:function(c){this.panel.setPosition(this.x,this.y)
}},collapsible:true,renderTo:CQ.Util.ROOT_ID,width:400,hidden:true,stateful:false};
CQ.Util.applyDefaults(a,b);
if(!a.items&&!a.tbar&&!a.bbar){a.html="No tools available"
}CQ.form.SmartImage.Tool.UserInterface.superclass.constructor.call(this,a)
},setPosition:function(a,b){CQ.form.SmartImage.Tool.UserInterface.superclass.setPosition.call(this,a,b);
this.saveX=this.x;
this.saveY=this.y
}});
CQ.form.SmartImage.Tool.Rotate=CQ.Ext.extend(CQ.form.SmartImage.Tool,{preRotation:0,constructor:function(a){CQ.form.SmartImage.Tool.Rotate.superclass.constructor.call(this,{toolId:"smartimageRotate",toolName:CQ.I18n.getMessage("Rotate"),iconCls:"cq-image-icon-rotate",isCommandTool:true,userInterface:null,transferFieldName:a})
},onCommand:function(){var c=this.imageComponent.getImagePanel();
var b=new CQ.form.SmartImage.Animation({imageComponent:this.imageComponent,onFinished:this.executeRotate.createDelegate(this)});
var a=0;
if(c.zoom>0){a=200;
b.addStep(new CQ.form.SmartImage.Animation.ZoomOut({durationMs:300,startZoom:c.zoom,endZoom:0}))
}b.addStep(new CQ.form.SmartImage.Animation.ExecuteFn({durationMs:a,fn:function(){c.switchToDefaultView();
var o=c.rotation;
var r=(o==90)||(o==270);
var j={width:(r?c.zoomedImageSize.height:c.zoomedImageSize.width),height:(r?c.zoomedImageSize.width:c.zoomedImageSize.height)};
var m=o+90;
var q=c.precalculateRotatedSize(m);
var n=(m==90)||(m==270);
if(n){var k=q;
q={width:k.height,height:k.width}
}var g=c.imageToDisplay;
b.addStep(new CQ.form.SmartImage.Animation.Rotation({image:g,durationMs:300,startAngle:o,endAngle:o+90,startSize:j,endSize:q}))
}}));
b.play()
},executeRotate:function(){var b=this.imageComponent.getImagePanel();
b.setRotation(Math.round(b.rotation+90)%360);
var a={changeType:"rotate",newValue:b.rotation,valueDelta:90};
b.fireEvent("contentchange",a);
b.fireEvent("smartimage.contentchange",a)
},onImageFlushed:function(){var a=this.imageComponent.getImagePanel();
a.setRotation(0);
this.preRotation=0;
CQ.form.SmartImage.Tool.Rotate.superclass.onImageFlushed.call(this)
},processRecord:function(a){CQ.form.SmartImage.Tool.Rotate.superclass.processRecord.call(this,a);
this.deserialize(this.initialValue)
},serialize:function(){var a=this.imageComponent.getImagePanel();
return(Math.round(a.rotation)+this.preRotation)%360
},deserialize:function(g){var c=this.imageComponent.getImagePanel();
if(g&&(g.length>0)){var a=0;
try{a=parseInt(g)
}catch(b){}this.preRotation=a
}else{this.preRotation=0
}c.rotation=0
}});
CQ.form.SmartImage.Shape=CQ.Ext.extend(CQ.Ext.emptyFn,{calculateDistance:function(b,a){return Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2))
},calculateDisplayCoords:function(c,b,a,g){if(typeof(a)=="object"){g=a.y;
a=a.x
}a=Math.round((a-b.srcX)*c)+b.destX;
g=Math.round((g-b.srcY)*c)+b.destY;
return{x:a,y:g}
},calculateDisplaySize:function(c,b,a){if(typeof(b)=="object"){a=b.height;
b=b.width
}b=Math.round(b*c);
a=Math.round(a*c);
return{width:b,height:a}
},onRollOver:function(a){return false
},onRollOut:function(a){return false
},onRolledOver:function(a){return false
},onSelect:function(){return false
},onUnSelect:function(){return false
},onClick:function(){return false
},isDirectlyDraggable:function(b,a){return false
},isDeferredDraggable:function(b,a){return false
},moveShapeBy:function(c,a,b){return false
},onDragStart:function(b,a){return false
},onDragEnd:function(b,a){return false
},onDrag:function(b,a){return false
},onAddForDrag:function(a){},isTouched:function(b,a){return false
},draw:function(a,c,b){}});
CQ.form.SmartImage.ShapeSet=CQ.Ext.extend(CQ.Ext.emptyFn,{id:null,isVisible:false,shapes:null,imageComponent:null,constructor:function(a){this.id=a;
this.isVisible=true;
this.shapes=new Array()
},addShape:function(a){this.shapes.push(a);
if(this.imageComponent){this.imageComponent.addShapeToDOM(a);
this.imageComponent.drawImage()
}},removeShape:function(a){var b=this.getShapeIndex(a);
if(b>=0){this.shapes.splice(b,1);
if(this.imageComponent){this.imageComponent.removeShapeFromDOM(a);
this.imageComponent.drawImage()
}}},removeAllShapes:function(){var b=this.shapes.length;
for(var a=b-1;
a>=0;
a--){this.removeShape(this.shapes[a])
}},getShapeIndex:function(a){var g=this.shapes.length;
for(var b=0;
b<g;
b++){var c=this.shapes[b];
if(c==a){return b
}}return -1
},getShapeCount:function(){return this.shapes.length
},getShapeAt:function(a){return this.shapes[a]
},setVisible:function(a){this.isVisible=a;
if(CQ.Ext.isIE){this.executeFnOnShapes(function(c){var g=c.shapeDef.canvas;
var b=g.getContext("2d");
b.clearRect(0,0,g.width,g.height)
})
}},drawShapes:function(a,k,j){var m=this.shapes.length;
for(var g=0;
g<m;
g++){var c=this.shapes[g];
if(CQ.Ext.isIE){var b=c.shapeDef.canvas;
a=b.getContext("2d");
a.clearRect(0,0,b.width,b.height)
}a.save();
if(CQ.themes.SmartImage.DEFAULT_DRAWING_MODE!=null){a.globalCompositeOperation=CQ.themes.SmartImage.DEFAULT_DRAWING_MODE
}c.draw(a,k,j);
a.restore()
}},executeFnOnShapes:function(b){var c=this.shapes.length;
for(var a=0;
a<c;
a++){var g=this.shapes[a];
b(g)
}}});
CQ.form.SmartImage.Animation=CQ.Ext.extend(CQ.Ext.emptyFn,{imageComponent:null,onFinished:null,steps:null,stepPlayed:null,stepStartTc:null,constructor:function(a){a=a||{};
var b={};
CQ.Ext.apply(this,a,b);
this.steps=[];
this.stepPlayed=null
},addStep:function(a){this.steps.push(a)
},isPlayed:function(){return this.stepPlayed!=null
},play:function(){this.stepPlayed=0;
this.stepStartTc=new Date().getTime();
this.playTick()
},playTick:function(){var c=new Date().getTime();
if(this.stepPlayed<this.steps.length){var b=this.steps[this.stepPlayed];
var a=c-this.stepStartTc;
var g=1;
if(b.durationMs>0){g=a/b.durationMs
}if(g>=1){g=1;
this.stepPlayed++;
this.stepStartTc=c
}b.tick(this.imageComponent,g);
window.setTimeout(this.playTick.createDelegate(this),10)
}else{this.stepPlayed=null;
if(this.onFinished){this.onFinished(this)
}}}});
CQ.form.SmartImage.Animation.Step=CQ.Ext.extend(CQ.Ext.emptyFn,{durationMs:0,constructor:function(a){a=a||{};
var b={durationMs:500};
CQ.Ext.apply(this,a,b)
},tick:function(b,a){}});
CQ.form.SmartImage.Animation.Rotation=CQ.Ext.extend(CQ.form.SmartImage.Animation.Step,{startAngle:null,startSize:null,endAngle:null,endSize:null,image:null,deltaAngle:null,deltaSize:null,constructor:function(a){CQ.form.SmartImage.Animation.Rotation.superclass.constructor.call(this,a);
this.deltaAngle=this.endAngle-this.startAngle;
this.deltaSize={width:this.endSize.width-this.startSize.width,height:this.endSize.height-this.startSize.height}
},tick:function(g,r){var q=g.getImagePanel();
var a=this.startAngle+(r*this.deltaAngle);
var k={width:this.startSize.width+(r*this.deltaSize.width),height:this.startSize.height+(r*this.deltaSize.height)};
var u=q.getCanvasContext();
u.save();
var c=q.imageCanvas.width;
var o=q.imageCanvas.height;
u.clearRect(0,0,c,o);
var t=q.workingAreaSize;
var m=Math.floor(t.width/2);
var j=Math.floor(t.height/2);
u.translate(m,j);
u.rotate((a*Math.PI)/180);
var n=-(k.width/2);
var b=-(k.height/2);
u.drawImage(this.image.image,n,b,k.width,k.height);
u.restore()
}});
CQ.form.SmartImage.Animation.ZoomOut=CQ.Ext.extend(CQ.form.SmartImage.Animation.Step,{startZoom:null,endZoom:null,deltaZoom:null,constructor:function(a){CQ.form.SmartImage.Animation.ZoomOut.superclass.constructor.call(this,a);
this.deltaZoom=this.endZoom-this.startZoom
},tick:function(b,a){var g=b.getImagePanel();
var c=this.startZoom+(a*this.deltaZoom);
g.setZoom(c);
if(a==1){b.resetZoomSlider()
}}});
CQ.form.SmartImage.Animation.ExecuteFn=CQ.Ext.extend(CQ.form.SmartImage.Animation.Step,{fn:null,scopr:null,constructor:function(a){a=a||{};
var b={durationMs:0};
a=CQ.Util.applyDefaults(a,b);
CQ.form.SmartImage.Animation.ExecuteFn.superclass.constructor.call(this,a);
this.deltaZoom=this.endZoom-this.startZoom
},tick:function(b,a){if(this.fn!=null){if(this.scope){this.fn.call(this.scope)
}else{this.fn()
}this.fn=null
}}});
CQ.form.ImageMap=CQ.Ext.extend(CQ.form.SmartImage.Tool,{isInitialized:false,isLoading:false,destroy:function(){CQ.Ext.destroy(this.userInterface)
},constructor:function(a){CQ.form.ImageMap.superclass.constructor.call(this,{toolId:"smartimageMap",toolName:CQ.I18n.getMessage("Map"),iconCls:"cq-image-icon-map",isCommandTool:false,userInterface:new CQ.form.ImageMap.UI({title:CQ.I18n.getMessage("Image map tools")}),transferFieldName:a})
},initComponent:function(a){CQ.form.ImageMap.superclass.initComponent.call(this,a);
this.workingArea=this.imageComponent.getImagePanel();
this.workingArea.on("contentchange",this.onContentChange,this);
this.imageComponent.on("beforeloadimage",function(){this.isLoading=true;
if(this.buttonComponent!=null){this.buttonComponent.setTooltip(null)
}},this);
this.imageComponent.on("loadimage",function(){this.isLoading=false;
this.adjustButtonToState()
},this);
this.imageComponent.on("imagestate",function(){if(!this.isLoading){this.adjustButtonToState()
}},this)
},onActivation:function(){CQ.form.ImageMap.superclass.onActivation.call(this);
if(!this.isInitialized){if(this.mapShapeSet==null){this.mapShapeSet=new CQ.form.SmartImage.ShapeSet(CQ.form.ImageMap.SHAPESET_ID);
this.workingArea.addShapeSet(this.mapShapeSet)
}this.userInterface.notifyWorkingArea(this.workingArea,this.mapShapeSet);
this.isInitialized=true
}this.workingArea.hideAllShapeSets(false);
if(this.initialValue!=null){this.deserialize(this.initialValue);
this.initialValue=null
}this.userInterface.isActive=true;
this.workingArea.setShapeSetVisible(CQ.form.ImageMap.SHAPESET_ID,true,true)
},onDeactivation:function(){this.workingArea.clearSelection();
this.userInterface.isActive=false;
this.workingArea.setShapeSetVisible(CQ.form.ImageMap.SHAPESET_ID,false,false);
CQ.form.ImageMap.superclass.onDeactivation.call(this)
},clearMappingInformation:function(){if(this.mapShapeSet){try{this.workingArea.clearSelection();
this.mapShapeSet.removeAllShapes()
}catch(a){}}this.initialValue=null
},onImageUploaded:function(){this.clearMappingInformation();
CQ.form.ImageMap.superclass.onImageUploaded.call(this)
},onImageFlushed:function(){this.clearMappingInformation();
CQ.form.ImageMap.superclass.onImageFlushed.call(this)
},onContentChange:function(m){if(m.changeType=="rotate"){var k=this.workingArea.originalImageSize;
if(this.mapShapeSet==null){this.mapShapeSet=new CQ.form.SmartImage.ShapeSet(CQ.form.ImageMap.SHAPESET_ID);
this.mapShapeSet.isVisible=false;
this.workingArea.addShapeSet(this.mapShapeSet);
if(this.initialValue){this.deserialize(this.initialValue);
this.initialValue=null
}}var c=parseInt(m.valueDelta);
var a=parseInt(m.newValue);
if(c!=0){var j=this.mapShapeSet.getShapeCount();
for(var b=0;
b<j;
b++){var g=this.mapShapeSet.getShapeAt(b);
g.rotateBy(c,a,k)
}this.workingArea.drawImage()
}}},transferToField:function(){if(this.userInterface){this.userInterface.saveDestinationArea()
}CQ.form.ImageMap.superclass.transferToField.call(this)
},serialize:function(){if(!this.isInitialized){return null
}if(this.mapShapeSet==null){return""
}var g="";
var c=this.mapShapeSet.getShapeCount();
for(var a=0;
a<c;
a++){var b=this.mapShapeSet.getShapeAt(a);
g+="["+b.serialize()+"]"
}return g
},deserialize:function(c){this.mapShapeSet.removeAllShapes();
if(c&&(c.length>0)){var g=0;
while(g<c.length){var b=c.indexOf("[",g);
if(b<0){break
}var a=c.indexOf(")",b+1);
if(a<0){break
}var m=c.substring(b+1,a+1);
var k=null;
if(CQ.form.ImageMap.RectArea.isStringRepresentation(m)){k=CQ.form.ImageMap.RectArea.deserialize(m)
}else{if(CQ.form.ImageMap.PolyArea.isStringRepresentation(m)){k=CQ.form.ImageMap.PolyArea.deserialize(m)
}else{if(CQ.form.ImageMap.CircularArea.isStringRepresentation(m)){k=CQ.form.ImageMap.CircularArea.deserialize(m)
}}}if(k!=null){var j=g;
g=k.destination.deserialize(c,a+1);
this.mapShapeSet.addShape(k);
if(g==null){CQ.Log.error("CQ.form.ImageMap#deserialize: Invalid map definition: "+c+"; trying to continue parsing.");
g=c.indexOf("]",j)+1
}}else{CQ.Log.error("CQ.form.ImageMap#deserialize: Invalid area definition string: "+m);
g=c.indexOf("]",g)+1
}}}},isEnabled:function(){return this.imageComponent.usesProcessedImage()
},adjustButtonToState:function(){var a=this.isEnabled()&&(!this.imageComponent.editLock||this.imageComponent.editLockDisabled);
this.buttonComponent.setDisabled(!a);
this.buttonComponent.setTooltip(a?null:CQ.I18n.getMessage("This action will become available once the image has been saved for the first time."))
}});
CQ.form.ImageMap.SHAPESET_ID="smartimage.imagemap";
CQ.form.ImageMap.EDITMODE_ADD=0;
CQ.form.ImageMap.EDITMODE_EDIT=1;
CQ.form.ImageMap.AREATYPE_RECT=0;
CQ.form.ImageMap.AREATYPE_CIRCLE=1;
CQ.form.ImageMap.AREATYPE_POLYGON=2;
CQ.form.ImageMap.AREATYPE_POINT=3;
CQ.form.ImageMap.EVENT_PREFIX="imagemap.";
CQ.form.ImageMap.EVENT_MODE_CHANGE=CQ.form.ImageMap.EVENT_PREFIX+"modechange";
CQ.form.ImageMap.EVENT_VISUAL_CHANGE=CQ.form.ImageMap.EVENT_PREFIX+"visualchange";
CQ.form.ImageMap.UI=CQ.Ext.extend(CQ.form.SmartImage.Tool.UserInterface,{isActive:false,workingArea:null,editMode:null,areaType:null,polyAreaAdded:null,mapShapeSet:null,constructor:function(a){var g=function(j){this.toolClicked(j.itemId)
}.createDelegate(this);
this.toolbarButtons={addRect:new CQ.Ext.Toolbar.Button({itemId:"addRect",text:CQ.I18n.getMessage("Rectangle"),enableToggle:true,toggleGroup:"mapperTools",allowDepress:false,handler:g}),addCircle:new CQ.Ext.Toolbar.Button({itemId:"addCircle",text:CQ.I18n.getMessage("Circle"),enableToggle:true,toggleGroup:"mapperTools",allowDepress:false,handler:g}),addPoly:new CQ.Ext.Toolbar.Button({itemId:"addPoly",text:CQ.I18n.getMessage("Polygon"),enableToggle:true,toggleGroup:"mapperTools",allowDepress:false,handler:g}),editPolyPoint:new CQ.Ext.Toolbar.Button({itemId:"editPolyPoint",xtype:"tbbutton",text:CQ.I18n.getMessage("Polygon point"),enableToggle:true,toggleGroup:"mapperTools",allowDepress:false,handler:g}),edit:new CQ.Ext.Toolbar.Button({itemId:"edit",text:CQ.I18n.getMessage("Edit"),enableToggle:true,toggleGroup:"mapperTools",allowDepress:false,handler:g})};
var b=new CQ.Ext.Toolbar({xtype:"toolbar",items:[CQ.I18n.getMessage("Add")+":",this.toolbarButtons.addRect,this.toolbarButtons.addCircle,this.toolbarButtons.addPoly,this.toolbarButtons.editPolyPoint,{xtype:"tbseparator"},this.toolbarButtons.edit,{xtype:"tbseparator"},{itemId:"delete",xtype:"tbbutton",text:CQ.I18n.getMessage("Delete"),handler:function(){this.deleteSelection()
}.createDelegate(this)}]});
var c={layout:"column",bodyStyle:"padding-top: 1px; padding-bottom: 1px; padding-left: 3px; padding-right: 2px;",width:CQ.themes.SmartImage.Tool.MAP_TOOLS_WIDTH,tbar:b,items:[{itemId:"col1",xtype:"panel",layout:"form",border:false,columnWidth:0.5,labelWidth:CQ.themes.SmartImage.Tool.MAP_AREAEDITOR_LABEL_WIDTH,defaults:{itemCls:"cq-map-areaeditor-fieldlabel",cls:"cq-map-areaeditor-text",fieldClass:"cq-map-areaeditor-text",width:CQ.themes.SmartImage.Tool.MAP_AREAEDITOR_FIELD_WIDTH},items:[{itemId:"areaDefUrl",name:"url",xtype:"pathfield",fieldLabel:CQ.I18n.get("HREF"),listeners:{dialogopen:{fn:function(){this.__position=this.getPosition();
this.hide()
},scope:this},dialogclose:{fn:function(){this.show();
this.setPosition(this.__position)
},scope:this}}},{itemId:"areaDefTarget",name:"target",xtype:"textfield",fieldLabel:CQ.I18n.get("Target")}]},{itemId:"col2",xtype:"panel",layout:"form",border:false,columnWidth:0.5,labelWidth:CQ.themes.SmartImage.Tool.MAP_AREAEDITOR_LABEL_WIDTH,defaults:{itemCls:"cq-map-areaeditor-fieldlabel",cls:"cq-map-areaeditor-text",fieldClass:"cq-map-areaeditor-text",width:CQ.themes.SmartImage.Tool.MAP_AREAEDITOR_FIELD_WIDTH},items:[{itemId:"areaDefText",name:"text",xtype:"textfield",fieldLabel:CQ.I18n.get("Text")},{itemId:"areaDefCoords",name:"coords",xtype:"textfield",fieldLabel:CQ.I18n.get("Coordinates")}]}]};
CQ.Util.applyDefaults(a,c);
CQ.form.ImageMap.UI.superclass.constructor.call(this,a)
},initComponent:function(){CQ.form.ImageMap.UI.superclass.initComponent.call(this);
this.areaDefUrl=this.items.get("col1").items.get("areaDefUrl");
this.areaDefTarget=this.items.get("col1").items.get("areaDefTarget");
this.areaDefText=this.items.get("col2").items.get("areaDefText");
this.areaDefCoords=this.items.get("col2").items.get("areaDefCoords");
this.areaDefCoords.on("specialkey",function(c,b){var a=this.editedArea;
if((b.getKey()==CQ.Ext.EventObject.ENTER)&&(a!=null)){if(a.fromCoordString(this.areaDefCoords.getValue())){this.workingArea.drawImage()
}this.areaDefCoords.setValue(a.toCoordString())
}},this);
this.setDestinationAreaEditorEnabled(false)
},notifyWorkingArea:function(a,b){this.workingArea=a;
this.mapShapeSet=b;
this.workingArea.on("addrequest",this.onAddRequest,this);
this.workingArea.on("selectionchange",this.onSelectionChange,this);
this.workingArea.on("dragchange",this.onVisualChange,this);
this.workingArea.on("rollover",this.onRollover,this)
},toolClicked:function(a){if(a=="edit"){this.switchEditMode(CQ.form.ImageMap.EDITMODE_EDIT,null)
}else{if(a=="editPolyPoint"){this.switchEditMode(CQ.form.ImageMap.EDITMODE_EDIT,CQ.form.ImageMap.AREATYPE_POINT)
}else{if(a=="addRect"){this.switchEditMode(CQ.form.ImageMap.EDITMODE_ADD,CQ.form.ImageMap.AREATYPE_RECT)
}else{if(a=="addCircle"){this.switchEditMode(CQ.form.ImageMap.EDITMODE_ADD,CQ.form.ImageMap.AREATYPE_CIRCLE)
}else{if(a=="addPoly"){this.switchEditMode(CQ.form.ImageMap.EDITMODE_ADD,CQ.form.ImageMap.AREATYPE_POLYGON)
}}}}}},setDestinationAreaEditorEnabled:function(a){this.areaDefUrl.setDisabled(!a);
this.areaDefTarget.setDisabled(!a);
this.areaDefText.setDisabled(!a);
this.areaDefCoords.setDisabled(!a)
},saveDestinationArea:function(c){if(!c){c=this.editedArea
}if(c){var a=this.areaDefUrl.getValue();
if(a.length>0){if(a.charAt(0)!="/"){var b=a.indexOf("://");
if(b<0){if(a.indexOf("mailto:")!=0){a="http://"+a
}}}}c.destination.url=a;
c.destination.target=this.areaDefTarget.getValue();
c.destination.text=this.areaDefText.getValue()
}},loadDestinationArea:function(a){if(a!=null){this.areaDefUrl.setValue(a.destination.url);
this.areaDefTarget.setValue(a.destination.target);
this.areaDefText.setValue(a.destination.text);
this.areaDefCoords.setValue(a.toCoordString())
}else{this.areaDefUrl.setValue("");
this.areaDefTarget.setValue("");
this.areaDefText.setValue("");
this.areaDefCoords.setValue("")
}},switchEditMode:function(b,a){this.editMode=b;
this.areaType=a;
this.adjustToolbar();
if(this.editMode==CQ.form.ImageMap.EDITMODE_ADD){this.finishPolygonBuilding(false);
this.workingArea.blockRollOver();
this.workingArea.clearSelection();
this.workingArea.drawImage()
}else{if(this.editMode==CQ.form.ImageMap.EDITMODE_EDIT){if(this.areaType!=CQ.form.ImageMap.AREATYPE_POINT){this.finishPolygonBuilding(false)
}this.workingArea.unblockRollOver();
this.workingArea.drawImage()
}}if(!this.polyAreaAdded){this.workingArea.drawImage()
}},adjustToolbar:function(){var a=null;
if(this.editMode==CQ.form.ImageMap.EDITMODE_EDIT){if(this.areaType==CQ.form.ImageMap.AREATYPE_POINT){a="editPolyPoint"
}else{a="edit"
}}else{if(this.editMode==CQ.form.ImageMap.EDITMODE_ADD){if(this.areaType==CQ.form.ImageMap.AREATYPE_RECT){a="addRect"
}else{if(this.areaType==CQ.form.ImageMap.AREATYPE_POLYGON){a="addPoly"
}else{if(this.areaType==CQ.form.ImageMap.AREATYPE_CIRCLE){a="addCircle"
}}}}}for(var b in this.toolbarButtons){if(this.toolbarButtons.hasOwnProperty(b)){var c=this.toolbarButtons[b];
c.suspendEvents();
c.toggle(b==a);
c.resumeEvents()
}}},deleteSelection:function(){var g=false;
var b=this.mapShapeSet.getShapeCount();
for(var a=0;
a<b;
a++){var c=this.mapShapeSet.getShapeAt(a);
if(c.areaType==CQ.form.ImageMap.AREATYPE_POLYGON){if(c.selectedHandle!=null){c.removePoint(c.selectedHandle);
g=true
}}}if(!g){this.workingArea.deleteSelectedShapes()
}else{this.workingArea.drawImage()
}},finishPolygonBuilding:function(a){if(this.polyAreaAdded){this.polyAreaAdded.isSelected=false;
this.polyAreaAdded.selectedHandle=null;
if(a){this.workingArea.drawImage()
}}this.polyAreaAdded=null
},onAddRequest:function(n){if(this.isActive){n=n.unzoomed;
if(this.editMode==CQ.form.ImageMap.EDITMODE_ADD){var c;
if(this.areaType==CQ.form.ImageMap.AREATYPE_RECT){c=new CQ.form.ImageMap.RectArea({},n.y,n.x,n.y+1,n.x+1)
}else{if(this.areaType==CQ.form.ImageMap.AREATYPE_CIRCLE){c=new CQ.form.ImageMap.CircularArea({},n.x,n.y,1)
}else{if(this.areaType==CQ.form.ImageMap.AREATYPE_POLYGON){c=new CQ.form.ImageMap.PolyArea({},n.x,n.y);
c.selectPointAt(0);
this.polyAreaAdded=c
}}}if(c){this.workingArea.selectShape(c);
this.mapShapeSet.addShape(c);
this.workingArea.scheduleForDragging(c)
}}else{if((this.editMode==CQ.form.ImageMap.EDITMODE_EDIT)&&(this.areaType==CQ.form.ImageMap.AREATYPE_POINT)){var j;
if(this.polyAreaAdded){j=[this.polyAreaAdded]
}else{j=this.workingArea.getRolledOverShapes()
}var q;
var g=false;
var m=false;
var k=this.workingArea.getTolerance();
j=this.filterOnAreaType(j,CQ.form.ImageMap.AREATYPE_POLYGON);
if(j.length>0){var a=j.length;
for(var o=0;
o<a;
o++){var b=j[o];
if(b.handleId==null){q=b.insertPoint(n.x,n.y,k);
if(q!=null){b.handleId=q;
b.selectPoint(q);
g=true
}}else{m=true
}}}if(!g&&this.polyAreaAdded&&!m){q=this.polyAreaAdded.addPoint(n.x,n.y);
if(q!=null){this.polyAreaAdded.selectPoint(q)
}}this.workingArea.drawImage()
}}}},onSelectionChange:function(g){if(this.isActive){var c="ImageMap#onSelectionChange: Received selection change for areas: ";
if(g.length>0){var a=g.length;
for(var b=0;
b<a;
b++){if(b>0){c+=", "
}c+=g[b].serialize()
}}else{c+="None"
}CQ.Log.debug(c);
if(this.editedArea!=null){this.saveDestinationArea(this.editedArea)
}if(g.length==1){this.editedArea=g[0];
this.loadDestinationArea(this.editedArea);
this.setDestinationAreaEditorEnabled(true)
}else{this.editedArea=null;
this.loadDestinationArea(null);
this.setDestinationAreaEditorEnabled(false)
}}},onVisualChange:function(b,g){if(this.isActive){var c=b.length;
var k;
var j=false;
for(var a=0;
a<c;
a++){if(b[a]==this.editedArea){k=this.editedArea.toCoordString();
this.areaDefCoords.setValue(k);
j=true;
break
}}if(!j&&(b.length==1)){k=b[0].toCoordString();
this.areaDefCoords.setValue(k)
}if(g&&((this.editMode==CQ.form.ImageMap.EDITMODE_ADD)&&(this.areaType==CQ.form.ImageMap.AREATYPE_POLYGON))){this.switchEditMode(CQ.form.ImageMap.EDITMODE_EDIT,CQ.form.ImageMap.AREATYPE_POINT)
}}},onRollover:function(c){if(this.isActive){var g="ImageMap#onRollover: Received rollover for areas: ";
if(c.length>0){var b=c.length;
for(var a=0;
a<b;
a++){if(a>0){g+=", "
}g+=c[a].serialize()
}}else{g+="None"
}CQ.Log.debug(g);
if(this.editedArea==null){if(c.length==1){this.loadDestinationArea(c[0])
}else{this.loadDestinationArea(null)
}}}},filterOnAreaType:function(g,a){var k=new Array();
var c=g.length;
for(var b=0;
b<c;
b++){var j=g[b];
if(j.areaType==a){k.push(j)
}}return k
}});
CQ.form.ImageMap.Helpers=function(){return{checkIntersection:function(b,a){if(a<0){return(b>a)&&(b<=0)
}else{return(b>=0)&&(b<a)
}},calculateNoAngledDistance:function(g,c,b){var j=Math.abs(g);
var a=c-b;
if(b<0){if(c>0){j=Math.sqrt(Math.pow(c,2)+Math.pow(g,2))
}else{if(c<b){j=Math.sqrt(Math.pow(a,2)+Math.pow(g,2))
}}}else{if(c<0){j=Math.sqrt(Math.pow(c,2)+Math.pow(g,2))
}else{if(c>b){j=Math.sqrt(Math.pow(a,2)+Math.pow(g,2))
}}}return j
},calculateDistance:function(r,k,x){var a=r.x;
var w=r.y;
var m=k.x-a;
var c=k.y-w;
var v=x.x-a;
var q=x.y-w;
if((Math.abs(m)>0)&&(Math.abs(c)>0)){var u=c/m;
var n=1/u;
var j=(v*n+q)/(u+n);
var b=j*u;
var t=CQ.form.ImageMap.Helpers.checkIntersection(j,m)&&CQ.form.ImageMap.Helpers.checkIntersection(b,c);
if(t){return Math.sqrt(Math.pow(j-v,2)+Math.pow(q-b,2))
}else{var g=Math.sqrt(Math.pow(v,2)+Math.pow(q,2));
var o=Math.sqrt(Math.pow(v-m,2)+Math.pow(q-c,2));
return(g<o?g:o)
}}else{if((m==0)&&(c==0)){return Math.sqrt(Math.pow(v,2),Math.pow(q,2))
}else{if(m==0){return CQ.form.ImageMap.Helpers.calculateNoAngledDistance(v,q,c)
}else{return CQ.form.ImageMap.Helpers.calculateNoAngledDistance(q,v,m)
}}}},calculateDistanceToCircle:function(m,q){var g=q.x-m.x;
var b=q.y-m.y;
var k=b/g;
if((g!=0)&&(b!=0)){var a=Math.atan(k);
var j=Math.cos(a)*m.radius;
var c=Math.sin(a)*m.radius;
if(g<0){c=-c;
j=-j
}var o=j-g;
var n=c-b;
return Math.sqrt(Math.pow(o,2)+Math.pow(n,2))
}else{return Math.abs(b-m.radius)
}},compactArray:function(g){var c=g.length;
var a=0;
for(var b=0;
b<c;
b++){if(g[b]!=null){if(b!=a){g[a]=g[b]
}a++
}}g.length=a
},encodeString:function(m){var b=m.length;
var j="";
var g=0;
for(var k=0;
k<b;
k++){var a=m.charAt(k);
var c=null;
switch(a){case"\\":c="\\\\";
break;
case'"':c='\\"';
break;
case"[":c="\\[";
break;
case"]":c="\\]";
break;
case"|":c="\\|";
break
}if(c!=null){if(g<k){j+=m.substring(g,k)
}j+=c;
g=k+1
}}if(g<b){j+=m.substring(g,b)
}return j
},decodeFromContainingString:function(j,a){var c=j.indexOf('"',a);
if(c<0){return null
}var g=false;
var k=c+1;
var m="";
var b=false;
while(!g){var n=j.charAt(k);
if((n=='"')&&(!b)){g=true
}else{if(n=="\\"){if(b){m+="\\";
b=false
}else{b=true
}}else{if(b){m+=n;
b=false
}else{m+=n
}}}k++;
if((k>=j.length)&&(!g)){return null
}}return{decoded:m,nextPos:k}
},parseCoordinateFromContainingString:function(g,z){var b=g.length;
var w=z;
while(w<b){var q=g.charAt(w);
if(q!=" "){break
}w++
}if(w>=b){return null
}var A=new Object();
A.isError=false;
if(g.charAt(w)=="("){var o=g.indexOf(")",w+1);
if(o<0){A.isError=true;
return A
}var n=g.substring(w+1,o);
var m=n.split("/");
if(m.length!=2){A.isError=true;
return A
}var k=parseInt(m[0]);
var j=parseInt(m[1]);
if(isNaN(k)||isNaN(j)){A.isError=true;
return A
}A.coordinates={x:k,y:j};
A.isCoordinatesPair=true;
w=o+1
}else{var a=g.indexOf(":",w);
if(a<(w+1)){A.isError=true;
return A
}var t=g.substring(w,a);
var v=g.indexOf(" ",a+1);
var u=g.indexOf("(",a+1);
var r;
if((v>=0)&&(u>=0)){if(v<u){r=g.substring(a+1,v);
w=v
}else{r=g.substring(a+1,u);
w=u
}}else{if(v>=0){r=g.substring(a+1,v);
w=v
}else{if(u>=0){r=g.substring(a+1,u);
w=u
}else{if((a+1)>=g.length){A.isError=true;
return A
}r=g.substring(a+1,g.length);
w=g.length
}}}if(t=="r"){var c=parseInt(r);
if(isNaN(c)){A.isError=true;
return A
}A.coordinates={radius:c};
A.isCoordinatesPair=false
}else{A.isError=true;
return A
}}A.nextPos=w;
return A
},parseCoordinateString:function(c){var b=new Array();
var a=0;
var j=0;
while(a>=0){var g=CQ.form.ImageMap.Helpers.parseCoordinateFromContainingString(c,a);
if(g!=null){if(g.isError){return null
}b[b.length]=g.coordinates;
if(g.isCoordinatesPair){j++
}a=g.nextPos
}else{a=-1
}}return{coordinates:b,coordinatesPairCnt:j}
},parseRectDef:function(k){var j=null;
var c=k.indexOf("(");
if(c>=0){var b=k.indexOf(")",c+1);
if(b>c){var g=k.substring(c+1,b);
var a=g.split(" ");
if(a.length==4){j=new Object();
j.top=a[0];
j.left=a[3];
j.bottom=a[2];
j.right=a[1]
}}}return j
}}
}();
CQ.form.ImageMap.AreaDestination=CQ.Ext.extend(CQ.Ext.emptyFn,{url:null,target:null,text:null,constructor:function(a,b,c){this.url=(a?a:"");
this.target=(b?b:"");
this.text=(c?c:"")
},serialize:function(){var a="";
if(this.url&&(this.url.length>0)){a+='"'+CQ.form.ImageMap.Helpers.encodeString(this.url)+'"'
}a+="|";
if(this.target&&(this.target.length>0)){a+='"'+CQ.form.ImageMap.Helpers.encodeString(this.target)+'"'
}a+="|";
if(this.text&&(this.text.length>0)){a+='"'+CQ.form.ImageMap.Helpers.encodeString(this.text)+'"'
}return a
},deserialize:function(g,b){var c=b;
var j,a;
if(c<g.length){a=g.charAt(c);
if(a!="|"){j=CQ.form.ImageMap.Helpers.decodeFromContainingString(g,c);
if(j==null){return null
}else{this.url=j.decoded;
c=j.nextPos
}}c++
}if(c<g.length){a=g.charAt(c);
if(a!="|"){j=CQ.form.ImageMap.Helpers.decodeFromContainingString(g,c);
if(j==null){return null
}else{this.target=j.decoded;
c=j.nextPos
}}c++
}if(c<g.length){a=g.charAt(c);
if(a!="]"){j=CQ.form.ImageMap.Helpers.decodeFromContainingString(g,c);
if(j==null){return null
}else{this.text=j.decoded;
c=j.nextPos
}}}return c+1
}});
CQ.form.ImageMap.Area=CQ.Ext.extend(CQ.form.SmartImage.Shape,{areaType:null,destination:null,fillColor:null,shadowColor:null,basicShapeColor:null,rolloverColor:null,selectedColor:null,handleSize:0,handleColor:null,handleRolloverColor:null,handleSelectedColor:null,isRollOver:false,isSelected:false,isHandleRolledOver:false,handleId:null,constructor:function(a,b){this.areaType=a;
this.destination=new CQ.form.ImageMap.AreaDestination();
this.handleId=null;
this.isSelected=false;
this.isRollOver=false;
b=b||{};
var c={fillColor:CQ.themes.ImageMap.FILL_COLOR,shadowColor:CQ.themes.ImageMap.SHADOW_COLOR,basicShapeColor:CQ.themes.ImageMap.BASIC_SHAPE_COLOR,rolloverColor:CQ.themes.ImageMap.ROLLOVER_COLOR,selectedColor:CQ.themes.ImageMap.SELECTED_COLOR,handleSize:CQ.themes.ImageMap.HANDLE_SIZE,handleColor:CQ.themes.ImageMap.HANDLE_COLOR,handleRolloverColor:CQ.themes.ImageMap.HANDLE_ROLLOVER_COLOR,handleSelectedColor:CQ.themes.ImageMap.HANDLE_SELECTED_COLOR};
CQ.Ext.apply(this,b,c)
},isPartOfHandle:function(b,a,m){var o=(m.unzoomed.absoluteZoom+1);
var j=Math.ceil(this.handleSize/o);
var g=b-j;
var c=b+j;
var n=a-j;
var k=a+j;
m=m.unzoomedUnclipped;
return((m.x>=g)&&(m.x<=c)&&(m.y>=n)&&(m.y<=k))
},checkAndSetHandle:function(a){this.handleId=this.calculateHandleId(a);
return(this.handleId!=null)
},calcBasicAngle:function(b,c){var a=c-b;
while(a<0){a=360-a
}a=a%360;
return a
},isDirectlyDraggable:function(b,a){return this.checkAndSetHandle(b)
},isDeferredDraggable:function(b,a){return this.isTouched(b,a)
},onRollOver:function(a){this.isRollOver=true;
this.isHandleRolledOver=this.checkAndSetHandle(a);
CQ.Log.debug("CQ.form.ImageMap.Area.onRollOver: rollover detected.");
return true
},onRolledOver:function(b){var a=this.handleId;
this.checkAndSetHandle(b);
return(a!=this.handleId)
},onRollOut:function(){this.isRollOver=false;
this.isHandleRolledOver=false;
this.handleId=null;
CQ.Log.debug("CQ.form.ImageMap.Area.onRollOut: rollout detected.");
return true
},onSelect:function(){this.isSelected=true;
return true
},onUnSelect:function(){this.isSelected=false;
return true
},onDragStart:function(b,a){this.pointToMove=this.handleId;
this.calculateDraggingReference();
return false
},calculateDestCoords:function(k,c,j,g){var b=j.x+k;
var a=j.y+c;
if(g){if(b<0){b=0
}if(b>=g.width){b=g.width-1
}if(a<0){a=0
}if(a>=g.height){a=g.height-1
}}return{x:b,y:a}
},isValid:function(a){return false
},calculateHandleId:function(a){return null
},calculateDraggingReference:function(){},rotateBy:function(b,c,a){},getColor:function(){var a=this.basicShapeColor;
if(this.isSelected){a=this.selectedColor
}else{if(this.isRollOver){a=this.rolloverColor
}}return a
},drawHandle:function(a,n,g,c,b){var k=a-this.handleSize;
var j=n-this.handleSize;
var m=this.handleSize*2;
b.lineWidth=1;
b.strokeStyle=this.shadowColor;
b.strokeRect(k+1,j+1,m,m);
if(c){b.strokeStyle=this.handleSelectedColor
}else{if(g){b.strokeStyle=this.handleRolloverColor
}else{b.strokeStyle=this.handleColor
}}b.strokeRect(k,j,m,m)
}});
CQ.form.ImageMap.RectArea=CQ.Ext.extend(CQ.form.ImageMap.Area,{constructor:function(b,j,g,a,c){CQ.form.ImageMap.RectArea.superclass.constructor.call(this,CQ.form.ImageMap.AREATYPE_RECT,b);
this.top=j;
this.left=g;
this.bottom=a;
this.right=c
},isTouched:function(o,k){var j=this.calculateHandleId(o);
if(j!=null){return true
}o=o.unzoomedUnclipped;
var n=this.top-k;
var m=this.top+k;
if((o.y>=n)&&(o.y<=m)){if((o.x>=this.left)&&(o.x<=this.right)){return true
}}var g=this.bottom-k;
var b=this.bottom+k;
if((o.y>=g)&&(o.y<=b)){if((o.x>=this.left)&&(o.x<=this.right)){return true
}}var r=this.left-k;
var q=this.left+k;
if((o.x>=r)&&(o.x<=q)){if((o.y>=this.top)&&(o.y<=this.bottom)){return true
}}var c=this.right-k;
var a=this.right+k;
if((o.x>=c)&&(o.x<=a)){if((o.y>=this.top)&&(o.y<=this.bottom)){return true
}}return false
},calculateDraggingReference:function(){if((this.pointToMove=="topleft")||(this.pointToMove==null)){this.draggingReference={x:this.left,y:this.top}
}else{if(this.pointToMove=="topright"){this.draggingReference={x:this.right,y:this.top}
}else{if(this.pointToMove=="bottomleft"){this.draggingReference={x:this.left,y:this.bottom}
}else{if(this.pointToMove=="bottomright"){this.draggingReference={x:this.right,y:this.bottom}
}}}}},moveShapeBy:function(m,b,k){var j=k.unzoomed.rotatedImageSize;
var g=this.calculateDestCoords(m,b,this.draggingReference,j);
if(this.pointToMove==null){var c=this.right-this.left;
this.left=g.x;
this.right=this.left+c;
var a=this.bottom-this.top;
this.top=g.y;
this.bottom=this.top+a;
if(this.right>=j.width){var n=this.right-j.width+1;
this.left-=n;
this.right-=n
}if(this.bottom>=j.height){n=this.bottom-j.height+1;
this.top-=n;
this.bottom-=n
}}else{if(this.pointToMove=="topleft"){this.left=g.x;
this.top=g.y
}else{if(this.pointToMove=="topright"){this.right=g.x;
this.top=g.y
}else{if(this.pointToMove=="bottomleft"){this.left=g.x;
this.bottom=g.y
}else{if(this.pointToMove=="bottomright"){this.right=g.x;
this.bottom=g.y
}}}}}return true
},onDragEnd:function(){var a;
if(this.top>this.bottom){a=this.top;
this.top=this.bottom;
this.bottom=a
}if(this.left>this.right){a=this.left;
this.left=this.right;
this.right=a
}},calculateHandleId:function(a){if(this.isPartOfHandle(this.left,this.top,a)){return"topleft"
}if(this.isPartOfHandle(this.right,this.top,a)){return"topright"
}if(this.isPartOfHandle(this.left,this.bottom,a)){return"bottomleft"
}if(this.isPartOfHandle(this.right,this.bottom,a)){return"bottomright"
}return null
},isValid:function(){return(this.top!=this.bottom)&&(this.left!=this.right)
},rotateBy:function(g,a,k){var b;
var n;
var o=this.calcBasicAngle(g,a);
var j=((o==90)||(o==270)?k.width:k.height);
var m=Math.round(g/90);
for(var c=0;
c<m;
c++){b=this.top;
n=this.bottom;
this.top=this.left;
this.bottom=this.right;
this.right=j-b;
this.left=j-n
}},onAddForDrag:function(a){this.handleId="bottomright"
},draw:function(q,o,g){CQ.Log.debug("CQ.form.ImageMap.RectArea#draw: Started.");
var a=this.right-this.left;
var m=this.bottom-this.top;
var c=this.left;
var j=this.top;
if(a<0){a=-a;
c=this.right
}else{if(a==0){a=1
}}if(m<0){m=-m;
j=this.bottom
}else{if(m==0){m=1
}}var k=this.calculateDisplayCoords(o,g,c,j);
var r=this.calculateDisplaySize(o,a,m);
var n={x:k.x+r.width,y:k.y+r.height};
if(this.fillColor){q.fillStyle=this.fillColor;
q.fillRect(k.x,k.y,r.width,r.height)
}var b=(this.isRollOver);
if(b){this.drawHandle(k.x,k.y,(this.handleId=="topleft"),false,q);
this.drawHandle(n.x,k.y,(this.handleId=="topright"),false,q);
this.drawHandle(k.x,n.y,(this.handleId=="bottomleft"),false,q);
this.drawHandle(n.x,n.y,(this.handleId=="bottomright"),false,q)
}q.strokeStyle=this.getColor();
q.lineWidth=1;
q.strokeRect(k.x,k.y,r.width,r.height);
CQ.Log.debug("CQ.form.ImageMap.RectArea#draw: Finished.")
},serialize:function(){return"rect("+this.left+","+this.top+","+this.right+","+this.bottom+")"+this.destination.serialize()
},toCoordString:function(){return"("+this.left+"/"+this.top+") ("+this.right+"/"+this.bottom+")"
},fromCoordString:function(k){var g=CQ.form.ImageMap.Helpers.parseCoordinateString(k);
if(g==null){return false
}var m=g.coordinates;
if((m.length!=2)||(g.coordinatesPairCnt!=2)){return false
}var b=m[0].x;
var j=m[0].y;
var a=m[1].x;
var c=m[1].y;
if(b==a){return false
}if(j==c){return false
}if(b<a){this.left=b;
this.right=a
}else{this.left=a;
this.right=b
}if(j<c){this.top=j;
this.bottom=c
}else{this.top=c;
this.bottom=j
}return true
}});
CQ.form.ImageMap.RectArea.isStringRepresentation=function(g){var b=g.length;
if(b<13){return false
}var a=g.indexOf("(");
if(a<=0){return false
}var c=g.substring(0,a);
if(c!="rect"){return false
}if(!g.charAt(b)==")"){return false
}return true
};
CQ.form.ImageMap.RectArea.deserialize=function(c){var n=c.indexOf("(");
if(n<0){return null
}var j=c.indexOf(")",n+1);
if(j<0){return null
}var a=c.substring(n+1,j);
var m;
var o=a.split(",");
if(o.length!=4){return null
}var b=new Array();
var k=o.length;
for(m=0;
m<k;
m++){var g=parseInt(o[m]);
if(isNaN(g)){return null
}b[m]=g
}return new CQ.form.ImageMap.RectArea({},b[1],b[0],b[3],b[2])
};
CQ.form.ImageMap.CircularArea=CQ.Ext.extend(CQ.form.ImageMap.Area,{constructor:function(c,b,g,a){CQ.form.ImageMap.RectArea.superclass.constructor.call(this,CQ.form.ImageMap.AREATYPE_CIRCLE,c);
this.x=b;
this.y=g;
this.radius=a;
this.handlePosition={x:b+a,y:g}
},isTouched:function(c,b){var a=this.calculateHandleId(c);
if(a!=null){return true
}c=c.unzoomedUnclipped;
var g=CQ.form.ImageMap.Helpers.calculateDistanceToCircle(this,c);
return(g<=b)
},calculateDraggingReference:function(){if(this.pointToMove==null){this.draggingReference={x:this.x,y:this.y}
}else{this.draggingReference={x:this.pointToMove.x,y:this.pointToMove.y}
}},moveShapeBy:function(q,n,u){var r=u.unzoomed.rotatedImageSize;
var a=this.calculateDestCoords(q,n,this.draggingReference,r);
if(this.pointToMove==null){var c=this.handlePosition.x-this.x;
var b=this.handlePosition.y-this.y;
this.x=a.x;
this.y=a.y;
if(this.x<this.radius){this.x=this.radius
}if(this.y<this.radius){this.y=this.radius
}if(this.x>=(r.width-this.radius)){this.x=r.width-this.radius-1
}if(this.y>=(r.height-this.radius)){this.y=r.height-this.radius-1
}this.handlePosition.x=this.x+c;
this.handlePosition.y=this.y+b
}else{this.pointToMove.x=a.x;
this.pointToMove.y=a.y;
var m=this.pointToMove.x-this.x;
var t=this.pointToMove.y-this.y;
this.radius=Math.sqrt((m*m)+(t*t));
var g=null;
if(m!=0){g=Math.atan(t/m)
}var o=false;
if((this.x-this.radius)<0){this.radius=this.x;
o=true
}if((this.x+this.radius)>=r.width){this.radius=r.width-this.x-1;
o=true
}if((this.y-this.radius)<0){this.radius=this.y;
o=true
}if((this.y+this.radius)>=r.height){this.radius=r.height-this.y-1;
o=true
}if(o){if(g!=null){var k=this.radius*Math.cos(g);
var j=this.radius*Math.sin(g);
if(m<0){k=-k;
j=-j
}this.pointToMove.x=this.x+k;
this.pointToMove.y=this.y+j
}else{this.pointToMove.x=this.x;
if(t<0){this.pointToMove.y=this.y-this.radius
}else{this.pointToMove.y=this.y+this.radius
}}}}return true
},calculateHandleId:function(a){if(this.isPartOfHandle(this.handlePosition.x,this.handlePosition.y,a)){return this.handlePosition
}return null
},isValid:function(){return(this.radius>0)
},rotateBy:function(m,n,j){var k=this.calcBasicAngle(m,n);
var g=((k==90)||(k==270)?j.width:j.height);
var a=Math.round(m/90);
var b;
for(var c=0;
c<a;
c++){b=this.x;
this.x=g-this.y;
this.y=b;
b=this.handlePosition.x;
this.handlePosition.x=g-this.handlePosition.y;
this.handlePosition.y=b
}},onAddForDrag:function(a){this.handleId=this.handlePosition
},draw:function(c,m,k){CQ.Log.debug("CQ.form.ImageMap.CircularArea#paint: Started.");
var n=this.calculateDisplayCoords(m,k,this.x,this.y);
var j=this.calculateDisplaySize(m,this.radius,0).width;
if(this.fillColor){c.fillStyle=this.fillColor;
c.beginPath();
c.arc(n.x,n.y,j,0,2*Math.PI,false);
c.closePath();
c.fill()
}c.lineWidth=1;
c.strokeStyle=this.getColor();
c.beginPath();
c.arc(n.x,n.y,j,0,2*Math.PI,false);
c.closePath();
c.stroke();
var b=(this.isRollOver);
if(b){var g=(this.handleId!=null);
var a=this.calculateDisplayCoords(m,k,this.handlePosition);
this.drawHandle(a.x,a.y,g,false,c)
}CQ.Log.debug("CQ.form.ImageMap.CircularArea#paint: Finished.")
},serialize:function(){return"circle("+this.x+","+this.y+","+Math.round(this.radius)+")"+this.destination.serialize()
},toCoordString:function(){return"("+this.x+"/"+this.y+") r:"+Math.round(this.radius)
},fromCoordString:function(b){var m=CQ.form.ImageMap.Helpers.parseCoordinateString(b);
if(m==null){return false
}var o=m.coordinates;
if((o.length!=2)||(m.coordinatesPairCnt!=1)){return false
}var k,q,n;
if(o[0].radius){k=o[0].radius;
q=o[1].x;
n=o[1].y
}else{k=o[1].radius;
q=o[0].x;
n=o[0].y
}var a,r;
var j=this.handlePosition.x-this.x;
var g=this.handlePosition.y-this.y;
if(j!=0){var c=Math.atan(g/j);
a=Math.cos(c)*k;
r=Math.sin(c)*k;
if(j<0){a=-a;
r=-r
}this.handlePosition.x=a+q;
this.handlePosition.y=r+n
}else{this.handlePosition.x=q;
r=(this.handlePosition.y<this.y?-k:k);
this.handlePosition.y=r+n
}this.x=q;
this.y=n;
this.radius=k;
return true
}});
CQ.form.ImageMap.CircularArea.isStringRepresentation=function(g){var b=g.length;
if(b<13){return false
}var a=g.indexOf("(");
if(a<=0){return false
}var c=g.substring(0,a);
if(c!="circle"){return false
}if(!g.charAt(b)==")"){return false
}return true
};
CQ.form.ImageMap.CircularArea.deserialize=function(c){var n=c.indexOf("(");
if(n<0){return null
}var j=c.indexOf(")",n+1);
if(j<0){return null
}var a=c.substring(n+1,j);
var m;
var o=a.split(",");
if(o.length!=3){return null
}var b=new Array();
var k=o.length;
for(m=0;
m<k;
m++){var g=parseInt(o[m]);
if(isNaN(g)){return null
}b[m]=g
}return new CQ.form.ImageMap.CircularArea({},b[0],b[1],b[2])
};
CQ.form.ImageMap.PolyArea=CQ.Ext.extend(CQ.form.ImageMap.Area,{constructor:function(b,a,c){CQ.form.ImageMap.RectArea.superclass.constructor.call(this,CQ.form.ImageMap.AREATYPE_POLYGON,b);
this.areaType=CQ.form.ImageMap.AREATYPE_POLYGON;
this.destination=new CQ.form.ImageMap.AreaDestination();
this.points=new Array();
this.points.push({x:a,y:c})
},addPoint:function(a,c){var b={x:a,y:c};
this.points.push(b);
return b
},insertPoint:function(b,m,c){var g={x:b,y:m};
var j=this.points.length;
var a=this.calculatePointInsertIndex(b,m,c);
if(a<0){return null
}if(a<j){for(var k=j;
k>a;
k--){this.points[k]=this.points[k-1]
}}this.points[a]=g;
return g
},removePoint:function(c){var g=this.points.length;
var b=false;
var a,j;
for(a=0;
a<g;
a++){j=this.points[a];
if(j==c){this.points[a]=null;
if(this.handleId==j){this.handleId=null
}if(this.selectedHandle==j){this.selectedHandle=null
}b=true;
break
}}if(!b){for(a=0;
a<g;
a++){j=this.points[a];
if((j.x==c.x)&&(j.y==c.y)){this.points[a]=null;
if(this.handleId==j){this.handleId=null
}if(this.selectedHandle==j){this.selectedHandle=null
}break
}}}CQ.form.ImageMap.Helpers.compactArray(this.points)
},isOnLine:function(b,c,g,a){var j=CQ.form.ImageMap.Helpers.calculateDistance(c,g,b);
return(j<=a)
},calcBoundingRect:function(){if(this.points.length==0){return null
}var a=this.points[0].x;
var n=this.points[0].y;
var k=a;
var g=n;
var j=this.points.length;
for(var c=0;
c<j;
c++){var m=this.points[c];
if(m.x<a){a=m.x
}else{if(m.x>k){k=m.x
}}if(m.y<n){n=m.y
}else{if(m.y>g){g=m.y
}}}var b=new Object();
b.top=n;
b.left=a;
b.bottom=g;
b.right=k;
return b
},calculatePointInsertIndex:function(k,g,c){var m=this.points.length;
if(m==1){return 1
}var a=new Object();
a.x=k;
a.y=g;
for(var j=1;
j<m;
j++){var o=this.points[j-1];
var n=this.points[j];
if(this.isOnLine(a,o,n,c)){return j
}}var b=this.isOnLine(a,this.points[0],this.points[m-1],c);
if(b){return m
}return -1
},cleanUp:function(){var c=this.points.length;
for(var a=0;
a<(c-1);
a++){var g=this.points[a];
var b=this.points[a+1];
if((g.x==b.x)&&(g.y==b.y)){this.points[a]=null;
CQ.Log.info("CQ.form.ImageMap.PolyArea#cleanUp: Polygon point with identical coordinates removed: "+g.x+"/"+g.y)
}}CQ.form.ImageMap.Helpers.compactArray(this.points)
},isTouched:function(k,g){var a=this.calculateHandleId(k);
if(a!=null){return true
}var n=this.points.length;
k=k.unzoomedUnclipped;
if(n==1){var b=Math.abs(this.points[0].x-k.x);
var j=Math.abs(this.points[0].y-k.y);
return(b<g)&&(j<g)
}else{var c;
for(var m=1;
m<n;
m++){var q=this.points[m-1];
var o=this.points[m];
c=this.isOnLine(k,q,o,g);
if(c){return true
}}return this.isOnLine(k,this.points[0],this.points[n-1],g)
}},calculateDraggingReference:function(){if(this.pointToMove==null){var a=this.calcBoundingRect();
this.draggingReference={x:a.left,y:a.top,width:a.right-a.left+1,height:a.bottom-a.top+1}
}else{this.draggingReference={x:this.pointToMove.x,y:this.pointToMove.y}
}},moveShapeBy:function(k,j,r){var n=r.unzoomed.rotatedImageSize;
var a=this.calculateDestCoords(k,j,this.draggingReference,n);
var t=a.x;
var o=a.y;
if(this.pointToMove==null){var w=t+this.draggingReference.width;
if(w>=n.width){t=n.width-this.draggingReference.width
}var v=o+this.draggingReference.height;
if(v>=n.height){o=n.height-this.draggingReference.height
}var g=this.calcBoundingRect();
var c=t-g.left;
var b=o-g.top;
var u=this.points.length;
for(var q=0;
q<u;
q++){var m=this.points[q];
m.x+=c;
m.y+=b
}}else{this.pointToMove.x=t;
this.pointToMove.y=o
}return true
},calculateHandleId:function(a,j){var c=this.points.length;
for(var b=0;
b<c;
b++){var g=this.points[b];
if(this.isPartOfHandle(g.x,g.y,a,j)){return g
}}return null
},onUnSelect:function(){this.selectedHandle=null;
CQ.form.ImageMap.PolyArea.superclass.onUnSelect.call(this);
return true
},isValid:function(){return(this.points.length>0)
},rotateBy:function(g,a,m){var r=this.calcBasicAngle(g,a);
var j=((r==90)||(r==270)?m.width:m.height);
var n=Math.round(g/90);
var k;
for(var b=0;
b<n;
b++){var q=this.points.length;
for(var o=0;
o<q;
o++){var c=this.points[o];
k=c.x;
c.x=j-c.y;
c.y=k
}}},onAddForDrag:function(a){this.handleId=this.points[0]
},onDragStart:function(){this.selectedHandle=this.handleId;
CQ.form.ImageMap.PolyArea.superclass.onDragStart.call(this);
return true
},selectPointAt:function(a){if((a>=0)&&(a<this.points.length)){this.selectedHandle=this.points[a]
}else{this.selectedHandle=null
}},selectPoint:function(a){if(a==null){this.selectedHandle=null
}else{var c=this.points.length;
for(var b=0;
b<c;
b++){var g=this.points[b];
if((g.x==a.x)&&(g.y==a.y)){this.selectedHandle=g;
return
}}}},draw:function(t,r,j){CQ.Log.debug("CQ.form.ImageMap.PolyArea#paint: Started.");
var m,a;
var n=this.points.length;
var o=this.calculateDisplayCoords(r,j,this.points[0]);
if(this.fillColor){t.fillStyle=this.fillColor;
t.beginPath();
t.moveTo(o.x,o.y);
for(m=0;
m<n;
m++){a=this.calculateDisplayCoords(r,j,this.points[m]);
t.lineTo(a.x,a.y)
}t.closePath();
t.fill()
}t.lineWidth=1;
t.strokeStyle=this.getColor();
t.beginPath();
t.moveTo(o.x,o.y);
for(m=1;
m<n;
m++){a=this.calculateDisplayCoords(r,j,this.points[m]);
t.lineTo(a.x,a.y)
}t.closePath();
t.stroke();
var c=this.isRollOver||(this.selectedHandle!=null)||this.isSelected;
var k=(this.selectedHandle==this.points[0]);
var g=(this.handleId==this.points[0]);
if(c||k){this.drawHandle(o.x,o.y,g,k,t)
}for(m=1;
m<n;
m++){a=this.calculateDisplayCoords(r,j,this.points[m]);
var b=(this.selectedHandle==this.points[m]);
var q=(this.handleId==this.points[m]);
if(c||b){this.drawHandle(a.x,a.y,q,b,t)
}}CQ.Log.debug("CQ.form.ImageMap.PolyArea#paint: Finished.")
},serialize:function(){var g="poly(";
var c=this.points.length;
for(var b=0;
b<c;
b++){if(b>0){g+=","
}var a=this.points[b];
g+=a.x+","+a.y
}g+=")";
g+=this.destination.serialize();
return g
},toCoordString:function(){var b="";
var g=this.points.length;
for(var a=0;
a<g;
a++){if(a>0){b+=" "
}var c=this.points[a];
b+="("+c.x+"/"+c.y+")"
}return b
},fromCoordString:function(g){var b=CQ.form.ImageMap.Helpers.parseCoordinateString(g);
if(b==null){return false
}var j=b.coordinates;
if((j.length<2)||(b.coordinatesPairCnt!=j.length)){return false
}this.points.length=0;
var k=j.length;
for(var c=0;
c<k;
c++){var a=j[c];
this.addPoint(a.x,a.y)
}return true
}});
CQ.form.ImageMap.PolyArea.isStringRepresentation=function(g){var b=g.length;
if(b<9){return false
}var a=g.indexOf("(");
if(a<=0){return false
}var c=g.substring(0,a);
if(c!="poly"){return false
}if(!g.charAt(b)==")"){return false
}return true
};
CQ.form.ImageMap.PolyArea.deserialize=function(c){var m=c.indexOf("(");
if(m<0){return null
}var j=c.indexOf(")",m+1);
if(j<0){return null
}var a=c.substring(m+1,j);
var r=a.split(",");
var b=new Array();
var o;
var q=r.length;
if((q&1)!=0){return null
}for(o=0;
o<q;
o+=2){var n=parseInt(r[o]);
var k=parseInt(r[o+1]);
if(isNaN(n)){return null
}if(isNaN(k)){return null
}b[o/2]={x:n,y:k}
}q=b.length;
var g=new CQ.form.ImageMap.PolyArea({},b[0].x,b[0].y);
for(o=1;
o<q;
o++){g.addPoint(b[o].x,b[o].y)
}return g
};
CQ.form.ImageCrop=CQ.Ext.extend(CQ.form.SmartImage.Tool,{cropRect:null,cropRectDef:null,aspectRatioDef:null,discardCropValue:false,destroy:function(){CQ.Ext.destroy(this.userInterface)
},constructor:function(a){var b=(typeof a.disableCropClear==="undefined"?true:a.disableCropClear);
CQ.form.ImageCrop.superclass.constructor.call(this,{toolId:"smartimageCrop",toolName:CQ.I18n.getMessage("Crop"),iconCls:"cq-image-icon-crop",isCommandTool:false,userInterface:new CQ.form.ImageCrop.UI({title:CQ.I18n.getMessage("Image crop tools"),disableCropClear:b}),transferFieldName:a.cropParameter,cropMinWidth:32,cropMinHeight:32});
this.cropRectDef=null;
this.aspectRatioDef=null
},initialize:function(a){if(a.cropConfig){this.aspectRatios=a.cropConfig.aspectRatios
}this.userInterface.updateAspectRatios(this.aspectRatios)
},initComponent:function(a){CQ.form.ImageMap.superclass.initComponent.call(this,a);
this.workingArea=this.imageComponent.getImagePanel();
this.workingArea.on("contentchange",this.onContentChange,this);
this.workingArea.on("cropClear",this.onCropClear,this);
this.workingArea.on("dragchange",function(b){var g=(b.length==1)&&(b[0]==this.cropRect);
if(g){this.imageComponent.invalidateProcessedImages();
var c={changeType:"crop",newValue:{x:this.cropRect.x,y:this.cropRect.y,width:this.cropRect.width,height:this.cropRect.height}};
this.workingArea.fireEvent("contentchange",c);
this.workingArea.fireEvent("smartimage.contentchange",c)
}},this)
},onActivation:function(){CQ.form.ImageCrop.superclass.onActivation.call(this);
this.workingArea.hideAllShapeSets(false);
if(!this.isInitialized){this.cropShapeSet=new CQ.form.SmartImage.ShapeSet(CQ.form.ImageCrop.SHAPESET_ID);
this.workingArea.addShapeSet(this.cropShapeSet);
this.isInitialized=true
}if(this.initialValue!=null){this.deserialize(this.initialValue);
this.initialValue=null
}var a=this.imageComponent.getSuitableImage(true);
if(a){this.workingArea.ignoreRotation=true;
this.workingArea.updateImage(a);
this.initializeEdit();
this.imageComponent.resetZoomSlider()
}this.userInterface.isActive=true;
this.workingArea.setShapeSetVisible(CQ.form.ImageCrop.SHAPESET_ID,true,true)
},initializeEdit:function(){var a=false;
if(this.cropRect==null){a=true;
this.cropRect=new CQ.form.ImageCrop.CropRect({cropMinWidth:this.cropMinWidth,cropMinHeight:this.cropMinHeight},null,null,null,null);
this.userInterface.notifyWorkingArea(this.workingArea,this.cropRect)
}if(this.cropRectDef!=null){this.cropRect.x=this.cropRectDef.x;
this.cropRect.y=this.cropRectDef.y;
this.cropRect.width=this.cropRectDef.width;
this.cropRect.height=this.cropRectDef.height
}else{this.cropRect.x=0;
this.cropRect.y=0;
this.userInterface.calculateInitialCropSize()
}this.userInterface.setAspectRatioUI(this.aspectRatioDef);
if(a){this.cropShapeSet.addShape(this.cropRect)
}else{this.workingArea.drawImage()
}},onDeactivation:function(){this.userInterface.isActive=false;
this.workingArea.setShapeSetVisible(CQ.form.ImageCrop.SHAPESET_ID,false,false);
var a=this.imageComponent.getSuitableImage();
if(a){this.workingArea.ignoreRotation=false;
this.workingArea.updateImage(a);
this.imageComponent.resetZoomSlider()
}CQ.form.ImageCrop.superclass.onDeactivation.call(this)
},clearCroppingInformation:function(){this.cropRectDef=null;
this.initialValue=null
},resetAspectRatio:function(){this.aspectRatioDef=null;
this.userInterface.setAspectRatioUI(null)
},onImageUploaded:function(){this.clearCroppingInformation();
this.resetAspectRatio();
CQ.form.ImageCrop.superclass.onImageUploaded.call(this)
},onImageFlushed:function(){this.clearCroppingInformation();
this.resetAspectRatio();
CQ.form.ImageCrop.superclass.onImageFlushed.call(this)
},onContentChange:function(a){if(a.changeType=="rotate"){}else{if(a.changeType=="crop"){this.discardCropValue=false
}}},onCropClear:function(){var a={_charset_:"utf-8"};
a[this.transferFieldName+"@Delete"]="";
CQ.Ext.Ajax.request({url:CQ.Util.getPath()+"/_jcr_content",method:"post",params:a,success:function(b,c){this.cropRect=null;
this.cropShapeSet.removeAllShapes();
this.clearCroppingInformation();
this.initializeEdit();
this.discardCropValue=true
},scope:this,failure:function(b,c){CQ.Ext.Msg.show({title:CQ.I18n.getMessage("Clear Crop Failed"),msg:CQ.I18n.getMessage("The removal of the crop value failed."),buttons:CQ.Ext.Msg.OK,icon:CQ.Ext.Msg.ERROR})
},scope:this})
},serialize:function(){if(!this.isInitialized||this.discardCropValue){return null
}var a="";
var b=this.userInterface.aspectRatio;
if((b!=null)&&(b!="0,0")){a="/"+b
}if(this.cropRect==null){return a
}return this.cropRect.x+","+this.cropRect.y+","+(this.cropRect.x+this.cropRect.width)+","+(this.cropRect.y+this.cropRect.height)+a
},deserialize:function(k){this.cropRectDef=null;
this.aspectRatioDef=null;
if((k==null)||(k.length==0)){return
}this.discardCropValue=false;
var c=null;
var b=k.indexOf("/");
if((b>=0)&&(k.length>(b+1))){c=k.substring(b+1,k.length);
k=k.substring(0,b)
}this.aspectRatioDef=c;
var g=k.split(",");
if(g.length==4){var a=parseInt(g[0]);
var j=parseInt(g[1]);
this.cropRectDef={x:a,y:j,width:parseInt(g[2])-a,height:parseInt(g[3])-j}
}}});
CQ.form.ImageCrop.SHAPESET_ID="smartimage.imagecrop";
CQ.form.ImageCrop.UI=CQ.Ext.extend(CQ.form.SmartImage.Tool.UserInterface,{isActive:false,workingArea:null,cropMinWidth:0,cropMinHeight:0,aspectRatio:null,constructor:function(b){this.aspectRatioText=CQ.I18n.getMessage("Aspect ratio");
this.aspectRatioMenu=new CQ.Ext.menu.Menu({items:[]});
var a=[{itemId:"ratio",text:this.aspectRatioText,menu:this.aspectRatioMenu}];
if(b.disableCropClear===false){var c={click:{fn:this.cropClear,scope:this}};
a.push({xtype:"tbbutton",text:CQ.I18n.getMessage("Clear Crop"),iconCls:"cq-image-icon-clear",listeners:c})
}this.toolbar=new CQ.Ext.Toolbar({itemId:"toolbar",items:a});
var g={items:[this.toolbar],width:CQ.themes.SmartImage.Tool.CROP_TOOLS_WIDTH,cropMinWidth:32,cropMinHeight:32};
CQ.Util.applyDefaults(b,g);
CQ.form.ImageCrop.UI.superclass.constructor.call(this,b)
},notifyWorkingArea:function(a,b){this.workingArea=a;
this.cropRect=b;
if(this.initialRatio){var c=this.parseRatioFromString(this.initialRatio);
this.defineRatio(c[0],c[1])
}else{this.cropRect.ratio=null
}},updateAspectRatios:function(j){this.aspectRatioMenu.removeAll();
if(!j){j={freeCrop:{value:"0,0",text:CQ.I18n.getMessage("Free crop")}}
}var b=[];
var n,r;
for(var m in j){if(j.hasOwnProperty(m)){var c=j[m];
if(c.value&&c.text){var k=c.checked;
var g={text:c.text,value:c.value,checked:k,group:"aspectRatio",handler:function(u,t){if(t){this.onRatioChanged(u.value,u.text)
}}.createDelegate(this)};
if(k){r=g
}b.push(g);
if(c.value=="0,0"){n=g
}}}}if(!r&&n){n.checked=true;
r=n
}if(r){var q=r.text;
this.toolbar.items.get("ratio").setText(this.aspectRatioText+": "+q)
}var o=b.length;
for(var a=0;
a<o;
a++){this.aspectRatioMenu.addItem(new CQ.Ext.menu.CheckItem(b[a]))
}this.initialRatio=null;
if(r){this.initialRatio=r.value;
this.aspectRatio=r.value;
this.setAspectRatioUI(r.value)
}},setAspectRatioUI:function(c){if((c==null)||(c.length==0)){if(this.aspectRatioMenu.items!==null&&this.aspectRatioMenu.items.items!==null&&this.aspectRatioMenu.items.items.length>0){c=this.aspectRatioMenu.items.items[0].value
}else{c="0,0"
}}this.aspectRatio=null;
var a=this.aspectRatioMenu.items;
a.each(function(g){if(g.value==c){g.setChecked(true,true);
this.toolbar.items.get("ratio").setText(this.aspectRatioText+": "+g.text);
this.aspectRatio=c
}},this);
if(this.aspectRatio==null){this.defineRatio(0,0)
}else{var b=this.parseRatioFromString(this.aspectRatio);
this.defineRatio(b[0],b[1])
}},onRatioChanged:function(c,b){this.aspectRatio=c;
var a=this.parseRatioFromString(c);
this.changeAspectRatio(a[0],a[1]);
this.toolbar.items.get("ratio").setText(this.aspectRatioText+": "+b)
},calculateInitialCropSize:function(a){if(!a){a=this.workingArea.originalImageSize
}if(this.cropRect.ratio!=null){var b=this.applyRatio(a.width);
this.cropRect.width=b.width;
this.cropRect.height=b.height
}else{this.cropRect.width=a.width;
this.cropRect.height=a.height
}},changeAspectRatio:function(b,a){if(b!==undefined){this.xRatio=b
}if(a!==undefined){this.yRatio=a
}if((this.xRatio!=0)&&(this.yRatio!=0)){this.cropRect.ratio=this.xRatio/this.yRatio;
var c=this.applyRatio(this.cropRect.width);
this.cropRect.width=c.width;
this.cropRect.height=c.height
}else{this.cropRect.ratio=null
}this.workingArea.drawImage()
},applyRatio:function(b){var c=this.workingArea.originalImageSize;
var a=Math.round(b/this.cropRect.ratio);
if((a+this.cropRect.y)>c.height){a=c.height-this.cropRect.y;
b=Math.round(a*this.cropRect.ratio)
}return{width:b,height:a}
},defineRatio:function(a,b){this.xRatio=a;
this.yRatio=b;
this.calcCropRectRatio()
},calcCropRectRatio:function(){if(this.cropRect!=null){if((this.xRatio>0)||(this.yRatio>0)){this.cropRect.ratio=this.xRatio/this.yRatio
}else{this.cropRect.ratio=null
}}},parseRatioFromString:function(a){var b=[0,0];
var c=a.split(",");
if(c.length==2){b[0]=parseInt(c[0]);
b[1]=parseInt(c[1])
}return b
},cropClear:function(){this.workingArea.fireEvent("cropClear")
}});
CQ.form.ImageCrop.CropRect=CQ.Ext.extend(CQ.form.SmartImage.Shape,{rectColor:null,invalidPartsBackground:null,handleDistance:0,handleLength:0,handleThickness:0,cropMinWidth:0,cropMinHeight:0,ratio:null,x:0,y:0,width:0,height:0,drawSections:false,fixedCoordinates:null,constructor:function(c,b,k,g,a){var j={rectColor:CQ.themes.ImageCrop.CROP_RECT_COLOR,invalidPartsBackground:CQ.themes.ImageCrop.BACKGROUND_INVALIDPARTS,handleDistance:CQ.themes.ImageCrop.HANDLE_DISTANCE,handleLength:CQ.themes.ImageCrop.HANDLE_LENGTH,handleThickness:CQ.themes.ImageCrop.HANDLE_THICKNESS,handleRollover:CQ.themes.ImageCrop.HANDLE_ROLLOVER};
CQ.Util.applyDefaults(c,j);
CQ.Ext.apply(this,c);
CQ.form.ImageCrop.CropRect.superclass.constructor.call(this,c);
this.x=b;
this.y=k;
this.width=g;
this.height=a;
this.drawSections=false
},isTouched:function(c,b){var a=this.calculateHandleId(c);
if(a!=null){return true
}c=c.unzoomedUnclipped;
return(c.x>=this.x)&&(c.x<(this.x+this.width))&&(c.y>=this.y)&&(c.y<(this.y+this.height))
},isPartOfHandle:function(a,c,b){var g=this.calculateDistance(a,{x:c,y:b});
return g<Math.ceil(this.handleLength/(a.absoluteZoom+1))
},calculateHandleId:function(b){b=b.unzoomedUnclipped;
var a=null;
if(this.isPartOfHandle(b,this.x,this.y)){return"topleft"
}if(this.isPartOfHandle(b,this.x+this.width,this.y)){return"topright"
}if(this.isPartOfHandle(b,this.x,this.y+this.height)){return"bottomleft"
}if(this.isPartOfHandle(b,this.x+this.width,this.y+this.height)){return"bottomright"
}return a
},isDirectlyDraggable:function(b,a){return this.isTouched(b)
},moveShapeBy:function(m,j,o){var k=o.unzoomed.imageSize;
if(this.pointToMove==null){this.x=this.draggingReference.x+m;
this.y=this.draggingReference.y+j;
this.correctCoordinates(k)
}else{var a=this.draggingReference.x+m;
if(a<0){a=0
}if(a>=k.width){a=k.width-1
}var q=this.draggingReference.y+j;
if(q<0){q=0
}if(q>=k.height){q=k.height-1
}var c,n;
if(this.pointToMove=="topleft"){c=this.x-a;
this.x=a;
this.width+=c;
n=this.y-q;
this.y=q;
this.height+=n
}else{if(this.pointToMove=="topright"){this.width=a-this.x+1;
n=this.y-q;
this.y=q;
this.height+=n
}else{if(this.pointToMove=="bottomleft"){c=this.x-a;
this.x=a;
this.width+=c;
this.height=q-this.y+1
}else{if(this.pointToMove=="bottomright"){this.width=a-this.x+1;
this.height=q-this.y+1
}}}}if(this.width<this.cropMinWidth){this.width=this.cropMinWidth;
this.correctXCoord()
}if(this.height<this.cropMinHeight){this.height=this.cropMinHeight;
this.correctYCoord()
}if(this.ratio!=null){this.height=Math.round(this.width/this.ratio);
this.correctYCoord();
var g=false;
if(this.x<0){this.width+=this.x;
this.x=0;
g=true
}if(g){this.height=Math.round(this.width/this.ratio);
this.correctXCoord();
this.correctYCoord()
}var b=false;
if(this.y<0){this.height+=this.y;
this.y=0;
b=true
}if((this.y+this.height)>k.height){this.height=k.height-this.y;
b=true
}if(b){this.width=Math.round(this.height*this.ratio);
this.correctXCoord();
this.correctYCoord()
}}}return true
},correctXCoord:function(){if(this.fixedCoordinates.widthMult<0){this.x=this.fixedCoordinates.x-this.width
}},correctYCoord:function(){if(this.fixedCoordinates.heightMult<0){this.y=this.fixedCoordinates.y-this.height
}},correctCoordinates:function(b){if(this.x<0){this.x=0
}if(this.y<0){this.y=0
}var a=this.x+this.width;
var c=this.y+this.height;
if(a>b.width){this.x=b.width-this.width;
if(this.x<0){this.width+=this.x;
this.x=0
}}if(c>b.height){this.y=b.height-this.height;
if(this.y<0){this.height+=this.y;
this.y=0
}}},onRollOver:function(a){this.handleId=this.calculateHandleId(a);
return true
},onRollOut:function(a){this.handleId=null;
return true
},onRolledOver:function(b){var a=this.handleId;
this.handleId=this.calculateHandleId(b);
return(this.handleId!=a)
},onDragStart:function(b,a){this.pointToMove=this.calculateHandleId(b);
if((this.pointToMove=="topleft")||(this.pointToMove==null)){this.draggingReference={x:this.x,y:this.y};
if(this.pointToMove!=null){this.fixedCoordinates={x:this.x+this.width-1,y:this.y+this.height-1,widthMult:-1,heightMult:-1}
}}else{if(this.pointToMove=="topright"){this.draggingReference={x:this.x+this.width-1,y:this.y};
this.fixedCoordinates={x:this.x,y:this.y+this.height-1,widthMult:1,heightMult:-1}
}else{if(this.pointToMove=="bottomleft"){this.draggingReference={x:this.x,y:this.y+this.height-1};
this.fixedCoordinates={x:this.x+this.width-1,y:this.y,widthMult:-1,heightMult:1}
}else{if(this.pointToMove=="bottomright"){this.draggingReference={x:this.x+this.width-1,y:this.y+this.height-1};
this.fixedCoordinates={x:this.x,y:this.y,widthMult:1,heightMult:1}
}}}}this.drawSections=true;
return true
},onDragEnd:function(b,a){this.drawSections=false;
return true
},draw:function(w,a,o){var y=this.calculateDisplayCoords(a,o,this.x,this.y);
var v=this.calculateDisplaySize(a,this.width,this.height);
var A=y.x+v.width;
var c=y.y+v.height;
w.save();
if(this.invalidPartsBackground){w.fillStyle=this.invalidPartsBackground;
var r=o.imageSize;
var j=this.calculateDisplayCoords(a,o,0,0);
var k=this.calculateDisplayCoords(a,o,r.width,r.height);
var b=j.x;
var t=j.y;
var q=k.x;
var x=k.y;
if(y.x>0){w.fillRect(b,t,y.x-b,x-t)
}if(y.y>0){w.fillRect(y.x,t,v.width,y.y-t)
}var z=y.y+v.height;
if(z<x){w.fillRect(y.x,z,v.width,x-z)
}var g=y.x+v.width;
if(g<q){w.fillRect(g,t,q-g,x-t)
}}w.restore();
w.strokeStyle=this.rectColor;
if(this.drawSections){w.beginPath();
var m=(v.height/3);
w.moveTo(y.x,y.y+m);
w.lineTo(A,y.y+m);
w.moveTo(y.x,y.y+2*m);
w.lineTo(A,y.y+2*m);
var n=(v.width/3);
w.moveTo(y.x+n,y.y);
w.lineTo(y.x+n,c);
w.moveTo(y.x+2*n,y.y);
w.lineTo(y.x+2*n,c);
w.stroke()
}w.lineWidth=1;
w.strokeRect(y.x,y.y,v.width,v.height);
w.lineWidth=this.handleThickness;
var u=this.handleLength-this.handleDistance;
w.beginPath();
w.strokeStyle=(this.handleId=="topleft"?this.handleRollover:this.rectColor);
w.moveTo(y.x-this.handleDistance,y.y+u);
w.lineTo(y.x-this.handleDistance,y.y-this.handleDistance);
w.lineTo(y.x+u,y.y-this.handleDistance);
w.stroke();
w.beginPath();
w.strokeStyle=(this.handleId=="topright"?this.handleRollover:this.rectColor);
w.moveTo(A+this.handleDistance,y.y+u);
w.lineTo(A+this.handleDistance,y.y-this.handleDistance);
w.lineTo(A-u,y.y-this.handleDistance);
w.stroke();
w.beginPath();
w.strokeStyle=(this.handleId=="bottomleft"?this.handleRollover:this.rectColor);
w.moveTo(y.x-this.handleDistance,c-u);
w.lineTo(y.x-this.handleDistance,c+this.handleDistance);
w.lineTo(y.x+u,c+this.handleDistance);
w.stroke();
w.beginPath();
w.strokeStyle=(this.handleId=="bottomright"?this.handleRollover:this.rectColor);
w.moveTo(A+this.handleDistance,c-u);
w.lineTo(A+this.handleDistance,c+this.handleDistance);
w.lineTo(A-u,c+this.handleDistance);
w.stroke()
}});
CQ.form.Slideshow=CQ.Ext.extend(CQ.form.SmartImage,{fileReferencePrefix:null,headPanel:null,slides:null,editedSlide:null,activeTabToPreselect:null,name:"",constructor:function(a){a=a||{};
var b={headPanel:new CQ.form.Slideshow.SlidesPanel({onSlideChanged:this.onSlideChanged.createDelegate(this),onAddButton:this.onAddButton.createDelegate(this),onRemoveButton:this.onRemoveButton.createDelegate(this)}),footPanel:new CQ.form.Slideshow.TitlePanel({}),fileReferencePrefix:"./image$",hideMainToolbar:true,allowReference:true,allowUpload:false};
CQ.Util.applyDefaults(a,b);
CQ.form.Slideshow.superclass.constructor.call(this,a);
this.slides=[]
},initComponent:function(){CQ.form.Slideshow.superclass.initComponent.call(this)
},afterRender:function(){CQ.form.Slideshow.superclass.afterRender.call(this);
if(this.fixedHeight==null){if(CQ.Ext.isIE){var a=this.findParentByType("dialog");
a.on("beforehide",function(){var c=this.ownerCt;
var b=this;
while(c&&!c.isXType("tabpanel")){b=c;
c=c.ownerCt
}if(c){this.activeTabToPreselect=c.getActiveTab();
c.setActiveTab(b)
}},this)
}}},createFileNameEditingCapability:function(){},createHiddenInterfaceFields:function(){this.lastModifiedParameter=new CQ.Ext.form.Hidden({disabled:true,value:""});
this.containerPanel.add(this.lastModifiedParameter);
this.lastModifiedByParameter=new CQ.Ext.form.Hidden({disabled:true,value:""});
this.containerPanel.add(this.lastModifiedByParameter)
},createInterface:function(j){this.headPanel.disableFormElements();
this.footPanel.disableFormElements();
if(!this.interfaceFields){this.interfaceFields=[]
}else{this.interfaceFields.length=0
}var m=this.getToplevel();
var a=(m.getXType()=="dialog"?m.form:(m.getXType()=="form"?m.getForm():null));
var b=this.slides.length;
for(var n=0;
n<b;
n++){var g=this.slides[n];
var k=g.createTransferFields(this.fileReferencePrefix);
var c=k.length;
for(var q=0;
q<c;
q++){var o=k[q];
o.render(j);
this.interfaceFields.push(o);
if(a){a.add(o)
}}}},removeOldInterface:function(){if(this.interfaceFields){var a=this.getToplevel();
var g=(a.getXType()=="dialog"?a.form:(a.getXType()=="form"?a.getForm():null));
var b=this.interfaceFields.length;
for(var c=0;
c<b;
c++){var j=this.interfaceFields[c];
if(g){g.remove(j)
}j.getEl().remove()
}this.interfaceFields.length=0
}},onBeforeSubmit:function(){this.saveChanges();
this.removeOldInterface();
this.createInterface(this.el);
return true
},createSlideIndex:function(){var b;
var j=this.slides.length;
var k=0;
for(var g=0;
g<j;
g++){b=this.slides[g];
if(!b.isDeleted&&(b.slideIndex>k)){k=this.slides[g].slideIndex
}}for(var m=1;
m<=k;
m++){var a=false;
for(var c=0;
c<j;
c++){b=this.slides[c];
if(!b.isDeleted&&(b.slideIndex==m)){a=true;
break
}}if(!a){return m
}}return k+1
},getFirstSlide:function(){var b=this.slides.length;
for(var c=0;
c<b;
c++){var a=this.slides[c];
if(!a.isDeleted){return a
}}return null
},addNewSlide:function(){this.saveChanges();
var b=this.createSlideIndex();
var a=this.createSlide(null,b,this.dataPath);
this.showSlide(a);
this.editedSlide=a
},removeSlide:function(){if(this.editedSlide){this.editedSlide.isDeleted=true;
var a=this.getFirstSlide();
if(!a){this.addNewSlide()
}else{this.editedSlide=a;
this.showSlide(this.editedSlide)
}}},createSlide:function(g,j,m){var k=(g?g["jcr:title"]:null);
var c=(g?g.fileReference:null);
var a;
if(g&&c){var b=this.resolveReference(c,m);
if(b){a=new CQ.form.Slideshow.Slide({referencedFileInfo:b,title:k,slideIndex:j,isPersistent:true,isDeleted:false})
}}else{a=new CQ.form.Slideshow.Slide({referencedFileInfo:null,title:null,slideIndex:j,isPersistent:false,isDeleted:false})
}this.slides.push(a);
return a
},processRecord:function(m,u){if(this.fireEvent("beforeloadcontent",this,m,u)!==false){this.dataPath=u;
this.slides.length=0;
this.headPanel.enableFormElements();
this.footPanel.enableFormElements();
CQ.form.Slideshow.superclass.processPath.call(this,u);
var n=this.fileReferencePrefix.replace("./","");
var q=n.indexOf("$");
var g=n.length;
var c=n;
var b=null;
var t=(q>=0);
if(q==0){c=null;
b=n.substring(1,g)
}else{if(q>0){if(q<(g-1)){c=n.substring(0,q);
b=n.substring(q+1,g)
}else{c=n.substring(0,q);
b=null
}}}var k=m.data;
for(var r in k){if(t){var o=true;
var j;
var a=r.length;
if(c!=null){if(r.indexOf(c)==0){j=c.length
}else{o=false
}}if((b!=null)&&o){a=r.indexOf(b,j);
if(a>j){if((a+b.length)<r.length){o=false
}}else{o=false
}}if(o){this.createSlide(m.get(r),r.substring(j,a),u)
}}else{if(r==c){this.createSlide(m.get(r),1,u)
}}}this.editedSlide=this.getFirstSlide();
if(!this.editedSlide){this.addNewSlide()
}this.showSlide(this.editedSlide);
this.buildComboBoxContent();
this.fireEvent("loadcontent",this,m,u)
}},saveChanges:function(){if(this.editedSlide){var a=this.footPanel.getTitle();
this.editedSlide.referencedFileInfo=this.referencedFileInfo;
this.editedSlide.title=(a?a:null);
this.headPanel.updateSlide(this.editedSlide)
}},buildComboBoxContent:function(){var c=[];
for(var b=0;
b<this.slides.length;
b++){var a=this.slides[b];
if(!a.isDeleted){c.push({value:a,text:a.createDisplayText()})
}}this.headPanel.setInitialComboBoxContent(c);
this.headPanel.select(this.editedSlide)
},showSlide:function(a){this.referencedFileInfo=a.referencedFileInfo;
this.footPanel.setTitle(a.title);
if(this.referencedFileInfo){this.originalRefImage=new CQ.form.SmartImage.Image(this.referencedFileInfo);
this.originalRefImage.loadHandler=function(){this.hideTools();
var b=this.imageToolDefs.length;
for(var c=0;
c<b;
c++){this.imageToolDefs[c].onImageUploaded(this.originalRefImage)
}this.updateView()
}.createDelegate(this);
this.originalRefImage.load()
}else{this.originalRefImage=null;
this.updateView()
}},onSlideChanged:function(a){this.saveChanges();
this.editedSlide=a;
if(this.editedSlide){this.showSlide(this.editedSlide)
}},onAddButton:function(){this.addNewSlide();
this.buildComboBoxContent()
},onRemoveButton:function(){if(this.editedSlide){this.removeSlide()
}this.buildComboBoxContent()
}});
CQ.Ext.reg("slideshow",CQ.form.Slideshow);
CQ.form.Slideshow.Slide=CQ.Ext.extend(CQ.Ext.emptyFn,{referencedFileInfo:null,slideIndex:0,isPersistent:false,isDeleted:false,constructor:function(a){var b={referencedFileInfo:null,isPersistent:false,isDeleted:false,slideIndex:-1};
CQ.Ext.apply(this,a,b)
},createDisplayText:function(){if(this.title){return this.title
}else{if(this.referencedFileInfo){return this.referencedFileInfo.dataPath
}else{return CQ.I18n.getMessage("New slide")
}}},createTransferFields:function(g){var a=[];
var m=((g.length>2)&&g.substring(0,2)=="./");
var k=(m?"":"./")+g.replace("$",this.slideIndex);
if(!this.isDeleted){var c=k+"/fileReference";
var j=k+"/jcr:title";
if(this.referencedFileInfo){a.push(new CQ.Ext.form.Hidden({name:c,value:this.referencedFileInfo.dataPath}))
}else{a.push(new CQ.Ext.form.Hidden({name:c,value:""}))
}if(this.title){a.push(new CQ.Ext.form.Hidden({name:j,value:this.title}))
}else{a.push(new CQ.Ext.form.Hidden({name:j,value:""}))
}}else{if(this.isPersistent){var b=k+CQ.Sling.DELETE_SUFFIX;
if(this.referencedFileInfo){a.push(new CQ.Ext.form.Hidden({name:b,value:"true"}))
}}}return a
}});
CQ.form.Slideshow.SlidesPanel=CQ.Ext.extend(CQ.Ext.Panel,{constructor:function(a){var c=this;
var b=new CQ.Ext.Button({itemId:"addButton",xtype:"button",text:CQ.I18n.getMessage("Add"),afterRender:function(){CQ.Ext.Button.prototype.afterRender.call(this);
if(c._width){c.adjustSelectorWidth(c._width)
}},handler:function(){if(c.onAddButton){c.onAddButton()
}}});
var g=new CQ.Ext.Button({itemId:"removeButton",xtype:"button",text:CQ.I18n.getMessage("Remove"),afterRender:function(){CQ.Ext.Button.prototype.afterRender.call(this);
if(c._width){c.adjustSelectorWidth(c._width)
}},handler:function(){if(c.onRemoveButton){c.onRemoveButton()
}}});
a=a||{};
var j={layout:"table",layoutConfig:{columns:3},defaults:{style:"padding: 3px;"},minSize:30,maxSize:30,height:30,items:[{itemId:"slideSelector",xtype:"panel",layout:"fit",border:false,height:30,hideBorders:true,items:[{itemId:"selector",xtype:"selection",type:"select",listeners:{selectionchanged:{fn:function(k,m){if(this.onSlideChanged){this.onSlideChanged(m)
}},scope:this}}}]},b,g],listeners:{bodyresize:{fn:function(m,k,n){this.adjustSelectorWidth(k)
},scope:this}}};
CQ.Util.applyDefaults(a,j);
CQ.form.Slideshow.SlidesPanel.superclass.constructor.call(this,a)
},initComponent:function(){CQ.form.Slideshow.SlidesPanel.superclass.initComponent.call(this)
},afterRender:function(){CQ.form.Slideshow.SlidesPanel.superclass.afterRender.call(this);
this.el.setVisibilityMode(CQ.Ext.Element.DISPLAY);
this.body.setVisibilityMode(CQ.Ext.Element.DISPLAY)
},adjustSelectorWidth:function(j){if(j){var b=this.items.get("slideSelector");
var g=this.items.get("addButton");
var k=this.items.get("removeButton");
if(g.rendered&&k.rendered){var c=j-g.getEl().getWidth()-k.getEl().getWidth();
b.setSize(c,30);
var a=b.items.get("selector");
a.setSize(c,g.getEl().getHeight())
}else{this._width=j
}}},setInitialComboBoxContent:function(b){var a=this.items.get("slideSelector").items.get("selector");
a.setOptions(b)
},select:function(b){var a=this.items.get("slideSelector").items.get("selector");
a.suspendEvents();
if(b){a.setValue(b)
}else{a.setValue(null)
}a.resumeEvents()
},updateSlide:function(b){if(b){var a=this.items.get("slideSelector").items.get("selector");
var c=a.comboBox.store;
var k=c.getTotalCount();
for(var j=0;
j<k;
j++){var g=c.getAt(j);
if(g.get("value")==b){g.set("text",b.createDisplayText())
}}c.commitChanges()
}},disableFormElements:function(){var a=this.items.get("slideSelector").items.get("selector");
a.disable()
},enableFormElements:function(){var a=this.items.get("slideSelector").items.get("selector");
a.enable()
}});
CQ.form.Slideshow.TitlePanel=CQ.Ext.extend(CQ.Ext.Panel,{constructor:function(a){a=a||{};
var b={layout:"table",layoutConfig:{columns:2},defaults:{style:"padding: 3px;"},minSize:30,maxSize:30,height:30,items:[{itemId:"titleLabel",xtype:"label",text:CQ.I18n.getMessage("Title")},{itemId:"titlePanel",xtype:"panel",layout:"fit",border:false,hideBorders:true,items:[{itemId:"title",xtype:"textfield"}]}],listeners:{bodyresize:{fn:function(g,c,j){this.adjustTitleWidth(c)
},scope:this}}};
CQ.Util.applyDefaults(a,b);
CQ.form.Slideshow.TitlePanel.superclass.constructor.call(this,a)
},initComponent:function(){CQ.form.Slideshow.SlidesPanel.superclass.initComponent.call(this)
},afterRender:function(){CQ.form.Slideshow.TitlePanel.superclass.afterRender.call(this);
this.el.setVisibilityMode(CQ.Ext.Element.DISPLAY);
this.body.setVisibilityMode(CQ.Ext.Element.DISPLAY)
},adjustTitleWidth:function(a){if(a){var b=this.items.get("titlePanel");
var c=this.items.get("titleLabel");
if(c.rendered){var g=a-c.getEl().getWidth();
b.setSize(g,30)
}else{this._width=a
}}},setTitle:function(c){var b=this.items.get("titlePanel");
var a=b.items.get("title");
a.setValue(c?c:"")
},getTitle:function(){var b=this.items.get("titlePanel");
var a=b.items.get("title");
return a.getValue()
},disableFormElements:function(){var b=this.items.get("titlePanel");
var a=b.items.get("title");
a.disable()
},enableFormElements:function(){var b=this.items.get("titlePanel");
var a=b.items.get("title");
a.enable()
}});
CQ.form.MVT=CQ.Ext.extend(CQ.form.Slideshow,{constructor:function(a){a=a||{};
var b={footPanel:new CQ.form.MVT.BiasPanel({})};
CQ.Util.applyDefaults(a,b);
CQ.form.MVT.superclass.constructor.call(this,a)
},initComponent:function(){CQ.form.MVT.superclass.initComponent.call(this)
},createSlide:function(j,k,n){var m=(j?j["jcr:title"]:null);
var g=(j?j.fileReference:null);
var c=(j?j.bias:null);
var a;
if(j&&g){var b=this.resolveReference(g,n);
if(b){a=new CQ.form.MVT.Banner({referencedFileInfo:b,title:m,bias:c,slideIndex:k,isPersistent:true,isDeleted:false})
}}else{a=new CQ.form.MVT.Banner({referencedFileInfo:null,title:null,bias:null,slideIndex:k,isPersistent:false,isDeleted:false})
}this.slides.push(a);
return a
},saveChanges:function(){if(this.editedSlide){var a=this.footPanel.getBias();
this.editedSlide.referencedFileInfo=this.referencedFileInfo;
this.editedSlide.bias=(a?a:null);
this.headPanel.updateSlide(this.editedSlide)
}},showSlide:function(a){this.footPanel.setBias(a.bias);
CQ.form.MVT.superclass.showSlide.call(this,a)
}});
CQ.Ext.reg("mvt",CQ.form.MVT);
CQ.form.MVT.Banner=CQ.Ext.extend(CQ.form.Slideshow.Slide,{constructor:function(a){CQ.form.MVT.Banner.superclass.constructor.call(this,a)
},createDisplayText:function(){if(this.title){return this.title
}else{if(this.referencedFileInfo){return this.referencedFileInfo.dataPath
}else{return CQ.I18n.getMessage("New Banner")
}}},createTransferFields:function(j){var a=[];
var n=((j.length>2)&&j.substring(0,2)=="./");
var m=(n?"":"./")+j.replace("$",this.slideIndex);
if(!this.isDeleted){var g=m+"/fileReference";
var k=m+"/jcr:title";
var b=m+"/bias";
if(this.referencedFileInfo){a.push(new CQ.Ext.form.Hidden({name:g,value:this.referencedFileInfo.dataPath}))
}else{a.push(new CQ.Ext.form.Hidden({name:g,value:""}))
}if(this.title){a.push(new CQ.Ext.form.Hidden({name:k,value:this.title}))
}else{a.push(new CQ.Ext.form.Hidden({name:k,value:""}))
}if(this.bias){a.push(new CQ.Ext.form.Hidden({name:b,value:this.bias}))
}else{a.push(new CQ.Ext.form.Hidden({name:b,value:""}))
}}else{if(this.isPersistent){var c=m+CQ.Sling.DELETE_SUFFIX;
if(this.referencedFileInfo){a.push(new CQ.Ext.form.Hidden({name:c,value:"true"}))
}}}return a
}});
CQ.form.MVT.BiasPanel=CQ.Ext.extend(CQ.Ext.Panel,{constructor:function(a){a=a||{};
var b={layout:"table",layoutConfig:{columns:2},defaults:{style:"padding: 3px;"},minSize:30,maxSize:30,height:30,items:[{itemId:"biasLabel",xtype:"label",text:CQ.I18n.getMessage("Bias")},{itemId:"BiasPanel",xtype:"panel",layout:"fit",border:false,hideBorders:true,items:[{itemId:"bias",xtype:"numberfield",allowNegative:false}]}],listeners:{bodyresize:{fn:function(g,c,j){this.adjustBiasWidth(c)
},scope:this}}};
CQ.Util.applyDefaults(a,b);
CQ.form.MVT.BiasPanel.superclass.constructor.call(this,a)
},initComponent:function(){CQ.form.MVT.BiasPanel.superclass.initComponent.call(this)
},afterRender:function(){CQ.form.MVT.BiasPanel.superclass.afterRender.call(this);
this.el.setVisibilityMode(CQ.Ext.Element.DISPLAY);
this.body.setVisibilityMode(CQ.Ext.Element.DISPLAY)
},adjustBiasWidth:function(b){if(b){var c=this.items.get("BiasPanel");
var g=this.items.get("biasLabel");
if(g.rendered){var a=b-g.getEl().getWidth();
c.setSize(a,30)
}else{this._width=b
}}},setBias:function(a){var c=this.items.get("BiasPanel");
var b=c.items.get("bias");
b.setValue(a?a:"")
},getBias:function(){var b=this.items.get("BiasPanel");
var a=b.items.get("bias");
return a.getValue()
},disableFormElements:function(){var b=this.items.get("BiasPanel");
var a=b.items.get("bias");
a.disable()
},enableFormElements:function(){var b=this.items.get("BiasPanel");
var a=b.items.get("bias");
a.enable()
}});
CQ.form.OwnerDraw=CQ.Ext.extend(CQ.form.CompositeField,{html:"",htmlContent:null,url:null,hiddenField:null,htmlExp:"",processRecord:function(record,path){if(this.fireEvent("beforeloadcontent",this,record,path)!==false){if(this.getName()){var v=record.get(this.getName());
if(v==undefined&&this.defaultValue!=null){if(this.isApplyDefault(record,path)){this.setValue(this.defaultValue)
}}else{this.setValue(v)
}}if(this.url){var u=CQ.HTTP.addParameter(this.url,"path",CQ.Sling.getContentPath(this.name,path));
u=CQ.HTTP.addParameter(u,"id",this.id);
var resp=CQ.HTTP.get(u);
if(CQ.HTTP.isOk(resp)){this.getEl().update(resp.body)
}}else{if(this.htmlExp){try{var html=eval(this.htmlExp);
this.getEl().update(html)
}catch(e){}}}this.fireEvent("loadcontent",this,record,path)
}},afterRender:function(){if(!this.htmlExp){this.body.update(this.htmlContent)
}CQ.form.OwnerDraw.superclass.afterRender.call(this)
},setValue:function(a){if(this.hiddenField){this.hiddenField.setValue(a)
}},getValue:function(){return this.hiddenField?this.hiddenField.getValue():""
},getName:function(){return this.hiddenField?this.hiddenField.getName():""
},constructor:function(a){if(a.html&&a.html.indexOf("{[")!=-1){this.htmlExp=a.html.replace(/'/g,"\\'");
this.htmlExp=this.htmlExp.replace(/\{\[/g,"'+");
this.htmlExp=this.htmlExp.replace(/\]\}/g,"+'");
this.htmlExp="'"+this.htmlExp+"'"
}if(a.html){a.htmlContent=a.html;
delete a.html
}CQ.Ext.applyIf(a,{border:false});
if(a.name){this.hiddenField=new CQ.Ext.form.Hidden({name:a.name});
CQ.Ext.applyIf(a,{items:this.hiddenField})
}CQ.form.OwnerDraw.superclass.constructor.call(this,a)
}});
CQ.Ext.reg("ownerdraw",CQ.form.OwnerDraw);
CQ.form.BrowseField=CQ.Ext.extend(CQ.Ext.form.TriggerField,{content:null,browseDialog:null,onTriggerClick:function(){if(this.disabled){return
}if(this.browseDialog==null){var a={"jcr:primaryType":"cq:BrowseDialog",id:this.id+"-dialog",ok:function(){if(this.browseField){if(this.browseField.formatHtmlLink){var b=this.browseField.getParagraphAnchor();
b=b==""?b:"#"+b;
this.browseField.setValue(this.getSelectedPath()+".html"+b)
}else{this.browseField.setValue(this.getSelectedPath())
}this.browseField.fireEvent("dialogselect",this)
}this.hide()
},parBrowse:this.parBrowse,treeRoot:this.treeRoot,treeLoader:this.treeLoader,listeners:{hide:function(){if(this.browseField){this.browseField.fireEvent("dialogclose");
this.browseField.fireEvent("browsedialog.closed")
}}}};
this.browseDialog=new CQ.Util.build(a);
this.browseDialog.browseField=this
}if(this.getValue()){this.browseDialog.loadContent(CQ.HTTP.getPath(this.getValue()))
}else{this.browseDialog.loadContent(CQ.WCM.getPagePath())
}this.browseDialog.show();
this.fireEvent("dialogopen");
this.fireEvent("browsedialog.opened")
},constructor:function(a){CQ.form.BrowseField.superclass.constructor.call(this,a)
},initComponent:function(){CQ.form.BrowseField.superclass.initComponent.call(this);
this.addEvents("browsedialog.opened","dialogopen","dialogSelect","dialogselect","browsedialog.closed","dialogclose")
},getParagraphAnchor:function(){return this.browseDialog.getSelectedAnchor()
}});
CQ.Ext.reg("browsefield",CQ.form.BrowseField);
CQ.form.PathField=CQ.Ext.extend(CQ.Ext.form.ComboBox,{lastValue:null,searchIntervalId:0,browseDialog:null,getParagraphAnchor:function(){return this.browseDialog.getSelectedAnchor()
},adjustNewValue:function(a,b){if(/^path:"/.test(a)){b='"'+b+'"'
}return b
},keyup:function(b,a){var j=this.getRawValue();
var g=a.getKey();
if(g==13){this.fireEvent("search",this,j)
}if(j==this.lastValue){return
}this.lastValue=j;
var k=j;
if(/^\//.test(k)&&/\/$/.test(k)){if(k=="/"){k=this.rootPath?this.rootPath:"/"
}else{k=k.replace(/\/$/,"")
}this.loadStore(CQ.shared.HTTP.encodePath(k))
}else{if(this.searchDelay){window.clearTimeout(this.searchIntervalId);
var c=this;
this.searchIntervalId=window.setTimeout(function(){c.fireEvent("search",c,j)
},this.searchDelay)
}}},loadStore:function(a){this.store.proxy.api.read.url=a+".pages.json";
this.store.reload()
},onTriggerClick:function(){if(this.disabled){return
}if(this.browseDialog==null||this.modeless){function b(){var j=this.getSelectedPath();
var c=this.parBrowse?this.getSelectedAnchor():null;
var g;
if(c){g=CQ.Util.patchText(this.pathField.parLinkPattern,[j,c])
}else{g=CQ.Util.patchText(this.pathField.linkPattern,j)
}if(this.pathField.suffix){g+=this.pathField.suffix
}this.pathField.setValue(g);
this.pathField.fireEvent("dialogselect",this.pathField,j,c);
this.hide()
}var a=CQ.Util.applyDefaults(this.browseDialogCfg,{ok:b,parBrowse:this.parBrowse,treeRoot:this.treeRoot,treeLoader:this.treeLoader,listeners:{hide:function(){if(this.pathField){this.pathField.fireEvent("dialogclose")
}}},loadAndShowPath:function(m){this.path=m;
if(this.pathField.rootPath==""||this.pathField.rootPath=="/"){m="/"+m
}var j=this;
var k=this.treePanel;
function g(n){if(n.parentNode){n.ensureVisible()
}if(j.parBrowse){j.onSelectPage(n)
}}function c(o,n){var q=o.lastIndexOf(n);
if(q>=0){return o.substring(0,q)
}else{return o
}}k.selectPath(m,null,function(o,n){if(o&&n){g(n)
}else{m=c(m,"#");
k.selectPath(m,null,function(r,q){if(r&&q){g(q)
}else{m=c(m,".");
k.selectPath(m,null,function(u,t){if(u&&t){g(t)
}})
}})
}})
},pathField:this});
if(this.parBrowse){a.width=570
}this.browseDialog=new CQ.BrowseDialog(a)
}this.browseDialog.loadAndShowPath(this.getValue());
this.browseDialog.show();
this.fireEvent("dialogopen")
},constructor:function(a){if(typeof a.rootTitle==="undefined"){a.rootTitle=a.rootPath||CQ.I18n.getMessage("Websites")
}if(typeof a.rootPath==="undefined"){a.rootPath="/content"
}var g=a.rootPath;
if(g.charAt(0)==="/"){g=g.substring(1)
}if(typeof a.predicate==="undefined"){a.predicate="siteadmin"
}if(typeof a.showTitlesInTree==="undefined"){a.showTitlesInTree=true
}var b="path";
if(a.escapeAmp){b="escapedPath";
delete a.escapeAmp
}CQ.Util.applyDefaults(a,{linkPattern:a.parBrowse?"{0}.html":"{0}",parLinkPattern:"{0}.html#{1}",tpl:new CQ.Ext.XTemplate('<tpl for=".">','<div ext:qtip="{tooltip}" class="x-combo-list-item">','<span class="cq-pathfield-completion-list-name">{label}</span>','<span class="cq-pathfield-completion-list-title">{title}</span>',"</div>","</tpl>"),displayField:b,typeAhead:true,searchDelay:200,suffix:"",mode:"local",selectOnFocus:true,enableKeyEvents:true,validationEvent:false,validateOnBlur:false,triggerClass:"x-form-search-trigger",treeRoot:{name:g,text:a.rootTitle},treeLoader:{dataUrl:CQ.shared.HTTP.getXhrHookedURL(CQ.Util.externalize("/bin/tree/ext.json")),baseParams:{predicate:a.predicate,_charset_:"utf-8"},createNode:function(j){if(!a.showTitlesInTree){j.text=j.name
}return CQ.Ext.tree.TreeLoader.prototype.createNode.call(this,j)
},getParams:function(j){var k=this.baseParams;
k.node=j.id;
return CQ.Ext.urlEncode(k)
}}});
if(!(a.store instanceof CQ.Ext.data.Store)){var c=CQ.Util.applyDefaults(a.store,{proxy:new CQ.Ext.data.HttpProxy({url:"/",method:"GET"}),baseParams:{predicate:a.predicate},reader:new CQ.Ext.data.JsonReader({totalProperty:"results",root:"pages",id:"path"},CQ.Ext.data.Record.create([{name:"label",convert:function(j,k){return CQ.shared.XSS.getXSSValue(k.label)
}},{name:"title",mapping:CQ.shared.XSS.getXSSPropertyName("title")},{name:b},{name:"tooltip",convert:function(j,k){return _g.Util.htmlEncode(_g.Util.htmlEncode(k.path))
}}]))});
a.store=new CQ.Ext.data.Store(c)
}this.store=a.store;
CQ.form.PathField.superclass.constructor.call(this,a)
},initComponent:function(){CQ.form.PathField.superclass.initComponent.call(this);
this.addListener("keyup",this.keyup,this);
this.addEvents("search","dialogopen","dialogselect","dialogclose");
CQ.WCM.registerDropTargetComponent(this)
},getDropTargets:function(){var a=this;
var b=new CQ.wcm.EditBase.DropTarget(this.el,{ddAccept:"*/*",notifyDrop:function(j,c,g){if(j&&j.clearAnimations){j.clearAnimations(this)
}if(g&&g.records&&g.records[0]){var k=g.records[0].get("path");
if(k){a.setValue(k);
return true
}}return false
}});
b.groups.media=true;
b.groups.s7media=true;
b.groups.page=true;
return[b]
}});
CQ.Ext.reg("pathfield",CQ.form.PathField);
CQ.BrowseDialog=CQ.Ext.extend(CQ.Dialog,{treePanel:null,browseField:null,initComponent:function(){CQ.BrowseDialog.superclass.initComponent.call(this)
},loadContent:function(a){if(typeof a=="string"){this.path=a;
this.treePanel.selectPath(a,"name");
if(this.parBrowse){this.paraProxy.api.read.url=CQ.HTTP.externalize(a,true)+".paragraphs.json";
this.paraStore.reload()
}}},getSelectedPath:function(){try{return this.treePanel.getSelectionModel().getSelectedNode().getPath()
}catch(a){return""
}},getSelectedAnchor:function(){try{var a=this.data.getSelectedRecords()[0].get("path");
a=a.substring(a.indexOf("jcr:content")+"jcr:content".length+1);
return a.replace(/\//g,"_").replace(/:/g,"_")
}catch(b){return""
}},constructor:function(g){var j=CQ.Util.applyDefaults(g.treeRoot,{name:"content",text:CQ.I18n.getMessage("Site"),draggable:false,singleClickExpand:true,expanded:true});
var m=CQ.Util.applyDefaults(g.treeLoader,{dataUrl:CQ.HTTP.externalize("/bin/tree/ext.json"),requestMethod:"GET",baseParams:{predicate:"hierarchy",_charset_:"utf-8"},baseAttrs:{singleClickExpand:true},listeners:{beforeload:function(n,o){this.baseParams.path=o.getPath()
}}});
this.treePanel=new CQ.Ext.tree.TreePanel({region:"west",lines:CQ.themes.BrowseDialog.TREE_LINES,bodyBorder:CQ.themes.BrowseDialog.TREE_BORDER,bodyStyle:CQ.themes.BrowseDialog.TREE_STYLE,height:"100%",width:200,autoScroll:true,containerScroll:true,root:new CQ.Ext.tree.AsyncTreeNode(j),loader:new CQ.Ext.tree.TreeLoader(m),defaults:{draggable:false}});
var k=CQ.themes.BrowseDialog.WIDTH;
var c=this.treePanel;
if(g.parBrowse){this.treePanel.on("click",this.onSelectPage.createDelegate(this));
var a=new CQ.Ext.data.JsonReader({id:"path",root:"paragraphs",totalProperty:"count",fields:["path","html"]});
this.paraProxy=new CQ.Ext.data.HttpProxy({url:"/"});
this.paraStore=new CQ.Ext.data.Store({proxy:this.paraProxy,reader:a,autoLoad:false});
var b=new CQ.Ext.XTemplate('<tpl for=".">','<div class="cq-paragraphreference-paragraph">{html}</div>',"</tpl>");
this.data=new CQ.Ext.DataView({id:"cq-paragraphreference-data",region:"center",store:this.paraStore,tpl:b,itemSelector:"div.cq-paragraphreference-paragraph",selectedClass:"cq-paragraphreference-selected",singleSelect:true,style:{overflow:"auto"}});
k=550;
c=new CQ.Ext.Panel({border:false,layout:"border",items:[this.treePanel,this.data]})
}CQ.Util.applyDefaults(g,{title:CQ.I18n.getMessage("Select Path"),closable:true,width:k,height:CQ.themes.BrowseDialog.HEIGHT,minWidth:CQ.themes.BrowseDialog.MIN_WIDTH,minHeight:CQ.themes.BrowseDialog.MIN_HEIGHT,resizable:CQ.themes.BrowseDialog.RESIZABLE,resizeHandles:CQ.themes.BrowseDialog.RESIZE_HANDLES,autoHeight:false,autoWidth:false,cls:"cq-browsedialog",ok:function(){this.hide()
},buttons:CQ.Dialog.OKCANCEL,items:c});
CQ.BrowseDialog.superclass.constructor.call(this,g)
},onSelectPage:function(b,a){this.paraProxy.api.read.url=CQ.HTTP.externalize(b.getPath()+".paragraphs.json",true);
this.paraStore.reload()
}});
CQ.Ext.reg("browsedialog",CQ.BrowseDialog);
CQ.UploadDialog=CQ.Ext.extend(CQ.Dialog,{uploadPath:null,destinationPath:null,admin:null,useFlash:true,fileNamePrefix:null,initComponent:function(){CQ.UploadDialog.superclass.initComponent.call(this)
},makeFileUploadField:function(g,b){var c=this;
var a="";
if(g){a=g.id
}return{xtype:"fileuploadfield",hideLabel:true,name:a,fileNameParameter:":assetname",allowFileNameEditing:true,vtype:"name",invalidText:CQ.Ext.form.VTypes.nameText,placeHolder:g,removable:true,useFlash:b,fileNamePrefix:c.fileNamePrefix,listeners:{fileselected:function(m,j){if(!m.valueUpdated){var n;
if(j.flash){n=m.ownerCt.add(c.makeFileUploadField(j.file,b))
}else{n=m.ownerCt.add(c.makeFileUploadField(null,b))
}m.ownerCt.doLayout();
try{m.findParentByType("form").getForm().items.add(n)
}catch(k){}}if(!j.flash){m.setValue(CQ.Ext.form.VTypes.makeName(j))
}},flashfilesselected:function(){c.doMask(c.body,CQ.I18n.getMessage("Loading..."))
},flashdialogcomplete:function(){CQ.Ext.getCmp(c.okButtonConfig.id).setDisabled(CQ.swfu.getStats().files_queued==0);
c.doUnmask()
},flashuploadstart:function(o,m){var k=CQ.Ext.getCmp(c.okButtonConfig.id);
if(k){k.setDisabled(true)
}var j=m.name;
try{j=o.fileInput.dom.name
}catch(n){}var q=c.getPostFileName(j);
c.form.flashUpload.setFilePostName(q);
c.doMask(c.body,CQ.I18n.getMessage("Uploading '{0}'...",CQ.shared.XSS.getXSSValue(j)))
},flashuploadsuccess:function(k,j){window.setTimeout(function(){k.el.parent("div[class*=x-form-item]").fadeOut({easing:"easeOut",endOpacity:0,duration:0,concurrent:false,remove:true})
},10)
},flashuploaderror:function(m,k,j){if(c.uploadFailed){c.uploadFailed.push(m.getValue())
}},flashuploadcomplete:function(j){if(c.uploadFailed.length>0){c.failure()
}else{c.success()
}},fileremoved:function(j){}}}
},constructor:function(config){var dialog=this;
this.useFlash=config.useFlash!=undefined?config.useFlash:true;
this.ts=new Date().getTime();
this.admin=config.admin;
CQ.Util.applyDefaults(config,{closable:true,resizable:true,autoHeight:false,autoWidth:false,cls:"cq-uploaddialog",okText:CQ.I18n.getMessage("Upload"),buttons:CQ.Dialog.OKCANCEL,title:CQ.I18n.getMessage("Upload Asset"),formUrl:CQ.HTTP.externalize(CQ.shared.HTTP.encodePath(config.destinationPath)),fileUpload:true,useFlash:this.useFlash,height:300,width:400,items:{xtype:"panel",items:[{xtype:"static",cls:"x-form-item-description",html:CQ.I18n.getMessage("Upload to")+": "+config.displayPath},dialog.makeFileUploadField(null,this.useFlash)]},listeners:{beforesubmit:function(dialog){dialog.uploadFailed=[];
var uploadfields=dialog.findByType("fileuploadfield");
var parent=CQ.HTTP.eval(CQ.HTTP.noCaching(dialog.getParentPath()+".1.json"));
var conflicts=[];
for(var i=0;
i<uploadfields.length;
i++){var name=uploadfields[i].getValue();
if(parent[name]){conflicts.push(name)
}else{uploadfields[i].setName(uploadfields[i].getValue().replace(/"/g,"%22"))
}}if(conflicts.length==0){var siteAdmin=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(siteAdmin){siteAdmin.mask()
}return true
}var msg=conflicts.length==1?CQ.I18n.getMessage("An asset of the same name already exists in this location:"):CQ.I18n.getMessage("Assets of the same name already exist in this location:");
msg+="<br/><br/>";
for(var i=0;
i<conflicts.length;
i++){msg+=CQ.shared.XSS.getXSSValue(conflicts[i])+"<br/>"
}msg+="<br/><br/>";
msg+=conflicts.length==1?CQ.I18n.getMessage("Click 'Yes' to replace the asset or 'No' to adjust the name."):CQ.I18n.getMessage("Click 'Yes' to replace the assets or 'No' to adjust the names.");
CQ.Ext.Msg.confirm(CQ.I18n.getMessage("Name Conflict"),msg,function(btnId){if(btnId=="yes"){for(var i=0;
i<conflicts.length;
i++){CQ.HTTP.post(dialog.getParentPath()+"/"+CQ.shared.HTTP.encodePath(conflicts[i]),null,{":operation":"delete"})
}dialog.ok()
}else{for(var u=0;
u<uploadfields.length;
u++){if(conflicts.indexOf(uploadfields[u].getValue())!=-1){uploadfields[u].markInvalid(CQ.I18n.getMessage("An asset of the same name already exists in this location."))
}}}});
return false
}},success:function(response){window.setTimeout(function(){dialog.hideAndReload()
},1000)
},failure:function(){if(dialog.canceled){dialog.hideAndReload();
dialog.canceled=false
}else{var title=CQ.I18n.getMessage("Error");
var msg=dialog.uploadFailed.length==1?CQ.I18n.getMessage("Failed to upload the following file:"):CQ.I18n.getMessage("Failed to upload the following files:");
msg+="<br/><br/>";
for(var i=0;
i<dialog.uploadFailed.length;
i++){msg+=CQ.shared.XSS.getXSSValue(dialog.uploadFailed[i])+"<br/>"
}CQ.Ext.Msg.show({title:title,msg:msg,icon:CQ.Ext.Msg.ERROR,buttons:CQ.Ext.Msg.OK,fn:function(){dialog.hideAndReload()
}})
}}});
CQ.UploadDialog.superclass.constructor.call(this,config)
},getParentPath:function(){return this.formUrl.replace(CQ.wcm.SiteAdmin.UPLOAD_URL_ASSET_REGEXP,"")
},getPostFileName:function(a){if(this.formUrl.match(CQ.wcm.SiteAdmin.UPLOAD_URL_ASSET_REGEXP)){return"file"
}else{return a
}},hideAndReload:function(b){this.doUnmask();
this.hide();
var a=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(a){a.reloadPages()
}},ok:function(k){var b={};
if(this.responseScope){b.scope=this.responseScope;
b.success=this.success?this.success:this.responseScope.success;
b.failure=this.failure?this.failure:this.responseScope.failure
}else{b.scope=this;
if(this.success){b.success=this.success
}if(this.failure){b.failure=this.failure
}}var q=this.findByType("fileuploadfield");
if(q.length<2){CQ.Ext.Msg.alert(CQ.I18n.getMessage("No File Selected"),CQ.I18n.getMessage("Click 'Browse...' to select a file to upload."));
return
}if(this.form.isValid()){if(this.fireEvent("beforesubmit",this)===false){return false
}var j=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(j){j.mask()
}this.form.items.each(function(r){if(r.emptyText&&r.el.dom.value==r.emptyText){r.setRawValue("")
}});
var g=new CQ.form.UploadSubmitAction(this.form,b);
this.form.doAction(g);
try{k.disable()
}catch(n){}if(!this.form.flashUpload){var c=(q.length==2)?CQ.I18n.getMessage("Uploading file..."):CQ.I18n.getMessage("Uploading files...");
this.doMask(this.body,c)
}}else{var m=[];
this.form.items.each(function(r){if(!r.validate()){m.push(r)
}});
var o=m.length==1?CQ.I18n.getMessage("Invalid Name"):CQ.I18n.getMessage("Invalid Names");
var a=m.length==1?CQ.I18n.getMessage("There is a file with an invalid name. Please verify the marked field."):CQ.I18n.getMessage("There are files with invalid names. Please verify the marked fields.");
CQ.Ext.Msg.show({title:o,msg:a,buttons:CQ.Ext.Msg.OK,icon:CQ.Ext.Msg.ERROR})
}},doMask:function(a,b){this.mask=new CQ.Ext.LoadMask(a,{msg:b});
this.mask.show()
},doUnmask:function(){if(this.mask){this.mask.hide()
}},getOkConfig:function(){if(!this.okButtonConfig){this.okButtonConfig={id:CQ.Ext.id(),text:this.okText,cls:"cq-btn-ok",disabled:true,handler:this.ok}
}return this.okButtonConfig
},getCancelConfig:function(){return{text:this.cancelText,cls:"cq-btn-cancel",handler:function(a){if(CQ.swfu){this.canceled=true;
while(CQ.swfu.getStats().files_queued>0){CQ.swfu.cancelUpload(null,false)
}}this.doUnmask();
this.hide()
}}
}});
CQ.Ext.reg("uploaddialog",CQ.UploadDialog);
CQ.HomeLink=CQ.Ext.extend(CQ.Static,{linkText:null,tooltip:null,linkPath:null,constructor:function(a){CQ.Ext.applyIf(a,{cls:"cq-homelink",tooltip:CQ.I18n.getMessage("Back Home"),linkPath:"/welcome",linkText:"&nbsp;"});
CQ.Ext.apply(a,{html:'<a href="'+CQ.HTTP.externalize(a.linkPath)+'" title="'+a.tooltip+'">'+a.linkText+"</a>",listeners:{render:function(){CQ.Ext.QuickTips.register({target:this.getEl(),text:a.tooltip})
}}});
CQ.HomeLink.superclass.constructor.call(this,a)
}});
CQ.UserInfo=CQ.Ext.extend(CQ.Ext.Toolbar,{impersonated:false,constructor:function(a){a=CQ.Util.applyDefaults(a,{id:"cq-userinfo",menu:{items:[]},sudoables:{listWidth:150,typeAhead:true,triggerAction:"all",inputType:"text",displayField:"name",stateful:false,width:150,minChars:0,editable:true,tpl:new CQ.Ext.XTemplate('<tpl for=".">','<div class="cq-impersonators-list">','<div class="cq-impersonators-list-entry">','{[CQ.shared.XSS.getXSSTablePropertyValue(values, "name") == "" ? values.id : CQ.shared.XSS.getXSSTablePropertyValue(values, "name")]}',"</div>","</div>","</tpl>"),itemSelector:"div.cq-impersonators-list"},columnWidth:0.2,passwordDialog:CQ.UserInfo.PASSWORD_DIALOG_CFG});
CQ.UserInfo.superclass.constructor.call(this,a)
},initComponent:function(){var g=this.initialConfig;
var j=CQ.User.getCurrentUser();
this.impersonated=j.isImpersonated();
if(!g.iconCls){g.iconCls=this.impersonated?"impersonateIcon":"userIcon";
if(CQ.Ext.isIE6){g.iconCls+="-ie6"
}}var k=new CQ.Ext.menu.Menu(g.menu);
if(this.impersonated){k.addMenuItem({iconCls:"revertIcon",cls:"cq-userinfo-revert",text:CQ.I18n.getMessage("Revert to self"),handler:this.revertHandler})
}else{k.addMenuItem({text:CQ.I18n.getMessage("Sign out"),cls:"cq-userinfo-logout",handler:this.logout});
k.addSeparator();
if(j.getUserID()!="admin"){k.addMenuItem({text:CQ.I18n.getMessage("Set Password"),cls:"cq-userinfo-pwd",handler:this.setPassword,scope:this})
}k.addMenuItem({text:CQ.I18n.getMessage("Notification Inbox"),cls:"cq-userinfo-inbox",handler:this.openNotificationInbox});
k.addMenuItem({text:CQ.I18n.getMessage("Preferences"),cls:"cq-userinfo-props",handler:this.openUserProperties});
k.addSeparator();
k.addMenuItem({iconCls:"impersonateIcon",text:CQ.I18n.getMessage("Impersonate as:"),hideOnClick:false,style:{cursor:"default"},canActivate:false});
var b=g.sudoables;
b=CQ.Util.applyDefaults(b,{style:{cursor:"text"},cls:"cq-userinfo-impersonate",triggerScrollOffset:80,listeners:{expand:{fn:function(n){var m=k.getEl().getPositioning();
if(m&&n.list){n.list.setStyle("z-index",m["z-index"]+6)
}var a=$CQ(n.innerList.dom);
if(a&&!a.scrollerInitialized){a.scrollerInitialized=true;
a.on("scroll",function(q){if(n.refreshing||n.loading||(n.store.getCount()>=n.store.getTotalCount())){return
}if((this.scrollTop>0)&&((this.scrollTop+this.clientHeight+n.triggerScrollOffset)>=this.scrollHeight)){if(!n.moreStore){n.moreStore=new CQ.Ext.data.GroupingStore({proxy:new CQ.Ext.data.HttpProxy({url:n.store.proxy.url,method:n.store.proxy.conn.method}),reader:n.store.reader,listeners:{load:function(){if(n.loadingIndicator){n.loadingIndicator.remove();
n.loadingIndicator=undefined
}for(var u=0;
u<n.moreStore.getCount();
u++){var t=n.moreStore.getAt(u);
n.store.add(t)
}n.refreshing=false
}},dataView:this})
}var o=n.store.lastOptions?n.store.lastOptions.params:n.store.baseParams;
var r=$CQ.extend({},o,{limit:n.store.baseParams?n.store.baseParams.limit:25,start:n.store.getCount()});
n.loadingIndicator=n.innerList.createChild({tag:"div",cls:"loading-indicator",html:CQ.I18n.getMessage("Loading...")});
n.refreshing=true;
n.moreStore.load({params:r})
}})
}}},select:{fn:this.sudoHandler,scope:this}}});
if(!b.store){b.store=new CQ.Ext.data.Store({autoLoad:false,proxy:new CQ.Ext.data.HttpProxy({url:j.getHome()+".sudoables.json",method:"GET"}),baseParams:{_charset_:"utf-8",start:0,limit:25},reader:new CQ.Ext.data.JsonReader({root:"authorizables",totalProperty:"total",id:"id",fields:["name",CQ.shared.XSS.getXSSPropertyName("name"),"id"]})})
}var c=new CQ.Ext.Panel({border:false,cls:"impersonateMenu",items:[new CQ.Ext.form.ComboBox(b)]});
k.addItem(c);
if(CQ.Ext.isIE10){k.autoWidth=true
}}this.items=["->",{iconCls:g.iconCls,text:CQ.shared.Util.ellipsis(j.getUserName(true),120,true),menu:k,xtype:"tbbutton"}];
if(CQ.Ext.isIE6||CQ.Ext.isIE7){this.items.splice(0,1)
}CQ.UserInfo.superclass.initComponent.call(this)
},setPassword:function(){var a=CQ.User.getCurrentUser();
if(!(a&&a.getHome())){CQ.Notification.notify(CQ.I18n.getMessage("Failure"),CQ.I18n.getMessage("User not available"));
return
}var b=this.initialConfig.passwordDialog;
CQ.Util.applyDefaults(b,{formUrl:CQ.HTTP.noCaching(CQ.HTTP.externalize(a.getHome()+".rw.html"))});
var c=CQ.WCM.getDialog(b);
if(!c){CQ.Notification.notify(CQ.I18n.getMessage("Failure"),CQ.I18n.getMessage("Dialog not available"));
return
}c.setElId(CQ.Util.createId("cq-userinfo-passworddialog"));
c.success=function(){CQ.Notification.notify(CQ.I18n.getMessage("Success"),CQ.I18n.getMessage("Password changed"))
};
c.failure=function(j,k){try{var g=CQ.HTTP.buildPostResponseFromHTML(k.response.responseText);
CQ.Notification.notifyFromResponse(g,null,true)
}catch(m){CQ.Notification.notify(CQ.I18n.getMessage("Failure"),CQ.I18n.getMessage("Could not set Password"))
}};
c.show()
},sudoHandler:function(a,b){CQ.Ext.MessageBox.confirm(CQ.I18n.getMessage("Impersonation"),CQ.I18n.getMessage("Do you want to impersonate as {0}?",b.get(CQ.shared.XSS.getXSSPropertyName("name"))?b.get(CQ.shared.XSS.getXSSPropertyName("name")):b.id),function(g){if(g=="yes"){var c=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(c){c.mask()
}CQ.User.getCurrentUser().sudoAs(b.id)
}},this)
},revertHandler:function(){CQ.Ext.MessageBox.confirm(CQ.I18n.getMessage("Impersonation"),CQ.I18n.getMessage("Do you want to end impersonation to {0}?",CQ.User.getUserName(true)),function(b){if(b=="yes"){var a=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(a){a.mask()
}CQ.User.getCurrentUser().revertSelf()
}},this)
},logout:function(){CQ.User.logout()
},openNotificationInbox:function(){CQ.Util.reload(window,CQ.HTTP.externalize("/libs/wcm/core/content/inbox.html"))
},openUserProperties:function(){var b=CQ.WCM.getDialog("/libs/cq/security/content/tools/userProperties.infinity.json");
b.loadContent("/libs/cq/security/preferences/proxy");
var a=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(a){b.on("beforesubmit",function(){a.mask()
})
}b.success=function(){CQ.Util.reload()
};
b.failure=function(){if(a){a.unmask()
}CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not set user properties."))
};
b.show()
}});
CQ.Ext.reg("userinfo",CQ.UserInfo);
CQ.UserInfo.PASSWORD_DIALOG_CFG={width:400,height:230,"jcr:primaryType":"cq:Dialog",title:CQ.I18n.getMessage("Set Password"),params:{_charset_:"utf-8"},items:{"jcr:primaryType":"cq:Panel",items:{"jcr:primaryType":"cq:WidgetCollection",currentPassword:{inputType:"password",fieldLabel:CQ.I18n.getMessage("Current Password"),name:":currentPassword",cls:"cq-userinfo-currentpassword",allowBlank:false,msgTarget:"under"},password:{inputType:"password",fieldLabel:CQ.I18n.getMessage("Password"),name:"rep:password",cls:"cq-userinfo-password1",allowBlank:false,msgTarget:"under"},password2:{inputType:"password",fieldLabel:CQ.I18n.getMessage("Confirm Password"),name:"rep:password",cls:"cq-userinfo-password2",allowBlank:false,msgTarget:"under",validator:function(a){var b=this.ownerCt.items.get(1).getRawValue();
if(b===a){return true
}return CQ.I18n.getMessage("Provided passwords do not match.")
}}}},okText:CQ.I18n.getMessage("Set"),buttons:CQ.Dialog.OKCANCEL};
CQ.form.TableEdit=CQ.Ext.extend(CQ.form.CompositeField,{isFormField:true,hideLabel:true,useColPercentage:false,hiddenField:null,store:null,colModel:null,fields:[],columnArray:[],editorConfig:null,gridConfig:null,htmlEditor:null,editor:null,editorGrid:null,deleteRow:function(){var c=this.editorGrid;
var b=c.getSelectionModel();
var a=b.getSelectedCell();
if(a){CQ.Ext.Msg.confirm(CQ.I18n.getMessage("Delete Row"),CQ.I18n.getMessage("Are you sure you want to delete this row?"),function(g){if(g=="yes"){this.editorGrid.stopEditing();
this.editorGrid.store.remove(this.editorGrid.store.getAt(a[0]))
}},this)
}},deleteColumn:function(){var b=this.editorGrid.getSelectionModel();
var a=b.getSelectedCell();
if(a){this.editorGrid.stopEditing();
CQ.Ext.Msg.confirm(CQ.I18n.getMessage("Delete Column"),CQ.I18n.getMessage("Are you sure you want to delete this column?"),function(q){var u=this.editorGrid.colModel.getColumnCount();
var r=this.editorGrid.store.getCount();
for(var n=0;
n<u;
n++){this.editorGrid.colModel.setEditor(n,null)
}for(var o=0;
o<r;
++o){var g=this.editorGrid.store.getAt(o);
for(var n=0;
n<u-1;
++n){var m=(n<a[1])?n:n+1;
var v=this.editorGrid.colModel.getDataIndex(n);
var c=this.editorGrid.colModel.getDataIndex(m);
g.set(v,g.get(c))
}}for(var n=0;
n<u-1;
n++){var m=(n<a[1])?n:n+1;
var t=this.editorGrid.colModel.getColumnWidth(m);
this.editorGrid.colModel.setColumnWidth(n,t)
}this.fields.pop();
this.columnArray.pop();
this.editorGrid.colModel.setConfig(this.columnArray);
for(var n=0;
n<u-1;
n++){this.editorGrid.colModel.setEditor(n,this.editor)
}},this)
}},addRows:function(m){this.editorGrid.stopEditing();
var k=new CQ.Ext.data.Record.create(this.fields);
var c=this.editorGrid.colModel.getColumnCount();
for(var b=0;
b<m;
++b){var g={};
for(var a=0;
a<c;
++a){g["tcol-"+a]=""
}this.editorGrid.store.add(new k(g))
}},addColumns:function(m){this.editorGrid.stopEditing();
var g=this.editorGrid.colModel.getColumnCount();
for(var b=0;
b<g;
b++){this.editorGrid.colModel.setEditor(b,null)
}for(var c=g;
c<g+m;
++c){var a="tcol-"+(c);
var k=String.fromCharCode(65+c/26)+String.fromCharCode(65+c%26);
this.fields.push({name:a,mapping:"td:nth("+(c+1)+")/@innerHTML"});
this.columnArray.push({header:k,dataIndex:a,width:CQ.form.TableEdit.DEFAULT_COLUMN_WIDTH,tooltip:k,sortable:this.gridConfig.sortable})
}this.editorGrid.colModel.setConfig(this.columnArray);
this.editorGrid.store.each(function(j){j.set(a,"")
});
for(var b=0;
b<g+m;
b++){this.editorGrid.colModel.setEditor(b,this.editor)
}},getValue:function(){var u=this.editorGrid.colModel.getColumnCount();
var t=this.editorGrid.store.getCount();
var a=document.createElement("div");
var x=a.appendChild(document.createElement("table"));
var g=x.appendChild(document.createElement("colgroup"));
for(var m=0;
m<u;
++m){var b=g.appendChild(document.createElement("col"));
var v=this.editorGrid.colModel.getColumnWidth(m);
if(this.useColPercentage){b.width=this.convertWidthToPercentage(v)+"%"
}else{b.width=v
}}var k=x.appendChild(document.createElement("tbody"));
for(var y=0;
y<t;
++y){var r=k.appendChild(document.createElement("tr"));
var o=this.editorGrid.store.getAt(y);
for(var b=0;
b<u;
++b){if(!this.editorGrid.colModel.isHidden(b)){var j="td";
var c=r.appendChild(document.createElement(j));
var w=o.get(this.editorGrid.colModel.getDataIndex(b));
c.innerHTML=w?w:""
}}}var q=CQ.form.rte.HtmlProcessor;
var n=a.innerHTML;
n=q.executeInternalizeLinks(n,[{tag:"a",attribute:"href"}]);
n=this.htmlEditor.editorKernel.postProcessor.process(n);
return n
},initializeTable:function(k){var j=document.createElement("div");
if(!k){j.innerHTML="<table><colgroup><col></colgroup><tbody><tr><td></td></tr></tbody></table>"
}else{j.innerHTML=k
}j=CQ.Ext.get(j);
var n=j.query("col");
this.fields=[];
this.columnArray=[];
for(var b=0,g;
g=n[b];
++b){var a="tcol-"+b;
var m=String.fromCharCode(65+b/26)+String.fromCharCode(65+b%26);
this.fields.push({name:a,mapping:"td:nth("+(b+1)+")/@innerHTML"});
var c=g.width;
if(c){if(this.useColPercentage){c=this.convertPercentageToWidth(c)
}}else{c=CQ.form.TableEdit.DEFAULT_COLUMN_WIDTH
}this.columnArray.push({header:m,dataIndex:a,width:parseInt(c),tooltip:g.title,sortable:this.gridConfig.sortable,editor:this.editor})
}this.editorGrid.store=new CQ.Ext.data.Store({reader:new CQ.Ext.data.XmlReader({record:"tr"},this.fields)});
this.editorGrid.store.loadData(j.dom);
this.editorGrid.colModel=new CQ.Ext.grid.ColumnModel(this.columnArray)
},clear:function(){if(this.htmlEditor){this.htmlEditor.setValue("")
}if(this.editorGrid){this.editorGrid.stopEditing();
this.editorGrid.store.removeAll()
}},processRecord:function(a,c){if(this.fireEvent("beforeloadcontent",this,a,c)!==false){var b=a.get(this.getName());
if(b==undefined&&this.defaultValue!=null){if(this.isApplyDefault(a,c)){this.setValue(this.defaultValue)
}}if(b!=null){this.clear();
this.initializeTable(b);
this.editorGrid.reconfigure(this.editorGrid.store,this.editorGrid.colModel);
this.hiddenField.setValue(this.getValue())
}this.fireEvent("loadcontent",this,a,c)
}},getColsTotalWidth:function(){if(this.editorGrid.colModel){return this.editorGrid.colModel.getTotalWidth()
}return CQ.form.TableEdit.DEFAULT_GRID_WIDTH
},convertWidthToPercentage:function(b){var a=0;
if(b>0){a=Math.round(100*b/this.getColsTotalWidth())
}return a
},convertPercentageToWidth:function(b){var a=b;
if(typeof b=="string"){if(b.charAt(b.length-1)=="%"){a=b.substring(0,b.length-1)
}}a=Math.round(a*this.getColsTotalWidth()/100);
return a
},getColDisplayWidth:function(a,c){var b=this.editorGrid.colModel.getColumnWidth(a);
if(c){b+=c
}if(this.useColPercentage){return this.convertWidthToPercentage(b)+"%"
}else{return b+"px"
}},pasteHTML:function(o,t,m){var A=document.createElement("div");
A.innerHTML=m;
A=CQ.Ext.get(A);
var B=A.query("tr");
if(!B||B.length==0){return false
}var q=CQ.Ext.get(B[0]).query("td");
if(!q||q.length==0){return false
}var C=B.length;
var g=q.length;
var n=this.editorGrid.store.getCount();
var w=this.editorGrid.colModel.getColumnCount();
if(o+B.length>n){this.addRows((o+C)-n)
}if(t+q.length>w){this.addColumns((t+g)-w)
}this.editorGrid.reconfigure(this.editorGrid.store,this.editorGrid.colModel);
var u;
for(var k=0;
k<C;
++k){var b=this.editorGrid.store.getAt(k+o);
var z=CQ.Ext.get(B[k]).query("td");
for(var c=0,a=0;
c<q.length;
++c,++a){var r=this.editorGrid.colModel.getDataIndex(c+t);
u=z[a].innerHTML;
if(u!=null&&r){b.set(r,u)
}if(z[a].colSpan>1){c+=(z[a].colSpan-1)
}}}this.editor.setValue(u);
this.editorGrid.selModel.select(o+C-1,t+g-1);
this.editorGrid.startEditing(o+C-1,t+g-1);
return false
},editorSync:function(c,j){var b,n;
this.isSynced=true;
var a=this.editorGrid.selModel.getSelectedCell();
if(a){n=a[0];
b=a[1]
}else{n=0;
b=0
}if(j){var k=j.toLowerCase();
if(k.indexOf("<table")>=0){this.editorGrid.stopEditing();
return this.pasteHTML(n,b,j)
}if(a){var g=this.editorGrid.getColumnModel().getDataIndex(a[1]);
var m=this.editorGrid.store.getAt(a[0]);
m.set(g,j)
}}this.isSynced=false
},gridKeyHandler:function(a){},onResize:function(a,b){if(this.editor){this.editor.setSize(a,b)
}if(this.editorGrid.view){this.editorGrid.view.refresh()
}},onShow:function(a){this.editorGrid.enable();
this.htmlEditor.enable()
},onRender:function(b){CQ.form.TableEdit.superclass.onRender.call(this,b);
var a=this.findParentByType("dialog");
if(a){a.on("beforesubmit",function(c){this.htmlEditor.syncValue();
this.editorGrid.stopEditing();
this.hiddenField.setValue(this.getValue());
this.editorGrid.disable();
this.htmlEditor.disable()
},this);
a.on("show",function(c){if(this.editorGrid){this.editorGrid.enable()
}if(this.htmlEditor){this.htmlEditor.enable()
}if(this.editorGrid.view.splitone){this.editorGrid.view.splitone.enableTooltip=true;
this.editorGrid.view.splitone.showTooltip=this.showResizeTooltip;
this.editorGrid.view.splitone.hideTooltip=this.hideResizeTooltip
}},this)
}if(CQ.Ext.isIE){this.htmlEditor.on("render",this.htmlEditor.initEditor)
}return true
},fixFocusIssue:function(){var a=this;
CQ.Ext.apply(this.editorGrid.view,{focusCell:function(g,b,c){if(!a.isSynced){CQ.Ext.grid.GridView.prototype.focusCell.call(this,g,b,c)
}}})
},showResizeTooltip:function(a,g){var c=this.grid.findParentByType("tableedit");
var b=c.getColDisplayWidth(this.cellIndex);
this.tooltip=new CQ.Ext.ToolTip({target:this.grid.id,html:b,trackMouse:true,autoHide:false,visibilityMode:CQ.Ext.Element.DISPLAY,targetXY:[a,g],tableEdit:c,cellIndex:this.cellIndex});
this.tooltip.on("move",function(m,j,o){var k=Math.max(this.minX,j);
var n=k-this.startPos;
this.tooltip.body.dom.innerHTML=this.tooltip.tableEdit.getColDisplayWidth(this.tooltip.cellIndex,n)
},this);
this.tooltip.enable();
this.tooltip.show()
},hideResizeTooltip:function(a,b){this.tooltip.hide();
this.tooltip.disable();
this.tooltip.destroy()
},initComponent:function(){CQ.form.TableEdit.superclass.initComponent.call(this);
this.htmlEditor=new CQ.form.RichText(this.editorConfig);
this.editor=new CQ.Ext.grid.GridEditor(this.htmlEditor,{autoSize:null});
this.editorGrid=new CQ.Ext.grid.EditorGridPanel(this.gridConfig);
this.initializeTable(this.defaultValue);
this.add(this.htmlEditor);
this.add(this.editorGrid);
this.htmlEditor.on("beforesync",this.editorSync,this);
this.editorGrid.on("afteredit",function(a){this.hiddenField.setValue(this.getValue())
},this);
this.editorGrid.on("keypress",this.gridKeyHandler,this);
this.hiddenField=new CQ.Ext.form.Hidden({name:this.name});
this.add(this.hiddenField)
},constructor:function(a){var b=this;
var c={hideLabel:true,autoHeight:false,defaultValue:"",gridConfig:{xtype:"editorgrid",isFormField:false,height:158,sm:new CQ.Ext.grid.CellSelectionModel({handleMouseDown:function(){}}),afterRender:function(){CQ.Ext.grid.EditorGridPanel.prototype.afterRender.call(this);
b.fixFocusIssue()
},clicksToEdit:1,enableColumnMove:true,enableHdMenu:false,hideLabel:true,stateful:false,sortable:false,tbar:[{text:CQ.I18n.getMessage("Add Row"),handler:function(){this.addRows(1)
},scope:this},{text:CQ.I18n.getMessage("Add Column"),handler:function(){this.addColumns(1)
},scope:this},{text:CQ.I18n.getMessage("Delete Row"),handler:this.deleteRow,scope:this},{text:CQ.I18n.getMessage("Delete Column"),handler:this.deleteColumn,scope:this}]},editorConfig:{height:60,hideLabel:true,defaultPasteMode:"browser",removeSingleParagraphContainer:true,tabSize:1,name:""}};
CQ.Util.applyDefaults(a,c);
if(a.useColPercentage){CQ.Util.applyDefaults(a,{gridConfig:{viewConfig:{forceFit:true,autoFill:true}}})
}CQ.form.TableEdit.superclass.constructor.call(this,a)
}});
CQ.form.TableEdit.DEFAULT_COLUMN_WIDTH=100;
CQ.form.TableEdit.DEFAULT_GRID_WIDTH=450;
CQ.Ext.reg("tableedit",CQ.form.TableEdit);
CQ.form.ParagraphReference=CQ.Ext.extend(CQ.Ext.form.TriggerField,{constructor:function(j){CQ.form.ParagraphReference.superclass.constructor.call(this,j);
var c=new CQ.Ext.tree.TreeLoader({url:CQ.HTTP.externalize("/content.ext.json"),requestMethod:"GET",baseParams:{predicate:"hierarchy",depth:0},baseAttrs:{iconCls:"page"}});
c.on("beforeload",function(m,n){this.url=CQ.HTTP.externalize(n.getPath()+".ext.json")
});
var g=new CQ.Ext.tree.AsyncTreeNode({name:"content",text:CQ.I18n.getMessage("Pages"),expanded:true,iconCls:"page"});
var b=new CQ.Ext.tree.TreePanel({id:"cq-paragraphreference-tree",xtype:"treepanel",region:"west",width:200,loader:c,root:g,autoScroll:true});
b.on("click",this.onSelectPage.createDelegate(this));
var a=new CQ.Ext.data.JsonReader({id:"path",root:"paragraphs",totalProperty:"count",fields:["path","html"]});
this.proxy=new CQ.Ext.data.HttpProxy({url:"/"});
this.store=new CQ.Ext.data.Store({proxy:this.proxy,reader:a,autoLoad:false});
var k=new CQ.Ext.XTemplate('<tpl for=".">','<div class="cq-paragraphreference-paragraph">{html}</div>',"</tpl>");
this.data=new CQ.Ext.DataView({id:"cq-paragraphreference-data",region:"center",store:this.store,tpl:k,itemSelector:"div.cq-paragraphreference-paragraph",selectedClass:"cq-paragraphreference-selected",singleSelect:true,style:{overflow:"auto"}});
this.data.on("selectionchange",this.onSelectionChange.createDelegate(this));
this.selectButton=new CQ.Ext.Button({text:CQ.I18n.getMessage("Select"),handler:this.onSelect.createDelegate(this)});
this.dialog=new CQ.Ext.Window({title:CQ.I18n.getMessage("Select paragraph"),layout:"border",modal:true,y:20,width:CQ.themes.Dialog.WIDTH,height:CQ.themes.Dialog.HEIGHT,minWidth:CQ.themes.Dialog.MIN_WIDTH,minHeight:CQ.themes.Dialog.MIN_HEIGHT,closable:true,closeAction:"hide",stateful:false,items:[b,this.data],buttons:[this.selectButton,{text:CQ.I18n.getMessage("Cancel"),handler:this.onCancel.createDelegate(this)}]})
},onTriggerClick:function(){this.onSelectionChange();
this.dialog.show(this)
},onSelectPage:function(b,a){this.proxy.api.read.url=CQ.HTTP.externalize(b.getPath()+".paragraphs.json",true);
this.store.reload()
},onSelectionChange:function(){if(this.data.getSelectedRecords().length>0){this.selectButton.enable()
}else{this.selectButton.disable()
}},onSelect:function(){var a=this.data.getSelectedRecords();
if(a.length>0){this.setValue(a[0].get("path"))
}this.dialog.hide()
},onCancel:function(a){this.dialog.hide()
}});
CQ.form.ParagraphReference.onParagraphLoad=function(){};
CQ.Ext.reg("paragraphreference",CQ.form.ParagraphReference);
CQ.form.FormWrapper=CQ.Ext.extend(CQ.Ext.util.Observable,{formEl:null,submit:function(a){if(!a){if(this.fireEvent("beforesubmit",this,false)===false){return false
}}this.form.submit();
return true
},addHiddenField:function(a,c){if(this.formEl){var b=document.createElement("input");
b.type="hidden";
b.name=a;
b.value=c;
this.formEl.appendChild(b);
return b
}return null
},constructor:function(b){var a=this;
if(typeof b.form==="string"){b.form=document.forms[b.form]
}this.form=b.form;
if(this.form){this.formEl=CQ.Ext.get(this.form);
CQ.Ext.EventManager.addListener(this.form,"submit",function(c){c.stopEvent();
if(this.fireEvent("beforesubmit",this,true)===true){this.form.submit()
}else{return false
}},this)
}this.addEvents("beforesubmit")
}});
CQ.form.SearchField=CQ.Ext.extend(CQ.Ext.form.ComboBox,{storeConfig:null,constructor:function(a){a=CQ.Util.applyDefaults(a,{width:300,pageSize:6,minChars:1,typeAhead:true,typeAheadDelay:100,validationEvent:false,validateOnBlur:false,displayField:"title",triggerClass:"x-form-search-trigger",emptyText:CQ.I18n.getMessage("Enter search query"),loadingText:CQ.I18n.getMessage("Searching..."),tpl:new CQ.Ext.XTemplate('<tpl for=".">','<div class="search-item" qtip="<nobr>{[CQ.shared.Util.htmlEncode(CQ.shared.XSS.getXSSTablePropertyValue(values, "path"))]}</nobr>">','<div class="search-thumb"',' style="background-image:url({[CQ.HTTP.externalize(CQ.shared.XSS.getXSSValue(CQ.HTTP.encodePath(values.path)), true)]}.thumb.48.48.png);"></div><div class="search-text-wrapper"><div class="search-title">{title}</div>','<div class="search-excerpt">{excerpt}</div>',"</div>",'<div class="search-separator"></div>',"</div>","</tpl>"),itemSelector:"div.search-item"});
var b=CQ.Util.applyDefaults(a.storeConfig,{proxy:new CQ.Ext.data.HttpProxy({url:a.url?a.url:"/content.search.json",method:"GET"}),baseParams:{_charset_:"utf-8"},reader:new CQ.Ext.data.JsonReader({id:"path",root:"hits",totalProperty:"results",fields:["name","path",CQ.shared.XSS.getXSSPropertyName("path"),"excerpt","title"]})});
a.store=new CQ.Ext.data.Store(b);
CQ.form.SearchField.superclass.constructor.call(this,a)
},onSelect:function(a,b){if(this.fireEvent("beforeselect",this,a,b)!==false){this.collapse();
this.fireEvent("select",this,a,b)
}},onTypeAhead:function(){}});
CQ.Ext.reg("searchfield",CQ.form.SearchField);
CQ.form.Thumbnail=CQ.Ext.extend(CQ.form.CompositeField,{thumbnailWidth:140,thumbnailHeight:100,servlet:"thumb",extension:"png",disableImageEditing:true,imageExtensions:null,renditionsInitialTimeout:20000,renditionsTimeout:10000,processRecord:function(record,path){this.path=path;
this.update();
if(this.disableImageEditing){return
}var p=path.toLowerCase();
var supported=false;
for(var i=0;
i<this.imageExtensions.length;
i++){var ext=this.imageExtensions[i];
if(p.lastIndexOf("."+ext)==path.length-ext.length-1){supported=true;
break
}}if(!supported){return
}var thumbnail=this;
this.editButton=new CQ.Ext.Button({text:CQ.I18n.getMessage("Edit..."),cls:"cq-thumbnailfield-btn",scope:this,handler:function(){var res=CQ.HTTP.eval(path+"/jcr:content.1.json");
var name=res.currentOriginal?res.currentOriginal:"original";
var url=path+"/jcr:content/renditions/cq5dam.thumbnail.48.48.png/jcr:content.json";
url=CQ.HTTP.noCaching(url);
var tInfo=CQ.HTTP.eval(url);
try{var m=tInfo["jcr:lastModified"];
this.formerCk=new Date(m).getTime()
}catch(e){this.formerCk=new Date().getTime()
}var config=CQ.WCM.getDialogConfig({name:"./"+name,xtype:"html5smartimage",cropParameter:"./crop",rotateParameter:"./rotate",disableFlush:true});
config=CQ.Util.applyDefaults(config,{title:CQ.I18n.getMessage("Image Editor"),y:50,width:480,formUrl:path+".assetimage.html",success:function(){thumbnail.waitForRenditions(true)
}});
var dialog=CQ.Util.build(config,true);
dialog.loadContent(path+"/jcr:content/renditions");
dialog.show()
}});
this.add(this.editButton);
this.doLayout()
},update:function(){var a=CQ.HTTP.externalize(this.path,true)+"."+this.servlet+"."+this.thumbnailHeight+"."+this.thumbnailWidth+"."+this.extension;
a=CQ.HTTP.noCaching(a);
this.image.el.setStyle({"background-image":"url("+a+")"})
},setValue:function(a){},getValue:function(){return""
},getName:function(){return""
},waitForRenditions:function(initialCall,loadMask){var ae=this;
if(initialCall){var dialog=this.findParentByType("dialog");
loadMask=new CQ.Ext.LoadMask(dialog.body,{msg:CQ.I18n.getMessage("Processing renditions..."),removeMask:true});
loadMask.show();
this.renditionsTimeoutId=window.setTimeout(function(){ae.waitForRenditions(false,loadMask)
},this.renditionsInitialTimeout)
}else{var url=this.path+"/jcr:content/renditions/cq5dam.thumbnail.48.48.png/jcr:content.json";
url=CQ.HTTP.noCaching(url);
var tInfo=CQ.HTTP.eval(url);
var ck;
try{var m=tInfo["jcr:lastModified"];
ck=new Date(m).getTime()
}catch(e){ck=new Date().getTime()
}if(ck==this.formerCk){this.renditionsTimeoutId=window.setTimeout(function(){ae.waitForRenditions(false,loadMask)
},this.renditionsTimeout)
}else{loadMask.hide();
this.update(this.path)
}}},initComponent:function(){CQ.form.Thumbnail.superclass.initComponent.call(this);
this.image=new CQ.Ext.Panel({border:false,width:this.thumbnailWidth,height:this.thumbnailHeight,cls:"cq-thumbnailfield-thumbnail",bodyStyle:{background:"none"}});
this.add(this.image)
},constructor:function(a){CQ.Ext.applyIf(a,{cls:"cq-thumbnailfield",border:false,imageExtensions:["jpg","gif","png","jpeg"]});
CQ.form.Thumbnail.superclass.constructor.call(this,a)
}});
CQ.Ext.reg("thumbnail",CQ.form.Thumbnail);
CQ.SearchField=CQ.form.SearchField;
CQ.ShowHideRuleEditor=CQ.Ext.extend(CQ.Dialog,{componentName:"",componentLabel:"",expression:"",expertMode:false,localFields:undefined,allFields:undefined,okHandler:function(a){},cancelHandler:function(){},constructor:function(a){if(!a.expression){a.expression=this.expression
}if(!a.okHandler){a.okHandler=this.okHandler
}if(!a.cancelHandler){a.cancelHandler=this.cancelHandler
}var g={closable:true,closeAction:"close",width:615,modal:true,title:CQ.I18n.getMessage("Edit Show / Hide Rules"),items:{xtype:"panel",items:[{xtype:"panel",layout:"hbox",bodyStyle:"border:none",hideLabel:true,items:[{xtype:"selection",type:"select",name:"showHideDropdown",editable:false,hideLabel:true,width:60,options:[{text:CQ.I18n.getMessage("Show",null,"Show/Hide Rule part 1"),value:"show"},{text:CQ.I18n.getMessage("Hide",null,"Show/Hide Rule part 1"),value:"hide"}]},{xtype:"static",width:6},{xtype:"textfield",name:"componentLabelTextField",width:176,disabled:true,disabledClass:""},{xtype:"static",text:CQ.I18n.getMessage("if",null,"Show/Hide Rule part 2"),style:"padding-left:6px; padding-right:6px; padding-top:5px"},{xtype:"selection",type:"select",name:"anyAllDropdown",editable:false,hideLabel:true,width:46,options:[{text:CQ.I18n.getMessage("all",null,"Show/Hide Rule part 3"),value:"&&"},{text:CQ.I18n.getMessage("any",null,"Show/Hide Rule part 3"),value:"||"}]},{xtype:"static",text:CQ.I18n.getMessage("of the following are met:",null,"Show/Hide Rule part 4"),style:"padding-left:6px; padding-top:5px"}]},{xtype:"panel",name:"conditionsPanel",border:true,bodyBorder:false,bodyStyle:"padding: 6px",items:[{xtype:"toolbar",cls:"cq-multifield-toolbar",items:["->",{xtype:"textbutton",text:CQ.I18n.getMessage("Add Condition"),style:"padding-right:6px",scope:this,handler:function(){this.addCondition()
}},{xtype:"button",iconCls:"cq-condition-add",template:new CQ.Ext.Template('<span><button class="x-btn" type="{0}"></button></span>'),scope:this,handler:function(){this.addCondition()
}}]}]}]},buttonAlign:"left",buttons:[{xtype:"textbutton",text:CQ.I18n.getMessage("Javascript"),scope:this,handler:function(){this.showExpertDialog(this.getExpression());
this[this.closeAction]()
}},"->",CQ.Dialog.OK,CQ.Dialog.CANCEL]};
CQ.Util.applyDefaults(a,g);
CQ.ShowHideRuleEditor.superclass.constructor.call(this,a);
if(!this.allFields){try{this.allFields=CQ.utils.Form.getFields()
}catch(c){CQ.Log.warn("CQ.utils.Form#getFields failed: "+c.message);
this.allFields=[]
}}if(!this.localFields){this.localFields=[];
for(var b=0;
b<this.allFields.length;
b++){if(this.allFields[b].local){if(this.fieldIsThisComponent(this.allFields[b].value)){continue
}this.localFields.push(this.allFields[b])
}}}this.initFromExpression();
if(this.expertMode){this.showExpertDialog(this.expression)
}else{this.show()
}},fieldIsThisComponent:function(a){if(a==this.componentName){return true
}if(a.indexOf(".")>0){a=a.substring(0,a.indexOf("."));
if(a==this.componentName){return true
}}return false
},showExpertDialog:function(c){var a={label:CQ.I18n.getMessage("Javascript Expression"),javascript:c,okHandler:this.initialConfig.okHandler,cancelHandler:this.initialConfig.cancelHandler,width:this.initialConfig.width};
if(this.expertMode){a.description=CQ.I18n.getMessage("(Expression was too complex to represent in dropdown menus.)")
}var b=new CQ.JavascriptEditor(a);
b.show()
},addCondition:function(j){var b={expression:j,localFields:this.localFields,allFields:this.allFields,deleteHandler:function(m){var k=m.findParentByType("panel");
k.remove(m.getId())
}};
var c=new CQ.form.ConditionField(b);
var a=this.find("name","conditionsPanel")[0];
var g=a.items.getCount()-1;
a.insert(g,c);
this.doLayout()
},getExpression:function(){var k="";
var c="";
var b=" "+this.find("name","anyAllDropdown")[0].getValue()+" ";
var n="";
if(this.find("name","showHideDropdown")[0].getValue()=="show"){c="(";
n=")"
}else{c="!(";
n=")"
}var j=this.find("name","conditionsPanel")[0].items;
for(var a=0;
a<j.getCount();
a++){var m=j.itemAt(a);
if(m.getExpression==undefined){continue
}var g=j.itemAt(a).getExpression();
if(g!=null){if(k==""){k=c+g
}else{k+=b+g
}}}if(k!=""){k+=n
}return k
},initFromExpression:function(){var b=CQ.Util.trim(this.expression);
this.expertMode=false;
var k=this.find("name","showHideDropdown")[0];
if(b.charAt(0)=="!"){k.setValue("hide");
b=CQ.Util.trim(b.slice(1))
}else{k.setValue("show")
}b=CQ.Util.unwrapParens(b);
var c=this.find("name","componentLabelTextField")[0];
c.setValue(this.componentLabel);
var j=this.find("name","anyAllDropdown")[0];
j.setValue("&&");
var m=[];
if(b.indexOf("&&")>0){m=b.split("&&")
}else{if(b.indexOf("||")>0){j.setValue("||");
m=b.split("||")
}else{if(b.length>0){m=[b]
}}}for(var g=0;
g<m.length;
g++){var a=CQ.utils.Form.parseCondition(m[g]);
if(!a){this.expertMode=true;
return
}if(!CQ.utils.Form.searchArray(this.allFields,"value",a.left)){this.expertMode=true;
return
}if(!CQ.Util.isLiteral(a.right)){this.expertMode=true;
return
}}if(m.length==0){this.addCondition("")
}else{for(g=0;
g<m.length;
g++){this.addCondition(m[g])
}}},getOkConfig:function(){return{text:this.okText,cls:"cq-btn-ok",handler:function(a){var b=this.getExpression();
this[this.closeAction]();
this.okHandler(b)
}}
},getCancelConfig:function(){return{text:this.cancelText,cls:"cq-btn-cancel",handler:function(a){this[this.closeAction]();
this.cancelHandler()
}}
}});
CQ.JavascriptEditor=CQ.Ext.extend(CQ.Dialog,{label:CQ.I18n.getMessage("Javascript Source"),javascript:"",okHandler:function(a){},cancelHandler:function(){},constructor:function(a){if(!a.label){a.label=this.label
}if(!a.okHandler){a.okHandler=this.okHandler
}if(!a.cancelHandler){a.cancelHandler=this.cancelHandler
}var c={closable:true,closeAction:"close",title:CQ.I18n.getMessage("Edit Javascript"),items:{xtype:"panel",layout:"anchor",items:[{xtype:"static",text:a.label,style:"padding-bottom: 4px"},{xtype:"textarea",name:"textarea",hideLabel:true,anchor:"98% 80%"}]},buttons:[CQ.Dialog.OK,CQ.Dialog.CANCEL]};
if(a.description){c.items.items.push({xtype:"static",text:a.description,cls:"x-form-item-description"})
}CQ.Util.applyDefaults(a,c);
CQ.JavascriptEditor.superclass.constructor.call(this,a);
var b=this.find("name","textarea")[0];
b.setValue(this.javascript)
},getOkConfig:function(){return{text:this.okText,cls:"cq-btn-ok",handler:function(b){var a=this.find("name","textarea")[0].getValue();
this[this.closeAction]();
this.okHandler(a)
}}
},getCancelConfig:function(){return{text:this.cancelText,cls:"cq-btn-cancel",handler:function(a){this[this.closeAction]();
this.cancelHandler()
}}
}});
CQ.html5.Util=new function(){return{isUploadSupported:function(){var a=new XMLHttpRequest();
return !!(a&&("upload" in a)&&("onprogress" in a.upload)&&!(typeof CQ_XHR_HOOK!=="undefined"&&$CQ.isFunction(CQ_XHR_HOOK)&&window.FormData===undefined))
}}
};
CQ.html5.UploadDialog=CQ.Ext.extend(CQ.Dialog,{destinationPath:null,useHTML5:true,createVersion:false,canceled:false,constructor:function(a){var b=this;
this.useHTML5=a.useHTML5!=undefined?a.useHTML5:true;
if(!CQ.html5.Util.isUploadSupported()){this.useHTML5=false
}CQ.Util.applyDefaults(a,{closable:true,resizable:true,autoHeight:false,autoWidth:false,cls:"cq-uploaddialog",okText:CQ.I18n.getMessage("Upload"),buttons:CQ.Dialog.OKCANCEL,title:CQ.I18n.getMessage("Upload Assets"),formUrl:CQ.HTTP.externalize(CQ.shared.HTTP.encodePath(a.destinationPath)),fileUpload:true,height:300,width:400,useHTML5:this.useHTML5,items:{xtype:"panel",items:[{xtype:"static",cls:"x-form-item-description",html:CQ.I18n.getMessage("Upload to")+": "+a.displayPath},b.makeFileUploadField(this.useHTML5)],listeners:{afterrender:function(c){CQ.Ext.select(".cq-uploaddialog .x-panel-body").setStyle("overflow","hidden")
}},bodyStyle:{padding:"15px 0px 15px 15px"}},listeners:{beforesubmit:b.onBeforeSubmit,filenamechanged:b.onFileNameChanged,fileremoved:b.onFileRemoved,fileselected:b.onFileSelected,fileuploaderror:b.onFileUploadError,fileuploadok:b.onFileUploadOk,queuechanged:b.onQueueChanged,queueprocessed:b.onQueueProcessed},success:function(){window.setTimeout(function(){b.hideAndReload()
},1000)
},failure:function(){if(b.canceled){b.hideAndReload();
b.canceled=false
}else{var j=CQ.I18n.getMessage("Error");
var g=b.uploadFailed.length==1?CQ.I18n.getMessage("Failed to upload the following file:"):CQ.I18n.getMessage("Failed to upload the following files:");
g+="<br/><br/>";
for(var c=0;
c<b.uploadFailed.length;
c++){g+=CQ.shared.XSS.getXSSValue(b.uploadFailed[c])+"<br/>"
}CQ.Ext.Msg.show({title:j,msg:g,icon:CQ.Ext.Msg.ERROR,buttons:CQ.Ext.Msg.OK,fn:function(){b.hideAndReload()
}})
}}});
CQ.html5.UploadDialog.superclass.constructor.call(this,a)
},initComponent:function(){this.queue=[];
this.xhrList=[];
this.addEvents("fileuploadok","fileuploaderror","queuechanged","queueprocessed");
CQ.html5.UploadDialog.superclass.initComponent.call(this)
},hideAndReload:function(){if(this.mask){this.mask.hide()
}this.hide();
var a=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(a){a.reloadPages()
}},addFile:function(g,c){var j=c.name?c.name:c;
if(!this.getQueueItemByFileName(j)){var b;
var a;
if(this.useHTML5){b=g.ownerCt.add(this.makeFileUploadField(this.useHTML5,c));
a={file:c,fileName:j,fileSize:c.size,uploadField:b}
}else{g.ownerCt.add(this.makeFileUploadField(this.useHTML5));
a={fileName:c,uploadField:g}
}this.queue.push(a);
this.fireEvent("queuechanged")
}else{if(!this.useHTML5){g.ownerCt.add(this.makeFileUploadField(this.useHTML5));
g.clearFile()
}}},getParentPath:function(){return this.formUrl.replace(CQ.wcm.SiteAdmin.UPLOAD_URL_ASSET_REGEXP,"")
},getPostUrl:function(a){return this.formUrl
},getQueueIndex:function(b){var a=CQ.Ext.each(this.queue,function(c){return !(c.fileName===b)
});
return CQ.Ext.isDefined(a)?a:-1
},getQueueItem:function(a){return a>-1?this.queue[a]:null
},getQueueItemByFileName:function(a){return this.getQueueItem(this.getQueueIndex(a))
},makeFileUploadField:function(c,b){var a=this;
return{xtype:"html5fileuploadfield",hideLabel:true,name:name,fileNameParameter:":assetname",allowFileNameEditing:true,vtype:"name",invalidText:CQ.Ext.form.VTypes.nameText,removable:true,html5Upload:c,fileNamePrefix:a.fileNamePrefix,targetEl:a,file:b}
},onBeforeSubmit:function(dialog){dialog.uploadFailed=[];
var uploadfields=dialog.findByType("html5fileuploadfield");
var parent=CQ.HTTP.eval(CQ.HTTP.noCaching(dialog.getParentPath()+".1.json"));
var conflicts=[];
var whitespaces=["\u00A0","\u1680","\u180E","\u2000","\u2001","\u2002","\u2003","\u2004","\u2005","\u2006","\u2007","\u2008","\u2009","\u200A","\u2028","\u2029","\u202F","\u205F","\u3000"];
for(var i=0;
i<this.queue.length;
i++){var name=this.queue[i].fileName;
if(name){for(var j=0;
j<whitespaces.length;
j++){name=name.replace(whitespaces[j]," ")
}this.queue[i].fileName=name
}}for(var i=0;
i<uploadfields.length;
i++){var name=uploadfields[i].getValue();
if(name){for(var j=0;
j<whitespaces.length;
j++){name=name.replace(whitespaces[j]," ")
}}if(parent[name]){conflicts.push(name)
}else{uploadfields[i].setName(uploadfields[i].getValue().replace(/"/g,"%22"))
}}if(conflicts.length==0){var siteAdmin=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(siteAdmin){siteAdmin.mask()
}return true
}if(this.createVersion==true){return true
}var msg=conflicts.length==1?CQ.I18n.getMessage("An asset of the same name already exists in this location:"):CQ.I18n.getMessage("Assets of the same name already exist in this location:");
msg+="<br/><br/>";
for(i=0;
i<conflicts.length;
i++){msg+=CQ.shared.XSS.getXSSValue(conflicts[i])+"<br/>"
}msg+="<br/><br/>";
msg+=conflicts.length==1?CQ.I18n.getMessage("Click 'Create Version' to create the verison of the asset or <br/><br/> 'Replace' to replace the asset or 'Cancel' to adjust the name."):CQ.I18n.getMessage("Click 'Create Version' to create the verison of the assets or <br/><br/> 'Replace' to replace the assets or 'Cancel' to adjust the names.");
CQ.Ext.Msg.show({title:CQ.I18n.get("Name Conflict"),msg:msg,buttons:{yes:CQ.I18n.get("Create Version"),handler:function(){},no:CQ.I18n.get("Replace"),handler:function(){},cancel:CQ.I18n.get("Cancel"),handler:function(){}},icon:CQ.Ext.MessageBox.QUESTION,fn:function(btnId){if(btnId=="yes"){this.createVersion=true;
dialog.ok()
}else{if(btnId=="no"){for(var i=0;
i<conflicts.length;
i++){CQ.HTTP.post(dialog.getParentPath()+"/"+CQ.shared.HTTP.encodePath(conflicts[i]),null,{":operation":"delete"})
}dialog.ok()
}else{for(var u=0;
u<uploadfields.length;
u++){if(conflicts.indexOf(uploadfields[u].getValue())!=-1){uploadfields[u].markInvalid(CQ.I18n.getMessage("An asset of the same name already exists in this location."))
}}}}},scope:this});
return false
},onFileNameChanged:function(g,c,a){var b=this.getQueueIndex(a);
if(b>-1){this.queue[b].fileName=c
}},onFileRemoved:function(b){var a=this.getQueueIndex(b);
if(a>-1){this.queue.splice(a,1);
this.fireEvent("queuechanged")
}},onFileSelected:function(b,c){if(this.useHTML5){for(var a=0;
a<c.length;
a++){this.addFile(b,c[a])
}}else{this.addFile(b,c)
}this.doLayout()
},html5UploadFile:function(b){b.uploadField.initProgressBar();
var g=new XMLHttpRequest();
g.onreadystatechange=this.onFileUploadLoad.createDelegate(this,[b,g],0);
g.upload.addEventListener("progress",this.onFileUploadProgress.createDelegate(this,[b],0),false);
g.upload.addEventListener("error",this.onFileUploadError.createDelegate(this,[b],0),false);
var a=b.file;
var j=b.fileName;
if(window.FormData){var c=new FormData();
if(this.formUrl.match(CQ.wcm.SiteAdmin.UPLOAD_URL_ASSET_REGEXP)){c.append("file",a);
c.append("fileName",j)
}else{c.append(j,a)
}c.append(CQ.Sling.CHARSET,"utf-8");
g.open("POST",this.formUrl,true);
g.send(c)
}else{g.open("PUT",this.getParentPath()+"/"+CQ.shared.HTTP.encodePath(j),true);
g.send(a)
}this.xhrList.push(g)
},html5UploadFiles:function(){var c=CQ.Ext.getCmp(this.okButtonConfig.id);
if(c){c.setDisabled(true)
}var a=this.findByType("html5fileuploadfield");
a[0].setDisabled(true);
for(var b=0;
b<this.queue.length;
b++){this.html5UploadFile(this.queue[b])
}},onFileUploadError:function(b,a){b.uploadField.handleUploadProgress(b.file,0,b.fileSize,a);
if(this.uploadFailed){this.uploadFailed.push(b.fileName)
}},onFileUploadLoad:function(b,a,c){if(a.readyState===4){if(CQ.HTTP.isOkStatus(a.status)){this.fireEvent("fileuploadok",b)
}else{this.fireEvent("fileuploaderror",b,a.responseText)
}this.queue.splice(this.getQueueIndex(b.fileName),1);
if(this.queue.length==0){this.fireEvent("queueprocessed")
}}},onFileUploadOk:function(a){a.uploadField.handleUploadComplete();
window.setTimeout(function(){var b=a.uploadField.progressBar.getEl().parent("div[class*=x-form-item]");
b.fadeOut({easing:"easeOut",endOpacity:0,duration:0,concurrent:false,remove:true})
},100)
},onFileUploadProgress:function(a,b){a.uploadField.handleUploadProgress(a.file,b.loaded,b.total)
},onQueueChanged:function(){CQ.Ext.getCmp(this.okButtonConfig.id).setDisabled(this.queue.length==0)
},onQueueProcessed:function(){if(this.uploadFailed.length>0){this.failure()
}else{this.success()
}},ok:function(m){var b={};
if(this.responseScope){b.scope=this.responseScope;
b.success=this.success?this.success:this.responseScope.success;
b.failure=this.failure?this.failure:this.responseScope.failure
}else{b.scope=this;
if(this.success){b.success=this.success
}if(this.failure){b.failure=this.failure
}}if(this.form.isValid()){if(this.fireEvent("beforesubmit",this)===false){return false
}var k=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(k){k.mask()
}if(this.useHTML5){this.html5UploadFiles()
}else{this.form.items.each(function(q){if(q.emptyText&&q.el.dom.value==q.emptyText){q.setRawValue("")
}});
var j=new CQ.form.UploadSubmitAction(this.form,b);
this.form.doAction(j);
var g=this.findByType("html5fileuploadfield");
var c=(g.length==2)?CQ.I18n.getMessage("Uploading file..."):CQ.I18n.getMessage("Uploading files...");
this.mask=new CQ.Ext.LoadMask(this.body,{msg:c});
this.mask.show()
}}else{var n=[];
this.form.items.each(function(q){if(!q.validate()){n.push(q)
}});
var o=n.length==1?CQ.I18n.getMessage("Invalid Name"):CQ.I18n.getMessage("Invalid Names");
var a=n.length==1?CQ.I18n.getMessage("There is a file with an invalid name. Please verify the marked field."):CQ.I18n.getMessage("There are files with invalid names. Please verify the marked fields.");
CQ.Ext.Msg.show({title:o,msg:a,buttons:CQ.Ext.Msg.OK,icon:CQ.Ext.Msg.ERROR})
}},getOkConfig:function(){if(!this.okButtonConfig){this.okButtonConfig={id:CQ.Ext.id(),text:this.okText,cls:"cq-btn-ok",disabled:true,handler:this.ok}
}return this.okButtonConfig
},getCancelConfig:function(){return{text:this.cancelText,cls:"cq-btn-cancel",handler:function(b){if(this.mask){this.mask.hide()
}this.hide();
this.canceled=true;
for(var a=0;
a<this.xhrList.length;
a++){this.xhrList[a].abort()
}}}
}});
CQ.Ext.reg("html5uploaddialog",CQ.html5.UploadDialog);
CQ.html5.form.FileUploadField=CQ.Ext.extend(CQ.Ext.form.TextField,{allowEnctypeSetting:true,autoSize:CQ.Ext.emptyFn,buttonOffset:3,buttonOnly:false,buttonText:null,fileInputStyle:null,file:null,html5Upload:true,mimeTypes:[],mimeTypesDescription:null,multiple:true,noDisplay:false,targetEl:null,constructor:function(a){var c=this;
if(a.mimeTypes){if(!CQ.Ext.isArray(a.mimeTypes)){var b=new RegExp("[ ;]+","g");
a.mimeTypes=a.mimeTypes.split(b)
}}CQ.Util.applyDefaults(a,{hideLabel:true,name:a.name,fileNameParameter:":assetname",allowFileNameEditing:true,vtype:"name",invalidText:CQ.Ext.form.VTypes.nameText,removable:true,listeners:{change:function(j,k,g){j.fireEvent("filenamechanged",j,k,g)
}}});
if(!CQ.html5.Util.isUploadSupported()){a.html5Upload=false
}CQ.html5.form.FileUploadField.superclass.constructor.call(this,a)
},initComponent:function(){CQ.html5.form.FileUploadField.superclass.initComponent.call(this);
this.addEvents("filenamechanged","fileremoved","fileselected");
if(this.targetEl){this.targetEl.relayEvents(this,["filenamechanged","fileremoved","fileselected"])
}},setName:function(a){if(a){this.fileInput.dom.setAttribute("name",a);
this.name=a
}},onRender:function(k,b){CQ.html5.form.FileUploadField.superclass.onRender.call(this,k,b);
this.wrap=this.el.wrap({cls:"x-form-field-wrap x-form-file-wrap cq-fileupload-wrapper"});
this.el.addClass("x-form-file-text");
if(this.fileNameParameter){this.el.dom.setAttribute("name",this.fileNameParameter)
}else{this.el.dom.setAttribute("name","")
}var c=this.name||this.getId();
var j={id:this.getFileInputId(),name:c,cls:"x-form-file",tag:"input",type:"file",size:1};
if(this.html5Upload&&this.multiple){j.multiple=true
}this.fileInput=this.wrap.createChild(j);
if(!this.html5Upload){var n={name:c+"@TypeHint",tag:"input",type:"hidden",value:"nt:file"};
this.wrap.createChild(n)
}if(!this.buttonText){this.buttonText=CQ.I18n.getMessage("Browse...")
}var g=CQ.Ext.applyIf(this.buttonCfg||{},{text:this.buttonText});
this.button=new CQ.Ext.Button(CQ.Ext.apply(g,{renderTo:this.wrap,cls:"x-form-file-btn"+(g.iconCls?" x-btn-icon":"")}));
if(this.buttonOnly){this.el.hide();
this.wrap.setWidth(this.button.getEl().getWidth());
this.fileInput.addClass("x-form-file-button-only");
this.button.addClass("x-form-file-button-only")
}this.fileInput.setWidth((this.button.getEl().getComputedWidth()||55));
if(this.fileInputStyle){for(var a in this.fileInputStyle){try{this.fileInput.setStyle(a,this.fileInputStyle[a])
}catch(m){}}}if(this.file){this.setValue(this.getFileName());
this.switchToClearButton()
}else{this.fileInput.on("change",function(){if(this.html5Upload){var r=this.fileInput.dom.files;
this.uploadAllowed=this.checkHTML5UploadAllowed(r);
if(!this.uploadAllowed){return false
}this.fireEvent("fileselected",this,r)
}else{var o=this.fileInput.dom.value;
if(o.lastIndexOf("\\")!=-1){o=o.substring(o.lastIndexOf("\\")+1)
}this.setValue(o);
this.switchToClearButton();
if(this.allowEnctypeSetting){try{var q=this.findParentByType("form").getForm().el.dom;
q.enctype="multipart/form-data";
q.encoding="multipart/form-data"
}catch(t){}}this.fireEvent("fileselected",this,o)
}},this)
}if(this.noDisplay){this.setVisible(false);
this.button.setVisible(false)
}},checkHTML5UploadAllowed:function(g){var m=[];
for(var c=0;
c<g.length;
c++){var b=g[c];
var a;
for(a=0;
a<this.mimeTypes.length;
a++){var k=this.mimeTypes[a];
if(this.checkMimeTypeAllowed(b.type,k)||this.checkFileExtensionAllowed(b.name,k)){break
}}if(a>0&&a==this.mimeTypes.length){m.push(b.name)
}}return this.displayErrors(m)
},displayErrors:function(c){if(c.length==0){return true
}var b=c.length==1?CQ.I18n.getMessage("Selected file is not accepted:"):CQ.I18n.getMessage("Selected files are not accepted:");
b+="<br/><br/>";
for(var a=0;
a<c.length;
a++){b+=CQ.shared.XSS.getXSSValue(c[a])+"<br/>"
}if(this.mimeTypesDescription){b+="<br/>"+CQ.I18n.getMessage("Expecting: {0}",this.mimeTypesDescription)
}CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),b);
return false
},checkMimeTypeAllowed:function(j,c){var b=/(.+)\/(.+)/;
var g=c.match(b);
if(g){var a=j.match(b);
if(a[1].toLowerCase()===g[1].toLowerCase()){if(g[2]==="*"){return true
}return a[2].toLowerCase()===g[2].toLowerCase()
}}return false
},checkFileExtensionAllowed:function(j,c){var b=/(.+)\.(.+)$/;
var g=c.match(b);
if(g){var a=j.match(b);
if(g[1]==="*"||a[1].toLowerCase()===g[1].toLowerCase()){if(g[2]==="*"){return true
}return a[2].toLowerCase()===g[2].toLowerCase()
}}return false
},switchToClearButton:function(){if(this.removable){this.button.setText(CQ.I18n.getMessage("Clear"));
this.button.on("click",this.clearFile,this);
this.fileInput.applyStyles("z-index: -100")
}},clearFile:function(){var a=this.ownerCt;
this.fireEvent("fileremoved",this.getValue());
a.remove(this,true);
a.ownerCt.doLayout()
},destroy:function(){var a=this.getEl().dom.parentNode;
this.fileInput.remove();
this.button.destroy();
CQ.html5.form.FileUploadField.superclass.destroy.call(this);
a.parentNode.removeChild(a)
},getFileInputId:function(){return this.id+"-file"
},initProgressBar:function(){this.progressBar=new CQ.Ext.ProgressBar({text:"&nbsp;"});
this.progressText=new CQ.Static({cls:"cq-fileuploadfield-progress-text"});
new CQ.Ext.Panel({renderTo:this.wrap.insertSibling({tag:"div",cls:"cq-fileupload-progress-wrapper"}),border:false,bodyStyle:"width: "+this.wrap.getWidth(true)+"px;",anchorTo:this.wrap,items:[this.progressBar,this.progressText]});
new CQ.Ext.Button({renderTo:this.progressBar.wrap,text:CQ.I18n.getMessage("Cancel")});
this.wrap.remove()
},getFileName:function(){if(this.file){return this.file.name?this.file.name:this.file
}return null
},handleUploadProgress:function(a,b,j){if(!this.progressBar){this.initProgressBar()
}var g=Math.round(100*b/j);
var c=CQ.I18n.getMessage("{0} of {1}",[CQ.Util.formatFileSize(b),CQ.Util.formatFileSize(j)],"file upload progress");
this.progressBar.updateProgress(g/100,CQ.shared.XSS.getXSSValue(a.name).replace("\\\\\\\\","\\"));
this.progressText.updateText(c)
},handleUploadComplete:function(){if(!this.progressBar){this.initProgressBar()
}this.progressBar.updateProgress(1);
this.progressText.updateText(CQ.I18n.getMessage("Complete",null,"adjective"))
},onResize:function(a,b){CQ.html5.form.FileUploadField.superclass.onResize.call(this,a,b);
this.wrap.setWidth(a);
if(!this.buttonOnly){var a=this.wrap.getWidth()-this.button.getEl().getWidth()-this.buttonOffset;
this.el.setWidth(a)
}},preFocus:CQ.Ext.emptyFn,getResizeEl:function(){return this.wrap
},getPositionEl:function(){return this.wrap
},alignErrorIcon:function(){this.errorIcon.alignTo(this.wrap,"tl-tr",[2,0])
},setDisabled:function(a){CQ.html5.form.FileUploadField.superclass.setDisabled.call(this,a);
this.button.setDisabled(a)
}});
CQ.Ext.reg("html5fileuploadfield",CQ.html5.form.FileUploadField);
CQ.html5.form.SmartFile=CQ.Ext.extend(CQ.form.CompositeField,{iconResources:null,extensionToIcon:null,defaultIcon:null,useHTML5:true,mimeTypes:null,mimeTypesDescription:null,ddGroups:null,ddAccept:null,sizeLimit:0,fileLimit:0,invalidClass:null,fixedHeight:null,compWidth:0,compHeight:0,fileNameParameter:null,fileReferenceParameter:null,fileNameInputField:null,moveParameter:null,deleteFileParameter:null,deletePathParameter:null,lockIconCls:null,lockPanelCls:null,lockHintCls:null,cancelInheritanceText:null,revertInheritanceText:null,uploadText:null,uploadTextUpload:null,uploadTextReference:null,uploadTextFallback:null,uploadIconCls:null,uploadPanelCls:null,uploadHintCls:null,removeUploadPanelClsOnProgress:false,validateOnSubmitOnly:false,allowUpload:false,allowFileReference:false,allowFileNameEditing:false,transferFileName:false,noFileNameText:"",isUploaded:false,textEl:null,lockTextEl:null,uploadPanel:null,fileInfo:null,serverFileInstance:null,referencedFileInfo:null,renditionSuffix:null,fallbackRenditionSuffix:null,headPanel:null,footPanel:null,instanceId:0,constructor:function(a){this.instanceId=CQ.html5.form.SmartFile.ID_COUNTER++;
this.useHTML5=a.useHTML5!=undefined?a.useHTML5:true;
if(!CQ.html5.Util.isUploadSupported()){this.useHTML5=false
}a=a||{};
var b={hideBorders:true,border:false,anchor:CQ.themes.Dialog.ANCHOR,mimeTypes:"*.*",mimeTypesDescription:CQ.I18n.getMessage("All files"),ddAccept:"*",sizeLimit:0,fileLimit:100,stateful:false,allowBlank:true,validateOnSubmitOnly:false,invalidClass:"cq-smartfile-invalid",allowUpload:true,allowFileReference:true,allowFileNameEditing:true,transferFileName:true,noFileNameText:"???",uploadPanelCls:"cq-upload-border",uploadHintCls:"cq-upload-hint",removeUploadPanelClsOnProgress:true,lockIconCls:"cq-lock-placeholder",lockHintCls:"cq-lock-hint",lockPanelCls:"cq-lock-panel",uploadIconCls:"cq-file-placeholder",uploadTextUpload:CQ.I18n.getMessage("Click to upload"),uploadTextReference:CQ.I18n.getMessage("Drop an asset"),uploadTextFallback:CQ.I18n.getMessage("Upload file"),uploadText:CQ.I18n.getMessage("Drop an asset or click to upload"),cancelInheritanceText:CQ.I18n.getMessage("Click to cancel inheritance"),revertInheritanceText:CQ.I18n.getMessage("Click here to revert inheritance"),iconResources:CQ.themes.SmartFile.ICON_RESOURCES,extensionToIcon:CQ.themes.SmartFile.EXTENSION_TO_ICON,defaultIcon:CQ.themes.SmartFile.DEFAULT_ICON,renditionSuffix:CQ.html5.form.SmartFile.DAM_RENDITIONS_PATH+CQ.html5.form.SmartFile.DAM_WEB_RENDITION_NAME,fallbackRenditionSuffix:CQ.html5.form.SmartFile.DAM_RENDITION_SUFFIX,height:120,listeners:{resize:this.onComponentResize,fileselected:this.onFileSelected},useHTML5:this.useHTML5};
if(a.allowFileReferenceOnly!==undefined){a.allowFileReference=!a.allowFileReferenceOnly;
delete a.allowFileReferenceOnly
}if(this.allowUploadOnly!==undefined){a.allowUpload=!a.allowUploadOnly;
delete a.allowUploadOnly
}if(!a.allowFileReference&&!a.allowUpload){a.allowFileReference=true
}a.autoScroll=false;
a.bodyStyle="padding: 0px; overflow: hidden;";
a.layout="border";
CQ.Util.applyDefaults(a,b);
if(a.height&&(a.height!="auto")){this.fixedHeight=a.height
}else{this.fixedHeight=null
}CQ.html5.form.SmartFile.superclass.constructor.call(this,a)
},initComponent:function(){CQ.html5.form.SmartFile.superclass.initComponent.call(this);
var b=this;
this.containerPanel=new CQ.Ext.Panel({region:"center",ctCls:CQ.DOM.encodeClass("smartfile-"+this.name),activeItem:0,autoScroll:false,bodyStyle:"padding: 0px; overflow: hidden;",layout:"card"});
this.add(this.containerPanel);
this.lockPanel=new CQ.Ext.Panel({itemId:"lock",cls:this.lockPanelCls,layout:"fit",border:false,style:"padding: 0;",bodyStyle:"position: relative; top: 0; left: 0;",listeners:{resize:function(j,k,g){if(typeof k=="object"){g=k.height;
k=k.width
}this._width=k;
this._height=g;
if(this.rendered){b.setTextElSize(b.lockTextEl,k,g)
}}},afterRender:function(){CQ.Ext.Panel.prototype.afterRender.call(this);
this.el.setVisibilityMode(CQ.Ext.Element.DISPLAY);
this.body.setVisibilityMode(CQ.Ext.Element.DISPLAY);
if(b.fixedHeight){var g=b.fixedHeight;
this.el.setHeight(g);
this.body.setHeight(g-this.el.getBorderWidth("tb"))
}}});
this.containerPanel.add(this.lockPanel);
this.uploadPanel=new CQ.Ext.Panel({itemId:"upload",cls:this.uploadPanelCls,layout:"fit",border:false,style:"padding: 0;",bodyStyle:"position: relative; top: 0; left: 0;",listeners:{resize:function(j,k,g){if(typeof k=="object"){g=k.height;
k=k.width
}this._width=k;
this._height=g;
if(this.rendered){b.setTextElSize(b.textEl,k,g);
b.setProgressBarSize(k,g)
}}},afterRender:function(){CQ.Ext.Panel.prototype.afterRender.call(this);
this.el.setVisibilityMode(CQ.Ext.Element.DISPLAY);
this.body.setVisibilityMode(CQ.Ext.Element.DISPLAY);
if(b.fixedHeight){var g=b.fixedHeight;
this.el.setHeight(g);
this.body.setHeight(g-this.el.getBorderWidth("tb"))
}}});
this.containerPanel.add(this.uploadPanel);
this.createFileNameEditingCapability();
this.processingPanel=this.createProcessingPanel();
this.containerPanel.add(this.processingPanel);
this.createHiddenInterfaceFields();
if(this.headPanel){this.headPanel.region="north";
this.add(this.headPanel)
}if(this.footPanel){this.footPanel.region="south";
this.add(this.footPanel)
}if(!this.useHTML5){var a={name:this.name,fieldLabel:this.uploadTextFallback,fileNameParameter:this.fileNameParameter,allowFileNameEditing:this.allowFileNameEditing,html5Upload:false,multiple:false,mimeTypes:this.mimeTypes,mimeTypesDescription:this.mimeTypesDescription,removable:false,targetEl:this};
if(this.fullTab){a.fieldLabel=this.uploadTextFallback
}this.fallbackFileField=new CQ.html5.form.FileUploadField(a);
var c={itemId:"fallback",layout:"form",defaults:{anchor:CQ.themes.Dialog.ANCHOR},hideMode:"offsets",border:false,items:this.fallbackFileField};
if(this.fullTab){c.bodyStyle=CQ.themes.Dialog.TAB_BODY_STYLE
}else{c.defaults.hideLabel=true
}this.fallbackPanel=new CQ.Ext.Panel(c);
this.containerPanel.add(this.fallbackPanel)
}},getToplevel:function(){var a=this.findParentByType("dialog");
if(!a){a=this.findParentByType(CQ.Ext.form.FormPanel)
}return a
},onRender:function(b,j){CQ.html5.form.SmartFile.superclass.onRender.call(this,b,j);
this.el.setVisibilityMode(CQ.Ext.Element.DISPLAY);
this.body.setVisibilityMode(CQ.Ext.Element.DISPLAY);
var a=this.findParentByType("dialog");
if(a){a.on("beforesubmit",function(){this.syncFormElements();
return this.onBeforeSubmit()
},this)
}else{var c=this.findParentByType(CQ.Ext.form.FormPanel);
if(c){var g=c.getForm();
g.on("beforeaction",function(){this.syncFormElements();
return this.onBeforeSubmit()
},this)
}}},afterRender:function(){CQ.html5.form.SmartFile.superclass.afterRender.call(this);
this.initializeDragAndDrop()
},onComponentResize:function(b,a){if(typeof b=="object"){a=b.height;
b=b.width
}this.compWidth=b;
this.compHeight=a
},switchPropertyInheritance:function(){},markInvalid:function(a){if(!this.rendered||this.preventMark){return
}a=a||this.invalidText;
this.uploadPanel.body.addClass(this.invalidClass);
this.processingPanel.markInvalid(this.invalidClass);
this.uploadPanel.body.dom.qtip=a;
this.uploadPanel.body.dom.qclass="x-form-invalid-tip";
if(CQ.Ext.QuickTips){CQ.Ext.QuickTips.enable()
}this.fireEvent("invalid",this,a)
},clearInvalid:function(){if(!this.rendered||this.preventMark){return
}this.uploadPanel.body.removeClass(this.invalidClass);
this.processingPanel.clearInvalid(this.invalidClass);
this.fireEvent("valid",this)
},validateOnStateChange:function(){if(!this.validateOnSubmitOnly){this.validate()
}this.validateLinkingFieldsOnStateChange()
},validateLinkingFieldsOnStateChange:function(){var g=this.getToplevel();
if(g){var b=CQ.Util.findFormFields(g);
if(b){for(var a in b){if(b.hasOwnProperty(a)){var k=b[a];
var j=k.length;
for(var m=0;
m<j;
m++){var c=k[m];
if(c.linkedComponent==this.name){c.validate()
}}}}}}},hasData:function(){return(this.fileInfo!=null)||(this.referencedFileInfo!=null)
},hasUploadedData:function(){return(this.fileInfo!=null)
},hasReferencedData:function(){return(this.referencedFileInfo!=null)
},createFileNameEditingCapability:function(){if(!this.allowFileNameEditing){this.fileNameField=new CQ.Ext.form.Hidden({disabled:!this.transferFileName})
}else{this.fileNameField=new CQ.Ext.form.TextField({autoHeight:false});
this.transferFileName=true
}this.containerPanel.add(this.fileNameField)
},createHiddenInterfaceFields:function(){this.fileReferenceField=new CQ.Ext.form.Hidden({disabled:true});
this.containerPanel.add(this.fileReferenceField);
this.moveParameter=new CQ.Ext.form.Hidden({disabled:true});
this.containerPanel.add(this.moveParameter);
this.deleteFileParameter=new CQ.Ext.form.Hidden({disabled:true,value:"true"});
this.containerPanel.add(this.deleteFileParameter);
this.deletePathParameter=new CQ.Ext.form.Hidden({disabled:true,value:"true"});
this.containerPanel.add(this.deletePathParameter);
this.lastModifiedParameter=new CQ.Ext.form.Hidden({disabled:true,value:""});
this.containerPanel.add(this.lastModifiedParameter);
this.lastModifiedByParameter=new CQ.Ext.form.Hidden({disabled:true,value:""});
this.containerPanel.add(this.lastModifiedByParameter)
},onBeforeSubmit:function(){return true
},getRawValue:function(){var a="";
if(this.fileInfo){a+='[instance:"'+this.fileInfo.dataPath+'" "'+this.fileInfo.mimeType+'" '+this.fileInfo.size+"]"
}if(this.referencedFileInfo){a+='[reference:"'+this.referencedFileInfo.dataPath+'" "'+this.referencedFileInfo.mimeType+'" '+this.referencedFileInfo.size+"]"
}if(this.fileNameInputField){a+='[fileName:"'+this.fileNameInputField.getValue()+'"]'
}return a
},createRefUrl:function(a){var c="";
for(var g in a.renditions){var j=CQ.html5.form.SmartFile.DAM_RENDITIONS_PATH+g;
if(j==this.renditionSuffix){break
}if(j.indexOf(this.renditionSuffix)==0){c=g.substring(g.lastIndexOf("."));
break
}}var b=a.dataPath+this.renditionSuffix+c;
return CQ.HTTP.externalize(CQ.shared.HTTP.encodePath(b),true)
},createFallbackRefUrl:function(a){var b=a.dataPath+this.fallbackRenditionSuffix;
return CQ.HTTP.externalize(CQ.shared.HTTP.encodePath(b),true)
},getSuitableFileInfo:function(){if(this.referencedFileInfo!=null){return this.referencedFileInfo
}return this.fileInfo
},processPath:function(b,a){if(a){this.dataPath=b;
this.isUploaded=false;
this.fileInfo=null;
this.referencedFileInfo=null;
this.validateOnStateChange();
this.syncFormElements();
this.updateView();
if(CQ.undo.UndoManager.isEnabled()){CQ.undo.util.UndoUtils.addBlobMarkerField(this.getToplevel(),{type:"create",path:b,field:this.getName()})
}}},processRecord:function(b,m){if(this.fireEvent("beforeloadcontent",this,b,m)!==false){if("allowUpload" in b.data){this.allowUpload=b.data.allowUpload
}this.dataPath=m;
this.isUploaded=false;
this.fileInfo=null;
this.referencedFileInfo=null;
var n;
if(this.fileNameParameter){n=b.get(this.fileNameParameter)
}if(this.fileReferenceParameter){var c=b.get(this.fileReferenceParameter);
if(c){this.referencedFileInfo=this.resolveReference(c,m);
if(n){this.referencedFileInfo.fileName=n
}this.referencedFileInfo.url=this.createRefUrl(this.referencedFileInfo);
this.referencedFileInfo.fallbackUrl=this.createFallbackRefUrl(this.referencedFileInfo)
}}var k=b.get(this.name);
if(k){if(k["jcr:content"]){k=CQ.Sling.processBinaryData(k["jcr:content"])
}else{k=CQ.Sling.processBinaryData(k)
}if(k){var g=CQ.Sling.getContentPath(this.name,m);
this.fileInfo={fileName:n,dataPath:g,mimeType:k.type,size:k.size,url:CQ.HTTP.externalize(g,true)};
this.serverFileInstance=this.fileInfo
}}this.postProcessRecord(b,m);
this.validateOnStateChange();
this.syncFormElements();
this.updateView();
if(CQ.undo.UndoManager.isEnabled()){var a=this.getToplevel();
CQ.undo.util.UndoUtils.addBlobMarkerField(this.getToplevel(),{type:"update",path:m,field:this.getName()});
var j=(a.getXType()=="dialog"?a.form:(a.getXType()=="form"?a.getForm():null));
if(j){if(this.fileNameField&&!j.items.contains(this.fileNameField)){j.add(this.fileNameField)
}}}this.fireEvent("loadcontent",this,b,m)
}},postProcessRecord:function(a,b){},resolveReference:function(fileRef,basePath){var refFileInfo=null;
var originalFileRef=fileRef;
try{if(fileRef.indexOf("/")==0){fileRef=fileRef+"/jcr:content.infinity";
var json=CQ.HTTP.eval(CQ.shared.HTTP.encodePath(fileRef)+CQ.HTTP.EXTENSION_JSON);
var refValue=CQ.Util.formatData(json);
if(refValue){refFileInfo=CQ.Sling.processBinaryData(refValue);
if(refFileInfo.renditions&&refFileInfo.renditions.original&&refFileInfo.renditions.original["jcr:content"]){refFileInfo.size=refFileInfo.renditions.original["jcr:content"][":jcr:data"];
refFileInfo.mimeType=refFileInfo.renditions.original["jcr:content"]["jcr:mimeType"]
}if(!refFileInfo.mimeType&&refFileInfo.metadata){refFileInfo.mimeType=refFileInfo.metadata["dc:format"]
}if(basePath){refFileInfo.dataPath=CQ.Sling.getContentPath(originalFileRef,basePath);
refFileInfo.url=CQ.HTTP.externalize(refFileInfo.dataPath)
}else{refFileInfo.dataPath=originalFileRef;
refFileInfo.url=originalFileRef
}}}else{refFileInfo={dataPath:fileRef,url:fileRef}
}}catch(e){CQ.Log.error("SmartFile#resolveReference: failed to resolve reference: "+e.message)
}return refFileInfo
},syncFormElements:function(){var k=this.name;
if(this.uploadName){k=this.uploadName;
if(k.length<2||k.substring(0,2)!="./"){k="./"+k
}}if(this.fileNameField){if(!this.fileNameParameter){this.fileNameParameter=k+CQ.html5.form.SmartFile.PARAM_FILENAME_SUFFIX
}if(this.useHTML5||this.containerPanel.layout.activeItem.itemId!="fallback"){this.fileNameField.getEl().dom.name=this.fileNameParameter;
if(this.fallbackFileField){this.fallbackFileField.getEl().dom.name=""
}}else{this.fileNameField.getEl().dom.name="";
this.fallbackFileField.getEl().dom.name=this.fileNameParameter
}}if(this.fileReferenceField){if(!this.fileReferenceParameter){this.fileReferenceParameter=k+CQ.html5.form.SmartFile.PARAM_REFERENCE_SUFFIX
}this.fileReferenceField.getEl().dom.name=this.fileReferenceParameter
}if(this.moveParameter){this.moveParameter.getEl().dom.name=k+CQ.Sling.MOVE_SUFFIX
}if(this.deleteFileParameter){this.deleteFileParameter.getEl().dom.name=k+CQ.Sling.DELETE_SUFFIX
}if(this.fileReferenceField){var c=(this.referencedFileInfo?this.referencedFileInfo.dataPath:"");
this.fileReferenceField.setValue(c);
this.fileReferenceField.enable()
}if(this.moveParameter){if(this.fileInfo&&this.isUploaded){this.moveParameter.setValue(this.fileInfo.dataPath);
this.moveParameter.enable()
}else{this.moveParameter.disable()
}}if(this.useHTML5&&this.deleteFileParameter){if(this.serverFileInstance&&!this.fileInfo){this.deleteFileParameter.enable()
}else{this.deleteFileParameter.disable()
}}var a=false;
var b;
var j=k.lastIndexOf("/");
if(j>0){var g=k.substring(0,j);
if(g!="."){a=true;
b=g
}}if(a){this.lastModifiedParameter.getEl().dom.name=b+"/jcr:lastModified";
this.lastModifiedByParameter.getEl().dom.name=b+"/jcr:lastModifiedBy";
this.lastModifiedParameter.enable();
this.lastModifiedByParameter.enable()
}else{this.lastModifiedParameter.getEl().dom.name=null;
this.lastModifiedByParameter.getEl().dom.name=null;
this.lastModifiedParameter.disable();
this.lastModifiedByParameter.disable()
}},flush:function(){if(this.referencedFileInfo){this.referencedFileInfo=null
}else{if(this.fileInfo){this.fileInfo=null
}}if((this.referencedFileInfo==null)&&(this.fileInfo==null)&&this.fileNameField){this.fileNameField.setValue("")
}this.validateOnStateChange();
if(!this.useHTML5){this.deleteFileParameter.enable();
this.fallbackFileField.fileInput.dom.name="";
this.fallbackFileField.setValue("")
}},createLockPanel:function(){this.isLockPanelCreated=true;
var c=this.lockPanel.body;
var k=this.lockPanel.items.getCount();
for(var b=k-1;
b>=0;
b--){this.remove(this.lockPanel.items.itemAt(b))
}var a;
if(this.lockIconCls){a='<img src="'+CQ.Ext.BLANK_IMAGE_URL+'" alt="" border="0" class="'+this.lockIconCls+'"><br>'
}else{a=""
}var g=this.cancelInheritanceText;
var j=a+g;
this.lockTextEl=c.createChild({tag:"div",html:j});
this.lockTextEl.addListener("click",function(){this.switchPropertyInheritance()
},this);
this.lockTextEl.setVisibilityMode(CQ.Ext.Element.DISPLAY);
if(this.lockPanel._width&&this.lockPanel._height){this.setTextElSize(this.lockTextEl,this.lockPanel._width,this.lockPanel._height)
}if(this.lockHintCls){this.lockTextEl.addClass(this.lockHintCls)
}},updateView:function(){if(this.editLock){this.containerPanel.getLayout().setActiveItem("lock");
if(!this.isLockPanelCreated){this.createLockPanel()
}}else{var a=(this.fileInfo!=null)||(this.referencedFileInfo!=null);
this.updateViewBasics(a);
if(a){this.createProcessingPanelContents()
}}this.doLayout()
},updateViewBasics:function(a){if(!a){this.containerPanel.getLayout().setActiveItem("upload");
if(!this.isUploadPanelCreated){this.createUploadPanel()
}else{this.switchToUploadBase()
}if(this.uploadHintCls){this.body.addClass(this.uploadHintCls);
if(this.textEl){this.textEl.addClass(this.uploadHintCls)
}}}else{if(this.uploadHintCls){this.body.removeClass(this.uploadHintCls);
if(this.textEl){this.textEl.removeClass(this.uploadHintCls)
}}this.containerPanel.getLayout().setActiveItem("processing")
}},createProcessingPanel:function(){return new CQ.form.SmartFile.FileInfoDisplay({itemId:"processing",fileNameField:(this.allowFileNameEditing&&this.fileNameField?this.fileNameField:null),parentComponent:this})
},createProcessingPanelContents:function(){var g=this.getSuitableFileInfo();
var c=g.fileName;
var n=null;
if(c){var j=c.lastIndexOf(".");
if((j>=0)&&(j<(c.length-1))){n=c.substring(j+1,c.length).toLowerCase()
}}var k=this.defaultIcon;
if(n&&this.extensionToIcon[n]){k=this.extensionToIcon[n]
}var m=this.iconResources;
if(m.charAt(m.length-1)!="/"){m+="/"
}var a=CQ.HTTP.externalize(m+k);
var q=CQ.I18n.getMessage("unknown");
if(g.mimeType){q=g.mimeType
}var b=CQ.I18n.getMessage("unknown");
if(g.size){b=CQ.Util.formatFileSize(g.size)
}var o=CQ.I18n.getMessage("MIME type: {0}<br>Size: {1}",[q,b]);
if(this.referencedFileInfo){o+="<br>"+this.getRefText(this.referencedFileInfo.dataPath,c)
}if(!this.transferFileName){c=this.noFileNameText
}this.processingPanel.updateContent(c,o,a)
},getRefText:function(b,c){var a=CQ.User.getCurrentUser().hasPermissionOn("update",b);
var j=CQ.HTTP.externalize(CQ.shared.XSS.getXSSValue(CQ.shared.HTTP.encodePath(b),true));
var g=CQ.I18n.getMessage("Referenced from:")+" ";
if(a){g+='<a href="'+j+'" target="_blank" title="'+CQ.I18n.getMessage("Click here to open referenced file")+'" style="cursor:pointer;">'
}g+=CQ.shared.XSS.getXSSValue(c?c:b);
if(a){g+="</a>"
}return g
},createRevertInheritanceHint:function(){var a=this.uploadPanel.body.createChild({tag:"div",cls:this.lockHintCls,html:this.revertInheritanceText});
a.addListener("click",function(){this.switchPropertyInheritance()
},this)
},createUploadPanel:function(){this.isUploadPanelCreated=true;
var g=this.uploadPanel.body;
var m=this.uploadPanel.items.getCount();
for(var c=m-1;
c>=0;
c--){this.remove(this.uploadPanel.items.itemAt(c))
}var b;
if(this.uploadIconCls){b='<img src="'+CQ.Ext.BLANK_IMAGE_URL+'" alt="" border="0" class="'+this.uploadIconCls+'"><br>'
}else{b=""
}var j=this.uploadText;
if(!this.allowUpload){j=this.uploadTextReference
}if(!this.allowFileReference){j=this.uploadTextUpload
}var k=b+j;
this.textEl=g.createChild({tag:"div",html:k});
if(this.delayedCreateRevertInheritanceHint&&!this.isLockHintCreated){this.createRevertInheritanceHint();
this.delayedCreateRevertInheritanceHint=false;
this.isLockHintCreated=true
}if(!this.useHTML5&&this.allowUpload){this.textEl.addListener("click",function(){this.containerPanel.getLayout().setActiveItem("fallback");
this.fallbackFileField.fileInput.dom.name=this.name;
this.deleteFileParameter.disable()
},this)
}if(this.uploadHintCls){this.textEl.addClass(this.uploadHintCls)
}this.textEl.setVisibilityMode(CQ.Ext.Element.DISPLAY);
if(this.uploadPanel._width&&this.uploadPanel._height){this.setTextElSize(this.textEl,this.uploadPanel._width,this.uploadPanel._height)
}if(this.useHTML5){if(this.uploadHintCls){this.body.addClass(this.uploadHintCls)
}if(this.allowUpload){var a=this;
(function(){var n=a.uploadPanel._height?a.uploadPanel._height:a.ownerCt.getHeight();
if(a.textEl){n=a.textEl.getHeight()
}var q=a.uploadPanel._width?a.uploadPanel._width:a.ownerCt.getWidth();
a.uploadField=new CQ.html5.form.FileUploadField({name:this.name,html5Upload:true,multiple:false,mimeTypes:this.mimeTypes,mimeTypesDescription:this.mimeTypesDescription,noDisplay:true,targetEl:this,renderTo:a.uploadPanel.id,fileInputStyle:{"font-size":"1000px",position:"absolute",top:0,left:0,height:n+"px",width:q+"px"}});
var o=a.uploadField.el.parent();
o.setStyle("position","absolute");
o.setStyle("top","0");
o.setStyle("left","0");
o.setStyle("height",n+"px");
o.setStyle("width",q+"px")
}).call(this)
}}},switchToUploadProgress:function(){if(this.removeUploadPanelClsOnProgress&&this.uploadPanelCls){this.uploadPanel.removeClass(this.uploadPanelCls)
}var b=this.uploadPanel.body;
if(this.useHTML5){this.textEl.setVisible(false)
}if(!this.progressBar){this.progressBar=new CQ.Ext.ProgressBar({text:"&nbsp;"});
var a="padding-left: 5px; padding-right: 5px; position: absolute; top: 0px; left: 0px;";
if(this.fixedHeight){a+=" height: "+this.fixedHeight+"px"
}this.progressBarDiv=b.createChild({tag:"div",style:a});
this.progressBarDiv.setVisibilityMode(CQ.Ext.Element.DISPLAY);
if(this.uploadPanel._width&&this.uploadPanel._height){this.setProgressBarSize(this.uploadPanel._width,this.uploadPanel._height)
}this.progressBar.render(this.progressBarDiv);
this.progressBar.updateProgress(0,CQ.I18n.getMessage("Uploading ..."))
}else{this.progressBarDiv.setVisible(true)
}},switchToUploadBase:function(){if(this.progressBarDiv){this.progressBarDiv.setVisible(false)
}if(this.removeUploadPanelClsOnProgress&&this.uploadPanelCls){this.uploadPanel.addClass(this.uploadPanelCls)
}this.textEl.setVisible(true)
},setTextElSize:function(b,c,a){if(b){if(!this.msgHeight){this.msgHeight=b.getHeight()
}var g=Math.round((a-this.msgHeight)/2);
if(g>0){b.setStyle("padding-top",g+"px")
}if(this.uploadField){if(this.textEl||this.lockTextEl){a=this.textEl&&this.textEl.getHeight()>0?this.textEl.getHeight():(this.lockTextEl&&this.lockTextEl.getHeight()>0?this.lockTextEl.getHeight():a)
}this.uploadField.fileInput.setStyle("width",c+"px");
this.uploadField.fileInput.setStyle("height",a+"px");
this.uploadField.el.parent().setStyle("width",c+"px");
this.uploadField.el.parent().setStyle("height",a+"px")
}}},setProgressBarSize:function(b,a){if(this.progressBarDiv){this.progressBarDiv.setSize(b,a)
}},flushFile:function(){this.flush();
this.syncFormElements();
this.updateView()
},initializeDragAndDrop:function(){if(this.allowFileReference&&this.ddGroups){if(typeof(this.ddGroups)=="string"){this.ddGroups=[this.ddGroups]
}var j=this;
var k=new CQ.wcm.EditBase.DropTarget(this.el,{notifyDrop:function(q,m,o){if(q&&q.clearAnimations){q.clearAnimations(this)
}if(q.isDropAllowed(this)){var n=j.handleDrop(o);
if(n){m.stopEvent()
}return n
}}});
var c=this.getToplevel();
if(c){c.on("activate",function(n){if(n&&n.el&&this.highlight){var m=parseInt(n.el.getStyle("z-index"),10);
if(!isNaN(m)){this.highlight.zIndex=m+1
}}},k);
c.on("deactivate",function(n){if(n&&n.el&&this.highlight){var m=parseInt(n.el.getStyle("z-index"),10);
if(!isNaN(m)){this.highlight.zIndex=m+1
}}},k)
}for(var b=0;
b<this.ddGroups.length;
b++){k.addToGroup(this.ddGroups[b])
}k.removeFromGroup(CQ.wcm.EditBase.DD_GROUP_DEFAULT);
var a=this.ddAccept;
if(a){if(!CQ.Ext.isArray(a)){var g=new RegExp("[ ;]+","g");
a=a.split(g)
}k.ddAccept=a
}this.dropTargets=[];
this.dropTargets.push(k)
}},handleDrop:function(a){if(this.handleDropBasics(a)){this.syncFormElements();
this.updateView();
return true
}return false
},handleDropBasics:function(c){if(c.records&&c.single){var a=c.records[0];
var b=a.get("path");
this.referencedFileInfo=this.resolveReference(b,this.dataPath);
var g=a.get("name");
if(g){this.referencedFileInfo.fileName=g
}this.referencedFileInfo.url=this.createRefUrl(this.referencedFileInfo);
this.referencedFileInfo.fallbackUrl=this.createFallbackRefUrl(this.referencedFileInfo);
this.validateOnStateChange();
return true
}return false
},onFileSelected:function(c,g){if(this.useHTML5&&g.length>0){this.handleUploadStart();
var b=g[0];
var j=new XMLHttpRequest();
j.onreadystatechange=this.handleUploadLoad.createDelegate(this,[b,j],0);
j.upload.addEventListener("progress",this.handleUploadProgress.createDelegate(this,[b],0),false);
j.upload.addEventListener("error",this.handleUploadError.createDelegate(this,[b,j],0),false);
this.uploadPath=this.dataPath;
this.uploadName=this.name;
if(this.name=="./*"){this.uploadName=b.name
}var k;
var a;
if(window.FormData!==undefined){k="POST";
a=new FormData();
a.append(this.uploadName+CQ.html5.form.SmartFile.PARAM_TEMP_NODE_SUFFIX,b);
a.append(CQ.Sling.CHARSET,"utf-8")
}else{this.uploadPath=CQ.Sling.getContentPath(this.uploadName+CQ.html5.form.SmartFile.PARAM_TEMP_NODE_SUFFIX,this.uploadPath);
k="PUT";
a=b
}j.open(k,CQ.shared.HTTP.getXhrHookedURL(CQ.HTTP.externalize(CQ.HTTP.encodePath(this.uploadPath)),k),true);
j.send(a)
}return true
},onUploaded:function(){this.syncFormElements();
this.updateView();
return true
},formatTimeLeft:function(b){if(b>86399){b=Math.round(b/86400);
if(b==1){return CQ.I18n.getMessage("{0} day",[b])
}else{return CQ.I18n.getMessage("{0} days",[b])
}}else{if(b>3599){b=new String(b/3600);
var a=b.indexOf(".");
if(a>0){if(b.charAt(a+1)=="0"){b=b.substring(0,a)
}else{b=b.substring(0,a+2)
}}if(b==1){return CQ.I18n.getMessage("{0} hour",[b])
}else{return CQ.I18n.getMessage("{0} hours",[b])
}}else{if(b<=3600&&b>59){b=Math.round(b/60)+"";
if(b==1){return CQ.I18n.getMessage("{0} minute",[b])
}else{return CQ.I18n.getMessage("{0} minutes",[b])
}}else{if(b==1){return CQ.I18n.getMessage("{0} second",[b])
}else{return CQ.I18n.getMessage("{0} seconds",[b])
}}}}},estimateTimeLeft:function(a,b){var c=new Date().valueOf()-this.startTime;
var g=Math.round(c*(b-a)/a/1000);
return this.formatTimeLeft(g)
},handleDialogStart:function(){if(this.pendingFiles>0){this.pendingFiles=0
}},handleUploadLoad:function(a,b){if(b.readyState===4){this.uploadPanel.setVisible(false);
if(CQ.HTTP.isOkStatus(b.status)){this.handleUploadSuccess(a,b.responseText)
}else{this.handleUploadError(a,b)
}}},handleUploadStart:function(a){this.hasUploadErrors=false;
this.startTime=new Date().valueOf();
this.switchToUploadProgress();
this.uploadPanel.setVisible(true);
return true
},handleUploadProgress:function(b,a){var c=CQ.I18n.getMessage("{0} of {1} - {2}",[CQ.Util.formatFileSize(a.loaded),CQ.Util.formatFileSize(a.total),this.estimateTimeLeft(a.loaded,a.total)]);
this.progressBar.updateProgress(a.loaded/a.total,c)
},handleUploadSuccess:function(b,g){var a=false;
var m=this.fileInfo;
var c=CQ.HTTP.buildPostResponseFromHTML(g);
var k=window.FormData!==undefined;
if(k?CQ.HTTP.isOk(c):g===""){var o;
try{if(k){try{o=c.headers[CQ.HTTP.HEADER_PATH];
o=CQ.Sling.getContentPath(this.uploadName+CQ.html5.form.SmartFile.PARAM_TEMP_NODE_SUFFIX,o)
}catch(j){CQ.Log.error("CQ.html5.form.SmartFile#handleUploadSuccess: "+j.message)
}}else{o=this.uploadPath
}try{this.fileInfo=this.resolveReference(o,this.dataPath);
this.fileInfo.fileName=b.name
}catch(j){this.fileInfo={fileName:b.name,dataPath:o,url:CQ.HTTP.externalize(o),size:b.size}
}this.isUploaded=true;
a=(this.onUploaded()!==false);
if(this.transferFileName&&this.fileNameField){this.fileNameField.setValue(this.fileInfo.fileName)
}else{this.fileNameField.setValue("")
}this.validateOnStateChange()
}catch(j){CQ.Log.error("CQ.html5.form.SmartFile#handleUploadSuccess: "+j.message)
}}else{CQ.Log.error("CQ.html5.form.SmartFile#handleUploadSuccess: response not ok")
}var n;
if(!a){this.fileInfo=m;
this.hasUploadErrors=true;
n=CQ.I18n.getMessage("Error uploading '{0}'",[b.name]);
this.notify(n,CQ.html5.form.SmartFile.STATUS_ERROR)
}},handleUploadError:function(a,c){this.hasUploadErrors=true;
var b=CQ.I18n.getMessage("Failed to upload '{0}': {1}",[CQ.shared.XSS.getXSSValue(a.name),c.responseText]);
this.notify(b,CQ.html5.form.SmartFile.STATUS_ERROR)
},handleUploadComplete:function(){this.startTime=0;
this.pendingFiles=0
},reset:function(){this.flush();
CQ.html5.form.SmartFile.superclass.reset.call(this)
},notify:function(b,a){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Upload"),b)
},validateValue:function(a){if(!this.useHTML5){a=this.fallbackFileField.getValue()
}return CQ.html5.form.SmartFile.superclass.validateValue.call(this,a)
}});
CQ.html5.form.SmartFile.PARAM_TEMP_NODE_SUFFIX=".sftmp";
CQ.html5.form.SmartFile.PARAM_FILENAME_SUFFIX="Name";
CQ.html5.form.SmartFile.PARAM_REFERENCE_SUFFIX="Reference";
CQ.html5.form.SmartFile.DAM_RENDITION_SUFFIX="/jcr:content/renditions/original";
CQ.html5.form.SmartFile.DAM_WEB_RENDITION_NAME="cq5dam.web.1280.1280";
CQ.html5.form.SmartFile.DAM_RENDITIONS_PATH="/jcr:content/renditions/";
CQ.html5.form.SmartFile.STATUS_SUCCESS=0;
CQ.html5.form.SmartFile.STATUS_ERROR=1;
CQ.html5.form.SmartFile.STATUS_SUBMISSION=2;
CQ.html5.form.SmartFile.ID_COUNTER=0;
CQ.Ext.reg("html5smartfile",CQ.html5.form.SmartFile);
CQ.html5.form.SmartImage=CQ.Ext.extend(CQ.html5.form.SmartFile,{originalImage:null,processedImage:null,originalRefImage:null,processedRefImage:null,requestSuffix:null,imageToolDefs:null,mapParameter:null,cropParameter:null,rotateParameter:null,disableFlush:null,disableZoom:null,toolComponents:null,pathProvider:null,hideMainToolbar:false,imagesPending:0,disableInfo:false,preventTabTracking:false,infoTip:null,destroy:function(){var a=0,b=this.imageToolDefs.length;
CQ.html5.form.SmartImage.superclass.destroy.call(this);
for(;
a<b;
a++){CQ.Ext.destroy(this.imageToolDefs[a])
}},constructor:function(b){b=b||{};
var g={fullTab:true,mimeTypes:"*.jpg;*.jpeg;*.gif;*.png",mimeTypesDescription:CQ.I18n.getMessage("Images"),ddAccept:"image/",uploadPanelCls:null,removeUploadPanelClsOnProgress:false,allowFileNameEditing:false,transferFileName:false,uploadIconCls:"cq-image-placeholder",uploadTextReference:CQ.I18n.getMessage("Drop an image"),uploadTextFallback:CQ.I18n.getMessage("Upload image"),uploadText:CQ.I18n.getMessage("Drop an image or click to upload"),height:"auto",anchor:null,pathProvider:CQ.html5.form.SmartImage.defaultPathProvider,hideMainToolbar:false,preventTabTracking:false};
this.imageToolDefs=[];
if(b.mapParameter){this.imageToolDefs.push(new CQ.form.ImageMap(b.mapParameter));
delete b.mapParameter
}if(b.cropParameter){this.imageToolDefs.push(new CQ.form.ImageCrop(b));
delete b.cropParameter;
delete b.disableCropClear
}if(b.rotateParameter){this.imageToolDefs.push(new CQ.form.SmartImage.Tool.Rotate(b.rotateParameter));
delete b.rotateParameter
}CQ.Util.applyDefaults(b,g);
CQ.html5.form.SmartImage.superclass.constructor.call(this,b);
this.addEvents("beforeloadimage","loadimage","imagestate");
var a=this.imageToolDefs.length;
for(var c=0;
c<a;
c++){this.imageToolDefs[c].initialize(b)
}},initComponent:function(){CQ.html5.form.SmartImage.superclass.initComponent.call(this);
this.workingAreaContainer=new CQ.Ext.Panel({itemId:"workingArea",border:false,layout:"border"});
this.processingPanel.add(this.workingAreaContainer);
this.workingArea=new CQ.Ext.Panel({border:false,layout:"card",region:"center",activeItem:0,listeners:{beforeadd:function(k,m){if(k._width&&k._height&&m.notifyResize){m.notifyResize.call(m,this._width,this._height)
}},bodyresize:function(m,o,k){if(typeof o=="object"){k=o.height;
o=o.width
}if(o&&k){m._width=o;
m._height=k;
var r=m.items.getCount();
for(var n=0;
n<r;
n++){var q=m.items.get(n);
if(q.notifyResize){q.notifyResize.call(q,o,k)
}}}}},afterRender:function(){CQ.Ext.Panel.prototype.afterRender.call(this);
this.el.setVisibilityMode(CQ.Ext.Element.DISPLAY)
}});
this.workingAreaContainer.add(this.workingArea);
this.imagePanel=new CQ.form.SmartImage.ImagePanel({itemId:"imageview",listeners:{"smartimage.zoomchange":{fn:function(k){if(this.zoomSlider){this.suspendEvents();
this.zoomSlider.setValue(k*10);
this.resumeEvents()
}},scope:this},"smartimage.defaultview":{fn:this.disableTools,scope:this}}});
this.workingArea.add(this.imagePanel);
if(this.topPanel){this.topPanel.region="north";
this.workingAreaContainer.add(this.topPanel)
}var a=this.imageToolDefs.length;
for(var g=0;
g<a;
g++){this.imageToolDefs[g].initComponent(this)
}this.on("loadimage",this.adjustUI,this);
if(!this.preventTabTracking){var j=this.findParentByType("tabpanel");
if(j){var c=this;
while(c){var b=c.ownerCt;
if(b===j){c.on("activate",function(){this.doLayout()
},this)
}c=b
}}}},onRender:function(b,c){CQ.html5.form.SmartImage.superclass.onRender.call(this,b,c);
var a=this.getToplevel();
if(a){a.on("hide",function(){this.hideTools();
this.imagePanel.ignoreRotation=false;
this.toolSelector.disable();
this.imagePanel.disablePanelTemporaryily()
},this);
a.on("editlocked",function(g,j){if(this.savedDropTargets==null){this.savedDropTargets=this.dropTargets
}this.dropTargets=null
},this);
a.on("editunlocked",function(g,j){if(this.savedDropTargets!=null){this.dropTargets=this.savedDropTargets
}},this)
}},handleFieldLock:function(q,g,b,c){var k=this;
var o=this.getName();
var m=this.getBaseNodeName();
if(c.get(m)){var a=c.get(m);
var j=a["jcr:mixinTypes"];
if(j&&(j.indexOf(CQ.wcm.msm.MSM.MIXIN_LIVE_SYNC_CANCELLED)!=-1)){g=false;
q="cq-dialog-unlocked"
}if(a[CQ.wcm.msm.MSM.PARAM_PROPERTY_INHERITANCE_CANCELED]){g=false;
q="cq-dialog-unlocked"
}}k.editLock=g;
k.editLockDisabled=b;
this.setToolbarEnabled(!(g&&!b));
if(g&&!b){this.dropTargets[0].lock();
this.processingPanel.body.mask()
}var n="";
if(b){n=CQ.Dialog.INHERITANCE_BROKEN
}else{n=g?CQ.Dialog.CANCEL_INHERITANCE:CQ.Dialog.REVERT_INHERITANCE
}if(!this.isUploadPanelCreated){this.delayedCreateRevertInheritanceHint=true
}else{if(!this.isLockHintCreated){this.createRevertInheritanceHint();
this.isLockHintCreated=true
}}if(!this.fieldEditLockBtn){k.fieldEditLockBtn=new CQ.Ext.Button({disabled:b,tooltip:n,cls:"cq-dialog-editlock cq-smartimage-editlock",iconCls:q,handler:function(){this.switchPropertyInheritance()
},scope:this});
this.toolSelector.add(this.fieldEditLockBtn)
}else{this.fieldEditLockBtn.setDisabled(b);
this.fieldEditLockBtn.setIconClass(q);
this.fieldEditLockBtn.setTooltip(q=="cq-dialog-unlocked"?CQ.Dialog.REVERT_INHERITANCE:CQ.Dialog.CANCEL_INHERITANCE)
}this.updateView()
},switchPropertyInheritance:function(){var a=this.findParentByType("dialog");
a.switchPropertyInheritance(this,null,function(c,b){this.editLock=b;
this.fieldEditLockBtn.setIconClass(c);
this.fieldEditLockBtn.setTooltip(c=="cq-dialog-unlocked"?CQ.Dialog.REVERT_INHERITANCE:CQ.Dialog.CANCEL_INHERITANCE);
if(b){this.dropTargets[0].lock();
this.processingPanel.body.mask()
}else{this.dropTargets[0].unlock();
this.processingPanel.body.unmask()
}this.setToolbarEnabled(!b);
this.updateView()
})
},getFieldLockParameters:function(a){delete a.cmd;
a[CQ.wcm.msm.MSM.PARAM_STATUS+"/"+CQ.wcm.msm.MSM.PARAM_IS_CANCELLED]=this.editLock;
a[CQ.wcm.msm.MSM.PARAM_STATUS+"/"+CQ.wcm.msm.MSM.PARAM_IS_CANCELLED_FOR_CHILDREN]=true;
return a
},getFieldLockTarget:function(a){return a+="/"+this.getBaseNodeName()
},getPropertyName:function(a){return a.substr(a.lastIndexOf("/")+1)
},getBaseNodeName:function(){var a=this.getName();
return a.replace(/^([^\/]*)\/([^\/]*)(.*)/,"$2")
},markInvalid:function(a){if(!this.rendered||this.preventMark){return
}a=a||this.invalidText;
this.uploadPanel.body.addClass(this.invalidClass);
this.imagePanel.addCanvasClass(this.invalidClass);
this.uploadPanel.body.dom.qtip=a;
this.uploadPanel.body.dom.qclass="x-form-invalid-tip";
if(CQ.Ext.QuickTips){CQ.Ext.QuickTips.enable()
}this.fireEvent("invalid",this,a)
},clearInvalid:function(){if(!this.rendered||this.preventMark){return
}this.uploadPanel.body.removeClass(this.invalidClass);
this.imagePanel.removeCanvasClass(this.invalidClass);
this.fireEvent("valid",this)
},postProcessRecord:function(b,k){this.dataRecord=b;
if(this.originalImage!=null){this.fireEvent("statechange","originalremoved",true)
}this.originalImage=null;
if(this.processedImage!=null){this.fireEvent("statechange","processedremoved",true)
}this.processedImage=null;
if(this.originalRefImage!=null){this.fireEvent("statechange","originalremoved",false)
}this.originalRefImage=null;
if(this.processedRefImage!=null){this.fireEvent("statechange","processedremoved",false)
}this.processedRefImage=null;
var j=null;
this.fireEvent("beforeloadimage",this);
if(this.referencedFileInfo){this.originalRefImage=new CQ.form.SmartImage.Image({dataPath:this.referencedFileInfo.dataPath,url:this.referencedFileInfo.url,fallbackUrl:this.referencedFileInfo.fallbackUrl});
this.notifyImageLoad(this.originalRefImage);
j=this.createProcessedImageConfig(this.referencedFileInfo.dataPath);
if(j){this.processedRefImage=new CQ.form.SmartImage.Image(j);
this.notifyImageLoad(this.processedRefImage)
}this.originalRefImage.load();
if(j){this.processedRefImage.load()
}}if(this.fileInfo){this.originalImage=new CQ.form.SmartImage.Image({dataPath:this.fileInfo.dataPath,url:this.fileInfo.url});
this.notifyImageLoad(this.originalImage);
j=this.createProcessedImageConfig(k);
if(j){this.processedImage=new CQ.form.SmartImage.Image(this.createProcessedImageConfig(k));
this.notifyImageLoad(this.processedImage)
}this.originalImage.load();
if(j){this.processedImage.load()
}}var a=this.imageToolDefs.length;
for(var g=0;
g<a;
g++){var c=this.imageToolDefs[g];
c.processRecord(b)
}},notifyImageLoad:function(a){if(!this.toolSelector.disabled&&!this.hideMainToolbar){this.toolSelector.disable()
}this.imagesPending++;
a.addToolLoadHandler(function(){this.imagesPending--;
if(this.imagesPending==0){this.fireEvent("loadimage",this)
}if(a==this.processedImage){this.fireEvent("imagestate",this,"processedavailable",true)
}else{if(a==this.processedRefImage){this.fireEvent("imagestate",this,"processedavailable",false)
}else{if(a==this.originalImage){this.fireEvent("imagestate",this,"originalavailable",true)
}else{if(a==this.originalRefImage){this.fireEvent("imagestate",this,"originalavailable",false)
}}}}}.createDelegate(this),true)
},createProcessedImageConfig:function(g){var j="";
if(g){var b=g.lastIndexOf(".");
var a=g.lastIndexOf("/");
if((b>0)&&(b>(a+1))){j=g.substring(b,g.length)
}}var c=this.pathProvider.call(this,this.dataPath,this.requestSuffix,j,this.dataRecord,this);
if(c==null){return null
}return{url:c}
},syncFormElements:function(){CQ.html5.form.SmartImage.superclass.syncFormElements.call(this);
var a=this.imageToolDefs.length;
for(var b=0;
b<a;
b++){var c=this.imageToolDefs[b];
c.transferToField()
}},usesProcessedImage:function(){var a=this.getSuitableImage(false);
return(a==this.processedImage)||(a==this.processedRefImage)
},invalidateProcessedImages:function(){if(this.processedImage!=null){this.processedImage=null;
this.fireEvent("imagestate",this,"processedremoved",true)
}if(this.processedRefImage!=null){this.processedRefImage=null;
this.fireEvent("imagestate",this,"processedremoved",false)
}},createProcessingPanel:function(){if(!this.hideMainToolbar){var a,c;
this.imageTools=[];
var b=[];
a=this.imageToolDefs.length;
for(c=0;
c<a;
c++){var g=this.imageToolDefs[c];
var j;
if(!g.isCommandTool){j=new CQ.Ext.Toolbar.Button({text:g.toolName,itemId:g.toolId,toolRef:g,iconCls:g.iconCls,actionHandler:this.toolClicked.createDelegate(this),enableToggle:true,toggleGroup:"imageTools",allowDepress:true,listeners:{click:function(){this.actionHandler(this.toolRef)
}}})
}else{j=new CQ.Ext.Toolbar.Button({text:g.toolName,itemId:g.toolId,toolRef:g,iconCls:g.iconCls,actionHandler:this.commandToolClicked.createDelegate(this),enableToggle:false,listeners:{click:function(){this.actionHandler(this.toolRef)
}}})
}g.buttonComponent=j;
this.imageTools.push(j);
g.createTransferField(this);
b.push(j)
}if(!this.disableFlush){b.push({xtype:"tbseparator"});
b.push({xtype:"tbbutton",text:CQ.I18n.getMessage("Clear"),iconCls:"cq-image-icon-clear",listeners:{click:{fn:this.flushImage,scope:this}}})
}if(!this.disableInfo){b.push({xtype:"tbseparator"});
b.push({itemId:"infoTool",xtype:"tbbutton",iconCls:"cq-image-icon-info",listeners:{click:{fn:this.showImageInfo,scope:this}}})
}b.push({xtype:"tbfill"});
if(!this.disableZoom){this.zoomSlider=new CQ.Ext.Slider({width:CQ.Ext.isIE7?150:200,minValue:0,maxValue:90,vertical:false,listeners:{change:{fn:function(k,m){this.imagePanel.setZoom(m/10)
},scope:this}}});
b.push(this.zoomSlider)
}}this.toolSelector=new CQ.Ext.Toolbar(b);
this.toolSelector.disable();
return new CQ.Ext.Panel({itemId:"processing",layout:"fit",border:false,bbar:(!this.hideMainToolbar?this.toolSelector:null),afterRender:function(){CQ.Ext.Panel.prototype.afterRender.call(this);
this.el.setVisibilityMode(CQ.Ext.Element.DISPLAY);
this.body.setVisibilityMode(CQ.Ext.Element.DISPLAY)
}})
},updateView:function(){if(this.editLock){this.containerPanel.getLayout().setActiveItem("lock");
if(!this.isLockPanelCreated){this.createLockPanel()
}}else{var a=this.originalImage||this.originalRefImage||this.processedImage||this.processedRefImage;
this.updateViewBasics(a);
if(a){this.workingArea.getLayout().setActiveItem("imageview");
this.resetTools();
this.resetZoomSlider()
}this.updateImageInfoState()
}this.doLayout();
if(this.processedRefImage){this.imagePanel.updateImage(this.processedRefImage)
}else{if(this.originalRefImage){this.imagePanel.updateImage(this.originalRefImage)
}else{if(this.processedImage){this.imagePanel.updateImage(this.processedImage)
}else{if(this.originalImage){this.imagePanel.updateImage(this.originalImage)
}}}}},resetTools:function(){if(!this.hideMainToolbar){var a=this.imageTools.length;
for(var c=0;
c<a;
c++){var b=this.imageTools[c];
if(b.enableToggle){b.toggle(false)
}}}this.imagePanel.hideAllShapeSets(false)
},resetZoomSlider:function(){if(this.zoomSlider){this.zoomSlider.suspendEvents();
this.zoomSlider.setValue(0);
this.zoomSlider.resumeEvents()
}},getImagePanel:function(){return this.imagePanel
},adjustUI:function(){if(!this.hideMainToolbar){var a;
if(!this.disableInfo){a=this.toolSelector.items.get("infoTool");
var b=a.disabled
}if(!this.editLock||this.editLockDisabled){this.toolSelector.enable();
this.enableToolbar();
if(!this.disableInfo){a.setDisabled(b)
}}if(this.fieldEditLockBtn){this.fieldEditLockBtn.setDisabled(this.editLockDisabled)
}}},setToolbarEnabled:function(a){(a?this.enableToolbar():this.disableToolbar())
},disableToolbar:function(){this.toolSelector.items.each(function(a){if(a!=this.fieldEditLockBtn){a.setDisabled(true)
}},this)
},enableToolbar:function(){this.toolSelector.items.each(function(b){if(b!=this.fieldEditLockBtn){var a=(!this.editLock||this.editLockDisabled);
if(a&&b.toolRef){a=b.toolRef.isEnabled()
}b.setDisabled(!a)
}},this)
},onUploaded:function(){this.originalImage=new CQ.form.SmartImage.Image(this.fileInfo);
this.originalImage.loadHandler=function(){var a=this.imageToolDefs.length;
for(var b=0;
b<a;
b++){this.imageToolDefs[b].onImageUploaded(this.originalImage)
}this.syncFormElements();
this.updateView()
}.createDelegate(this);
this.fireEvent("beforeloadimage",this);
this.notifyImageLoad(this.originalImage);
this.originalImage.load();
if(this.processedImage!=null){this.processedImage=null;
this.fireEvent("imagestate",this,"processedremoved",true)
}return true
},toolClicked:function(j){var c;
var n=j.buttonComponent;
if(n.pressed){var m=false;
if(this.toolComponents==null){this.toolComponents={}
}if(!this.toolComponents[j.toolId]){this.toolComponents[j.toolId]={isVisible:false,toolRef:j};
m=true
}var g=this.toolComponents[j.toolId];
c=this.hideTools(j.toolId);
if(j.userInterface&&(!j.userInterface.rendered)){j.userInterface.render(CQ.Util.getRoot())
}if(c){c.onDeactivation()
}if(j.userInterface){j.userInterface.show();
g.isVisible=true;
if(!(j.userInterface.saveX&&j.userInterface.saveY)){var o=j.userInterface.getSize().height;
var k=this.getPosition();
var b=k[0];
var a=k[1]-(o+4);
if(b<0){b=0
}if(a<0){a=0
}j.userInterface.setPosition(b,a)
}else{j.userInterface.setPosition(j.userInterface.saveX,j.userInterface.saveY)
}}j.onActivation()
}else{c=this.hideTools();
if(c){c.onDeactivation()
}this.imagePanel.drawImage()
}},commandToolClicked:function(a){a.onCommand()
},hideTools:function(c){if(!this.hideMainToolbar){var g;
for(var b in this.toolComponents){var a=this.toolComponents[b];
if(b!=c){if(a.isVisible){a.toolRef.userInterface.hide();
a.isVisible=false;
g=a.toolRef
}}}}return g
},disableTools:function(){if(!this.hideMainToolbar){var g=this.hideTools();
if(g){g.onDeactivation()
}var a=this.imageTools.length;
for(var b=0;
b<a;
b++){var c=this.imageTools[b];
if(c.pressed){c.suspendEvents();
c.toggle(false);
c.resumeEvents()
}}}},updateImageInfoState:function(){if(!this.disableInfo&&!this.hideMainToolbar){var a=this.toolSelector.items.get("infoTool");
var b=(this.referencedFileInfo!=null);
(b?a.enable():a.disable())
}},showImageInfo:function(){if(this.infoTip!=null){var b=this.infoTip.hidden==false;
this.infoTip.hide();
if(b){return
}}var c=function(){if(this.infoTip!=null){this.infoTip.hide();
this.infoTip=null
}};
var a=this.toolSelector.items.get("infoTool");
this.infoTip=new CQ.Ext.Tip({title:CQ.I18n.getMessage("Image info"),html:'<span class="cq-smartimage-refinfo">'+this.getRefText(this.referencedFileInfo.dataPath)+"</span>",maxWidth:500,autoHide:false,closable:true,listeners:{hide:function(){CQ.Ext.EventManager.un(document,"click",c,this)
},scope:this}});
CQ.Ext.EventManager.on.defer(10,this,[document,"click",c,this]);
this.infoTip.showBy(a.el,"tl-tr")
},flushImage:function(a){this.flush();
if(this.processedRefImage!=null){this.processedRefImage=null;
this.fireEvent("imagestate",this,"processedremoved",false)
}if(this.processedImage!=null){this.processedImage=null;
this.fireEvent("imagestate",this,"processedremoved",true)
}this.processedImage=null;
if(this.originalRefImage){this.originalRefImage=null;
this.fireEvent("imagestate",this,"originalremoved",false)
}else{if(this.originalImage){this.originalImage=null;
this.fireEvent("imagestate",this,"originalremoved",true)
}}if(a!==true){this.syncFormElements();
this.notifyToolsOnFlush();
this.hideTools();
this.updateView()
}},reset:function(){this.flushImage();
CQ.html5.form.SmartImage.superclass.reset.call(this)
},notifyToolsOnFlush:function(){var a=this.imageToolDefs.length;
for(var b=0;
b<a;
b++){this.imageToolDefs[b].onImageFlushed()
}},getSuitableImage:function(a){var b;
if(this.processedRefImage&&!a){b=this.processedRefImage
}else{if(this.originalRefImage){b=this.originalRefImage
}else{if(this.processedImage&&!a){b=this.processedImage
}else{if(this.originalImage){b=this.originalImage
}}}}return b
},handleDrop:function(a){if(this.handleDropBasics(a)){this.originalRefImage=new CQ.form.SmartImage.Image(this.referencedFileInfo);
this.originalRefImage.loadHandler=function(){this.hideTools();
var b=this.imageToolDefs.length;
for(var c=0;
c<b;
c++){this.imageToolDefs[c].onImageUploaded(this.originalRefImage)
}this.syncFormElements();
this.updateView()
}.createDelegate(this);
if(this.processedRefImage!=null){this.processedRefImage=null;
this.fireEvent("imagestate",this,"processedremoved",false)
}this.fireEvent("beforeloadimage",this);
this.notifyImageLoad(this.originalRefImage);
this.originalRefImage.load();
return true
}return false
}});
CQ.html5.form.SmartImage.defaultPathProvider=function(c,b,g,a){if(!b){return null
}return CQ.HTTP.externalize(c+b)
};
CQ.Ext.reg("html5smartimage",CQ.html5.form.SmartImage);
CQ.form.ComponentSelector=CQ.Ext.extend(CQ.form.CompositeField,{hiddenField:null,fieldSets:[],processRecord:function(g,u){if(this.fireEvent("beforeloadcontent",this,g,u)!==false){var t=g.get(this.getName());
if(t!=undefined){if(typeof(t)=="string"){t=[t]
}var r={};
for(var n in t){r[t[n]]=true
}for(var b=0;
b<this.fieldSets.length;
b++){var m=false;
var q=this.fieldSets[b].titleCheckbox.inputValue;
if(typeof(q)!="undefined"&&typeof(r[q])!="undefined"){this.fieldSets[b].titleCheckbox.setValue(true);
m=true
}var j=this.fieldSets[b].items&&this.fieldSets[b].items.items?this.fieldSets[b].items.items:null;
var o=false;
if(j){for(var k in j){var a=j[k].inputValue;
if(a!=undefined){if(m){j[k].setValue(true)
}else{if(r[a]!=undefined){j[k].setValue(true);
o=true
}}}}}if(o){this.fieldSets[b].expand()
}}}this.fireEvent("loadcontent",this,g,u)
}},constructor:function(b){CQ.Util.applyDefaults(b,{border:false,name:"./components",cls:"cq-compsel"});
CQ.form.ComponentSelector.superclass.constructor.call(this,b);
this.hiddenField=new CQ.Ext.form.Hidden({name:b.name+CQ.Sling.DELETE_SUFFIX,value:"true"});
this.add(this.hiddenField);
var a="NO GROUP DEFINED!";
var q="General";
var u=CQ.WCM.getComponentList(this.path);
var g={};
var x=[];
for(var m in u.allComponents){var t=u.allComponents[m];
if(typeof(t.group)==="undefined"||t.group==""){t.group=a
}if(t.group.indexOf(".")==0){continue
}if(typeof(g[t.group])==="undefined"){g[t.group]=[];
if(t.group!=a&&t.group!=q){x.push([t.group,CQ.I18n.getVarMessage(t.group)])
}}if(!t.title||t.title==m.substring(m.lastIndexOf("/")+1)){continue
}if(!t.icon){t.icon="/libs/cq/ui/widgets/themes/default/icons/16x16/components.png"
}var o="<div style='display:inline;padding:2px 0 2px 20px;background:transparent url("+CQ.HTTP.externalize(t.icon)+") 0 2px no-repeat;'";
if(t.description){o+=" ext:qtip='"+CQ.I18n.getVarMessage(t.description)+"'"
}o+=">";
g[t.group].push({title:CQ.I18n.getVarMessage(t.title),labelPre:o,labelPost:"</div>",inputValue:t.path,xtype:"checkbox",hideLabel:true,name:"./components",stateful:false})
}x.sort(function(v,c){if(v[1]>c[1]){return 1
}else{if(v[1]<c[1]){return -1
}else{return 0
}}});
var w=[[q,CQ.I18n.getVarMessage(q)]].concat(x).concat([[a,CQ.I18n.getVarMessage(a)]]);
for(var j=0;
j<w.length;
j++){var r=w[j][0];
var n=w[j][1];
if(g[r]&&g[r].length>0){var k=new CQ.Ext.form.FieldSet({title:n,groupName:r,collapsible:true,collapsed:true,items:g[r],autoHeight:"true",layout:"form",listeners:{render:function(){if(this.items){this.items.sort("ASC",function(E,D){if(E.title>D.title){return 1
}else{if(E.title<D.title){return -1
}else{return 0
}}});
var z=this.items.items.length;
for(var y=0;
y<z;
y++){var C=this.items.items[y].title;
if(y!=z-1&&C==this.items.items[y+1].title){while(true){var v=C;
try{var B=this.items.items[y].inputValue.split("/");
B=B[2]=="cq"?B[3]:B[2];
B=B.length<=3?B.toUpperCase():B.charAt(0).toUpperCase()+B.slice(1);
v=C+' <span class="app">('+B+")</span>"
}catch(A){}this.items.items[y].boxLabel=this.items.items[y].labelPre+v+this.items.items[y].labelPost;
if(y<z-1&&C!=this.items.items[y+1].title){break
}y++;
if(y==z){break
}}}else{this.items.items[y].boxLabel=this.items.items[y].labelPre+C+this.items.items[y].labelPost
}}}var c=this;
this.titleCheckbox=new CQ.Ext.form.Checkbox({renderTo:this.header,name:"./components",inputValue:"group:"+this.groupName,boxLabel:this.title,listeners:{check:function(G,F){for(var D=0;
D<c.items.length;
D++){var E=c.items.items[D];
if(F){E.disable()
}else{E.enable()
}}}}});
this.setTitle("")
}}});
this.add(k);
this.fieldSets.push(k)
}}}});
CQ.Ext.reg("componentselector",CQ.form.ComponentSelector);
CQ.wcm.Viewport=CQ.Ext.extend(CQ.Ext.Viewport,{constructor:function(a){this.debug=a.debug;
var c={id:"cq-header",xtype:"container",region:"north",autoEl:"div",items:[{xtype:"panel",border:false,layout:"column",cls:"cq-header-toolbar",items:[new CQ.Switcher({}),new CQ.UserInfo({}),new CQ.HomeLink({})]}]};
var b={id:a.id+"-wrapper",xtype:"panel",layout:"border",region:"center",border:false,items:[c].concat(a.items)};
a.layout="border";
a.renderTo="CQ";
a.items=[b];
CQ.wcm.Viewport.superclass.constructor.call(this,a)
},initComponent:function(){CQ.wcm.Viewport.superclass.initComponent.call(this)
}});
CQ.wcm.AdminBase={checkActions:function(){(function(){var a=this;
for(var b=0;
b<a.checkedActions.length;
b++){var c=a.checkedActions[b];
if((c instanceof CQ.PrivilegedAction)&&c.target){c.setPath(c.target.call(a),c.forceCheck)
}}}).defer(1,this)
},formatActions:function(o,g){var n=[];
var c=false;
for(var b in o){if(typeof(o[b])!="object"){continue
}if(o[b].xtype=="separator"){if(this.isToolbarAction(o[b])){n.push(o[b].value)
}if(this.isContextMenuAction(o[b])){g.push(o[b].value)
}}else{var j=this.formatActionConfig(o[b],g);
if(this.isToolbarAction(j)){var k=false;
if(j.isDefaultAction&&!n.hasDefaultAction){n.hasDefaultAction=k=true
}n.push(this.createAction(j,k))
}if(this.isContextMenuAction(j)){var m=false;
if(j.isDefaultAction&&!g.hasDefaultAction){g.hasDefaultAction=m=true
}g.push(this.createAction(j,m,true))
}}}return n
},formatActionConfig:function(config,gridContextActions){if(!config.scope){config.scope=this
}if(typeof(config.handler)=="string"){config.handler=eval(config.handler)
}if(config.menu){var menuItems=this.formatActions(config.menu,gridContextActions);
config.menu=new CQ.Ext.menu.Menu({items:menuItems})
}return config
},createAction:function(config,isDefault,inContextMenu){var admin=this;
var action=new CQ.PrivilegedAction(config);
if(config.split&&config.menu&&!this.isContextMenuAction(config)){action.xtype="tbsplit";
var defaultAction=config.menu.items.find(function(item){if(item.isDefaultAction===true){item.addClass("x-menu-item-default");
return true
}else{return false
}});
if(defaultAction){var showMenu=function(){if(!this.menu){return
}if(!this.menu.isVisible()){this.showMenu()
}};
action.setIconClass(defaultAction.initialConfig.iconCls);
action.setHandler(function(){if(!defaultAction.disabled){defaultAction.initialConfig.handler.call(admin)
}else{if(!this.menu){return
}if(!this.menu.isVisible()){this.showMenu()
}}})
}else{action.setHandler(showMenu)
}}if(isDefault){action.isDefaultAction=true
}if(config.target){action.target=eval("("+config.target+")")
}if(config.forceCheck){action.forceCheck=config.forceCheck
}if(!config.menu){this.checkedActions.push(action)
}if(!action.xtype&&config.xtype){action.xtype=config.xtype
}return action
},isToolbarAction:function(a){return !a.context||a.context.indexOf(CQ.wcm.SiteAdmin.CONTEXT_TOOLBAR)>=0
},isContextMenuAction:function(a){return a.context&&a.context.indexOf(CQ.wcm.SiteAdmin.CONTEXT_CONTEXTMENU)>=0
}};
CQ.wcm.SiteAdmin=CQ.Ext.extend(CQ.Ext.Viewport,{copyClipboard:null,createVersion:false,canPublishToScene7:false,constructor:function(config){var admin=this;
this.title=config.title;
config=CQ.Util.applyDefaults(config,{id:"cq-siteadmin",search:{width:145,listWidth:260,listAlign:"tr-br",minChars:3,queryDelay:500},grid:{pages:{pathRegex:"(/.*)?",storeProxyPrefix:"",storeProxySuffix:".pages.json",storePredicate:"siteadmin",storeReaderTotalProperty:"results",storeReaderRoot:"pages",storeReaderId:"path",storeReaderFields:["index","title",CQ.shared.XSS.getXSSPropertyName("title"),"label","type","dialogPath","lastModifiedBy",CQ.shared.XSS.getXSSPropertyName("lastModifiedBy"),"lastModified","templateTitle","templateShortTitle","templatePath","replication",{name:"inWorkflow",type:"bool"},"workflows","scene7Status","lockedBy","monthlyHits","timeUntilValid","onTime","offTime","scheduledTasks",CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP,CQ.wcm.msm.MSM.PARAM_IS_IN_BLUEPRINT,CQ.wcm.msm.MSM.PARAM_IS_SOURCE],columns:[CQ.wcm.SiteAdmin.COLUMNS.numberer,CQ.wcm.SiteAdmin.COLUMNS.thumbnail,CQ.wcm.SiteAdmin.COLUMNS.title,CQ.wcm.SiteAdmin.COLUMNS.name,CQ.wcm.SiteAdmin.COLUMNS.published,CQ.wcm.SiteAdmin.COLUMNS.modified,CQ.wcm.SiteAdmin.COLUMNS.scene7Status,CQ.wcm.SiteAdmin.COLUMNS.status,CQ.wcm.SiteAdmin.COLUMNS.impressions,CQ.wcm.SiteAdmin.COLUMNS.template,CQ.wcm.SiteAdmin.COLUMNS.workflow,CQ.wcm.SiteAdmin.COLUMNS.locked,CQ.wcm.SiteAdmin.COLUMNS.liveCopyStatus],defaultSortable:true}}});
this.lastClickedRow=-1;
var gridCfgs={};
for(var name in config.grid){if(!config.grid[name].pathRegex){continue
}gridCfgs[name]=config.grid[name];
if(name!="pages"){gridCfgs[name]=CQ.Ext.applyIf(gridCfgs[name],config.grid.pages)
}if(gridCfgs[name].pageSize==undefined){gridCfgs[name].pageSize=CQ.themes.wcm.SiteAdmin.GRID_PAGE_SIZE
}if(gridCfgs[name].pageText==undefined){gridCfgs[name].pageText=CQ.themes.wcm.SiteAdmin.GRID_PAGE_TEXT
}gridCfgs[name].storeConfig=CQ.Util.applyDefaults(config.store,{autoLoad:false,remoteSort:true,listeners:gridCfgs[name].storeListeners,proxy:new CQ.Ext.data.HttpProxy({api:{read:{url:gridCfgs[name].storeProxyPrefix,method:"GET"}}}),reader:new CQ.Ext.data.JsonReader({totalProperty:gridCfgs[name].storeReaderTotalProperty,root:gridCfgs[name].storeReaderRoot,id:gridCfgs[name].storeReaderId,fields:gridCfgs[name].storeReaderFields}),baseParams:{start:0,limit:gridCfgs[name].pageSize,predicate:gridCfgs[name].storePredicate}});
gridCfgs[name].colModelColumns=new Array();
for(var i=0;
i<gridCfgs[name].columns.length;
i++){var c=gridCfgs[name].columns[i];
var pref=null;
if(typeof c=="string"){pref=c
}else{if(typeof c=="object"){if(c.usePredefined){pref=c.usePredefined
}if(c.editor){if(typeof c.editor=="string"){try{eval("c.editor = "+c.editor+";")
}catch(e){}}try{c.editor=c.editor.cloneConfig()
}catch(e){}}CQ.shared.XSS.updatePropertyName(c,"dataIndex")
}}if(pref&&CQ.wcm.SiteAdmin.COLUMNS[pref]){var prefCfg=CQ.Util.copyObject(CQ.wcm.SiteAdmin.COLUMNS[pref]);
for(var prop in c){if(prop=="usePredefined"){continue
}prefCfg[prop]=c[prop]
}gridCfgs[name].colModelColumns.push(prefCfg)
}else{gridCfgs[name].colModelColumns.push(c)
}}}this.debug=config.debug;
var id=config.id;
var body=CQ.Ext.getBody();
body.setStyle("margin","0");
if(CQ.Ext.isIE){body.dom.scroll="no"
}else{body.setStyle("overflow","hidden")
}this.actions=[];
this.checkedActions=[];
var gridContextActions=[];
this.actions.push({id:id+"-grid-refresh",iconCls:"cq-siteadmin-refresh",handler:this.reloadPages,scope:this,tooltip:{title:id=="cq-damadmin"?CQ.I18n.getMessage("Refresh Asset List"):CQ.I18n.getMessage("Refresh Page List"),text:id=="cq-damadmin"?CQ.I18n.getMessage("Refreshs the list of assets"):CQ.I18n.getMessage("Refreshs the list of pages"),autoHide:true}});
this.actions.push("-");
this.actions=this.actions.concat(this.formatActions(config.actions,gridContextActions));
this.actions.push("->");
if(!config.noSearch){config.search=CQ.Util.applyDefaults(config.search,{id:id+"-search",triggerClass:"x-form-search-trigger "+id+"-search-trigger",listeners:{select:function(combo,record,index){var parent=record.id.substring(0,record.id.lastIndexOf("/"));
admin.loadPath(parent,record.id)
}}});
if(typeof config.search.listeners.select!="function"){config.search.listeners.select=eval(config.search.listeners.select)
}var search=new CQ.form.SearchField(config.search);
this.actions.push(search)
}var helpConfig=CQ.wcm.HelpBrowser.createHelpButton();
helpConfig.id=id+"-help";
this.actions.push(helpConfig);
var autoExpandMax=config.treeAutoExpandMax||CQ.TREE_AUTOEXPAND_MAX;
var treeLdrCfg=CQ.Util.applyDefaults(config.treeLoader,{requestMethod:"GET",dataUrl:"/bin/wcm/siteadmin/tree.json",baseParams:{ncc:autoExpandMax,_charset_:"utf-8"},baseAttrs:{autoExpandMax:autoExpandMax,singleClickExpand:true},listeners:{beforeload:function(loader,node){this.baseParams.path=node.getPath()
}},createNode:function(attr){if(this.baseAttrs){CQ.Ext.applyIf(attr,this.baseAttrs)
}if(attr.type=="cq:Page"){attr.iconCls="page";
if(attr.isLiveCopy){attr.iconCls="livecopypage"
}}else{if(/.*[fF]older/.test(attr.type)){attr.iconCls="folder"
}else{if(attr.cls){attr.iconCls=attr.cls
}}}if(this.applyLoader!==false){attr.loader=this
}if(typeof attr.uiProvider=="string"){attr.uiProvider=this.uiProviders[attr.uiProvider]||eval(attr.uiProvider)
}if(attr.type&&attr.type=="cq:Page"){if(attr.leaf){delete attr.leaf;
attr.children=[];
attr.expanded=true
}}var node;
if(attr.leaf){node=new CQ.Ext.tree.TreeNode(attr)
}else{node=new CQ.Ext.tree.AsyncTreeNode(attr);
node.on("move",function(tree,node,oldParent,newParent,index){if(newParent.attributes.children&&(newParent.attributes.children.length==0)){delete newParent.attributes.children
}})
}node.on("dblclick",function(node,evt){CQ.wcm.SiteAdmin.openPage.call(admin,node.getPath(),node.attributes.type,evt.shiftKey);
evt.stopEvent()
});
return node
}});
this.treeRootCfg=CQ.Util.applyDefaults(config.treeRoot,{name:"content",text:CQ.I18n.getMessage("Websites"),draggable:false,expanded:true,iconCls:"file"});
var anchor=CQ.HTTP.getAnchor(document.location.href);
if(anchor){var state=CQ.Ext.state.Manager.get(id+"-tree");
if(state){CQ.Ext.state.Manager.set(id+"-tree",state.width?{width:state.width}:{})
}}this.pagingToolbar=new CQ.Ext.PagingToolbar({pageSize:CQ.themes.wcm.SiteAdmin.GRID_PAGE_SIZE,store:null,displayInfo:true,displayMsg:"",emptyMsg:"",beforePageText:CQ.I18n.getMessage("Page"),afterPageText:CQ.I18n.getMessage("of {0}"),firstText:CQ.I18n.getMessage("First Page"),prevText:CQ.I18n.getMessage("Previous Page"),nextText:CQ.I18n.getMessage("Next Page"),lastText:CQ.I18n.getMessage("Last Page"),refreshText:CQ.I18n.getMessage("Refresh")});
var consolePanel={id:id+"-wrapper",cls:"cq-siteadmin-wrapper",xtype:"panel",layout:"border",border:false,items:[{xtype:"treepanel",id:id+"-tree",cls:"cq-siteadmin-tree",region:"west",margins:"5 0 5 5",width:CQ.themes.wcm.SiteAdmin.TREE_WIDTH,autoScroll:true,containerScroll:true,collapsible:true,collapseMode:"mini",hideCollapseTool:true,animate:true,split:true,stateful:true,enableDD:true,ddScroll:false,ddGroup:CQ.wcm.SiteAdmin.DD_GROUP_TREE,loader:new CQ.Ext.tree.TreeLoader(treeLdrCfg),root:new CQ.Ext.tree.AsyncTreeNode(this.treeRootCfg),tbar:[{id:id+"-tree-refresh",iconCls:"cq-siteadmin-refresh",handler:function(){admin.mask();
CQ.Ext.getCmp(id+"-tree").getRootNode().reload();
admin.loadPath()
},tooltip:{title:CQ.I18n.getMessage("Refresh Page Tree"),text:CQ.I18n.getMessage("Refreshs the page tree"),autoHide:true}}],listeners:{beforemovenode:function(tree,node,oldParent,newParent,index){if(admin.liveCopyNode){return admin.performLiveCopy(tree,node,oldParent,newParent,index)
}else{if(admin.copyNode){return admin.performCopy(tree,node,oldParent,newParent,index)
}else{if(admin.performMoveOrReorder(tree,node,oldParent,newParent,index)){admin.performAfterMoveOrReorder(tree,node,oldParent,newParent,index)
}return false
}}},movenode:function(tree,node,oldParent,newParent,index){if(admin.copyNode||admin.liveCopyNode){admin.performAfterCopy(tree,node,oldParent,newParent,index)
}},beforenodedrop:function(dropEvent){var isCtrl=dropEvent.rawEvent.browserEvent.ctrlKey;
var isShift=dropEvent.rawEvent.browserEvent.shiftKey;
var isPage=false;
try{isPage=CQ.Ext.getCmp(window.CQ_SiteAdmin_id+"-tree").getSelectionModel().getSelectedNode().attributes.type=="cq:Page"
}catch(e){}admin.copyNode=isCtrl&&(!isShift||!isPage);
admin.liveCopyNode=isCtrl&&isShift&&isPage
}}},{xtype:"siteadmingrid",id:id+"-grid",region:"center",enableDragDrop:true,ddGroup:CQ.wcm.SiteAdmin.DD_GROUP_GRID,ddText:CQ.I18n.getMessage("Reordering..."),tbar:this.actions,bbar:this.pagingToolbar,contextActions:gridContextActions,admin:this,listeners:{render:function(grid){admin.hidePagingToolbar();
grid.getSelectionModel().on("selectionchange",function(sm){var sel=sm.getSelections();
for(var i=0;
i<sel.length;
i++){admin.typeCache[sel[i].id]=sel[i].get("type")
}admin.updateS7PublishCapability(sel);
admin.checkActions.defer(200,admin)
});
var grd=document.getElementById(grid.id);
var addEvent=grd.addEventListener;
if(!addEvent){addEvent=grd.attachEvent
}if(grd.addEventListener){try{grd.addEventListener("dragover",function(e){grid.isDragOver=true;
if(!grid.hasDragMask){if(CQ.User.getCurrentUser().hasPermissionOn("create",admin.getCurrentPath())){grid.el.mask(CQ.I18n.getMessage("Drop file(s) to create assets"),"x-mask-loading cq-mask-drop-ok");
grid.dropDenied=false
}else{grid.el.mask(CQ.I18n.getMessage("No permissions to create assets"),"x-mask-loading cq-mask-drop-no");
grid.dropDenied=true
}grid.hasDragMask=true
}if(e.stopPropagation){e.stopPropagation()
}if(e.preventDefault){e.preventDefault()
}return false
},false);
grd.addEventListener("dragleave",function(e){if(e.stopPropagation){e.stopPropagation()
}if(e.preventDefault){e.preventDefault()
}grid.isDragOver=false;
window.setTimeout(function(){if(!grid.isDragOver){grid.el.unmask();
grid.hasDragMask=false
}},1);
return false
},false);
grd.addEventListener("drop",function(e){if(e.stopPropagation){e.stopPropagation()
}if(e.preventDefault){e.preventDefault()
}grid.el.unmask();
grid.hasDragMask=false;
if(grid.dropDenied){return false
}var dt=e.dataTransfer;
if(dt){var files=dt.files;
try{admin.html5UploadFiles(files)
}catch(f){}}return false
},false)
}catch(e){if(console){console.log(e)
}}}grid.getView().mainBody.setStyle("padding-bottom","22px");
try{var ddrow=new CQ.Ext.dd.DropZone(grid.getView().mainBody,{ddGroup:CQ.wcm.SiteAdmin.DD_GROUP_GRID,copy:false,notifyDrop:function(dd,e,data){var sm=grid.getSelectionModel();
var rows=sm.getSelections();
var cindex=dd.getDragData(e).rowIndex;
var ds=grid.store;
if(!this.isDropAllowed(e)){return false
}var toReorder=[];
for(i=0;
i<rows.length;
i++){toReorder.push(rows[i].id)
}var message;
var targetId;
if(cindex!=undefined){var targetRow=ds.getAt(cindex);
var name=targetRow.id.substring(targetRow.id.lastIndexOf("/")+1);
try{var cm=grid.getColumnModel();
if(!cm.isHidden(cm.getIndexById("title"))){if(targetRow.data.type=="cq:Page"){name=targetRow.data.title?targetRow.data.title:name
}}}catch(e){}message=CQ.I18n.getMessage("Are you sure you want to place the selected item(s) before {0}?",'"'+CQ.shared.XSS.getXSSValue(name)+'"');
targetId=targetRow.id
}else{message=CQ.I18n.getMessage("Are you sure you want to place the selected item(s) at the bottom?");
targetId=""
}CQ.Ext.Msg.confirm(CQ.I18n.getMessage("Reorder items"),message,function(btn){if(btn=="yes"){admin.mask();
for(var i=0;
i<toReorder.length;
i++){admin.performReorder(toReorder[i],targetId)
}grid.getStore().reload({callback:function(){admin.unmask()
}});
sm.selectRecords(rows)
}else{sm.selectRecords(rows)
}});
return true
},notifyOver:function(dd,e,data){return this.isDropAllowed(e)?this.dropAllowed:this.dropNotAllowed
},isDropAllowed:function(e){var t=CQ.Ext.lib.Event.getTarget(e);
var rowIndex=grid.getView().findRowIndex(t);
return grid.selectedIndices.indexOf(rowIndex)==-1
}})
}catch(e){if(console){console.log(e)
}}if(grid.getView().dragZone){grid.getView().dragZone.onBeforeDrag=function(e){var sortState=grid.getStore().getSortState();
if(!sortState||(sortState.field=="index"&&sortState.direction=="ASC")){var sels=grid.getSelectionModel().getSelections();
grid.selectedIndices=[];
for(var i=0;
i<sels.length;
i++){grid.selectedIndices.push(grid.getStore().indexOf(sels[i]))
}return true
}else{return false
}}
}}}}]};
var centerPanel;
if(config.tabTitle||config.tabs){consolePanel.title=config.tabTitle?CQ.I18n.getVarMessage(config.tabTitle):CQ.I18n.getMessage("Console");
var items=[consolePanel];
if(config.tabs){for(var i=0;
i<config.tabs.length;
i++){items.push(CQ.Util.applyDefaults(config.tabs[i],{admin:this}))
}}centerPanel={activeTab:0,region:"center",id:id+"-tabpanel",xtype:"tabpanel",cls:"cq-siteadmin-tabpanel",border:false,enableTabScroll:true,items:items,listeners:{tabchange:function(panel,tab){if(tab.path){admin.tabPath=tab.path;
admin.setDocumentTitle(tab.path.substring(tab.path.lastIndexOf("/")+1));
CQ.Ext.History.add(tab.path,true)
}else{if(tab.treePath){admin.tabPath="";
var title=admin.treePath?admin.treePath.substring(admin.treePath.lastIndexOf("/")+1):"";
admin.setDocumentTitle(title);
if(admin.treePath){CQ.Ext.History.add(admin.treePath,true)
}}else{if(tab.performSearch){tab.reloadPages()
}}}}}}
}else{consolePanel.region="center";
centerPanel=consolePanel
}CQ.wcm.SiteAdmin.superclass.constructor.call(this,{id:id,layout:"border",renderTo:CQ.Util.ROOT_ID,gridConfig:gridCfgs,items:[{id:"cq-header",xtype:"container",cls:id+"-header",autoEl:"div",region:"north",items:[{xtype:"panel",border:false,layout:"column",cls:"cq-header-toolbar",items:[new CQ.Switcher({}),new CQ.UserInfo({}),new CQ.HomeLink({})]}]},centerPanel]});
var tree=CQ.Ext.getCmp(id+"-tree");
tree.dropZone.onNodeOver=function(n,dd,e,data){var pt=this.getDropPoint(e,n,dd);
var node=n.node;
if(!this.expandProcId&&pt=="append"&&node.hasChildNodes()&&!n.node.isExpanded()){this.queueExpand(node)
}else{if(pt!="append"){this.cancelExpand()
}}var returnCls=this.dropNotAllowed;
if(this.isValidDropPoint(n,pt,dd,e,data)){if(pt){var el=n.ddel;
var cls;
if(pt=="above"){if(n.node.isFirst()){returnCls=e.browserEvent.ctrlKey?"x-tree-drop-ok-copy":"x-tree-drop-ok-above"
}else{returnCls=e.browserEvent.ctrlKey?"x-tree-drop-ok-copy":"x-tree-drop-ok-between"
}cls="x-tree-drag-insert-above"
}else{if(pt=="below"){if(n.node.isLast()){returnCls=e.browserEvent.ctrlKey?"x-tree-drop-ok-copy":"x-tree-drop-ok-below"
}else{returnCls=e.browserEvent.ctrlKey?"x-tree-drop-ok-copy":"x-tree-drop-ok-between"
}cls="x-tree-drag-insert-below"
}else{returnCls=e.browserEvent.ctrlKey?"x-tree-drop-ok-copy":"x-tree-drop-ok-move";
cls="x-tree-drag-append"
}}if(this.lastInsertClass!=cls){CQ.Ext.fly(el).replaceClass(this.lastInsertClass,cls);
this.lastInsertClass=cls
}}}return returnCls
};
tree.dragZone.beforeInvalidDrop=function(){this.dragData.node.ui.focus()
};
new CQ.Ext.form.Hidden({id:CQ.Ext.History.fieldId,renderTo:CQ.Util.ROOT_ID});
var historyFrame=document.createElement("iframe");
historyFrame.id=CQ.Ext.History.iframeId;
historyFrame.src=CQ.Ext.SSL_SECURE_URL;
historyFrame.className="x-hidden";
historyFrame.frameBorder="0";
historyFrame.border="0";
new CQ.Ext.Element(historyFrame).appendTo(CQ.Util.getRoot());
CQ.Ext.History.init();
CQ.Ext.History.on("change",function(token){var current=admin.getCurrentPath();
if(admin.id=="cq-damadmin"){var tree=CQ.Ext.getCmp(window.CQ_SiteAdmin_id+"-tree");
var isTreeNode=false;
tree.selectPath(token,"name",function(success){if(success){isTreeNode=true
}});
var tabPanel=CQ.Ext.getCmp(window.CQ_SiteAdmin_id+"-tabpanel");
if(isTreeNode){tabPanel.setActiveTab(admin.id+"-wrapper")
}else{var id=CQ.DOM.encodeId(token);
var editor=CQ.Ext.getCmp(id);
if(editor){tabPanel.setActiveTab(editor)
}else{admin.loadPath(token);
tabPanel.setActiveTab(admin.id+"-wrapper")
}}}else{if(token!=current){admin.loadPath(token)
}}});
if(anchor){admin.loadPath(decodeURI(anchor))
}window.CQ_SiteAdmin_id=id;
CQ.Ext.EventManager.on(window,"blur",function(){window.setTimeout(function(){CQ.Ext.getCmp(id+"-grid").stopEditing(true)
},500)
});
this.typeCache={}
},initComponent:function(){CQ.wcm.SiteAdmin.superclass.initComponent.call(this);
var a=this;
CQ.Ext.getCmp(a.id+"-tree").getSelectionModel().on("selectionchange",function(b,c){if(c){var g=c.getPath();
a.loadPages(c);
CQ.Ext.History.add(g,true);
a.setDocumentTitle(c.text);
if(c.attributes&&c.attributes.type){a.typeCache[g]=c.attributes.type
}a.checkActions()
}})
},setDocumentTitle:function(b){var a=this.title;
if(b){a+=" | "+b
}document.title=a
},getType:function(path){if(!this.typeCache[path]){var info=CQ.HTTP.eval(path+".json");
if(info){this.typeCache[path]=info["jcr:primaryType"]
}}return this.typeCache[path]
},copySelectionToClipboard:function(){this.copyClipboard=new Array();
var b=this.getSelectedPages();
for(var a=0;
a<b.length;
a++){this.copyClipboard.push(b[a].id)
}this.checkActions()
},hasClipboardSelection:function(){return((this.copyClipboard!=null)&&(this.copyClipboard.length>0))
},pasteFromClipboard:function(c){this.mask();
var g=CQ.wcm.SiteAdmin.getTargetFromTree();
for(var b=0;
b<this.copyClipboard.length;
b++){var j="cmd=copyPage&_charset_=utf-8&srcPath="+encodeURIComponent(this.copyClipboard[b])+"&destParentPath="+encodeURIComponent(g)+"&before=";
if(c){j+="&shallow=true"
}var a=CQ.HTTP.post("/bin/wcmcommand?"+j)
}this.reloadCurrentTreeNode()
},performCopy:function(a,m,j,k,c){this.mask();
var n="cmd=copyPage&_charset_=utf-8&srcPath="+encodeURIComponent(m.getPath())+"&destParentPath="+encodeURIComponent(k.getPath());
if(k.childNodes[c]){n+="&before="+k.childNodes[c].getPath()
}else{n+="&before="
}var b=CQ.HTTP.post("/bin/wcmcommand?"+n);
var g=b.headers.Status&&b.headers.Status=="200";
if(!g){this.unmask()
}return g
},performLiveCopy:function(q,b,n,o,j){this.mask();
var k=CQ.WCM.getPage(o.getPath());
var a=CQ.HTTP.encodePath(b.getPath());
var g=CQ.HTTP.encodePath(o.getPath());
var m=null;
if(o.childNodes[j]){m=o.childNodes[j].getPath()
}var c=CQ.wcm.msm.MSM.Commands.createLiveCopy(a,g,m,null,false,null,function(){this.unmask()
},this);
return true
},performAfterCopy:function(b,k,g,j,c){var a=this;
window.setTimeout(function(){b.getLoader().load(g,function(){g.expand();
g.select()
});
CQ.Ext.getCmp(a.id+"-grid").getStore().reload()
},10)
},performAfterMoveOrReorder:function(b,k,g,j,c){var a=this;
window.setTimeout(function(){var v=g.getPath();
var r=j.getPath();
if(j.parentNode){var q=j.parentNode.getPath();
var m;
if(v.split("/").length>q.split("/").length&&v.indexOf(q)==0){m=[j.parentNode]
}else{if(q.indexOf(v)==0){m=[g]
}else{m=[j.parentNode,g]
}}var t=k.getPath();
var n=t.substring(t.lastIndexOf("/")+1);
var u=function(w){w.un("expand",u);
window.setTimeout(function(){a.loadPath(r+"/"+n)
},10)
};
m[0].on("expand",u);
for(var o=0;
o<m.length;
o++){m[o].reload()
}}else{j.getOwnerTree().getRootNode().reload();
a.loadPath(j.getPath())
}},10)
},performMoveOrReorder:function(w,c,r,u,n){this.mask();
var t=this;
var v=c.getPath().split("/");
var a=encodeURIComponent(v[v.length-1]);
var b=encodeURIComponent(c.getPath());
var q=encodeURIComponent(u.getPath());
var j="cmd=movePage&_charset_=utf-8&srcPath="+b+"&destPath="+q+"/"+a;
if(u.childNodes[n]){j+="&before="+encodeURIComponent(u.childNodes[n].getPath())
}else{j+="&before="
}var g=CQ.HTTP.post("/bin/wcmcommand?"+j);
var k="500";
if(g.headers.Status){k=g.headers.Status
}if(k=="200"){return true
}else{if(k=="412"){var m={path:b,dstName:a,dstParentPath:q};
var o=new CQ.wcm.HeavyMoveDialog(m);
o.on("beforesubmit",function(){t.mask()
});
o.success=function(){t.performAfterMoveOrReorder(w,c,r,u,n)
};
this.unmask();
o.show()
}else{this.unmask()
}}return false
},performReorder:function(k,j){if(k==j){return
}if(j==undefined){j=""
}var n=encodeURIComponent(k);
var m="cmd=movePage&_charset_=utf-8&srcPath="+n+"&destPath="+n+"&before="+encodeURIComponent(j);
var c=CQ.HTTP.post("/bin/wcmcommand?"+m);
var a=this;
var g=function(){};
var b="500";
if(c.headers.Status){b=c.headers.Status
}if(b=="200"){return g
}return null
},getGridConfigId:function(a){if(!a){a="/"
}var b=this.initialConfig.gridConfig;
var c;
for(c in b){gridCfg=b[c];
if(new RegExp(b[c].pathRegex).test(a)){break
}}if(!c){c="pages"
}return c
},getGridConfig:function(a){var b=this.initialConfig.gridConfig;
var c=this.getGridConfigId(a);
if(c){return b[c]
}else{return null
}},reconfigureGrid:function(c,g){c.inProgress=[];
var a=this.getGridConfig(g);
if(!a){return c.getStore()
}if(!a.inited){a.store=new CQ.Ext.data.Store(a.storeConfig);
a.store.on("beforeload",function(){c.inProgress=[]
});
a.colModel=new CQ.Ext.grid.ColumnModel({columns:a.colModelColumns,defaults:{sortable:true}});
a.colModel.on("hiddenchange",function(k,m,n){c.saveState();
if(!n&&k.getColumnById(k.getColumnId(m)).refreshOnHiddenchange){c.getView().refresh(true)
}});
a.inited=true
}var b=a.storeProxyPrefix+CQ.shared.HTTP.encodePath(g)+a.storeProxySuffix;
a.store.proxy.api.read.url=b;
if(a.store.lastOptions){delete a.store.lastOptions
}this.pagingToolbar.bindStore(a.store);
this.pagingToolbar.pageSize=a.pageSize;
this.pagingToolbar.displayMsg=a.pageText;
if(a.pathRegex!=this.lastGridPathRegex){c.reconfigure(a.store,a.colModel);
var j=this.getGridConfigId(this.treePath);
c.stateId=c.id+"-"+j;
c.initState();
this.lastGridPathRegex=a.pathRegex;
a.store.removeAll()
}return a.store
},showPagingToolbar:function(){if(this.pagingToolbar.hidden){this.pagingToolbar.show();
this.pagingToolbar.ownerCt.doLayout()
}},hidePagingToolbar:function(){if(!this.pagingToolbar.hidden){this.pagingToolbar.hide();
this.pagingToolbar.ownerCt.doLayout()
}},checkPagingToolbar:function(a){if(a<=this.pagingToolbar.pageSize){this.hidePagingToolbar()
}else{this.showPagingToolbar()
}},reloadPages:function(){this.mask();
var a=CQ.Ext.getCmp(this.id+"-grid").getStore();
a.reload({callback:function(){this.checkPagingToolbar(a.getTotalCount());
this.unmask()
},scope:this})
},loadPages:function(node,selectRecord){this.mask();
this.lastClickedRow=-1;
var path=node.getPath();
this.treePath=path;
this.treePathEncoded=CQ.HTTP.encodePath(path);
var grid=CQ.Ext.getCmp(this.id+"-grid");
var store=this.reconfigureGrid(grid,this.treePath);
var id=this.id;
var admin=this;
store.reload({callback:function(records,options,success){if(id=="cq-damadmin"){var cookieValue="path="+encodeURIComponent(path)+"&p.limit=-1&mainasset=true&type=dam:Asset";
CQ.HTTP.setCookie("cq-mrss",cookieValue,"/bin")
}var recSelected=false;
if(selectRecord){var selModel=grid.getSelectionModel();
for(var i=0;
i<records.length;
i++){if(records[i].id==selectRecord){selModel.clearSelections();
selModel.selectRecords([records[i]]);
recSelected=true
}}if(id=="cq-damadmin"&&selModel.hasSelection()){CQ.wcm.SiteAdmin.openPages.call(admin)
}}admin.checkPagingToolbar(store.getTotalCount());
if(selectRecord&&!recSelected&&!admin.pagingToolbar.hidden){try{var sort=grid.getStore().sortInfo;
var url=store.proxy.api.read.url;
for(var param in store.baseParams){url=CQ.HTTP.addParameter(url,param,store.baseParams[param])
}if(sort){url=CQ.HTTP.addParameter(url,"sort",sort.field);
url=CQ.HTTP.addParameter(url,"dir",sort.direction)
}url=CQ.HTTP.addParameter(url,"index","true");
url=CQ.HTTP.addParameter(url,"path",selectRecord);
var index=CQ.HTTP.eval(url).index+1;
if(index>0){var selectRow=function(recs){grid.getSelectionModel().selectRecords([this.getById(selectRecord)]);
CQ.wcm.SiteAdmin.openPages.call(admin);
this.un("load",selectRecord)
};
grid.getStore().on("load",selectRow);
admin.pagingToolbar.changePage(index)
}}catch(e){}}admin.unmask()
}})
},loadPath:function(g,c){var b=this;
var j=function(n,k,m){if(n){this.loadPages(k,m);
k.expand()
}else{this.loadPath(this.treePath.substring(0,this.treePath.lastIndexOf("/")),this.treePath)
}};
var a=CQ.Ext.getCmp(this.id+"-tree");
if(!g&&!this.treePath){this.treePath=a.getRootNode().getPath();
a.selectPath(a.getRootNode().id,"id",function(m,k){j.call(b,m,k,c)
})
}else{if(g){this.treePath=g
}if(this.treePath==a.getRootNode().getPath()){a.selectPath(a.getRootNode().id,"id",function(m,k){j.call(b,m,k,c)
})
}else{a.selectPath(this.treePath,"name",function(m,k){j.call(b,m,k,c)
})
}}},reloadCurrentTreeNode:function(){var a=CQ.Ext.getCmp(this.id+"-tree");
var b;
try{b=a.getSelectionModel().getSelectedNode()
}catch(c){}if(b&&b!=a.getRootNode()){var g=b.getPath();
b.parentNode.reload(function(){a.selectPath(g,null,function(k,j){if(k){j.expand()
}})
})
}else{a.getRootNode().reload()
}CQ.Ext.getCmp(this.id+"-grid").getStore().reload();
this.unmask()
},getCurrentPath:function(){var a=CQ.Ext.getCmp(this.id+"-tree");
var b=a.getSelectionModel().getSelectedNode();
if(b!=null){return b.getPath()
}},getSelectedPages:function(){var g=CQ.Ext.getCmp(this.id+"-grid").getSelectionModel().getSelections();
var j=CQ.Ext.getCmp(window.CQ_SiteAdmin_id+"-tabpanel");
if(j){var b=CQ.Ext.getCmp(j.getActiveTab().id+"-grid");
if(b){g=b.getSelectionModel().getSelections()
}}if(g.length>0){return g
}else{if(this.treePath){var a=this;
var c=CQ.Ext.getCmp(this.id+"-tree").getSelectionModel().getSelectedNode();
return[{id:a.treePath,label:a.treePath.substring(a.treePath.lastIndexOf("/")+1),replication:c&&c.attributes?c.attributes.replication:null,title:c?c.text:null,type:null,_displayTitle_:true,get:function(k){return this[k]
}}]
}else{return[]
}}},updateS7PublishCapability:function(a){var n=false;
if(a){for(var k=0;
k<a.length;
k++){var o=a[k].id;
var m=a[k].get("type");
var j=false;
if(typeof m!="undefined"&&(m=="dam:Asset"||m=="sling:OrderedFolder"||m=="sling:Folder")){j=true
}if(j){var g={};
var c=CQ.HTTP.get(o+".s7config.json");
if(CQ.utils.HTTP.isOk(c)){var b=c.body;
g=JSON.parse(b)
}if(g&&g.scene7ConfigPath){n=true
}else{n=false;
break
}}}}this.canPublishToScene7=n
},mask:function(){if(!this.loadMask){this.loadMask=new CQ.Ext.LoadMask(this.id+"-wrapper",{msg:CQ.I18n.getMessage("Loading...")})
}this.loadMask.show()
},unmask:function(a){if(!this.loadMask){return
}this.loadMask.hide()
},html5UploadFiles:function(files){var admin=this;
var tree=CQ.Ext.getCmp(this.id+"-tree");
var selectedNode;
try{selectedNode=tree.getSelectionModel().getSelectedNode()
}catch(e){}if(!selectedNode){return
}var path=selectedNode.getPath();
var parent=CQ.HTTP.eval(CQ.HTTP.noCaching(path+".1.json"));
var conflicts=[];
for(var i=0;
i<files.length;
i++){var file=files[i];
if(parent[file.name]){conflicts.push(file.name)
}}if(conflicts.length>0&&this.createVersion==false){var msg=conflicts.length==1?CQ.I18n.getMessage("An asset of the same name already exists in this location:"):CQ.I18n.getMessage("Assets of the same name already exist in this location:");
msg+="<br/><br/>";
for(i=0;
i<conflicts.length;
i++){msg+=CQ.shared.XSS.getXSSValue(conflicts[i])+"<br/>"
}msg+="<br/><br/>";
msg+=conflicts.length==1?CQ.I18n.getMessage("Click 'Create Version' to create the verison of the asset or <br/><br/> 'Replace' to replace the asset or 'Cancel' to adjust the name."):CQ.I18n.getMessage("Click 'Create Version' to create the verison of the assets or <br/><br/> 'Replace' to replace the assets or 'Cancel' to adjust the names.");
CQ.Ext.Msg.show({title:CQ.I18n.getMessage("Name Conflict"),msg:msg,buttons:{yes:"Create Version",handler:function(){},no:"Replace",handler:function(){},cancel:"Cancel",handler:function(){}},icon:CQ.Ext.MessageBox.QUESTION,fn:function(btnId){if(btnId=="yes"){this.createVersion=true;
this.html5UploadFiles(files);
this.createVersion=false
}else{if(btnId=="no"){for(var i=0;
i<conflicts.length;
i++){CQ.HTTP.post(path+"/"+CQ.shared.HTTP.encodePath(conflicts[i]),null,{":operation":"delete"})
}this.createVersion=true;
this.html5UploadFiles(files);
this.createVersion=false
}else{this.createVersion=false
}}},scope:this})
}var uploader={path:path,current:0,uploaded:0,totalSize:0,files:0,isFile:function(file){if(file.size==0){return false
}if(file.size<512&&file.type==""&&file.name.indexOf(".")<0){return false
}return true
},upload:function(files){this.files=[];
for(var i=0;
i<files.length;
i++){var file=files[i];
if(this.isFile(file)){this.totalSize+=file.fileSize;
this.files.push(file)
}else{CQ.Notification.notify(CQ.shared.XSS.getXSSValue(file.name),CQ.I18n.getMessage("It is not possible to upload folders"))
}}if(this.files.length==0){return
}this.progress=new CQ.Ext.ProgressBar();
this.mainWin=new CQ.Ext.Window({width:400,title:"File Upload",layout:"anchor",renderTo:admin.id+"-grid",closable:false,items:[this.progress]}).show();
this.uploadNext()
},finish:function(){this.mainWin.close();
this.mainWin.destroy();
admin.reloadPages()
},uploadNext:function(){if(this.current>=this.files.length){this.progress.updateProgress(1);
if(path.indexOf("/content/dam")==0){new CQ.Ext.util.DelayedTask(this.finish,this).delay(1000)
}else{this.finish()
}return
}var file=this.files[this.current++];
this.currentSize=file.fileSize;
this.progress.updateProgress(this.uploaded/this.totalSize);
var sfx="";
if(this.files.length>1){sfx=" ("+this.current+"/"+this.files.length+")"
}this.progress.updateText("Uploading "+CQ.shared.XSS.getXSSValue(file.fileName)+sfx);
var self=this;
var req=new XMLHttpRequest();
req.upload.addEventListener("load",function(evt){self.uploaded+=self.currentSize;
self.uploadNext()
},false);
req.upload.addEventListener("progress",function(evt){self.progress.updateProgress((self.uploaded+evt.loaded)/self.totalSize)
},false);
if(!CQ.Ext.form.VTypes.name(file.fileName)){CQ.Notification.notify(file.fileName,"<br>"+CQ.Ext.form.VTypes.nameText);
this.uploadNext();
return
}req.fileName=file.name;
req.onreadystatechange=function(){if(this.readyState==4){if(!CQ.HTTP.isOkStatus(this.status)){CQ.Notification.notify(CQ.shared.XSS.getXSSValue(this.fileName),CQ.I18n.getMessage("Failed to upload asset"));
self.finish()
}}};
if(window.FormData){var f=new FormData();
f.append("file",file);
f.append("_charset_","utf-8");
req.open("POST",CQ.HTTP.externalize(CQ.HTTP.encodePath(CQ.wcm.SiteAdmin.getPostUploadUrl(path,file.name))),true);
req.send(f)
}else{req.open("PUT",CQ.HTTP.externalize(CQ.HTTP.encodePath(path+"/"+file.name)),true);
req.send(file)
}}};
if(conflicts.length==0||this.createVersion==true){uploader.upload(files)
}}});
CQ.Ext.reg("siteadmin",CQ.wcm.SiteAdmin);
CQ.Ext.override(CQ.wcm.SiteAdmin,CQ.wcm.AdminBase);
CQ.wcm.SiteAdmin.formatDate=function(b){if(!b){return""
}if(typeof b==="number"){b=new Date(b)
}var a=CQ.I18n.getMessage("d-M-Y H:i",null,"Date format for ExtJS SiteAdmin (short, eg. two-digit year, http://extjs.com/deploy/ext/docs/output/Date.html)");
return b.format(a)
};
CQ.wcm.SiteAdmin.formatRelativeDate=function(b){if(typeof b==="number"){b=new Date(b)
}var a=new Date();
var g=parseInt((a-b)/1000);
var c="";
if(g<60){c=CQ.I18n.getMessage("seconds")
}else{if(g<3600){g=parseInt(g/60);
c=g>1?CQ.I18n.getMessage("minutes"):CQ.I18n.getMessage("minute")
}else{if(g<86400){g=parseInt(g/3600);
c=g>1?CQ.I18n.getMessage("hours"):CQ.I18n.getMessage("hour")
}else{if(g<31536000){g=parseInt(g/86400);
c=g>1?CQ.I18n.getMessage("days"):CQ.I18n.getMessage("day")
}else{g=parseInt(g/31536000);
c=g>1?CQ.I18n.getMessage("years"):CQ.I18n.getMessage("year")
}}}}return CQ.I18n.getMessage("{0} {1} ago",[g,c],"Relative date to the current date")
};
CQ.wcm.SiteAdmin.getPostUploadUrl=function(b,c){var a=b;
if(b.match(/^\/content\/dam.*/)){a+=".createasset.html"
}else{if(c){a+="/"+c
}}return a
};
CQ.wcm.SiteAdmin.DD_GROUP_TREE="cq.siteadmin.tree";
CQ.wcm.SiteAdmin.DD_GROUP_GRID="cq.siteadmin.grid";
CQ.wcm.SiteAdmin.TEXT_EDITOR=new CQ.Ext.form.TextField({enableKeyEvents:true,listeners:{render:function(){window.CQ_TextEditor=this
}}});
CQ.wcm.SiteAdmin.GRID_LISTENERS={beforeedit:{title:function(g){var b=g.record.data.lockedBy;
var c=CQ.User.getUserID();
var a=b!=undefined&&b.length>0&&b!=c;
if(a){return false
}return this.inProgress.indexOf(g.record.id)==-1
}},afteredit:{title:function(a){if(a.originalValue==undefined){a.originalValue=""
}CQ.Ext.Msg.confirm(CQ.I18n.getMessage("Change title"),CQ.I18n.getMessage("Are you sure you want to change the title from '{0}' to '{1}'?",[CQ.shared.XSS.getXSSValue(a.originalValue),CQ.shared.XSS.getXSSValue(a.value)]),function(g){if(g=="yes"){var c="./jcr:content/jcr:title";
if(a.record.get("type")=="dam:Asset"){c="./jcr:content/metadata/dc:title"
}var k={};
k._charset_="utf-8";
k[c]=a.value;
var b=CQ.HTTP.post(a.record.id,null,k);
if(CQ.HTTP.isOk(b)){a.record.commit();
try{CQ.Ext.getCmp(window.CQ_SiteAdmin_id+"-tree").getSelectionModel().getSelectedNode().reload()
}catch(j){}}else{a.record.reject()
}}else{a.record.reject()
}},this)
},label:function(n){var m=n.record.id;
n.record.id=m.substring(0,m.lastIndexOf("/")+1)+n.value;
var a=CQ.Ext.getCmp(this.id+"-tree");
var b=a.getRootNode();
var j;
var k=m.split("/");
for(var g=1;
g<k.length;
g++){var c=k[g];
if(c==b.attributes.name){j=b
}else{j=j.findChild("name",c)
}}j.attributes.name=n.value
}},validateedit:{label:function(k){var n=k.record.id;
var j=k.value;
var a=n.substring(0,n.lastIndexOf("/")+1)+j;
var m="?cmd=movePage&_charset_=utf-8&srcPath="+n+"&destPath="+a;
var c=CQ.HTTP.post("/bin/wcmcommand"+m);
var b="500";
if(c.headers.Status){b=c.headers.Status
}if(b=="200"){return true
}else{if(b=="412"){var g={path:n,dstName:j};
new CQ.wcm.HeavyMoveDialog(g).show();
return false
}else{return false
}}}}};
CQ.wcm.SiteAdmin.COLUMNS={numberer:{id:"numberer",header:CQ.I18n.getMessage(""),width:23,menuDisabled:true,fixed:true,hideable:false,dataIndex:"index",renderer:function(b,c,a){if(b!=undefined){return b+1
}return""
}},title:{header:CQ.I18n.getMessage("Title"),id:"title",dataIndex:"title",editor:CQ.wcm.SiteAdmin.TEXT_EDITOR,renderer:function(c,a,b){return CQ.shared.XSS.getXSSValue(c)
}},name:{header:CQ.I18n.getMessage("Name"),id:"name",dataIndex:"label",width:80,renderer:function(j,c,g){var b=g.id.toString();
var a=b.lastIndexOf("/")+1;
return b.substring(a)
}},template:{header:CQ.I18n.getMessage("Template"),id:"template",dataIndex:"templateTitle",renderer:function(b,g,a){var c=CQ.shared.XSS.getXSSRecordPropertyValue(a,"templateShortTitle");
if(c.length>0){return CQ.I18n.getVarMessage(c)
}else{return CQ.I18n.getVarMessage(b)
}}},published:{header:CQ.I18n.getMessage("Published"),id:"published",dataIndex:"replication",renderer:function(m,a,c){var j="";
var n="";
var g=c.data.replication;
var b="";
var o=CQ.I18n.getMessage("N/A");
var k=CQ.I18n.getMessage("N/A");
if(g&&g.published){n=CQ.wcm.SiteAdmin.formatDate(new Date(g.published));
n+=" ("+CQ.shared.XSS.getXSSTablePropertyValue(g,"publishedBy")+")";
if(g.numQueued){b=' ext:qtip="<nobr>';
if(g.action=="ACTIVATE"){j="status-pending-activation";
b+=CQ.I18n.getMessage("Activation pending. #{0} in Queue.",g.numQueued)
}else{j="status-pending-deactivation";
b+=CQ.I18n.getMessage("Deactivation pending. #{0} in Queue.",g.numQueued)
}b+='</nobr>"'
}else{if(g.action=="ACTIVATE"){if(!c.data.timeUntilValid){if(!c.data.offTime){j="status-activated"
}else{j="status-offtime"
}}else{if(c.data.timeUntilValid){if(c.data.offTime){j="status-onofftime"
}else{j="status-ontime"
}}else{j="status-deactivated"
}}}else{j="status-deactivated"
}}if(c.data.timeUntilValid&&(c.data.onTime||c.data.offTime)){b='ext:qtip="<nobr>';
if(c.data.onTime){o=CQ.wcm.SiteAdmin.formatDate(new Date(c.data.onTime));
b+="<b>"+CQ.I18n.getMessage("On Time")+":</b> "+o+"<br/>"
}if(c.data.offTime){k=CQ.wcm.SiteAdmin.formatDate(new Date(c.data.offTime));
b+="<b>"+CQ.I18n.getMessage("Off Time")+":</b> "+k+"<br/>"
}b+='</nobr>"'
}}else{j="status-none"
}return'<div class="status double '+j+'" '+b+"><span>"+n+"</span></div>"
}},modified:{header:CQ.I18n.getMessage("Modified"),id:"modified",dataIndex:"lastModified",renderer:function(c,n,b){var k=b.data.replication;
var a=b.data.lastModified;
var m="";
var g="";
if(a>0){m=CQ.wcm.SiteAdmin.formatDate(new Date(b.data.lastModified));
var j=CQ.shared.XSS.getXSSTablePropertyValue(b.data,"lastModifiedBy");
if(j&&j.length>0){m+=" ("+j+")"
}g="status-localmodified"
}if(k&&k.published){if(k.action=="ACTIVATE"){if(a>k.published){g="status-modified"
}}}if(!g){g="status-localmodified"
}return'<div class="status '+g+'">'+m+"</div>"
}},metadata:{header:CQ.I18n.getMessage("Metadata Template Instance"),id:"metadata",dataIndex:"metadata",renderer:function(b,j,a){var c=a.json["cq:ingestionTemplateInstanceName"];
var g="";
if(c){g+=c
}return g?g:""
}},scene7Status:{header:CQ.I18n.getMessage("Scene7 Publish Status"),hidden:true,id:"scene7Status",data:"scene7Status",renderer:function(c,k,b){var g="";
var a=b.data.scene7Status;
var j="";
if(a){j=' ext:qtip="<nobr>';
if(a=="UploadStart"){g="status-s7-pending";
j+=CQ.I18n.getMessage("Upload started")
}else{if(a=="UploadFailed"){g="status-s7-failed";
j+=CQ.I18n.getMessage("Upload failed")
}else{if(a=="PublishStart"){g="status-s7-pending";
j+=CQ.I18n.getMessage("Publish started")
}else{if(a=="PublishQueued"){g="status-s7-queued";
j+=CQ.I18n.getMessage("Publish queued")
}else{if(a=="PublishFailed"){g="status-s7-failed";
j+=CQ.I18n.getMessage("Publish failed")
}else{if(a=="PublishComplete"){g="status-s7-complete";
j+=CQ.I18n.getMessage("Publish complete")
}}}}}}j+='</nobr>"'
}else{g="status-s7-none"
}return'<div class="status double '+g+'" '+j+"></div>"
}},status:{header:CQ.I18n.getMessage("Status"),id:"status",dataIndex:"X",width:90,renderer:function(u,F,c){var y="";
var A=c.data.scheduledTasks;
if(A!=undefined&&A.length>0){var o="<table class='qtip-table'><tr><th>"+CQ.I18n.getMessage("Task")+"</th><th>"+CQ.I18n.getMessage("Scheduled")+"</th><th>"+CQ.I18n.getMessage("Version")+"</th></tr>";
A.sort(function I(t,r){if(t.scheduled<r.scheduled){return -1
}else{if(t.scheduled>r.scheduled){return 1
}}return 0
});
for(var x=0;
x<A.length;
x++){var n=(typeof(A[x].version)!="undefined")?A[x].version:"";
var a=(A[x].type=="activation")?"status status-scheduledtask-activation":"status status-scheduledtask-deactivation";
o+="<tr><td class='"+a+"'></td><td>"+CQ.wcm.SiteAdmin.formatDate(A[x].scheduled)+" ("+A[x].scheduledBy+")</td><td>"+n+"</td></tr>"
}o+="</table>";
y+='<span class="status status-scheduledtask" ext:qtip="'+o+'">&nbsp;</span>'
}var b=c.data.workflows;
if(b!=undefined&&b.length>0){var g="<table class='qtip-table'><tr><th>"+CQ.I18n.getMessage("Workflow")+"</th><th>"+CQ.I18n.getMessage("Step")+"</th></tr>";
for(var q=0;
q<b.length;
q++){var E="";
var C=b[q].workItems;
for(var D=0;
D<C.length;
D++){E+=CQ.shared.Util.htmlEncode(CQ.I18n.getVar(C[D].item));
if(C[D].assignee){E+=" ("+CQ.shared.Util.htmlEncode(C[D].assignee)+")"
}E+="<br/>"
}var z=b[q].suspended?"workflow-suspended":"";
g+="<tr class="+z+"><td>"+CQ.shared.Util.htmlEncode(CQ.I18n.getVar(b[q].model))+"</td><td>"+E+"</td></tr>"
}g+="</table>";
y+='<span class="status status-workflow" ext:qtip="'+g+'">&nbsp;</span>'
}var B=c.data.lockedBy;
if(B!=undefined&&c.data.lockedBy){var m="<table class='qtip-table'><tr><th>"+CQ.I18n.getMessage("Lock",null,"noun")+"</th></tr>";
m+="<tr><td>"+CQ.I18n.getMessage("Locked by {0}",B)+"</td></tr></table>";
y+='<span class="status status-locked" ext:qtip="'+m+'">&nbsp;</span>'
}var k=false;
var H=null;
if(c.data[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP]!=undefined&&c.data[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP]){k=true;
H=c.data
}else{if(c.json&&c.json[CQ.wcm.msm.MSM.PARAM_IS_LIVECOPY]===true&&c.json[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP]!=undefined&&c.json[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP]){k=true;
H=c.json
}}if(k){var j=CQ.wcm.msm.MSM.getRelationStatus(H[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP]);
j=j?j.replace(/.*title\=\"(.*)\"\ alt\=.*/,"$1"):"";
var G="<table class='qtip-table'><tr><th>"+CQ.I18n.getMessage("Live Copy")+"</th></tr>";
G+="<tr><td>"+j+"</td></tr></table>";
y+='<span class="status status-livecopy" ext:qtip="'+G+'">&nbsp;</span>'
}return y
}},impressions:{header:CQ.I18n.getMessage("Impressions"),id:"impressions",dataIndex:"monthlyHits",tooltip:CQ.I18n.getMessage("Page impressions last 30 days"),renderer:function(m,j,a,n,c,b){if(m>0){var k=m;
b.each(function(o){k=Math.max(k,o.get("monthlyHits"))
});
var g=Math.ceil(75*(m/k));
return'<div class="'+j.css+'monthly-hits" ext:qtip="'+CQ.I18n.getMessage("Show impressions chart")+'" style="width:'+g+'px">'+m+"</div>"
}else{return'<div class="'+j.css+'no-hits" ext:qtip="'+CQ.I18n.getMessage("Show impressions chart")+'">'+m+"</div>"
}}},workflow:{header:CQ.I18n.getMessage("In Workflow"),id:"workflow",dataIndex:"inWorkflow",hidden:true,renderer:function(b,c,a){return b?CQ.I18n.getMessage("Yes"):""
}},locked:{header:CQ.I18n.getMessage("Locked by"),id:"locked",hidden:true,dataIndex:"lockedBy"},liveCopyStatus:{header:CQ.I18n.getMessage("Live Copy"),id:"liveCopyStatus",hidden:true,dataIndex:"msm:liveRelationship",renderer:function(c,g,a){var b=a.data[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP];
return CQ.wcm.msm.MSM.getRelationStatus(b)
}},thumbnail:{header:'<span class="hidden">'+CQ.I18n.getMessage("Thumbnail")+"</span>",id:"thumbnail",width:60,menuDisabled:true,hideable:true,refreshOnHiddenchange:true,dataIndex:"X",sortable:false,hidden:true,renderer:function(t,A,c){var r=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
var a=CQ.Ext.getCmp(window.CQ_SiteAdmin_id+"-grid");
if(a.getColumnModel().getColumnById(A.id).hidden){return""
}var u=c.id;
var w=/.*\:.*[F|f]older/.test(c.get("type"));
if(r.treePath.indexOf("/content/dam/")==0&&!w){var y=a.inProgress.indexOf(u);
var g=c.get("inProgress");
if(g||c.get("lastModified")==0){var z=g<0?"/libs/cq/ui/widgets/themes/default/ext/window/icon-error.gif":"/libs/cq/ui/widgets/themes/default/icons/48x48/document_loading.gif";
var x='<img src="'+CQ.HTTP.externalize(z)+'"';
var o="<nobr>"+CQ.I18n.getMessage("In Progress")+"</nobr>";
if(g<0){o="<b>"+CQ.I18n.getMessage("Failed to process asset")+"</b>";
if(c.get("inWorkflow")){var b=c.get("workflows");
if(b&&b.length>0){var n=b[0];
if(n.workItems&&n.workItems.length>0){var k=n.workItems[n.workItems.length-1];
if(k.failureMessage){o+="<br/>";
o+=k.failureMessage
}}}}}if(g){x+=' ext:qtip="'+o+'"';
var m=a.getStore().indexOf(c);
setTimeout(function(){var v=CQ.Ext.fly(a.getView().getRow(m));
if(g<0){v.addClass("status-error")
}else{}},1)
}x+=">";
return x
}}var q=c.get("ck");
var j=CQ.HTTP.externalize(CQ.shared.XSS.getXSSValue(CQ.HTTP.encodePath(u))+".thumb.48.48"+(q?"."+q:"")+".png",true);
return'<img src="'+j+'">'
}},size:{header:CQ.I18n.getMessage("Size"),id:"size",width:60,dataIndex:"size",renderer:function(b,c,a){return b?CQ.Util.formatFileSize(b):""
}},width:{header:CQ.I18n.getMessage("Width"),id:"width",width:55,dataIndex:"width",renderer:function(b,c,a){return b?b:""
}},height:{header:CQ.I18n.getMessage("Height"),id:"height",width:50,dataIndex:"height",renderer:function(b,c,a){return b?b:""
}},mime:{header:CQ.I18n.getMessage("Kind"),id:"mime",hidden:true,dataIndex:"mime"}};
CQ.wcm.SiteAdmin.CONTEXT_TOOLBAR="toolbar";
CQ.wcm.SiteAdmin.CONTEXT_CONTEXTMENU="contextmenu";
CQ.wcm.SiteAdmin.UPLOAD_URL_ASSET_REGEXP=/\.createasset\.html$/;
CQ.wcm.SiteAdmin.createPage=function(){var b=this.getCurrentPath();
var c=CQ.wcm.Page.getCreatePageDialog(b);
var a=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
c.on("beforesubmit",function(){a.mask()
});
c.success=function(){a.reloadCurrentTreeNode()
};
c.failure=function(){a.unmask();
CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not create page."))
};
c.show()
};
CQ.wcm.SiteAdmin.createSite=function(){var a=this;
var b=CQ.WCM.getDialog("","cq-siteadmin-csw",true);
if(!b){b=new CQ.wcm.CreateSiteWizard();
b.on("beforesubmit",function(){a.mask()
});
b.success=function(){a.reloadCurrentTreeNode()
};
b.failure=function(g,c){a.unmask();
CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not create site: {0}",[c.result["Message"]]))
};
CQ.WCM.registerDialog("cq-siteadmin-csw",b)
}b.loadContent({dstPath:this.getCurrentPath()});
b.show()
};
CQ.wcm.SiteAdmin.createLiveCopy=function(){var b=this.getCurrentPath();
var c=CQ.WCM.getDialog(CQ.wcm.msm.MSM.Commands.getCreateLiveCopyDialogConfig(b));
var a=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
c.on("beforesubmit",function(){a.mask()
});
c.success=function(){a.reloadCurrentTreeNode()
};
c.failure=function(j,g){a.unmask();
CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not create Live Copy: {0}",[g.result["Message"]]))
};
c.show()
};
CQ.wcm.SiteAdmin.internalDeletePage=function(b){this.mask();
var c=this.getSelectedPages();
var u=CQ.Ext.getCmp(this.id+"-tree");
var n=CQ.Ext.getCmp(this.id+"-grid");
var t=[];
var a=[];
for(var m=0;
m<c.length;
m++){var o=c[m];
t.push(o.id);
var r=o.id.split("/");
var g=u.getRootNode();
var q=g.getPath().split("/");
for(var k=q.length;
k<r.length;
k++){g=g.findChild("name",r[k])
}if(g){a.push(g)
}}CQ.Ext.Ajax.request({url:CQ.HTTP.externalize("/bin/wcmcommand"),method:"POST",callback:function(w,A,z){var v=CQ.HTTP.buildPostResponseFromHTML(z.responseText);
var j=v.headers[CQ.utils.HTTP.HEADER_STATUS];
if(j==200){for(var x=0;
x<c.length;
x++){n.getStore().remove(c[x])
}for(var x=0;
x<a.length;
x++){try{a[x].remove()
}catch(y){}}this.unmask()
}else{if(j==412){this.unmask();
CQ.Ext.Msg.show({title:CQ.I18n.getMessage("Delete Page"),msg:CQ.I18n.getMessage("One or more selected pages are referenced. Click 'yes' to proceed deleting the pages, click 'no' to review the references or 'cancel' to cancel the operation."),buttons:CQ.Ext.Msg.YESNOCANCEL,icon:CQ.Ext.MessageBox.QUESTION,fn:function(B){if(B=="yes"){CQ.wcm.SiteAdmin.internalDeletePage.call(this,true)
}else{if(B=="no"){CQ.wcm.SiteAdmin.showReferences.call(this)
}}},scope:this})
}else{if(j==500){this.unmask();
CQ.Notification.notifyFromResponse(v)
}else{this.unmask()
}}}},params:{path:t,_charset_:"utf-8",cmd:"deletePage",force:b},scope:this})
};
CQ.wcm.SiteAdmin.deletePage=function(){var c=this.getSelectedPages();
var k=(c.length>1)?CQ.I18n.getMessage("You are going to delete the following pages: "):CQ.I18n.getMessage("You are going to delete the following page: ");
k+="<br/><br/>";
var a=7;
for(var b=0;
b<c.length;
b++){if(b==a){k+=CQ.I18n.getMessage("(and {0} more...)",[c.length-b],"pages to delete")+"<br/>";
break
}var g=CQ.shared.XSS.getXSSRecordPropertyValue(c[b],"title");
if(!g){g=c[b].get("label")
}k+=g+"<br/>"
}k+="<br/>"+CQ.I18n.getMessage("Are you sure?");
var j=(c.length>1)?CQ.I18n.getMessage("Delete Pages"):CQ.I18n.getMessage("Delete Page");
CQ.Ext.Msg.show({title:j,msg:k,buttons:CQ.Ext.Msg.YESNO,icon:CQ.Ext.MessageBox.QUESTION,fn:function(m){if(m=="yes"){CQ.wcm.SiteAdmin.internalDeletePage.call(this,false)
}},scope:this})
};
CQ.wcm.SiteAdmin.openPage=function(path,type,newWindow,selection){if(type=="dam:Asset"){if(window.CQ_SiteAdmin_id=="cq-damadmin"){CQ.wcm.DamAdmin.openAsset(path,selection)
}else{if(!CQ.User.getCurrentUser().hasPermissionOn("modify",path)){return
}var admin=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
var config=CQ.WCM.getDialogConfig("/libs/wcm/core/content/tools/assetdialog");
if(!config.success){config.success=function(){admin.reloadPages()
}
}if(!config.failure){config.failure=function(){admin.unmask()
}
}var locker=selection.data.lockedBy;
var currentUserID=CQ.User.getUserID();
var locked=false;
if(locker.length>0&&locker!=currentUserID){locked=true
}if(locked){config.buttons=[new CQ.Ext.Button({text:"OK",disabled:true}),CQ.Dialog.CANCEL]
}var dialog=CQ.WCM.getDialog(config);
dialog.on("beforesubmit",function(){admin.mask()
});
dialog.loadContent(CQ.HTTP.encodePath(path));
if(locked){dialog.disableFields()
}dialog.show();
if(locked){var msg=CQ.I18n.getMessage("Locked");
var description=CQ.I18n.getMessage("This asset is currently locked by {0}",[locker]);
CQ.Notification.notify(msg,description,10)
}}}else{if(!/.*([fF]older)/.test(type)==0){var admin=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
admin.loadPath(path)
}else{if(path.indexOf("/etc/packages")==0){var url=CQ.HTTP.externalize("/crx/packmgr/index.jsp");
url+="#"+path;
CQ.shared.Util.open(url)
}else{if(!/.*([fF]ile)/.test(type)){var url=CQ.HTTP.externalize("/bin/wcmcommand")+"?cmd=open";
url+="&_charset_=utf-8";
url+="&path="+encodeURIComponent(path);
if(CQ.Ext.isIE){var jsonUrl=CQ.HTTP.addParameter(url,"jsonMode",true);
var r=CQ.HTTP.eval(jsonUrl);
url=r.Location
}if(CQ.wcm.SiteAdmin.multiWinMode==undefined){var wm=CQ.User.getCurrentUser().getPreference("winMode");
CQ.wcm.SiteAdmin.multiWinMode=(wm!="single")
}if(newWindow||CQ.wcm.SiteAdmin.multiWinMode){CQ.shared.Util.open(url)
}else{CQ.shared.Util.load(url)
}}}}}};
CQ.wcm.SiteAdmin.openPages=function(g,a){if(typeof g=="object"&&a){g=a.shiftKey
}var c=this.getSelectedPages();
for(var b=0;
b<c.length;
b++){CQ.wcm.SiteAdmin.openPage(c[b].id,c[b].get("type"),g,c[b]);
g=true
}};
CQ.wcm.SiteAdmin.openFindReplaceDialog=function(){var a=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(a){var b=CQ.wcm.SiteAdmin.getSingleTarget();
if(!b){return
}var c=CQ.WCM.getDialog("/libs/wcm/core/content/tools/findreplacedialog");
c.on("beforesubmit",function(){a.mask()
});
c.success=function(){a.reloadCurrentTreeNode()
};
c.failure=function(){a.unmask()
};
c.loadContent(b);
c.show()
}};
CQ.wcm.SiteAdmin.openPropertiesDialog=function(u,n,a,g,t){var m=null;
var o=null;
if((n!=null)&&(n=="cq:Page")){if((a==null)||(a=="")){m="/libs/foundation/components/page/dialog.infinity.json"
}else{m=a+".infinity.json"
}o=CQ.shared.XSS.getXSSValue(u);
o=CQ.I18n.getMessage("Page Properties of {0}",o)
}else{if((n!=null)&&(n=="nt:file")){}else{if((n!=null)&&(/.*\:.*[F|f]older/.test(n))&&n!="nt:folder"){if((a==null)||(a=="")){var k=n.replace(":","/");
m="/libs/foundation/components/primary/"+k+"/dialog.overlay.infinity.json"
}else{m=a+".infinity.json"
}o=CQ.shared.XSS.getXSSValue(u);
o=CQ.I18n.getMessage("Folder Properties of {0}",o)
}}}if(null!=m){var c=CQ.WCM.getDialogConfig(m);
if(g){c.buttons=[new CQ.Ext.Button({text:"OK",disabled:true}),CQ.Dialog.CANCEL]
}var j=CQ.WCM.getDialog(c,"NEW");
j.fieldEditLockMode=true;
j.loadContent(u+"/jcr:content");
j.setTitle(o);
j.setElId(CQ.Util.createId("cq-propsdialog"));
if((n!=null)&&(/.*\:.*[F|f]older/.test(n))&&n!="nt:folder"){j.addHidden({"./jcr:primaryType":"nt:unstructured"})
}var r=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
j.on("beforesubmit",function(){if(r){r.mask()
}});
j.success=function(){if(r){r.reloadCurrentTreeNode()
}};
j.failure=function(){if(r){r.unmask()
}};
j.on("hide",function(){setTimeout(function(){j.destroy()
},500)
});
if(g){j.disableFields()
}j.show();
if(g){var b=CQ.I18n.getMessage("Locked");
var q=CQ.I18n.getMessage("This page is currently locked by {0}",[t]);
CQ.Notification.notify(b,q,10)
}}};
CQ.wcm.SiteAdmin.openProperties=function(){var a=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(a){var m=a.getSelectedPages();
for(var j=0;
j<m.length;
j++){var k=m[j];
var b=false;
var g=k.data.lockedBy;
var c=CQ.User.getUserID();
if(g!=undefined&&g.length>0&&g!=c){b=true
}CQ.wcm.SiteAdmin.openPropertiesDialog(m[j].id,m[j].get("type"),m[j].get("dialogPath"),b,g)
}}};
CQ.wcm.SiteAdmin.copyPages=function(){this.copySelectionToClipboard()
};
CQ.wcm.SiteAdmin.pastePages=function(a,b){this.pasteFromClipboard(b.shiftKey)
};
CQ.wcm.SiteAdmin.scene7PublishPages=function(){var selections=this.getSelectedPages();
var paths=[];
var admin=this;
for(var i=0;
i<selections.length;
i++){var selection=selections[i];
var pagePath=selection.id;
paths[i]=pagePath;
var url=CQ.HTTP.noCaching("/bin/workflow.json");
url=CQ.HTTP.addParameter(url,"isInWorkflow",pagePath);
url=CQ.HTTP.addParameter(url,"_charset_","UTF-8");
var response=CQ.HTTP.get(url);
var isInWorkflow=false;
if(CQ.HTTP.isOk(response)){var data=CQ.Util.eval(response);
isInWorkflow=data.status
}if(isInWorkflow){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Info"),CQ.I18n.getMessage("A selected page is already subject to a workflow!"));
return
}}var wait=function(ms){var dt=new Date();
dt.setTime(dt.getTime()+ms);
while(new Date().getTime()<dt.getTime()){}};
var data={id:CQ.Util.createId("cq-s7publishdialog"),path:paths,basePath:this.getCurrentPath()};
var dialog=new CQ.wcm.Scene7PublishDialog(data);
dialog.addListener("beforesubmit",this.mask,this);
dialog.success=function(form){for(var i=0;
i<paths.length;
i++){var pagePath=paths[i];
wait(100);
var params={_charset_:"UTF-8",model:"/etc/workflow/models/scene7/jcr:content/model",payload:pagePath,payloadType:"JCR_PATH",isInteractiveUpload:"true"};
CQ.HTTP.post("/etc/workflow/instances",function(options,success,response){if(!success){admin.unmask()
}else{admin.reloadPages()
}},params)
}};
var dialogFailure=dialog.failure;
dialog.failure=function(){if(dialogFailure!=null){dialogFailure()
}admin.unmask()
};
dialog.show()
};
CQ.wcm.SiteAdmin.movePage=function(){var g=this.getSelectedPages();
var a=this;
for(var c=0;
c<g.length;
c++){var k=g[c].get&&g[c].get("type")=="dam:Asset";
var m=g[c].get&&g[c].get("type")=="cq:Page";
var b=CQ.wcm.Page.getMovePageDialog(g[c].id,m);
b.addListener("beforesubmit",this.mask,this);
b.success=function(q){var t="";
var n=CQ.Ext.getCmp(a.id+"-tree");
var o=n?n.getRootNode():undefined;
try{t=q.findField("destParentPath").getValue()
}catch(r){t=o?o.getPath():""
}if(k){window.setTimeout(function(){if(o){o.reload()
}a.loadPath(t)
},200)
}else{if(o){o.reload()
}a.loadPath(t)
}a.unmask()
};
var j=b.failure;
b.failure=function(){if(j!=null){j()
}a.unmask()
};
b.show();
break
}};
CQ.wcm.SiteAdmin.showReferences=function(){var b=this.getSelectedPages();
var j=[];
for(var a=0;
a<b.length;
a++){j.push(b[a].id)
}var c={path:j};
var g=new CQ.wcm.ReferencesDialog(c);
g.on("pageopen",function(m,k){m.close();
CQ.wcm.SiteAdmin.openPage(k)
});
g.show()
};
CQ.wcm.SiteAdmin.activatePage=function(){var a=this;
var j=[];
var c=this.getSelectedPages();
for(var b=0;
b<c.length;
b++){j.push(c[b].id)
}if(CQ.wcm.SiteAdmin.noAsset()){var g={id:CQ.Util.createId("cq-asset-reference-search-dialog"),path:j,callback:function(k){a.mask();
CQ.wcm.SiteAdmin.internalActivatePage.call(a,k)
}};
new CQ.wcm.AssetReferenceSearchDialog(g)
}else{this.mask();
CQ.wcm.SiteAdmin.internalActivatePage.call(a,j)
}};
CQ.wcm.SiteAdmin.internalActivatePage=function(b,c){if(c==undefined){var a=this;
c=function(j,k,g){if(k){a.reloadPages()
}else{a.unmask()
}}
}CQ.HTTP.post(CQ.shared.HTTP.externalize("/bin/replicate.json"),c,{_charset_:"utf-8",path:b,cmd:"Activate"})
};
CQ.wcm.SiteAdmin.deactivatePage=function(a,k){var c=(a&&CQ.Ext.isArray(a)?a:this.getSelectedPages());
if(!CQ.Ext.isFunction(k)){k=undefined
}var j=CQ.I18n.getMessage("You are going to deactivate the following pages: ")+"<br/>";
for(var b=0;
b<c.length;
b++){j+=CQ.shared.XSS.getXSSValue(c[b].id)+"<br/>"
}j+="<br/>"+CQ.I18n.getMessage("Are you sure?");
var g=(c.length>1)?CQ.I18n.getMessage("Deactivate Pages"):CQ.I18n.getMessage("Deactivate Page");
CQ.Ext.Msg.show({title:g,msg:j,buttons:CQ.Ext.Msg.YESNO,icon:CQ.Ext.MessageBox.QUESTION,fn:function(m){if(m=="yes"){CQ.wcm.SiteAdmin.internalDeactivatePage.call(this,k,c)
}},scope:this})
};
CQ.wcm.SiteAdmin.internalDeactivatePage=function(j,c){var a=this;
if(a.mask){a.mask()
}var g=[];
c=c||a.getSelectedPages();
for(var b=0;
b<c.length;
b++){g.push(c[b].id)
}CQ.HTTP.post(CQ.shared.HTTP.externalize("/bin/replicate.json"),j||function(m,n,k){if(n){a.reloadPages()
}else{a.unmask()
}},{_charset_:"utf-8",path:g,cmd:"Deactivate"})
};
CQ.wcm.SiteAdmin.rolloutPage=function(){var g=this.getSelectedPages();
if(g.length==1){CQ.wcm.SiteAdmin.openRolloutDialog.call(a,g[0].id)
}else{var j=new Array();
for(var c=0;
c<g.length;
++c){j.push(g[c].id)
}var a=this;
var b=new CQ.wcm.msm.RolloutWizard({path:j,hideComponents:true,hideRolloutPlan:true,isBackground:true,listeners:{beforesubmit:{fn:function(){a.mask()
}}}});
b.success=function(){CQ.Ext.getCmp(a.id+"-tree").getSelectionModel().getSelectedNode().reload();
CQ.Ext.getCmp(a.id+"-grid").getSelectionModel().clearSelections();
a.reloadPages()
};
b.failure=function(){a.unmask()
};
b.show()
}};
CQ.wcm.SiteAdmin.openRolloutDialog=function(c,b){var a=new CQ.wcm.msm.RolloutWizard({path:c,hideComponents:true});
a.show()
};
CQ.wcm.SiteAdmin.lock=function(g,a){a.mask();
var j=[];
var c=a.getSelectedPages();
for(var b=0;
b<c.length;
b++){j.push(c[b].id)
}CQ.HTTP.post(CQ.shared.HTTP.externalize("/bin/wcmcommand"),function(m,n,k){if(n){a.reloadPages()
}},{_charset_:"utf-8",path:j,cmd:g},a)
};
CQ.wcm.SiteAdmin.lockPage=function(){CQ.wcm.SiteAdmin.lock("lockPage",this)
};
CQ.wcm.SiteAdmin.unlockPage=function(){CQ.wcm.SiteAdmin.lock("unlockPage",this)
};
CQ.wcm.SiteAdmin.lockNode=function(){CQ.wcm.SiteAdmin.lock("lockNode",this)
};
CQ.wcm.SiteAdmin.unlockNode=function(){CQ.wcm.SiteAdmin.lock("unlockNode",this)
};
CQ.wcm.SiteAdmin.startWorkflow=function(){var admin=this;
var id=CQ.Util.createId("cq-workflowdialog");
var startWorkflowDialog={"jcr:primaryType":"cq:Dialog",title:CQ.I18n.getMessage("Start Workflow"),id:id,formUrl:"/etc/workflow/instances",params:{_charset_:"utf-8",payloadType:"JCR_PATH"},items:{"jcr:primaryType":"cq:Panel",items:{"jcr:primaryType":"cq:WidgetCollection",model:{xtype:"combo",name:"model",id:id+"-model",hiddenName:"model",fieldLabel:CQ.I18n.getMessage("Workflow"),displayField:"label",valueField:"wid",title:CQ.I18n.getMessage("Available Workflows"),selectOnFocus:true,triggerAction:"all",allowBlank:false,editable:false,store:new CQ.Ext.data.Store({proxy:new CQ.Ext.data.HttpProxy({url:"/libs/cq/workflow/content/console/workflows.json",method:"GET"}),baseParams:{tags:"wcm"},reader:new CQ.Ext.data.JsonReader({totalProperty:"results",root:"workflows"},[{name:"wid"},{name:"label"},{name:CQ.shared.XSS.getXSSPropertyName("label")}])}),tpl:new CQ.Ext.XTemplate('<tpl for=".">','<div class="x-combo-list-item">','{[CQ.I18n.getVarMessage(CQ.shared.XSS.getXSSTablePropertyValue(values, "label"))]}',"</div>","</tpl>")},comment:{"jcr:primaryType":"cq:TextArea",fieldLabel:CQ.I18n.getMessage("Comment"),name:"startComment",height:200},title:{xtype:"textfield",name:"workflowTitle",fieldLabel:CQ.I18n.getMessage("Workflow Title")}}},okText:CQ.I18n.getMessage("Start")};
var dialog=CQ.WCM.getDialog(startWorkflowDialog);
var selections=this.getSelectedPages();
for(var i=0;
i<selections.length;
i++){var selection=selections[i];
var pagePath=selection.id;
var url=CQ.HTTP.noCaching("/bin/workflow.json");
url=CQ.HTTP.addParameter(url,"isInWorkflow",pagePath);
url=CQ.HTTP.addParameter(url,"_charset_","UTF-8");
var response=CQ.HTTP.get(url);
var isInWorkflow=false;
if(CQ.HTTP.isOk(response)){var data=CQ.Util.eval(response);
isInWorkflow=data.status
}if(!isInWorkflow){dialog.addHidden({payload:pagePath})
}else{CQ.Ext.Msg.alert(CQ.I18n.getMessage("Info"),CQ.I18n.getMessage("Page is already subject to a workflow!"));
return
}}dialog.on("beforesubmit",function(){admin.mask()
});
dialog.success=function(){admin.reloadPages()
};
dialog.failure=function(){admin.unmask();
CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not start workflow."))
};
dialog.show()
};
CQ.wcm.SiteAdmin.openLinkChecker=function(){CQ.Util.reload(window,CQ.HTTP.externalize("/etc/linkchecker.html"))
};
CQ.wcm.SiteAdmin.openLanguageCopy=function(){var a=this;
var b=new CQ.wcm.LanguageCopyDialog({path:this.getCurrentPath(),id:CQ.Util.createId("cq-languagecopydialog")});
b.on("beforesubmit",function(){a.mask()
});
b.success=function(){CQ.Ext.getCmp(a.id+"-tree").getSelectionModel().getSelectedNode().reload();
a.reloadPages()
};
b.failure=function(){a.unmask()
};
b.show()
};
CQ.wcm.SiteAdmin.openBlueprintEditor=function(){var a=this;
var b={xtype:"dialog",height:660,width:810,items:{xtype:"tabpanel",items:[{xtype:"blueprinteditor",masterPath:this.getCurrentPath(),path:"/etc/msm/msm1"}]},buttons:[{text:CQ.I18n.getMessage("OK"),handler:function(){}},CQ.Dialog.CANCEL]};
var c=CQ.WCM.getDialog(b);
c.success=function(){};
c.failure=function(){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not edit blueprint."))
};
c.show()
};
CQ.wcm.SiteAdmin.restoreVersion=function(){var a=this;
var b=CQ.WCM.getDialog("/libs/wcm/core/content/tools/restoreversiondialog","NEW");
b.setElId(CQ.Util.createId("cq-restoreversiondialog"));
b.loadContent(this.getCurrentPath(),true);
b.on("beforesubmit",function(){a.mask()
});
b.success=function(){CQ.Ext.getCmp(a.id+"-tree").getSelectionModel().getSelectedNode().reload();
a.reloadPages()
};
b.failure=function(){a.unmask()
};
b.show()
};
CQ.wcm.SiteAdmin.restoreTree=function(){var a=this;
var b=CQ.WCM.getDialog("/libs/wcm/core/content/tools/restoretreedialog");
b.setElId(CQ.Util.createId("cq-restoretreedialog"));
b.loadContent(this.getCurrentPath(),true);
b.on("beforesubmit",function(){a.mask()
});
b.success=function(){CQ.Ext.getCmp(a.id+"-tree").getSelectionModel().getSelectedNode().reload();
a.reloadPages()
};
b.failure=function(){a.unmask()
};
b.show()
};
CQ.wcm.SiteAdmin.createAssetShare=function(){var b=this.getCurrentPath();
var c=CQ.wcm.Page.getCreateAssetShareDialog(b);
var a=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
c.on("beforesubmit",function(){a.mask()
});
c.success=function(){a.reloadCurrentTreeNode()
};
c.failure=function(){a.unmask();
CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not create asset share."))
};
c.show()
};
CQ.wcm.SiteAdmin.internalCreateAssetShare=function(a,b,g,c){};
CQ.wcm.SiteAdmin.createFolder=function(j,c,n){var a=CQ.Ext.getCmp(this.id+"-tree");
var g;
try{g=a.getSelectionModel().getSelectedNode()
}catch(k){}if(!g){return
}if(!n){n="itemname"
}var m={"jcr:primaryType":"cq:Dialog",title:CQ.I18n.getMessage("Create Folder"),id:CQ.Util.createId("cq-createfolderdialog"),height:240,params:{_charset_:"utf-8"},items:{"jcr:primaryType":"cq:Panel",items:{"jcr:primaryType":"cq:WidgetCollection",label:{fieldLabel:CQ.I18n.getMessage("Name"),fieldDescription:CQ.I18n.getMessage('The name that will appear in the URL, e.g. "myfolder"'),name:"label",vtype:n},title:{fieldLabel:CQ.I18n.getMessage("Title"),fieldSubLabel:CQ.I18n.getMessage("Optional"),fieldDescription:CQ.I18n.getMessage('A separate title for the navigation, e.g. "My Folder"'),name:"title"}}},buttons:{"jcr:primaryType":"cq:WidgetCollection",custom:{text:CQ.I18n.getMessage("Create"),cls:"cq-btn-create",handler:function(){var t=this.getField("title").getValue();
var o=this.getField("label").getValue();
if(!o){o=t?t:CQ.I18n.getMessage("Folder").toLowerCase()
}if(!CQ.Ext.form.VTypes[n](o)){var q=this;
var r=CQ.Ext.form.VTypes[n+"Text"];
r+="<br/><br/>";
r+=CQ.I18n.getMessage("Click 'Yes' to have the name auto-corrected and continue, or 'No' to cancel and change the name.");
CQ.Ext.Msg.confirm(CQ.I18n.getMessage("Invalid Name"),r,function(u){if(u=="yes"){CQ.wcm.SiteAdmin.internalCreateFolder(g,o,t,n);
q.hide()
}else{q.getField("label").markInvalid(CQ.Ext.form.VTypes[n+"Text"])
}})
}else{CQ.wcm.SiteAdmin.internalCreateFolder(g,o,t,n);
this.hide()
}}},cancel:CQ.Dialog.CANCEL}};
var b=CQ.WCM.getDialog(m);
b.show()
};
CQ.wcm.SiteAdmin.internalCreateFolder=function(j,c,n,m){var a=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
a.mask();
if(m=="name"){c=CQ.Ext.form.VTypes.makeName(c)
}else{c=CQ.Ext.form.VTypes.makeItemname(c)
}var b=j.getPath();
var g=(/\/etc\/packages(\/.*)?/.test(b));
var k={"./jcr:primaryType":"sling:OrderedFolder","./jcr:content/jcr:primaryType":"nt:unstructured",":name":c,_charset_:"utf-8"};
if(n){k["./jcr:content/jcr:title"]=n
}if(g){k={_charset_:"utf-8",name:c,cmd:"createFolder"};
if(n){k.title=n
}}CQ.HTTP.post(CQ.shared.HTTP.encodePath(b+"/"),function(r,u,q){if(u){var o=j.getOwnerTree();
if(j!=o.getRootNode()){var t=j.getPath();
j.parentNode.reload(function(){o.selectPath(t,null,function(w,v){if(w){v.expand()
}})
})
}else{o.getRootNode().reload();
CQ.Ext.getCmp(window.CQ_SiteAdmin_id).reloadPages()
}}else{a.unmask()
}},k)
};
CQ.wcm.SiteAdmin.uploadFiles=function(){var o=CQ.Ext.getCmp(this.id+"-tree");
var m=this;
var c;
try{c=o.getSelectionModel().getSelectedNode()
}catch(g){}if(!c){return
}var n=c.getPath();
var j=n;
var a=40;
if(j.length>a){var b=n.indexOf("/",n.length-a);
j='<span qtip="'+CQ.shared.Util.htmlEncode(CQ.shared.XSS.getXSSValue(n))+'">...'+CQ.shared.XSS.getXSSValue(n.substring(b!=-1?b:n.lastIndexOf("/")))+"</span>"
}else{j=CQ.shared.XSS.getXSSValue(j)
}var k=CQ.WCM.getDialogConfig("/libs/wcm/core/content/tools/uploaddialog");
k.displayPath=j;
k.admin=m;
k.destinationPath=CQ.wcm.SiteAdmin.getPostUploadUrl(n);
CQ.WCM.getDialog(k).show()
};
CQ.wcm.SiteAdmin.createPackage=function(){var b=CQ.Ext.getCmp(this.id+"-tree");
var a=this;
var g;
try{g=b.getSelectionModel().getSelectedNode()
}catch(k){}if(!g){return
}var j=g.getPath();
var n=j.substring(14);
var m={"jcr:primaryType":"cq:Dialog",title:CQ.I18n.getMessage("New Package"),formUrl:CQ.HTTP.externalize("/etc/packages"),params:{cmd:"create"},items:{"jcr:primaryType":"cq:Panel",items:{"jcr:primaryType":"cq:WidgetCollection",name:{xtype:"textfield",fieldLabel:CQ.I18n.getMessage("Package Name"),name:"packageName",allowBlank:false},group:{xtype:"textfield",fieldLabel:CQ.I18n.getMessage("Group Name"),name:"groupName",value:n},version:{xtype:"textfield",fieldLabel:CQ.I18n.getMessage("Version"),name:"packageVersion"}}}};
var c=CQ.WCM.getDialog(m);
c.failure=function(r,o){var q=o.result.Message;
if(q.indexOf("javax.jcr.AccessDeniedException")>=0){q=CQ.I18n.getMessage("Unable to create package: Insufficient access rights.")
}else{q=CQ.I18n.getVarMessage(q)
}CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),q)
};
c.success=function(u,q){var t=q.result.Path;
var o=t.lastIndexOf("/");
var r=t.substring(0,o);
if(g.getPath()==r){a.reloadPages()
}g.reload(function(){b.selectPath(r,null,function(w,v){if(w){v.expand()
}})
})
};
c.show()
};
CQ.wcm.SiteAdmin.download=function(){try{var g=this.getSelectedPages();
var k=[];
for(var c=0;
c<g.length;
c++){if(g[c].get("type")!="dam:Asset"){continue
}k.push(CQ.HTTP.encodePath(g[c].id))
}var a=k.length>1?"AEM "+new Date().format("d-M-Y H.i")+" ("+k.length+" assets).zip":k[0].substring(k[0].lastIndexOf("/")+1)+".zip";
var b=CQ.HTTP.externalize(k[0]+".assetdownload.zip/"+a);
if(k.length>1){b=CQ.HTTP.addParameter(b,"path",k)
}b=CQ.HTTP.addParameter(b,"_charset_","utf-8");
window.open(b,"AssetDownloadWindow")
}catch(j){}};
CQ.wcm.SiteAdmin.doSearch=function(){try{var a=CQ.Ext.getCmp(window.CQ_SiteAdminSearch_id);
if(a){a.performSearch()
}}catch(b){}};
CQ.wcm.SiteAdmin.canDoFolderOp=function(){var a=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(a){var b=a.getType(this.path);
if(b&&(/.*\:.*[F|f]older/.test(b)||b=="nt:unstructured")){return true
}if(b=="cq/packaging/components/manager"){return true
}}return false
};
CQ.wcm.SiteAdmin.canUploadFile=function(){var a=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(a){var b=a.getType(this.path);
if(b&&(/.*\:.*[F|f]older/.test(b)||b=="nt:unstructured")){return true
}}return false
};
CQ.wcm.SiteAdmin.canCreatePackage=function(){return this.path.indexOf("/etc/packages")==0
};
CQ.wcm.SiteAdmin.canDeleteReplicatedPage=function(){var a=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(a){var g=a.getSelectedPages();
if(g.length>0){var b=CQ.User.getCurrentUser();
for(var c=0;
c<g.length;
c++){var j=g[c].id;
if(CQ.wcm.SiteAdmin.isReplicatedPage(g[c])&&!b.hasPermissionOn("replicate",j)){return false
}}return true
}}return false
};
CQ.wcm.SiteAdmin.isFolder=function(){var a=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(a){var b=a.getType(this.path);
if(b&&/.*\:.*[F|f]older/.test(b)){return true
}}return false
};
CQ.wcm.SiteAdmin.noFolder=function(){return !CQ.wcm.SiteAdmin.canDoFolderOp.call(this)
};
CQ.wcm.SiteAdmin.isPublishToS7Allowed=function(){var b=CQ.wcm.SiteAdmin.hasAnySelection();
var c=false;
var a=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(a){c=a.canPublishToScene7
}return b&&c
};
CQ.wcm.SiteAdmin.hasAnySelection=function(){return CQ.wcm.SiteAdmin.hasListSelection()||CQ.wcm.SiteAdmin.hasTreeSelection()
};
CQ.wcm.SiteAdmin.hasSingleSelection=function(){var a=CQ.wcm.SiteAdmin.getActiveGrid();
if(a){var b=a.getSelectionModel().getSelections();
return b.length==1||(b.length==0&&CQ.wcm.SiteAdmin.hasTreeSelection())
}return false
};
CQ.wcm.SiteAdmin.hasListSelection=function(){var a=CQ.wcm.SiteAdmin.getActiveGrid();
if(a){var b=a.getSelectionModel().getSelections();
return b.length>0
}return false
};
CQ.wcm.SiteAdmin.hasSingleListSelection=function(){var a=CQ.wcm.SiteAdmin.getActiveGrid();
if(a){var b=a.getSelectionModel().getSelections();
return b.length==1
}return false
};
CQ.wcm.SiteAdmin.hasTreeSelection=function(){var a=CQ.Ext.getCmp(window.CQ_SiteAdmin_id+"-tree");
if(a){var b=a.getSelectionModel().getSelectedNode();
return b!=null
}};
CQ.wcm.SiteAdmin.canPaste=function(){var a=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(a){return a.hasClipboardSelection()
}};
CQ.wcm.SiteAdmin.isAsset=function(){var a=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(a){var c=a.getSelectedPages();
for(var b=0;
b<c.length;
b++){try{if(c[b].get("type")=="dam:Asset"){return true
}}catch(g){}}return false
}};
CQ.wcm.SiteAdmin.deleteMetadataTemplate=function(){var a=new CQ.dam.DeleteMetadataTemplate();
a.show()
};
CQ.wcm.SiteAdmin.noAsset=function(){return !CQ.wcm.SiteAdmin.isAsset()
};
CQ.wcm.SiteAdmin.isPage=function(){var a=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(a){var c=a.getSelectedPages();
for(var b=0;
b<c.length;
b++){try{if(c[b].get("type")=="cq:Page"){return true
}}catch(g){}}return false
}};
CQ.wcm.SiteAdmin.isReplicatedPage=function(a){if(a){var b=a.get("replication");
if(b&&b.published){return b.action=="ACTIVATE"
}}return false
};
CQ.wcm.SiteAdmin.isLiveCopySource=function(){var a=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(a){var c=a.getSelectedPages();
for(var b=0;
b<c.length;
b++){try{if(c[b].get(CQ.wcm.msm.MSM.PARAM_IS_SOURCE)){return true
}}catch(g){}}return false
}};
CQ.wcm.SiteAdmin.getAnyTarget=function(){return CQ.wcm.SiteAdmin.getTargetFromList()||CQ.wcm.SiteAdmin.getTargetFromTree()
};
CQ.wcm.SiteAdmin.getSingleTarget=function(){if(CQ.wcm.SiteAdmin.hasListSelection()){if(!CQ.wcm.SiteAdmin.hasSingleListSelection()){return null
}else{return CQ.wcm.SiteAdmin.getTargetFromList()
}}else{return CQ.wcm.SiteAdmin.getTargetFromTree()
}};
CQ.wcm.SiteAdmin.getTargetFromList=function(){if(CQ.wcm.SiteAdmin.hasListSelection()){var a=CQ.wcm.SiteAdmin.getActiveGrid();
if(a){var b=a.getSelectionModel().getSelections();
return b[0].id
}}return null
};
CQ.wcm.SiteAdmin.getTargetFromTree=function(){if(CQ.wcm.SiteAdmin.hasTreeSelection()){var a=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(a){return a.getCurrentPath()
}}return null
};
CQ.wcm.SiteAdmin.getParentPath=function(a){return a.substring(0,a.lastIndexOf("/"))
};
CQ.wcm.SiteAdmin.getActiveGrid=function(){var a=CQ.Ext.getCmp(window.CQ_SiteAdmin_id+"-grid");
var c=CQ.Ext.getCmp(window.CQ_SiteAdmin_id+"-tabpanel");
if(c){var b=CQ.Ext.getCmp(c.getActiveTab().id+"-grid");
if(b){a=b
}}return a
};
CQ.wcm.SiteAdmin.checkFolder=function(b){var a=CQ.HTTP.get(b).status;
if(a=="404"){var c=CQ.wcm.SiteAdmin.getParentPath(b);
CQ.wcm.SiteAdmin.checkFolder(c);
var g={"./jcr:primaryType":"nt:folder"};
CQ.HTTP.post(b,undefined,g)
}};
CQ.wcm.SiteAdmin.scheduleForActivation=function(){var a=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
var c={"jcr:primaryType":"cq:Dialog",height:240,title:CQ.I18n.getMessage("Activate Later"),id:CQ.Util.createId("cq-activate-later-dialog"),params:{_charset_:"utf-8"},items:{"jcr:primaryType":"cq:Panel",items:{"jcr:primaryType":"cq:WidgetCollection",absTime:{xtype:"datetime",fieldLabel:CQ.I18n.getMessage("Activation Date"),name:"absTime",defaultValue:"now"}}},buttons:{"jcr:primaryType":"cq:WidgetCollection",custom:{text:CQ.I18n.getMessage("OK"),cls:"cq-btn-create",handler:function(){a.mask();
var o=this;
if(CQ.Ext.isIE){this.getField("absTime").onBlur()
}var m=this.getField("absTime").getValue();
var j=a.getSelectedPages();
var n=[];
for(var g=0;
g<j.length;
g++){n.push(j[g].id)
}if(CQ.wcm.SiteAdmin.noAsset()){var k={id:CQ.Util.createId("cq-asset-reference-search-dialog"),path:n,callback:function(q){CQ.wcm.SiteAdmin.internalScheduleForActivation.call(a,m,q);
o.hide()
}};
new CQ.wcm.AssetReferenceSearchDialog(k)
}else{CQ.wcm.SiteAdmin.internalScheduleForActivation.call(a,m,n);
this.hide()
}}},cancel:CQ.Dialog.CANCEL}};
var b=CQ.WCM.getDialog(c);
b.show()
};
CQ.wcm.SiteAdmin.internalScheduleForActivation=function(b,g){var a=this;
var c={_charset_:"UTF-8",model:"/etc/workflow/models/scheduled_activation/jcr:content/model",absoluteTime:b?b.getTime():new Date().getTime(),payload:g,payloadType:"JCR_PATH"};
CQ.HTTP.post("/etc/workflow/instances",function(k,m,j){if(!m){a.unmask();
CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not schedule page for activation."))
}else{a.reloadPages()
}},c)
};
CQ.wcm.SiteAdmin.scheduleForDeactivation=function(){var a=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
var c={"jcr:primaryType":"cq:Dialog",height:240,title:CQ.I18n.getMessage("Deactivate Later"),id:CQ.Util.createId("cq-deactivate-later-dialog"),params:{_charset_:"utf-8"},items:{"jcr:primaryType":"cq:Panel",items:{"jcr:primaryType":"cq:WidgetCollection",absTime:{xtype:"datetime",fieldLabel:CQ.I18n.getMessage("Deactivation Date"),name:"absTime",defaultValue:"now"}}},buttons:{"jcr:primaryType":"cq:WidgetCollection",custom:{text:CQ.I18n.getMessage("OK"),cls:"cq-btn-create",handler:function(){a.mask();
if(CQ.Ext.isIE){this.getField("absTime").onBlur()
}var k=this.getField("absTime").getValue();
var j=a.getSelectedPages();
var n=[];
for(var g=0;
g<j.length;
g++){n.push(j[g].id)
}var m={_charset_:"UTF-8",model:"/etc/workflow/models/scheduled_deactivation/jcr:content/model",absoluteTime:k.getTime(),payload:n,payloadType:"JCR_PATH"};
CQ.HTTP.post("/etc/workflow/instances",function(q,r,o){if(!r){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not schedule page for deactivation."))
}else{a.reloadPages()
}},m);
this.hide()
}},cancel:CQ.Dialog.CANCEL}};
var b=CQ.WCM.getDialog(c);
b.show()
};
CQ.wcm.SiteAdmin.notLocked=function(){var a=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(a){var k=a.getSelectedPages();
for(var g=0;
g<k.length;
g++){try{var j=k[g];
if(typeof(j.data)!=="undefined"&&j.data!=null){var c=j.data.lockedBy;
var b=CQ.User.getUserID();
if(c.length>0&&c!=b){return false
}}}catch(m){}}return true
}};
CQ.wcm.SiteAdmin.lockable=function(){var a=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(a){var j=a.getSelectedPages();
for(var c=0;
c<j.length;
c++){try{var g=j[c];
if(typeof(g.data)!=="undefined"&&g.data!=null){var b=g.data.lockedBy;
if(b.length==0){return true
}}}catch(k){}}}return false
};
CQ.wcm.SiteAdmin.unlockable=function(){var a=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(a){var k=a.getSelectedPages();
var c=CQ.User.getUserID();
for(var g=0;
g<k.length;
g++){try{var j=k[g];
if(typeof(j.data)!=="undefined"&&j.data!=null){var b=j.data.lockedBy;
if(b.length>0&&b==c){return true
}}}catch(m){}}}return false
};
CQ.wcm.DamAdmin={};
CQ.wcm.DamAdmin.openPages=function(){var c=this.getSelectedPages();
var a=CQ.HTTP.externalize("/bin/wcmcommand")+"?cmd=open";
a+="&_charset_=utf-8";
for(var b=0;
b<c.length;
b++){a=CQ.HTTP.addParameter(a,"path",c[b].id)
}CQ.shared.Util.open(a,null,"AssetEditorWindow")
};
CQ.wcm.DamAdmin.openAsset=function(path,record){var tabPanel=CQ.Ext.getCmp(window.CQ_SiteAdmin_id+"-tabpanel");
if(tabPanel){tabPanel.on("beforeremove",function(){if(this.activeTab.editorClose()==false){CQ.Ext.Msg.show({title:CQ.I18n.getMessage("Unsaved Changes"),msg:CQ.I18n.getMessage("You have unsaved changes. Do you still want to close the tab?"),buttons:CQ.Ext.Msg.YESNO,icon:CQ.Ext.MessageBox.QUESTION,fn:function(btnId){if(btnId=="yes"){this.activeTab.destroy()
}else{if(btnId=="no"){}}},scope:this});
return false
}});
var id=CQ.DOM.encodeId(path);
var editor=CQ.Ext.getCmp(id);
var locked=false;
if(record){var locker=record.data.lockedBy;
var currentUserID=CQ.User.getUserID();
if(locker.length>0&&locker!=currentUserID){locked=true
}}if(!editor){var title=record?record.get("title"):"";
var mime=record?record.get("mime")||record.get("mimeType"):"";
var suffix="";
if(mime){for(var i=0;
i<mime.length;
i++){var c=mime.charCodeAt(i);
if(c>=97&&c<=122||c>=65&&c<=90||c>=48&&c<=57){suffix+=mime.charAt(i)
}else{suffix+="/"
}}}if(suffix!=""){suffix="/"+suffix+".json"
}var json=CQ.HTTP.eval("/libs/dam/content/asseteditors/asseteditor.overlay.infinity.json"+suffix);
if(!json.formItems){json.formItems=CQ.HTTP.eval("/libs/dam/content/asseteditors/formitems.overlay.infinity.json"+suffix)
}var config=CQ.Util.formatData(json);
config=CQ.utils.Util.applyDefaults(config,{xtype:"asseteditor",contentPath:"/jcr:content/metadata",assetInfo:{width:record?record.get("width"):0,height:record?record.get("height"):0,size:record?record.get("size"):0,lastModified:record?record.get("lastModified"):0,title:title?title:"",mime:mime?mime:""},readOnly:locked});
var scene7ConfigJson=CQ.HTTP.eval(path+".s7config.json");
if(scene7ConfigJson&&scene7ConfigJson.scene7ConfigPath){config.scene7ConfigPath=scene7ConfigJson.scene7ConfigPath;
config.scene7=true
}else{config.scene7=false
}config.id=id;
config.path=path;
config.title=undefined;
editor=CQ.Util.build(config,true);
tabPanel.add(editor)
}tabPanel.setActiveTab(editor);
if(locked){var msg=CQ.I18n.getMessage("Locked");
var description=CQ.I18n.getMessage("This asset is currently locked by {0}",[locker]);
CQ.Notification.notify(msg,description,10)
}}};
CQ.wcm.DamAdmin.internalDeleteAsset=function(b){var c=this.getSelectedPages();
var u=CQ.Ext.getCmp(this.id+"-tree");
var n=CQ.Ext.getCmp(this.id+"-grid");
var t=[];
var a=[];
for(var m=0;
m<c.length;
m++){var o=c[m];
t.push(o.id);
var r=o.id.split("/");
if(u){var g=u.getRootNode();
var q=g.getPath().split("/");
for(var k=q.length;
k<r.length;
k++){g=g.findChild("name",r[k])
}if(g){a.push(g)
}}}CQ.Ext.Ajax.request({url:CQ.HTTP.externalize("/bin/wcmcommand"),method:"POST",callback:function(D,B,C){var v=CQ.HTTP.buildPostResponseFromHTML(C.responseText);
var w=v.headers[CQ.utils.HTTP.HEADER_STATUS];
if(w==200){for(var x=0;
x<c.length;
x++){var j=CQ.DOM.encodeId(c[x].id);
var y=CQ.Ext.getCmp(j);
if(y){var A=CQ.Ext.getCmp(window.CQ_SiteAdmin_id+"-tabpanel");
A.remove(y)
}n.getStore().remove(c[x])
}if(u){for(var x=0;
x<a.length;
x++){try{a[x].remove()
}catch(z){}}}}else{if(w==412){CQ.Ext.Msg.show({title:CQ.I18n.getMessage("Delete Asset"),msg:CQ.I18n.getMessage("One or more selected assets are referenced. Click 'yes' to proceed deleting the assets, click 'no' to review the references or 'cancel' to cancel the operation."),buttons:CQ.Ext.Msg.YESNOCANCEL,icon:CQ.Ext.MessageBox.QUESTION,fn:function(E){if(E=="yes"){CQ.wcm.DamAdmin.internalDeleteAsset.call(this,true)
}else{if(E=="no"){CQ.wcm.SiteAdmin.showReferences.call(this)
}}},scope:this})
}else{if(w==500){this.unmask();
CQ.Notification.notifyFromResponse(v)
}else{this.unmask()
}}}},params:{path:t,_charset_:"utf-8",cmd:"deletePage",force:b},scope:this})
};
CQ.wcm.DamAdmin.deactivateAsset=function(){var b=this.getSelectedPages();
var g=CQ.I18n.getMessage("You are going to deactivate the following assets: ")+"<br/>";
for(var a=0;
a<b.length;
a++){g+=CQ.shared.XSS.getXSSValue(b[a].id)+"<br/>"
}g+="<br/>"+CQ.I18n.getMessage("Are you sure?");
var c=(b.length>1)?CQ.I18n.getMessage("Deactivate Assets"):CQ.I18n.getMessage("Deactivate Asset");
CQ.Ext.Msg.show({title:c,msg:g,buttons:CQ.Ext.Msg.YESNO,icon:CQ.Ext.MessageBox.QUESTION,fn:function(j){if(j=="yes"){CQ.wcm.SiteAdmin.internalDeactivatePage.call(this,false)
}},scope:this})
};
CQ.wcm.DamAdmin.deleteAsset=function(){var g=this.getSelectedPages();
var k;
if(g.length==1&&g[0].get("type")!="dam:Asset"){k=CQ.I18n.getMessage("You are going to delete the following folder including all assets inside:")
}else{k=(g.length>1)?CQ.I18n.getMessage("You are going to delete the following assets:"):CQ.I18n.getMessage("You are going to delete the following asset:")
}k+="<br/><br/>";
var a=7;
for(var b=0;
b<g.length;
b++){if(b==a){k+=CQ.I18n.getMessage("(and {0} more...)",[g.length-b],"assets to delete")+"<br/>";
break
}var c=g[b].get("_displayTitle_")&&g[b].get("title")?g[b].get("title"):g[b].get("label");
if(c==undefined){c=g[b].id.substring(g[b].id.lastIndexOf("/")+1)
}k+=c+"<br/>"
}k+="<br/>"+CQ.I18n.getMessage("Are you sure?");
var j=(g.length>1)?CQ.I18n.getMessage("Delete Assets"):CQ.I18n.getMessage("Delete Asset");
CQ.Ext.Msg.show({title:j,msg:k,buttons:CQ.Ext.Msg.YESNO,icon:CQ.Ext.MessageBox.QUESTION,fn:function(m){if(m=="yes"){CQ.wcm.DamAdmin.internalDeleteAsset.call(this,false)
}},scope:this})
};
CQ.wcm.DamAdmin.createFolder=function(b,a){CQ.wcm.SiteAdmin.createFolder.call(this,b,a,"name")
};
CQ.wcm.DamAdmin.createMetadataTemplate=function(g,c){var a=this;
var b=this.getCurrentPath();
var j=new CQ.dam.CreateMetadataTemplateWizard({});
j.on("beforesubmit",function(){a.mask()
});
j.success=function(){a.reloadCurrentTreeNode();
window.setTimeout(function(){j.destroy()
},1000);
CQ.Ext.Msg.show({title:CQ.I18n.getMessage("Changes Saved"),msg:CQ.I18n.getMessage("Metadata template created successfully "),buttons:CQ.Ext.Msg.OK})
};
j.failure=function(m,k){a.unmask();
window.setTimeout(function(){j.destroy()
},1000);
console.log([k]);
CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not create template"))
};
j.loadContent({dstPath:this.getCurrentPath()});
j.show()
};
CQ.wcm.DamAdmin.applyMetadataTemplate=function(g,c){var a=this;
var b=this.getCurrentPath();
var j=CQ.I18n.getMessage("Metadata template already applied to this folder:");
j+="<br/><br/>";
j+=CQ.I18n.getMessage("Click 'Yes' to replace the applied Metadata Template or 'No' to cancel the operation.");
if(CQ.wcm.DamAdmin.isMetadataTemplateApplied()){CQ.Ext.Msg.confirm(CQ.I18n.getMessage("Warning"),j,function(k){if(k=="yes"){CQ.wcm.DamAdmin.internalApplyMetadataTemplate(a,b,true)
}});
return false
}else{CQ.wcm.DamAdmin.internalApplyMetadataTemplate(a,b,false)
}};
CQ.wcm.DamAdmin.internalApplyMetadataTemplate=function(a,b,g){var c=(a.getSelectedPages())[0];
var j=new CQ.dam.ApplyMetadataTemplateWizard(c.id);
j.on("beforesubmit",function(){a.mask();
if(g){CQ.HTTP.post(c.id+"/jcr:content/"+CQ.shared.HTTP.encodePath("metadata"),null,{":operation":"delete"})
}});
j.on("submit",function(){console.log(this)
});
j.success=function(){a.reloadCurrentTreeNode();
window.setTimeout(function(){j.hide()
},1000);
CQ.Ext.Msg.show({title:CQ.I18n.getMessage("Changes Saved"),msg:CQ.I18n.get("Metadata template applied successfully to the folder {0}",c.id),icon:CQ.Ext.Msg.INFO,buttons:CQ.Ext.Msg.OK})
};
j.failure=function(m,k){a.unmask();
console.log([k]);
CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not apply template: {0}",[k.result["Message"]]))
};
j.show()
};
CQ.wcm.DamAdmin.editMetadataTemplate=function(action,event){var admin=this;
var parentPath=this.getCurrentPath();
var selection=(admin.getSelectedPages())[0];
var json=selection.json;
var parentTplPath=json["cq:ingestionTemplateName"];
var formItems=CQ.HTTP.eval(parentTplPath+"/jcr:content/items.infinity.json");
var metadataItems=CQ.HTTP.eval(selection.json.path+"/jcr:content/metadata.infinity.json");
var items=[];
var url=selection.json.path;
for(var v in formItems){if(typeof(formItems[v])==="object"){items.push(formItems[v])
}}for(var v in items){if(typeof(items[v]["name"])==="string"&&items[v]["name"]!=""){var n=items[v]["name"];
n=n.split("/")[1];
if(metadataItems[n]){items[v]["value"]=metadataItems[n]
}}}var editDialog={"jcr:primaryType":"cq:Dialog",id:CQ.Util.createId("cq-createdialog"),title:CQ.I18n.getMessage("Edit Metadata Template"),formUrl:CQ.shared.HTTP.externalize(selection.id+"/jcr:content/metadata"),autoScroll:true,params:{_charset_:"utf-8"},height:520,items:{"jcr:primaryType":"cq:Panel",items:[{fieldLabel:CQ.I18n.getMessage("(Instance Name)"),fieldDescription:CQ.I18n.getMessage("Name of the Metadata Template instance"),name:"./cq:ingestionTemplateInstanceName",allowBlank:false,value:json["cq:ingestionTemplateInstanceName"]},{fieldLabel:CQ.I18n.getMessage("(Based on)"),fieldDescription:CQ.I18n.getMessage("Parent Metadata Template of this instance"),readOnly:true,name:"./cq:ingestionTemplateName",value:json["cq:ingestionTemplateName"]},items]},okText:CQ.I18n.getMessage("Save")};
var dialog=CQ.WCM.getDialog(editDialog);
dialog.on("beforesubmit",function(){admin.mask()
});
dialog.success=function(){admin.reloadCurrentTreeNode();
CQ.Ext.Msg.show({title:CQ.I18n.getMessage("Changes Saved"),msg:CQ.I18n.getMessage("Metadata template on the folder {0}  edited successfully",selection.id),icon:CQ.Ext.Msg.INFO,buttons:CQ.Ext.Msg.OK})
};
dialog.failure=function(form,response){admin.unmask();
console.log([response]);
CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not edit template: {0}",[response.result["Message"]]))
};
dialog.addHidden({parentPath:parentPath});
dialog.show()
};
CQ.wcm.DamAdmin.removeMetadataTemplate=function(){var a=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(a){var g=a.getSelectedPages();
for(var b=0;
b<g.length;
b++){try{var c=g[b];
if(c.json["cq:ingestionTemplateInstanceName"]){CQ.Ext.Msg.confirm(CQ.I18n.getMessage("Warning"),CQ.I18n.getMessage("Are you sure you wish to remove Applied Metadata Template"),function(k){if(k=="yes"){CQ.HTTP.post(c.id+"/jcr:content/metadata",null,{":operation":"delete"});
a.reloadCurrentTreeNode();
return true
}return false
})
}}catch(j){}}}return false
};
CQ.wcm.DamAdmin.isMetadataTemplateApplied=function(){var a=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
if(a){var g=a.getSelectedPages();
for(var b=0;
b<g.length;
b++){try{var c=g[b];
if(c.json["cq:ingestionTemplateInstanceName"]){return true
}}catch(j){}}}return false
};
CQ.wcm.PredicateBase=function(){return{idCounter:0,createGroupId:function(){return this.createId("group")
},createId:function(a){if(!a){a="predicate"
}return this.idCounter+++"_"+a
}}
}();
CQ.wcm.DatePredicate=CQ.Ext.extend(CQ.form.CompositeField,{propertyName:"jcr:content/jcr:lastModified",predicateName:"daterange",constructor:function(a){a=a||{};
var b={border:false,fieldLabel:CQ.I18n.getMessage("Modified after/<br/>before")};
a=CQ.Util.applyDefaults(a,b);
CQ.wcm.DatePredicate.superclass.constructor.call(this,a)
},initComponent:function(){CQ.wcm.DatePredicate.superclass.initComponent.call(this);
var a=CQ.wcm.PredicateBase.createId(this.predicateName);
this.add({xtype:"hidden",name:a+".property",value:this.propertyName});
this.add({xtype:"datetime",name:a+".lowerBound",hideTime:false,disableTypeHint:true,hideLabel:true,anchor:"100%"});
this.add({xtype:"datetime",name:a+".upperBound",hideTime:false,disableTypeHint:true,hideLabel:true,anchor:"100%"})
}});
CQ.Ext.reg("datepredicate",CQ.wcm.DatePredicate);
CQ.wcm.FulltextPredicate=CQ.Ext.extend(CQ.form.CompositeField,{predicateName:null,searchCallback:null,constructor:function(a){a=a||{};
var b={border:false,predicateName:"fulltext",fieldLabel:CQ.I18n.getMessage("Fulltext"),searchCallback:CQ.wcm.SiteAdmin.doSearch};
a=CQ.Util.applyDefaults(a,b);
CQ.wcm.FulltextPredicate.superclass.constructor.call(this,a)
},initComponent:function(){CQ.wcm.FulltextPredicate.superclass.initComponent.call(this);
var a=this;
this.add(new CQ.Ext.form.TextField({name:"fulltext",hideLabel:true,anchor:"100%",enableKeyEvents:true,listeners:{keyup:function(b,c){if(c.keyCode==c.ENTER){a.searchCallback.call(this)
}}}}))
}});
CQ.Ext.reg("fulltextpredicate",CQ.wcm.FulltextPredicate);
CQ.wcm.TagPredicate=CQ.Ext.extend(CQ.form.CompositeField,{propertyName:null,suggestUrl:null,suggestMinTermLength:3,searchCallback:null,constructor:function(a){a=a||{};
var b={border:false,predicateName:"tagid",propertyName:"jcr:content/metadata/cq:tags",suggestUrl:"/bin/wcm/contentfinder/suggestions.json/content/dam",fieldLabel:CQ.I18n.getMessage("Tag"),searchCallback:CQ.wcm.SiteAdmin.doSearch};
a=CQ.Util.applyDefaults(a,b);
CQ.wcm.TagPredicate.superclass.constructor.call(this,a)
},initComponent:function(){CQ.wcm.TagPredicate.superclass.initComponent.call(this);
var g=this;
var a=new CQ.Ext.form.Hidden({name:"tagid.property",value:this.propertyName});
this.add(a);
var c=new CQ.Ext.form.Hidden({name:"tagid"});
this.add(c);
var b={name:"query",url:this.suggestUrl,minTermLength:this.suggestMinTermLength,hideLabel:true,anchor:"100%",enableKeyEvents:true,listeners:{select:function(n,k,m){this.setParamValue(this,c)
},keyup:function(k,m){this.setParamValue(this,c);
if(m.keyCode==m.ENTER){g.searchCallback.call(this)
}}},setParamValue:function(n,m){var k=n.getValue();
if(k.indexOf("tag:")==0){k=k.substr("tag:".length)
}m.setValue(k)
},beforeSelectListener:function(q,k,m){var o=k.get("pre");
var n=k.get("value");
this.setRawValue(o+n+k.get("post"));
var r=o.length+n.length;
if(this.getRawValue().charAt(r)=='"'){r--
}this.setCaretPosition(r);
this.collapse();
return true
}};
var j=new CQ.form.SuggestField(b);
this.add(j)
}});
CQ.Ext.reg("tagpredicate",CQ.wcm.TagPredicate);
CQ.wcm.OptionsPredicate=CQ.Ext.extend(CQ.Ext.Panel,{propertyName:null,predicateName:null,collapse:null,triggerSearch:null,searchCallback:null,searchTimeoutTime:null,optionsPaths:null,counter:0,groupId:null,controls:{},constructor:function(a){a=a||{};
var b={header:false,border:false,cls:"cq-optionspredicate",propertyName:"jcr:content/metadata/cq:tags",predicateName:"property",collapse:"level1",triggerSearch:false,searchTimeoutTime:800,searchCallback:CQ.wcm.SiteAdmin.doSearch,optionsPaths:["/etc/tags/marketing/interest"]};
a=CQ.Util.applyDefaults(a,b);
CQ.wcm.OptionsPredicate.superclass.constructor.call(this,a)
},initComponent:function(){CQ.wcm.OptionsPredicate.superclass.initComponent.call(this);
this.groupId=CQ.wcm.PredicateBase.createGroupId();
this.options=this.getOptions();
if(this.title){this.options={"jcr:title":CQ.I18n.getVar(this.title),subs:this.options}
}this.traverseOption(this.options,this,0,"");
this.add(new CQ.Ext.form.Hidden({name:this.groupId+"."+this.predicateName,value:this.propertyName}));
this.add(new CQ.Ext.form.Hidden({name:this.groupId+".p.or",value:"true"}));
switch(this.collapse){case"none":break;
case"level0":this.toggle(this.items.get(0));
break;
default:var g=this.items.get(0);
if(g.subPanel){var b=g.subPanel.items.getCount();
for(var a=0;
a<b;
a++){this.toggle(g.subPanel.items.get(a))
}}}this.doLayout()
},getOptions:function(){var options={};
for(var i=0;
i<this.optionsPaths.length;
i++){var tagId="";
var path=this.optionsPaths[i];
if(path.lastIndexOf(".json")!=path.length-".json".length){if(path.indexOf("/etc/tags")==0){tagId=path.replace("/etc/tags","");
if(tagId===""){tagId=":"
}else{tagId=tagId.replace("/","");
if(tagId.indexOf("/")!=-1){tagId=tagId.replace("/",":")
}}}path+=".infinity.json"
}var resp=CQ.HTTP.eval(path);
if(!resp){continue
}options["o"+i]=resp;
options["o"+i].tagId=tagId
}if(!this.predicateName){this.predicateName="property"
}return options
},isLeaf:function(a){for(property in a){if(CQ.Ext.type(a[property])=="object"){return false
}}return true
},uncheckParents:function(a){while(a){a=a.findParentBy(function(b){if(b.titleCheckbox){return true
}});
if(a){a.titleCheckbox.setValue(false,true)
}}return true
},toggle:function(a){if(!a.subPanel){return
}if(a.subPanel.hidden){a.toggle.removeClass("expand");
a.toggle.addClass("collapse");
a.subPanel.show();
for(var b=0;
b<a.subPanel.items.getCount();
b++){a.subPanel.items.get(b).show()
}}else{a.toggle.removeClass("collapse");
a.toggle.addClass("expand");
a.subPanel.hide()
}var c=this.findParentByType("panel");
if(c){c.doLayout()
}},search:function(){if(this.triggerSearch){window.clearTimeout(this.searchTimeoutId);
this.searchTimeoutId=window.setTimeout(this.searchCallback,this.searchTimeoutTime)
}},traverseOption:function(n,u,c,k){if(n.tagId){k=n.tagId
}if(!this.isLeaf(n)){var b;
if(n["jcr:title"]){var g="";
var t="";
if(k&&(k!=":"||k.indexOf(":")==-1)){this.counter++;
g=this.groupId+"."+this.predicateName+"."+this.counter+"_value";
t=k
}var q=new CQ.Ext.form.Checkbox({boxLabel:CQ.I18n.getVar(n["jcr:title"]),inputValue:t,name:g});
var m=new CQ.Ext.Button({cls:"collapse"});
b=new CQ.Ext.Panel({cls:"leftpadding level"+c,border:false,toolTarget:"toolbar",tbar:[q,"->",m]});
var o=this;
q.on("check",function(w,v){if(!v){o.uncheckParents(w)
}o.search();
b.cascade(function(x){if(x instanceof CQ.Ext.form.Checkbox){x.setValue(v,true)
}else{if(x.titleCheckbox){x.titleCheckbox.setValue(v,true)
}}return true
})
});
m.on("click",function(){o.toggle(b)
});
b.toggle=m;
b.titleCheckbox=q;
b.subPanel=new CQ.Ext.Panel({border:false,cls:"subpanel",hideMode:"offsets"});
b.add(b.subPanel);
u.add(b);
c++
}for(var a in n){if(CQ.Ext.type(n[a])=="object"){var j="";
if(k){if(k==":"){j=a+":"
}else{if(k.indexOf(":")==-1){j=k+":"+a
}else{j=k+"/"+a
}}}this.traverseOption(n[a],b?b.subPanel:u,c,j)
}}}else{this.counter++;
var t=n.value?n.value:"";
if(!t&&k){t=k
}var r=n["jcr:title"]?n["jcr:title"]:t;
var q=new CQ.Ext.form.Checkbox({boxLabel:r,style:"margin-left: 10px",name:this.groupId+"."+this.predicateName+"."+this.counter+"_value",inputValue:t});
this.controls[n.value]=q;
var o=this;
q.on("check",function(w,v){if(!v){o.uncheckParents(w)
}o.search()
});
u.add(q)
}}});
CQ.Ext.reg("optionspredicate",CQ.wcm.OptionsPredicate);
CQ.wcm.PathPredicate=CQ.Ext.extend(CQ.form.CompositeField,{predicateName:null,rootPath:null,pathFieldPredicateName:null,showFlatOption:true,constructor:function(a){a=a||{};
var b={border:false,predicateName:"path",fieldLabel:CQ.I18n.getMessage("Path"),rootPath:"/content/dam",pathFieldPredicateName:"folder"};
a=CQ.Util.applyDefaults(a,b);
CQ.wcm.PathPredicate.superclass.constructor.call(this,a)
},initComponent:function(){CQ.wcm.PathPredicate.superclass.initComponent.call(this);
this.add(new CQ.form.PathField({rootPath:this.rootPath,name:this.predicateName,predicate:this.pathFieldPredicateName,triggerClass:"",hideLabel:true,anchor:"100%"}));
if(this.showFlatOption){this.add(new CQ.form.Selection({name:this.predicateName+".flat",boxLabel:CQ.I18n.getMessage("Do not search in sub folders"),type:"checkbox",inputValue:true,hideLabel:true,anchor:"100%"}))
}}});
CQ.Ext.reg("pathpredicate",CQ.wcm.PathPredicate);
CQ.wcm.PropertyPredicate=CQ.Ext.extend(CQ.form.CompositeField,{predicateName:null,propertyName:null,propertyOperation:null,defaultValue:"",constructor:function(a){a=a||{};
var b={border:false,predicateName:"property",propertyName:"jcr:title",defaultValue:"",fieldLabel:CQ.I18n.getMessage("Title")};
a=CQ.Util.applyDefaults(a,b);
CQ.wcm.PropertyPredicate.superclass.constructor.call(this,a)
},initComponent:function(){CQ.wcm.PropertyPredicate.superclass.initComponent.call(this);
var a=CQ.wcm.PredicateBase.createId(this.predicateName);
this.add(new CQ.Ext.form.Hidden({name:a,value:this.propertyName}));
if(this.propertyOperation){this.add(new CQ.Ext.form.Hidden({name:a+".operation",value:this.propertyOperation}))
}this.add(new CQ.Ext.form.TextField({fieldLabel:this.predicateFieldLabel,name:a+".value",value:this.defaultValue,hideLabel:true,anchor:"100%"}))
}});
CQ.Ext.reg("propertypredicate",CQ.wcm.PropertyPredicate);
CQ.wcm.SiteAdminGrid=CQ.Ext.extend(CQ.Ext.grid.EditorGridPanel,{constructor:function(b){var a=b.admin;
b=CQ.Util.applyDefaults(b,{cls:"cq-siteadmin-grid",stateful:true,margins:"5 5 5 0",stripeRows:true,cm:new CQ.Ext.grid.ColumnModel([]),sm:new CQ.Ext.grid.RowSelectionModel({singleSelect:false}),clicksToEdit:1,viewConfig:new CQ.Ext.grid.GridView({forceFit:true}),store:new CQ.Ext.data.Store({}),listeners:{rowcontextmenu:function(g,c,k){if(k.altKey){return
}var j=k.getXY();
k.stopEvent();
var m=g.getSelectionModel();
if(!m.hasSelection()){m.selectRow(c)
}else{if(!m.isSelected(c)){m.selectRow(c)
}}if(!g.contextMenu&&(b.contextActions.length>0)){g.contextMenu=new CQ.Ext.menu.Menu({items:b.contextActions,listeners:{beforeshow:function(){a.checkActions.call(a);
if(!this.hasDefaultAction){this.items.find(function(n){if(n.isDefaultAction===true){n.addClass("x-menu-item-default");
this.hasDefaultAction=true;
return true
}else{return false
}})
}},click:function(){this.hide()
}}})
}g.contextMenu.showAt(j)
},rowdblclick:function(g,j,c){CQ.wcm.SiteAdmin.openPages.call(a,c.shiftKey)
},cellclick:function(c,m,j,o){var n=c.getColumnModel();
var q=n.getDataIndex(j);
if(CQ.wcm.SiteAdmin.COLUMNS.impressions.dataIndex===q){var g=c.getStore().getAt(m);
var r=g.id;
var k=CQ.WCM.getDialog({"jcr:primaryType":"cq:Panel",xtype:"statistics",cls:"cq-propsdialog-impressions",header:false,bodyStyle:{padding:"15px 15px"},width:350,height:300,screen:{autoEl:{src:CQ.HTTP.getContextPath()+"/libs/cq/ui/resources/0.gif"}}},"impressions");
k.loadContent(r+"/jcr:content");
k.setTitle(CQ.I18n.getMessage("Page impressions of ")+r);
k.show()
}},beforeedit:function(c){if(c.row!=a.lastClickedRow){window.setTimeout(function(){a.lastClickedRow=c.row
},600);
return false
}if(CQ.wcm.SiteAdmin.GRID_LISTENERS.beforeedit[c.field]!=undefined){return CQ.wcm.SiteAdmin.GRID_LISTENERS.beforeedit[c.field].call(this,c)
}return true
},afteredit:function(c){if(CQ.wcm.SiteAdmin.GRID_LISTENERS.afteredit[c.field]!=undefined){CQ.wcm.SiteAdmin.GRID_LISTENERS.afteredit[c.field].call(this,c)
}},validateedit:function(c){if(CQ.wcm.SiteAdmin.GRID_LISTENERS.validateedit[c.field]!=undefined){CQ.wcm.SiteAdmin.GRID_LISTENERS.validateedit[c.field].call(this,c)
}},beforestaterestore:function(c,g){return c.id!=c.stateId
},staterestore:function(c,g){c.getView().refresh(true)
}}});
CQ.wcm.SiteAdminGrid.superclass.constructor.call(this,b)
},observe:function(){if(this.editing){return
}if(this.inProgress&&this.inProgress.length){this.getStore().proxy.load(this.getStore().baseParams,this.getStore().reader,function(g,a,o){if(o){var n=a.getStore();
for(var j=0;
j<g.records.length;
j++){var b=g.records[j];
var k=a.inProgress.indexOf(b.id);
if(k<0){continue
}if(b.data.inProgress>0){continue
}var c=n.getById(b.id);
if(c){var m=a.getView().getScrollState();
c.beginEdit();
c.id=b.id;
c.modified=b.data;
CQ.Ext.apply(c.data,c.modified);
c.endEdit();
c.commit();
a.getView().restoreScroll(m);
if(b.data.inProgress<=0&&b.data.lastModified!=0){a.inProgress.splice(k,1)
}}else{}}}},this,this)
}}});
CQ.Ext.reg("siteadmingrid",CQ.wcm.SiteAdminGrid);
CQ.wcm.SiteAdminSearchPanel=CQ.Ext.extend(CQ.Ext.Panel,{pageSize:15,facetURL:"/libs/dam/content/search/searchpanel/facets.overlay.infinity.json",store:null,constructor:function(config){var panel=this;
var id=config.id||"cq-siteadminsearchpanel";
this.actions=[];
this.checkedActions=[];
var gridContextActions=[];
this.actions.push({id:this.id+"-grid-refresh",iconCls:"cq-siteadmin-refresh",handler:this.reloadPages,scope:this,tooltip:{title:CQ.I18n.getMessage("Refresh Result List"),text:CQ.I18n.getMessage("Refreshs the list of results"),autoHide:true}});
this.actions.push("-");
this.actions=this.actions.concat(this.formatActions(config.actions,gridContextActions));
this.actions.push("->");
this.colModelColumns=new Array();
var defaultColumns=[CQ.wcm.SiteAdminSearchPanel.COLUMNS.numberer,CQ.wcm.SiteAdminSearchPanel.COLUMNS.thumbnail,CQ.wcm.SiteAdminSearchPanel.COLUMNS.name,CQ.wcm.SiteAdminSearchPanel.COLUMNS.published,CQ.wcm.SiteAdminSearchPanel.COLUMNS.modified,CQ.wcm.SiteAdminSearchPanel.COLUMNS.width,CQ.wcm.SiteAdminSearchPanel.COLUMNS.height,CQ.wcm.SiteAdminSearchPanel.COLUMNS.size];
if(config.columns){for(var i=0;
i<config.columns.length;
i++){var c=config.columns[i];
var pref=null;
if(typeof c=="string"){pref=c
}else{if(typeof c=="object"){if(c.usePredefined){pref=c.usePredefined
}CQ.shared.XSS.updatePropertyName(c,"dataIndex")
}}if(pref&&CQ.wcm.SiteAdminSearchPanel.COLUMNS[pref]){var prefCfg=CQ.Util.copyObject(CQ.wcm.SiteAdminSearchPanel.COLUMNS[pref]);
for(var prop in c){if(prop=="usePredefined"){continue
}prefCfg[prop]=c[prop]
}this.colModelColumns.push(prefCfg)
}else{this.colModelColumns.push(c)
}}}else{this.colModelColumns=defaultColumns
}this.store=new CQ.Ext.data.Store({autoLoad:false,baseParams:{_charset_:"UTF-8"},replication:null,paramNames:{start:"p.offset",limit:"p.limit",sort:"p.sort",dir:"p.dir"},listeners:{load:function(e){this.replication=null
}},proxy:new CQ.Ext.data.HttpProxy({url:CQ.shared.HTTP.externalize("/bin/querybuilder.json"),method:"POST"}),reader:new CQ.Ext.data.JsonReader({root:"hits",id:"jcr:path",scope:this,totalProperty:"total",fields:["numberer","thumbnail",{name:"ck",sortType:CQ.Ext.data.SortTypes.asUCString,convert:function(v,record){try{var mod=record["jcr:content"]["renditions"]["cq5dam.thumbnail.48.48.png"]["jcr:content"]["jcr:lastModified"];
return new Date(mod).getTime()
}catch(e){return""
}}},{name:"title",sortType:CQ.Ext.data.SortTypes.asUCString,convert:function(v,record){try{return CQ.shared.XSS.getXSSValue(record["jcr:content"]["jcr:title"])
}catch(e){}try{return CQ.shared.XSS.getXSSValue(record["jcr:content"]["metadata"]["dc:title"])
}catch(e){return""
}}},{name:"template",sortType:CQ.Ext.data.SortTypes.asUCString,convert:function(v,record){try{return record["jcr:content"]["cq:template"]
}catch(e){return""
}}},{name:"name",sortType:CQ.Ext.data.SortTypes.asUCString,convert:function(v,record){try{if(!record["jcr:content"]["cq:name"]){var idx=record["jcr:path"].lastIndexOf("/");
var name=record["jcr:path"].substr(idx+1);
if(name.length>0){return CQ.shared.XSS.getXSSValue(name)
}return""
}else{return CQ.shared.XSS.getXSSValue(record["jcr:content"]["cq:name"])
}}catch(e){return""
}}},{name:"created",sortType:CQ.Ext.data.SortTypes.asUCString,convert:function(v,record){return(!record["jcr:created"])?"":record["jcr:created"]
}},{name:"replication",sortType:CQ.Ext.data.SortTypes.asUCString,convert:function(v,record){try{return{published:record["jcr:content"]["cq:lastReplicated"],publishedBy:CQ.shared.XSS.getXSSValue(record["jcr:content"]["cq:lastReplicatedBy"]),action:record["jcr:content"]["cq:lastReplicationAction"],numQueued:"N/A"}
}catch(e){return null
}}},{name:"lastModified",sortType:CQ.Ext.data.SortTypes.asUCString,convert:function(v,record){try{if(record["jcr:content"]["cq:lastModified"]){return record["jcr:content"]["cq:lastModified"]
}else{return record["jcr:content"]["jcr:lastModified"]
}}catch(e){return""
}}},{name:"lastModifiedBy",sortType:CQ.Ext.data.SortTypes.asUCString,convert:function(v,record){try{return CQ.shared.XSS.getXSSValue(record["jcr:content"]["jcr:lastModifiedBy"])
}catch(e){return""
}}},{name:"size",sortType:CQ.Ext.data.SortTypes.asUCString,convert:function(v,record){try{return record["jcr:content"]["renditions"]["original"]["jcr:content"][":jcr:data"]
}catch(e){return 0
}}},{name:"height",sortType:CQ.Ext.data.SortTypes.asUCString,convert:function(v,record){try{return record["jcr:content"]["metadata"]["tiff:ImageLength"]
}catch(e){return 0
}}},{name:"width",sortType:CQ.Ext.data.SortTypes.asUCString,convert:function(v,record){try{return record["jcr:content"]["metadata"]["tiff:ImageWidth"]
}catch(e){return 0
}}},{name:"mime",sortType:CQ.Ext.data.SortTypes.asUCString,convert:function(v,record){try{return record["jcr:content"]["metadata"]["dc:format"]
}catch(e){return""
}}},{name:"type",sortType:CQ.Ext.data.SortTypes.asUCString,convert:function(v,record){try{return record["jcr:primaryType"]
}catch(e){return""
}}},{name:"lockedBy",sortType:CQ.Ext.data.SortTypes.asUCString,convert:function(v,record){try{return(!record["jcr:content"]["jcr:lockOwner"])?"":CQ.shared.XSS.getXSSValue(record["jcr:content"]["jcr:lockOwner"])
}catch(e){return""
}}}]})});
this.pagingToolbar=new CQ.Ext.PagingToolbar({pageSize:config.pageSize?config.pageSize:CQ.themes.wcm.SiteAdminSearchPanel.GRID_PAGE_SIZE,store:this.store,displayInfo:true,displayMsg:CQ.themes.wcm.SiteAdminSearchPanel.GRID_PAGE_TEXT,emptyMsg:""});
var facets=[{xtype:"hidden",name:"p.hitwriter",value:"full"},{xtype:"hidden",name:"p.nodedepth",value:"4"}];
var customFacets=CQ.Util.formatData(CQ.HTTP.eval((config.facetURL||this.facetURL)));
for(var key in customFacets){if(typeof(customFacets[key])==="object"){facets.push(customFacets[key])
}}this.typeCache={};
config=CQ.Util.applyDefaults(config,{title:CQ.I18n.getMessage("Search"),iconCls:id+"-icon",id:id,cls:"cq-siteadmin-wrapper",xtype:"panel",layout:"border",border:false,margins:"5 0 5 5",items:[{xtype:"panel",id:id+"-search",cls:"cq-siteadminsearch-wrapper",layout:"form",autoScroll:true,region:"west",margins:"5 0 5 5",padding:"5px 5px 5px 5px",width:CQ.themes.wcm.SiteAdminSearchPanel.QUERYBUILDER_WIDTH,collapsible:true,collapseMode:"mini",hideCollapseTool:true,animate:true,split:true,bbar:["->",{xtype:"button",text:CQ.I18n.getMessage("Reset"),handler:function(button,event){panel.performReset()
}},{xtype:"button",text:CQ.I18n.getMessage("Search"),handler:function(button,event){panel.performSearch()
}}],items:facets},{xtype:"siteadmingrid",id:id+"-grid",region:"center",tbar:this.actions,bbar:this.pagingToolbar,contextActions:gridContextActions,admin:this,store:this.store,cm:new CQ.Ext.grid.ColumnModel({columns:this.colModelColumns}),listeners:{afterrender:function(grid){panel.hidePagingToolbar();
panel.checkActions();
grid.getSelectionModel().on("selectionchange",function(sm){var sel=sm.getSelections();
for(var i=0;
i<sel.length;
i++){panel.typeCache[sel[i].id]=sel[i].get("type")
}panel.checkActions()
})
},beforeshow:function(grid){console.log(CQ.Ext.getCmp(window.CQ_SiteAdminSearch_id).store)
}}}]});
window.CQ_SiteAdminSearch_id=id;
CQ.wcm.SiteAdminSearchPanel.superclass.constructor.call(this,config)
},performSearch:function(){var a={"p.limit":this.pageSize,"p.offset":0,_charset_:"UTF-8"};
this.mask();
this.store.baseParams=CQ.Util.applyDefaults(this.getPredicateParameters(),a);
this.store.load({callback:function(){this.checkPagingToolbar(this.store.getTotalCount());
this.unmask()
},scope:this})
},performReset:function(){this.findBy(function(b,a){if(b instanceof CQ.Ext.form.Field){b.reset()
}});
this.store.removeAll();
this.store.baseParams={};
this.store.lastOptions={};
this.hidePagingToolbar()
},reloadPages:function(){if(this.store.getTotalCount()>0){this.mask();
this.store.reload({callback:function(){this.checkPagingToolbar(this.store.getTotalCount());
this.unmask()
},scope:this})
}},showPagingToolbar:function(){if(this.pagingToolbar.hidden){this.pagingToolbar.show();
this.pagingToolbar.ownerCt.doLayout()
}},hidePagingToolbar:function(){if(!this.pagingToolbar.hidden){this.pagingToolbar.hide();
this.pagingToolbar.ownerCt.doLayout()
}},checkPagingToolbar:function(a){if(a<=this.pagingToolbar.pageSize){this.hidePagingToolbar()
}else{this.showPagingToolbar()
}},loadPath:function(a){this.reloadPages()
},mask:function(){if(!this.loadMask){this.loadMask=new CQ.Ext.LoadMask(this.id,{msg:CQ.I18n.getMessage("Searching...")})
}this.loadMask.show()
},unmask:function(a){if(!this.loadMask){return
}this.loadMask.hide()
},getSelectedPages:function(){var a=this;
var b=CQ.Ext.getCmp(this.id+"-grid").getSelectionModel().getSelections();
if(b.length>0){return b
}else{return[]
}},getPredicateParameters:function(){var a=this;
var g={};
this.findBy(function(k,j){if(k instanceof CQ.Ext.form.Field){var m=k.getValue();
if(k instanceof CQ.Ext.form.Checkbox){if(k.getValue()){m=k.inputValue
}else{return
}}g[k.name]=m
}});
var b=a.getEl().query(".cq-optionspredicate input[type='checkbox']:checked");
for(var c=0;
c<b.length;
c++){if(!g[b[c].name]){g[b[c].name]=b[c].value
}}return g
}});
CQ.Ext.reg("siteadminsearchpanel",CQ.wcm.SiteAdminSearchPanel);
CQ.Ext.override(CQ.wcm.SiteAdminSearchPanel,CQ.wcm.AdminBase);
CQ.wcm.SiteAdminSearchPanel.formatDate=function(b){if(typeof b=="number"){b=new Date(b)
}var a=CQ.I18n.getMessage("d-M-Y H:i",null,"Date format for ExtJS SiteAdmin (short, eg. two-digit year, http://extjs.com/deploy/ext/docs/output/Date.html)");
return b.format(a)
};
CQ.wcm.SiteAdminSearchPanel.COLUMNS={numberer:{id:"numberer",header:CQ.I18n.getMessage(""),width:23,sortable:true,menuDisabled:true,fixed:true,hideable:false,dataIndex:"index",renderer:function(b,c,a){if(b!=undefined){return b+1
}return""
}},title:{header:CQ.I18n.getMessage("Title"),id:"title",sortable:true,dataIndex:"title",renderer:function(c,a,b){return CQ.shared.XSS.xssPropertyRenderer(c,a,b,this)
}},name:{header:CQ.I18n.getMessage("Name"),id:"name",sortable:true,dataIndex:"name",width:80,renderer:function(b,c,a){return a.get("name")
}},template:{header:CQ.I18n.getMessage("Template"),id:"template",sortable:true,dataIndex:"template",renderer:function(b,c,a){return b?b:""
}},created:{header:CQ.I18n.getMessage("Created"),id:"created",sortable:true,dataIndex:"created",renderer:function(b,j,a){var k=a.data.created;
var g="";
if(k&&k.length>0){g=CQ.wcm.SiteAdminSearchPanel.formatDate(new Date(a.data.created));
var c=CQ.shared.XSS.getXSSTablePropertyValue(a.data,"createdBy");
if(c&&c.length>0){g+="("+c+")"
}}return"<div>"+g+"</div>"
}},published:{header:CQ.I18n.getMessage("Published"),id:"published",dataIndex:"replication.published",renderer:function(q,b,g){var n=CQ.Ext.getCmp(window.CQ_SiteAdminSearch_id).store;
if(n.replication==null){var w=[];
var b="";
$CQ.each(n.data.items,function(v,x){b+="assetPaths="+encodeURIComponent(x.id)+"&"
});
b=b.substring(0,b.length-1);
var c=((window.XMLHttpRequest)?new XMLHttpRequest():new ActiveXObject("Microsoft.XMLHTTP"));
c.open("POST",CQ.HTTP.externalize("/bin/replication.json"),false);
c.setRequestHeader("Content-type","application/x-www-form-urlencoded");
c.send(b);
var m=CQ.Ext.decode(c.responseText);
n.replication=m
}var k="";
var r="";
var j=g.data.replication;
var a="";
var u=CQ.I18n.getMessage("N/A");
var o=CQ.I18n.getMessage("N/A");
if(j&&j.published){r=CQ.wcm.SiteAdmin.formatDate(new Date(j.published));
r+=" ("+CQ.shared.XSS.getXSSTablePropertyValue(j,"publishedBy")+")";
var t=n.replication.queueStatus[g.id]["numQueued"];
if(t){a=' ext:qtip="<nobr>';
if(j.action=="Activate"){k="status-pending-activation";
a+=CQ.I18n.getMessage("Activation pending. #{0} in Queue.",j.numQueued)
}else{k="status-pending-deactivation";
a+=CQ.I18n.getMessage("Deactivation pending. #{0} in Queue.",j.numQueued)
}a+='</nobr>"'
}else{if(j.action=="Activate"){if(!g.data.timeUntilValid){if(!g.data.offTime){k="status-activated"
}else{k="status-offtime"
}}else{if(g.data.timeUntilValid){if(g.data.offTime){k="status-onofftime"
}else{k="status-ontime"
}}else{k="status-deactivated"
}}}else{k="status-deactivated"
}}if(g.data.timeUntilValid&&(g.data.onTime||g.data.offTime)){a='ext:qtip="<nobr>';
if(g.data.onTime){u=CQ.wcm.SiteAdmin.formatDate(new Date(g.data.onTime));
a+="<b>"+CQ.I18n.getMessage("On Time")+":</b> "+u+"<br/>"
}if(g.data.offTime){o=CQ.wcm.SiteAdmin.formatDate(new Date(g.data.offTime));
a+="<b>"+CQ.I18n.getMessage("Off Time")+":</b> "+o+"<br/>"
}a+='</nobr>"'
}}else{k="status-none"
}return'<div class="status double '+k+'" '+a+"><span>"+r+"</span></div>"
}},modified:{header:CQ.I18n.getMessage("Modified"),id:"modified",sortable:true,dataIndex:"lastModified",renderer:function(c,n,b){var k=b.data.replication;
var a=b.data.lastModified;
var m="";
var g="";
if(a){m=CQ.wcm.SiteAdmin.formatDate(new Date(b.data.lastModified));
var j=CQ.shared.XSS.getXSSTablePropertyValue(b.data,"lastModifiedBy");
if(j&&j.length>0){m+=" ("+j+")"
}g="status-localmodified"
}if(k&&k.published){if(k.action=="Activate"){if(new Date(a)>new Date(k.published)){g="status-modified"
}}}if(!g){g="status-localmodified"
}return'<div class="status '+g+'">'+m+"</div>"
}},size:{header:CQ.I18n.getMessage("Size"),id:"size",width:60,sortable:true,dataIndex:"size",renderer:function(b,c,a){return b?CQ.Util.formatFileSize(b):""
}},width:{header:CQ.I18n.getMessage("Width"),id:"width",width:55,sortable:true,dataIndex:"width",renderer:function(b,c,a){return b?b:""
}},height:{header:CQ.I18n.getMessage("Height"),id:"height",width:50,sortable:true,dataIndex:"height",renderer:function(b,c,a){return b?b:""
}},mimeType:{header:CQ.I18n.getMessage("Kind"),id:"mimeType",sortable:true,hidden:true,dataIndex:"mimeType"},thumbnail:{header:'<span class="hidden">'+CQ.I18n.getMessage("Thumbnail")+"</span>",id:"thumbnail",width:60,menuDisabled:true,hideable:true,refreshOnHiddenchange:true,dataIndex:"X",sortable:false,renderer:function(g,n,b){var a=CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
var k=CQ.Ext.getCmp("cq-siteadminsearchpanel-grid");
if(k.getColumnModel().getColumnById(n.id).hidden){return""
}var m=b.id;
var c=b.get("ck");
var j=CQ.HTTP.externalize(CQ.shared.XSS.getXSSValue(CQ.HTTP.encodePath(m))+".thumb.48.48"+(c?"."+c:"")+".png",true);
return'<img src="'+j+'">'
}}};
CQ.wcm.EditBase={actions:null,editText:null,deleteText:null,insertText:null,copyText:null,pasteText:null,referenceText:null,params:{},dialog:null,element:null,path:null,insertBehavior:null,lastAction:null,dialogs:null,orderable:true,targetMode:null,componentPath:null,dropTarget:null,isDropTarget:null,componentDropTarget:null,elementDropTarget:null,subDropTargets:null,dragZoneClass:null,dropTargetClass:null,inlineEditing:null,inplaceEditing:null,isContained:null,isContainer:false,containerClass:null,IEScriptInsert:'<div style="display:none;">&nbsp;</div>',clsPath:null,cellSearchPath:null,cell:null,isInplaceEdited:false,inplaceEditor:null,annotations:null,selectionHandlers:null,clipboardHandlers:null,constructor:function(){},constructorStart:function(a){this.actions=[];
this.dialogs={};
this.annotations={};
this.selectionHandlers=[];
this.clipboardHandlers=[];
this.initRefreshShortcuts();
this.initI18n(a);
this.params=a.params;
this.inheritConfig(a);
this.listenersChecker(a)
},constructorEnd:function(a){if(a.isContainer){this.updateComponentList.defer(16,this)
}},initComponentEnd:function(){(function(){var a=CQ.WCM.getPageInfo(CQ.WCM.getPagePath());
if(a.annotations&&a.annotations.indexOf(this.path)!=-1){this.loadAnnotations()
}}).defer(16,this)
},loadAnnotations:function(preventAsync){var editComponent=this;
var processResponse=function(data){editComponent.clearAnnotations();
for(var name in data){if(name=="jcr:primaryType"){continue
}var a=data[name];
if(!a){return
}editComponent.addAnnotation({text:a.text,lastModified:a["jcr:lastModified"],lastModifiedBy:a["jcr:lastModifiedBy"],offsetX:a.x,offsetY:a.y,width:a.w,height:a.h,minimized:a.minimized,color:a.color,sketches:a.sketches?a.sketches:{}},name)
}};
var url=this.path+"/"+CQ.wcm.EditBase.ANNOTATIONS+CQ.Sling.SELECTOR_INFINITY+CQ.HTTP.EXTENSION_JSON;
if(!preventAsync){CQ.HTTP.get(url,function(options,success,response){var data=CQ.HTTP.eval(response);
if(success){processResponse(data)
}})
}else{var response=CQ.HTTP.get(url);
if(CQ.HTTP.isOk(response)){processResponse(CQ.HTTP.eval(response))
}}},hasAnnotations:function(){for(var a in this.annotations){return true
}return false
},clearAnnotations:function(){for(var a in this.annotations){if(this.annotations.hasOwnProperty(a)){this.annotations[a].destroy()
}}this.annotations={}
},addAnnotation:function(g,c,j){if(!c){c=""
}var k=CQ.Util.createId();
g=CQ.Util.applyDefaults(g,{path:this.path+"/"+CQ.wcm.EditBase.ANNOTATIONS+"/"+c,editComponent:this,id:k});
var b=new CQ.wcm.Annotation(g);
this.annotations[k]=b;
b.show((c=="")&&!j);
return b
},getAnnotation:function(a){return this.annotations[a]
},getAnnotationAt:function(a){for(var b in this.annotations){if(this.annotations.hasOwnProperty(b)){if(this.annotations[b].path==a){return this.annotations[b]
}}}return undefined
},removeAnnotation:function(a){this.annotations[a].destroy();
delete this.annotations[a]
},removeAnnotations:function(){for(var a in this.annotations){this.removeAnnotation(a)
}},showAnnotations:function(){for(var a in this.annotations){this.annotations[a].show()
}},hideAnnotations:function(){for(var a in this.annotations){this.annotations[a].hide()
}},alignAnnotations:function(){for(var c in this.annotations){var b=this.annotations[c];
b.align()
}},observeElementPosition:function(){var a=this.element.getXY();
if(!CQ.Util.isEqualPosition(a,this.formerXY,1)){if(!this.elementHidden){this.alignAnnotations()
}}this.formerXY=a
},getEditConfig:function(){var a=this;
return{text:this.editText,handler:function(){CQ.wcm.EditBase.showDialog(this,CQ.wcm.EditBase.EDIT)
},listeners:{render:function(g){var j=this;
var c=CQ.WCM.getSelection();
if(c.getCount()>1&&c.contains(j)){g.disable()
}var b=function(){var k=CQ.WCM.getSelection();
if(k.getCount()>1&&k.contains(j)){g.disable()
}else{g.enable()
}};
CQ.WCM.onSelectionChange(b);
a.selectionHandlers.push(b)
}}}
},getDeleteConfig:function(){return{text:this.deleteText,handler:function(){var a=this.getTargetParent();
if(a){a.removeParagraph()
}else{this.removeParagraph()
}}}
},getInsertConfig:function(){var a=this;
return{text:this.insertText,handler:function(c){CQ.wcm.EditBase.showDialog(this,CQ.wcm.EditBase.INSERT,true)
},listeners:{render:function(g){var j=this;
var c=CQ.WCM.getSelection();
if(c.getCount()>1&&c.contains(j)){g.disable()
}var b=function(){var k=CQ.WCM.getSelection();
if(k.getCount()>1&&k.contains(j)){g.disable()
}else{g.enable()
}};
CQ.WCM.onSelectionChange(b);
a.selectionHandlers.push(b)
}}}
},removeSelectionListeners:function(){for(var a=0;
a<this.selectionHandlers.length;
a++){CQ.WCM.unSelectionChange(this.selectionHandlers[a])
}},removeClipboardListeners:function(){for(var a=0;
a<this.clipboardHandlers.length;
a++){CQ.WCM.unClipboardChange(this.clipboardHandlers[a])
}},getCopyMoveConfig:function(){return[{text:this.cutText,handler:function(){var a=CQ.WCM.getSelectedItems();
if(a.length==0){a.push(this)
}CQ.WCM.cut(a)
}},{text:this.copyText,handler:function(){var a=CQ.WCM.getSelectedItems();
if(a.length==0){a.push(this)
}CQ.WCM.copy(a)
}},this.getPasteConfig()]
},getPasteConfig:function(){var a=this;
return{text:this.pasteText,handler:function(){var k=CQ.undo.util.MultiUndoUtils;
var c=k.begin();
var b=CQ.WCM.paste();
while(b.length>0){var j=b.shift();
if(j.action!=CQ.WCM.ACTION_CUT){this.copyParagraph(j.path,j.resourceType,j.hasAnnotations)
}else{k.determineMoveInformation(c,j);
var g=this.moveParagraph(j.path,j.resourceType,j.hasAnnotations);
if(g){k.addMoveAction(c,g,this)
}}}k.reverseActions(c);
k.commit(c)
},listeners:{render:function(g){var c=CQ.WCM.getClipboard();
if(!c.getCount()){g.disable()
}var b=function(){if(!c.getCount()){g.disable()
}else{g.enable()
}};
CQ.WCM.onClipboardChange(b);
a.clipboardHandlers.push(b)
}}}
},getAnnotateConfig:function(){return{text:this.annotateText,handler:function(){var a=this.getNewAnnotationOffset();
this.addAnnotation({path:this.path+"/"+CQ.wcm.EditBase.ANNOTATIONS+"/",editComponent:this,offsetX:a[0],offsetY:a[1]})
}}
},getTargetAncestor:function(){if(this.targetAncestor===undefined){var a=this;
while(a&&a.getResourceType()!==CQ.wcm.EditBase.TARGET_COMPONENT){a=a.getParentFromDOM()
}this.targetAncestor=a
}return this.targetAncestor
},getTargetParent:function(){var a=this;
var c=a.getParentFromDOM();
var b=null;
if(c&&c.getResourceType()==CQ.wcm.EditBase.TARGET_COMPONENT){b=c
}return b
},getTargetComponentConfig:function(a){return{text:a?this.untargetText:this.targetText,handler:function(){this.targetComponent(a,a)
}}
},getExperiencesConfig:function(){return{text:this.experiencesText,handler:function(){if(window.CQ&&window.CQ.personalization&&window.CQ.personalization.TargetEditor){CQ.personalization.TargetEditor.get(this.getTargetAncestor()).toggle()
}}}
},targetComponent:function(revert,confirm){var component=this;
if(revert&&component.getResourceType()!==CQ.wcm.EditBase.TARGET_COMPONENT){component=component.getTargetAncestor()
}function run(component){var path=component.path;
if(path.indexOf("/*")===(path.length-2)){path=path.substring(0,path.length-2)
}CQ.Ext.Ajax.request({url:path+(revert?".untarget":".target")+".json",params:{resourceType:component.getResourceType()},method:"POST",callback:function(options,success,xhr){var response=CQ.shared.HTTP.eval(xhr);
if(response.success){if(!revert){CQ.WCM.onEditableReady(path,function(editable){if(window.CQ&&window.CQ.personalization&&window.CQ.personalization.TargetEditor){CQ.personalization.TargetEditor.get(editable).show()
}})
}component.refreshParent()
}else{CQ.Notification.notify(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not adapt component for targeting."))
}},scope:this})
}if(confirm){CQ.Ext.Msg.confirm(revert?CQ.I18n.getMessage("Disable targeting"):CQ.I18n.getMessage("Enable targeting"),revert?CQ.I18n.getMessage("Do you really want to disable targeting for this component? Variants will only be disabled, not deleted."):CQ.I18n.getMessage("Do you really want to enable targeting for this component?"),function(btnId){if(btnId==="yes"){run(component)
}},this)
}else{run(component)
}},getEditDialog:function(){if(!this.dialogs[CQ.wcm.EditBase.EDIT]){if(this.dialog instanceof CQ.Dialog){this.dialogs[CQ.wcm.EditBase.EDIT]=this.dialog
}else{var a;
if(typeof this.dialog=="string"){a={url:this.dialog}
}else{a=this.dialog
}a.responseScope=this;
a.params=this.params;
a=CQ.WCM.getDialogConfig(a);
a=CQ.Util.applyDefaults(a,{title:CQ.I18n.getMessage("Edit Component"),params:{"./jcr:lastModified":"","./jcr:lastModifiedBy":""}});
if(this.enableLiveRelationship){a=CQ.Util.applyDefaults(a,{editLockMode:true,editLock:!this[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP][CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_CANCELLED],editLockDisabled:!this[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP][CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_EDITABLE],editLockDisabledTitle:CQ.I18n.getMessage("Inheritance is broken at the page or parent level")})
}if(this.element&&this.element.getWidth()>this.getInlineConfig().size&&!CQ.wcm.EditBase.isInlineDialogChildOpened(this.path)){a=CQ.Util.applyDefaults({closable:false,collapsible:false,draggable:false,header:false,hideCollapseTool:true,maximizable:false,modal:false,plain:true,resizeHandles:"s",shadow:false,shadowOffset:0,title:null,cls:this.getClsPath("cq-dialog")},a)
}this.dialogs[CQ.wcm.EditBase.EDIT]=CQ.WCM.getDialog(a,"editdialog-"+this.path)
}}this.lastAction=CQ.wcm.EditBase.ACTION_EDIT;
return this.dialogs[CQ.wcm.EditBase.EDIT]
},updateComponentList:function(){var b=CQ.utils.WCM.getComponentList(this.path);
var c=CQ.utils.WCM.getDesign(this.path);
var a=this.getCell();
var g=c.getStyleProperty(a,"components");
if(!g){g=[]
}this.fireEvent(CQ.wcm.EditBase.EVENT_UPDATE_COMPONENTLIST,a,g,b);
b.update(a,g)
},getInlineConfig:function(){var active=true;
var size=CQ.themes.wcm.EditBase.INLINE_MINIMUM_WIDTH;
if(this.inlineEditing){if(typeof this.inlineEditing=="string"){if(isNaN(this.inlineEditing)){if(typeof this.inlineEditing=="string"&&this.inlineEditing.indexOf("CQ.wcm.EditBase")==0){try{this.inlineEditing=eval(this.inlineEditing)
}catch(error){}}if(this.inlineEditing==CQ.wcm.EditBase.INLINE_MODE_NEVER){active=false;
size=Number.MAX_VALUE
}else{if(this.inlineEditing==CQ.wcm.EditBase.INLINE_MODE_FORCED){active=true;
size=0
}}}else{active=true;
size=parseInt(this.inlineEditing)
}}else{if(typeof this.inlineEditing=="number"){active=true;
size=this.inlineEditing
}}}return{active:active,size:size}
},getInsertDialog:function(g){g=(g===true);
var k=this.dialogs[CQ.wcm.EditBase.INSERT];
if(!k||(k.ignoreIsContainer!=g)){var c=new CQ.Ext.Panel({border:false,autoScroll:true,layout:"accordion",cls:"cq-sidekick-buttons"});
var j={"jcr:primaryType":"cq:Dialog",title:CQ.I18n.getMessage("Insert New Component"),items:c,width:CQ.themes.wcm.EditBase.INSERT_DIALOG_WIDTH,cls:"cq-insertdialog "+this.getClsPath("cq-insertdialog")};
k=CQ.WCM.getDialog(j,"insertdialog-"+this.path);
this.dialogs[CQ.wcm.EditBase.INSERT]=k;
var b=this;
k.ok=function(){b.submitInsertDialog()
};
k.buttons[0].disable();
var a=CQ.WCM.getComponentList(this.path);
CQ.wcm.ComponentList.loadPanel(a,c,this,g);
k.ignoreIsContainer=g
}else{this.selectInsertComponent(null)
}this.lastAction=CQ.wcm.EditBase.ACTION_INSERT;
return k
},selectInsertComponent:function(a){if(a==null){var b=this.dialogs[CQ.wcm.EditBase.INSERT].findByType("dataview");
for(var c=0;
c<b.length;
c++){b[c].clearSelections()
}this.dialogs[CQ.wcm.EditBase.INSERT].buttons[0].disable();
this.insertComponentRecord=null
}else{this.insertComponentRecord=CQ.Util.copyObject(a);
this.dialogs[CQ.wcm.EditBase.INSERT].buttons[0].enable()
}},submitInsertDialog:function(){if(!this.insertDialogMask){this.insertDialogMask=new CQ.Ext.LoadMask(this.dialogs[CQ.wcm.EditBase.INSERT].getEl(),{msg:CQ.wcm.EditBase.INSERTING_PARAGRAPH})
}this.insertDialogMask.show();
var b=this;
var a=this.insertComponentRecord.data;
a.insertBehavior=this.insertBehavior;
window.setTimeout(function(){b.createParagraph(a);
b.dialogs[CQ.wcm.EditBase.INSERT].hide();
b.insertDialogMask.hide()
},1)
},getParent:function(b){var c=b&&b.path?b.path:this.path;
var a;
if(c.lastIndexOf("/")!=-1){a=c.substring(0,c.lastIndexOf("/"))
}if(a){return CQ.WCM.getEditable(a)
}else{return null
}},getParentPath:function(){var a;
if(this.path&&this.path.lastIndexOf("/")!=-1){a=this.path.substring(0,this.path.lastIndexOf("/"))
}return a
},getParentFromDOM:function(){if(this.parentEditable===undefined){if(this.element&&this.element.dom&&this.element.dom.parentNode){this.parentEditable=CQ.WCM.getEditableFromDOM(this.element.dom.parentNode)
}}return this.parentEditable
},getResourceType:function(){if(this.initialConfig&&this.initialConfig.params&&this.initialConfig.params["./sling:resourceType"]){return this.initialConfig.params["./sling:resourceType"]
}else{return""
}},getResourceSuperType:function(){if(this.initialConfig&&this.initialConfig.params&&this.initialConfig.params["./sling:resourceSuperType"]){return this.initialConfig.params["./sling:resourceSuperType"]
}else{return""
}},inheritConfig:function(a,b){if(!b){b=this.getParent(a)
}if(!b||!b.childConfig){return a
}return CQ.Ext.applyIf(a,b.childConfig)
},listenersChecker:function(config){if(config&&config.listeners){for(var event in config.listeners){var listener=config.listeners[event];
if(listener&&typeof listener=="string"){delete config.listeners[event];
if(this.REFRESH_SHORTCUTS[listener]){config.listeners[event]=this.REFRESH_SHORTCUTS[listener]
}else{try{eval("config.listeners[event] = "+listener)
}catch(err){}}}}}return config
},getDropTargets:function(){var a=[];
try{for(var b=0;
b<this.subDropTargets.length;
b++){a.push(this.subDropTargets[b])
}}catch(c){}if(this.elementDropTarget){a.push(this.elementDropTarget)
}if(this.componentDropTarget&&this.componentDropTarget!=this.elementDropTarget){a.push(this.componentDropTarget)
}return a
},insertBefore:function(b){if(this.isContained){var a=this.element.parent();
a.insertBefore(b)
}else{if(this.placeholder){this.placeholder.insertBefore(b)
}this.element.insertBefore(b)
}},refresh:function(g,j){if(this.deleted){if(CQ.wcm.EditRollover.currentlyHighlighted){CQ.wcm.EditRollover.currentlyHighlighted.hideHighlight()
}var c=this;
this.element.hide({callback:function(){if(c.isContained){c.element.parent().remove()
}if(c.remove){c.remove()
}}});
CQ.Util.runComponentObservation();
return
}if(!g){g=this.path+(this.isContainer?".editcontext":"")+CQ.HTTP.EXTENSION_HTML
}g=CQ.HTTP.noCaching(g);
if(this.hideHighlight){CQ.wcm.EditRollover.preventNextHighlight=true;
this.hideHighlight()
}var b=CQ.HTTP.get(g);
if(CQ.HTTP.isOk(b)){var a=b.body;
CQ.utils.WCM.startMakeEditablesQueue();
this.replaceElement(a,j);
if(this.refreshComponent){this.refreshComponent()
}if(CQ.wcm.EditRollover.currentlyHighlighted){CQ.wcm.EditRollover.currentlyHighlighted.hideHighlight()
}CQ.utils.WCM.endMakeEditablesQueue();
CQ.Util.runComponentObservation()
}},replaceElement:function(r,g){if(g){var b=this.element.getStyle("height");
var m=this.element.getHeight();
if(m>0){this.element.setHeight(m)
}}var c=CQ.WCM.getNestedEditables(this.path);
for(var k=0;
k<c.length;
k++){var a=CQ.WCM.getEditable(c[k]);
if(a){a.remove()
}}this.removeSubDropTargets();
var o=false;
try{var j="";
if(CQ.Ext.isIE&&r.toLowerCase().indexOf("<script")!=-1){j=this.IEScriptInsert
}this.element.update(j+r)
}catch(q){o=true
}CQ.DOM.executeScripts(this.element);
this.buildSubDropTargets();
if(o){CQ.shared.Util.reload()
}if(g){var n=this;
this.element.fadeIn({callback:function(){var t=n.element.getHeight(),v=CQ.Ext.get(n.element.query(".parbase")[0]),u=v.getHeight()+v.getMargins().bottom+v.getMargins().top;
if(b&&b!="0px"){n.element.setHeight(b)
}if(t!==u){n.element.animate({height:{to:u}})
}}})
}},failure:function(b,a){if(a.failureType=="client"){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Unknown Error"))
}else{CQ.Ext.Msg.minWidth=500;
CQ.Ext.Msg.alert(a.response.status,a.response.responseText)
}},success:function(m,a){var j=m.findField("oldCqCssClass");
var n=m.findField("./cq:cssClass");
if(this.lastAction==CQ.wcm.EditBase.ACTION_INSERT||this.path.substring(this.path.length-2)=="/*"){var k=m.findField("./sling:resourceType").getValue();
var b=a.result.Path;
if(k&&b){var g=CQ.WCM.getComponentConfig(k);
if(b&&g){var c=b+".html";
this.listenersChecker(g.config);
this.updateCqCssClass(j?j.getValue():"",n?n.getValue():"");
if(g.config&&g.config.listeners&&g.config.listeners[CQ.wcm.EditBase.EVENT_AFTER_INSERT]){g.config.listeners[CQ.wcm.EditBase.EVENT_AFTER_INSERT].call(this,b,g)
}else{this.refreshCreated(b,g)
}}else{this.refreshPage()
}}else{this.refreshPage()
}}else{this.updateCqCssClass(j?j.getValue():"",n?n.getValue():"");
this.fireEvent(CQ.wcm.EditBase.EVENT_AFTER_EDIT,this)
}},updateCqCssClass:function(a,b){if(a==b){return
}if(a){this.element.removeClass(a.split(" "))
}if(b){this.element.addClass(b.split(" "))
}},initI18n:function(a){this.editText=a.editText?a.editText:CQ.I18n.getMessage("Edit");
this.deleteText=a.deleteText?a.deleteText:CQ.I18n.getMessage("Delete");
this.insertText=a.insertText?a.insertText:CQ.I18n.getMessage("New...");
this.cutText=a.copyText?a.copyText:CQ.I18n.getMessage("Cut");
this.copyText=a.copyText?a.copyText:CQ.I18n.getMessage("Copy");
this.pasteText=a.pasteText?a.pasteText:CQ.I18n.getMessage("Paste");
this.referenceText=a.referenceText?a.referenceText:CQ.I18n.getMessage("Refer");
this.annotateText=a.annotateText?a.annotateText:CQ.I18n.getMessage("Annotate");
this.targetText=a.targetText?a.targetText:CQ.I18n.getMessage("Target",null,"Button to enable targeting of a component");
this.untargetText=a.untargetText?a.untargetText:CQ.I18n.getMessage("Disable targeting");
this.experiencesText=a.experiencesText?a.experiencesText:CQ.I18n.getMessage("Experiences...")
},isRemovable:function(){if(this.getResourceType()==CQ.wcm.EditBase.PARSYS_NEW||this.getResourceType()==CQ.wcm.EditBase.TARGET_PARSYS_END){return false
}var b=this.getTargetParent();
var a=(b==null)?this.getParentFromDOM():b.getParentFromDOM();
return a?a.isContainer:false
},applyConfigDefaults:function(config,defaults){config=CQ.Util.applyDefaults(config,defaults);
var targetingActionsAdded=false;
this.initialConfig=config;
this.element={dom:config.element};
var isTargeted=(this.getTargetAncestor()!=null);
if(this.getTargetParent()&&!(this.getParent(config)&&this.getParent(config).isContainer)){var actionsClone=config.actions.slice();
if(actionsClone.indexOf(CQ.wcm.EditBase.COPYMOVE)!==-1){actionsClone.splice(actionsClone.indexOf(CQ.wcm.EditBase.COPYMOVE),1)
}if(actionsClone.indexOf(CQ.wcm.EditBase.INSERT)!==-1&&this.getResourceType()!==CQ.wcm.EditBase.PARSYS_NEW){actionsClone.splice(actionsClone.indexOf(CQ.wcm.EditBase.INSERT,1))
}if(actionsClone.lastIndexOf("-")==actionsClone.length-1){actionsClone.splice(actionsClone.lastIndexOf("-"),1)
}config.actions=actionsClone
}if(isTargeted&&this.isRemovable()&&config.actions.indexOf(CQ.wcm.EditBase.DELETE)==-1){config.actions.push(CQ.wcm.EditBase.DELETE)
}delete this.initialConfig;
delete this.element;
var container=config[config.container];
var ctrlDef=config[config.ctrlDef];
if(config.actions){var finalActionArray=[];
if(typeof config.actions=="string"){config.actions=[config.actions]
}container.items=[];
for(var i=0;
i<config.actions.length;
i++){var anActionConfig=config.actions[i];
var actionArray=[];
if(anActionConfig instanceof Array||CQ.Ext.isArray(anActionConfig)){actionArray=anActionConfig
}else{actionArray=[anActionConfig]
}for(var j=0;
j<actionArray.length;
j++){var currentAction=actionArray[j];
if(typeof currentAction=="string"&&currentAction.indexOf("CQ.wcm.EditBase")==0){try{currentAction=eval(currentAction)
}catch(error){}}finalActionArray.push(currentAction);
if(typeof currentAction=="string"){if(currentAction==CQ.wcm.EditBase.EDIT){var editButton=this.getEditConfig();
editButton=CQ.Util.applyDefaults(editButton,ctrlDef);
container.items.push(editButton);
if(CQ.WCM.isEditMode()){this.addTargetingActions(container.items,ctrlDef,isTargeted,config);
targetingActionsAdded=true
}}else{if(currentAction==CQ.wcm.EditBase.DELETE){var deleteButton=this.getDeleteConfig();
deleteButton=CQ.Util.applyDefaults(deleteButton,ctrlDef);
container.items.push(deleteButton)
}else{if(currentAction==CQ.wcm.EditBase.INSERT){var insertButton=this.getInsertConfig();
insertButton=CQ.Util.applyDefaults(insertButton,ctrlDef);
container.items.push(insertButton);
if(config.actions.indexOf(CQ.wcm.EditBase.COPYMOVE)==-1){var pasteButton=this.getPasteConfig();
pasteButton=CQ.Util.applyDefaults(pasteButton,ctrlDef);
container.items.push(pasteButton)
}}else{if(currentAction==CQ.wcm.EditBase.COPYMOVE){var cfg=this.getCopyMoveConfig();
container.items.push(CQ.Util.applyDefaults(cfg[0],ctrlDef));
container.items.push(CQ.Util.applyDefaults(cfg[1],ctrlDef));
container.items.push(CQ.Util.applyDefaults(cfg[2],ctrlDef))
}else{if(currentAction==CQ.wcm.EditBase.ANNOTATE){var annotateButton=this.getAnnotateConfig();
annotateButton=CQ.Util.applyDefaults(annotateButton,ctrlDef);
container.items.push(annotateButton)
}else{if(this.convertAction){var converted=this.convertAction(currentAction);
if(converted&&converted!=""){container.items.push(converted)
}}else{container.items.push(currentAction)
}}}}}}}else{var button=this.convertAction(currentAction);
if(button!=null){if(typeof button=="string"&&button!=""){container.items.push(button)
}else{if(typeof(button.handler)=="string"){try{eval("button.handler="+button.handler);
button=CQ.Util.applyDefaults(button,ctrlDef);
container.items.push(button)
}catch(err){}}else{button=CQ.Util.applyDefaults(button,ctrlDef);
container.items.push(button)
}}}}}}delete config.actions;
config.actions=finalActionArray;
if(CQ.WCM.isEditMode()&&!targetingActionsAdded){this.addTargetingActions(container.items,ctrlDef,isTargeted,config)
}}config.items=CQ.Util.applyDefaults(config.items,[container])
},addTargetingActions:function(c,a,b,g){var j;
if(b){if(g.params["./sling:resourceType"]!==CQ.wcm.EditBase.TARGET_PARSYS_END){j=this.getExperiencesConfig();
c.push(CQ.Util.applyDefaults(j,a))
}if(this.getTargetParent()&&g.params["./sling:resourceType"]!==CQ.wcm.EditBase.PARSYS_NEW&&!g.isContainer){j=this.getTargetComponentConfig(true);
c.push(CQ.Util.applyDefaults(j,a))
}}else{if(!g.disableTargeting){j=this.getTargetComponentConfig(false);
c.push(CQ.Util.applyDefaults(j,a))
}}},showTarget:function(a){if(CQ.wcm.EditBase.hideTargetTimeout){window.clearTimeout(CQ.wcm.EditBase.hideTargetTimeout)
}if(this.targetMode&&this.targetMode==CQ.wcm.EditBase.TARGET_MODE_LINE){this.showTargetLine()
}else{this.showTargetGhost(a)
}},showTargetGhost:function(c){var k=this.element.getWidth();
var a=CQ.themes.wcm.EditBase.TARGETGHOST_HEIGHT;
if(c){a=c.getDragData().height
}if(a<1){a=CQ.themes.wcm.EditBase.TARGETGHOST_HEIGHT
}else{if(a>CQ.themes.wcm.EditBase.TARGETGHOST_MAXHEIGHT){a=CQ.themes.wcm.EditBase.TARGETGHOST_MAXHEIGHT
}}if(a<CQ.themes.wcm.EditBase.TARGETGHOST_MINHEIGHT){a=CQ.themes.wcm.EditBase.TARGETGHOST_MINHEIGHT
}var j="<div></div>";
var g=CQ.DOM.getBlockDefaultStyles();
var b=CQ.Util.applyDefaults({height:a+"px",width:k+"px"},g);
if(b.bottom){delete b.bottom
}if(!CQ.wcm.EditBase.TargetGhost.placeholder){if(this.isContained){CQ.wcm.EditBase.TargetGhost.placeholder=CQ.Ext.DomHelper.insertBefore(this.placeholder.parent(),j,true)
}else{CQ.wcm.EditBase.TargetGhost.placeholder=CQ.Ext.DomHelper.insertBefore(this.placeholder,j,true)
}CQ.wcm.EditBase.TargetGhost.placeholder.setVisibilityMode(CQ.Ext.Element.DISPLAY)
}else{if(this.isContained){CQ.wcm.EditBase.TargetGhost.placeholder.insertBefore(this.placeholder.parent())
}else{CQ.wcm.EditBase.TargetGhost.placeholder.insertBefore(this.placeholder)
}}CQ.wcm.EditBase.TargetGhost.placeholder.setStyle(b);
CQ.wcm.EditBase.TargetGhost.placeholder.addClass(["cq-editcomponent-placeholder","cq-editcomponent-ghost-placeholder"]);
CQ.wcm.EditBase.TargetGhost.placeholder.show();
CQ.wcm.EditBase.TargetGhost.render(CQ.Util.ROOT_ID);
CQ.wcm.EditBase.TargetGhost.el.setStyle("position","absolute");
CQ.wcm.EditBase.TargetGhost.el.anchorTo(CQ.wcm.EditBase.TargetGhost.placeholder,"tl",[0,0],false,null);
CQ.wcm.EditBase.TargetGhost.observe=function(){if(!this.hidden&&!CQ.Util.isEqualPosition(this.el.getXY(),this.placeholder.getXY(),0)){this.el.alignTo(this.placeholder,"tl-tl",[0,0])
}};
CQ.Util.observeComponent(CQ.wcm.EditBase.TargetGhost);
CQ.wcm.EditBase.TargetGhost.setWidth(k);
CQ.wcm.EditBase.TargetGhost.setHeight(a);
CQ.wcm.EditBase.TargetGhost.removeClass("cq-editcomponent-ghost-masking");
CQ.wcm.EditBase.TargetGhost.show();
CQ.Util.runComponentObservation()
},showTargetLine:function(){var b=0,a=0,c=0;
if(this.element&&this.element.isVisible()){b=this.element.getWidth();
a=this.element.getLeft();
c=this.element.getTop()
}if(this.placeholder){c=this.placeholder.getTop()
}c-=CQ.themes.wcm.EditBase.TARGETLINE_DISTANCE;
CQ.wcm.EditBase.TargetLine.setWidth(b);
CQ.wcm.EditBase.TargetLine.setPosition(a,c);
CQ.wcm.EditBase.TargetLine.render(CQ.Util.ROOT_ID);
CQ.wcm.EditBase.TargetLine.show()
},hideTarget:function(c){this.unmaskTarget();
var a=this;
var b=function(){if(a.targetMode&&a.targetMode==CQ.wcm.EditBase.TARGET_MODE_LINE){a.hideTargetLine()
}else{a.hideTargetGhost()
}CQ.wcm.EditBase.hideTargetTimeout=null
};
if(c){CQ.wcm.EditBase.hideTargetTimeout=window.setTimeout(b,200)
}else{b.call(this)
}},maskTarget:function(a){if(this.targetMode&&this.targetMode==CQ.wcm.EditBase.TARGET_MODE_LINE){}else{this.maskTargetGhost(a)
}},unmaskTarget:function(){if(this.targetMode&&this.targetMode==CQ.wcm.EditBase.TARGET_MODE_LINE){}else{this.unmaskTargetGhost()
}},hideTargetLine:function(){CQ.wcm.EditBase.TargetLine.hide()
},hideTargetGhost:function(){CQ.wcm.EditBase.TargetGhost.hide();
if(CQ.wcm.EditBase.TargetGhost.placeholder){CQ.wcm.EditBase.TargetGhost.placeholder.hide()
}CQ.Util.cancelObservation(CQ.wcm.EditBase.TargetGhost);
CQ.Util.runComponentObservation()
},maskTargetGhost:function(a){if(CQ.wcm.EditBase.TargetGhost.el){CQ.wcm.EditBase.TargetGhost.addClass("cq-editcomponent-ghost-masking");
CQ.wcm.EditBase.TargetGhost.el.mask(a,"x-mask-loading")
}},unmaskTargetGhost:function(){if(CQ.wcm.EditBase.TargetGhost.el&&CQ.wcm.EditBase.TargetGhost.el.isMasked()){CQ.wcm.EditBase.TargetGhost.el.unmask()
}},isActionInsertOnly:function(){return(this.actions.length==1&&this.actions[0]==CQ.wcm.EditBase.INSERT)
},isActionInsert:function(){return(this.actions&&this.actions.indexOf(CQ.wcm.EditBase.INSERT)!=-1)
},isActionEdit:function(){return(this.actions&&this.actions.indexOf(CQ.wcm.EditBase.EDIT)!=-1)
},isActionDelete:function(){return(this.actions&&this.actions.indexOf(CQ.wcm.EditBase.DELETE)!=-1)
},isActionCopyMove:function(){return(this.actions&&this.actions.indexOf(CQ.wcm.EditBase.COPYMOVE)!=-1)
},isSameParent:function(a){if(a&&a.getParentPath){return(this.getParentPath()==a.getParentPath())
}return false
},equals:function(a){if(a){return(this.path==a.path)
}return false
},isInsertAllowed:function(c){if(this.isActionInsert()){var b=this.getParent();
if(b){var a=CQ.WCM.getComponentList(this.path);
return a.isAllowed(c,b.getCell())
}}return false
},isReady:function(){return this.ready
},buildSubDropTargets:function(){if(this.dropTarget){this.subDropTargets=new Array();
var n=0;
for(;
n<this.dropTarget.length;
n++){var a=this.dropTarget[n].id;
var k=this.dropTarget[n].accept;
var o=this.dropTarget[n].params;
if(k&&!CQ.Ext.isArray(k)){var b=new RegExp("[ ;]+","g");
k=k.split(b)
}var c=this.dropTarget[n].groups;
if(c){var g;
if(!CQ.Ext.isArray(c)){g=new Array();
g[0]=c
}else{g=c
}a=this.searchDropTargetInCSSClass(a);
if(a!=null){if(this.elementDropTarget){if(this.elementDropTarget.groups){for(var q in this.elementDropTarget.groups){if(g.indexOf(q)==-1){g.push(q)
}}}}if(g.length>0){this.subDropTargets[n]=this.dropTargetClass.getInstance(a,this,g,{propertyName:this.dropTarget[n].name});
if(k){this.subDropTargets[n].ddAccept=k
}if(o){this.subDropTargets[n].postParams=o
}}}else{if(this.elementDropTarget){var m=0;
for(;
m<g.length;
m++){this.elementDropTarget.addToGroup(g[m]);
this.componentDropTarget.addToGroup(g[m])
}if(!this.elementDropTarget.propertyName){this.elementDropTarget.propertyName=this.dropTarget[n].name
}if(!this.componentDropTarget.propertyName){this.componentDropTarget.propertyName=this.dropTarget[n].name
}if(k){this.elementDropTarget.ddAccept=k
}if(o){this.elementDropTarget.postParams=o
}}}}}}},searchDropTargetInCSSClass:function(b){if(this.element&&this.element.dom){var a=CQ.Ext.DomQuery.selectNode('*[class*="cq-dd-'+b+'"]',this.element.dom);
if(a){if(a.id){return a.id
}else{return CQ.Ext.id(a)
}}}return null
},resumeDropTargets:function(){if(this.componentDropTarget){this.componentDropTarget.unlock()
}if(this.elementDropTarget&&this.elementDropTarget!==this.componentDropTarget){this.elementDropTarget.unlock()
}this.resumeSubDropTargets()
},suspendDropTargets:function(){if(this.componentDropTarget){this.componentDropTarget.lock()
}if(this.elementDropTarget&&this.elementDropTarget!==this.componentDropTarget){this.elementDropTarget.lock()
}this.suspendSubDropTargets()
},resumeSubDropTargets:function(){if(this.subDropTargets){var a=0;
for(;
a<this.subDropTargets.length;
a++){this.subDropTargets[a].unlock()
}}},suspendSubDropTargets:function(){if(this.subDropTargets){var a=0;
for(;
a<this.subDropTargets.length;
a++){this.subDropTargets[a].lock()
}}},removeDropTargets:function(){if(this.componentDropTarget){this.componentDropTarget.lock();
CQ.Ext.destroy(this.componentDropTarget);
delete this.componentDropTarget
}if(this.elementDropTarget&&this.elementDropTarget!==this.componentDropTarget){this.elementDropTarget.lock();
CQ.Ext.destroy(this.elementDropTarget);
CQ.Ext.destroy(this.componentDropTarget);
delete this.elementDropTarget;
delete this.componentDropTarget
}this.removeSubDropTargets()
},removeSubDropTargets:function(){if(this.subDropTargets){var a=0;
for(;
a<this.subDropTargets.length;
a++){this.subDropTargets[a].lock();
CQ.Ext.destroy(this.subDropTargets[a]);
this.subDropTargets.remove(a)
}}},isParentHighlighted:function(){if(CQ.wcm.EditRollover.currentlyHighlighted&&CQ.wcm.EditRollover.currentlyHighlighted.element){var b=CQ.wcm.EditRollover.currentlyHighlighted.element.dom;
var a=this.element.dom.parentNode;
while(a!=null){if(a==b){return true
}a=a.parentNode
}}return false
},isParentHighLighted:this.isParentHighlighted,getThumbnailPath:function(){if(this.componentPath){return this.componentPath+".png"
}else{var b=null;
if(this.dialog){if(typeof this.dialog=="string"){b=this.dialog
}else{b=this.dialog.url
}if(b){var a=b.lastIndexOf("/");
if(a!=-1){b=b.substring(0,b.lastIndexOf("/")+1)+"thumbnail.png"
}if(!CQ.HTTP.isOk(CQ.HTTP.get(b))){return""
}}}return b
}},getIconPath:function(){var b=null;
if(this.dialog){if(typeof this.dialog=="string"){b=this.dialog
}else{b=this.dialog.url
}if(b){var a=b.lastIndexOf("/");
if(a!=-1){b=b.substring(0,b.lastIndexOf("/")+1)+"icon.png"
}}}return b
},handleLiveRelationship:function(a){if(this[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP]!=null&&this.liveStatus==null){if(!this[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP][CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_MANUALLY_CREATED]&&(this[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP][CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_SOURCE_EXISTING]||this[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP][CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_SOURCE_DELETED])){this.enableLiveRelationship=true;
this.liveStatusContainerMode=(a===true);
this.liveStatusLocked=!this[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP][CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_CANCELLED];
this.on(CQ.wcm.EditBase.EVENT_AFTER_MOVE,function(){var b=this.getParent();
if(b){if(b.liveStatusLocked){b.doSwitchLock()
}}},this)
}}},switchLock:function(a){CQ.Ext.Msg.confirm(this.liveStatusLocked?CQ.I18n.getMessage("Cancel inheritance"):CQ.I18n.getMessage("Revert inheritance"),this.liveStatusLocked?CQ.I18n.getMessage("Do you really want to cancel the inheritance?"):CQ.I18n.getMessage("Do you really want to revert the inheritance?"),function(b){if(b=="yes"){this.doSwitchLock(a)
}else{a.setEditLock(this.liveStatusLocked,false,true)
}},this)
},doSwitchLock:function(k){var g={};
g[CQ.wcm.msm.MSM.PARAM_STATUS+"/"+CQ.wcm.msm.MSM.PARAM_IS_CANCELLED]=this.liveStatusLocked;
this.deepCancel=!this.isContainer;
g[CQ.wcm.msm.MSM.PARAM_STATUS+"/"+CQ.wcm.msm.MSM.PARAM_IS_CANCELLED_FOR_CHILDREN]=this.deepCancel;
var m=CQ.utils.HTTP.post(this.path+".msm.conf",null,g,this);
if(CQ.utils.HTTP.isOk(m)){this.liveStatusLocked=!this.liveStatusLocked;
if(k&&k.setEditLock){k.setEditLock(this.liveStatusLocked,false,true)
}var o,a;
var j=CQ.I18n.getMessage("Unfortunately, this is not possible.");
var n=CQ.I18n.getMessage("Future undo or redo operations that address this paragraph may fail ungracefully.");
if(this.liveStatusLocked){if(CQ.undo.UndoManager.isEnabled()){o=CQ.undo.UndoManager.getHistory();
a=o.createUndoStep(o.createStepConfig());
a.addUndoAction(new CQ.undo.actions.CannotUndoAction(CQ.I18n.getMessage("You're trying to undo reverting the inheritance for paragraph")+"<br>"+this.path+"<br>"+j+"<br>"+n,CQ.I18n.getMessage("You're trying to redo reverting the inheritance for paragraph")+"<br>"+this.path+"<br>"+j+"<br>"+n));
a.commit()
}if(this.getResourceType()=="wcm/msm/components/ghost"){if(m.headers&&m.headers.Message){var b=undefined;
if(m.headers.Message=="ghost#cleanedup"){b=CQ.I18n.getMessage("Source paragraph was not found. Paragraph was restored as it was before deletion and is now only available on local Live Copy page.")
}else{if(m.headers.Message=="ghost#deleted"){b=CQ.I18n.getMessage("Source paragraph was not found and no restore information was found. Paragraph has been deleted.")
}}if(b){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Orphaned, deleted paragaph"),b,function(){this.refreshPage()
},this)
}else{this.refreshPage()
}}}else{this.refreshPage()
}}else{if(CQ.undo.UndoManager.isEnabled()){o=CQ.undo.UndoManager.getHistory();
a=o.createUndoStep(o.createStepConfig());
a.addUndoAction(new CQ.undo.actions.CannotUndoAction(CQ.I18n.getMessage("You're trying to undo cancelling the inheritance for paragraph")+"<br>"+this.path+"<br>"+j,CQ.I18n.getMessage("You're trying to redo cancelling the inheritance for paragraph")+"<br>"+this.path+"<br>"+j));
a.commit()
}var c=CQ.WCM.getNestedEditables(this.path);
if(this.deepCancel&&c.length>0){this.refreshPage()
}else{if(this.handleLiveStatus){this.handleLiveStatus();
if(k&&k.setEditLock){k.setEditLock(this.liveStatusLocked)
}}}}}},getClsPath:function(a){if(!this.clsPath){var b="jcr:content";
this.clsPath=this.path.substring(this.path.lastIndexOf(b)+b.length+1);
this.clsPath=CQ.DOM.encodeClass(this.clsPath,"")
}return a+"-"+this.clsPath
},getCell:function(){if(!this.cell&&this.cellSearchPath){this.cell=new CQ.wcm.Cell(this.cellSearchPath)
}return this.cell
},inplaceEditingOutOfAreaClick:function(){var a=window.CQ_inplaceEditComp;
var b=(window.CQ_inplaceEditDialog===true);
if(a&&!b){a.finishInplaceEditing()
}},startInplaceEditing:function(){if(this.fireEvent(CQ.wcm.EditBase.EVENT_BEFORE_EDIT,this)===false){return
}var j=(this.inplaceEditingConfig&&this.inplaceEditingConfig.active)&&(CQ.Ext.isIE||(CQ.Ext.isGecko&&!CQ.Ext.isGecko2)||CQ.Ext.isWebKit);
if(j){var n=CQ.Util.getRoot();
var g=CQ.Ext.get(this.element);
var q=g.getXY();
var o=q[0];
var m=q[1];
var t=g.getSize();
var r=t.width;
var k=t.height;
var b=CQ.Ext.DomHelper.createDom({tag:"div",style:"position: absolute; left: "+o+"px; top: "+m+"px; width: "+r+"px; height: "+k+"px;"});
n.dom.appendChild(b);
var c=new CQ.Ext.LoadMask(CQ.Ext.get(b),{removeMask:true,rootDiv:b});
c.enable();
c.show();
if(this.inplaceEditor==null){var a=this.inplaceEditingConfig.editorType;
if(a!=null){this.inplaceEditor=CQ.ipe.InplaceEditing.create(a)
}if(this.inplaceEditor==null){this.handleInplaceEditingInitError(CQ.I18n.getMessage("There is no suitable editor registered for inline editing.<br>Please check your edit configuration."),c,a==="image"||a==="textimage")
}else{this.inplaceEditor.loadEditorConfig(this.inplaceEditingConfig,{onSuccess:function(){this.inplaceEditor.init();
this.loadInplaceContentAsync(c)
},onFailure:function(){this.handleInplaceEditingInitError(null,c)
},scope:this})
}}else{this.loadInplaceContentAsync(c)
}}},loadInplaceContentAsync:function(loadMask){var url=this.path+".0"+CQ.HTTP.EXTENSION_JSON;
CQ.HTTP.get(url,function(options,success,response){if(success){var prop=this.inplaceEditor.getProperty();
if(prop.indexOf("./")==0){prop=prop.substring(2)
}this.startInplaceEditorAsync(CQ.HTTP.eval(response)[prop]||"",loadMask)
}else{this.handleInplaceEditingInitError(CQ.I18n.getMessage("Could not load content from server."),loadMask)
}},this)
},_ipeClickHandler:function(a){a.stopPropagation()
},startInplaceEditorAsync:function(b,a){if(a){a.hide();
a.rootDiv.parentNode.removeChild(a.rootDiv)
}if(this._startInplaceEditing){this._startInplaceEditing()
}this.isInplaceEdited=true;
window.CQ_inplaceEditComp=this;
this.inplaceEditor.start(this,this.element,b);
this.element.on("click",this._ipeClickHandler);
CQ.Ext.EventManager.on(document.body,"click",this.inplaceEditingOutOfAreaClick)
},handleInplaceEditingInitError:function(c,b,a){if(b){b.hide();
b.rootDiv.parentNode.removeChild(b.rootDiv)
}if(a){return
}var g=((typeof(c)=="string")?c:CQ.I18n.getMessage("Could not load inplace editing configuration."));
CQ.Notification.notify(g)
},finishInplaceEditing:function(){if(this.isInplaceEdited){this.element.un("click",this._ipeClickHandler);
CQ.Ext.EventManager.un(document.body,"click",this.inplaceEditingOutOfAreaClick);
if(this._finishInplaceEditing){this._finishInplaceEditing()
}this.inplaceEditor.finish();
this.isInplaceEdited=false;
window.CQ_inplaceEditComp=null
}},cancelInplaceEditing:function(){if(this.isInplaceEdited){this.element.un("click",this._ipeClickHandler);
CQ.Ext.EventManager.un(document.body,"click",this.inplaceEditingOutOfAreaClick);
if(this._cancelInplaceEditing){this._cancelInplaceEditing()
}this.inplaceEditor.cancel();
this.isInplaceEdited=false;
window.CQ_inplaceEditComp=null
}},isInplaceEditingDropAllowed:function(a){if(this.inplaceEditor){return this.inplaceEditor.isDropAllowed(a)
}return false
},notifyInplaceEditingDrop:function(a){if(this.inplaceEditor){this.inplaceEditor.notifyDrop(a)
}},hideDialogListener:function(a){CQ.Util.cancelObservation(a);
CQ.wcm.EditBase.unRegisterInlineDialog(a);
this.showElement();
this.refreshComponent();
if(this.enableDrag){this.enableDrag()
}},hideDialogListenerToResumeDropTargets:function(a){this.resumeDropTargets()
},resizeDialogListener:function(c,b,a){this.getInlinePlaceholder().setHeight(a+this.getInlinePlaceholderInitialHeight()+CQ.themes.wcm.EditBase.INLINE_BOTTOM_PADDING)
}};
CQ.wcm.EditBase.INSERTING_PARAGRAPH=CQ.I18n.getMessage("Inserting paragraph...");
CQ.wcm.EditBase.INSERT_BEFORE="before";
CQ.wcm.EditBase.INSERT_AFTER="after";
CQ.wcm.EditBase.INSERT_LAST="";
CQ.wcm.EditBase.ACTION_EDIT="EDIT";
CQ.wcm.EditBase.ACTION_INSERT="INSERT";
CQ.wcm.EditBase.EDIT="EDIT";
CQ.wcm.EditBase.DELETE="DELETE";
CQ.wcm.EditBase.INSERT="INSERT";
CQ.wcm.EditBase.ANNOTATE="ANNOTATE";
CQ.wcm.EditBase.TARGET_COMPONENT="cq/personalization/components/target";
CQ.wcm.EditBase.TARGET_PARSYS_END="cq/personalization/components/targetparsys/end";
CQ.wcm.EditBase.PARSYS_NEW="foundation/components/parsys/new";
CQ.wcm.EditBase.COPYMOVE="COPYMOVE";
CQ.wcm.EditBase.EDITDELETE=[CQ.wcm.EditBase.EDIT,"-",CQ.wcm.EditBase.DELETE];
CQ.wcm.EditBase.EDITANNOTATE=[CQ.wcm.EditBase.EDIT,CQ.wcm.EditBase.ANNOTATE];
CQ.wcm.EditBase.EDITANNOTATEDELETE=[CQ.wcm.EditBase.EDIT,CQ.wcm.EditBase.ANNOTATE,"-",CQ.wcm.EditBase.DELETE];
CQ.wcm.EditBase.EDITANNOTATECOPYMOVEDELETEINSERT=[CQ.wcm.EditBase.EDIT,CQ.wcm.EditBase.ANNOTATE,"-",CQ.wcm.EditBase.COPYMOVE,CQ.wcm.EditBase.DELETE,"-",CQ.wcm.EditBase.INSERT];
CQ.wcm.EditBase.EDITCOPYMOVEDELETEINSERT=[CQ.wcm.EditBase.EDIT,"-",CQ.wcm.EditBase.COPYMOVE,CQ.wcm.EditBase.DELETE,"-",CQ.wcm.EditBase.INSERT];
CQ.wcm.EditBase.EDITANNOTATECOPYMOVEINSERT=[CQ.wcm.EditBase.EDIT,CQ.wcm.EditBase.ANNOTATE,"-",CQ.wcm.EditBase.COPYMOVE,"-",CQ.wcm.EditBase.INSERT];
CQ.wcm.EditBase.EDITCOPYMOVEINSERT=[CQ.wcm.EditBase.EDIT,"-",CQ.wcm.EditBase.COPYMOVE,"-",CQ.wcm.EditBase.INSERT];
CQ.wcm.EditBase.EDITANNOTATEDELETEINSERT=[CQ.wcm.EditBase.EDIT,CQ.wcm.EditBase.ANNOTATE,"-",CQ.wcm.EditBase.DELETE,"-",CQ.wcm.EditBase.INSERT];
CQ.wcm.EditBase.EDITDELETEINSERT=[CQ.wcm.EditBase.EDIT,"-",CQ.wcm.EditBase.DELETE,"-",CQ.wcm.EditBase.INSERT];
CQ.wcm.EditBase.ANNOTATIONS="cq:annotations";
CQ.wcm.EditBase.EVENT_AFTER_INSERT="afterinsert";
CQ.wcm.EditBase.EVENT_BEFORE_MOVE="beforemove";
CQ.wcm.EditBase.EVENT_AFTER_MOVE="aftermove";
CQ.wcm.EditBase.EVENT_BEFORE_COPY="beforecopy";
CQ.wcm.EditBase.EVENT_AFTER_COPY="aftercopy";
CQ.wcm.EditBase.EVENT_BEFORE_EDIT="beforeedit";
CQ.wcm.EditBase.EVENT_AFTER_EDIT="afteredit";
CQ.wcm.EditBase.EVENT_BEFORE_DELETE="beforedelete";
CQ.wcm.EditBase.EVENT_AFTER_DELETE="afterdelete";
CQ.wcm.EditBase.EVENT_BEFORE_CHILD_INSERT="beforechildinsert";
CQ.wcm.EditBase.EVENT_AFTER_CHILD_INSERT="afterchildinsert";
CQ.wcm.EditBase.EVENT_RENDER="render";
CQ.wcm.EditBase.EVENT_READY="ready";
CQ.wcm.EditBase.EVENT_UPDATE_COMPONENTLIST="updatecomponentlist";
CQ.wcm.EditBase.EVENTS_LIST=[CQ.wcm.EditBase.EVENT_BEFORE_COPY,CQ.wcm.EditBase.EVENT_BEFORE_DELETE,CQ.wcm.EditBase.EVENT_BEFORE_EDIT,CQ.wcm.EditBase.EVENT_BEFORE_MOVE,CQ.wcm.EditBase.EVENT_BEFORE_CHILD_INSERT,CQ.wcm.EditBase.EVENT_AFTER_INSERT,CQ.wcm.EditBase.EVENT_AFTER_COPY,CQ.wcm.EditBase.EVENT_AFTER_DELETE,CQ.wcm.EditBase.EVENT_AFTER_EDIT,CQ.wcm.EditBase.EVENT_AFTER_MOVE,CQ.wcm.EditBase.EVENT_RENDER,CQ.wcm.EditBase.EVENT_AFTER_CHILD_INSERT,CQ.wcm.EditBase.EVENT_UPDATE_COMPONENTLIST];
CQ.wcm.EditBase.INLINE_MODE_AUTO="auto";
CQ.wcm.EditBase.INLINE_MODE_NEVER="never";
CQ.wcm.EditBase.INLINE_MODE_FORCED="forced";
CQ.wcm.EditBase.REFERENCE_COMPONENT="foundation/components/reference";
CQ.wcm.EditBase.REFERENCE_COMPONENT_PATH_PROPERTY="./path";
CQ.wcm.EditBase.showDialog=function(m,j,b){if(!m){return
}var g;
if(j&&j==CQ.wcm.EditBase.INSERT){g=m.getInsertDialog(b);
g.processPath(m.path)
}else{if(m.fireEvent(CQ.wcm.EditBase.EVENT_BEFORE_EDIT,m)===false){return
}g=m.getEditDialog();
g.loadContent(m.path);
if(m.enableLiveRelationship){var c=function(){m.switchLock(g)
};
g.on("beforeeditlocked",c);
g.on("beforeeditunlocked",c);
g.on("beforeshow",function(){g.editLock=this.liveStatusLocked
},m)
}if(g.hidden&&m.element&&m.element.getWidth()>m.getInlineConfig().size&&!CQ.wcm.EditBase.isInlineDialogChildOpened(m.path)){var a=m.getInlinePlaceholder();
if(a){var k=m.getInlinePlaceholderInitialHeight();
m.hideElement(true);
g.setWidth(a.getWidth());
g.anchorTo(a,"tl",[0,k],true);
g.on("resize",m.resizeDialogListener,m);
g.on("hide",m.hideDialogListener,m);
g.anchoredTo=m;
CQ.Util.observeComponent(g);
a.setHeight(g.getFrameHeight()+g.getInnerHeight()+a.getHeight()+CQ.themes.wcm.EditBase.INLINE_BOTTOM_PADDING);
if(m.disableDrag){m.disableDrag()
}CQ.wcm.EditBase.registerInlineDialog(g);
g.disableOverridePosition=true
}}}CQ.WCM.deselect();
g.show();
m.suspendDropTargets();
g.on("hide",m.hideDialogListenerToResumeDropTargets,m)
};
CQ.wcm.EditBase.buildTargetGhost=function(){return new CQ.Ext.Container({xtype:"box",autoEl:"div",cls:"cq-editcomponent-ghost",listeners:{render:function(){var b=this.getEl().dom;
if(b.addEventListener){var a=this;
b.addEventListener("dragenter",function(c){c.preventDefault();
c.stopPropagation();
if(a.currentTarget){return a.currentTarget.notifyHTML5DragEnter(c)
}},false);
b.addEventListener("dragleave",function(c){c.preventDefault();
c.stopPropagation();
var g=a.currentTarget;
if(g){a.lastTarget=g;
a.currentTarget=null;
a.isDragOver=false;
window.setTimeout(function(){if(!a.isDragOver){g.notifyHTML5DragLeave(c)
}},1);
return false
}},false);
b.addEventListener("dragover",function(c){a.isDragOver=true;
c.preventDefault();
c.stopPropagation();
if(a.currentTarget){return a.currentTarget.notifyHTML5DragOver(c)
}},false);
b.addEventListener("drop",function(c){c.preventDefault();
c.stopPropagation();
if(a.currentTarget){return a.currentTarget.notifyHTML5Drop(c)
}if(a.lastTarget){return a.lastTarget.notifyHTML5Drop(c)
}},false)
}}}})
};
CQ.wcm.EditBase.buildTargetLine=function(){var c=new CQ.Ext.Container({xtype:"box",autoEl:"div",cls:"cq-editcomponent-targetline"});
var a=new CQ.Ext.BoxComponent({autoEl:"div",cls:"cq-editcomponent-targetline-left"});
var b=new CQ.Ext.BoxComponent({autoEl:"div",cls:"cq-editcomponent-targetline-right"});
c.add(a);
c.add(b);
return c
};
CQ.wcm.EditBase.TargetLine=CQ.wcm.EditBase.buildTargetLine();
CQ.wcm.EditBase.TargetGhost=CQ.wcm.EditBase.buildTargetGhost();
CQ.wcm.EditBase.TARGET_MODE_LINE="line";
CQ.wcm.EditBase.TARGET_MODE_GHOST="ghost";
CQ.wcm.EditBase.openedInlineDialog=[];
CQ.wcm.EditBase.registerInlineDialog=function(a){if(CQ.wcm.EditBase.openedInlineDialog.indexOf(a)==-1){CQ.wcm.EditBase.openedInlineDialog.push(a)
}};
CQ.wcm.EditBase.unRegisterInlineDialog=function(a){CQ.wcm.EditBase.openedInlineDialog.remove(a)
};
CQ.wcm.EditBase.isInlineDialogChildOpened=function(c){var a=0;
for(;
a<CQ.wcm.EditBase.openedInlineDialog.length;
a++){var b=CQ.wcm.EditBase.openedInlineDialog[a].path;
if(b&&b.substring(0,c.length)==c){return true
}}return false
};
CQ.wcm.EditBase.DD_GROUP_COMPONENT="editcomponent";
CQ.wcm.EditBase.DD_GROUP_ASSET="media";
CQ.wcm.EditBase.DD_GROUP_PAGE="page";
CQ.wcm.EditBase.DD_GROUP_PARAGRAPH="paragraph";
CQ.wcm.EditBase.DD_GROUP_PRODUCT="product";
CQ.wcm.EditBase.DD_GROUP_DEFAULT="default";
CQ.wcm.EditBase.DragZone=CQ.Ext.extend(CQ.Ext.dd.DragZone,{editComponent:null,isDropCancelled:false,currentDropTarget:null,constructor:function(b,a){a=a||{};
var c=document.createElement("div");
CQ.Ext.apply(a,{ddel:c});
if(a.editComponent){this.editComponent=a.editComponent;
this.editComponent.on("destroy",function(){this.destroy()
},this)
}CQ.wcm.EditBase.DragZone.superclass.constructor.call(this,b,a)
},getDragData:function(m){if(!this._dragData){var b=CQ.WCM.getSelectedItems();
if(b.length>0&&!this.editComponent.selected){b=[]
}if(b.length==0){b.push(this.editComponent)
}var a=0;
var g=0;
for(var c=0;
c<b.length;
c++){var n=b[c];
var j=n.getEl();
if(n.element){j=n.element
}a+=j.getHeight();
if(j.getWidth()>g){g=j.getWidth()
}var k=j.getMargins("tb");
if(k&&!isNaN(k)){a+=k
}}if(a>CQ.themes.wcm.EditBase.DDPROXY_MAXHEIGHT){a=CQ.themes.wcm.EditBase.DDPROXY_MAXHEIGHT
}else{if(a<CQ.themes.wcm.EditBase.DDPROXY_MINHEIGHT){a=CQ.themes.wcm.EditBase.DDPROXY_MINHEIGHT
}}if(g>CQ.themes.wcm.EditBase.DDPROXY_MAXWIDTH){g=CQ.themes.wcm.EditBase.DDPROXY_MAXWIDTH
}else{if(g<CQ.themes.wcm.EditBase.DDPROXY_MINWIDTH){g=CQ.themes.wcm.EditBase.DDPROXY_MINWIDTH
}}this.ddel.className="cq-editcomponent-dragzone-proxy";
this.ddel.style.width=g+"px";
this.ddel.style.height=a+"px";
this.ddel.style.padding="5px";
this._dragData={ddel:this.ddel,items:b,width:g,height:a}
}return this._dragData
},clearDragData:function(){this._dragData=null
},handleOnESC:function(a){if(a.getKey()==a.ESC){this.showEditComponent();
this.isDropCancelled=true;
this.unregisterESCKeyPress();
this.clearDragData();
this.proxy.repair(this.getRepairXY(a,this.getDragData()),this.afterRepair,this);
if(this.currentDropTarget&&this.currentDropTarget.editComponent){this.currentDropTarget.editComponent.hideTarget()
}}},registerESCKeyPress:function(){if(CQ.Ext.isIE){CQ.Ext.EventManager.on(window.document,"keypress",this.handleOnESC,this)
}else{CQ.Ext.EventManager.on(window.document,"keypress",this.handleOnESC,this);
CQ.Ext.EventManager.on(CQ.WCM.getTopWindow().document,"keypress",this.handleOnESC,this)
}},unregisterESCKeyPress:function(){if(CQ.Ext.isIE){CQ.Ext.EventManager.un(window.document,"keypress",this.handleOnESC,this)
}else{CQ.Ext.EventManager.un(window.document,"keypress",this.handleOnESC,this);
CQ.Ext.EventManager.un(CQ.WCM.getTopWindow().document,"keypress",this.handleOnESC,this)
}},onInitDrag:function(a,b){CQ.wcm.EditBase.DragZone.superclass.onInitDrag.call(this,a,b);
this.isDropCancelled=false;
this.currentDropTarget=null;
this.registerESCKeyPress();
this.hideEditComponent()
},getRepairXY:function(b,a){if(!this.isDropCancelled){this.showEditComponent();
if(this.editComponent&&this.editComponent.element){return this.editComponent.element.getXY()
}else{return a.item.getXY()
}}return null
},notifyDropDT:function(a,m,j){var n=false;
this.currentDropTarget=null;
if(!this.isDropCancelled&&this.isDropAllowed(a)){var b=CQ.I18n.getMessage("Moving paragraph...");
if(o){b=CQ.I18n.getMessage("Copying paragraph...")
}a.editComponent.maskTarget(b);
this.unregisterESCKeyPress();
var o=m.ctrlKey;
var g=this.getDragData();
var j=[];
for(var k=0;
k<g.items.length;
k++){var c=g.items[k];
j.push(c)
}window.setTimeout(function(){var x=CQ.undo.util.MultiUndoUtils;
var q=x.begin();
var u=a.editComponent;
for(var r=0;
r<j.length;
r++){var w=j[r];
if(o){u.copyParagraph(w.path,w.getResourceType(),w.hasAnnotations())
}else{var v=w.path;
x.determineMoveInformation(q,w);
var t=u.moveParagraph(v,w.getResourceType(),w.hasAnnotations());
if(t){x.addMoveAction(q,t,u)
}}a.editComponent.hideTarget();
w.showElement();
w.show()
}x.reverseActions(q);
x.commit(q)
},1);
n=true
}this.clearDragData();
return n
},showEditComponent:function(){var b=this.getDragData();
for(var a=0;
a<b.items.length;
a++){var c=b.items[a];
c.showElement();
c.show()
}},hideEditComponent:function(){var b=this.getDragData();
for(var a=0;
a<b.items.length;
a++){var c=b.items[a];
c.hideElement();
c.hide()
}this.DDM.refreshCache(this.groups)
},notifyEnterDT:function(c,b,a){if(this.isDropAllowed(c)){this.currentDropTarget=c;
c.editComponent.showTarget(this)
}return""
},notifyOutDT:function(c,b,a){if(this.isDropAllowed(c)){this.currentDropTarget=null
}c.editComponent.hideTarget(true);
return""
},notifyOverDT:function(c,b,a){if(this.isDropAllowed(c)){this.currentDropTarget=c;
c.editComponent.showTarget(this);
return this.dropAllowed
}else{this.currentDropTarget=null;
c.editComponent.hideTarget();
return this.dropNotAllowed
}},isDropAllowed:function(a){return(!this.isDropCancelled&&CQ.Util.isIntersecting(this.groups,a.groups)&&a.editComponent&&this.editComponent&&!this.editComponent.equals(a.editComponent)&&a.editComponent.isInsertAllowed(this.editComponent.getResourceType()))
},clearGroups:function(){this.groups={}
},addToGroups:function(a){if(a instanceof Array){for(var b=0;
b<a.length;
b++){this.addToGroup(a[b])
}}else{for(var b in a){this.addToGroup(a[b])
}}}});
CQ.wcm.EditBase.DragZone.getInstance=function(g,j,b){var a=new CQ.wcm.EditBase.DragZone(g,{editComponent:j});
if(b){var c=0;
for(;
c<b.length;
c++){a.addToGroup(b[c])
}a.removeFromGroup(CQ.wcm.EditBase.DD_GROUP_DEFAULT)
}return a
};
CQ.wcm.EditBase.DropTarget=CQ.Ext.extend(CQ.Ext.dd.DropTarget,{constructor:function(c,b){b=b||{};
if(b.editComponent){this.editComponent=b.editComponent;
this.editComponent.on("destroy",function(){this.destroy()
},this)
}CQ.wcm.EditBase.DropTarget.superclass.constructor.call(this,c,b);
this.highlight=new CQ.Highlight({element:this.el,cls:"cq-editbase-droptarget-highlight"});
if(this.editComponent&&window.addEventListener){var g=CQ.Ext.get(c).dom;
if(this.editComponent.emptyComponent){g=this.editComponent.emptyComponent.getEl().dom
}var a=this;
g.addEventListener("dragenter",function(j){return a.notifyHTML5DragEnter(j)
},false);
g.addEventListener("dragover",function(j){return a.notifyHTML5DragOver(j)
},false);
g.addEventListener("dragleave",function(j){return a.notifyHTML5DragLeave(j)
},false);
g.addEventListener("drop",function(j){return a.notifyHTML5Drop(j)
},false)
}},isCopyEvent:function(a){return true||a.dataTransfer.effectAllowed=="copy"
},notifyHTML5DragEnter:function(a){a.preventDefault();
a.stopPropagation();
if(this.isCopyEvent(a)){if(this.editComponent){CQ.wcm.EditBase.TargetGhost.currentTarget=this;
this.editComponent.showTarget()
}this.hideHighlight()
}else{if(CQ.wcm.EditBase.TargetGhost.currentTarget==this){CQ.wcm.EditBase.TargetGhost.currentTarget=null;
if(this.editComponent){this.editComponent.hideTarget(true)
}}this.showHighlight()
}return false
},notifyHTML5DragOver:function(a){a.preventDefault();
a.stopPropagation();
if(this.isCopyEvent(a)){if(this.editComponent&&CQ.wcm.EditBase.TargetGhost.currentTarget!=this){CQ.wcm.EditBase.TargetGhost.currentTarget=this;
this.editComponent.showTarget()
}this.hideHighlight()
}else{if(CQ.wcm.EditBase.TargetGhost.currentTarget==this){CQ.wcm.EditBase.TargetGhost.currentTarget=null;
if(this.editComponent){this.editComponent.hideTarget(true)
}}this.showHighlight()
}return false
},notifyHTML5DragLeave:function(a){a.preventDefault();
a.stopPropagation();
if(this.isDropping){return
}if(CQ.wcm.EditBase.TargetGhost.currentTarget!=this){CQ.wcm.EditBase.TargetGhost.currentTarget=null;
if(this.editComponent){this.editComponent.hideTarget(true)
}}this.hideHighlight();
return false
},notifyHTML5Drop:function(a){a.preventDefault();
a.stopPropagation();
if(this.editComponent){this.isDropping=true;
if(this.isCopyEvent(a)){CQ.wcm.EditBase.TargetGhost.currentTarget=null;
this.editComponent.showTarget();
this.html5UploadFiles(a.dataTransfer.files,this.notifyFilesUploaded,this,CQ.wcm.EditBase.TargetGhost.getEl())
}else{this.flash();
this.html5UploadFiles(a.dataTransfer.files,this.notifyFilesUpdated,this,this.editComponent.getEl())
}CQ.wcm.EditBase.TargetGhost.currentTarget=null;
if(this.editComponent){this.editComponent.hideTarget(true)
}}return false
},notifyFilesUploaded:function(a){var j=this.editComponent;
var g=CQ.I18n.getMessage("Inserting paragraph...");
j.maskTarget(g);
for(var b=0;
b<a.length;
b++){var c=a[b];
c.params={};
c.params[c.map.binaryProp]=c.path;
c.params[c.map.fileNameProp]=c.file.name
}window.setTimeout(function(){for(var k=0;
k<a.length;
k++){try{var n=a[k];
if(n.notAllowed){continue
}if(j.createParagraph(n.map.definition,n.params)==null){CQ.Notification.notify(n.file.name,CQ.I18n.getMessage("Failed to create paragraph with targeted component {0}{1}",["<br>",n.map.resourceType],"error message; name of the component that has been failed to insert"))
}}catch(m){}}},1);
j.hideTarget();
return false
},notifyFilesUpdated:function(a){var b=this.editComponent;
this.hideHighlight();
window.setTimeout(function(){try{b.updateParagraph("./file"+CQ.Sling.MOVE_SUFFIX,a[0].path,{})
}catch(c){CQ.Log.error(c)
}},1);
return false
},html5UploadFiles:function(c,j,a,b){var g={current:0,uploaded:0,totalSize:0,records:[],isFile:function(k){if(k.size==0){return false
}if(k.size<512&&k.type==""&&k.name.indexOf(".")<0){return false
}return true
},upload:function(q){this.records=[];
for(var n=0;
n<q.length;
n++){var m=q[n];
if(this.isFile(m)){this.totalSize+=m.fileSize;
this.records.push({file:m})
}else{CQ.Notification.notify(m.name,CQ.I18n.getMessage("It is not possible to upload folders"))
}}if(this.records.length==0){return
}this.progress=new CQ.Ext.ProgressBar();
this.mainWin=new CQ.Ext.Window({width:400,title:"File Upload",layout:"anchor",pageX:b.getLeft(),pageY:b.getTop(),closable:false,items:[this.progress]}).show();
var k=this;
var o=new XMLHttpRequest();
o.upload.addEventListener("load",function(r){k.uploaded+=k.currentSize;
k.uploadNext()
},false);
o.upload.addEventListener("progress",function(r){k.progress.updateProgress((k.uploaded+r.loaded)/k.totalSize)
},false);
this.xhr=o;
this.uploadNext()
},finish:function(){this.mainWin.close();
this.mainWin.destroy();
delete this.mainWin;
delete this.progress;
j.call(a,this.records)
},uploadNext:function(){if(this.current>=this.records.length){this.progress.updateProgress(1);
this.finish();
return
}var u=this.records[this.current++];
var n=u.file;
var t=null;
for(var m=0;
m<CQ.EDITBASE_DD_MIMEMAPPING.length;
m++){t=CQ.EDITBASE_DD_MIMEMAPPING[m];
if(n.type.match(t.mimeType)){break
}}if(!t.definition){t.definition=CQ.WCM.getComponentConfig(t.resourceType)
}u.map=t;
if(!a.editComponent.isInsertAllowed(u.map.definition.resourceType)){u.notAllowed=true;
CQ.Notification.notify(u.file.name,CQ.I18n.getMessage("Failed to create paragraph with targeted component {0}{1}",["<br>",u.map.resourceType],"error message; name of the component that has been failed to insert"));
if(this.current>=this.records.length){this.progress.updateProgress(1);
this.finish();
return
}else{this.uploadNext()
}}this.currentSize=n.fileSize;
this.progress.updateProgress(this.uploaded/this.totalSize);
var r="";
if(this.records.length>1){r=" ("+this.current+"/"+this.records.length+")"
}this.progress.updateText("Uploading "+n.name+r);
var k="file"+(new Date).getTime();
var q=a.editComponent.path.replace(/\/\*$/,"");
u.path=q+"/"+k;
if(window.FormData){var o=new FormData();
o.append(k,n);
this.xhr.open("POST",q,true);
this.xhr.send(o)
}else{this.xhr.open("PUT",encodeURI(u.path),true);
this.xhr.send(n)
}}};
return g.upload(c)
},notifyDrop:function(a,g,c){var b;
if(a.notifyDropDT){b=a.notifyDropDT(this,g,c)
}else{b=CQ.wcm.EditBase.DropTarget.superclass.notifyDrop.call(this,a,g,c)
}g.stopEvent();
return b
},notifyEnter:function(a,c,b){if(a.notifyEnterDT){return a.notifyEnterDT(this,c,b)
}else{return CQ.wcm.EditBase.DropTarget.superclass.notifyEnter.call(this,a,c,b)
}},notifyOut:function(a,c,b){if(a.notifyOutDT){return a.notifyOutDT(this,c,b)
}else{return CQ.wcm.EditBase.DropTarget.superclass.notifyOut.call(this,a,c,b)
}},notifyOver:function(a,c,b){if(a.notifyOverDT){return a.notifyOverDT(this,c,b)
}else{return CQ.wcm.EditBase.DropTarget.superclass.notifyOver.call(this,a,c,b)
}},showHighlight:function(){this.highlight.showFrame()
},hideHighlight:function(){this.highlight.hideFrame()
},flash:function(){this.highlight.flash()
},normalize:function(){this.el.stopFx();
this.el.fxQueue=[]
}});
CQ.wcm.EditBase.DropTarget.getInstance=function(g,k,a,b){b=b||{};
if(k){b.editComponent=k
}var j=new CQ.wcm.EditBase.DropTarget(g,b);
if(a){var c=0;
for(;
c<a.length;
c++){j.addToGroup(a[c])
}j.removeFromGroup(CQ.wcm.EditBase.DD_GROUP_DEFAULT)
}return j
};
CQ.wcm.EditBase.referenceParagraph=function(g,a){try{if(CQ.wcm.EditRollover.currentlyHighlighted){CQ.wcm.EditRollover.currentlyHighlighted.hideHighlight()
}var b=CQ.WCM.getComponentConfig(CQ.wcm.EditBase.REFERENCE_COMPONENT);
var j={};
j[CQ.wcm.EditBase.REFERENCE_COMPONENT_PATH_PROPERTY]=g;
return this.createParagraph(b,j,false,false,true,false,a)
}catch(c){CQ.Ext.Msg.alert("",c)
}return null
};
CQ.wcm.EditBase.copyParagraph=function(q,c,o,b){var g=CQ.WCM.getEditable(q);
if(g&&g.fireEvent(CQ.wcm.EditBase.EVENT_BEFORE_COPY,g,this.path)===false){return null
}if(this.isInsertAllowed(c)){try{if(CQ.wcm.EditRollover.currentlyHighlighted){CQ.wcm.EditRollover.currentlyHighlighted.hideHighlight()
}var j=CQ.WCM.getComponentConfig(c);
var k={};
k["./"+CQ.Sling.COPY_SUFFIX]=q;
var a=this.getParentPath()+"/";
if(a&&k["./@CopyFrom"]&&a.indexOf(k["./@CopyFrom"])===0){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Warning"),CQ.I18n.getMessage("Cannot copy ancestor to descendant."));
return null
}var m=this.createParagraph(j,k,false,o,true,false,b);
if(g){g.fireEvent(CQ.wcm.EditBase.EVENT_AFTER_COPY,g,this.path,m)
}return m
}catch(n){CQ.Ext.Msg.alert("",n)
}}return null
};
CQ.wcm.EditBase.moveParagraph=function(t,a,r){var b=CQ.WCM.getEditable(t);
if(b&&b.fireEvent(CQ.wcm.EditBase.EVENT_BEFORE_MOVE,b,this.path)===false){return null
}if(this.isInsertAllowed(a)){try{if(CQ.wcm.EditRollover.currentlyHighlighted){CQ.wcm.EditRollover.currentlyHighlighted.hideHighlight()
}var c=CQ.WCM.getComponentConfig(a);
var j={};
var k=b!=null;
var q=k&&(b.getParent()==this.getParent());
if(k&&q){var g=this.path.substring(this.path.lastIndexOf("/")+1);
if(g=="*"){j[CQ.Sling.ORDER]="last"
}else{j[CQ.Sling.ORDER]="before "+g
}var n=CQ.utils.HTTP.post(t,null,j,this);
if(CQ.utils.HTTP.isOk(n)){if(b){b.fireEvent(CQ.wcm.EditBase.EVENT_AFTER_MOVE,this.path)
}return t
}}else{j["./"+CQ.Sling.MOVE_SUFFIX]=t;
var m=this.createParagraph(c,j,k,r,true,true);
if(m&&k){b.fireEvent(CQ.wcm.EditBase.EVENT_AFTER_MOVE,this.path,m)
}return m
}}catch(o){CQ.Ext.Msg.alert("",o)
}}return null
};
CQ.wcm.EditBase.createParagraph=function(b,D,a,z,n,G,C){var v=null;
try{v=b.virtual?b.virtualResourceType:b.resourceType
}catch(E){return null
}if(b.resourceType&&this.isInsertAllowed(v)){var H={};
if(b.config&&b.config.params){for(var y in b.config.params){H[y]=b.config.params[y]
}}H._charset_="utf-8";
H["./sling:resourceType"]=b.resourceType;
H["./jcr:lastModified"]="";
H["./jcr:lastModifiedBy"]="";
H["./jcr:created"]="";
H["./jcr:createdBy"]="";
var k=H["./sling:resourceType"];
if(k){H[":nameHint"]=k.substring(k.lastIndexOf("/")+1)
}var t=this.getParent();
var q=t?t.getResourceType():"";
if(q){H.parentResourceType=q
}if(D){for(var y in D){H[y]=D[y]
}}if(!n&&b&&b.templatePath){H["./"+CQ.utils.Sling.COPY_SUFFIX]=b.templatePath
}var A=this.path.substring(this.path.lastIndexOf("/")+1);
var c=this.getParentPath()+"/";
H[CQ.utils.Sling.ORDER]=CQ.wcm.EditBase.INSERT_LAST;
if(b.insertBehavior){H[CQ.utils.Sling.ORDER]=b.insertBehavior
}else{if(A!="*"){H[CQ.utils.Sling.ORDER]=CQ.wcm.EditBase.INSERT_BEFORE+" "+A
}}if(A!="*"&&(H[CQ.utils.Sling.ORDER]==CQ.wcm.EditBase.INSERT_BEFORE||H[CQ.utils.Sling.ORDER]==CQ.wcm.EditBase.INSERT_AFTER)){H[CQ.utils.Sling.ORDER]+=" "+A
}if(H[":nameHint"]){var j=CQ.utils.WCM.getPage(CQ.utils.WCM.getPagePath());
if(j&&(j.isLiveCopySource()||j.isLiveCopy())){var w=Math.floor(Math.random()*65535);
var m=w.toString(16);
H[":nameHint"]+="_"+m
}}var u=CQ.utils.HTTP.post(c,null,H,this);
if(CQ.utils.HTTP.isOk(u)&&u.headers){var g=u.headers.Path;
if((G!==true)&&CQ.undo.UndoManager.isEnabled()){var I=CQ.undo.UndoManager.getHistory();
var F=I.createBlobsFromCreateParams(g,D);
var x=(C?C.step:I.createUndoStep(I.createStepConfig()));
x.addUndoAction(new CQ.undo.actions.InsertParagraphAction(I.getIdManager(),g,this.path,{definition:b,extraParams:D,noEvent:a,loadAnnotations:z,ignoreTemplate:n},F));
if(!C){x.commit()
}}if(g&&!a&&t&&t.fireEvent(CQ.wcm.EditBase.EVENT_BEFORE_CHILD_INSERT,t,g)===false){return null
}if(H["./"+CQ.Sling.COPY_SUFFIX]){var B=CQ.WCM.getEditable(H["./"+CQ.Sling.COPY_SUFFIX]);
if(!B||B.enableLiveRelationship){var o={};
o.removeLCMarkers="true";
CQ.utils.HTTP.post(g+".msm.conf",null,o,this)
}}if(g&&!a){this.listenersChecker(b.config);
if(b.config&&b.config.listeners&&b.config.listeners[CQ.wcm.EditBase.EVENT_AFTER_INSERT]){b.config.listeners[CQ.wcm.EditBase.EVENT_AFTER_INSERT].call(this,g,b)
}else{this.refreshCreated(g,b,z)
}if(t){t.fireEvent(CQ.wcm.EditBase.EVENT_AFTER_CHILD_INSERT,t,g)
}}if(this.hideHighlight){CQ.wcm.EditRollover.preventNextHighlight=true
}return g
}}return null
};
CQ.wcm.EditBase.updateParagraph=function(m,t,o,g,b){var j={_charset_:"utf-8"};
if(m.indexOf("$")>=0){if(!CQ.Ext.isArray(t)){t=[t]
}for(var q=0;
q<t.length;
q++){var r=t[q];
var k=m.replace("$",q+1);
j[k]=r;
var n=k.lastIndexOf("/");
if(n!=-1){j[k.substring(0,n)+"/jcr:lastModified"]="";
j[k.substring(0,n)+"/jcr:lastModifiedBy"]=""
}}}else{j[m]=t;
var n=m.lastIndexOf("/");
if(n!=-1){j[m.substring(0,n)+"/jcr:lastModified"]="";
j[m.substring(0,n)+"/jcr:lastModifiedBy"]=""
}}if(o){for(var a in o){j[a]=o[a]
}}j["./jcr:lastModified"]="";
j["./jcr:lastModifiedBy"]="";
var c=this;
CQ.HTTP.post(this.path,function(v,w,u){if(w){if(g&&b){c.success(b,u);
b.fireEvent("actioncomplete",b)
}else{c.fireEvent(CQ.wcm.EditBase.EVENT_AFTER_EDIT,c)
}}else{if(g&&b){b.fireEvent("actionfailed",b)
}}},j);
return true
};
CQ.wcm.EditBase.removeParagraph=function(){if(!CQ.WCM.getSelection().contains(this)){CQ.WCM.deselect()
}var items=[];
var checkUrl="/bin/wcm/references.json";
var sel=CQ.WCM.getSelectedItems();
if(sel.length==0&&this){sel.push(this)
}for(var s=0;
s<sel.length;
s++){if(sel[s].isActionDelete()){items.push(sel[s]);
checkUrl=CQ.HTTP.addParameter(checkUrl,"path",sel[s].path)
}}if(items.length>0){checkUrl=CQ.HTTP.noCaching(checkUrl);
var data=CQ.HTTP.eval(checkUrl);
var numRefs=0;
if(data&&data.pages){for(var i=0;
i<data.pages.length;
i++){try{numRefs+=data.pages[i].references.length
}catch(e){}}}var lockedLiveRelationship=false;
var enableLiveRelationship=false;
for(i=0;
i<items.length;
i++){if(items[i].enableLiveRelationship&&items[i].liveStatusLocked){lockedLiveRelationship=true;
enableLiveRelationship=true;
break
}}var msg=CQ.I18n.getMessage("Do you really want to delete the selected component(s)?");
if(lockedLiveRelationship){msg=CQ.I18n.getMessage("Do you really want to cancel inheritance and delete the selected component(s)?")
}if(numRefs>0){msg=CQ.I18n.getMessage("One or more of the selected components are referenced. Do you really want to delete them?");
if(lockedLiveRelationship){msg=CQ.I18n.getMessage("One or more of the selected components are referenced. Do you really want to cancel inheritance and delete them?")
}}CQ.Ext.Msg.confirm(CQ.I18n.getMessage("Delete Component(s)"),msg,function(btnId){if(btnId=="yes"){var isUndoEnabled=CQ.undo.UndoManager.isEnabled();
var undoHistory=(isUndoEnabled?CQ.undo.UndoManager.getHistory():null);
var undoStep=(isUndoEnabled?undoHistory.createUndoStep(undoHistory.createStepConfig()):null);
var undoData=null;
if(isUndoEnabled){undoData=[];
for(var d=0;
d<items.length;
d++){var parData=CQ.undo.util.UndoUtils.getCurrentData(items[d]);
undoData.push(parData);
var blobs=parData.blobs;
var blobCnt=blobs.length;
for(var b=0;
b<blobCnt;
b++){blobs[b].save(undoHistory.binaryServletUrl,items[d].path)
}}}for(var i=0;
i<items.length;
i++){var item=items[i];
if(item.liveStatusLocked){if(!CQ.wcm.EditBase.switchInheritance(item)){return
}}CQ.wcm.EditBase.doRemoveParagraph(item);
if(isUndoEnabled){undoStep.addUndoAction(new CQ.undo.actions.RemoveParagraphAction(undoHistory.getIdManager(),item.path,undoData[i].insertBefore,undoData[i].data,undoData[i].blobs,undoData[i].compInfo,item.dropTarget,item.hasAnnotations()))
}}if(isUndoEnabled){CQ.undo.util.UndoUtils.sortRemoveParagraphActions(undoStep);
undoStep.commit()
}if(enableLiveRelationship){this.refreshPage()
}}},this)
}};
CQ.wcm.EditBase.doRemoveParagraph=function(b){if(b.fireEvent(CQ.wcm.EditBase.EVENT_BEFORE_DELETE,b)===false){return null
}CQ.WCM.deselect(b);
var a=b.path;
var c={};
c[CQ.Sling.STATUS]=CQ.Sling.STATUS_BROWSER;
c[CQ.Sling.OPERATION]=CQ.Sling.OPERATION_DELETE;
response=CQ.shared.HTTP.post(a,null,c);
if(CQ.utils.HTTP.isOk(response)){b.deleted=true;
b.fireEvent(CQ.wcm.EditBase.EVENT_AFTER_DELETE,b)
}};
CQ.wcm.EditBase.switchInheritance=function(a){var b={};
b[CQ.wcm.msm.MSM.PARAM_STATUS+"/"+CQ.wcm.msm.MSM.PARAM_IS_CANCELLED]=a.liveStatusLocked;
b[CQ.wcm.msm.MSM.PARAM_STATUS+"/"+CQ.wcm.msm.MSM.PARAM_IS_CANCELLED_FOR_CHILDREN]=!a.isContainer;
var c=CQ.utils.HTTP.post(a.path+".msm.conf",null,b,a);
if(CQ.utils.HTTP.isOk(c)){a.liveStatusLocked=!a.liveStatusLocked;
return true
}else{return false
}};
CQ.wcm.EditBase.refreshCreated=function(u,k,v){if(u&&k&&k.resourceType){var n=CQ.HTTP.externalize(u+"."+CQ.shared.HTTP.getSelectors()+".html");
if(CQ.Ext.isIE){n=CQ.HTTP.noCaching(n)
}var a=CQ.HTTP.get(n);
if(CQ.HTTP.isOk(a)){if(this.hideHighlight){this.hideHighlight()
}if(CQ.wcm.EditRollover.currentlyHighlighted){CQ.wcm.EditRollover.currentlyHighlighted.hideHighlight()
}CQ.WCM.deselect();
if(!k.config){k.config={}
}var m=a.body;
var z="";
if(k.divAttributes){if(k.divAttributes["class"]){k.divAttributes["class"]="section "+k.divAttributes["class"]
}else{k.divAttributes["class"]="section"
}}else{k.divAttributes={};
k.divAttributes["class"]="section"
}var j="";
if(CQ.Ext.isIE&&m.toLowerCase().indexOf("<script")!=-1){j=this.IEScriptInsert
}if(k.config.isContained===true){var b=(k.containerClass?k.containerClass:"section");
z=j+"<div class='"+b+"'><div"
}else{z=j+"<div"
}if(k.divAttributes){for(var w in k.divAttributes){z+=" "+w+'="'+k.divAttributes[w]+'"'
}}z+=">";
m=z+m+"</div>";
if(k.config.isContained===false){m+="</div>"
}CQ.utils.WCM.startMakeEditablesQueue();
var x=this.placeholder?this.placeholder:this.element;
var g;
if(this.isContained){var y=CQ.Ext.DomHelper.insertBefore(x.parent(),m);
if(k.config.isContained===false){g=y.firstChild
}else{g=y
}}else{g=CQ.Ext.DomHelper.insertBefore(x,m)
}if(!CQ.Ext.isGecko2){CQ.DOM.executeScripts(CQ.Ext.get(g))
}var o={path:u,type:k.resourceType,dialog:k.dialog,isContainer:!!k.isContainer,editConfig:CQ.Util.copyObject(k.config),element:g,listeners:{ready:function(){var D=CQ.utils.WCM.getEditable(o.path);
var B=CQ.WCM.getNestedEditables(D.path);
if(B.length>0){CQ.WCM.getPageInfo(CQ.WCM.getPagePath(),true)
}D.show();
if(v){D.loadAnnotations()
}if(CQ.Ext.isIE||CQ.Ext.isSafari){CQ.DOM.executeScripts(D.element)
}var A=D.element.dom.getElementsByTagName("img");
for(var C=0;
C<A.length;
C++){A[C].src=CQ.HTTP.noCaching(A[C].src)
}CQ.Util.runComponentObservation()
}}};
if(k.cellNames){var q=u.substring(0,u.lastIndexOf("/"));
var r=CQ.WCM.getEditable(q);
if(r){var c=r.getCell();
if(c){var t=r.getCell().getSearchExpression();
t+="/"+k.cellNames.join("|");
o.csp=t
}}}CQ.WCM.edit(o);
CQ.utils.WCM.endMakeEditablesQueue()
}}};
CQ.wcm.EditBase.refreshSelf=function(){this.refresh()
};
CQ.wcm.EditBase.refreshSelfMoved=function(g,b){var c=CQ.WCM.getEditable(g);
var a=c.placeholder?c.placeholder:c.element;
if(c.isContained){this.insertBefore(a.parent())
}else{this.insertBefore(a)
}if(b){CQ.WCM.unregisterEditable(this.path);
this.path=b;
CQ.WCM.getEditables()[b]=this
}CQ.Util.runComponentObservation()
};
CQ.wcm.EditBase.refreshParent=function(){try{var a=this.getParent();
if(a){this.getParent().refresh();
return
}}catch(b){}CQ.wcm.EditBase.refreshPage()
};
CQ.wcm.EditBase.refreshPage=function(){CQ.Util.reload(CQ.WCM.getContentWindow())
};
CQ.wcm.EditBase.initRefreshShortcuts=function(){this.REFRESH_SHORTCUTS={REFRESH_PAGE:function(){this.refreshPage()
},REFRESH_SELF:function(){this.refreshSelf()
},REFRESH_PARENT:function(){this.refreshParent()
},REFRESH_SELFMOVED:function(a){this.refreshSelfMoved(a)
},REFRESH_INSERTED:function(b,a){this.refreshCreated(b,a)
}}
};
CQ.wcm.EditBar=CQ.Ext.extend(CQ.Ext.Panel,{placeholder:null,selectBox:null,annotationOffset:5,ready:false,moreButton:null,moreMenu:null,constructor:function(a){this.dragZoneClass=CQ.wcm.EditBase.DragZone;
this.dropTargetClass=CQ.wcm.EditBase.DropTarget;
this.constructorStart(a);
var b=this;
this.selectBox=new CQ.Ext.form.Checkbox({boxLabel:CQ.I18n.getMessage("{0} checkbox",["Edit bar"],"Label of edit bar checkbox"),hideLabel:true,listeners:{check:function(c,g){if(g){CQ.WCM.select(b,true)
}else{CQ.WCM.deselect(b,true)
}}}});
this.applyConfigDefaults(a,{renderTo:CQ.Util.ROOT_ID,element:null,path:"",actions:CQ.wcm.EditBase.EDITANNOTATE,childConfig:{actions:CQ.wcm.EditBase.EDITANNOTATECOPYMOVEDELETEINSERT},container:"toolbar",ctrlDef:"button",toolbar:{xtype:"toolbar"},button:{xtype:"button",scope:this},orderable:true,listeners:{afteredit:this.refreshSelf,afterdelete:this.refreshSelf,afterinsert:this.refreshCreated,aftermove:this.refreshSelfMoved},stateful:false,inlineEditing:CQ.wcm.EditBase.INLINE_MODE_AUTO,targetMode:CQ.wcm.EditBase.TARGET_MODE_GHOST,isDropTarget:true,isContained:false,containerClass:"section",cls:"cq-editbar",hideMode:"display"});
if(CQ.WCM.isEditMode()){a.toolbar.items.push("->");
a.toolbar.items.push(this.selectBox);
a.toolbar.items.push("&nbsp;")
}CQ.wcm.EditBar.superclass.constructor.call(this,a);
if(a.element){this.el.setStyle("visibility","hidden");
this.buildPlaceholderAndElement.defer(16,this,[a.element]);
this.element=CQ.Ext.get(this.element)
}this.constructorEnd(a)
},initComponent:function(){CQ.wcm.EditBar.superclass.initComponent.call(this);
this.addEvents(CQ.wcm.EditBase.EVENT_BEFORE_EDIT,CQ.wcm.EditBase.EVENT_AFTER_EDIT,CQ.wcm.EditBase.EVENT_BEFORE_DELETE,CQ.wcm.EditBase.EVENT_AFTER_DELETE,CQ.wcm.EditBase.EVENT_AFTER_INSERT,CQ.wcm.EditBase.EVENT_BEFORE_MOVE,CQ.wcm.EditBase.EVENT_AFTER_MOVE,CQ.wcm.EditBase.EVENT_BEFORE_COPY,CQ.wcm.EditBase.EVENT_AFTER_COPY,CQ.wcm.EditBase.EVENT_BEFORE_CHILD_INSERT,CQ.wcm.EditBase.EVENT_AFTER_CHILD_INSERT,CQ.wcm.EditBase.EVENT_READY);
this.on("render",function(){if(!this.isActionDelete()&&!this.isActionCopyMove()){this.orderable=false
}if(this[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP]!=null){if(this.isActionEdit()||this.isActionDelete()){this.handleLiveRelationship()
}}if(this.isActionInsertOnly()){var b=this.getParent();
if(b&&b.handleLiveRelationship){b.handleLiveRelationship(true)
}}if(this.orderable){this.dd=this.dragZoneClass.getInstance(this.el,this,[CQ.wcm.EditBase.DD_GROUP_COMPONENT])
}var a=CQ.WCM.getSelection();
a.on("clear",this.handleSelectionClear,this)
});
this.setBoxLabel();
this.initComponentEnd()
},handleSelectionClear:function(){this.selectBox.setValue(false)
},handleMouseOver:function(a){if(!CQ.Ext.dd.DragDropMgr.dragCurrent&&!CQ.WCM.isContentWindowLoading()){if(!CQ.wcm.EditRollover.currentlyHighlighted){if(CQ.wcm.EditRollover.preventNextHighlight){CQ.wcm.EditRollover.preventNextHighlight=false
}else{}}else{if(this.isParentHighlighted()){CQ.wcm.EditRollover.currentlyHighlighted.hideHighlight()
}else{if(CQ.wcm.EditRollover.currentlyHighlighted!==this){}}}}a.stopEvent()
},buildPlaceholderAndElement:function(k){if(k){this.element=CQ.Ext.get(k);
this.el.addClass(this.getClsPath("cq-element"))
}this.element.setVisibilityMode(CQ.Ext.Element.DISPLAY);
this.getEl().setVisibilityMode(CQ.Ext.Element.DISPLAY);
if(this.isContained){this.element.parent().setVisibilityMode(CQ.Ext.Element.DISPLAY)
}if(this.placeholder){this.placeholder.remove()
}if(!this.hidden&&!this.disabled){this.element.linkedEditComponent=this;
var g=this.element.getWidth();
if(g==0){if(this.isContained){if(this.element.parent()){if(this.element.parent().parent()){g=this.element.parent().parent().getWidth()
}else{g=this.element.parent().getWidth()
}}}else{if(this.element.parent()){g=this.element.parent().getWidth()
}}}var c='<div class="'+this.getClsPath("cq-placeholder")+'"></div>';
var b=CQ.DOM.getBlockDefaultStyles();
if(!this.placeholder){if(this.element.dom&&(this.element.dom.tagName=="TBODY"||this.element.dom.tagName=="THEAD"||this.element.dom.tagName=="TFOOT"||this.element.dom.tagName=="TR"||this.element.dom.tagName=="TD")){var j=this.element.parent("TABLE");
this.placeholder=CQ.Ext.DomHelper.insertBefore(j,c,true)
}else{this.placeholder=CQ.Ext.DomHelper.insertBefore(this.element,c,true)
}}var a=CQ.Util.applyDefaults({height:this.el.getHeight()+"px",width:g+"px"},b);
this.placeholder.setStyle(a);
this.placeholder.setVisibilityMode(CQ.Ext.Element.DISPLAY);
this.placeholder.addClass(["cq-editcomponent-placeholder","cq-editbar-placeholder"]);
this.initialPlaceholderHeight=this.el.getHeight();
CQ.Util.observeComponent(this);
this.el.setStyle("position","absolute");
this.el.anchorTo(this.placeholder,"tl",null,false,null);
this.el.setStyle("width",g+"px");
this.renderLiveStatus();
this.manageMoreMenu();
if(this.isDropTarget===true&&(this.isActionInsert()||this.getTargetParent())){this.componentDropTarget=this.dropTargetClass.getInstance(this.placeholder,this,[CQ.wcm.EditBase.DD_GROUP_COMPONENT]);
this.elementDropTarget=this.dropTargetClass.getInstance(this.element,this,[CQ.wcm.EditBase.DD_GROUP_COMPONENT])
}this.element.on("mouseover",this.handleMouseOver,this);
this.buildSubDropTargets()
}this.el.setStyle("visibility","visible");
this.ready=true;
this.fireEvent(CQ.wcm.EditBase.EVENT_READY,this)
},handleLiveStatus:function(){if(this.enableLiveRelationship){if(this.liveStatus){var a=this.liveStatusLocked?"cq-editbar-livestatus-right-lock":"cq-editbar-livestatus-right-unlock";
this.liveStatus.setIconClass(a)
}}},observeLiveStatus:function(){if(this.liveStatusRendered&&this.enableLiveRelationship){if(this.liveStatusLocked){this.suspendSubDropTargets()
}else{this.resumeSubDropTargets()
}}},renderLiveStatus:function(){if(!this.liveStatusRendered&&this.enableLiveRelationship){if(this.isActionEdit()||this.isActionDelete()){var k=this.items.items[0];
if(k){var b=this;
var g=null;
var a="cq-editbar-livestatus-right-unlock";
var j=CQ.I18n.getMessage("Inheritance is broken at the page or parent level");
if(this[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP][CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_EDITABLE]){a=this.liveStatusLocked?"cq-editbar-livestatus-right-lock":"cq-editbar-livestatus-right-unlock";
g=function(){b.switchLock()
};
j=CQ.I18n.getMessage("Click to toggle Live Copy inheritance")
}var c=k.items.length;
if(k.items.length>2){c=k.items.length-2
}this.liveStatus=k.insertButton(c,{iconCls:a,handler:g,tooltip:j});
this.doLayout()
}this.liveStatusRendered=true
}}},manageMoreMenu:function(){var t=this.el.getWidth();
var c=this.items.items[0];
for(var g=0;
g<c.items.length;
g++){c.getComponent(g).show()
}if(this.moreButton){this.moreButton.hide()
}var b=t+this.el.getXY()[0];
var o=c.getComponent(c.items.length-((CQ.WCM.isEditMode()||this.moreButton==null)?1:2));
if(b<o.getPosition()[0]+o.getWidth()){var k;
if(CQ.WCM.isEditMode()){k=c.items.length-(this.liveStatusRendered?4:3);
for(var g=k+1;
g<c.items.length;
g++){var r=c.getComponent(g);
b-=r.getWidth()
}k=k-(this.moreButton?1:0)
}else{k=c.items.length-(this.moreButton?1:0)
}b-=20;
var q=false;
var j=true;
if(this.moreMenu==null){this.moreMenu=new CQ.Ext.menu.Menu()
}for(var g=0;
g<k;
g++){var r=c.getComponent(g);
var m=CQ.Util.copyObject(r.initialConfig);
try{if(!q&&b<r.getPosition()[0]+r.getWidth()){q=true
}}catch(n){}var a=false;
if(m.xtype=="text"||m.xtype=="tbtext"){m.xtype="titleseparator";
m.title=m.text
}else{if(m.xtype=="button"||m.xtype=="tbbutton"||m.xtype=="splitbutton"||m.xtype=="tbsplitbutton"){delete m.xtype
}else{if(m.xtype=="tbseparator"){a=true
}else{a=true
}}}if(this.moreButton==null){if(a){r.menuItem=this.moreMenu.addSeparator()
}else{r.menuItem=this.moreMenu.addMenuItem(m)
}}if(q){r.hide();
if(a&&j){r.menuItem.hide()
}else{if(r.menuItem){r.menuItem.show()
}j=false
}}else{if(r.menuItem){r.menuItem.hide()
}}}if(this.moreButton==null){this.moreButton=c.insertButton(k,{text:'<span style="font-size:1px;">&nbsp;</span>',menu:this.moreMenu})
}else{if(q){this.moreButton.show()
}}this.doLayout()
}},observeWidth:function(){if(!this.ready){return
}var a=this.el.getWidth();
var b=this.element.getWidth();
if(b!=0&&a!=b){this.el.setStyle("width",b+"px");
this.manageMoreMenu()
}},observe:function(){this.observeLiveStatus();
this.observeElementPosition();
if(!CQ.Util.isEqualPosition(this.el.getXY(),this.placeholder.getXY(),1)){this.el.alignTo(this.placeholder,"tl-tl")
}this.observeWidth()
},getNewAnnotationOffset:function(){this.annotationOffset+=15;
return[this.annotationOffset,this.annotationOffset]
},show:function(g){if(this.placeholder){this.placeholder.setVisible(true);
this.placeholder.show()
}this.getEl().show();
CQ.WCM.showPlaceholders(this.element);
this.resumeDropTargets();
if(g!==true){var a=CQ.WCM.getNestedEditables(this.path);
for(var c=0;
c<a.length;
c++){var b=CQ.WCM.getEditable(a[c]);
if(b){b.show(true)
}}}this.showAnnotations();
return this
},hide:function(g){if(g!==true){var a=CQ.WCM.getNestedEditables(this.path);
for(var c=0;
c<a.length;
c++){var b=CQ.WCM.getEditable(a[c]);
if(b){b.hide(true)
}}}this.suspendDropTargets();
this.getEl().hide();
if(this.placeholder){this.placeholder.setVisible(false)
}CQ.WCM.hidePlaceholders(this.element);
this.hideAnnotations();
return this
},convertAction:function(a){if(a!=null){if(typeof a=="string"){var b=CQ.wcm.EditBar.ActionsConvertor[a];
if(b!=null){if(typeof b=="string"){if(b.length>0){return b
}else{return null
}}else{return b
}}}else{if(a.xtype){if(CQ.wcm.EditBar.MenuXTypesToTBActions[a.xtype]!=null){return this.convertAction(CQ.wcm.EditBar.MenuXTypesToTBActions[a.xtype])
}}else{if(a.handler||a.listeners){return a
}else{return CQ.Util.applyDefaults(a,{xtype:"tbtext"})
}}}}return a
},disableDrag:function(){if(this.dd){this.dd.lock()
}},enableDrag:function(){if(this.dd){this.dd.unlock()
}},hideElement:function(b,j){if(j!==true){var a=CQ.WCM.getNestedEditables(this.path);
for(var g=0;
g<a.length;
g++){var c=CQ.WCM.getEditable(a[g]);
if(c){c.hide(true);
c.hideElement(false,true)
}}}this.element.hide();
if(b!==true&&this.isContained){this.element.parent().hide(true)
}},showElement:function(g){if(this.isContained){this.element.parent().show()
}this.element.show();
if(g!==true){var a=CQ.WCM.getNestedEditables(this.path);
for(var c=0;
c<a.length;
c++){var b=CQ.WCM.getEditable(a[c]);
if(b){b.showElement(true);
b.show(true)
}}}},refreshComponent:function(){if(this.placeholder){this.placeholder.setHeight(this.initialPlaceholderHeight);
this.placeholder.show()
}},getInlinePlaceholder:function(){return this.placeholder
},getInlinePlaceholderInitialHeight:function(){return this.initialPlaceholderHeight
},remove:function(g){if(g!==true){var a=CQ.WCM.getNestedEditables(this.path);
for(var c=0;
c<a.length;
c++){var b=CQ.WCM.getEditable(a[c]);
if(b){b.remove(true)
}}}this.removeDropTargets();
CQ.WCM.deselect(this);
this.removeSelectionListeners();
this.removeClipboardListeners();
CQ.WCM.unregisterDialog("editdialog-"+this.path);
CQ.WCM.unregisterDialog("insertdialog-"+this.path);
CQ.WCM.unregisterEditable(this.path);
CQ.Util.cancelObservation(this);
this.clearListeners();
CQ.Ext.ComponentMgr.unregister(this);
if(this.placeholder){CQ.Ext.destroy(this.placeholder);
CQ.Ext.ComponentMgr.unregister(this.placeholder);
delete this.placeholder
}if(this.selectBox){CQ.Ext.destroy(this.selectBox);
CQ.Ext.ComponentMgr.unregister(this.selectBox);
delete this.selectBox
}this.removeAnnotations();
CQ.Ext.destroy(this.element);
CQ.Ext.ComponentMgr.unregister(this.element);
delete this.element;
this.el.removeAllListeners();
this.destroy();
this.purgeListeners()
},clearListeners:function(){var a=CQ.WCM.getSelection();
a.un("clear",this.handleSelectionClear,this);
this.element.un("mouseover",this.handleMouseOver,this)
},setBoxLabel:function(){var a="";
if(this.actions&&this.actions.length>0&&this.actions[0].xtype=="tbtext"&&this.actions[0].text!=""){a=this.actions[0].text.replace(/(?:<.*?>)/ig,"")+" "
}this.selectBox.boxLabel=CQ.I18n.getMessage("{0}edit bar checkbox",[a],"Label of edit bar checkbox")
}});
CQ.Ext.reg("editbar",CQ.wcm.EditBar);
CQ.Ext.override(CQ.wcm.EditBar,CQ.wcm.EditBase);
CQ.wcm.EditBar.ActionsConvertor=new Array;
CQ.wcm.EditBar.ActionsConvertor.separator={xtype:"tbseparator"};
CQ.wcm.EditBar.ActionsConvertor["-"]=CQ.wcm.EditBar.ActionsConvertor.separator;
CQ.wcm.EditBar.ActionsConvertor.spacer={xtype:"tbspacer"};
CQ.wcm.EditBar.ActionsConvertor[" "]=CQ.wcm.EditBar.ActionsConvertor.spacer;
CQ.wcm.EditBar.ActionsConvertor.fill={xtype:"tbfill"};
CQ.wcm.EditBar.ActionsConvertor["->"]=CQ.wcm.EditBar.ActionsConvertor.fill;
CQ.wcm.EditBar.MenuXTypesToTBActions=new Array;
CQ.wcm.EditBar.DisabledDragZone=CQ.Ext.extend(CQ.Ext.dd.DragZone,{constructor:function(c,b){b=b||{};
var a=document.createElement("div");
CQ.Ext.fly(a).addClass("cq-editrollover-livestatus-disabled");
a.innerHTML=CQ.I18n.getMessage("Fixed Component");
CQ.Ext.apply(b,{ddel:a,ddGroup:"match_nothing"});
CQ.wcm.EditBar.DisabledDragZone.superclass.constructor.call(this,c,b)
},getDragData:function(a){return this
},getRepairXY:function(b,a){return null
}});
CQ.wcm.EditBar.DisabledDragZone.getInstance=function(a){return new CQ.wcm.EditBar.DisabledDragZone(a,{})
};
CQ.wcm.EditRollover=CQ.Ext.extend(CQ.Ext.Component,{isEmpty:false,selected:false,editText:null,deleteText:null,insertText:null,emptyText:null,enableInsertOnlyText:true,enableHighLight:null,enableHighlight:null,enableContextMenu:null,enableEditOnDblClick:null,selectable:false,animateShow:null,animateHide:null,inactiveMode:null,highlight:null,elementPlaceholder:null,emptyComponent:null,contextMenuXY:null,ready:false,constructor:function(a){if(a.enableHighLight){a.enableHighlight=a.enableHighLight;
delete a.enableHighLight
}this.dragZoneClass=CQ.wcm.EditRollover.DragZone;
this.dropTargetClass=CQ.wcm.EditRollover.DropTarget;
this.constructorStart(a);
this.applyConfigDefaults(a,{renderTo:CQ.Util.ROOT_ID,element:null,path:"",actions:CQ.wcm.EditBase.EDITANNOTATE,childConfig:{actions:CQ.wcm.EditBase.EDITANNOTATECOPYMOVEDELETEINSERT},container:"menu",ctrlDef:"menuitem",menu:{},menuitem:{},listeners:{afteredit:this.refreshSelf,afterdelete:this.refreshSelf,afterinsert:this.refreshCreated,aftermove:this.refreshSelfMoved},stateful:false,inlineEditing:CQ.wcm.EditBase.INLINE_MODE_AUTO,targetMode:CQ.wcm.EditBase.TARGET_MODE_GHOST,orderable:true,enableInsertOnlyText:true,isDropTarget:true,enableHighlight:true,enableContextMenu:true,enableEditOnDblClick:true,selectable:true,animateShow:true,animateHide:false,isContained:false,containerClass:"section"});
if(a.inactiveMode){a.isDropTarget=false;
a.orderable=false;
a.enableHighlight=false;
a.enableContextMenu=false;
a.enableEditOnDblClick=false;
a.selectable=false
}delete a.style;
CQ.wcm.EditRollover.superclass.constructor.call(this,a);
this.el=this.element=CQ.Ext.get(this.element);
this.el.addClass(this.getClsPath("cq-element"));
var b=this.element.first("iframe");
if(b){this.element.setHeight(this.element.getHeight()+b.getHeight())
}this.buildElement.defer(16,this);
this.constructorEnd(a)
},initComponent:function(){CQ.wcm.EditRollover.superclass.initComponent.call(this);
this.addEvents(CQ.wcm.EditBase.EVENT_BEFORE_EDIT,CQ.wcm.EditBase.EVENT_AFTER_EDIT,CQ.wcm.EditBase.EVENT_BEFORE_DELETE,CQ.wcm.EditBase.EVENT_AFTER_DELETE,CQ.wcm.EditBase.EVENT_AFTER_INSERT,CQ.wcm.EditBase.EVENT_BEFORE_MOVE,CQ.wcm.EditBase.EVENT_AFTER_MOVE,CQ.wcm.EditBase.EVENT_BEFORE_COPY,CQ.wcm.EditBase.EVENT_AFTER_COPY,CQ.wcm.EditBase.EVENT_BEFORE_CHILD_INSERT,CQ.wcm.EditBase.EVENT_AFTER_CHILD_INSERT,CQ.wcm.EditBase.EVENT_READY,CQ.wcm.EditRollover.EVENT_SHOW_HIGHTLIGHT,CQ.wcm.EditRollover.EVENT_HIDE_HIGHTLIGHT);
this.on("render",function(){CQ.Timing.stamp("Start rendering rollover","EditRollover#onRender",true);
if(!this.isActionDelete()&&!this.isActionCopyMove()){this.orderable=false
}this.highlight=new CQ.wcm.EditRollover.Highlight();
this.inplaceEditHighlight=new CQ.wcm.EditRollover.Highlight();
this.inplaceEditHighlight.addClass("cq-editrollover-inplaceediting");
if(this[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP]!=null){if(this.enableHighlight&&(this.isActionEdit()||this.isActionDelete())){this.handleLiveRelationship()
}}if(this.isActionInsertOnly()){var b=this.getParent();
if(b&&b.handleLiveRelationship){b.handleLiveRelationship(true)
}}var a=CQ.WCM.getSelection();
a.on("add",this.handleSelect,this);
a.on("remove",this.handleDeselect,this);
a.on("clear",this.handleSelectionClear,this);
CQ.Timing.stamp("Completed rendering rollover","EditRollover#onRender")
});
this.initComponentEnd()
},buildElement:function(){this.clearListeners();
if(this.emptyComponent){this.emptyComponent.hide()
}if(this.elementPlaceholder){this.elementPlaceholder.hide()
}if(this.placeholder){this.placeholder.hide()
}if(!this.hidden&&!this.disabled){var g='<div class="'+this.getClsPath("cq-placeholder")+'"></div>';
var b=CQ.DOM.getBlockDefaultStyles();
var j,a;
var k=this.element.getWidth();
this.element.setVisibilityMode(CQ.Ext.Element.DISPLAY);
if(this.isContained){this.element.parent().setVisibilityMode(CQ.Ext.Element.DISPLAY)
}this.elementHidden=false;
if(!this.placeholder){if(this.element.dom&&(this.element.dom.tagName=="TBODY"||this.element.dom.tagName=="THEAD"||this.element.dom.tagName=="TFOOT"||this.element.dom.tagName=="TR"||this.element.dom.tagName=="TD")){var m=this.element.parent("TABLE");
this.placeholder=CQ.Ext.DomHelper.insertBefore(m,g,true)
}else{this.placeholder=CQ.Ext.DomHelper.insertBefore(this.element,g,true)
}}if(CQ.Ext.isIE6){a=CQ.Util.applyDefaults({width:k+"px",height:"0px","line-height":"0px","font-size":"0px"},b)
}else{a=CQ.Util.applyDefaults({width:k+"px",height:"0"},b)
}this.placeholder.setStyle(a);
this.placeholder.setVisibilityMode(CQ.Ext.Element.DISPLAY);
this.placeholder.show();
var c=this.getTargetParent()&&this.getParent()&&this.getParent().isContainer&&(this.getResourceType()==CQ.wcm.EditBase.PARSYS_NEW);
if(this.isActionInsertOnly()||this.isEmpty||c){j=(this.enableInsertOnlyText?CQ.themes.wcm.EditRollover.ELEMENT_MIN_HEIGHT:CQ.themes.wcm.EditRollover.ELEMENT_NO_TEXT_MIN_HEIGHT);
if(!this.elementPlaceholder){this.elementPlaceholder=this.element.insertHtml("beforeEnd",g,true)
}a=CQ.Util.applyDefaults({height:j+"px",width:k+"px"},b);
this.elementPlaceholder.setStyle(a);
this.elementPlaceholder.setVisibilityMode(CQ.Ext.Element.DISPLAY);
var n=this.emptyText?this.emptyText:CQ.I18n.getMessage("Drag components or assets here");
if(!this.emptyComponent){this.emptyComponent=new CQ.Ext.Container({autoEl:"div",cls:"cq-editrollover-insert-container",hideMode:"display",renderTo:CQ.Util.ROOT_ID});
if(this.enableInsertOnlyText){this.emptyComponent.add(new CQ.Static({text:n,cls:"cq-editrollover-insert-message",tag:"span"}))
}this.emptyComponent.doLayout()
}else{if(this.enableInsertOnlyText){this.emptyComponent.items.items[0].text=n
}}this.emptyComponent.setWidth(k);
this.emptyComponent.setHeight(j);
this.emptyComponent.el.setStyle("position","absolute");
this.emptyComponent.el.anchorTo(this.elementPlaceholder,"tl",null,false,null);
if(this.enableContextMenu){this.emptyComponent.el.on("contextmenu",this.handleContextMenu,this)
}if(this.enableHighlight&&!((this.isActionInsertOnly()||this.isEmpty)&&!this.enableInsertOnlyText)){this.emptyComponent.el.on("mouseover",this.handleMouseOver,this)
}if(this.selectable){this.emptyComponent.el.on("click",this.handleClick,this)
}if(this.enableEditOnDblClick&&(this.isActionInsertOnly()||this.isActionEdit())){this.emptyComponent.el.on("dblclick",this.handleDblClick,this)
}this.elementPlaceholder.show();
this.emptyComponent.show()
}this.element.linkedEditComponent=this;
if(this.enableContextMenu){this.addElementEventListener(this.element.dom,"contextmenu",this.handleContextMenu,true,this)
}if(this.enableHighlight&&!((this.isActionInsertOnly()||this.isEmpty)&&!this.enableInsertOnlyText)){this.element.on("mouseover",this.handleMouseOver,this)
}if(this.selectable){this.element.on("click",this.handleClick,this)
}if(this.enableEditOnDblClick&&(this.isActionInsertOnly()||this.isActionEdit())){this.element.on("dblclick",this.handleDblClick,this)
}if(this.isDropTarget===true&&this.isActionInsert()){this.elementDropTarget=this.dropTargetClass.getInstance(this.element,this,[CQ.wcm.EditBase.DD_GROUP_COMPONENT]);
this.componentDropTarget=this.elementDropTarget
}this.buildSubDropTargets()
}this.ready=true;
this.fireEvent(CQ.wcm.EditBase.EVENT_READY,this);
CQ.Util.observeComponent(this)
},handleLiveStatus:function(){if(this.enableLiveRelationship&&this.liveStatus){if(CQ.WCM.isShownLayer(CQ.utils.WCM.LAYER_LCSTATUS)&&!this.hidden&&!this.disabled&&!this.elementHidden){this.liveStatus.showFrames(this,this.liveStatusLocked)
}else{this.liveStatus.hideFrames()
}}},observeLiveStatus:function(){if(this.enableLiveRelationship){if(this.liveStatusLocked){this.suspendSubDropTargets()
}else{this.resumeSubDropTargets()
}if(!this.liveStatusRendered){this.liveStatus=new CQ.wcm.EditRollover.LiveStatus(this.liveStatusContainerMode);
var a=this;
if(this[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP][CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_EDITABLE]){this.liveStatus.frameRight.on("render",function(){this.getEl().on("click",a.switchLock,a)
},this.liveStatus.frameRight)
}else{this.liveStatus.frameRight.on("render",function(){this.getEl().dom.title=CQ.I18n.getMessage("Inheritance is broken at the page or parent level")
},this.liveStatus.frameRight)
}this.liveStatusRendered=true
}this.handleLiveStatus()
}},observe:function(){var a,b;
this.observeLiveStatus();
this.observeElementPosition();
if(!this.hidden&&!this.disabled&&!this.elementHidden){if(this.elementPlaceholder&&this.elementPlaceholder.getHeight()==0){this.buildElement()
}else{if(this.isActionInsertOnly()||this.isEmpty){a=this.element.getWidth();
b=(this.enableInsertOnlyText?CQ.themes.wcm.EditRollover.ELEMENT_MIN_HEIGHT:CQ.themes.wcm.EditRollover.ELEMENT_NO_TEXT_MIN_HEIGHT);
if(this.elementPlaceholder){if(this.elementPlaceholder.getWidth()!=a){this.elementPlaceholder.setWidth(a)
}if(this.elementPlaceholder.getHeight()!=b){this.elementPlaceholder.setHeight(b)
}}if(this.emptyComponent){if(this.emptyComponent.el.getWidth()!=a){this.emptyComponent.setWidth(a)
}if(this.emptyComponent.el.getHeight()!=b){this.emptyComponent.setHeight(b)
}if(!CQ.Util.isEqualPosition(this.emptyComponent.el.getXY(),this.elementPlaceholder.getXY(),1)){this.emptyComponent.el.alignTo(this.elementPlaceholder,"tl-tl")
}}}else{if(this.emptyComponent){if(this.emptyComponent.el.getWidth()!=a){this.emptyComponent.setWidth(a)
}if(this.emptyComponent.el.getHeight()!=b){this.emptyComponent.setHeight(b)
}if(!CQ.Util.isEqualPosition(this.emptyComponent.el.getXY(),this.elementPlaceholder.getXY(),1)){this.emptyComponent.el.alignTo(this.elementPlaceholder,"tl-tl")
}}}}}},handleContextMenu:function(b){if(b.altKey){return
}if(window.CQ_inplaceEditComp){return
}CQ.WCM.select(this,b.shiftKey||b.ctrlKey,true);
var a=this.element.linkedEditComponent;
if(a&&a.menu){a.showHighlight();
if(!a.menuComponent){a.menuComponent=new CQ.Ext.menu.Menu({defaults:{scope:a},items:a.menu.items})
}this.contextMenuXY=b.getXY();
a.menuComponent.showAt(this.contextMenuXY);
b.stopEvent()
}},getNewAnnotationOffset:function(){return[this.contextMenuXY[0]-this.element.getXY()[0],this.contextMenuXY[1]-this.element.getXY()[1]]
},handleWindowResize:function(){this.hideHighlight()
},handleClick:function(c){if(window.CQ_inplaceEditComp){if(window.CQ_inplaceEditComp==this){return
}window.CQ_inplaceEditComp.finishInplaceEditing()
}if(CQ.wcm.EditRollover.currentlyHighlighted===this){this.asyncSingleClick=true;
var b=this.selected;
(function(){this.handleClickAsync(b)
}).defer(1,this);
var a=c.shiftKey||c.ctrlKey;
if(!this.isActionCopyMove()&&!this.isActionDelete()&&!this.isActionInsert()){if(a){CQ.DOM.clearDocumentSelection(CQ.WCM.getContentWindow())
}return
}if(this.selected){if(a){CQ.WCM.deselect(this,true)
}else{CQ.WCM.select(this,false,true)
}}else{CQ.WCM.select(this,a,true)
}}},handleClickAsync:function(a){if(this.asyncSingleClick){if(a){if(!this.liveStatusLocked){this.startInplaceEditing()
}}}this.asyncSingleClick=false
},_startInplaceEditing:function(){this.inplaceEditor.addRepositionListener(function(){this.inplaceEditHighlight.showFrames(this)
}.createDelegate(this));
this.inplaceEditor.addResizeListener(function(){this.inplaceEditHighlight.adjustHighlightSize(this)
}.createDelegate(this));
this.inplaceEditHighlight.showFrames(this)
},_resetInplaceEditing:function(){this.inplaceEditor.removeAllResizeListeners();
this.inplaceEditHighlight.hideFrames(this);
this.on(CQ.wcm.EditBase.EVENT_AFTER_EDIT,function(a){CQ.wcm.EditRollover.preventNextHighlight=false
},this,{single:true})
},_finishInplaceEditing:function(){this._resetInplaceEditing()
},_cancelInplaceEditing:function(){this._resetInplaceEditing()
},handleDblClick:function(a){this.asyncSingleClick=false;
if(window.CQ_inplaceEditComp==this){return
}if(this.isActionEdit()){CQ.wcm.EditBase.showDialog(this,CQ.wcm.EditBase.EDIT)
}else{if(this.isActionInsert()){CQ.wcm.EditBase.showDialog(this,CQ.wcm.EditBase.INSERT)
}}a.stopEvent()
},handleMouseOver:function(a){if(!CQ.Ext.dd.DragDropMgr.dragCurrent&&!CQ.WCM.isContentWindowLoading()){if(window.CQ_inplaceEditComp!=null){this.hideHighlight();
return
}if(!CQ.wcm.EditRollover.currentlyHighlighted){if(CQ.wcm.EditRollover.preventNextHighlight){CQ.wcm.EditRollover.preventNextHighlight=false
}else{this.showHighlight()
}}else{if(this.isParentHighlighted()){CQ.wcm.EditRollover.currentlyHighlighted.hideHighlight();
this.showHighlight()
}else{if(CQ.wcm.EditRollover.currentlyHighlighted!==this){CQ.wcm.EditRollover.requestHighlight=this
}}}}a.stopEvent()
},handleDocumentMouseMove:function(j){if(this.element){var m=CQ.themes.wcm.EditRollover.HIGHLIGHT_WIDTH;
var g=CQ.themes.wcm.EditRollover.HIGHLIGHT_PADDING;
var c=this.element.getRegion();
var b=j.getPageX();
var k=j.getPageY();
var a=new CQ.Ext.lib.Region(c.top-m-g,c.right+m+g,c.bottom+m+g,c.left-m-g);
if(!a.contains(new CQ.Ext.lib.Region(k,b,k,b))||this!==CQ.wcm.EditRollover.currentlyHighlighted){this.hideHighlight()
}a=null
}},handleDocumentScroll:function(a){this.hideHighlight()
},handleSelect:function(c,g){if(g!=this){return
}if(!this.selected){this.selected=true;
this.highlight.addClass("cq-editrollover-selected");
this.highlight.showFrames(this);
if(this.enableLiveRelationship&&!CQ.WCM.isShownLayer(CQ.WCM.LAYER_LCSTATUS)){var b=this.liveStatusLocked?"cq-editrollover-selected-livestatus-right-lock":"cq-editrollover-selected-livestatus-right-unlock";
b="cq-editrollover-selected-livestatus  "+b;
this.highlight.lock=new CQ.Ext.BoxComponent({autoEl:"div",cls:b,renderTo:CQ.Util.ROOT_ID});
this.highlight.lock.getEl().alignTo(this.highlight.frameRight.getEl(),"tl",[-20,4]);
this.highlight.lock.show();
var a=this;
if(this[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP][CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_EDITABLE]){this.highlight.lock.getEl().on("click",a.switchLock,a)
}else{this.highlight.lock.getEl().dom.title=CQ.I18n.getMessage("Inheritance is broken at the page or parent level")
}}}},handleDeselect:function(a){if(a!=this){return
}if(this.selected){if(this.highlight.lock){this.highlight.lock.hide();
this.highlight.lock.getEl().remove();
this.highlight.lock=null
}this.highlight.hideFrames(this);
this.highlight.removeClass("cq-editrollover-selected");
this.selected=false
}},handleSelectionClear:function(){this.handleDeselect(this)
},showHighlight:function(){if(this.enableHighlight&&this.element){if(!CQ.Ext.dd.DragDropMgr.dragCurrent&&!CQ.WCM.isContentWindowLoading()){CQ.wcm.EditRollover.currentlyHighlighted=this;
this.element.un("mouseover",this.handleMouseOver,this);
this.addDocumentEventListener("mousemove",this.handleDocumentMouseMove,this);
this.addDocumentEventListener("scroll",this.handleDocumentScroll,this);
CQ.Ext.EventManager.onWindowResize(this.handleWindowResize,this);
this.highlight.showFrames(this)
}}},showHighLight:this.showHighlight,hideHighlight:function(){if(CQ.wcm.EditRollover.currentlyHighlighted===this){delete CQ.wcm.EditRollover.currentlyHighlighted
}this.removeDocumentEventListener("mousemove",this.handleDocumentMouseMove,this);
this.removeDocumentEventListener("scroll",this.handleDocumentScroll,this);
CQ.Ext.EventManager.removeResizeListener(this.handleWindowResize,this);
if(this.enableHighlight&&this.element){this.element.un("mouseover",this.handleMouseOver,this);
this.element.on("mouseover",this.handleMouseOver,this)
}if(CQ.wcm.EditRollover.requestHighlight&&!CQ.Ext.dd.DragDropMgr.dragCurrent){CQ.wcm.EditRollover.currentlyHighlighted=CQ.wcm.EditRollover.requestHighlight;
CQ.wcm.EditRollover.currentlyHighlighted.showHighlight();
delete CQ.wcm.EditRollover.requestHighlight
}if(!this.selected&&this.highlight){this.highlight.hideFrames(this)
}},hideHighLight:this.hideHighlight,clearListeners:function(){if(CQ.wcm.EditRollover.currentlyHighlighted===this){delete CQ.wcm.EditRollover.currentlyHighlighted;
this.removeDocumentEventListener("mousemove",this.handleDocumentMouseMove,this);
this.removeDocumentEventListener("scroll",this.handleDocumentScroll,this);
CQ.Ext.EventManager.removeResizeListener(this.handleWindowResize,this)
}if(this.emptyComponent){this.emptyComponent.el.un("contextmenu",this.handleContextMenu,this);
this.emptyComponent.el.un("mouseover",this.handleMouseOver,this);
this.emptyComponent.el.un("click",this.handleClick,this)
}if(this.element){this.element.un("mouseover",this.handleMouseOver,this);
this.element.un("click",this.handleClick,this);
this.element.un("dblclick",this.handleDblClick,this);
this.removeElementEventListener(this.element.dom,"contextmenu",this.handleContextMenu,true,this)
}},show:function(g){this.hidden=false;
this.hideHighlight();
if(this.liveStatus){this.liveStatus.showFrames()
}CQ.WCM.showPlaceholders(this.element);
this.buildElement();
if(this.isContained&&this.isActionInsertOnly()){this.element.parent().show()
}this.resumeDropTargets();
if(g!==true){var a=CQ.WCM.getNestedEditables(this.path);
for(var c=0;
c<a.length;
c++){var b=CQ.WCM.getEditable(a[c]);
if(b){b.show(true)
}}}this.showAnnotations();
return this
},hide:function(g){if(g!==true){var a=CQ.WCM.getNestedEditables(this.path);
for(var c=0;
c<a.length;
c++){var b=CQ.WCM.getEditable(a[c]);
if(b){b.hide(true)
}}}this.suspendDropTargets();
this.hidden=true;
if(this.liveStatus){this.liveStatus.hideFrames()
}if(this.element){this.hideHighlight();
if(this.isContained&&this.isActionInsertOnly()){this.element.parent().hide()
}CQ.WCM.hidePlaceholders(this.element);
this.buildElement()
}this.hideAnnotations();
return this
},convertAction:function(a){if(a!=null){if(typeof a=="string"){var b=CQ.wcm.EditRollover.ActionsConvertor[a];
if(b!=null){if(typeof b=="string"){if(b.length>0){return b
}else{return null
}}else{return b
}}else{return{text:a,disabled:true}
}}else{if(a.xtype){if(a.xtype=="tbtext"||a.xtype=="text"){a.xtype="titleseparator";
a.title=a.text;
return a
}else{if(CQ.wcm.EditRollover.TBXTypesToMenuActions[a.xtype]!=null){return this.convertAction(CQ.wcm.EditRollover.TBXTypesToMenuActions[a.xtype])
}}}else{if(a.handler||a.listeners){return a
}else{return CQ.Util.applyDefaults(a,{disabled:true})
}}}}return a
},hideElement:function(b,j){if(j!==true){var a=CQ.WCM.getNestedEditables(this.path);
for(var g=0;
g<a.length;
g++){var c=CQ.WCM.getEditable(a[g]);
if(c){c.hide(true);
c.hideElement(false,true)
}}}this.elementHidden=true;
if(this.liveStatus){this.liveStatus.hideFrames()
}this.hideHighlight();
this.savedElementHeight=this.element.getHeight();
this.savedElementWidth=this.element.getWidth();
this.element.hide(this.animateHide);
if(b!==true&&this.isContained){this.element.parent().hide()
}if(this.emptyComponent){this.emptyComponent.hide()
}if(this.elementPlaceholder){this.elementPlaceholder.hide()
}},showElement:function(g){this.elementHidden=false;
if(this.emptyComponent){this.emptyComponent.show()
}if(this.elementPlaceholder){this.elementPlaceholder.show()
}if(this.isContained){this.element.parent().show()
}this.element.show(this.animateShow);
this.savedElementHeight=this.element.getHeight();
this.savedElementWidth=this.element.getWidth();
if(g!==true){var a=CQ.WCM.getNestedEditables(this.path);
for(var c=0;
c<a.length;
c++){var b=CQ.WCM.getEditable(a[c]);
if(b){b.showElement(true);
b.show(true)
}}}},refreshComponent:function(){this.placeholder.setHeight(0);
this.placeholder.show()
},getInlinePlaceholder:function(){return this.placeholder
},getInlinePlaceholderInitialHeight:function(){return 0
},remove:function(j){if(j!==true){var a=CQ.WCM.getNestedEditables(this.path);
for(var c=0;
c<a.length;
c++){var b=CQ.WCM.getEditable(a[c]);
if(b){b.remove(true)
}}}this.removeDropTargets();
CQ.WCM.deselect(this);
var g=CQ.WCM.getSelection();
g.un("add",this.handleSelect,this);
g.un("remove",this.handleDeselect,this);
g.un("clear",this.handleSelectionClear,this);
this.removeSelectionListeners();
this.removeClipboardListeners();
CQ.WCM.unregisterDialog("editdialog-"+this.path);
CQ.WCM.unregisterDialog("insertdialog-"+this.path);
CQ.WCM.unregisterEditable(this.path);
CQ.Util.cancelObservation(this);
if(this.liveStatus){this.liveStatus.hideFrames();
CQ.Ext.destroy(this.liveStatus);
CQ.Ext.ComponentMgr.unregister(this.liveStatus);
delete this.liveStatus
}if(this.placeholder){CQ.Ext.destroy(this.placeholder);
CQ.Ext.ComponentMgr.unregister(this.placeholder);
delete this.placeholder
}if(this.menuComponent){CQ.Ext.destroy(this.menuComponent);
CQ.Ext.ComponentMgr.unregister(this.menuComponent);
delete this.menuComponent
}if(this.highlight){this.highlight.hideFrames(this);
CQ.Ext.destroy(this.highlight);
CQ.Ext.ComponentMgr.unregister(this.highlight);
delete this.highlight
}if(this.inplaceEditHighlight){this.inplaceEditHighlight.hideFrames();
CQ.Ext.destroy(this.inplaceEditHighlight);
CQ.Ext.ComponentMgr.unregister(this.inplaceEditHighlight);
delete this.inplaceEditHighlight
}this.removeAnnotations();
this.clearListeners();
CQ.Ext.ComponentMgr.unregister(this);
if(this.emptyComponent){CQ.Ext.destroy(this.emptyComponent);
delete this.emptyComponent
}CQ.Ext.destroy(this.element);
CQ.Ext.ComponentMgr.unregister(this.element);
delete this.element;
this.destroy();
this.purgeListeners()
},addElementEventListener:function(g,b,m,a,j){if(g&&(g.tagName=="script"||g.tagName=="input"||g.tagName=="select"||g.tagName=="button"||g.tagName=="a")){return
}var k=CQ.Ext.get(g);
if(k){k.addListener(b,m,j);
if(a){for(var c=0;
c<g.childNodes.length;
c++){this.addElementEventListener(g.childNodes.item(c),b,m,false,j)
}}}},removeElementEventListener:function(g,b,m,a,j){if(g&&(g.tagName=="script"||g.tagName=="input"||g.tagName=="select"||g.tagName=="button"||g.tagName=="a")){return
}var k=CQ.Ext.get(g);
if(k){k.removeListener(b,m,j);
if(a){for(var c=0;
c<g.childNodes.length;
c++){this.removeElementEventListener(g.childNodes.item(c),b,m,false,j)
}}}},addDocumentEventListener:function(a,c,b){this.addElementEventListener(document,a,c,false,b)
},removeDocumentEventListener:function(a,c,b){this.removeElementEventListener(document,a,c,false,b)
}});
CQ.Ext.reg("editrollover",CQ.wcm.EditRollover);
CQ.Ext.override(CQ.wcm.EditRollover,CQ.wcm.EditBase);
CQ.wcm.EditRollover.ActionsConvertor=new Array;
CQ.wcm.EditRollover.ActionsConvertor.separator="-";
CQ.wcm.EditRollover.ActionsConvertor["-"]=CQ.wcm.EditRollover.ActionsConvertor.separator;
CQ.wcm.EditRollover.ActionsConvertor.spacer="";
CQ.wcm.EditRollover.ActionsConvertor[" "]=CQ.wcm.EditRollover.ActionsConvertor.spacer;
CQ.wcm.EditRollover.ActionsConvertor.fill="";
CQ.wcm.EditRollover.ActionsConvertor["->"]=CQ.wcm.EditRollover.ActionsConvertor.fill;
CQ.wcm.EditRollover.TBXTypesToMenuActions=new Array;
CQ.wcm.EditRollover.TBXTypesToMenuActions.tbseparator="separator";
CQ.wcm.EditRollover.TBXTypesToMenuActions.tbspacer="spacer";
CQ.wcm.EditRollover.TBXTypesToMenuActions.tbfill="fill";
CQ.wcm.EditRollover.DragZone=CQ.Ext.extend(CQ.wcm.EditBase.DragZone,{hideEditComponent:function(){CQ.wcm.EditRollover.DragZone.superclass.hideEditComponent.call(this);
for(var a=0;
a<this.dragData.items.length;
a++){try{CQ.WCM.deselect(this.dragData.items[a]);
this.dragData.items[a].highlight.hideFrames()
}catch(b){}}}});
CQ.wcm.EditRollover.DisabledDragZone=CQ.Ext.extend(CQ.Ext.dd.DragZone,{constructor:function(c,b){b=b||{};
var a=document.createElement("div");
CQ.Ext.fly(a).addClass("cq-editrollover-livestatus-disabled");
a.innerHTML=CQ.I18n.getMessage("Fixed Component");
CQ.Ext.apply(b,{ddel:a,ddGroup:"match_nothing"});
CQ.wcm.EditRollover.DisabledDragZone.superclass.constructor.call(this,c,b)
},getDragData:function(a){return this
},getRepairXY:function(b,a){return null
}});
CQ.wcm.EditRollover.DragZone.getInstance=function(g,j,b){var a=new CQ.wcm.EditRollover.DragZone(g,{editComponent:j});
if(b){var c=0;
for(;
c<b.length;
c++){a.addToGroup(b[c])
}a.removeFromGroup(CQ.wcm.EditBase.DD_GROUP_DEFAULT)
}return a
};
CQ.wcm.EditRollover.DisabledDragZone.getInstance=function(a){return new CQ.wcm.EditRollover.DisabledDragZone(a,{})
};
CQ.wcm.EditRollover.DropTarget=CQ.Ext.extend(CQ.wcm.EditBase.DropTarget,{notifyEnter:function(a,c,b){return CQ.wcm.EditRollover.DropTarget.superclass.notifyEnter.call(this,a,c,b)
},notifyOver:function(a,c,b){this.editComponent.highlight.hideFrames();
return CQ.wcm.EditRollover.DropTarget.superclass.notifyOver.call(this,a,c,b)
}});
CQ.wcm.EditRollover.DropTarget.getInstance=function(g,k,a,b){b=b||{};
if(k){b.editComponent=k
}var j=new CQ.wcm.EditRollover.DropTarget(g,b);
if(a){var c=0;
for(;
c<a.length;
c++){j.addToGroup(a[c])
}j.removeFromGroup(CQ.wcm.EditBase.DD_GROUP_DEFAULT)
}return j
};
CQ.wcm.EditRollover.EVENT_SHOW_HIGHTLIGHT="showhighlight";
CQ.wcm.EditRollover.EVENT_HIDE_HIGHTLIGHT="hidehighlight";
CQ.wcm.EditRollover.Highlight=CQ.Ext.extend(CQ.Ext.Component,{frameLeft:null,frameRight:null,frameBottom:null,frameTop:null,constructor:function(){CQ.wcm.EditRollover.Highlight.superclass.constructor.call(this);
this.frameLeft=new CQ.Ext.BoxComponent({autoEl:"div",cls:"cq-editrollover-highlight-left"});
this.frameRight=new CQ.Ext.BoxComponent({autoEl:"div",cls:"cq-editrollover-highlight-right"});
this.frameBottom=new CQ.Ext.BoxComponent({autoEl:"div",cls:"cq-editrollover-highlight-bottom"});
this.frameTop=new CQ.Ext.BoxComponent({autoEl:"div",cls:"cq-editrollover-highlight-top"})
},adjustHighlightSize:function(c){var m=CQ.themes.wcm.EditRollover.HIGHLIGHT_WIDTH;
var g=CQ.themes.wcm.EditRollover.HIGHLIGHT_PADDING;
var b=c.element.getWidth();
var a=c.element.getHeight();
var k=this.frameLeft.el.getLeft()+m+g;
var j=this.frameTop.el.getTop()+m+g;
this.frameTop.setWidth(b+2*m+2*g);
this.frameTop.setHeight(m);
this.frameBottom.setPosition(k-m-g,j+a+g);
this.frameBottom.setWidth(b+2*m+2*g);
this.frameBottom.setHeight(m);
this.frameLeft.setWidth(m);
this.frameLeft.setHeight(a+2*g);
this.frameRight.setPosition(k+b+g,j-g);
this.frameRight.setWidth(m);
this.frameRight.setHeight(a+2*g)
},showFrames:function(g){if(!this.frameLeft.rendered){this.frameLeft.render(CQ.Util.ROOT_ID)
}if(!this.frameRight.rendered){this.frameRight.render(CQ.Util.ROOT_ID)
}if(!this.frameBottom.rendered){this.frameBottom.render(CQ.Util.ROOT_ID)
}if(!this.frameTop.rendered){this.frameTop.render(CQ.Util.ROOT_ID)
}if(g){var b=g.element;
var n=CQ.themes.wcm.EditRollover.HIGHLIGHT_WIDTH;
var j=CQ.themes.wcm.EditRollover.HIGHLIGHT_PADDING;
var c=b.getWidth();
var a=b.getHeight();
if(g.emptyComponent){a=g.emptyComponent.getEl().getHeight()
}var m=b.getLeft();
var k=b.getTop();
this.frameTop.setWidth(c+2*n+2*j);
this.frameTop.setHeight(n);
this.frameTop.setPosition(m-n-j,k-n-j);
this.frameBottom.setWidth(c+2*n+2*j);
this.frameBottom.setHeight(n);
this.frameBottom.setPosition(m-n-j,k+a+j);
this.frameLeft.setWidth(n);
this.frameLeft.setHeight(a+2*j);
this.frameLeft.setPosition(m-n-j,k-j);
this.frameRight.setWidth(n);
this.frameRight.setHeight(a+2*j);
this.frameRight.setPosition(m+c+j,k-j);
if(g.orderable){if(!this.frameTop.dd){this.frameTop.dd=CQ.wcm.EditRollover.DragZone.getInstance(this.frameTop.getEl(),g,[CQ.wcm.EditBase.DD_GROUP_COMPONENT])
}else{this.frameTop.dd.unlock();
this.frameTop.dd.clearGroups();
this.frameTop.dd.editComponent=g;
this.frameTop.dd.addToGroups([CQ.wcm.EditBase.DD_GROUP_COMPONENT])
}if(!this.frameBottom.dd){this.frameBottom.dd=CQ.wcm.EditRollover.DragZone.getInstance(this.frameBottom.getEl(),g,[CQ.wcm.EditBase.DD_GROUP_COMPONENT])
}else{this.frameBottom.dd.unlock();
this.frameBottom.dd.clearGroups();
this.frameBottom.dd.editComponent=g;
this.frameBottom.dd.addToGroups([CQ.wcm.EditBase.DD_GROUP_COMPONENT])
}if(!this.frameLeft.dd){this.frameLeft.dd=CQ.wcm.EditRollover.DragZone.getInstance(this.frameLeft.getEl(),g,[CQ.wcm.EditBase.DD_GROUP_COMPONENT])
}else{this.frameLeft.dd.unlock();
this.frameLeft.dd.clearGroups();
this.frameLeft.dd.editComponent=g;
this.frameLeft.dd.addToGroups([CQ.wcm.EditBase.DD_GROUP_COMPONENT])
}if(!this.frameRight.dd){this.frameRight.dd=CQ.wcm.EditRollover.DragZone.getInstance(this.frameRight.getEl(),g,[CQ.wcm.EditBase.DD_GROUP_COMPONENT])
}else{this.frameRight.dd.unlock();
this.frameRight.dd.clearGroups();
this.frameRight.dd.editComponent=g;
this.frameRight.dd.addToGroups([CQ.wcm.EditBase.DD_GROUP_COMPONENT])
}}else{if(!this.frameTop.dd){this.frameTop.dd=CQ.wcm.EditRollover.DisabledDragZone.getInstance(this.frameTop.getEl())
}if(!this.frameBottom.dd){this.frameBottom.dd=CQ.wcm.EditRollover.DisabledDragZone.getInstance(this.frameBottom.getEl())
}if(!this.frameLeft.dd){this.frameLeft.dd=CQ.wcm.EditRollover.DisabledDragZone.getInstance(this.frameLeft.getEl())
}if(!this.frameRight.dd){this.frameRight.dd=CQ.wcm.EditRollover.DisabledDragZone.getInstance(this.frameRight.getEl())
}}this.frameLeft.show();
this.frameRight.show();
this.frameBottom.show();
this.frameTop.show();
g.fireEvent(CQ.wcm.EditRollover.EVENT_SHOW_HIGHTLIGHT,this)
}},hideFrames:function(a){this.frameLeft.hide();
this.frameRight.hide();
this.frameBottom.hide();
this.frameTop.hide();
if(a){a.fireEvent(CQ.wcm.EditRollover.EVENT_HIDE_HIGHTLIGHT,this)
}},addClass:function(a){this.frameLeft.addClass(a);
this.frameRight.addClass(a);
this.frameBottom.addClass(a);
this.frameTop.addClass(a)
},removeClass:function(a){this.frameLeft.removeClass(a);
this.frameRight.removeClass(a);
this.frameBottom.removeClass(a);
this.frameTop.removeClass(a)
},on:function(a,c,b){this.frameLeft.on(a,c,b);
this.frameRight.on(a,c,b);
this.frameBottom.on(a,c,b);
this.frameTop.on(a,c,b)
},un:function(a,c,b){this.frameLeft.un(a,c,b);
this.frameRight.un(a,c,b);
this.frameBottom.un(a,c,b);
this.frameTop.un(a,c,b)
},destroy:function(){CQ.Ext.destroy(this.frameLeft);
CQ.Ext.destroy(this.frameRight);
CQ.Ext.destroy(this.frameBottom);
CQ.Ext.destroy(this.frameTop);
delete this.frameLeft;
delete this.frameRight;
delete this.frameBottom;
delete this.frameTop;
CQ.wcm.EditRollover.Highlight.superclass.destroy.call(this)
}});
CQ.wcm.EditRollover.HighLight=CQ.wcm.EditRollover.Highlight;
CQ.wcm.EditRollover.LiveStatus=CQ.Ext.extend(CQ.Ext.Component,{frameLeft:null,frameRight:null,frameBottom:null,frameTop:null,containerMode:false,lockCls:"cq-editrollover-livestatus-lock",lockRightCls:"cq-editrollover-livestatus-right-lock",unlockCls:"cq-editrollover-livestatus-unlock",unlockRightCls:"cq-editrollover-livestatus-right-unlock",constructor:function(a){CQ.wcm.EditRollover.LiveStatus.superclass.constructor.call(this);
if(a){this.containerMode=true
}this.frameLeft=new CQ.Ext.BoxComponent({autoEl:"div",cls:"cq-editrollover-livestatus-left"});
this.frameRight=new CQ.Ext.BoxComponent({autoEl:"div",cls:"cq-editrollover-livestatus-right"});
this.frameBottom=new CQ.Ext.BoxComponent({autoEl:"div",cls:"cq-editrollover-livestatus-bottom"});
this.frameTop=new CQ.Ext.BoxComponent({autoEl:"div",cls:"cq-editrollover-livestatus-top"})
},showFrames:function(g,o){if(!this.frameLeft.rendered){this.frameLeft.render(CQ.Util.ROOT_ID)
}if(!this.frameRight.rendered){this.frameRight.render(CQ.Util.ROOT_ID)
}if(!this.frameBottom.rendered){this.frameBottom.render(CQ.Util.ROOT_ID)
}if(!this.frameTop.rendered){this.frameTop.render(CQ.Util.ROOT_ID)
}if(g){var k=g.element;
var n=1;
var b=2;
var j=10;
var a=k.getWidth();
var q=k.getHeight();
var c=k.getLeft();
var m=k.getTop();
if(this.containerMode){b+=4;
a+=14;
j=2
}this.frameTop.setWidth(a+2*n+2*b);
this.frameTop.setHeight(n);
this.frameTop.setPosition(c-n-b,m-n-b);
this.frameBottom.setWidth(a+2*n+2*b);
this.frameBottom.setHeight(n);
this.frameBottom.setPosition(c-n-b,m+q+b);
this.frameLeft.setWidth(n);
this.frameLeft.setHeight(q+2*b);
this.frameLeft.setPosition(c-n-b,m-b);
this.frameRight.setWidth(n);
this.frameRight.setHeight(q+2*b);
this.frameRight.setPosition(c+a-j-b-n-6,m-b);
if(o){this.displayLock()
}else{this.displayUnLock()
}this.frameLeft.show();
this.frameRight.show();
this.frameBottom.show();
this.frameTop.show()
}},displayLock:function(){this.frameRight.removeClass(this.unlockRightCls);
this.frameLeft.removeClass(this.unlockCls);
this.frameBottom.removeClass(this.unlockCls);
this.frameTop.removeClass(this.unlockCls);
this.frameRight.addClass(this.lockRightCls);
this.frameLeft.addClass(this.lockCls);
this.frameBottom.addClass(this.lockCls);
this.frameTop.addClass(this.lockCls)
},displayUnLock:function(){this.frameRight.removeClass(this.lockRightCls);
this.frameLeft.removeClass(this.lockCls);
this.frameBottom.removeClass(this.lockCls);
this.frameTop.removeClass(this.lockCls);
this.frameLeft.addClass(this.unlockCls);
this.frameRight.addClass(this.unlockRightCls);
this.frameBottom.addClass(this.unlockCls);
this.frameTop.addClass(this.unlockCls)
},hideFrames:function(){this.frameLeft.hide();
this.frameRight.hide();
this.frameBottom.hide();
this.frameTop.hide()
},addClass:function(a){this.frameLeft.addClass(a);
this.frameRight.addClass(a);
this.frameBottom.addClass(a);
this.frameTop.addClass(a)
},removeClass:function(a){this.frameLeft.removeClass(a);
this.frameRight.removeClass(a);
this.frameBottom.removeClass(a);
this.frameTop.removeClass(a)
},on:function(a,c,b){this.frameLeft.on(a,c,b);
this.frameRight.on(a,c,b);
this.frameBottom.on(a,c,b);
this.frameTop.on(a,c,b)
},un:function(a,c,b){this.frameLeft.un(a,c,b);
this.frameRight.un(a,c,b);
this.frameBottom.un(a,c,b);
this.frameTop.un(a,c,b)
},destroy:function(){CQ.Ext.destroy(this.frameLeft);
CQ.Ext.destroy(this.frameRight);
CQ.Ext.destroy(this.frameBottom);
CQ.Ext.destroy(this.frameTop);
delete this.frameLeft;
delete this.frameRight;
delete this.frameBottom;
delete this.frameTop;
CQ.wcm.EditRollover.LiveStatus.superclass.destroy.call(this)
}});
CQ.wcm.InvisibleEditControl=CQ.Ext.extend(CQ.Ext.Component,{constructor:function(a){this.constructorStart(a);
this.constructorEnd(a);
CQ.wcm.InvisibleEditControl.superclass.constructor.call(this,a);
this.element=CQ.Ext.get(this.element);
(function(){this.fireEvent(CQ.wcm.EditBase.EVENT_READY,this)
}).defer(1,this)
}});
CQ.Ext.reg("editnocontrol",CQ.wcm.InvisibleEditControl);
CQ.Ext.override(CQ.wcm.InvisibleEditControl,CQ.wcm.EditBase);
CQ.wcm.NotificationInbox=CQ.Ext.extend(CQ.Ext.Viewport,{constructor:function(c){this.debug=c.debug;
var a=new CQ.Ext.grid.ColumnModel([new CQ.Ext.grid.RowNumberer(),{header:CQ.I18n.getMessage("Modification"),dataIndex:"modification"},{header:CQ.I18n.getMessage("Path"),dataIndex:"path"},{header:CQ.I18n.getMessage("Date"),dataIndex:"date"},{header:CQ.I18n.getMessage("User"),dataIndex:"user"},{header:CQ.I18n.getMessage("Read"),dataIndex:"isRead"}]);
a.defaultSortable=true;
var j=new CQ.Ext.grid.RowSelectionModel({singleSelect:true});
var g=CQ.Util.applyDefaults(c.store,{autoLoad:true,proxy:new CQ.Ext.data.HttpProxy({url:"/bin/wcm/notification/inbox/messages.json",method:"GET"}),baseParams:{start:0,limit:25},reader:new CQ.Ext.data.JsonReader({totalProperty:"results",root:"messages",id:"id",fields:["id","modification","path","date","user",{name:"isRead",type:"bool"},{name:"isUserMessage",type:"bool"}]})});
var b=new CQ.Ext.data.GroupingStore(g);
CQ.wcm.NotificationInbox.superclass.constructor.call(this,{id:"cq-notification-inbox",layout:"border",renderTo:"CQ",items:[{id:"cq-notification-inbox-wrapper",xtype:"panel",layout:"border",region:"center",border:false,items:[{id:"cq-header",xtype:"container",region:"north",autoEl:"div",cls:"cq-header-toolbar",items:[new CQ.HomeLink({})]},{xtype:"grid",id:"cq-notification-inbox-grid",region:"center",margins:"5 5 5 5",pageSize:25,loadMask:true,stripeRows:true,cm:a,sm:j,viewConfig:new CQ.Ext.grid.GroupingView({forceFit:true,groupTextTpl:'{text} ({[values.rs.length]} {[values.rs.length > 1 ? "Messages" : "Message"]})'}),bbar:new CQ.Ext.PagingToolbar({pageSize:25,store:b,displayInfo:true,displayMsg:CQ.I18n.getMessage("Displaying messages {0} - {1} of {2}"),emptyMsg:CQ.I18n.getMessage("No message to display")}),tbar:[{id:"cq-notification-inbox-read",text:CQ.I18n.getMessage("Approve"),handler:this.approveMessage,tooltip:{title:CQ.I18n.getMessage("Approve the message"),text:CQ.I18n.getMessage("Approves a message and marks it as read."),autoHide:true}},{id:"cq-notification-inbox-remove",text:CQ.I18n.getMessage("Delete"),handler:this.deleteMessage,tooltip:{title:CQ.I18n.getMessage("Delete the message"),text:CQ.I18n.getMessage("Deletes a message."),autoHide:true}},{id:"cq-notification-inbox-config",text:CQ.I18n.getMessage("Configure..."),handler:this.showConfigDialog,tooltip:{title:CQ.I18n.getMessage("Configure subscriptions"),text:CQ.I18n.getMessage("Opens the subscription configuration dialog."),autoHide:true}}],store:b}]}]})
},initComponent:function(){CQ.wcm.NotificationInbox.superclass.initComponent.call(this)
},reloadAll:function(){CQ.Ext.getCmp("cq-notification-inbox-grid").getStore().reload()
},approveMessage:function(){var b=CQ.Ext.getCmp("cq-notification-inbox-grid");
var g=b.getSelectionModel().getSelections();
for(var a=0;
a<g.length;
a++){var c=g[a];
CQ.Ext.Ajax.request({url:CQ.HTTP.externalize("/bin/wcm/notification/inbox/action.json"),success:CQ.Ext.getCmp("cq-notification-inbox-grid").getStore().reload(),failure:function(){CQ.Ext.Msg.alert("Error","Could not approve message: "+c.id)
},params:{path:c.id,cmd:"approve"}})
}b.getStore().reload()
},deleteMessage:function(){var b=CQ.Ext.getCmp("cq-notification-inbox-grid");
var g=b.getSelectionModel().getSelections();
for(var a=0;
a<g.length;
a++){var c=g[a];
CQ.Ext.Ajax.request({url:CQ.HTTP.externalize("/bin/wcm/notification/inbox/action.json"),success:CQ.Ext.getCmp("cq-notification-inbox-grid").getStore().reload(),failure:function(){CQ.Ext.Msg.alert("Error","Could not remove message: "+c.id)
},params:{path:c.id,cmd:"delete"}})
}b.getStore().reload()
},showConfigDialog:function(){function b(u){if(u=="true"){return CQ.I18n.getMessage("Yes")
}return CQ.I18n.getMessage("No")
}function k(u){if(u=="true"){return CQ.I18n.getMessage("Allow")
}return CQ.I18n.getMessage("Deny")
}var q=new CQ.Ext.grid.ColumnModel([{header:CQ.I18n.getMessage("Path"),dataIndex:"path",editor:new CQ.Ext.form.TextField({allowBlank:false})},{header:CQ.I18n.getMessage("Exact?"),dataIndex:"exact",renderer:b,editor:new CQ.Ext.form.ComboBox({store:[["true",CQ.I18n.getMessage("Yes")],["false",CQ.I18n.getMessage("No")]],triggerAction:"all"})},{header:CQ.I18n.getMessage("Rule"),dataIndex:"allow",renderer:k,editor:new CQ.Ext.form.ComboBox({store:[["true",CQ.I18n.getMessage("Allow")],["false",CQ.I18n.getMessage("Deny")]],triggerAction:"all"})}]);
var n=new CQ.Ext.Action({cls:"cq-notification-subscriptions-add",text:CQ.I18n.getMessage("Add"),handler:function(){o.add(new CQ.Ext.data.Record({path:"",exact:"true",allow:"true"}))
},scope:this,tooltip:{title:CQ.I18n.getMessage("Add a subscription"),text:CQ.I18n.getMessage("Adds a new subscription."),autoHide:true}});
var g=new CQ.Ext.Action({cls:"cq-notification-subscriptions-remove",text:CQ.I18n.getMessage("Delete"),disabled:true,handler:function(){var v=CQ.Ext.getCmp("cq-notification-subscriptions-grid");
var x=v.getSelectionModel().getSelections();
for(var u=0;
u<x.length;
u++){var w=x[u];
v.getStore().remove(w)
}},tooltip:{title:CQ.I18n.getMessage("Delete the subscription"),text:CQ.I18n.getMessage("Deletes a subscription."),autoHide:true}});
var j=[n,g];
var c=new CQ.Ext.grid.RowSelectionModel({singleSelect:false,listeners:{selectionchange:function(u){if(u.hasSelection()){g.setDisabled(false)
}else{g.setDisabled(true)
}}}});
var t=[{value:"Activate",text:CQ.I18n.getMessage("Activated")},{value:"Deactivate",text:CQ.I18n.getMessage("Deactivated")},{value:"Delete",text:CQ.I18n.getMessage("Deleted (syndication)")},{value:"PageModified",text:CQ.I18n.getMessage("Modified")},{value:"PageCreated",text:CQ.I18n.getMessage("Created")},{value:"PageDeleted",text:CQ.I18n.getMessage("Deleted")},{value:"PageRolledOut",text:CQ.I18n.getMessage("Rolled out")}];
var a={autoLoad:true,proxy:new CQ.Ext.data.HttpProxy({url:"/bin/wcm/notification/config.json",method:"GET"}),baseParams:{start:0,limit:25},listeners:{load:function(x,v,w){var u=CQ.Ext.getCmp("inbox-channel-combo");
u.setValue(a.reader.jsonData.type);
var y=CQ.Ext.getCmp("inbox-actions-selection");
y.setValue(a.reader.jsonData.actions)
}},reader:new CQ.Ext.data.JsonReader({totalProperty:"results",root:"configs",fields:["path","exact","allow"]})};
var o=new CQ.Ext.data.GroupingStore(a);
var r={"jcr:primaryType":"cq:Dialog",title:CQ.I18n.getMessage("Subscribe..."),buttons:[{text:CQ.I18n.getMessage("OK"),handler:function(){var u=CQ.Ext.getCmp("inbox-channel-combo");
var y=CQ.Ext.getCmp("inbox-actions-selection");
var v=new Array(o.getCount());
for(var w=0;
w<o.getCount();
w++){var x=o.getAt(w);
v[w]=new Array(3);
v[w][0]=x.get("path");
v[w][1]=x.get("exact");
v[w][2]=x.get("allow")
}CQ.HTTP.post("/bin/wcm/notification/config.json",function(A,B,z){if(B){m.hide()
}},{type:u.getValue(),actions:y.getValue(),configs:CQ.Ext.util.JSON.encode(v)})
}},CQ.Dialog.CANCEL],items:{"jcr:primaryType":"cq:Panel",items:{"jcr:primaryType":"cq:WidgetCollection",channel:{xtype:"combo",fieldLabel:CQ.I18n.getMessage("Select Notification Channels"),editable:false,id:"inbox-channel-combo",triggerAction:"all",store:[["inbox",CQ.I18n.getMessage("Inbox")],["email",CQ.I18n.getMessage("Email")]]},actions:{xtype:"selection",type:"checkbox",fieldLabel:CQ.I18n.getMessage("Select actions to be notified"),editable:false,id:"inbox-actions-selection",options:t},sub1:{xtype:"label",text:CQ.I18n.getMessage("Define Packages")},subscriptions:{xtype:"editorgrid",id:"cq-notification-subscriptions-grid",region:"center",anchor:"-30 -100",margins:"5 5 5 5",loadMask:true,stripeRows:true,clicksToEdit:1,cm:q,sm:c,viewConfig:new CQ.Ext.grid.GroupingView({forceFit:true}),tbar:j,store:o,listeners:{rowcontextmenu:function(v,u,x){if(!this.contextMenu){this.contextMenu=new CQ.Ext.menu.Menu({items:j})
}var w=x.getXY();
this.contextMenu.showAt(w);
x.stopEvent()
}}}}}};
var m=CQ.WCM.getDialog(r,"cq.notification.inbox.dialog");
m.failure=function(){CQ.Ext.Msg.alert("Error","Could not save subscriptions.")
};
m.show()
}});
CQ.Ext.reg("notificationinbox",CQ.wcm.NotificationInbox);
CQ.wcm.OfflineImporter=CQ.Ext.extend(CQ.wcm.Viewport,{props:null,conn:new CQ.Ext.data.Connection(),data:null,constructor:function(a){this.debug=a.debug;
var b=new CQ.Ext.FormPanel({labelWidth:75,url:"/libs/wcm/offline/import",fileUpload:true,title:"Import",border:false,labelWidth:100,buttonAlign:"left",bodyStyle:{"background-color":"#f0f0f0",padding:"5px"},items:[{xtype:"fileuploadfield",fieldLabel:CQ.I18n.getMessage("Word Document"),fieldDescription:CQ.I18n.getMessage("Select the Word Document to import"),name:"document",anchor:"99%"},{xtype:"pathfield",anchor:"99%",selectOnFocus:true,allowBlank:false,name:"parent",fieldLabel:CQ.I18n.getMessage("Import into"),fieldDescription:CQ.I18n.getMessage("Select the location to import into")},{xtype:"hidden",name:"configPath",value:CQ.HTTP.getPath(window.location.pathname)}],buttons:[{text:"Import",handler:function(){var c={};
var g=new CQ.form.SlingSubmitAction(b.getForm(),c);
b.getForm().doAction(g)
}}]});
CQ.wcm.OfflineImporter.superclass.constructor.call(this,{id:"cq-offlineimporter",items:[{id:"cq-offlineimporter-wrapper",xtype:"panel",layout:"border",region:"center",border:false,items:[{id:"cq-offline-form",xtype:"container",region:"north",autoEl:"div",height:200,border:"false",items:[b]},{id:"cq-offlineimporter-property-grid",xtype:"propgrid",region:"center",border:true,title:"Offline Importer Configuration"}]}]});
CQ.Ext.getCmp("cq-offlineimporter-property-grid").showProperties(CQ.Ext.getCmp("cq-offlineimporter"))
},initComponent:function(){CQ.wcm.OfflineImporter.superclass.initComponent.call(this)
},getPropertyEditors:function(){var a={};
a["Page Template"]=new CQ.Ext.grid.GridEditor(new CQ.Ext.form.ComboBox({editable:false,allowBlank:false,selectOnFocus:true,triggerAction:"all",valueField:"path",displayField:"title",store:new CQ.Ext.data.Store({proxy:new CQ.Ext.data.HttpProxy({url:"/bin/wcm/templates",method:"GET"}),reader:new CQ.Ext.data.JsonReader({totalProperty:"results",root:"templates",id:"path"},["path","title","description","thumbnailPath"]),baseParams:{_charset_:"utf-8"}}),tpl:new CQ.Ext.XTemplate('<tpl for=".">','<div class="template-item">','<tpl if="thumbnailPath">','<img class="template-thumbnail" src="{thumbnailPath}">',"</tpl>",'<div class="template-title">','{[CQ.I18n.getVarMessage(CQ.shared.XSS.getXSSTablePropertyValue(values, "title"))]}',"</div>",'<div class="template-description">','{[CQ.I18n.getVarMessage(CQ.shared.XSS.getXSSTablePropertyValue(values, "description"))]}',"</div>",'<div style="clear:both"></div>',"</div>","</tpl>"),itemSelector:"div.template-item"}));
a["Text Paragraph"]=new CQ.Ext.grid.GridEditor(new CQ.Ext.form.ComboBox({store:new CQ.Ext.data.Store({proxy:new CQ.Ext.data.HttpProxy({url:"/libs/wcm/offline/import.offlinecomponents.json",method:"GET"}),reader:new CQ.Ext.data.JsonReader({totalProperty:"results",root:"components"},[{name:"value"},{name:"text"}])}),displayField:"text",valueField:"value",selectOnFocus:true,triggerAction:"all",editable:false}));
a["Image Paragraph"]=new CQ.Ext.grid.GridEditor(new CQ.Ext.form.ComboBox({store:new CQ.Ext.data.Store({proxy:new CQ.Ext.data.HttpProxy({url:"/libs/wcm/offline/import.offlinecomponents.json",method:"GET"}),reader:new CQ.Ext.data.JsonReader({totalProperty:"results",root:"components"},[{name:"value"},{name:"text"}])}),displayField:"text",valueField:"value",selectOnFocus:true,triggerAction:"all",editable:false}));
a["Text Image Paragraph"]=new CQ.Ext.grid.GridEditor(new CQ.Ext.form.ComboBox({store:new CQ.Ext.data.Store({proxy:new CQ.Ext.data.HttpProxy({url:"/libs/wcm/offline/import.offlinecomponents.json",method:"GET"}),reader:new CQ.Ext.data.JsonReader({totalProperty:"results",root:"components"},[{name:"value"},{name:"text"}])}),displayField:"text",valueField:"value",selectOnFocus:true,triggerAction:"all",editable:false}));
return a
},getProperties:function(){if(this.data==null){var request=CQ.HTTP.get(CQ.HTTP.getPath(window.location.pathname)+".json");
this.data=CQ.Util.eval(request)
}var props=new Object();
props["Page Template"]=this.data.template;
props["Text Paragraph"]=this.data.text;
props["Image Paragraph"]=this.data.image;
props["Text Image Paragraph"]=this.data.textimage;
return props
},setProperties:function(a){this.props=a
},afterPropChange:function(){var b=this.props;
var a=new CQ.Ext.data.Connection();
a.request({scope:this,url:CQ.HTTP.getPath(window.location.pathname),params:{setconfig:"true",text:b["Text Paragraph"],image:b["Image Paragraph"],textimage:b["Text Image Paragraph"],template:b["Page Template"],type:"JSON",_charset_:"utf-8"},success:function(c,g){},failure:function(c,g){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not modify offline configuration."))
}})
}});
CQ.Ext.reg("offlineimporter",CQ.wcm.OfflineImporter);
CQ.wcm.SiteImporter=CQ.Ext.extend(CQ.Ext.Viewport,{constructor:function(a){this.results=document.createElement("iframe");
this.results.id="results_cq-siteimporter";
this.results.name="results_cq-siteimporter";
this.results.height="100%";
this.results.width="100%";
this.results.onload=this.onResultsLoad;
this.results.onreadystatechange=this.onResultsLoad;
var b=this;
CQ.wcm.SiteImporter.superclass.constructor.call(this,{id:"cq-siteimporter",layout:"border",renderTo:CQ.Util.getRoot(),items:[{id:"cq-siteimporter-wrapper",xtype:"panel",region:"center",layout:"border",border:false,items:[{id:"cq-header",xtype:"container",autoEl:"div",region:"north"},{xtype:"form",id:"cq-siteimporter-form",region:"center",fileUpload:true,standardSubmit:true,autoScroll:true,border:true,margins:"5 5 5 5",defaults:{anchor:"-54"},bodyStyle:"padding:10px",items:[{xtype:"textfield",fieldLabel:CQ.I18n.getMessage("Project Title"),fieldDescription:CQ.I18n.getMessage("Title of the new project"),name:"projectname",allowBlank:false},{xtype:"textfield",fieldLabel:CQ.I18n.getMessage("Site URL"),fieldDescription:CQ.I18n.getMessage("URL of the original site"),name:"original",allowBlank:false,vtype:"url"},{xtype:"fileuploadfield",fieldLabel:CQ.I18n.getMessage("Thumbnail"),fieldDescription:CQ.I18n.getMessage("Select thumbnail image for the template"),name:"preview"},{xtype:"selection",type:"checkbox",fieldLabel:CQ.I18n.getMessage("Overwrite"),fieldDescription:CQ.I18n.getMessage("Overwrite existing resources. If not checked import will fail if resources exist already."),name:"overwrite"},{xtype:"textarea",fieldLabel:CQ.I18n.getMessage("Sitemap"),fieldDescription:CQ.I18n.getMessage("Enter space indented sitemap for the sample content"),name:"sitemap"},{xtype:"selection",type:"select",options:"/libs/wcm/bin/siteimporter/components.json",fieldLabel:CQ.I18n.getMessage("Extend From Component"),fieldDescription:CQ.I18n.getMessage("You can optionally have the generated page component extend from another component, e.g. to create a mobile site."),name:"resourceSuperType"},{xtype:"hidden",name:"_charset_",value:"utf-8"}],buttonAlign:"left",buttons:[{id:"cq-siteimporter-btn-import",text:CQ.I18n.getMessage("Import Site"),handler:function(){var g=CQ.Ext.getCmp("cq-siteimporter-form").getForm();
if(g.isValid()){var c=CQ.Ext.getCmp("cq-siteimporter-btn-import");
c.setDisabled(true);
c=CQ.Ext.getCmp("cq-siteimporter-btn-extract");
c.setDisabled(true);
g.getEl().dom.action=CQ.HTTP.externalize(a.url);
g.getEl().dom.method="POST";
g.getEl().dom.target="results_cq-siteimporter";
g.submit()
}}},{id:"cq-siteimporter-btn-extract",text:CQ.I18n.getMessage("Insert Components"),disabled:true,handler:function(){var c=CQ.Ext.getCmp("cq-siteimporter");
CQ.shared.Util.open(CQ.HTTP.externalize("/etc/importers/site/extractor.html#"+c.originalPath))
}},new CQ.Ext.ProgressBar({id:"cq-siteimporter-progress",width:400,hidden:true})]},{xtype:"panel",id:"cq-siteimporter-log",region:"south",title:CQ.I18n.getMessage("Import Log"),margins:"-5 5 5 5",height:320,split:true,items:[new CQ.Ext.BoxComponent({autoEl:{tag:"div"},style:{width:"100%",height:"100%"},listeners:{render:function(c){new CQ.Ext.Element(b.results).appendTo(c.getEl())
}}})],plugins:[{init:function(g){if(g.collapsible){var c=g.region;
if((c=="north")||(c=="south")){g.on("collapse",function(){var j=g.ownerCt;
if(j.layout[c].collapsedEl&&!g.collapsedTitleEl){g.collapsedTitleEl=j.layout[c].collapsedEl.createChild({tag:"span",cls:"x-panel-collapsed-text",html:g.title})
}},false,{single:true})
}}}}]}]}]})
},onResultsLoad:function(){var a=CQ.Ext.getCmp("cq-siteimporter-btn-import");
a.setDisabled(false);
var b=CQ.Ext.getCmp("cq-siteimporter");
if(this.contentWindow.success){b.originalPath=this.contentWindow.success;
a=CQ.Ext.getCmp("cq-siteimporter-btn-extract");
a.setDisabled(false)
}}});
CQ.Ext.reg("siteimporter",CQ.wcm.SiteImporter);
CQ.wcm.AuditLogDialog=CQ.Ext.extend(CQ.Dialog,{store:null,constructor:function(c){this.debug=c.debug;
var a=new CQ.Ext.grid.ColumnModel([{header:CQ.I18n.getMessage("Modification"),dataIndex:"type"},{header:CQ.I18n.getMessage("Date"),dataIndex:"date"},{header:CQ.I18n.getMessage("User"),dataIndex:"user"}]);
var k=new CQ.Ext.grid.RowSelectionModel({singleSelect:true});
var j={autoLoad:false,proxy:new CQ.Ext.data.HttpProxy({url:"/bin/audit/page.json",method:"GET"}),baseParams:{start:0,limit:25},reader:new CQ.Ext.data.JsonReader({totalProperty:"results",root:"entries",fields:["type","date","user"]})};
this.store=new CQ.Ext.data.GroupingStore(j);
var g={xtype:"grid",region:"center",margins:"5 5 5 5",loadMask:true,stripeRows:true,cm:a,sm:k,viewConfig:new CQ.Ext.grid.GroupingView({forceFit:true}),store:this.store};
var b=new CQ.Ext.Panel({layout:"border",width:500,minHeight:500,statefull:false,items:[g]});
dialog=this;
c.items=[b];
c.buttons=[{text:CQ.I18n.getMessage("OK"),handler:function(){dialog.hide()
}}];
CQ.wcm.AuditLogDialog.superclass.constructor.call(this,c)
},loadContent:function(a){this.setTitle(CQ.I18n.getMessage("AuditLog for")+" "+a);
this.store.baseParams.path=a;
this.store.reload()
},initComponent:function(){CQ.wcm.AuditLogDialog.superclass.initComponent.call(this)
}});
CQ.Ext.reg("auditlogdialog",CQ.wcm.AuditLogDialog);
CQ.wcm.FindReplaceDialog=CQ.Ext.extend(CQ.Dialog,{selectedPaths:null,constructor:function(a){var c=this;
if(!a){a={}
}var j=new CQ.Ext.grid.CheckboxSelectionModel({listeners:{selectionchange:function(n){var m=n.getSelections();
c.selectedPaths=[];
for(var k=0;
k<m.length;
k++){c.selectedPaths.push(m[k].data.path)
}}}});
var g=function(n,m,k){if(k.data.deleted){m.attr='style="color:grey;"'
}return n
};
var b=function(){c.preview()
};
this.grid=new CQ.Ext.grid.GridPanel({id:"cq-findreplacedialog-grid",height:125,loadMask:true,stripeRows:true,cm:new CQ.Ext.grid.ColumnModel([j,{header:CQ.I18n.getMessage("Title"),dataIndex:"title",sortable:true,width:200,renderer:g},{header:CQ.I18n.getMessage("Path"),dataIndex:"path",sortable:true,width:212,renderer:g}]),sm:j,store:new CQ.Ext.data.SimpleStore({fields:CQ.wcm.FindReplaceDialog.FIELDS}),enableHdMenu:false,listeners:{rowdblclick:function(m,k){try{CQ.wcm.SiteAdmin.openPage(m.getStore().getAt(k).data.path)
}catch(n){}}}});
this.previewMessage=new CQ.Static({style:"text-align:center;line-height:150px;color:#aaa;border:solid #bbb 1px",height:125});
a={id:"find-replace-dialog",title:CQ.I18n.getMessage("Find & Replace"),items:{xtype:"panel",items:[{xtype:"pathfield",name:"s",fieldLabel:CQ.I18n.getMessage("Start in"),listeners:{change:function(){c.resetPreview()
},blur:function(){if(!/\/content\/.*/.test(this.getValue())){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Info"),CQ.I18n.getMessage("Start path must start with '/content'"));
this.el.focus()
}}}},{xtype:"trigger",name:"f",fieldLabel:CQ.I18n.getMessage("Find"),triggerClass:"x-form-search-trigger",onTriggerClick:b,listeners:{change:function(){c.resetPreview()
}}},{xtype:"textfield",name:"r",fieldLabel:CQ.I18n.getMessage("Replace")},{xtype:"checkbox",name:"cs",inputValue:"true",height:"auto",boxLabel:CQ.I18n.getMessage("Case sensitive"),listeners:{check:function(){c.resetPreview(true)
}}},{xtype:"checkbox",name:"wwo",inputValue:"true",boxLabel:CQ.I18n.getMessage("Whole words only"),listeners:{check:function(){c.resetPreview(true)
}}},this.previewMessage,this.grid]},listeners:{beforeshow:function(){this.resetForm();
this.resetPreview(true);
if(this.path){this.getField("s").setValue(this.path)
}},beforesubmit:function(){if((this.previewed||this.preview())&&this.selectedPaths.length>0){if(confirm(CQ.I18n.getMessage("Are you sure you want to replace '{0}' with '{1}' on all the selected page(s)?",[this.getField("f").getValue(),this.getField("r").getValue()]))){var k=CQ.HTTP.externalize(this.getField("s").getValue()+CQ.wcm.FindReplaceDialog.SUFFIX_REPLACE);
this.form.baseParams={p:[]};
while(this.selectedPaths.length>0){var m=this.selectedPaths.shift();
this.form.baseParams.p.push(m)
}this.formPanel.form.el.dom.action=k;
return true
}}else{CQ.Ext.Msg.alert(CQ.I18n.getMessage("Info"),CQ.I18n.getMessage("There is nothing to replace."))
}return false
}},okText:CQ.I18n.getMessage("Replace"),buttons:[{text:CQ.I18n.getMessage("Preview"),cls:"cq-btn-preview",handler:b},CQ.Dialog.OK,CQ.Dialog.CANCEL]};
CQ.wcm.FindReplaceDialog.superclass.constructor.call(this,a)
},preview:function(){if(!this.getField("s").getValue()){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Info"),CQ.I18n.getMessage("Enter where you want to start searching."));
this.getField("s").el.dom.focus();
return false
}if(!this.getField("f").getValue()){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Info"),CQ.I18n.getMessage("Enter what are you searching for."));
this.getField("f").el.dom.focus();
return false
}var c=this.getField("s").getValue()+CQ.wcm.FindReplaceDialog.SUFFIX_FIND;
c=CQ.HTTP.addParameter(c,"_charset_",this.getField("_charset_").getValue());
c=CQ.HTTP.addParameter(c,"f",this.getField("f").getValue());
c=CQ.HTTP.addParameter(c,"cs",this.getField("cs").getValue());
c=CQ.HTTP.addParameter(c,"wwo",this.getField("wwo").getValue());
c=CQ.HTTP.noCaching(c);
var n=new CQ.Ext.data.JsonReader({root:"matches",fields:CQ.wcm.FindReplaceDialog.FIELDS});
var q={};
try{var a=n.read(CQ.HTTP.get(c));
for(var k=0;
k<a.records.length;
k++){var j=a.records[k].data;
if(!q[j.path]){q[j.path]=[]
}var m=q[j.path];
m[m.length]=[j.title,j.path]
}}catch(o){}var g=[];
for(var b in q){g[g.length]=q[b][0]
}if(g.length>0){this.grid.getStore().loadData(g);
this.grid.getSelectionModel().selectAll();
this.grid.show();
this.previewMessage.hide();
this.previewed=this.getField("f").getValue();
return true
}else{this.resetPreview();
this.previewMessage.updateText(CQ.I18n.getMessage("No occurrences found"));
this.previewMessage.show();
return false
}},loadContent:function(a){this.path=a
},resetForm:function(){this.formPanel.getForm().reset()
},resetPreview:function(a){if(a||(this.previewed&&this.previewed!=this.getField("f").getValue())){this.previewed=null;
this.selectedPaths=[];
this.grid.hide();
this.previewMessage.updateText("");
this.previewMessage.show()
}}});
CQ.wcm.FindReplaceDialog.SUFFIX_FIND=".find.json";
CQ.wcm.FindReplaceDialog.SUFFIX_REPLACE=".replace.html";
CQ.wcm.FindReplaceDialog.FIELDS=[{name:"title"},{name:"path"}];
CQ.Ext.reg("findreplacedialog",CQ.wcm.FindReplaceDialog);
CQ.wcm.CreateVersionDialog=CQ.Ext.extend(CQ.Dialog,{constructor:function(a){var b=this;
if(!a){a={}
}a={xtype:"dialog",title:CQ.I18n.getMessage("Create Version"),formUrl:"/bin/wcmcommand",params:{cmd:"createVersion",_charset_:"utf-8"},items:{xtype:"panel",items:[{xtype:"fieldset",autoHeight:true,autoWidtht:true,stateful:false,items:[{id:"path",xtype:"hidden",allowBlank:false,name:"path"},{id:"label",fieldLabel:CQ.I18n.getMessage("Label"),xtype:"textfield",allowBlank:true,name:"label",width:300},{id:"comment",fieldLabel:CQ.I18n.getMessage("Comment"),xtype:"textfield",allowBlank:true,name:"comment",width:300}]}]},okText:CQ.I18n.getMessage("Create"),success:function(g,j){var c=CQ.HTTP.buildPostResponseFromHTML(j.response.responseText);
CQ.Notification.notifyFromResponse(c)
}};
a.buttons=CQ.Dialog.OKCANCEL;
a.width=600;
a.height=200;
CQ.wcm.CreateVersionDialog.superclass.constructor.call(this,a)
},loadContent:function(a,b){this.form.findField("path").setValue(a);
this.form.findField("label").setValue("");
this.form.findField("comment").setValue(CQ.I18n.getMessage("Created by ")+CQ.User.getCurrentUser().getUserName())
},initComponent:function(){CQ.wcm.CreateVersionDialog.superclass.initComponent.call(this)
}});
CQ.Ext.reg("createversiondialog",CQ.wcm.CreateVersionDialog);
CQ.wcm.CreateSiteWizard=CQ.Ext.extend(CQ.Dialog,{blueprintPath:null,sitePath:null,activePage:0,wizPanel:null,actListId:null,dataView:null,progressStore:null,progressTemplate:null,progressPanel:null,firstPanel:null,lastPanel:null,loadMask:null,constructor:function(c){var o=this;
var n=new CQ.Ext.data.Store({proxy:new CQ.Ext.data.HttpProxy({url:"/bin/wcm/templates",method:"GET"}),reader:new CQ.Ext.data.JsonReader({totalProperty:"results",root:"templates",id:"path"},["path","title","description","thumbnailPath","iconPath","ranking","hidden","sitePath"]),baseParams:{_charset_:"utf-8",path:"/content",type:"site"},listeners:{load:function(){this.filterBy(function(v){return !v.get("hidden")
});
this.sort("ranking")
}}});
var u=CQ.HTTP.externalize("/libs/cq/ui/widgets/themes/default/widgets/wcm/CreateSiteWizard/thumb-bp-default.png");
var r=new CQ.Ext.DataView({multiSelect:false,singleSelect:true,emptyText:CQ.I18n.getMessage("No template available"),store:n,overClass:"x-view-over",itemSelector:"div.template-item",tpl:new CQ.Ext.XTemplate('<tpl for=".">','<div class="template-item">','<tpl if="thumbnailPath">','<img class="template-thumbnail" src="{thumbnailPath}">',"</tpl>",'<tpl if="!thumbnailPath">','<img class="template-thumbnail" src="{this.defThumb}">',"</tpl>",'<div class="template-title">{title}</div>','<div class="template-description">{description}</div>','<div style="clear:both"></div>',"</div>","</tpl>",'<div style="height:5px;overflow:hidden"></div>',{defThumb:u}),prepareData:function(v){v.ranking=v.ranking!=null?v.ranking:900000000;
v.title=CQ.I18n.getVarMessage(v.title);
v.description=(v.description?CQ.I18n.getVarMessage(v.description):"");
return v
},listeners:{selectionchange:function(v){var w=v.getSelectedRecords()[0];
if(w&&w.data){o.setBlueprintInfo(w.data)
}}}});
this.dataView=r;
var g=[{idx:0,title:"Select Blueprint"},{idx:1,title:"Finish"}];
this.progressStore=g;
var b=new CQ.Ext.XTemplate('<div class="x-toolbar x-small-editor">','<table cellspacing="0"><tr>','<tpl for=".">','<tpl if="values.idx != 0">','<td><span class="wiz-sep">&rarr;</span></td>',"</tpl>",'<td><span class="wiz-step {[this.isActive(values.idx) ? "wiz-step-active" : ""]}">{#}. {title}</span></td>',"</tpl>","</table>","</div>",{isActive:function(v){return v==o.activePage
}});
this.progressTemplate=b;
var k=new CQ.Ext.Panel({id:"cq-createsitewizard-info",border:false,html:b.apply(g)});
this.progressPanel=k;
var m=new CQ.Ext.Panel({id:"cq-card-first",layout:"form",autoScroll:true,title:CQ.I18n.getMessage("Select Blueprint"),header:false,bodyStyle:CQ.themes.Dialog.TAB_BODY_STYLE,labelWidth:CQ.themes.Dialog.LABEL_WIDTH,defaultType:"textfield",stateful:false,defaults:{msgTarget:CQ.themes.Dialog.MSG_TARGET,anchor:CQ.themes.Dialog.ANCHOR,stateful:false},items:[{xtype:"hidden",name:"destPath"},{xtype:"hidden",name:"srcPath"},{fieldLabel:CQ.I18n.getMessage("Title"),fieldDescription:CQ.I18n.getMessage("Page title of the new site."),allowBlank:false,name:"./jcr:title"},{fieldLabel:CQ.I18n.getMessage("Name"),fieldDescription:CQ.I18n.getMessage("Page name of the new site."),name:"label",vtype:"itemname"},{xtype:"panel",border:false,cls:"cq-template-view",autoScroll:true,width:"100%",autoHeight:false,height:370,layout:"fit",items:r,listeners:{render:{fn:function(){n.load()
}}}}]});
this.firstPanel=m;
var t=new CQ.Ext.Panel({id:"cq-card-last",layout:"form",autoScroll:true,title:CQ.I18n.getMessage("Finish"),header:false,bodyStyle:CQ.themes.Dialog.TAB_BODY_STYLE,labelWidth:CQ.themes.Dialog.LABEL_WIDTH,stateful:false,defaults:{msgTarget:CQ.themes.Dialog.MSG_TARGET,anchor:CQ.themes.Dialog.ANCHOR,stateful:false},items:[{border:false,cls:"cq-card-last x-form-item",html:CQ.I18n.getMessage("<h1>Setup Complete</h1><p>You completed all steps. <br><br>Click the <em>Create Site</em> button below to create the new site.</p>")}]});
this.lastPanel=t;
var j=function(){o.navHandler.call(o,1)
};
var a=function(){o.navHandler.call(o,-1)
};
var q=new CQ.Ext.Panel({id:"cq-createsite-wizpanel",layout:"card",deferredRender:false,plain:CQ.themes.Dialog.TABPANEL_PLAIN,border:false,stateful:false,activeItem:0,bbar:k,defaults:{border:false},items:[m,t]});
this.wizPanel=q;
this.prevButton=new CQ.Ext.Button({text:CQ.I18n.getMessage("Prev"),cls:"cq-btn-prev",handler:a,disabled:true,minWidth:CQ.themes.Dialog.MIN_BUTTON_WIDTH});
this.nextButton=new CQ.Ext.Button({text:CQ.I18n.getMessage("Next"),cls:"cq-btn-next",handler:j,disabled:true,minWidth:CQ.themes.Dialog.MIN_BUTTON_WIDTH});
c={id:"cq-createsitewizard",title:CQ.I18n.getMessage("Create Site"),formUrl:"/bin/wcmcommand",params:{cmd:"createSite",_charset_:"utf-8"},height:560,width:600,items:[q],buttons:[this.prevButton,this.nextButton,CQ.Dialog.CANCEL]};
CQ.wcm.CreateSiteWizard.superclass.constructor.call(this,c)
},loadContent:function(a){this.getField("destPath").setValue(a.dstPath);
this.activePage=0;
this.actListId=null;
this.blueprintPath=null;
this.sitePath=null;
this.wizPanel.items.each(function(b){if(b.id!="cq-card-first"&&b.id!="cq-card-last"){this.remove(b,true)
}},this.wizPanel);
this.updateProgressBar();
this.wizPanel.layout.setActiveItem(0);
this.doLayout();
this.updateButtons()
},navHandler:function(c){var b=this.wizPanel.items.getCount();
var a=this.activePage+c;
if(a==b){this.ok()
}else{if(a>=0&&a<b){this.activePage=a;
this.wizPanel.layout.setActiveItem(a);
this.updateButtons()
}}},setBlueprintInfo:function(a){this.blueprintPath=a.path;
this.sitePath=a.sitePath;
this.getField("srcPath").setValue(a.path);
this.loadPanels()
},loadPanels:function(){var id=this.blueprintPath;
if(id!=this.actListId){if(!this.loadMask){this.loadMask=new CQ.Ext.LoadMask(this.wizPanel.body,{msg:"Loading..."})
}this.loadMask.show();
if(this.actListId){this.wizPanel.items.each(function(item){if(item.id!="cq-card-first"){this.remove(item,item.id!="cq-card-last")
}},this.wizPanel)
}this.actListId=id;
var url=CQ.HTTP.externalize(id+"/jcr:content/dialog.infinity.json");
var data=CQ.HTTP.eval(url);
if(data){var ct=CQ.utils.Util.formatData(data);
this.processExternalDialog(ct)
}this.wizPanel.add(this.lastPanel);
this.processPath(this.sitePath);
this.updateProgressBar();
this.doLayout();
this.updateButtons();
this.loadMask.hide()
}},updateProgressBar:function(){var b=[];
var a=0;
this.wizPanel.items.each(function(){b.push({title:this.title,idx:a++})
});
this.progressStore=b
},processExternalDialog:function(b){if(b&&b.items){if(b.items instanceof Array){for(var a=0;
a<b.items.length;
a++){this.processExternalItem(b.items[a])
}}else{this.processExternalItem(b.items)
}}},processExternalItem:function(c){if(c.xtype=="tabpanel"){this.processExternalDialog(c)
}else{if(c instanceof Array){for(var b=0;
b<c.length;
b++){this.processExternalItem(c[b])
}}else{var a=CQ.Util.applyDefaults(c,this.configDefaults.panel);
var g=a.title;
if(!g){g="untitled"
}a.header=false;
this.wizPanel.add(a)
}}},updateButtons:function(){var a=this.wizPanel.items.getCount();
if(this.activePage<a&&this.actListId){this.nextButton.enable();
if(this.activePage==a-1){this.nextButton.setText(CQ.I18n.getMessage("Create Site"))
}else{this.nextButton.setText(CQ.I18n.getMessage("Next"))
}}else{this.nextButton.disable();
this.nextButton.setText(CQ.I18n.getMessage("Next"))
}if(this.activePage>0){this.prevButton.enable()
}else{this.prevButton.disable()
}this.progressTemplate.overwrite(this.progressPanel.body,this.progressStore)
}});
CQ.wcm.CreateSiteWizard.setLanguagesCB=function(a){this.setOptions(CQ.wcm.CreateSiteWizard.getLanguagesCB(a))
};
CQ.wcm.CreateSiteWizard.getLanguagesCB=function(path){var flagRoot=CQ.HTTP.externalize("/libs/wcm/msm/resources/flags/");
var data=CQ.HTTP.eval(path+".languages.json");
var opts=[];
if(data.rows){var langTitles=CQ.I18n.getLanguages();
for(var i=0;
i<data.rows.length;
i++){var row=data.rows[i];
var img="<img style='position:absolute;left:2px;top:4px;height:12px;' src='"+flagRoot+row.country+".gif'>";
var lang=CQ.tagging.getTagLocaleCode(row.iso+"_"+row.country);
var lbl="<span style='padding-left: 32px'>"+(langTitles[lang]?langTitles[lang].title:row.language)+"</span>";
opts.push({text:img+lbl,value:row.path,checked:i==0})
}}return opts
};
CQ.wcm.CreateSiteWizard.setChaptersCB=function(a){this.setOptions(CQ.wcm.CreateSiteWizard.getChaptersCB(a))
};
CQ.wcm.CreateSiteWizard.getChaptersCB=function(path){var url="/libs/wcm/msm/content/commands/chapters.json?path="+path;
var data=CQ.HTTP.eval(url);
var opts=[];
if(data.rows){for(var i=0;
i<data.rows.length;
i++){var row=data.rows[i];
opts.push({text:row.displayText,value:row.path,checked:true})
}}return opts
};
CQ.Ext.reg("createsitewizard",CQ.wcm.CreateSiteWizard);
CQ.wcm.Page=function(g,a,c){if(!a){a=CQ.User.getCurrentUser()
}this.user=a;
if(g&&g.status){this.info=g.status;
this.msm=g.msm;
this.launches=g.launches;
this.loaded=true;
this.path=g.status.path
}else{if(g&&typeof g=="string"){var b=g.indexOf("/jcr:content");
if(b==g.length-12){g=g.substring(0,b)
}this.path=g
}}this.commandUrl=c?c:"/bin/wcmcommand"
};
CQ.wcm.Page.prototype=function(){return{path:null,user:null,info:null,infoUrl:null,commandUrl:null,loaded:false,isReadOnly:function(){var a=!this.user.hasPermissionOn(CQ.User.PERMISSION_UPDATE,this.path);
return a||(this.isLocked()&&!this.canUnlock())
},isDesignable:function(){if(!this.loaded){this.load()
}return this.info&&this.info.isDesignable
},hasPermission:function(a){return this.user.hasPermissionOn(a,this.path)
},hasPermssion:function(a){return this.hasPermission(a)
},isLocked:function(){if(!this.loaded){this.load()
}return this.info&&this.info.isLocked
},canUnlock:function(){if(this.isLocked()){return CQ.User.ADMIN==this.user.getUserID()||this.getLockOwner()==this.user.getUserID()
}return true
},getLockOwner:function(){if(this.isLocked()){return this.info.lockOwner
}},lock:function(b,a){CQ.HTTP.post(this.commandUrl,function(g,j,c){if(j){CQ.Notification.notify(CQ.I18n.getMessage("Lock Page"),CQ.I18n.getMessage("Page successfully locked"))
}else{CQ.Notification.notifyFromResponse(c)
}if(b&&typeof b=="function"){if(a){b.call(a,g,j,c)
}else{b(g,j,c)
}}},{_charset_:"utf-8",path:this.path,cmd:"lockPage"})
},unlock:function(b,a){CQ.HTTP.post(this.commandUrl,function(g,j,c){if(j){CQ.Notification.notify(CQ.I18n.getMessage("Unlock Page"),CQ.I18n.getMessage("Page successfully unlocked"))
}else{CQ.Notification.notifyFromResponse(c)
}if(b&&typeof b=="function"){if(a){b.call(a,g,j,c)
}else{b(g,j,c)
}}},{_charset_:"utf-8",path:this.path,cmd:"unlockPage"})
},isInBlueprint:function(){if(!this.loaded){this.load()
}return this.msm&&this.msm[CQ.wcm.msm.MSM.PARAM_IS_IN_BLUEPRINT]
},isLiveCopySource:function(){if(!this.loaded){this.load()
}return this.msm&&this.msm[CQ.wcm.msm.MSM.PARAM_IS_SOURCE]
},isLiveCopy:function(){if(!this.loaded){this.load()
}return this.msm&&this.msm[CQ.wcm.msm.MSM.PARAM_IS_LIVECOPY]
},load:function(){var a=CQ.WCM.getPageInfo(this.path);
if(a){this.info=a.status;
this.msm=a.msm;
this.launches=a.launches
}else{this.info={}
}this.loaded=true
}}
}();
CQ.wcm.Page.STATUS_SELECTOR=".status";
CQ.wcm.Page.STATUS_PATH="/libs/wcm/core/content/pageinfo";
CQ.Page=CQ.utils.Page=CQ.wcm.Page;
CQ.wcm.Page.getCreatePageDialog=function(b){var k=new CQ.Ext.data.Store({proxy:new CQ.Ext.data.HttpProxy({url:"/bin/wcm/templates",method:"GET"}),reader:new CQ.Ext.data.JsonReader({totalProperty:"results",root:"templates",id:"path"},["path","title","description","thumbnailPath","iconPath","ranking"]),baseParams:{_charset_:"utf-8",path:b},listeners:{load:function(){this.sort("ranking")
}}});
var j=new CQ.Ext.DataView({multiSelect:false,singleSelect:true,emptyText:CQ.I18n.getMessage("No template available"),store:k,overClass:"x-view-over",itemSelector:"div.template-item",tpl:new CQ.Ext.XTemplate('<tpl for=".">','<div class="template-item">','<tpl if="thumbnailPath">','<img class="template-thumbnail" src="{[CQ.shared.HTTP.getXhrHookedURL(CQ.shared.HTTP.externalize(CQ.shared.HTTP.encodePath(values.thumbnailPath)))]}">','<div class="template-title">{title}</div>','<div class="template-description">{description}</div>',"</tpl>","<tpl if=\"thumbnailPath == ''\">",'<div class="template-title template-no-thumbnail">{title}</div>','<div class="template-description template-no-thumbnail">{description}</div>',"</tpl>",'<div style="clear:both"></div>',"</div>","</tpl>",'<div style="height:5px;overflow:hidden"></div>'),prepareData:function(m){m.ranking=m.ranking!=null?m.ranking:900000000;
m.thumbnailPath=m.thumbnailPath?CQ.HTTP.externalize(m.thumbnailPath):"";
m.title=CQ.I18n.getVarMessage(m.title);
m.description=m.description?CQ.I18n.getVarMessage(m.description):"";
return m
}});
var g=new CQ.Ext.form.Hidden({name:"template"});
j.refresh=function(){this.clearSelections(false,true);
this.el.update("");
var n=[];
var m=this.store.getRange();
if(m.length<1){if(!this.deferEmptyText||this.hasSkippedEmptyText){this.el.update(this.emptyText)
}this.hasSkippedEmptyText=true;
this.all.clear();
return
}this.tpl.overwrite(this.el,this.collectData(m,0));
this.all.fill(CQ.Ext.query(this.itemSelector,this.el.dom));
this.updateIndexes(0);
this.select(0)
};
var a={"jcr:primaryType":"cq:Dialog",id:CQ.Util.createId("cq-createdialog"),title:CQ.I18n.getMessage("Create Page"),formUrl:CQ.shared.HTTP.externalize("/bin/wcmcommand"),params:{cmd:"createPage",_charset_:"utf-8"},height:520,items:{"jcr:primaryType":"cq:Panel",items:{"jcr:primaryType":"cq:WidgetCollection",title:{fieldLabel:CQ.I18n.getMessage("Title"),allowBlank:false,name:"title"},label:{fieldLabel:CQ.I18n.getMessage("Name"),vtype:"itemname",name:"label"},template:{xtype:"panel",border:false,cls:"cq-template-view",autoScroll:true,width:"100%",autoHeight:false,height:350,items:[g,j],listeners:{render:{fn:function(){k.load()
}}}}}},okText:CQ.I18n.getMessage("Create")};
var c=CQ.WCM.getDialog(a);
c.on("beforesubmit",function(){if(j.getSelectedRecords()[0]&&j.getSelectedRecords()[0].data){g.setRawValue(j.getSelectedRecords()[0].data.path)
}else{CQ.Ext.Msg.alert(CQ.I18n.getMessage("You must select a valid template"));
return false
}});
c.addHidden({parentPath:b});
return c
};
CQ.wcm.Page.getMovePageDialog=function(c,b){var a={id:CQ.Util.createId("cq-heavymovedialog"),path:c,vtype:b?null:"name"};
return new CQ.wcm.HeavyMoveDialog(a)
};
CQ.wcm.Page.getCopyPageDialog=function(j){var a=j.substring(0,j.lastIndexOf("/"));
var g=j.substring(j.lastIndexOf("/")+1);
var c=new CQ.Ext.form.Hidden({name:"shallow",value:false});
var k={"jcr:primaryType":"cq:Dialog",id:CQ.Util.createId("cq-copydialog"),title:CQ.I18n.getMessage("Copy Page"),formUrl:CQ.shared.HTTP.externalize("/bin/wcmcommand"),params:{cmd:"copyPage",_charset_:"utf-8",before:""},height:220,items:{"jcr:primaryType":"cq:Panel",items:[{xtype:"textfield",fieldLabel:CQ.I18n.getMessage("Copy"),allowBlank:false,name:"srcPath",readOnly:true,value:j},{fieldLabel:CQ.I18n.getMessage("To"),xtype:"pathfield",name:"destParentPath",value:a,listeners:{blur:function(){while(/(.*)\/$/.test(this.getValue())){this.setValue(this.getValue().replace(/(.*)\/$/,"$1"))
}}}},c,{fieldLabel:CQ.I18n.getMessage("Copy children"),xtype:"checkbox",name:"shallowCbx",checked:true,listeners:{check:function(n,m){c.setValue(!m)
}}},{xtype:"textfield",fieldLabel:CQ.I18n.getMessage("Copy name"),allowBlank:false,vtype:"itemname",name:"destName",value:g}]},okText:CQ.I18n.getMessage("Copy")};
var b=CQ.WCM.getDialog(k);
return b
};
CQ.wcm.Page.getCreateAssetShareDialog=function(a){var c=new CQ.Ext.form.Hidden({name:"templateAssetShare",value:"/libs/dam/templates/assetshare"});
var j=new CQ.Ext.form.Hidden({name:"templateAssetEditor",value:"/libs/dam/templates/asseteditor"});
var k=new CQ.Ext.form.Hidden({name:"templateAssetViewer",value:"/libs/dam/templates/assetviewer"});
var g={"jcr:primaryType":"cq:Dialog",title:CQ.I18n.getMessage("Create Asset Share"),id:CQ.Util.createId("cq-createassetsharedialog"),height:240,formUrl:CQ.shared.HTTP.externalize("/bin/wcmcommand"),params:{cmd:"createAssetShare",_charset_:"utf-8"},items:{"jcr:primaryType":"cq:Panel",items:[{fieldLabel:CQ.I18n.getMessage("Title"),fieldSubLabel:CQ.I18n.getMessage("Optional"),fieldDescription:CQ.I18n.getMessage('A separate title for the navigation, e.g. "My Asset Share"'),name:"title",allowBlank:false},{fieldLabel:CQ.I18n.getMessage("Name"),fieldDescription:CQ.I18n.getMessage('The name that will appear in the URL, e.g. "myassetshare"'),name:"label",vtype:"itemname"},c,j,k]},okText:CQ.I18n.getMessage("Create")};
var b=CQ.WCM.getDialog(g);
b.addHidden({parentPath:a});
return b
};
CQ.wcm.Design=function(b,a){this.path=b;
this.content=a
};
CQ.wcm.Design.prototype=function(){return{path:null,content:null,getPath:function(){return this.path
},getContent:function(){return this.content
},getStyleProperty:function(b,c){if(this.content==null){return null
}var m="";
var a=c.lastIndexOf("/");
if(a>0){m="/"+c.substring(0,a);
c=c.substring(a+1)
}var k=b.getSearchPaths();
for(var g=0;
g<k.length;
g++){var j=this.getStyleEntry(k[g]+m);
if(j&&j[c]!=null){return j[c]
}}return null
},getStyleEntry:function(g){var a=g.split("/");
var c=this.content;
for(var b=0;
b<a.length&&c;
b++){c=c[a[b]]
}return c
}}
}();
CQ.wcm.Cell=function(a){this.searchExpr=a
};
CQ.wcm.Cell.prototype=function(){return{searchExpr:null,searchPaths:null,names:null,getSearchPaths:function(){if(!this.searchPaths){this.calculateSearchPaths()
}return this.searchPaths
},getNames:function(){if(!this.searchPaths){this.calculateSearchPaths()
}return this.names
},getSearchExpression:function(){return this.searchExpr
},calculateSearchPaths:function(){this.names=[];
this.searchPaths=[];
var a=this.searchExpr.split("/");
var j={};
var m=[];
var k;
for(k=0;
k<a.length;
k++){if(a[k].length>0&&!j[a[k]]){j[a[k]]=true;
m[m.length]=a[k].split("|")
}}if(m.length>0){var b=0;
var g=m.length;
this.names=m[--g];
var o=[];
while(b<g){var c=m[b++];
if(this.searchPaths.length==0){for(k=0;
k<c.length;
k++){this.searchPaths[this.searchPaths.length]=c[k];
o[o.length]=c[k]
}}else{var n=this.multiply(o,c);
o=[];
for(k=0;
k<n.length;
k++){o[k]=n[k]
}for(k=0;
k<this.searchPaths.length;
k++){n[n.length]=this.searchPaths[k]
}this.searchPaths=n
}}this.searchPaths=this.multiply(this.searchPaths,this.names);
for(k=0;
k<this.names.length;
k++){this.searchPaths[this.searchPaths.length]=this.names[k]
}}},multiply:function(o,n){var g=[];
for(var c=0;
c<o.length;
c++){var m=o[c];
for(var b=0;
b<n.length;
b++){var a=n[b];
var k=m;
if(k.length>0){k+="/"
}k+=a;
g[g.length]=k
}}return g.concat(o)
}}
}();
CQ.wcm.ComponentList=CQ.Ext.extend(CQ.Ext.util.Observable,{path:null,allComponents:null,allowedComponents:{},allowedString:"",allowedByCell:{},constructor:function(b,a){this.path=b;
this.allComponents=a;
this.allowedByCell={};
this.addEvents("updatecomponents")
},update:function(r,n){var a=r.getSearchExpression();
var c=this.allowedString;
if(n){n=CQ.Ext.isArray(n)?n:[n];
var j={};
var k=0;
for(var g=0;
g<n.length;
g++){var b=n[g];
var m=b.substring(0,6);
if(m=="group:"){var q=b.substring(6);
for(b in this.allComponents){if(this.allComponents[b].group==q){j[b]=true;
k++
}}}else{if(m=="/libs/"||m=="/apps/"){b=b.substring(6)
}j[b]=true;
k++
}}this.allowedByCell[a]=j;
if(k>0){this.refresh()
}}else{var o=!!this.allowedByCell[a];
delete this.allowedByCell[a];
if(o){this.refresh()
}}if(c!=this.allowedString){this.fireEvent("updatecomponents",this)
}},refresh:function(){var c={};
var j="";
for(var g in this.allowedByCell){var b=this.allowedByCell[g];
if(b){for(var a in b){c[a]=true;
j+=a+","
}}}this.allowedComponents=c;
this.allowedString=j
},getAllComponents:function(){return this.allComponents
},getComponent:function(a){return this.allComponents[a]
},getAllowedComponents:function(a){var c;
if(a){c=this.allowedByCell[a.getSearchExpression()];
if(!c){return{}
}}else{c=this.allowedComponents
}var g={};
for(var b in c){g[b]=this.allComponents[b]
}return g
},isAllowed:function(b,a){return !!this.getAllowedComponents(a)[b]
}});
CQ.wcm.ComponentList.RECORD=CQ.Ext.data.Record.create([{name:"path"},{name:"title"},{name:"description"},{name:"thumbnail"},{name:"icon"},{name:"virtual"},{name:"config"},{name:"dialog"}]);
CQ.wcm.ComponentList.TEMPLATE=new CQ.Ext.XTemplate('<tpl for=".">','<table cellspacing="0" class="x-btn x-btn-noicon {[CQ.DOM.encodeClass(values.title, "cq-cmpt")]}" title="{description}"><tbody>','<tr><td class="x-btn-tl"><i>&#160;</i></td><td class="x-btn-tc"></td><td class="x-btn-tr"><i>&#160;</i></td></tr>','<tr><td class="x-btn-ml"><i>&#160;</i></td><td class="x-btn-mc"><em unselectable="on">','<button class="x-btn-text {[CQ.DOM.encodeClass(values.path)]}" type="button"','<tpl if="icon">',' style="background:transparent url({icon}) 0 3px no-repeat;padding:3px 0pt 2px 18px"',"</tpl>",">{title}</button>",'</em></td><td class="x-btn-mr"><i>&#160;</i></td></tr>','<tr><td class="x-btn-bl"><i>&#160;</i></td><td class="x-btn-bc"></td><td class="x-btn-br"><i>&#160;</i></td></tr>',"</tbody></table>","</tpl>");
CQ.wcm.ComponentList.loadPanel=function(g,c,b,j){var a=b?(b.isContainer&&!j?b.getCell():b.getParent().getCell()):null;
g.panel=c;
var k=a?a.getSearchExpression():"__sidekick__";
var n=g.getAllowedComponents(a);
var m=new CQ.Ext.util.MixedCollection();
CQ.wcm.ComponentList.updateStores(m,n,!!a);
m.each(function(t,q,r){var o=t.group;
if(o.toUpperCase()==="GENERAL"){o=CQ.I18n.get("General","Short label for general component group")
}else{if(o.toUpperCase()==="OTHER"){o=CQ.I18n.get("Other","Short label for component group that collects 'other' components")
}else{o=CQ.I18n.getVar(o)
}}o=!CQ.Ext.isIE8?o:CQ.Ext.util.Format.htmlEncode(o);
c.add(new CQ.Ext.Panel(CQ.Util.formatData({title:"",title_noI18n:o,cls:"cq-sidekick-buttons "+CQ.DOM.encodeClass(t.group,"cq-cmpts"),autoScroll:true,containerScroll:true,border:false,layout:"fit",items:CQ.wcm.ComponentList.createDataView(t,b),listeners:{collapse:function(){if(b){this.get(0).clearSelections();
b.selectInsertComponent(null)
}}}})))
},this);
c.doLayout()
};
CQ.wcm.ComponentList.MAX_GROUPS=4;
CQ.wcm.ComponentList.MIN_COMPS=3;
CQ.wcm.ComponentList.updateStores=function(g,j){for(var m in j){var b=j[m];
if(!b){continue
}if(!b.icon){b.icon=CQ.HTTP.externalize(CQ.themes.wcm.Sidekick.ICON_COMPONENT)
}b.icon=CQ.shared.HTTP.getXhrHookedURL(b.icon);
var k=b.group;
if(k==null||k==""){k="General"
}var n;
if(g.containsKey(k)){n=g.item(k)
}else{n=new CQ.Ext.data.Store({sortInfo:{field:"title",direction:"ASC"},reader:new CQ.Ext.data.DataReader({},CQ.wcm.ComponentList.RECORD)});
n.group=k;
g.add(k,n)
}b.title=CQ.I18n.getVarMessage(b.title);
n.addSorted(new CQ.Ext.data.Record(b,m))
}if(g.getCount()>CQ.wcm.ComponentList.MAX_GROUPS){var c="Other";
if(g.containsKey(c)){n=g.item(c)
}else{n=new CQ.Ext.data.Store({sortInfo:{field:"title",direction:"ASC"},reader:new CQ.Ext.data.DataReader({},CQ.wcm.ComponentList.RECORD)});
n.group=c
}g.each(function(o){if(o.group.toUpperCase()=="GENERAL"){return
}if(o.getCount()<CQ.wcm.ComponentList.MIN_COMPS){o.each(function(q){n.add(q)
});
g.remove(o)
}});
if(g.getCount()>CQ.wcm.ComponentList.MAX_GROUPS){g.sort("ASC",function(q,o){var r=q.getCount();
var t=o.getCount();
if(r>t){return 1
}else{if(r<t){return -1
}else{return 0
}}});
while(g.getCount()>CQ.wcm.ComponentList.MAX_GROUPS){var a=g.first();
a.each(function(o){n.add(o)
});
g.remove(a)
}}g.add(c,n)
}g.sort("ASC",function(q,o){var v=q.group.toUpperCase();
var r=CQ.I18n.getVarMessage(q.group);
var u=o.group.toUpperCase();
var t=CQ.I18n.getVarMessage(o.group);
if(v=="GENERAL"){return -1
}else{if(u=="GENERAL"){return 1
}}if(v=="OTHER"){return 1
}else{if(u=="OTHER"){return -1
}}if(r>t){return 1
}if(r<t){return -1
}return 0
});
return g
};
CQ.wcm.ComponentList.createDataView=function(c,a){var b={};
if(!a){b.render=function(g){var j={containerScroll:false};
if(CQ.utils.WCM.getContentFinder()){g.dragZone=new CQ.wcm.Sidekick.DragZone4ContentFinder(g,j)
}else{g.dragZone=new CQ.wcm.Sidekick.DragZone(g,j)
}g.dragZone.addToGroup(CQ.wcm.EditBase.DD_GROUP_COMPONENT);
g.dragZone.removeFromGroup(CQ.wcm.EditBase.DD_GROUP_DEFAULT);
CQ.wcm.Sidekick.componentsWithDragZone.push(g)
}
}else{b.click=function(j){try{a.selectInsertComponent(j.getSelectedRecords()[0])
}catch(g){}}
}return new CQ.Ext.DataView({tpl:CQ.wcm.ComponentList.TEMPLATE,autoHeight:true,autoWidth:true,border:false,singleSelect:true,multiSelect:false,overClass:"x-btn-over",selectedClass:"x-btn-selected",itemSelector:"table.x-btn",loadingText:CQ.I18n.getMessage("Loading components"),listeners:b,store:c,prepareData:function(g){g.description=g.description?CQ.I18n.getVarMessage(g.description):"";
if(g.virtual){g.virtualResourceType=g.path.substring(g.path.indexOf("/",1)+1)
}return g
}})
};
CQ.wcm.RestoreVersionDialog=CQ.Ext.extend(CQ.Dialog,{revisionsTable:null,versionsTable:null,gridStore:null,comboStore:null,dataUrl:null,path:null,fields:null,sm:null,constructor:function(b){var g=this;
if(!b){b={}
}this.dataUrl=b.dataUrl||"/bin/wcm/versions.json";
this.fields=[{name:"name"},{name:"title"},{name:"created"},{name:"label"},{name:"id"},{name:"deleted"},{name:"uuid"},{name:"baseName"},{name:"versionString"},{name:"isBaseVersion"}];
this.gridStore=new CQ.Ext.data.SimpleStore({fields:this.fields});
this.comboStore=new CQ.Ext.data.SimpleStore({fields:this.fields,sortInfo:{field:"created",direction:"DESC"}});
this.sm=new CQ.Ext.grid.CheckboxSelectionModel();
var a=new CQ.Ext.grid.ColumnModel([this.sm,{header:CQ.I18n.getMessage("UUID"),dataIndex:"uuid",hidden:true},{id:"title",header:CQ.I18n.getMessage("Title"),dataIndex:"title",sortable:true,width:150,renderer:function(n,k,j){var m=g.versionsTable[j.data.id];
if(m.deleted){k.attr='style="color:grey;"'
}return m.title
}},{id:"name",header:CQ.I18n.getMessage("Name"),dataIndex:"baseName",renderer:function(n,k,j){var m=g.versionsTable[j.data.id];
if(m.deleted){k.attr='style="color:grey;"'
}return m.deleted?m.name:n
}},{id:"id",header:CQ.I18n.getMessage("Version"),dataIndex:"id",editor:new CQ.Ext.form.ComboBox({triggerAction:"all",editable:false,store:this.comboStore,displayField:"versionString",valueField:"id",mode:"local"}),renderer:function(n,k,j){var m=g.versionsTable[j.data.id];
if(m.deleted){k.attr='style="color:grey;"'
}return m.label+" - "+m.created
}}]);
var c={xtype:"editorgrid",id:"restore-version-grid",region:"center",margins:"5 5 5 5",loadMask:true,stripeRows:true,cm:a,sm:this.sm,store:this.gridStore,enableHdMenu:false,autoExpandColumn:"id",listeners:{beforeedit:function(k){var j=g.revisionsTable[k.record.data.uuid];
g.comboStore.loadData(j)
}},clicksToEdit:1};
b=CQ.Util.applyDefaults(b,{xtype:"dialog",cls:"cq-restoreversiondialog",title:CQ.I18n.getMessage("Restore Version"),formUrl:b.formUrl||"/bin/wcmcommand",params:{cmd:"restoreVersion",_charset_:"utf-8"},items:{xtype:"panel",layout:"border",width:500,minHeight:500,stateful:false,items:[c]},listeners:{beforesubmit:function(){if(g.sm.hasSelection()){g.findById("restore-version-grid").stopEditing();
var k=CQ.Util.findFormFields(g.formPanel);
var o=k.path;
if(o){k.remove(o)
}o=k.id;
if(o){k.remove(o)
}g.addHidden({path:g.path});
var j=g.sm.getSelections();
for(var m=0;
m<j.length;
m++){var n=j[m];
g.addHidden({id:n.data.id})
}return true
}return false
}},okText:CQ.I18n.getMessage("Restore")});
b.buttons=CQ.Dialog.OKCANCEL;
CQ.wcm.RestoreVersionDialog.superclass.constructor.call(this,b)
},loadContent:function(y,v){this.path=y;
var c=CQ.HTTP.addParameter(this.dataUrl,"path",y);
if(v){c=CQ.HTTP.addParameter(c,"showChildren",true)
}c=CQ.HTTP.noCaching(c);
var u=new CQ.Ext.data.JsonReader({root:"versions",fields:this.fields});
var o={};
var m={};
var b=u.read(CQ.HTTP.get(c));
for(var t=0;
t<b.records.length;
t++){var q=b.records[t].data;
m[q.id]=q;
var a=q.uuid;
if(!o[a]){o[a]=[]
}var x=o[a];
var w=q.label+" - "+q.created;
if(q.baseName!=q.name){w+=" - "+q.name
}x[x.length]=[q.name,q.title,q.created,q.label,q.id,q.deleted,q.uuid,q.baseName,w]
}this.revisionsTable=o;
this.versionsTable=m;
var n=[];
for(a in o){var k=o[a];
var j=k[0];
for(t=0;
t<k.length;
t++){var g=k[t][4];
if(m[g].isBaseVersion){j=k[t];
break
}}n[n.length]=j
}this.gridStore.loadData(n);
this.sm.clearSelections()
},initComponent:function(){CQ.wcm.RestoreVersionDialog.superclass.initComponent.call(this)
}});
CQ.Ext.reg("restoreversiondialog",CQ.wcm.RestoreVersionDialog);
CQ.wcm.RestoreTreeDialog=CQ.Ext.extend(CQ.Dialog,{dataUrl:null,treeLoaderConfig:null,treePath:null,root:null,constructor:function(a){var j=this;
if(!a){a={}
}this.dataUrl=a.dataUrl||"/bin/wcm/versiontree";
var b=CQ.Util.applyDefaults(a.treeRoot||{},{name:"",text:CQ.I18n.getMessage("Site"),draggable:false,singleClickExpand:true,id:".",iconCls:"page"});
var g=CQ.Util.applyDefaults(a.treeLoader||{},{dataUrl:this.dataUrl,requestMethod:"GET",baseAttrs:{iconCls:"page",singleClickExpand:true},listeners:{beforeload:function(m,o){var n=j.form;
if(n&&n.isValid()){this.baseParams.path=n.findField("path").getValue();
this.baseParams.date=n.findField("date").getValue();
this.baseParams.preserveNVP=n.findField("preserveNVP").checked;
return true
}return false
}}});
var k=new CQ.Ext.tree.TreeLoader(g);
j.root=new CQ.Ext.tree.AsyncTreeNode(b);
var c=new CQ.Ext.tree.TreePanel({anchor:"100%",bodyBorder:CQ.themes.BrowseDialog.TREE_BORDER,bodyStyle:CQ.themes.BrowseDialog.TREE_STYLE,autoScroll:true,containerScroll:true,loader:k,root:j.root,defaults:{draggable:false},height:260,rootVisible:false});
a=CQ.Util.applyDefaults(a,{xtype:"dialog",cls:"cq-restoretreedialog",title:CQ.I18n.getMessage("Restore Tree"),formUrl:"/bin/wcmcommand",params:{cmd:"restoreTree",_charset_:"utf-8"},items:{xtype:"panel",items:[{xtype:"fieldset",autoHeight:true,autoWidtht:true,stateful:false,items:[{xtype:"pathfield",id:a.id?a.id+"-path":"",fieldLabel:CQ.I18n.getMessage("Choose a tree"),allowBlank:false,name:"path",readOnly:true,width:300,value:a.treePath||""},{fieldLabel:CQ.I18n.getMessage("Date"),xtype:"datetime",allowBlank:false,name:"date",value:a.date||new Date(),valueAsString:true},{boxLabel:CQ.I18n.getMessage("Preserve non versioned pages"),xtype:"checkbox",inputValue:"true",name:"preserveNVP"},{xtype:"button",id:a.id?a.id+"-show":"",text:CQ.I18n.getMessage("Show Revisions"),handler:function(){k.load(j.root)
}}]},c]},listeners:{beforesubmit:function(){return j.root.hasChildNodes()
}},okText:CQ.I18n.getMessage("Restore")});
a.buttons=CQ.Dialog.OKCANCEL;
a.width=600;
a.height=470;
CQ.wcm.RestoreTreeDialog.superclass.constructor.call(this,a)
},loadContent:function(a){this.form.findField("path").setValue(a);
this.form.findField("date").setValue(new Date());
while(this.root.firstChild){this.root.removeChild(this.root.firstChild)
}},initComponent:function(){CQ.wcm.RestoreTreeDialog.superclass.initComponent.call(this)
}});
CQ.Ext.reg("restoretreedialog",CQ.wcm.RestoreTreeDialog);
CQ.wcm.HeavyMoveDialog=CQ.Ext.extend(CQ.Dialog,{store:null,dataPath:null,path:null,vtype:null,maxRefNo:150,constructor:function(g){if(!g){g=new Object()
}this.dataPath=g.dataPath;
if(!this.dataPath){this.dataPath="/bin/wcm/heavymove"
}this.vtype=g.vtype?g.vtype:"itemname";
this.path=decodeURIComponent(g.path);
var n=new CQ.wcm.HeavyMoveDialog.CheckColumn({header:CQ.I18n.getMessage("Adjust"),dataIndex:"adjust",enabledIf:"adjustable",width:40});
var o=new CQ.wcm.HeavyMoveDialog.CheckColumn({header:CQ.I18n.getMessage("Republish"),dataIndex:"publish",enabledIf:"published",width:60});
var u=CQ.Util.copyObject(CQ.wcm.SiteAdmin.COLUMNS.modified);
u.width=120;
var t=new CQ.Ext.grid.ColumnModel([n,o,{header:CQ.I18n.getMessage("Title"),dataIndex:"title",width:120},{id:"path",header:CQ.I18n.getMessage("Path"),dataIndex:"path",width:170},u]);
t.defaultSortable=true;
var k=this;
var b=CQ.HTTP.addParameter(this.dataPath,"path",this.path);
b=CQ.HTTP.addParameter(b,"_charset_","utf-8");
b=CQ.HTTP.addParameter(b,"maxRefNo",this.maxRefNo);
b=CQ.shared.HTTP.externalize(b);
this.store=new CQ.Ext.data.JsonStore({url:b,root:"pages",totalProperty:"totalPages",fields:[{name:"title"},{name:"path"},{name:CQ.shared.XSS.getXSSPropertyName("path")},{name:"published"},{name:"adjustable"},{name:"publish",defaultValue:true},{name:"adjust",defaultValue:true},{name:"lastModifiedBy"},{name:CQ.shared.XSS.getXSSPropertyName("lastModifiedBy")},{name:"lastModified"},{name:"replication"}],listeners:{beforeload:function(){k.loadingRefs=true
},load:function(w,v,x){k.loadingRefs=false
},loadexception:function(y,w,v){k.loadingRefs=false;
try{var x=CQ.Ext.decode(v.responseText);
CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getVarMessage(x.message))
}catch(z){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Unexpected error while loading move dialog"))
}k.hide()
}}});
var a=new CQ.Ext.grid.GridPanel({cls:"cq-heavymove",store:this.store,stateful:false,cm:t,height:238,disableSelection:true,enableHdMenu:false,autoExpandColumn:"path",clicksToEdit:1,viewConfig:{renderBody:function(){if(this.grid.store.getTotalCount()>k.maxRefNo){this.emptyText=CQ.I18n.get("The move you are about to make has more than {0} references and will be automatically adjusted and republished",[k.maxRefNo])
}var v=this.renderRows()||"&#160;";
return this.templates.body.apply({rows:v})
},emptyText:CQ.I18n.getMessage("No references to display")},loadMask:{msg:CQ.I18n.getMessage("Loading references...")}});
n.init(a);
o.init(a);
a.on("headerclick",function(w,v,y){if(v==0||v==1){var z=v==0?"adjust":"publish";
var x;
w.store.each(function(A){if(typeof x=="undefined"){x=!A.data[z]
}A.set(z,x);
A.dirty=false;
return true
})
}return true
});
var m=this.path.lastIndexOf("/");
var c=this.path.substring(0,m);
var j=this.path.substring(m+1);
var q=g.dstParentPath?decodeURIComponent(g.dstParentPath):c;
var r=g.dstName?decodeURIComponent(g.dstName):j;
g=CQ.Util.applyDefaults(g,{xtype:"dialog",title:CQ.I18n.getMessage("Move"),formUrl:CQ.shared.HTTP.externalize("/bin/wcmcommand"),params:{cmd:"movePage",integrity:"true",_charset_:"utf-8"},fileUpload:true,items:{xtype:"panel",items:[{xtype:"fieldset",title:CQ.I18n.get("Location"),autoHeight:true,autoWidtht:true,stateful:false,items:[{xtype:"textfield",anchor:"100%",fieldLabel:CQ.I18n.getMessage("Move"),allowBlank:false,name:"srcPath",readOnly:true,value:this.path},{fieldLabel:CQ.I18n.getMessage("to"),xtype:"pathfield",anchor:"100%",name:"destParentPath",value:q,listeners:{blur:function(){while(/(.*)\/$/.test(this.getValue())){this.setValue(this.getValue().replace(/(.*)\/$/,"$1"))
}}}},{xtype:"textfield",anchor:"100%",fieldLabel:CQ.I18n.getMessage("Rename to"),allowBlank:false,vtype:this.vtype,name:"destName",value:r}]},a]},listeners:{show:function(){a.getStore().load()
}},failure:function(){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("An error occured while moving page"))
}});
g.buttons=[{text:CQ.I18n.getMessage("Move"),cls:"cq-btn-move",disabled:false,handler:function(){if(this.loadingRefs){CQ.Ext.Msg.show({title:CQ.I18n.getMessage("Move Page"),msg:CQ.I18n.getMessage("Please wait until the references are loaded."),buttons:CQ.Ext.Msg.OK,icon:CQ.Ext.Msg.WARNING});
return
}var w=this;
var v=this.getField("destParentPath").getValue();
if(v==this.path||v.indexOf(this.path+"/")==0){CQ.Ext.Msg.show({title:CQ.I18n.getMessage("Move Page"),msg:CQ.I18n.getMessage("Page cannot be moved below itself."),buttons:CQ.Ext.Msg.OK,icon:CQ.Ext.Msg.ERROR});
return
}r=this.getField("destName").getValue();
if(v==q&&r==j){CQ.Ext.Msg.show({title:CQ.I18n.getMessage("Move Page"),msg:CQ.I18n.getMessage("Page cannot be moved. Plase change the destination or rename it."),buttons:CQ.Ext.Msg.OK,icon:CQ.Ext.Msg.ERROR});
return
}CQ.Ext.Msg.confirm(CQ.I18n.getMessage("Move Page"),CQ.I18n.getMessage("Do you really want to move the page to the selected destination?"),function(x){if(x=="yes"){w.ok.call(w)
}})
}},CQ.Dialog.CANCEL];
g.width=600;
g.height=470;
CQ.wcm.HeavyMoveDialog.superclass.constructor.call(this,g);
this.on("beforesubmit",function(){var z=this;
var w=[];
var v=[];
if(z.store.data.length>0){for(var x=0;
x<z.store.data.items.length;
x++){var y=z.store.data.items[x];
if(y.data.adjust&&y.data.adjustable){w.push(y.data.path)
}if(y.data.publish&&y.data.published){v.push(y.data.path)
}}z.addHidden({adjust:JSON.stringify(w)});
z.addHidden({publish:JSON.stringify(v)})
}else{if(z.store.getTotalCount()>z.maxRefNo){z.addHidden({retrieveAll:true})
}}return true
})
}});
CQ.Ext.reg("heavymovedialog",CQ.wcm.HeavyMoveDialog);
CQ.wcm.HeavyMoveDialog.CheckColumn=function(a){CQ.Ext.apply(this,a);
if(!this.id){this.id=CQ.Ext.id()
}this.renderer=this.renderer.createDelegate(this)
};
CQ.wcm.HeavyMoveDialog.CheckColumn.prototype={init:function(a){this.grid=a;
this.grid.on("render",function(){var b=this.grid.getView();
b.mainBody.on("mousedown",this.onMouseDown,this)
},this)
},onMouseDown:function(g,c){if(c.className&&c.className.indexOf("x-grid3-cc-"+this.id)!=-1){g.stopEvent();
var b=this.grid.getView().findRowIndex(c);
var a=this.grid.store.getAt(b);
a.set(this.dataIndex,!a.data[this.dataIndex]);
a.dirty=false
}},renderer:function(b,c,a){if(!this.enabledIf||a.data[this.enabledIf]){c.css+=" x-grid3-check-col-td";
return'<div class="x-grid3-check-col'+(b?"-on":"")+" x-grid3-cc-"+this.id+'">&#160;</div>'
}else{return"&nbsp;"
}}};
CQ.wcm.AssetReferenceSearchDialog=CQ.Ext.extend(CQ.Dialog,{store:null,dataPath:null,path:null,constructor:function(config){if(!config){config=new Object()
}this.dataPath=config.dataPath;
if(!this.dataPath){this.dataPath="/libs/wcm/core/content/reference.json"
}this.path=config.path;
var colActivate=new CQ.wcm.AssetReferenceSearchDialog.CheckColumn({id:"publish",header:CQ.I18n.getMessage("(Re)Publish"),dataIndex:"publish",width:80});
var cm=new CQ.Ext.grid.ColumnModel([colActivate,{id:"name",header:CQ.I18n.getMessage("Name"),dataIndex:"name",renderer:function(v,params,rec){var p=rec.get("path");
return'<span ext:qtip="'+p+'">'+v+"</span>"
}},{id:"status",header:CQ.I18n.getMessage("Status on Publish"),dataIndex:"status",width:120,renderer:function(v,params,rec){return v=="outdated"?CQ.I18n.getMessage("Outdated"):CQ.I18n.getMessage("Not available")
}},{header:CQ.I18n.getMessage("Type"),dataIndex:"type",hidden:true,groupRenderer:function(v){switch(v){case"asset":return CQ.I18n.getMessage("Assets");
case"tag":return CQ.I18n.getMessage("Tags");
case"config":return CQ.I18n.getMessage("Configurations");
case"campaign":return CQ.I18n.getMessage("Campaigns (will activate experiences and teasers as well)");
case"product":return CQ.I18n.getMessage("Products");
default:return CQ.I18n.getMessage("Unknown")
}}}]);
cm.defaultSortable=true;
var url=CQ.HTTP.addParameter(this.dataPath,"path",this.path);
url=CQ.HTTP.addParameter(url,"_charset_","UTF-8");
var hmd=this;
this.store=new CQ.Ext.data.GroupingStore({reader:new CQ.Ext.data.JsonReader({root:"assets",fields:[{name:"type"},{name:"name"},{name:"path"},{name:"published"},{name:"outdated"},{name:"status"},{name:"publish",defaultValue:true},{name:"disabled"}]}),url:url,groupField:"type",sortInfo:{field:"type",direction:"ASC"},listeners:{beforeload:function(){hmd.loadingRefs=true
},load:function(){hmd.loadingRefs=false;
var dlg=this;
if(this.getTotalCount()==0){hmd.callback(hmd.path)
}else{hmd.show()
}}}});
var grid=new CQ.Ext.grid.GridPanel({store:this.store,stateful:false,cm:cm,flex:1,disableSelection:true,enableHdMenu:false,autoExpandColumn:"name",clicksToEdit:1,loadMask:{msg:CQ.I18n.getMessage("Loading references...")},view:new CQ.Ext.grid.GroupingView({groupTextTpl:"{group}"})});
colActivate.init(grid);
config=CQ.Util.applyDefaults(config,{xtype:"dialog",title:CQ.I18n.getMessage("Activate"),formUrl:"/bin/replicate.json",items:{xtype:"panel",layout:"vbox",layoutConfig:{padding:"0 15 0 0"},items:[{xtype:"static",height:30,cls:"x-form-item-description",text:CQ.I18n.getMessage("The following items need to be published along with the selected page(s):")},grid]},listeners:{render:function(){grid.getStore().load()
}},callback:function(paths){CQ.Log.WARN("No callback defined")
}});
config.buttons=[{text:CQ.I18n.getMessage("Activate"),cls:"cq-btn-move",disabled:false,handler:function(){if(this.loadingRefs){CQ.Ext.Msg.show({title:CQ.I18n.getMessage("Activate"),msg:CQ.I18n.getMessage("Please wait until the references are loaded."),buttons:CQ.Ext.Msg.OK,icon:CQ.Ext.Msg.WARNING});
return
}var dlg=this;
var references=[];
dlg.store.each(function(r){if(r.data.publish){if(r.data.type=="campaign"){var childPages=CQ.utils.HTTP.eval(r.data.path+".3.json");
var offerPage,teaserPage;
for(offerPage in childPages){var content=childPages[offerPage];
if(content["jcr:content"]){var offerPath=r.data.path+"/"+offerPage;
references.push(offerPath);
for(teaserPage in content){var teaserContent=content[teaserPage];
if(teaserContent["jcr:content"]){references.push(offerPath+"/"+teaserPage)
}}}}}references.push(r.data.path)
}});
dlg.path=references.concat(dlg.path);
dlg.callback(dlg.path);
dlg.hide()
}},CQ.Dialog.CANCEL];
config.width=600;
config.height=370;
CQ.wcm.AssetReferenceSearchDialog.superclass.constructor.call(this,config)
}});
CQ.Ext.reg("assetreferencesearchdialog",CQ.wcm.AssetReferenceSearchDialog);
CQ.wcm.AssetReferenceSearchDialog.CheckColumn=function(a){CQ.Ext.apply(this,a);
if(!this.id){this.id=CQ.Ext.id()
}this.renderer=this.renderer.createDelegate(this)
};
CQ.wcm.AssetReferenceSearchDialog.CheckColumn.prototype={init:function(a){this.grid=a;
this.grid.on("render",function(){var b=this.grid.getView();
b.mainBody.on("mousedown",this.onMouseDown,this)
},this)
},onMouseDown:function(g,c){if(c.className&&c.className.indexOf("x-grid3-cc-"+this.id)!=-1){g.stopEvent();
var b=this.grid.getView().findRowIndex(c);
var a=this.grid.store.getAt(b);
a.set("publish",!a.data.publish);
a.dirty=false
}},renderer:function(b,c,a){if(b&&a.data.type=="campaign"&&!a.data.initialRender){b=false;
a.data.publish=b;
a.data.initialRender=true
}if(!a.data[this.id].disabled){c.css+=" x-grid3-check-col-td";
return'<div class="x-grid3-check-col'+(b?"-on":"")+" x-grid3-cc-"+this.id+'">&#160;</div>'
}else{return""
}}};
CQ.wcm.ReferencesDialog=CQ.Ext.extend(CQ.Dialog,{TXT_REFERENCE:CQ.I18n.getMessage("reference"),TXT_REFERENCES:CQ.I18n.getMessage("references"),store:null,dataPath:null,path:null,constructor:function(b){var g=this;
if(!b){b=new Object()
}this.dataPath=b.dataPath;
if(!this.dataPath){this.dataPath="/bin/wcm/references"
}this.addEvents("pageopen");
this.path=b.path;
var a=new CQ.Ext.grid.ColumnModel([{header:CQ.I18n.getMessage("Title"),dataIndex:"title",width:130},{header:CQ.I18n.getMessage("srcPath"),dataIndex:"srcPath",width:130,hidden:true},{header:CQ.I18n.getMessage("srcTitle"),dataIndex:"srcTitle",width:130,hidden:true},{id:"path",header:CQ.I18n.getMessage("Path"),dataIndex:"path",width:220}]);
a.defaultSortable=true;
this.store=new CQ.Ext.data.GroupingStore({proxy:new CQ.Ext.data.HttpProxy({url:this.dataPath,method:"GET"}),baseParams:{_charset_:"utf-8",path:this.path,predicate:"wcmcontent",exact:true},reader:new CQ.Ext.data.JsonReader({root:"pages",totalProperty:"results",fields:[{name:"title",type:"string"},{name:"path",type:"string"},{name:"srcPath",type:"string"},{name:"srcTitle",type:"string"}]}),sortInfo:{field:"srcPath",direction:"ASC"},groupField:"srcPath",listeners:{load:function(j,m,k){if(m.length==0){CQ.Ext.Msg.alert(CQ.I18n.getMessage("No References"),g.path.length==1?CQ.I18n.getMessage("The selected item is not referenced."):CQ.I18n.getMessage("The selected items are not referenced."),function(){g.close()
})
}}}});
var c=new CQ.Ext.grid.GridPanel({store:this.store,stateful:false,cm:a,sm:new CQ.Ext.grid.RowSelectionModel({singleSelect:true}),frame:false,view:new CQ.Ext.grid.GroupingView({forceFit:true,groupTextTpl:'{[values.rs[0].data.srcTitle]} ({[values.rs.length]} {[values.rs.length > 1 ? "'+this.TXT_REFERENCES+'" : "'+this.TXT_REFERENCE+'"]})'}),disableSelection:true,enableHdMenu:false,hideHeaders:true,autoExpandColumn:"path",listeners:{rowdblclick:function(k,j,n){var m=k.store.getAt(j);
g.fireEvent("pageopen",g,m.data.path)
}}});
b={xtype:"dialog",title:CQ.I18n.getMessage("References"),formUrl:"/bin//dev/null",items:[c]};
b.buttons=[CQ.Dialog.CANCEL];
b.width=600;
b.height=370;
CQ.wcm.ReferencesDialog.superclass.constructor.call(this,b)
},initComponent:function(){this.store.load();
CQ.wcm.ReferencesDialog.superclass.initComponent.call(this)
}});
CQ.Ext.reg("referencesdialog",CQ.wcm.ReferencesDialog);
CQ.wcm.LanguageCopyDialog=CQ.Ext.extend(CQ.Dialog,{store:null,path:null,rootPath:null,createNonEmptyAncestors:false,constructor:function(g){if(!g){g=new Object()
}var n=this;
this.path=g.path;
this.rootPath=g.path;
var c=this.path+".languages.json?deep=true";
var b=CQ.HTTP.externalize("/libs/wcm/msm/resources/flags/");
var o=new CQ.Ext.grid.ColumnModel([{id:"path",header:CQ.I18n.getMessage("Path"),dataIndex:"path"}]);
o.defaultSortable=false;
var q=[];
var m={};
this.store=new CQ.Ext.data.Store({proxy:new CQ.Ext.data.HttpProxy({url:c}),reader:new CQ.Ext.data.JsonReader(),listeners:{metachange:function(r,x){n.rootPath=x.rootPath;
var w=[];
q=x.fields;
for(var t=0;
t<x.fields.length;
t++){var v=x.fields[t];
if(v.name=="path"){var y=CQ.I18n.getMessage("Path");
y+="<br>"+x.rootPath+"/*";
w.push({id:"path",header:y,dataIndex:"path",title:" "});
continue
}m[v.name]=new CQ.Ext.data.SimpleStore({fields:["value","text"]});
var y=CQ.I18n.getVarMessage(v.text);
var u=v.country=="ar"?"sa":v.country;
var z='<img style="height:24px" src="'+b+u+'.gif" alt="'+y+'" title="'+y+'">';
z+="<br>"+y;
w.push({header:z,title:y,dataIndex:v.name,renderer:CQ.wcm.LanguageCopyDialog.LangRenderer,width:64,editor:new CQ.Ext.form.ComboBox({listWidth:140,triggerAction:"all",editable:false,store:m[v.name],valueField:"value",displayField:"text",mode:"local"})});
w.sort(function(B,A){if(B.title<A.title){return -1
}else{if(B.title==A.title){return 0
}else{return 1
}}})
}o.setConfig(w)
}}});
var a=new CQ.Ext.grid.EditorGridPanel({flex:1,store:this.store,stateful:false,cm:o,margin:"12",frame:false,disableSelection:true,enableHdMenu:false,autoExpandColumn:"path",clicksToEdit:1,listeners:{beforeedit:function(v){if(v.value.hasContent){return false
}var t=[["",CQ.I18n.getMessage("(auto)")],["-",CQ.I18n.getMessage("(ignore)")]];
for(var w=0;
w<q.length;
w++){var u=q[w];
if(u.name=="path"||u.name==v.field){continue
}if(v.record.data[u.name].hasContent){var r=CQ.I18n.getVarMessage(u.text);
t.push([u.name,r]);
t.push([u.name+"+",r+"+"])
}}m[v.field].loadData(t)
}}});
var j=new CQ.Ext.form.Checkbox({fieldLabel:CQ.I18n.getMessage("Create non-empty missing ancestors"),fieldDescription:CQ.I18n.getMessage("The missing ancestors of the selected pages will be created as empty pages if this is left unchecked."),listeners:{check:function(r,t){n.createNonEmptyAncestors=t
}}});
var k=new CQ.Ext.Panel({layout:"form",labelWidth:195,width:"100%",items:[j]});
g=CQ.Util.applyDefaults(g,{xtype:"dialog",title:CQ.I18n.getMessage("Language Copy"),formUrl:"/bin/wcmcommand",params:{cmd:"copyLanguages",_charset_:"utf-8"},items:[a,k],layout:{type:"vbox",flex:1}});
g.buttons=[{text:CQ.I18n.getMessage("OK"),handler:function(){a.stopEditing();
if(n.store.getModifiedRecords().length==0){CQ.Ext.Msg.show({title:CQ.I18n.getMessage("Language Copy"),msg:CQ.I18n.getMessage("No copy operations specified."),buttons:CQ.Ext.Msg.OK,icon:CQ.Ext.Msg.ERROR});
return
}var r=(n.createNonEmptyAncestors?CQ.I18n.getMessage("Warning: Any missing ancestors of the selected pages will also be copied."):CQ.I18n.getMessage("Warning: Any missing ancestors of the selected pages will be created as empty pages."));
CQ.Ext.Msg.confirm(CQ.I18n.getMessage("Language Copy"),CQ.I18n.getMessage("Do you really want to copy the respective pages?")+"<br>\n"+r,function(t){if(t=="yes"){n.ok.call(n)
}})
}},CQ.Dialog.CANCEL];
g.width=700;
g.height=500;
CQ.wcm.LanguageCopyDialog.superclass.constructor.call(this,g);
this.on("beforesubmit",function(){var z=this;
z.addHidden({path:z.rootPath});
z.addHidden({createNonEmptyAncestors:z.createNonEmptyAncestors});
var u=z.store.getModifiedRecords();
for(var w=0;
w<u.length;
w++){var x=u[w];
for(var A in x.data){if(A=="path"){continue
}var t=x.data[A];
if(t&&(typeof t!="object")){var y={};
y[A+"/"+x.data.path]=t;
z.addHidden(y)
}}}return true
})
},initComponent:function(){this.store.load();
CQ.wcm.LanguageCopyDialog.superclass.initComponent.call(this)
}});
CQ.Ext.reg("languagecopydialog",CQ.wcm.LanguageCopyDialog);
CQ.wcm.LanguageCopyDialog.LangRenderer=function(b,c,a){if(typeof b=="object"){return b&&b.hasContent?"X":""
}else{return b
}};
CQ.wcm.ContentFinderDragZone=CQ.Ext.extend(CQ.Ext.dd.DragZone,{scroll:false,IDDM_startX:0,IDDM_startY:0,IDDM_dragThreshMet:false,dropTargets:[],dropTargetRegions:[],constructor:function(b,a){b.on("remove",function(){this.destroy()
},this);
b.on("destroy",function(){this.destroy()
},this);
CQ.wcm.ContentFinderDragZone.superclass.constructor.call(this,b,a)
},destroy:function(){clearTimeout(this.IDDM_clickTimeout);
CQ.Ext.EventManager.un(document,"mousemove",this.IDDM_handleMouseMove,this);
CQ.Ext.EventManager.un(document,"mouseup",this.IDDM_handleMouseUp,this);
CQ.wcm.ContentFinderDragZone.superclass.destroy.call(this)
},matchRange:function(c,a,b){if(!c||!a){return false
}if(!b){b=20
}return(a[0]>c[0]-b&&a[0]<c[0]+b&&a[1]>c[1]-b&&a[1]<c[1]+b)
},updateMouseInfo:function(a,c){try{this.mouse.time=new Date().valueOf();
this.mouse.pos=[a,c]
}catch(b){}},onDragEnter:function(c,g){var b=(typeof g=="string")?CQ.Ext.dd.DragDropMgr.getDDById(g):g;
this.cachedTarget=b;
if(this.beforeDragEnter(b,c,g)!==false){if(b.isNotifyTarget){var a=b.notifyEnter(this,c,this.dragData);
this.proxy.setStatus(a)
}else{this.proxy.setStatus(this.dropAllowed)
}if(this.afterDragEnter){this.afterDragEnter(b,c,g)
}}},onDragCancel:function(){},GEN_handleKeyPress:function(a){if(!CQ.WCM.isContentWindowLoading()){if(a.getKey()==a.ESC){CQ.Ext.EventManager.un(document,"mouseup",this.IDDM_handleMouseUp,this);
CQ.Ext.EventManager.un(document,"keypress",this.GEN_handleKeyPress,this);
CQ.WCM.getContentWindow().CQ.Ext.EventManager.un(CQ.WCM.getContentWindow().document,"keypress",this.GEN_handleKeyPress,this);
if(this.proxy){this.proxy.repair(this.getRepairXY(a,this.dragData),this.afterRepair,this)
}clearTimeout(this.IDDM_clickTimeout);
this.onDragCancel(a,this.cachedTarget);
this.IDDM_dragCurrent=false;
this.dragging=false;
window.setTimeout(this.CF_cleanUpDD,1)
}}},handleMouseDown:function(j){if(!CQ.WCM.isContentWindowLoading()){if(this.primaryButtonOnly&&j.button!=0&&j.type!="mousedown"){return
}if(this.isLocked()){return
}this.CF_cleanUpDD();
var g=new CQ.Ext.lib.Point(CQ.Ext.lib.Event.getPageX(j),CQ.Ext.lib.Event.getPageY(j));
if(this.IDDM_isOverTarget(g,this)&&this.clickValidator(j)){CQ.Ext.EventManager.on(document,"mousemove",this.IDDM_handleMouseMove,this);
CQ.Ext.EventManager.on(document,"mouseup",this.IDDM_handleMouseUp,this);
CQ.Ext.EventManager.on(document,"keypress",this.GEN_handleKeyPress,this);
CQ.WCM.getContentWindow().CQ.Ext.EventManager.on(CQ.WCM.getContentWindow().document,"keypress",this.GEN_handleKeyPress,this);
this.setStartPosition();
if(this.dragging){return
}this.IDDM_dragCurrent=true;
var c=this.getDragData(j);
if(c&&this.onBeforeDrag(c,j)!==false){this.dragData=c;
this.proxy.stop()
}this.b4MouseDown(j);
this.onMouseDown(j);
this.IDDM_startX=j.getPageX();
this.IDDM_startY=j.getPageY();
this.IDDM_deltaX=this.IDDM_startX-this.getEl().offsetLeft;
this.IDDM_deltaY=this.IDDM_startY-this.getEl().offsetTop;
this.IDDM_dragThreshMet=false;
var a=j.getPageX();
var k=j.getPageY();
var b=this;
this.IDDM_clickTimeout=setTimeout(function(){b.IDDM_startDrag(a,k)
},this.DDM.clickTimeThresh);
this.IDDM_stopEvent(j)
}}},CF_storeDropTargets:function(c){if(!CQ.WCM.isContentWindowLoading()){if(!c.isVisible()||!c.getDropTargets||!this.isDropAllowed){return
}if(c.isDropAllowedForObject&&(typeof(c.isDropAllowedForObject)=="function")){if(!c.isDropAllowedForObject(this.dragData)){return
}}var b=c.getDropTargets();
if(!b){return
}var a=CQ.WCM.getContentWindow();
try{if(!a.CQ){return
}}catch(m){return
}for(var g=0;
g<b.length;
g++){var k=b[g];
if(k.isLocked()||!this.isDropAllowed(k)){continue
}var j=a.CQ.Ext.lib.Region.getRegion(k.getEl());
this.dropTargets.push(k);
this.dropTargetRegions.push(j)
}}},CF_cleanUpDD:function(){CQ.wcm.ContentFinder.unmaskFrame();
this.dropTargets=[];
this.dropTargetRegions=[];
this.dragging=false;
this.IDDM_dragCurrent=false
},CF_b4StartDrag:function(a,m){if(!CQ.WCM.isContentWindowLoading()){var k=CQ.WCM.getContentFinder();
if(!k){throw new Error("No finder defined")
}k.contentWindowLeft=CQ.Ext.get("cq-cf-framewrapper").getX();
var c=CQ.wcm.ContentFinder.maskFrame();
this.dropTargets=[];
this.dropTargetRegions=[];
var b=CQ.WCM.getContentWindow();
try{if(!b.CQ){return
}}catch(j){return
}var g=this;
window.setTimeout(function(){var o=b.CQ.WCM.getDialogs();
for(var B in o){var x=o[B];
if(!x.isVisible()){continue
}var n=x.getActiveTab();
var w=CQ.Util.findFormFields(n);
for(var q in w){var r=w[q];
for(var v=0;
v<r.length;
v++){g.CF_storeDropTargets(r[v],g)
}}g.CF_storeDropTargets(n,g)
}var y=k.getContentWindow().CQ.WCM.getEditables();
for(var B in y){g.CF_storeDropTargets(y[B],g)
}var z=k.getContentWindow().CQ.WCM.getDropTargetComponents();
var u=z.length;
for(var A=0;
A<u;
A++){g.CF_storeDropTargets(z[A],g)
}CQ.Log.debug("CQ.wcm.ContentFinderDragZone#CF_b4StartDrag: drag started, drop targets found",g.dropTargets);
CQ.wcm.ContentFinderDragZone.debug_toggleDropTargetsMark(g.dropTargets,true)
},1);
this.mouse={pos:[-1,-1],lastPos:[-1,-1],time:0}
}},CF_handleMouseMove:function(o){if(!CQ.WCM.isContentWindowLoading()){var a=CQ.WCM.getContentFinder();
if(!a){throw new Error("No finder defined")
}var m=CQ.WCM.getContentWindow();
try{if(!m.CQ){return
}}catch(o){return
}var c=[];
var b=CQ.Ext.get(CQ.wcm.ContentFinder.FRAME_ID);
if(!b){throw new Error("No frame defined")
}var r=o.getPageX()-b.getRegion()[0]+m.CQ.Ext.dd.DDM.getScrollLeft();
var q=o.getPageY()-b.getRegion()[1]+m.CQ.Ext.dd.DDM.getScrollTop();
var g=this.dropTargetRegions;
for(var j=0;
j<g.length;
j++){if(g[j].contains(new CQ.Ext.lib.Point(r,q))){var k=this.dropTargets[j];
if(k.isLocked()){continue
}if(this.IDDM_dragCurrent.enableMultipleEventsFiring){c.push(k)
}else{if(c.length==0){c.push(k)
}else{c[0]=m.CQ.Ext.dd.DragDropMgr.getTopfrontElement(c[0],k)
}}}}CQ.Log.trace("CQ.wcm.ContentFinderDragZone#CF_handleMouseMove: mouve is moving, resolved drop targets (mouse over)",c);
for(var j=0;
j<c.length;
j++){var n=c[j];
if(n==this.cachedTarget){this.onDragOver(o);
this.updateMouseInfo(r,q);
return
}else{if(this.cachedTarget){CQ.wcm.ContentFinderDragZone.debug_toggleDropTargetMark(this.cachedTarget,true,false);
this.onDragOut(o)
}CQ.wcm.ContentFinderDragZone.debug_toggleDropTargetMark(n,true,true);
this.onDragEnter(o,n);
this.updateMouseInfo(r,q);
return
}}if(this.cachedTarget){CQ.wcm.ContentFinderDragZone.debug_toggleDropTargetMark(this.cachedTarget,true,false);
this.onDragOut(o)
}this.updateMouseInfo(r,q)
}},IDDM_startDrag:function(a,b){clearTimeout(this.IDDM_clickTimeout);
if(this.IDDM_dragCurrent){this.b4StartDrag(a,b);
this.CF_b4StartDrag(a,b);
this.startDrag(a,b)
}this.IDDM_dragThreshMet=true
},IDDM_handleMouseMove:function(c){if(!this.IDDM_dragCurrent||c.type!="mousemove"){return true
}if(CQ.Ext.isIE){document.selection.empty()
}if(CQ.Ext.isIE&&(c.button!==0&&c.button!==1&&c.button!==2)){this.IDDM_stopEvent(c);
return this.IDDM_handleMouseUp(c)
}if(!this.IDDM_dragThreshMet){var b=Math.abs(this.IDDM_startX-c.getPageX());
var a=Math.abs(this.IDDM_startY-c.getPageY());
if(b>this.DDM.clickPixelThresh||a>this.DDM.clickPixelThresh){this.IDDM_startDrag(this.IDDM_startX,this.IDDM_startY)
}}if(this.IDDM_dragThreshMet){this.b4Drag(c);
this.onDrag(c);
this.CF_handleMouseMove(c)
}this.IDDM_stopEvent(c);
return true
},IDDM_handleMouseUp:function(a){if(!CQ.WCM.isContentWindowLoading()){if(CQ.Ext.QuickTips){CQ.Ext.QuickTips.enable()
}if(!this.IDDM_dragCurrent){return
}CQ.wcm.ContentFinderDragZone.debug_toggleDropTargetsMark(this.dropTargets,false);
clearTimeout(this.IDDM_clickTimeout);
CQ.Ext.EventManager.un(document,"mouseup",this.IDDM_handleMouseUp,this);
CQ.Ext.EventManager.un(document,"keypress",this.GEN_handleKeyPress,this);
CQ.WCM.getContentWindow().CQ.Ext.EventManager.un(CQ.WCM.getContentWindow().document,"keypress",this.GEN_handleKeyPress,this);
if(this.IDDM_dragThreshMet){if(this.cachedTarget){this.onDragDrop(a)
}else{this.onInvalidDrop(this.cachedTarget,a)
}}if(this.IDDM_dragCurrent){if(this.IDDM_dragThreshMet){this.b4EndDrag(a);
this.endDrag(a)
}}this.IDDM_dragCurrent=false;
this.dragging=false;
this.IDDM_stopEvent(a);
window.setTimeout(this.CF_cleanUpDD,1)
}},stopPropagation:true,preventDefault:true,IDDM_stopEvent:function(a){if(this.stopPropagation){a.stopPropagation()
}if(this.preventDefault){a.preventDefault()
}},addToGroup:function(a){this.groups[a]=true
},removeFromGroup:function(a){if(this.groups[a]){delete this.groups[a]
}},setHandleElId:function(a){if(typeof a!=="string"){a=CQ.Ext.id(a)
}this.handleElId=a
},unreg:function(){CQ.Ext.EventManager.un(this.id,"mousedown",this.handleMouseDown,this);
this._domRef=null
},isLocked:function(){return this.locked
},clickValidator:function(b){var a=b.getTarget();
return(this.isValidHandleChild(a)&&(this.id==this.handleElId))
},IDDM_isOverTarget:function(j,a){var k=this.IDDM_getLocation();
if(!k){return false
}this.cursorIsOver=k.contains(j);
if(!this.IDDM_dragCurrent||(!a&&!this.constrainX&&!this.constrainY)){return this.cursorIsOver
}this.overlap=null;
var m=this.getTargetCoord(j.x,j.y);
var c=this.getDragEl();
var g=new CQ.Ext.lib.Region(m.y,m.x+c.offsetWidth,m.y+c.offsetHeight,m.x);
var b=g.intersect(k);
if(b){this.overlap=b;
return(a)?true:this.cursorIsOver
}else{return false
}},IDDM_getLocation:function(){var j=this.getEl(),o,g,c,u,q,v,a,n,k;
try{o=CQ.Ext.lib.Dom.getXY(j)
}catch(m){}if(!o){return null
}g=o[0];
c=g+j.offsetWidth;
u=o[1];
q=u+j.offsetHeight;
v=u-this.padding[0];
a=c+this.padding[1];
n=q+this.padding[2];
k=g-this.padding[3];
return new CQ.Ext.lib.Region(v,a,n,k)
}});
CQ.wcm.ContentFinderDragZone.DEBUG=false;
CQ.wcm.ContentFinderDragZone.debug_toggleDropTargetsMark=function(b,c,a){for(var g=0;
g<b.length;
g++){CQ.wcm.ContentFinderDragZone.debug_toggleDropTargetMark(b[g],c,a)
}};
CQ.wcm.ContentFinderDragZone.debug_toggleDropTargetMark=function(j,c,b){if(CQ.wcm.ContentFinderDragZone.DEBUG&&j&&j.getEl){var a=CQ.WCM.getContentWindow();
var g=a.CQ.Ext.get(j.getEl());
if(c){if(b){g.removeClass("cq-cf-dd-debug-unresolved");
g.addClass("cq-cf-dd-debug-resolved")
}else{g.removeClass("cq-cf-dd-debug-resolved");
g.addClass("cq-cf-dd-debug-unresolved")
}}else{g.removeClass("cq-cf-dd-debug-resolved");
g.removeClass("cq-cf-dd-debug-unresolved")
}}};
CQ.wcm.ContentFinder=CQ.Ext.extend(CQ.Ext.Viewport,{path:null,url:null,contentWindow:null,contentWindowLeft:0,toolbarCt:null,linkElements:[],constructor:function(n){this.debug=n.debug;
var c=this;
if(!document.title){document.title=CQ.wcm.ContentFinder.TITLE
}var t=CQ.Ext.getBody();
t.setStyle("margin","0");
if(CQ.Ext.isIE){t.dom.scroll="no"
}else{t.setStyle("overflow","hidden")
}n=CQ.Util.applyDefaults(n,{sidekick:{xtype:"sidekick"}});
CQ.Ext.EventManager.on(document,"mouseup",function(){CQ.wcm.ContentFinder.unmaskFrame()
});
var r=CQ.HTTP.getAnchor(document.location.href);
if(r&&r!=CQ.wcm.ContentFinder.EXTERNAL_URL){this.url=this.isValidURL(r)?r:CQ.Ext.SSL_SECURE_URL
}else{if(n.path){this.url=n.path+".html"
}}this.urlWithParams=this.url;
var k=document.createElement("iframe");
var a=this.url;
if(a&&!top.CQ_PORTAL_API){a=CQ.HTTP.externalize(a)
}k.src=a?a:CQ.Ext.SSL_SECURE_URL;
k.id=CQ.wcm.ContentFinder.FRAME_ID;
k.name=CQ.wcm.ContentFinder.FRAME_ID;
k.frameBorder="0";
k.border="0";
var j=new CQ.Ext.Element(k);
j.addClass("cq-frame");
var m=new CQ.Ext.BoxComponent({id:CQ.wcm.ContentFinder.FRAME_CT_ID,autoEl:{tag:"div"},style:{width:"100%",height:"100%"}});
m.on("render",function(){(function(){j.appendTo(m.getEl())
}).defer(16,this)
});
var g=function(){c.contentWindow=frames[CQ.wcm.ContentFinder.FRAME_ID];
try{var y=c.contentWindow.location.href
}catch(B){if(CQ.HTTP.getAnchor(window.location.href)!=CQ.wcm.ContentFinder.EXTERNAL_URL){document.title=CQ.wcm.ContentFinder.TITLE;
c.url=c.urlWithParams=CQ.wcm.ContentFinder.EXTERNAL_URL;
CQ.Ext.History.add(decodeURI(CQ.wcm.ContentFinder.EXTERNAL_URL),true,true)
}return
}c.contentWindow.onscroll=function(I){var H=CQ.WCM.getContentFinder();
if(H){H.onContentScroll(arguments)
}};
var E=CQ.HTTP.internalize(c.contentWindow.location.href);
var u=CQ.HTTP.removeParameters(E);
if(u==CQ.Ext.SSL_SECURE_URL){return
}if(E!=c.urlWithParams){c.url=u;
c.urlWithParams=E;
CQ.Ext.History.add(decodeURI(E),true,true)
}try{document.title=c.contentWindow.document.title;
var D=document.getElementsByTagName("head")[0];
for(var z=0;
z<c.linkElements.length;
z++){D.removeChild(c.linkElements[z])
}c.linkElements=[];
var F=c.contentWindow.document.getElementsByTagName("link");
for(var x=0;
x<F.length;
x++){var C=F[x];
var G=C.rel?C.rel.toLowerCase():"";
if(G.indexOf("icon")!=-1||G.indexOf("alternate")!=-1){var w=document.createElement("link");
w.rel=C.rel;
if(C.href){w.href=C.href
}if(C.type){w.type=C.type
}if(C.title){w.title=C.title
}D.appendChild(w);
c.linkElements.push(w)
}}}catch(B){}CQ.WCM.onClipboardChange(function(H){if(!c.clipboardLocked){c.clipboardLocked=true;
window.setTimeout(function(){var J=CQ.WCM.getClipboardRecords();
var I=c.clipboard.items.first().store;
if(I.getCount()){I.removeAll()
}if(J.length>0){I.add(J);
c.clipboard.expand()
}c.clipboardLocked=false
},100)
}});
var A=CQ.HTTP.getParameter(CQ.WCM.getContentUrl(),CQ.wcm.ContentFinder.SIDEVIEW_PARAM);
if(A!=null){var u=A+".html";
u=CQ.HTTP.addParameter(u,"wcmmode","disabled");
c.collapse();
c.openSideBoard(CQ.HTTP.externalize(u),CQ.Ext.getBody().getWidth()/2)
}var v=CQ.WCM.getPagePath();
if(v){c.refreshTabs(v)
}};
var o=function(){var u=frames[CQ.wcm.ContentFinder.FRAME_ID];
if(typeof u.CQ!="undefined"&&typeof u.CQ.utils!="undefined"&&typeof u.CQ.utils.WCM!="undefined"&&u.CQ.utils.WCM.getSidekick()){window.setTimeout(g,50)
}else{window.setTimeout(function(){o()
},1000)
}};
j.on("load",o);
this.clipboard=new CQ.Ext.Panel({xtype:"panel",region:"south",title:CQ.I18n.getMessage("Clipboard"),id:CQ.wcm.ContentFinder.CLIPBOARD_ID,stateful:true,height:CQ.themes.wcm.ContentFinder.CLIPBOARD_HEIGHT,tools:[{id:"refresh",handler:function(u){CQ.WCM.clearClipboard()
},scope:c}],collapseMode:"mini",collapsible:true,collapsed:true,split:true,animate:true,autoScroll:true,items:[{xtype:"dataview",cls:"cq-cf-clipboard",border:false,layout:"fit",multiSelect:true,overClass:"x-view-over",selectedClass:"x-view-selected",tpl:CQ.wcm.ContentFinder.CLIPBOARD_TEMPLATE,itemSelector:CQ.wcm.ContentFinder.CLIPBOARD_ITEMSELECTOR,store:new CQ.Ext.data.SimpleStore({fields:["path","xtype","action"],data:[]}),prepareData:function(u){u.qtip=u.path;
u.title=CQ.Ext.util.Format.ellipsis(u.title,32);
u.icon=CQ.HTTP.externalize(u.icon);
return u
}}]});
this.toolbarPref=CQ.User.getCurrentUser().getPreference("toolbarDisplay");
if(!this.toolbarPref){this.toolbarPref="ondemand"
}var q={id:"cq-cf",layout:"border",renderTo:"CQ",stateful:true,stateEvents:["pathselected"],items:[{id:"cq-cf-wrapper",xtype:"panel",layout:"border",region:"center",border:false,items:[{id:"cq-cf-west",stateful:true,xtype:"panel",region:"west",layout:"border",collapseMode:"mini",collapsible:true,hideCollapseTool:true,split:true,animate:true,border:false,width:CQ.themes.wcm.ContentFinder.FINDER_WIDTH,margins:"5 0 0 5",items:[{xtype:"tabpanel",region:"center",id:CQ.wcm.ContentFinder.TABPANEL_ID,stateful:true,deferredRender:false,enableTabScroll:true,border:false},this.clipboard],listeners:{beforeexpand:function(){var u=CQ.Ext.getCmp(CQ.wcm.ContentFinder.TABPANEL_ID);
u.hide();
c.lazyLoad(n)
},expand:function(){c.doLayout();
var u=CQ.Ext.getCmp(CQ.wcm.ContentFinder.TABPANEL_ID);
u.show()
}}},{xtype:"panel",stateful:false,id:"cq-cf-framewrapper",region:"center",layout:"fit",items:{xtype:"panel",layout:"border",border:false,items:[{id:"cq-cf-toolbar-ct",xtype:"panel",region:"north",cls:"cq-cf-toolbar-ct",autoHeight:true,border:false,header:false,layout:"column",collapsed:this.toolbarPref!="always",collapsible:true,collapseMode:"mini",animCollapse:false,items:[{xtype:"toolbar",items:[{text:CQ.I18n.getMessage("Copy"),handler:function(){CQ.WCM.copy(CQ.WCM.getSelectedItems())
}},{text:CQ.I18n.getMessage("Cut"),handler:function(){CQ.WCM.cut(CQ.WCM.getSelectedItems())
}},{text:CQ.I18n.getMessage("Paste"),handler:function(){var w=CQ.WCM.getSelectedItems();
if(w.length<1){return
}var A=CQ.undo.util.MultiUndoUtils;
var v=A.begin();
var x=w[0];
var u=CQ.WCM.paste();
while(u.length>0){var z=u.shift();
if(z.action!=CQ.WCM.ACTION_CUT){x.copyParagraph(z.path,z.resourceType,z.hasAnnotations)
}else{A.determineMoveInformation(v,z);
var y=x.moveParagraph(z.path,z.resourceType,z.hasAnnotations);
if(y){A.addMoveAction(v,y,x)
}}}A.reverseActions(v);
A.commit(v)
}},{text:CQ.I18n.getMessage("Delete"),handler:function(){CQ.WCM.remove(CQ.WCM.getSelectedItems())
}},"-"]}]},{xtype:"panel",region:"center",border:false,items:m}]}},{xtype:"panel",stateful:false,id:"cq-cf-east",region:"east",layout:"fit",collapseMode:"mini",collapsible:true,hideCollapseTool:true,collapsed:true,split:true,animate:true,width:400,border:false,hidden:true,hideMode:"offsets",listeners:{collapse:function(u){u.items.each(function(){u.remove(this,true)
});
u.hide()
}}}]}],listeners:{beforeshow:function(){if(CQ.WCM.isEditMode()){this.expand(false)
}else{this.collapse(false)
}}}};
CQ.wcm.ContentFinder.superclass.constructor.call(this,q);
if(!c.isCollapsed()){c.lazyLoad(n)
}CQ.WCM.getTopWindow().CQ_ContentFinder=this;
new CQ.Ext.form.Hidden({id:CQ.Ext.History.fieldId,renderTo:CQ.Util.ROOT_ID});
var b=document.createElement("iframe");
b.id=CQ.Ext.History.iframeId;
b.src="javascript:false";
b.className="x-hidden";
b.frameBorder="0";
b.border="0";
new CQ.Ext.Element(b).appendTo(CQ.Util.getRoot());
CQ.Ext.History.init();
CQ.Ext.History.on("change",function(v){if(v==CQ.wcm.ContentFinder.EXTERNAL_URL){return
}var w=decodeURI(c.urlWithParams);
if(v!=w){var u=c.isValidURL(v)?v:CQ.Ext.SSL_SECURE_URL;
CQ.wcm.ContentFinder.loadContentWindow(u,true)
}});
CQ.Util.observeComponent(this,CQ.VERY_SHORT_INTERVAL)
},getContentWindow:function(){return this.contentWindow?this.contentWindow:frames[CQ.wcm.ContentFinder.FRAME_ID]
},getClipboard:function(){return CQ.WCM.getClipboard(this)
},getToolbarCt:function(){return CQ.Ext.getCmp("cq-cf-toolbar-ct")
},loadToolbar:function(a){if(this.toolbarPref!="never"){var b=this.getToolbarCt();
b.add(a);
b.doLayout(false,true);
b.items.get(0).hide();
if(b.collapsed){b.expand()
}}},unloadToolbar:function(){if(this.toolbarPref!="never"){var a=this.getToolbarCt();
while(a.items.getCount()>1){a.remove(a.items.get(a.items.getCount()-1))
}a.doLayout();
if(this.toolbarPref=="always"){a.items.get(0).show()
}else{if(!a.collapsed){a.collapse()
}}}},collapse:function(){CQ.Ext.getCmp("cq-cf-west").collapse()
},expand:function(){CQ.Ext.getCmp("cq-cf-west").expand()
},openSideBoard:function(b,j){var g=document.createElement("iframe");
g.src=b;
g.frameBorder="0";
g.border="0";
var c=new CQ.Ext.Element(g);
c.addClass("cq-frame");
c.setStyle("height","100%");
var a=new CQ.Ext.BoxComponent({autoEl:{tag:"div"},style:{width:"100%",height:"100%"}});
a.on("render",function(){c.appendTo(a.getEl())
});
var k=CQ.Ext.getCmp("cq-cf-east");
if(j){k.setWidth(j)
}k.add(a);
k.show();
k.expand()
},closeSideBoard:function(){var a=CQ.Ext.getCmp("cq-cf-east");
a.collapse()
},isSideBoardCollapsed:function(){var a=CQ.Ext.getCmp("cq-cf-east");
return a.collapsed
},isCollapsed:function(){var a=CQ.Ext.getCmp("cq-cf-west");
return a.collapsed
},onContentScroll:function(){var c=CQ.Ext.getCmp("cq-cf-east");
var a=c.items.get(0);
if(a){var b=a.getEl();
if(b){var g=this.getContentWindow().scrollY
}}},observe:function(){var a=this.getEl().getScroll();
if(a.top||a.left){if(CQ.Ext.isIE&&CQ.Ext.isStrict){}else{window.scroll(0,0)
}}},getFrame:function(){return CQ.Ext.get(CQ.wcm.ContentFinder.FRAME_ID)
},getFrameContainer:function(){return CQ.Ext.get(CQ.wcm.ContentFinder.FRAME_CT_ID)
},setupAllTabs:function(a){var c={};
for(var b=0;
b<a.length;
b++){var g=a[b];
g.id=g.id||CQ.Ext.id();
c[g.id]=g
}for(var b=0;
b<a.length;
b++){var g=a[b];
if(g.override&&c[g.override]){c[g.id]=CQ.Util.applyDefaults(c[g.id],c[g.override]);
delete c[g.override]
}}a=[];
for(var j in c){a.push(c[j])
}this.allTabs=a
},getVisibleTabs:function(q){var m=this.allTabs;
var n=[];
if(m){for(var g=0;
g<m.length;
g++){var o=m[g];
var k=false;
if(o.hidden){if(CQ.Ext.isFunction(o.hidden)){k=o.hidden.call(o,o,q)
}else{k=(o.hidden===true)
}}if(!k){if(q&&o.allowedPaths){k=true;
var b=CQ.Ext.isArray(o.allowedPaths)?o.allowedPaths:[o.allowedPaths];
for(var c=0;
c<b.length;
c++){var a=new RegExp(b[c],"i");
if(q.search(a)!=-1){k=false
}}}else{k=false
}}if(!k){n.push(o)
}}}return CQ.Util.sortByRanking(n)
},refreshTabs:function(j){var c=CQ.Ext.getCmp(CQ.wcm.ContentFinder.TABPANEL_ID);
if(c){var b=false;
var a=this.getVisibleTabs(j);
if(a.length!=c.items.getCount()){b=true
}else{c.items.each(function(n,k,m){if(n.id!=a[k].id){b=true;
return false
}})
}if(b){c.getEl().mask(CQ.I18n.getMessage("Loading..."));
c.removeAll();
var g=this.getVisibleTabs(j);
if(g.length>0){c.add(g);
c.setActiveTab(g[0].id)
}c.getEl().unmask()
}}},lazyLoad:function(c){var j=this;
if(!j.isInitialized){var b=c.items!=undefined?c.items:[];
if(c.extensions){if(c.extensions[CQ.wcm.ContentFinder.EXTENSIONS_TABS]){b=b.concat(c.extensions[CQ.wcm.ContentFinder.EXTENSIONS_TABS])
}}this.setupAllTabs(b);
var a=this.getVisibleTabs(j.url);
var k=CQ.Ext.getCmp(CQ.wcm.ContentFinder.TABPANEL_ID);
a=CQ.Util.sortByRanking(a);
for(var g=0;
g<a.length;
g++){k.add(a[g])
}k.setActiveTab(0);
j.isInitialized=true
}},isValidURL:function(c){var b=document.createElement("a");
b.href=c;
return !b.host||(b.host==window.location.host)
}});
CQ.Ext.reg("contentfinder",CQ.wcm.ContentFinder);
CQ.wcm.ContentFinder.TABPANEL_ID="cq-cf-tabpanel";
CQ.wcm.ContentFinder.CLIPBOARD_ID="cq-cf-clipboard";
CQ.wcm.ContentFinder.TITLE=CQ.I18n.getMessage("AEM Content Finder");
CQ.wcm.ContentFinder.EXTERNAL_URL="_";
CQ.wcm.ContentFinder.loadContentWindow=function(a,b){CQ.shared.Util.reload(CQ.WCM.getContentWindow(),CQ.HTTP.externalize(a),b)
};
CQ.wcm.ContentFinder.maskFrame=function(){if(!CQ.wcm.ContentFinder.frameMask){CQ.wcm.ContentFinder.frameMask=CQ.Ext.get("cq-cf-framewrapper").mask()
}return CQ.wcm.ContentFinder.frameMask
};
CQ.wcm.ContentFinder.unmaskFrame=function(){if(CQ.wcm.ContentFinder.frameMask){CQ.wcm.ContentFinder.frameMask=null;
CQ.Ext.get("cq-cf-framewrapper").unmask()
}};
CQ.wcm.ContentFinder.FRAME_ID="cq-cf-frame";
CQ.wcm.ContentFinder.FRAME_CT_ID="cq-cf-frame-ct";
CQ.wcm.ContentFinder.EXTENSIONS_TABS="tabs";
CQ.wcm.ContentFinder.CLIPBOARD_ITEMSELECTOR=".item-wrap";
CQ.wcm.ContentFinder.CLIPBOARD_TEMPLATE='<tpl for="."><div class="item-wrap"  style="background-image:url({icon})" title="{qtip}"><span>{title}</span></div></tpl><div class="x-clear"></div>';
CQ.wcm.ContentFinder.SIDEVIEW_PARAM="cq_sideView";
CQ.wcm.ContentFinderTab=CQ.Ext.extend(CQ.Ext.Panel,{fields:null,dataView:null,form:null,history:null,initComponent:function(){CQ.wcm.ContentFinderTab.superclass.initComponent.call(this);
try{this.dataView=this.findByType("dataview")[0]
}catch(c){}try{var a=this.findByType("form");
if(a.length==1){var b=a[0];
this.fields=CQ.Util.findFormFields(b)
}}catch(c){}if(this.historyId){this.history=CQ.Ext.getCmp(this.historyId)
}},constructor:function(a){a=CQ.Util.applyDefaults(a,{layout:"border",items:[],listeners:{show:function(){this.loadStore(this.getParams())
}}});
CQ.wcm.ContentFinderTab.superclass.constructor.call(this,a)
},getParams:function(b){var a;
if((this.fields==null)&&b){var j=b.findParentByType("form");
a=CQ.Util.findFormFields(j)
}else{a=this.fields
}var m=new Object();
for(var c in this.fields){var k=this.fields[c];
for(var g=0;
g<k.length;
g++){m[c]=k[g].getValue()
}}return m
},submitQueryBox:function(a){try{var g=this.getParams(a);
var b=this.getQueryValue();
CQ.wcm.ContentFinderTab.disablePathCombo(this);
this.loadStore(g)
}catch(c){CQ.Log.error("ContentFinderTab#submitQueryBox: "+c.message)
}},loadStore:function(b){try{this.loading=true;
this.dataView.store.load({params:b})
}catch(a){CQ.Log.error("ContentFinderTab#loadStore: "+a.message)
}},setQueryValue:function(b){var a="query";
try{this.fields[a][0].setValue(b)
}catch(c){}},getQueryValue:function(b){var a="query";
try{return this.fields[a][0].getValue()
}catch(c){}}});
CQ.Ext.reg("contentfindertab",CQ.wcm.ContentFinderTab);
CQ.wcm.ContentFinderTab.ROOTPATH="/content";
CQ.wcm.ContentFinderTab.DATAVIEW_URL="/bin/wcm/search/gql.json";
CQ.wcm.ContentFinderTab.getQueryBoxConfig=function(a){a=CQ.Util.applyDefaults(a,{xtype:"form",method:"GET",region:"north",height:CQ.themes.wcm.ContentFinderTab.QUERYBOX_HEIGHT,bodyStyle:CQ.themes.wcm.ContentFinderTab.QUERYBOX_BODYSTYLE,layout:"fit",split:true,autoScroll:true,cls:"cq-cft-querybox",baseParams:{_charset_:"utf-8"},defaults:{hideLabel:true,anchor:CQ.themes.wcm.ContentFinderTab.QUERYBOX_ANCHOR,stateful:false,style:CQ.themes.wcm.ContentFinderTab.QUERYBOX_FIELDS_STYLE}});
return a
};
CQ.wcm.ContentFinderTab.getSuggestFieldConfig=function(a){a=CQ.Util.applyDefaults(a,{xtype:"suggestfield",name:"query",style:"margin-top:0;",onTriggerClick:function(b){if(b){this.search()
}},listeners:{search:function(){this.search()
}},search:function(){var b=this.findParentByType("contentfindertab");
if(b.history){b.history.addHistory(b.getParams(b))
}b.submitQueryBox.call(b,this)
}});
return a
};
CQ.wcm.ContentFinderTab.getPathComboConfig=function(a){a=CQ.Util.applyDefaults(a,{xtype:"combo",mode:"local",displayField:"text",editable:false,triggerAction:"all",disabled:true,cls:"cq-cft-pathcombo",listClass:"cq-cft-pathcombo-list",width:131,listWidth:131,store:new CQ.Ext.data.SimpleStore({fields:["value","text"],data:[]}),listeners:{select:function(g,b){var c=CQ.Ext.getCmp(a.tabId);
CQ.wcm.ContentFinderTab.openFolder(c,b.data.value)
}}});
return a
};
CQ.wcm.ContentFinderTab.getBrowseTree=function(config,treeID,resultBoxID){if(!config.treeRoot){config.treeRoot=new Object()
}this.treeRootConfig=CQ.Ext.applyIf(config.treeRoot,{name:"content",text:CQ.I18n.getMessage("Content"),draggable:false,expanded:true});
if(!config.treeLoader){config.treeLoader=new Object()
}this.treeLoaderConfig=CQ.Ext.applyIf(config.treeLoader,{baseParams:{predicate:"siteadmin"},requestMethod:"GET",dataUrl:"/bin/tree/ext.json",baseAttrs:{draggable:false,iconCls:"folder"},listeners:{beforeload:function(loader,node){this.baseParams.path=node.getPath()
}},createNode:function(attr){if(this.baseAttrs){CQ.Ext.applyIf(attr,this.baseAttrs)
}if(attr.type=="cq:Page"){attr.iconCls="page"
}else{if(/.*[fF]older/.test(attr.type)){attr.iconCls="folder"
}else{if(attr.cls){attr.iconCls=attr.cls
}}}if(this.applyLoader!==false){attr.loader=this
}if(typeof attr.uiProvider=="string"){attr.uiProvider=this.uiProviders[attr.uiProvider]||eval(attr.uiProvider)
}if(attr.leaf){delete attr.leaf;
attr.children=[];
attr.expanded=true
}var node;
if(attr.leaf){node=new CQ.Ext.tree.TreeNode(attr)
}else{node=new CQ.Ext.tree.AsyncTreeNode(attr)
}return node
},filterFn:function(dataObj){if(CQ.Ext.isArray(dataObj)){for(var i=0;
i<dataObj.length;
){if(dataObj[i]["type"]=="dam:Asset"){dataObj.splice(i,1)
}else{var children=dataObj[i].children;
if(children){var childCnt=children.length;
var noChildVisible=true;
for(var j=0;
j<childCnt;
j++){if(children[j]["type"]!="dam:Asset"){noChildVisible=false;
break
}}if(noChildVisible){dataObj[i].leaf=true
}delete dataObj[i].children
}i++
}}}return dataObj
}});
var tree=new CQ.Ext.tree.TreePanel({id:treeID,lines:true,animate:true,enableDD:false,containerScroll:true,autoScroll:true,split:true,stateful:true,region:"north",height:220,loader:new CQ.tree.FilteredTreeLoader(this.treeLoaderConfig),root:new CQ.Ext.tree.AsyncTreeNode(this.treeRootConfig)});
tree.getSelectionModel().addListener("selectionchange",(config.selectionchangeListener!=null?config.selectionchangeListener:function(selModel,node){var store=CQ.Ext.getCmp(resultBoxID).items.get(0).store;
store.proxy.api.read.url=CQ.shared.HTTP.encodePath(node.getPath())+".contentfinder.assets.json";
store.reload()
}));
return tree
};
CQ.wcm.ContentFinderTab.getResultsBoxConfig=function(c,j,k,b,a){j=CQ.Util.applyDefaults(j,{url:"x",method:"GET"});
k=CQ.Util.applyDefaults(k,{autoLoad:false,proxy:new CQ.Ext.data.HttpProxy(j),reader:new CQ.Ext.data.JsonReader({totalProperty:"results",root:"hits",fields:["name","path","title",CQ.shared.XSS.getXSSPropertyName("title"),"excerpt","mimeType","isFolder","contentType","ddGroups","ddNewParagraph","size","lastModified","ck"],id:"path"}),baseParams:{_charset_:"utf-8"},listeners:{load:function(q,o,r){q.records=o
}}});
var n=new CQ.Ext.data.GroupingStore(k);
c=CQ.Util.applyDefaults(c,{xtype:"panel",region:"center",autoScroll:true,itemsDDGroups:[],mergeItemsDDGroups:[],itemsDDNewParagraph:null,triggerScrollOffset:80,oneParameterPagination:true,pageSize:10,listeners:{render:function(q){var r=q.items.get(0);
var o=r.store;
r.indicatorEl=q.el.createChild({tag:"div",cls:"cq-cft-load-indicator"});
if(!c.disableContinuousLoading){q.body.on("scroll",function(w,u){if(!o.records){return
}if(r.loading||r.refreshing){return
}if(u.scrollTop>0&&(u.scrollTop+u.clientHeight+this.triggerScrollOffset>=u.scrollHeight)&&!r.refreshing){if(!r.moreStore){r.moreStore=new CQ.Ext.data.GroupingStore({proxy:new CQ.Ext.data.HttpProxy({url:o.proxy.url,method:o.proxy.conn.method}),reader:o.reader,listeners:{load:function(){var z=o.getCount();
for(var A=0;
A<r.moreStore.getCount();
A++){var t=r.moreStore.getAt(A);
o.add(t)
}r.refreshing=false;
r.indicatorEl.hide()
}},dataView:this})
}var y=o.lastOptions.params==undefined?o.baseParams:o.lastOptions.params;
if(!y.query||(y.query.indexOf("limit:")==-1)){r.refreshing=true;
var x={};
for(var v in y){x[v]=y[v]
}if(c.twoParametersPagination){x.limit=o.baseParam?o.baseParam:c.pageSize;
x.start=o.getCount()
}else{x.limit=o.getCount()+".."+(o.getCount()+c.pageSize)
}r.indicatorEl.alignTo(q.el,"bl-bl?",[18,-20]);
r.indicatorEl.show();
r.moreStore.load({params:x})
}}},this)
}}},items:{xtype:"dataview",cls:"cq-cft-dataview",layout:"fit",loadingText:CQ.I18n.getMessage("Loading content..."),multiSelect:true,singleSelect:true,overClass:"x-view-over",emptyText:CQ.I18n.getMessage("No content items to display"),tpl:CQ.wcm.ContentFinderTab.THUMBS_TEMPLATE,itemSelector:CQ.wcm.ContentFinderTab.THUMBS_ITEMSELECTOR,store:n,prepareData:function(o){o.shortTitle=CQ.shared.XSS.getXSSValue(CQ.Ext.util.Format.ellipsis(o.name,15));
o.title=o.title?o.title:"";
o[CQ.shared.XSS.getXSSPropertyName("title")]=o[CQ.shared.XSS.getXSSPropertyName("title")]?o[CQ.shared.XSS.getXSSPropertyName("title")]:"";
o.id=this.id;
o.isFolder=o.isFolder===true?true:false;
o.ddGroups=o.ddGroups?o.ddGroups:CQ.wcm.ContentFinderTab.CONTENT_UNDEFINED;
o.formattedSize=o.size?CQ.Util.formatFileSize(o.size):"";
try{o.lastModified=CQ.wcm.SiteAdmin.formatDate(o.lastModified)
}catch(q){}o.img140Postfix=".thumb.100.140.png";
o.img70Postfix=".thumb.50.70.png";
o.img48Postfix=".thumb.48.48.png";
if(o.path){o.pathEncoded=o.path.replace(/"/g,"&#34").replace(/'/g,"&#27");
o.pathEncodedTitle=o.path.replace(/&/g,"&#38;").replace(/"/g,"&#34")
}return o
},listeners:{click:function(C,y,F,A){var r=this.getSelectedRecords();
var q=r[0];
if(this.ddGroupsFromConfig){if(q&&q.data&&q.data.ddGroups){for(var B=0;
B<this.mergeItemsDDGroups.length;
B++){var E=this.mergeItemsDDGroups[B];
var o=false;
for(var v=0;
v<q.data.ddGroups.length;
v++){if(q.data.ddGroups[v]==E){o=true;
break
}}this.dragZone.removeFromGroup(E);
if(o){this.dragZone.addToGroup(E)
}}}return
}for(var x in this.dragZone.groups){this.dragZone.removeFromGroup(x)
}this.dragZone.itemsDDNewParagraph={};
if(!q){return
}if(q.data.ddGroups){for(var v=0;
v<q.data.ddGroups.length;
v++){var D=q.data.ddGroups[v];
var z=true;
for(var u=1;
u<r.length;
u++){var w=r[u];
for(var t=0;
t<w.data.ddGroups.length;
t++){if(D==w.data.ddGroups[t]){z=true;
break
}z=false
}if(!z){break
}}if(z){this.dragZone.addToGroup(D)
}}}if(q.data.ddNewParagraph){var z=true;
for(var v=1;
v<r.length;
v++){var w=r[v];
if(q.data.ddNewParagraph.path!=w.data.ddNewParagraph.path||q.data.ddNewParagraph.propertyName!=w.data.ddNewParagraph.propertyName){z=false;
break
}}if(z){this.dragZone.itemsDDNewParagraph=q.data.ddNewParagraph;
this.dragZone.addToGroup(CQ.wcm.EditBase.DD_GROUP_COMPONENT)
}}},load:function(){this.loading=false
},render:function(q){if(b==undefined){b=CQ.CF_REFRESH_INTERVAL
}if(b&&b!="0"){CQ.Util.observeComponent(this,b)
}q.loadMask=new CQ.Ext.LoadMask(q.getEl(),{store:this.store});
q.dragZone=new CQ.wcm.ContentFinderTab.DragZone(q,{containerScroll:false});
q.dragZone.removeFromGroup(CQ.wcm.EditBase.DD_GROUP_DEFAULT);
if(c.itemsDDGroups&&CQ.Ext.isArray(c.itemsDDGroups)&&c.itemsDDGroups.length>0){this.ddGroupsFromConfig=true;
for(var o=0;
o<c.itemsDDGroups.length;
o++){q.dragZone.addToGroup(c.itemsDDGroups[o])
}}if(c.mergeItemsDDGroups&&CQ.Ext.isArray(c.mergeItemsDDGroups)&&c.mergeItemsDDGroups.length>0){this.mergeItemsDDGroups=c.mergeItemsDDGroups
}else{this.mergeItemsDDGroups=[]
}if(c.itemsDDNewParagraph){q.dragZone.itemsDDNewParagraph=c.itemsDDNewParagraph;
q.dragZone.addToGroup(CQ.wcm.EditBase.DD_GROUP_COMPONENT)
}}},observe:function(){if(!this.store.records){return
}if(this.loading||this.refreshing){return
}if(!this.tab){this.tab=this.findParentByType("contentfindertab")
}var t=CQ.Ext.getCmp(CQ.wcm.ContentFinder.TABPANEL_ID);
if(t.getActiveTab()!=this.tab){return
}this.refreshing=true;
if(!this.checkStore&&this.store.proxy.api.read.url){this.checkStore=new CQ.Ext.data.GroupingStore({proxy:new CQ.Ext.data.HttpProxy({url:this.store.proxy.api.read.url,method:"GET"}),reader:new CQ.Ext.data.JsonReader({totalProperty:"results",root:"hits",fields:["name","path","title",CQ.shared.XSS.getXSSPropertyName("title"),"excerpt","mimeType","isFolder","ddGroups"],id:"path"}),listeners:{load:function(){var w=this.dataView.store;
var u=this.dataView.checkStore;
var x=w.getCount();
for(var y=0;
y<x;
y++){var v=w.getAt(y);
if(!u.getById(v.id)){w.remove(v);
x--
}}x=u.getCount();
for(var y=0;
y<x;
y++){var v=u.getAt(y);
if(!w.getById(v.id)){w.insert(y,v)
}}this.dataView.refreshing=false
}},dataView:this})
}this.checkStore.proxy.api.read.url=this.store.proxy.api.read.url;
var r=this.store.lastOptions.params==undefined?this.store.baseParams:this.store.lastOptions.params;
var o={};
for(var q in r){o[q]=r[q]
}if(!o.query||(o.query.indexOf("limit:")==-1)){if(c.twoParametersPagination){moreParams.limit=this.store.baseParam?this.store.baseParam:c.pageSize;
moreParams.start=0
}else{o.limit=0+".."+this.store.getCount()
}}this.checkStore.load({params:o})
}}});
try{for(var g=0;
g<c.tbar.length;
g++){if(c.tbar[g]==CQ.wcm.ContentFinderTab.REFRESH_BUTTON){c.tbar[g]=CQ.wcm.ContentFinderTab.getRefreshButton(n)
}}}catch(m){}try{for(var g=0;
g<c.bbar.length;
g++){if(c.bbar[g]==CQ.wcm.ContentFinderTab.REFRESH_BUTTON){c.bbar[g]=CQ.wcm.ContentFinderTab.getRefreshButton(n)
}}}catch(m){}return c
};
CQ.wcm.ContentFinderTab.getRefreshButton=function(a){return new CQ.Ext.Button({iconCls:"cq-siteadmin-refresh",handler:function(){a.reload()
},tooltip:CQ.I18n.getMessage("Refresh")})
};
CQ.wcm.ContentFinderTab.resultDblClick=function(j,m,g,b,a){try{if(a!=CQ.wcm.ContentFinderTab.CONTENT_UNDEFINED&&!j.altKey){if(a==CQ.wcm.ContentFinderTab.CONTENT_PAGE){CQ.wcm.ContentFinder.loadContentWindow(g+".html")
}else{CQ.Util.reload(window,CQ.HTTP.externalize(g,true))
}}else{if(b){var k=CQ.Ext.getCmp(m);
var c=k.findParentByType("contentfindertab");
CQ.wcm.ContentFinderTab.openFolder(c,g)
}}}catch(j){}};
CQ.wcm.ContentFinderTab.openFolder=function(a,b){a.setQueryValue("path:"+b);
var c=a.getParams();
c.openFolder="true";
if(a.history){a.history.addHistory(c)
}CQ.wcm.ContentFinderTab.adjustPathCombo(a,b);
a.loadStore(c)
};
CQ.wcm.ContentFinderTab.adjustPathCombo=function(b,k){try{if(!b.pathCombo&&b.pathComboId){b.pathCombo=CQ.Ext.getCmp(b.pathComboId)
}if(b.pathCombo){var g=[];
var c=k;
while(c.lastIndexOf("/")!=0){c=c.substring(0,c.lastIndexOf("/"));
var a=c.substring(c.lastIndexOf("/")+1);
g.push([c,a?a:"/"])
}b.pathCombo.store.loadData(g);
b.pathCombo.setDisabled(false);
b.pathCombo.setValue(k.substring(k.lastIndexOf("/")+1))
}}catch(j){}};
CQ.wcm.ContentFinderTab.disablePathCombo=function(a){if(!a.pathCombo&&a.pathComboId){a.pathCombo=CQ.Ext.getCmp(a.pathComboId)
}if(a.pathCombo){a.pathCombo.setValue("");
a.pathCombo.setDisabled(true)
}};
CQ.wcm.ContentFinderTab.THUMBS_ITEMSELECTOR=".thumb-wrap";
CQ.wcm.ContentFinderTab.THUMBS_TEMPLATE='<tpl for="."><div class="thumb-wrap"><div class="thumb" style="background-image:url(\'{[CQ.wcm.ContentFinderTab.THUMBS_URL(values)]}\');" ondblclick="CQ.wcm.ContentFinderTab.resultDblClick(event, \'{id}\',\'{pathEncoded}\',{isFolder},\'{ddGroups}\');" ext:qtip="<nobr>{[CQ.shared.XSS.getXSSValue(CQ.shared.XSS.getXSSValue(values.title))]}</nobr>{[values.title ? "<br/>" : ""]}<nobr>{[CQ.shared.XSS.getXSSValue(CQ.shared.XSS.getXSSValue(values.name))]}</nobr>"></div><span>{[CQ.shared.XSS.getXSSValue(values.shortTitle)]}</span></div></tpl><div class="x-clear"></div>';
CQ.wcm.ContentFinderTab.THUMBS_URL=function(b,g,a){g=(g?g:100);
a=(a?a:140);
var c=CQ.HTTP.externalize(CQ.shared.XSS.getXSSValue(CQ.HTTP.encodePath(b.path)));
c+=".thumb."+g+"."+a+(b.ck?"."+b.ck:"")+".png";
return CQ.shared.HTTP.getXhrHookedURL(c)
};
CQ.wcm.ContentFinderTab.THUMBS_SHADOW_ITEMSELECTOR=".thumb-sh-wrap";
CQ.wcm.ContentFinderTab.THUMBS_SHADOW_TEMPLATE='<tpl for="."><div class="thumb-sh-wrap"><table class="thumb""><tr><td><table><tr><td><img src="{[CQ.wcm.ContentFinderTab.THUMBS_URL(values)]}" ondblclick="CQ.wcm.ContentFinderTab.resultDblClick(event, \'{id}\',\'{pathEncoded}\',{isFolder},\'{ddGroups}\');" ext:qtip="<nobr>{[CQ.shared.XSS.getXSSValue(CQ.shared.XSS.getXSSValue(values.title))]}</nobr>{[values.title ? "<br/>" : ""]}<nobr>{[CQ.shared.XSS.getXSSValue(CQ.shared.XSS.getXSSValue(values.name))]}</nobr>"></td></tr></table></td></tr></table><span>{[CQ.shared.XSS.getXSSValue(values.shortTitle)]}</span></div></tpl><div class="x-clear"></div>';
CQ.wcm.ContentFinderTab.DETAILS_ITEMSELECTOR=".cq-cft-search-item";
CQ.wcm.ContentFinderTab.DETAILS_SHADOW_TEMPLATE='<tpl for="."><div class="cq-cft-search-item" ondblclick="CQ.wcm.ContentFinderTab.resultDblClick(event, \'{id}\', \'{pathEncoded}\', {isFolder}, \'{ddGroups}\');"><div class="cq-cft-search-thumb"><table><tr><td><img alt="{[CQ.shared.XSS.getXSSValue(values.pathEncoded)]}" src="{[CQ.wcm.ContentFinderTab.THUMBS_URL(values, 48, 48)]}"></td></tr></table></div><div class="cq-cft-search-text-wrapper"><div class="cq-cft-search-title">{[CQ.shared.XSS.getXSSValue(values.name)]}</div>{[values.title ? "<div>" + CQ.shared.XSS.getXSSValue(values.title) + "</div>" : ""]}<div>{[CQ.shared.XSS.getXSSValue(values.formattedSize)]}</div><div>{[CQ.shared.XSS.getXSSValue(values.lastModified)]}</div></div><div class="cq-cft-search-separator"></div></div></tpl>';
CQ.wcm.ContentFinderTab.DETAILS_SHADOW_ITEMSELECTOR=".cq-cft-search-item";
CQ.wcm.ContentFinderTab.DETAILS_TEMPLATE='<tpl for="."><div class="cq-cft-search-item" ondblclick="CQ.wcm.ContentFinderTab.resultDblClick(event, \'{id}\', \'{pathEncoded}\', {isFolder}, \'{ddGroups}\');"><div title="{[CQ.shared.XSS.getXSSValue(values.pathEncodedTitle)]}" class="cq-cft-search-thumb" style="background-image:url(\'{[CQ.wcm.ContentFinderTab.THUMBS_URL(values, 48, 48)]}\');"></div><div class="cq-cft-search-text-wrapper"><div class="cq-cft-search-title">{[CQ.shared.XSS.getXSSValue(values.name)]}</div>{[values.title ? "<div>" + CQ.shared.XSS.getXSSValue(values.title) + "</div>" : ""]}<div>{[CQ.shared.XSS.getXSSValue(values.formattedSize)]}</div><div>{[CQ.shared.XSS.getXSSValue(values.lastModified)]}</div></div><div class="cq-cft-search-separator"></div></div></tpl>';
CQ.wcm.ContentFinderTab.CONTENT_UNDEFINED="";
CQ.wcm.ContentFinderTab.CONTENT_PAGE="page";
CQ.wcm.ContentFinderTab.REFRESH_BUTTON="refreshButton";
CQ.wcm.ContentFinderTab.DragZone=CQ.Ext.extend(CQ.wcm.ContentFinderDragZone,{constructor:function(a,b){this.view=a;
CQ.wcm.ContentFinderTab.DragZone.superclass.constructor.call(this,a.getEl(),b)
},onInitDrag:function(b,c){CQ.wcm.EditBase.DragZone.superclass.onInitDrag.call(this,b,c);
var a=this;
this.flashDropTargetsCheck=window.setInterval(function(){if(!a){return
}var g=a.mouse;
var j=new Date().valueOf();
if(g&&a.matchRange(g.pos,g.lastPos)&&(j-g.time)>2000){a.flashDropTargets(CQ.WCM.altKey);
g.time=j
}else{a.normalizeDropTargets()
}g.lastPos=g.pos
},500)
},getDragData:function(n){var o=n.getTarget(this.view.itemSelector);
if(o){var r=this.view;
if(!r.isSelected(o)){r.onClick(n)
}var b=r.getSelectedNodes();
var k=r.getSelectedRecords();
var g={nodes:b,records:k};
if(b.length==1){this.initialxy=CQ.Ext.Element.fly(o.firstChild).getXY();
g.ddel=CQ.DOM.prepareForCloning(o.firstChild,true).cloneNode(true);
g.ddel.className+=" cq-cft-ddproxy";
g.single=true
}else{var a=document.createElement("div");
a.style.width=(CQ.themes.wcm.ContentFinderTab.DDPROXY_MULTI_OFFSET*(b.length-1)+CQ.themes.wcm.ContentFinderTab.DDPROXY_WIDTH)+"px";
a.style.height=(CQ.themes.wcm.ContentFinderTab.DDPROXY_MULTI_OFFSET*(b.length-1)+CQ.themes.wcm.ContentFinderTab.DDPROXY_HEIGHT)+"px";
for(var j=0,m=b.length;
j<m;
j++){var q=CQ.DOM.prepareForCloning(b[j].firstChild,true).cloneNode(true);
q.className+=" cq-cft-ddproxy";
q.style.position="absolute";
var c=j*CQ.themes.wcm.ContentFinderTab.DDPROXY_MULTI_OFFSET;
q.style.left=(CQ.themes.wcm.ContentFinderTab.DDPROXY_PADDING_LEFT+c)+"px";
q.style.top=(CQ.themes.wcm.ContentFinderTab.DDPROXY_PADDING_TOP+c)+"px";
a.appendChild(q)
}g.ddel=a;
g.multi=true
}return g
}return null
},afterRepair:function(){for(var b=0,a=this.dragData.nodes.length;
b<a;
b++){}this.dragging=false
},getRepairXY:function(a){if(!this.dragData.multi){this.initialxy[0]+=3;
this.initialxy[1]+=3;
return this.initialxy
}return false
},onInvalidDrop:function(b,a){CQ.wcm.ContentFinderTab.DragZone.superclass.onInvalidDrop.call(this,b,a);
this.clearAnimations(b)
},clearAnimations:function(b,a){if(b){if(b.hideHighlight){b.hideHighlight()
}if(!a&&b.editComponent&&b.editComponent.hideTarget){b.editComponent.hideTarget()
}}this.normalizeDropTargets();
window.clearInterval(this.flashDropTargetsCheck)
},notifyDropDT:function(b,t,o){var u=false;
if(this.isInplaceEditingComponent(b)){this.clearAnimations(b);
if(this.isInplaceEditingDropAllowed(b)){b.editComponent.notifyInplaceEditingDrop(this);
return true
}}if(this.isDropAllowed(b,(t&&t.altKey))){var n=b.editComponent;
if(!this.isInsertOnlyComponent(b)&&t&&!t.altKey){this.clearAnimations(b);
var w=[];
for(var q=0;
q<this.dragData.records.length;
q++){w.push(this.dragData.records[q].data.path)
}var r=b.propertyName;
var v=b.postParams;
for(var c in v){if(c.indexOf("./DRAG_RECORD_")==0){var a=c.substring(14);
for(q=0;
q<this.dragData.records.length;
q++){if(this.dragData.records[q].data[a]!=undefined&&this.dragData.records[q].data[a]!=""){v["./"+a]=this.dragData.records[q].data[a]
}else{v["./"+a]=""
}}}}window.setTimeout(function(){var K=CQ.WCM.getContentWindow();
var G=null;
var F=K.CQ.undo.util.UndoUtils;
var J=K.CQ.undo.UndoManager;
if(J.isEnabled()){G=F.getCurrentData(n)
}n.updateParagraph(r,w,v);
if(J.isEnabled()){var z={};
z[r]=w;
var M=F.resolveMultiValuePlaceholder(z);
var N={};
var y=M.length;
var I=F.jsonToSlingParameters(G.data);
for(var C=0;
C<y;
C++){r=M[C].property;
N[r]=I[r];
if(M[C].resolved){var x=r.lastIndexOf("/");
if(x>0){var H=r.substring(0,x);
N[H+"/jcr:lastModified"]="";
N[H+"/jcr:lastModifiedBy"]="";
z[H+"/jcr:lastModified"]="";
z[H+"/jcr:lastModifiedBy"]=""
}}}for(var L in v){if(v.hasOwnProperty(L)){if(I[L]){N[L]=I[L]
}else{N[L]=""
}z[L]=v[L]
}}var E=J.getHistory();
var D=E.createUndoStep(E.createStepConfig());
var A=new K.CQ.undo.util.FormStub();
var B=n.getResourceType();
D.addUndoAction(new K.CQ.undo.actions.UpdateParagraphAction(E.getIdManager(),n.path,B,N,z,A));
D.commit()
}},1);
u=true
}if(this.isInsertOnlyComponent(b)||(t&&t.altKey)){this.clearAnimations(b,true);
var k=CQ.I18n.getMessage("Inserting paragraph...");
n.maskTarget(k);
var j=CQ.WCM.getComponentConfig(this.itemsDDNewParagraph.path);
if(j){var m={};
if(this.itemsDDNewParagraph.params){for(var c in this.itemsDDNewParagraph.params){m[c]=this.itemsDDNewParagraph.params[c]
}}var g=[];
for(var q=0;
q<this.dragData.records.length;
q++){var c=CQ.utils.Util.copyObject(m);
c[this.itemsDDNewParagraph.propertyName]=this.dragData.records[q].data.path;
g.push(c)
}window.setTimeout(function(){for(var x=0;
x<g.length;
x++){n.createParagraph(j,g[x])
}n.hideTarget()
},1);
u=true
}}}this.clearAnimations(b,true);
return u
},notifyEnterDT:function(b,a){if(this.isDropAllowed(b,(!a||a.altKey))){if(this.isInsertOnlyComponent(b)||(a&&a.altKey)){if(b.editComponent){b.editComponent.showTarget()
}b.hideHighlight()
}else{b.showHighlight()
}}return""
},notifyOutDT:function(b,a){if(b.editComponent){b.editComponent.hideTarget(true)
}b.hideHighlight();
return""
},notifyOverDT:function(c,b){var a=this.isDropAllowed(c,(!b||b.altKey));
if(a){if(this.isInsertOnlyComponent(c)||(b&&b.altKey)){if(c.editComponent){c.editComponent.showTarget()
}c.hideHighlight()
}else{if(c.editComponent){c.editComponent.hideTarget()
}}}return a?this.dropAllowed:this.dropNotAllowed
},isDropAllowed:function(b,a){if(this.isInplaceEditingComponent(b)){return this.isInplaceEditingDropAllowed(b)
}if(this.isInsertOnlyComponent(b)){return this.isComponentDropAllowed(b)
}if(a==undefined){return(this.isNonComponentDropAllowed(b)||this.isComponentDropAllowed(b))
}return(a!==true?this.isNonComponentDropAllowed(b):this.isComponentDropAllowed(b))
},isInplaceEditingComponent:function(c){var a=CQ.WCM.getContentFinder().getContentWindow();
var b=window.CQ_inplaceEditComp||a.CQ_inplaceEditComp;
return(c.editComponent&&(b===c.editComponent))
},isInplaceEditingDropAllowed:function(a){return a.editComponent.isInplaceEditingDropAllowed(this)
},isInsertOnlyComponent:function(a){return a.editComponent&&a.editComponent.isActionInsertOnly()
},isNonComponentDropAllowed:function(c){if(c&&c.groups){var a={};
a[CQ.wcm.EditBase.DD_GROUP_COMPONENT]=true;
if(CQ.Util.isIntersecting(this.groups,c.groups,a)){var b=this.dragData.records[0].data.mimeType;
if(b&&c.ddAccept&&c.ddAccept.indexOf("*")==-1){return CQ.Util.isAcceptedMimeType(c.ddAccept,b)
}else{return true
}}}return false
},isComponentDropAllowed:function(a){return a&&a.groups&&a.groups[CQ.wcm.EditBase.DD_GROUP_COMPONENT]&&this.itemsDDNewParagraph&&this.itemsDDNewParagraph.path&&a.editComponent&&a.editComponent.isInsertAllowed(this.itemsDDNewParagraph.path)
},flashDropTargets:function(b){if(!this.dropTargetsHighlighted){for(var a=0;
a<this.dropTargets.length;
a++){if(!this.isDropAllowed(this.dropTargets[a],b)){continue
}if(this.dropTargets[a]==this.cachedTarget){continue
}this.dropTargets[a].flash()
}this.dropTargetsHighlighted=true
}},normalizeDropTargets:function(){for(var a=0;
a<this.dropTargets.length;
a++){this.dropTargets[a].normalize()
}this.dropTargetsHighlighted=false
},onDragCancel:function(a,b){this.clearAnimations(b)
}});
CQ.wcm.Sidekick=CQ.Ext.extend(CQ.Dialog,{pathParam:null,createText:null,createDialog:null,templateSelectionId:null,templateList:null,createChildPageText:null,copyPageText:null,movePageText:null,deleteText:null,deleteUrl:null,publishText:null,publishUrl:null,deactivateText:null,rolloutText:null,rolloutUrl:null,scaffoldingText:null,referencesText:null,lockText:null,lockedByText:null,unlockText:null,lockUrl:null,locked:false,unlockUrl:null,readOnly:false,versionText:null,versionDialog:null,versionSelectionId:null,versionList:null,restoreText:null,restoreDialog:null,promoteText:null,markProductionReadyText:null,unmarkProductionReadyText:null,productionReadyText:null,productionNotReadyText:null,auditText:null,auditDialog:null,permsText:null,permsDialog:null,propsText:null,propsDialog:null,startWorkflowText:null,startWorkflowDialog:null,previewText:null,editText:null,designText:null,adminText:null,clientContextText:null,analyticsText:null,miscText:null,adminUrl:null,miscUrl:null,liveCopyStatusText:null,gotoText:null,previewReload:false,actns:null,buttons:null,panels:null,getPath:function(){return this.path
},setPath:function(a){this.path=a
},loadContent:function(c,b){this.setPath(c);
this.loadedConfig=b;
if(!this.collapsed){this.panelsLoaded=false;
this.panels={};
this.removeAll(true);
this.addLoadingPanel();
this.doLayout();
this.lazyLoadContent.defer(10,this)
}var a=this;
CQ.WCM.getContentWindow().CQ.Ext.onLoad(function(){a.scrollContentToLastPosition()
})
},lazyLoadContent:function(){if(!this.panelsLoaded){for(var a=CQ.wcm.Sidekick.componentsWithDragZone.length-1;
a>=0;
a--){if(CQ.wcm.Sidekick.componentsWithDragZone[a].dragZone){CQ.wcm.Sidekick.componentsWithDragZone[a].dragZone.destroy();
delete CQ.wcm.Sidekick.componentsWithDragZone[a].dragZone
}}CQ.wcm.Sidekick.componentsWithDragZone=[];
this.initButtons(this.getPath(),this.initialConfig);
this.addButtons();
this.loadPanels(this.getPath(),this.loadedConfig);
this.fireEvent("loadcontent",this)
}},addLoadingPanel:function(){this.removeLoadingPanel();
this.add(this.getLoadingPanelConfig());
this.doLayout()
},getLoadingPanelConfig:function(){return{xtype:"panel",cls:"cq-sidekick-loading",id:"cq-sidekick-loading"}
},removeLoadingPanel:function(){this.remove("cq-sidekick-loading",true)
},addAction:function(b,j){if(b instanceof Array){for(var g=0;
g<b.length;
g++){this.addAction(b[g],j)
}}else{if(!b.xtype){b.xtype="button"
}if(!b.scope){b.scope=this
}if(!b.handler&&b.dialog){b.handler=function(){try{var n=CQ.WCM.getDialog(b.dialog);
n.loadContent(this.getPath());
n.show()
}catch(m){}}
}if(!b.context){b.context=CQ.wcm.Sidekick.PAGE
}if(!this.actns){this.actns=[]
}if(b.context instanceof Array){for(var g=0;
g<b.context.length;
g++){var c=this.panels[b.context[g]].add(b);
this.actns.push(c);
this.buttons[b.name]=c
}}else{var a=this.panels[b.context];
try{if(!a.hasClass("cq-sidekick-buttons")){a.addClass("cq-sidekick-buttons")
}}catch(k){}var c=a.add(b);
this.actns.push(c);
this.buttons[b.name]=c
}}},getCreateConfig:function(){var sidekick=CQ.wcm.Sidekick.findSidekick(this);
var allowed=sidekick.initialConfig.createDialog!=undefined;
return{text:this.createText,disabled:!allowed,handler:function(){if(!(sidekick.createDialog instanceof CQ.Dialog)){try{if(!sidekick.initialConfig.createDialog){CQ.Log.warn("CQ.wcm.Sidekick#getCreateConfig: no create dialog specified");
return
}sidekick.createDialog=CQ.WCM.getDialog(sidekick.initialConfig.createDialog);
if(sidekick.templateSelectionId&&sidekick.templateList){var templates=sidekick.templateList;
if(typeof sidekick.templateList=="string"){var url=sidekick.templateList;
url=CQ.HTTP.addParameter(url,sidekick.pathParam,this.getPath());
templates=CQ.HTTP.eval(url)
}CQ.Ext.getCmp(sidekick.templateSelectionId).setOptions(templates,true)
}}catch(e){CQ.Log.error("CQ.wcm.Sidekick#getCreateConfig: failed to build create dialog: {0}",e.message);
return
}}sidekick.createDialog.show()
},context:[CQ.wcm.Sidekick.PAGE]}
},getCreateChildPageConfig:function(){var a=CQ.User.getCurrentUser().hasPermissionOn("create",this.getPath());
return{text:this.createChildPageText,disabled:!a,handler:function(){var b=CQ.wcm.Sidekick.findSidekick(this);
var g=this.getPath();
var c=CQ.wcm.Page.getCreatePageDialog(g);
c.success=function(k,j){if(j&&j.result&&j.result.Path){CQ.Util.reload(CQ.WCM.getContentWindow(),CQ.HTTP.externalize(j.result.Path+CQ.HTTP.EXTENSION_HTML))
}else{CQ.Util.reload(CQ.WCM.getContentWindow())
}};
c.failure=function(){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not create page."))
};
c.show()
},context:[CQ.wcm.Sidekick.PAGE]}
},getCopyPageConfig:function(){var a=CQ.User.getCurrentUser().hasPermissionOn("create",this.getPath());
return{text:this.copyPageText,disabled:!a,handler:function(){var b=CQ.wcm.Sidekick.findSidekick(this);
var g=this.getPath();
var c=CQ.wcm.Page.getCopyPageDialog(g);
c.success=function(m,o){var j=CQ.HTTP.buildPostResponseFromHTML(o.response);
var k=$CQ.trim(j.headers.Message);
var n=CQ.I18n.getMessage('Current page has been copied to <a href="{0}">{1}</a>',[CQ.shared.HTTP.reloadHook(CQ.HTTP.externalize(k+CQ.HTTP.EXTENSION_HTML)),k]);
CQ.Notification.notify(CQ.I18n.getMessage("Page copied"),n)
};
c.failure=function(){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not copy page."))
};
c.show()
},context:[CQ.wcm.Sidekick.PAGE]}
},getMovePageConfig:function(){var a=CQ.User.getCurrentUser().hasPermissionOn("delete",this.getPath());
return{text:this.movePageText,disabled:!a,handler:function(){var b=CQ.wcm.Sidekick.findSidekick(this);
var j=this.getPath();
var c=j.substring(j.lastIndexOf("/")+1);
var g=CQ.wcm.Page.getMovePageDialog(j,true);
g.success=function(n){var m="";
try{var q=n.findField("destParentPath").getValue();
var k=n.findField("destName").getValue();
m=q+"/"+k
}catch(o){m=j.substring(0,j.lastIndexOf("/"))
}CQ.Util.reload(CQ.WCM.getContentWindow(),CQ.HTTP.externalize(m+CQ.HTTP.EXTENSION_HTML))
};
g.failure=function(){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not move page."))
};
g.show()
},context:[CQ.wcm.Sidekick.PAGE]}
},getDeleteConfig:function(){var a=CQ.User.getCurrentUser().hasPermissionOn("delete",this.getPath());
return{text:this.deleteText,disabled:!a,handler:function(){var b=CQ.wcm.Sidekick.findSidekick(this);
var g=this.getPath();
var c=g.substring(g.lastIndexOf("/")+1);
CQ.Ext.Msg.confirm(b.deleteText,CQ.I18n.getMessage("Do you really want to delete '{0}'?",c),function(j){if(j=="yes"){b.internalDelete(false)
}},this)
},context:[CQ.wcm.Sidekick.PAGE]}
},internalDelete:function(a){var c=function(k,n,j){var g=j.headers[CQ.utils.HTTP.HEADER_STATUS];
if(g==200){var m=this.path.substring(0,this.path.lastIndexOf("/"));
CQ.Util.reload(CQ.WCM.getContentWindow(),CQ.HTTP.externalize(m+CQ.HTTP.EXTENSION_HTML))
}else{if(g==412){CQ.Ext.Msg.show({title:CQ.I18n.getMessage("Delete Page"),msg:"This page is referenced. Click 'yes' to proceed deleting the page, click 'no' to review the references or 'cancel' to cancel the operation.",buttons:CQ.Ext.Msg.YESNOCANCEL,icon:CQ.Ext.MessageBox.QUESTION,fn:function(o){if(o=="yes"){this.internalDelete(true)
}else{if(o=="no"){this.showReferences()
}}},scope:this})
}else{CQ.Notification.notifyFromResponse(j)
}}};
var b={path:this.path,_charset_:"utf-8",cmd:"deletePage",force:a};
CQ.shared.HTTP.post("/bin/wcmcommand",c,b,this)
},getPublishConfig:function(a){a=a||CQ.WCM.getPage(this.path);
return{text:this.publishText,hidden:a.isLaunch(),handler:function(){var b=CQ.wcm.Sidekick.findSidekick(this);
var c={id:CQ.Util.createId("cq-asset-reference-search-dialog"),path:[b.getPath()],callback:function(g){CQ.wcm.SiteAdmin.internalActivatePage(g,function(k,m,j){if(m){CQ.Notification.notify(b.publishText,CQ.I18n.getMessage("Page successfully activated"))
}else{CQ.Notification.notifyFromResponse(j)
}})
}};
new CQ.wcm.AssetReferenceSearchDialog(c)
},context:[CQ.wcm.Sidekick.PAGE]}
},getDeactivateConfig:function(b){var a=this;
b=b||CQ.WCM.getPage(a.path);
return{text:this.deactivateText,hidden:b.isLaunch(),name:CQ.wcm.Sidekick.DEACTIVATE,handler:function(){CQ.wcm.SiteAdmin.deactivatePage([{id:a.path}],function(g,j,c){if(j){CQ.Notification.notify(a.deactivateText,CQ.I18n.getMessage("Page successfully deactivated"))
}else{CQ.Notification.notifyFromResponse(c)
}})
},context:[CQ.wcm.Sidekick.PAGE]}
},getRolloutConfig:function(b){var a=this;
var g=this.path;
b=b||CQ.WCM.getPage(g);
var c=b.isLaunch();
var j=b.isLiveCopySource();
return{disabled:!(j||c),text:c?this.promoteText:this.rolloutText,handler:function(){if(c){var k=CQ.WCM.getPageInfo(g);
a.rolloutWizard=new CQ.wcm.Launches.PromoteLaunchWizard({path:g})
}else{a.rolloutWizard=new CQ.wcm.msm.RolloutWizard({path:g})
}a.rolloutWizard.show()
},context:[CQ.wcm.Sidekick.PAGE]}
},getReferencesConfig:function(){var a=CQ.wcm.Sidekick.findSidekick(this);
return{text:this.referencesText,handler:function(){a.showReferences()
},context:[CQ.wcm.Sidekick.PAGE]}
},showReferences:function(){var a=new CQ.wcm.ReferencesDialog({path:this.path});
a.on("pageopen",function(c,b){c.close();
CQ.Util.reload(CQ.WCM.getContentWindow(),CQ.HTTP.externalize(b+CQ.HTTP.EXTENSION_HTML))
});
a.show()
},getLockConfig:function(a){a=a||CQ.WCM.getPage(this.path);
var b;
if(a.isLocked()){if(!a.canUnlock()){b=CQ.Util.patchText(this.lockedByText,a.getLockOwner())
}else{b=this.unlockText
}}else{b=this.lockText
}return{text:b,disabled:a.isLocked()&&!a.canUnlock(),handler:function(){if(this.ignoreClicks){return
}var c=CQ.wcm.Sidekick.findSidekick(this);
var j=CQ.WCM.getPage(c.path);
if(j){var g=this.buttons[CQ.wcm.Sidekick.LOCK];
g.ignoreClicks=true;
if(this.pageLocked||j.isLocked()){j.unlock(function(m,n,k){if(n){c.pageLocked=false;
g.setText(c.lockText)
}g.ignoreClicks=false
})
}else{j.lock(function(m,n,k){if(n){c.pageLocked=true;
g.setText(c.unlockText)
}g.ignoreClicks=false
})
}}},context:CQ.wcm.Sidekick.PAGE}
},getVersionConfig:function(){var a=CQ.wcm.Sidekick.findSidekick(this);
var b=a.initialConfig.versionDialog!=undefined;
return{text:this.versionText,disabled:!b,handler:function(){if(!(a.versionDialog instanceof CQ.Dialog)){try{if(!a.initialConfig.versionDialog){CQ.Log.warn("CQ.wcm.Sidekick#getVersionConfig: no version dialog specified");
return
}a.versionDialog=CQ.WCM.getDialog(a.initialConfig.versionDialog)
}catch(c){CQ.Log.error("CQ.wcm.Sidekick#getVersionConfig: failed to build version dialog: {0}",c.message);
return
}}a.versionDialog.loadContent(this.getPath());
a.versionDialog.show()
},context:CQ.wcm.Sidekick.VERSIONING}
},getRestoreConfig:function(){var a=CQ.wcm.Sidekick.findSidekick(this);
var b=a.initialConfig.restoreDialog!=undefined;
return{text:this.restoreText,disabled:!b,handler:function(){if(!(a.restoreDialog instanceof CQ.Dialog)){try{if(!a.initialConfig.restoreDialog){CQ.Log.warn("CQ.wcm.Sidekick#getRestoreConfig: no restore dialog specified");
return
}a.restoreDialog=CQ.WCM.getDialog(a.initialConfig.restoreDialog)
}catch(c){CQ.Log.error("CQ.wcm.Sidekick#getRestoreConfig: failed to build restore dialog: {0}",c.message);
return
}}a.restoreDialog.loadContent(this.getPath());
a.restoreDialog.success=function(){window.setTimeout(function(){CQ.Util.reload(CQ.WCM.getContentWindow())
},1000)
};
a.restoreDialog.show()
},context:CQ.wcm.Sidekick.VERSIONING}
},getAuditConfig:function(){var a=CQ.wcm.Sidekick.findSidekick(this);
var b=a.initialConfig.auditDialog!=undefined;
return{text:this.auditText,disabled:!b,handler:function(){if(!(a.auditDialog instanceof CQ.Dialog)){try{if(!a.initialConfig.auditDialog){CQ.Log.warn("CQ.wcm.Sidekick#getAuditConfig: no audit log dialog specified");
return
}a.auditDialog=CQ.WCM.getDialog(a.initialConfig.auditDialog)
}catch(c){CQ.Log.error("CQ.wcm.Sidekick#getAuditConfig: failed to build audit log dialog: {0}",c.message);
return
}}a.auditDialog.loadContent(this.getPath());
a.auditDialog.show()
},context:CQ.wcm.Sidekick.INFO}
},getPermsConfig:function(b){var a=CQ.wcm.Sidekick.findSidekick(this);
var c=b.permsDialog!=undefined||a.initialConfig.permsDialog!=undefined;
return{text:this.permsText,disabled:!c,handler:function(){var g=b.permsDialog?b.permsDialog:a.initialConfig.permsDialog;
var j;
try{if(!g){CQ.Log.warn("CQ.wcm.Sidekick#getPermsConfig: no permissions dialog specified");
return
}j=CQ.WCM.getDialog(g)
}catch(k){CQ.Log.error("CQ.wcm.Sidekick#getPermsConfig: failed to build permissions dialog: {0}",k.message);
return
}j.loadContent(this.getPath());
j.show()
},context:CQ.wcm.Sidekick.INFO}
},getPropsConfig:function(c){var b=CQ.wcm.Sidekick.findSidekick(this);
var a=c.propsDialog?c.propsDialog:b.initialConfig.propsDialog;
var g=a&&CQ.User.getCurrentUser().hasPermissionOn("read",a)!==false;
return{text:this.propsText,disabled:!g,handler:function(){var k;
try{var j=CQ.utils.WCM.getContentWindow();
if(!a){CQ.Log.warn("CQ.wcm.Sidekick#getPropsConfig: no properties dialog specified");
return
}var n=j.CQ.WCM.getDialogConfig(a);
if(!n.success){n.success=function(o,q){CQ.Util.reload(CQ.WCM.getContentWindow())
}
}if(!n.failure){n.failure=function(q,r){var o=CQ.HTTP.buildPostResponseFromHTML(r.response);
CQ.Ext.Msg.alert(o.headers[CQ.HTTP.HEADER_MESSAGE])
}
}k=j.CQ.WCM.getDialog(n,a);
k.fieldEditLockMode=true;
k.loadContent(this.getPath()+"/jcr:content");
k.setTitle(CQ.I18n.getMessage("Page Properties of {0}",this.getPath()))
}catch(m){CQ.Log.error("CQ.wcm.Sidekick#getPropsConfig: failed to build properties dialog: {0}",m.message);
return
}k.show()
},context:CQ.wcm.Sidekick.PAGE}
},getStartWorkflowConfig:function(){var a=CQ.wcm.Sidekick.findSidekick(this);
var b=a.initialConfig.startWorkflowDialog!=undefined;
return{text:this.startWorkflowText,disabled:!b,handler:function(){if(!(a.startWorkflowDialog instanceof CQ.Dialog)){try{if(!a.initialConfig.startWorkflowDialog){CQ.Log.warn("CQ.wcm.Sidekick#getStartWorkflowConfig: no start workflow dialog specified");
return
}var c={"jcr:primaryType":"cq:Dialog",title:CQ.I18n.getMessage("Start Workflow"),formUrl:"/etc/workflow/instances",params:{_charset_:"utf-8",payloadType:"JCR_PATH"},items:{"jcr:primaryType":"cq:Panel",items:{"jcr:primaryType":"cq:WidgetCollection",model:{xtype:"combo",name:"model",hiddenName:"model",fieldLabel:CQ.I18n.getMessage("Workflow"),displayField:"label",valueField:"wid",title:CQ.I18n.getMessage("Available Workflows"),selectOnFocus:true,triggerAction:"all",allowBlank:false,editable:false,store:new CQ.Ext.data.Store({proxy:new CQ.Ext.data.HttpProxy({url:"/libs/cq/workflow/content/console/workflows.json",method:"GET"}),baseParams:{tags:"wcm"},reader:new CQ.Ext.data.JsonReader({totalProperty:"results",root:"workflows"},[{name:"wid"},{name:"label"}])})},comment:{"jcr:primaryType":"cq:TextArea",fieldLabel:CQ.I18n.getMessage("Comment"),name:"startComment",height:200},title:{xtype:"textfield",name:"workflowTitle",fieldLabel:CQ.I18n.getMessage("Workflow Title")}}},okText:CQ.I18n.getMessage("Start")};
var g=CQ.WCM.getDialog(c);
g.addHidden({payload:this.getPath()});
g.failure=function(){CQ.Ext.Msg.alert("Error","Could not start workflow.")
};
a.startWorkflowDialog=g
}catch(m){CQ.Log.error("CQ.wcm.Sidekick#getStartWorkflowConfig: failed to build start workflow dialog: {0}",m.message);
return
}}var j=CQ.WCM.getPageInfo(this.getPath());
var k=j.workflow&&j.workflow.isRunning;
if(!k){a.startWorkflowDialog.getField("payload").setValue(this.getPath());
a.startWorkflowDialog.show()
}else{CQ.Ext.Msg.alert(CQ.I18n.getMessage("Information"),CQ.I18n.getMessage("Page is already subject to a workflow!"))
}},context:CQ.wcm.Sidekick.WORKFLOW}
},loadPanels:function(k,c){var b=this;
if(!c){c={}
}c=CQ.Ext.applyIf(c,this.initialConfig);
if(!this.panelsLoaded){this.panels={};
for(var j=0;
j<CQ.wcm.Sidekick.CONTEXTS.length;
j++){if(CQ.wcm.Sidekick.CONTEXTS[j]==CQ.wcm.Sidekick.COMPONENTS){this.panels[CQ.wcm.Sidekick.CONTEXTS[j]]=new CQ.Ext.Panel({border:false,autoScroll:true,layout:"accordion",stateful:false,id:"cq-sk-tab-"+CQ.wcm.Sidekick.CONTEXTS[j]})
}else{if(CQ.wcm.Sidekick.CONTEXTS[j]==CQ.wcm.Sidekick.VERSIONING||CQ.wcm.Sidekick.CONTEXTS[j]==CQ.wcm.Sidekick.WORKFLOW){this.panels[CQ.wcm.Sidekick.CONTEXTS[j]]=new CQ.Ext.Panel({border:false,stateful:false,layout:"fit",id:"cq-sk-tab-"+CQ.wcm.Sidekick.CONTEXTS[j]})
}else{this.panels[CQ.wcm.Sidekick.CONTEXTS[j]]=new CQ.Ext.Panel({autoScroll:true,border:false,stateful:false,id:"cq-sk-tab-"+CQ.wcm.Sidekick.CONTEXTS[j]})
}}}this.items.get(0).getEl().fadeOut({callback:function(m){b.removeLoadingPanel();
b.add({xtype:"tabpanel",border:false,enableTabScroll:true,deferredRender:false,activeTab:0,stateful:true,id:"cq-sk-tabpanel",listeners:{tabchange:function(q,o,r){o.doLayout()
}},items:[{tabTip:CQ.I18n.getMessage("Components"),iconCls:"cq-sidekick-tab cq-sidekick-tab-icon-components",items:b.panels[CQ.wcm.Sidekick.COMPONENTS],layout:"fit"},{tabTip:CQ.I18n.getMessage("Page"),iconCls:"cq-sidekick-tab cq-sidekick-tab-icon-page",items:b.panels[CQ.wcm.Sidekick.PAGE],layout:"fit"},{tabTip:CQ.I18n.getMessage("Information"),iconCls:"cq-sidekick-tab cq-sidekick-tab-icon-info",items:b.panels[CQ.wcm.Sidekick.INFO],layout:"fit"},{tabTip:CQ.I18n.getMessage("Versioning"),iconCls:"cq-sidekick-tab cq-sidekick-tab-icon-versioning",items:b.panels[CQ.wcm.Sidekick.VERSIONING],layout:"fit"},{tabTip:CQ.I18n.getMessage("Workflow"),iconCls:"cq-sidekick-tab cq-sidekick-tab-icon-workflow",items:b.panels[CQ.wcm.Sidekick.WORKFLOW],layout:"fit"}],footerCfg:b.getLaunchesTabpanelFooter()});
b.doLayout();
try{b.items.get(0).getEl().fadeIn({duration:0.5})
}catch(n){}},duration:0.5});
this.panelsLoaded=true
}else{for(var g in this.panels){if(this.panels[g].items){while(this.panels[g].items.getCount()>0){this.panels[g].remove(this.panels[g].items.get(0),true)
}}}}this.loadActions(c);
var a=CQ.WCM.getComponentList(this.path);
if(CQ.WCM.getContentWindow().CQ.WCM.areEditablesReady()){CQ.wcm.ComponentList.loadPanel(a,b.panels[CQ.wcm.Sidekick.COMPONENTS])
}else{CQ.WCM.getContentWindow().CQ.WCM.on("editablesready",function(){var n=CQ.WCM.getComponentList();
var m=this.panels[CQ.wcm.Sidekick.COMPONENTS];
if(m.items){m.items.each(function(o){this.remove(o,true)
},m)
}CQ.wcm.ComponentList.loadPanel(n,m)
},b)
}a.addListener("updatecomponents",function(n){if(CQ.WCM.getContentWindow().CQ.WCM.areEditablesReady()){var m=this.panels[CQ.wcm.Sidekick.COMPONENTS];
if(m.items){m.items.each(function(o){this.remove(o,true)
},m)
}CQ.wcm.ComponentList.loadPanel(n,m)
}},b);
(function(){b.loadVersioningTab();
b.loadWorkflowTab()
}).defer(16);
this.doLayout()
},loadVersioningTab:function(){var c=[{name:"name"},{name:"title"},{name:"comment"},{name:"created"},{name:"label"},{name:"id"},{name:"deleted"},{name:"isBaseVersion"}];
var b=new CQ.Ext.data.JsonReader({root:"versions",fields:c});
var n=new CQ.Ext.grid.CheckboxSelectionModel({singleSelect:true});
var m=function(r,q,o){if(o.data.deleted){q.attr='style="color:grey;"'
}else{if(o.data.isBaseVersion){q.attr='style="font-weight:bold;"'
}}var t=o.data.comment;
if(t){t=CQ.Ext.util.Format.htmlEncode(t);
if(CQ.Ext.QuickTips.isEnabled()){q.attr+=' ext:qtip="'+t+'"'
}else{q.attr+=' title="'+t+'"'
}}return r
};
var g=new CQ.Ext.grid.GridPanel({border:false,width:"auto",autoHeight:true,loadMask:true,stripeRows:true,autoExpandColumn:"created",cm:new CQ.Ext.grid.ColumnModel([n,{header:CQ.I18n.getMessage("Label"),dataIndex:"label",sortable:false,width:50,renderer:m},{id:"created",header:CQ.I18n.getMessage("Created"),dataIndex:"created",sortable:false,renderer:m},{header:CQ.I18n.getMessage("Title"),dataIndex:"title",sortable:false,hidden:true,width:80,renderer:m},{header:CQ.I18n.getMessage("Name"),dataIndex:"name",hidden:true,sortable:false,width:80,renderer:m}]),sm:n,store:new CQ.Ext.data.SimpleStore({fields:c}),enableHdMenu:true});
var k=this.panels[CQ.wcm.Sidekick.VERSIONING];
var j=CQ.HTTP.getParameter(CQ.WCM.getContentUrl(),"cq_diffTo")!=null;
var a={xtype:"panel",layout:"accordion",defaults:{xtype:"panel",border:false,autoScroll:true},border:false,items:[{title:CQ.I18n.getMessage("Create Version"),collapsed:j,layout:"form",cls:"cq-sidekick-form",items:[{xtype:"textfield",name:"label",id:"cq-sk-cv-label",fieldLabel:CQ.I18n.getMessage("Label"),listeners:{render:function(){this.el.parent().parent().setStyle("display","none")
}}},{xtype:"textarea",name:"comment",id:"cq-sk-cv-comment",growMin:30,fieldLabel:CQ.I18n.getMessage("Comment"),defaultValue:CQ.I18n.getMessage("Created by {0}",CQ.User.getCurrentUser().getUserName())},{xtype:"panel",layout:"column",border:false,defaults:{border:false},items:[{xtype:"panel",items:{xtype:"button",text:CQ.I18n.getMessage("Create Version"),handler:function(){var o=CQ.wcm.Sidekick.findSidekick(this);
var q=CQ.HTTP.externalize("/bin/wcmcommand");
var r={};
r[CQ.Sling.CHARSET]="utf-8";
r[CQ.Sling.STATUS]=CQ.Sling.STATUS_BROWSER;
r.cmd="createVersion";
r.label=CQ.Ext.getCmp("cq-sk-cv-label").getValue();
r.comment=CQ.Ext.getCmp("cq-sk-cv-comment").getValue();
r[o.pathParam]=o.getPath();
var t=function(u,x,w){if(x){var v=CQ.HTTP.buildPostResponseFromHTML(w.responseText);
if(v.headers[CQ.HTTP.HEADER_STATUS]=="200"){CQ.Notification.notifyFromResponse(v,null,true);
CQ.Ext.getCmp("cq-sk-cv-label").reset();
CQ.Ext.getCmp("cq-sk-cv-comment").reset()
}}};
CQ.HTTP.post(q,t,r)
}}},{xtype:"panel",items:{xtype:"button",text:CQ.I18n.getMessage("More")+" &raquo;",handler:function(){var o=CQ.Ext.getCmp("cq-sk-cv-label").el.parent().parent();
if(o.isVisible()){o.setStyle("display","none");
this.setText(CQ.I18n.getMessage("More")+" &raquo;")
}else{o.setStyle("display","");
this.setText(CQ.I18n.getMessage("Less")+" &laquo;")
}}}}]}]},{title:CQ.I18n.getMessage("Restore Version"),collapsed:!j,layout:"form",cls:"cq-sidekick-form",listeners:{activate:function(){var q=CQ.wcm.Sidekick.findSidekick(this);
var t="/bin/wcm/versions.json";
t=CQ.HTTP.addParameter(t,q.pathParam,q.getPath());
t=CQ.HTTP.noCaching(t);
var v=b.read(CQ.HTTP.get(CQ.shared.HTTP.externalize(t)));
var o={};
for(var u=0;
u<v.records.length;
u++){var x=v.records[u].data;
o[x.id]=[x.name,x.title,x.comment,x.created,x.label,x.id,x.deleted,x.isBaseVersion]
}var w=[];
for(var y in o){w[w.length]=o[y]
}g.getStore().loadData(w);
if(j){g.on("render",function(r){r.el.mask()
})
}}},items:[{xtype:"panel",layout:"column",border:false,defaults:{border:false,autoScroll:true},items:[{xtype:"button",hidden:true,text:CQ.I18n.getMessage("View"),handler:function(){}},{xtype:"button",text:j?"&laquo; "+CQ.I18n.getMessage("Back"):CQ.I18n.getMessage("Diff"),handler:function(){var o=CQ.wcm.Sidekick.findSidekick(this);
if(j){this.setText(CQ.I18n.getMessage("Diff"));
g.el.unmask();
var q=CQ.HTTP.externalize(o.getPath()+".html");
q=CQ.HTTP.noCaching(q);
CQ.Util.reload(CQ.WCM.getContentWindow(),q)
}else{var r=g.getSelectionModel().getSelected();
if(!r){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Info"),CQ.I18n.getMessage("Please select a version first."));
return
}var q=CQ.HTTP.externalize(o.getPath()+".html");
q=CQ.HTTP.addParameter(q,"cq_diffTo",r.data.label);
q=CQ.HTTP.addParameter(q,"wcmmode","preview");
q=CQ.HTTP.noCaching(q);
this.setText("&laquo; "+CQ.I18n.getMessage("Back"));
g.el.mask();
CQ.Util.reload(CQ.WCM.getContentWindow(),q)
}}},{xtype:"button",text:CQ.I18n.getMessage("Restore"),handler:function(){var o=CQ.wcm.Sidekick.findSidekick(this);
var q=g.getSelectionModel().getSelected();
if(!q){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Info"),CQ.I18n.getMessage("Please select a version first."));
return
}CQ.Ext.Msg.confirm(CQ.I18n.getMessage("Restore"),CQ.I18n.getMessage("Do you really want to restore the selected version of this page?"),function(t){if(t=="yes"){var r=CQ.HTTP.externalize("/bin/wcmcommand");
var u={};
u[CQ.Sling.CHARSET]="utf-8";
u[CQ.Sling.STATUS]=CQ.Sling.STATUS_BROWSER;
u.cmd="restoreVersion";
u.id=q.data.id;
u[o.pathParam]=o.getPath();
var v=function(x,A,z){if(A){var y=CQ.HTTP.buildPostResponseFromHTML(z.responseText);
if(y.headers[CQ.HTTP.HEADER_STATUS]=="200"){var w=CQ.HTTP.externalize(o.getPath()+".html");
w=CQ.HTTP.noCaching(w);
CQ.Util.reload(CQ.WCM.getContentWindow(),w)
}}};
CQ.HTTP.post(r,v,u)
}},this)
}}]},{xtype:"panel",border:false,style:"border-top-width:1px",items:g}]},this.getLaunchesPanelConfig(j),{title:CQ.I18n.getMessage("Timewarp"),layout:"form",cls:"cq-sidekick-form",items:[{xtype:"datetime",id:"cq.sidekick.timewarp.datetime",dateWidth:90,timeWidth:90,value:"now"},{xtype:"panel",layout:"column",border:false,defaults:{border:false,autoScroll:true},items:[{xtype:"button",text:CQ.I18n.getMessage("Go"),id:"cq.sidekick.timewarp.go_button",handler:function(){var o=CQ.wcm.Sidekick.findSidekick(this);
var r=CQ.Ext.getCmp("cq.sidekick.timewarp.datetime").getDateValue();
if(r){CQ.HTTP.setCookie(CQ.WCM.TIMEWARP_COOKIE,r.getTime(),"/",0);
var q=CQ.HTTP.externalize(o.getPath()+".html");
o.destroy();
CQ.WCM.getTopWindow().CQ_Sidekick=null;
CQ.Util.reload(CQ.WCM.getContentWindow(),q)
}}},{xtype:"button",text:CQ.I18n.getMessage("Show Timeline"),handler:function(){var o=CQ.wcm.Sidekick.findSidekick(this);
var q=new CQ.Dialog(o.getTimelineWindowConfig());
q.show()
}}]}]}]};
k.add(a);
k.doLayout()
},loadWorkflowTab:function(){var workflowPanel=this.panels[CQ.wcm.Sidekick.WORKFLOW];
var pagePath=this.path;
var workflowSubPanels=[];
var pageInfo=CQ.WCM.getPageInfo(this.getPath());
var workflowConsolePanel={xtype:"panel",title:CQ.I18n.getMessage("Workflow"),layout:"form",layoutConfig:{defaultAnchor:null},cls:"cq-sidekick-form",border:false};
var workflowPackageInfo=pageInfo.workflowPackageInfo;
var wPackages=pageInfo.workflowPackageInfo&&pageInfo.workflowPackageInfo.workflowPackages?pageInfo.workflowPackageInfo.workflowPackages:[];
var isInWorkflow=pageInfo.workflowInfo&&pageInfo.workflowInfo.isRunning;
var isInWorkflowPackage=workflowPackageInfo&&workflowPackageInfo.selectedWorkflowPackages.length>0;
var isInRunningWorkflowPackage=workflowPackageInfo&&workflowPackageInfo.runningSelectedWorkflowPackages.length>0;
var wpPanelItems;
if(!isInWorkflowPackage){if(isInWorkflow){wpPanelItems=[{xtype:"label",text:CQ.I18n.getMessage("Unable to add to a package because of a running workflow.")}]
}else{wpPanelItems=[{xtype:"selection",type:"select",name:"workflowPackage",fieldLabel:CQ.I18n.getMessage("Package"),options:CQ.WCM.getWorkflowPackageOptions(wPackages),listeners:{selectionchanged:function(){CQ.Util.toggleComponent(CQ.Ext.getCmp("cq.sidekick.workflow.package.add"),this.getValue()!="")
}}},{xtype:"panel",border:false,cls:"cq-sidekick-form",defaults:{border:false},items:[{xtype:"panel",layout:"column",items:[{xtype:"button",id:"cq.sidekick.workflow.package.add",disabled:true,text:CQ.I18n.getMessage("Add to package"),handler:function(){var sidekick=CQ.wcm.Sidekick.findSidekick(this);
var fWorkflowPackage=sidekick.getField("workflowPackage").hiddenField;
var params={"./root":pagePath,"./sling:resourceType":"cq/workflow/components/collection/definition/resource",":nameHint":"resource",_charset_:"utf-8",parentResourceType:"cq/workflow/components/collection/definition/resourcelist"};
var callback=function(options,success,xhr){if(success){var url=CQ.HTTP.externalize(sidekick.getPath()+CQ.HTTP.EXTENSION_HTML);
CQ.Util.reload(CQ.WCM.getContentWindow(),CQ.HTTP.noCaching(url))
}else{CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("The page could not be added to that workflow package. Please retry."))
}};
var formUrl=fWorkflowPackage.getValue()+"/jcr:content/vlt:definition/filter/";
CQ.HTTP.post(formUrl,callback,params,null,true)
}}]}]}]
}}else{var displayedWP=wPackages[isInRunningWorkflowPackage?workflowPackageInfo.runningSelectedWorkflowPackages[0]:workflowPackageInfo.selectedWorkflowPackages[0]];
wpPanelItems=[{xtype:"label",text:CQ.I18n.getMessage("This page is part of package:",null,"Label used to show that a page is part of a workflow package")},{xtype:"panel",border:false,cls:"cq-sidekick-form",items:{xtype:"label",text:displayedWP.title,style:{"font-weight":"bold"}}},{xtype:"panel",border:false,cls:"cq-sidekick-form",defaults:{border:false},items:[{xtype:"panel",layout:"column",items:[{xtype:"button",text:CQ.I18n.getMessage("Show"),handler:function(){CQ.shared.Util.open(CQ.HTTP.externalize(displayedWP.path+CQ.HTTP.EXTENSION_HTML))
}},{xtype:"button",text:CQ.I18n.getMessage("Remove"),handler:function(){var sidekick=CQ.wcm.Sidekick.findSidekick(this);
CQ.Ext.Msg.confirm(CQ.I18n.getMessage("Remove page from workflow package"),CQ.I18n.getMessage("You are going to remove this page from the workflow package:<br/>{0}<br/><br/>Are you sure?",[displayedWP.title]),function(btnId){if(btnId=="yes"){var params={":command":"REMOVE_MEMBER",rcPath:displayedWP.path,rcMemberPath:pagePath};
var callback=function(options,success,xhr){if(success){var url=CQ.HTTP.externalize(sidekick.getPath()+CQ.HTTP.EXTENSION_HTML);
CQ.Util.reload(CQ.WCM.getContentWindow(),CQ.HTTP.noCaching(url))
}else{CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("The page could not be removed from that workflow package. Please retry."))
}};
CQ.HTTP.post("/libs/wcm/bin/resourcecollection",callback,params,null,true)
}},this)
}}]}]}]
}var wpFieldset={collapsed:!isInWorkflowPackage,layoutConfig:{defaultAnchor:null},collapsible:true,xtype:"fieldset",title:CQ.I18n.getMessage("Workflow Package"),cls:"cq-sidekick-fieldset cq-sidekick-wfp-fieldset",items:wpPanelItems,listeners:{expand:function(){this.doLayout()
}}};
if(!isInWorkflow){var workflowOptions=[];
var translateWorkflowOptions=[];
var wData=pageInfo&&pageInfo.workflows&&pageInfo.workflows.wcm?pageInfo.workflows.wcm.models:[];
for(var i=0;
i<wData.length;
++i){workflowOptions.push({value:wData[i]["wid"],text:wData[i]["label"],text_xss:CQ.shared.XSS.getXSSTablePropertyValue(wData[i],"label")})
}var twData=pageInfo&&pageInfo.workflows&&pageInfo.workflows.translation?pageInfo.workflows.translation.models:[];
for(var i=0;
i<twData.length;
++i){translateWorkflowOptions.push({value:twData[i]["wid"],text:twData[i]["label"],text_xss:CQ.shared.XSS.getXSSTablePropertyValue(twData[i],"label")})
}workflowConsolePanel.items=[{xtype:"selection",type:"select",name:"startWorkflowModel",triggerAction:"all",fieldLabel:CQ.I18n.getMessage("Workflow"),selectOnFocus:true,cls:"x-form-element",options:workflowOptions,listeners:{selectionchanged:function(){CQ.Util.toggleComponent(CQ.Ext.getCmp("cq.sidekick.workflow.start"),this.getValue()!="")
}}},{xtype:"fieldset",collapsed:true,collapsible:true,cls:"cq-sidekick-fieldset",title:CQ.I18n.getMessage("Additional information"),items:[{xtype:"textarea",fieldLabel:CQ.I18n.getMessage("Comment"),cls:"x-form-element",name:"startComment",height:38},{xtype:"textfield",fieldLabel:CQ.I18n.getMessage("Workflow Title"),cls:"x-form-element",name:"workflowTitle"}]},{xtype:"panel",border:false,cls:"cq-sidekick-form",items:[new CQ.Ext.Button({id:"cq.sidekick.workflow.start",disabled:true,text:CQ.I18n.getMessage("Start Workflow"),handler:function(){var sidekick=CQ.wcm.Sidekick.findSidekick(this);
var fModel=sidekick.getField("startWorkflowModel").hiddenField;
var fComment=sidekick.getField("startComment");
var params={_charset_:"utf-8",payloadType:"JCR_PATH",payload:pagePath,model:fModel.getValue(),startComment:fComment.getValue(),workflowTitle:sidekick.getField("workflowTitle").getValue()};
var formUrl="/etc/workflow/instances";
var callback=function(options,success,xhr){if(success){var res=CQ.HTTP.buildPostResponseFromHTML(xhr.responseText);
if(res.headers[CQ.HTTP.HEADER_STATUS]=="201"){var url=CQ.Util.externalize(sidekick.getPath()+".html");
url=CQ.HTTP.noCaching(url);
CQ.Util.reload(CQ.WCM.getContentWindow(),url)
}}};
CQ.HTTP.post(formUrl,callback,params)
}})]},wpFieldset]
}else{var workItems=pageInfo.workflowInfo.workitems;
var workflowName=(pageInfo.workflowInfo.title)?pageInfo.workflowInfo.title+" ("+pageInfo.workflowInfo.model.title+")":pageInfo.workflowInfo.model.title;
var isWorkflowAssignedToCurrentUser=workItems.length>0;
var showWorkflowActions=isInWorkflow&&!isInRunningWorkflowPackage&&isWorkflowAssignedToCurrentUser;
if(!showWorkflowActions){workflowConsolePanel.items=[{xtype:"panel",border:false,cls:"cq-sidekick-wf-info-panel",items:[{xtype:"label",text:CQ.I18n.getMessage("This page is subject to workflow:",null,"Label used to show that a page is subject to a workflow")},{xtype:"panel",border:false,cls:"cq-sidekick-form",items:{xtype:"label",text:workflowName,style:{"font-weight":"bold"}}}]},wpFieldset]
}else{var fnGetWorkItemPath=function(){var sel=CQ.Ext.getCmp("cq.sidekick.workflow.workitems");
return sel.getValue()
};
var fnGetWorkItemDialog=function(wiPath){var dlgPath="";
var wis=pageInfo.workflowInfo.workitems;
if(wis.length>0){for(var j=0;
j<wis.length;
++j){if(wis[j].id==wiPath){dlgPath=wis[j].dialog_path;
break
}}}return dlgPath
};
var fnReload=function(){var pi=CQ.WCM.getPageInfo(CQ.WCM.getPagePath(),true);
var sel=CQ.Ext.getCmp("cq.sidekick.workflow.workitems");
var wis=pi.workflowInfo.workitems;
if(wis&&wis.length>0){var options=[];
for(var j=0;
j<wis.length;
++j){options.push({text:wis[j]["title"],value:wis[j]["id"]})
}sel.setOptions(options);
sel.setValue(wis[0]["id"])
}else{var sidekick=CQ.wcm.Sidekick.findSidekick(this);
var url=CQ.Util.externalize(sidekick.getPath()+".html");
url=CQ.HTTP.noCaching(url);
CQ.Util.reload(CQ.WCM.getContentWindow(),url)
}};
var completeAction=new CQ.Ext.Action({cls:"cq.workflow.sidekick.complete",text:CQ.I18n.getMessage("Complete"),getWorkItemPath:fnGetWorkItemPath,reload:fnReload,handler:function(){var workItemUrl=this.getWorkItemPath();
if(null===workItemUrl){this.disable()
}else{var wfDlg=[{xtype:"textarea",name:"comment",height:100,fieldLabel:CQ.I18n.getMessage("Comment"),fieldDescription:CQ.I18n.getMessage("Optional comment to describe what has been done.")}];
var dlgPath=fnGetWorkItemDialog(workItemUrl);
if(dlgPath){var dialogData=CQ.HTTP.get(CQ.HTTP.externalize(dlgPath+".infinity.json"));
var tmp=CQ.Util.formatData(CQ.HTTP.eval(dialogData));
wfDlg.unshift(tmp.items)
}var panelItems=[{xtype:"selection",id:"cq.workflow.sidekick.complete.dialog.combo",type:"select",name:"route",fieldLabel:CQ.I18n.getMessage("Next Step"),selectOnFocus:true,cls:"x-form-element",options:workItemUrl+".routes.json",optionsRoot:"routes",optionsTextField:"label",optionsValueField:"rid",optionsConfig:{emptyText:CQ.I18n.getMessage("Select a destination ..."),title:CQ.I18n.getMessage("Available Destinations"),allowBlank:false},editable:false},{xtype:"hidden",name:"item",value:workItemUrl}];
panelItems.push(wfDlg);
var completeDialogConfig={xtype:"dialog",title:CQ.I18n.getMessage("Complete Work Item"),formUrl:CQ.shared.HTTP.externalize("/bin/workflow/inbox"),params:{item:workItemUrl,_charset_:"utf-8"},items:{xtype:"panel",items:panelItems},responseScope:this,success:function(){this.reload()
},failure:function(){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not complete workflow step."))
},buttons:CQ.Dialog.OKCANCEL,listeners:{show:function(dialog){var combo=dialog.getField("route");
combo.setValue(combo.comboBox.store.getAt(0).data.value)
}}};
CQ.WCM.unregisterDialog("cq.workflow.sidekick.complete.dialog");
var completeDialog=CQ.WCM.getDialog(completeDialogConfig,"cq.workflow.sidekick.complete.dialog");
completeDialog.on("beforesubmit",function(){var combo=CQ.Ext.getCmp("cq.workflow.sidekick.complete.dialog.combo");
combo.setDisabled(false);
if(dlgPath){var payloadUrl=CQ.HTTP.externalize(CQ.WCM.getPagePath());
var action=new CQ.form.SlingSubmitAction(this.form,{url:payloadUrl});
this.form.doAction(action)
}this.noUnregisterOnHide=true;
return true
},completeDialog);
completeDialog.show()
}},tooltip:{title:CQ.I18n.getMessage("Complete Item"),text:CQ.I18n.getMessage("Completes the selected inbox item and advances workflow to the next step"),autoHide:true}});
var stepBackAction=new CQ.Ext.Action({cls:"cq.workflow.sidekick.stepBack",text:CQ.I18n.getMessage("Step Back"),getWorkItemPath:fnGetWorkItemPath,reload:fnReload,handler:function(){var workItemUrl=this.getWorkItemPath();
if(null===workItemUrl){this.disable()
}else{var stepBackDialogConfig={xtype:"dialog",title:CQ.I18n.getMessage("Step Back"),formUrl:"/bin/workflow/inbox",params:{item:workItemUrl,_charset_:"utf-8"},items:{xtype:"panel",items:[{xtype:"selection",id:"cq.workflow.sidekick.back.dialog.combo",type:"select",name:"backroute",fieldLabel:CQ.I18n.getMessage("Previous Step"),selectOnFocus:true,cls:"x-form-element",options:workItemUrl+".backroutes.json",optionsRoot:"backroutes",optionsTextField:"label",optionsValueField:"rid",optionsConfig:{emptyText:CQ.I18n.getMessage("Select a destination ..."),title:CQ.I18n.getMessage("Available Destinations"),allowBlank:false},editable:false},{xtype:"textarea",name:"comment",fieldLabel:CQ.I18n.getMessage("Comment")}]},responseScope:this,success:function(){this.reload()
},failure:function(){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not assign the work item to the step specified."))
},buttons:CQ.Dialog.OKCANCEL,listeners:{show:function(dialog){var combo=dialog.getField("backroute");
combo.setValue(combo.comboBox.store.getAt(0).data.value)
}}};
CQ.WCM.unregisterDialog("cq.workflow.sidekick.back.dialog");
var stepBackDialog=CQ.WCM.getDialog(stepBackDialogConfig,"cq.workflow.sidekick.back.dialog");
stepBackDialog.show()
}},tooltip:{title:CQ.I18n.getMessage("Step Back"),text:CQ.I18n.getMessage("Go one step back in the workflow"),autoHide:true}});
var delegateAction=new CQ.Ext.Action({cls:"cq.workflow.sidekick.delegate",text:CQ.I18n.getMessage("Delegate"),getWorkItemPath:fnGetWorkItemPath,reload:fnReload,handler:function(){var workItemUrl=this.getWorkItemPath();
if(null===workItemUrl){this.disable()
}else{var delegateDialogConfig={xtype:"dialog",title:"Delegate Work Item",formUrl:"/bin/workflow/inbox",params:{item:workItemUrl,_charset_:"utf-8"},items:{xtype:"panel",items:[{xtype:"selection",type:"select",name:"delegatee",hiddenName:"delegatee",fieldLabel:CQ.I18n.getMessage("User"),selectOnFocus:true,cls:"x-form-element",options:workItemUrl+".delegatees.json",optionsRoot:"delegatees",optionsTextField:"label",optionsValueField:"rid",optionsConfig:{emptyText:CQ.I18n.getMessage("Select a user ..."),title:CQ.I18n.getMessage("Available Users"),allowBlank:false},editable:false},{xtype:"textarea",name:"comment",fieldLabel:CQ.I18n.getMessage("Comment")}]},responseScope:this,success:function(){CQ.Notification.notify(null,CQ.I18n.getMessage("Work item has been delegated."));
this.reload()
},failure:function(){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not delegate work item."))
},buttons:CQ.Dialog.OKCANCEL};
var delegateDialog=CQ.WCM.getDialog(delegateDialogConfig);
delegateDialog.show()
}},tooltip:{title:CQ.I18n.getMessage("Delegate Item"),text:CQ.I18n.getMessage("Delegates the selected inbox item to another user or group"),autoHide:true}});
var workitemOptions=[];
for(var j=0;
j<workItems.length;
++j){workitemOptions.push({text:workItems[j]["title"],text_xss:CQ.shared.XSS.getXSSTablePropertyValue(workItems[j],"title"),value:workItems[j]["id"]})
}workflowConsolePanel.items=[{xtype:"panel",border:false,cls:"cq-sidekick-wf-info-panel",items:{xtype:"label",text:workflowName,style:{"font-weight":"bold"}}},{xtype:"selection",id:"cq.sidekick.workflow.workitems",type:"select",name:"selectedWorkItem",triggerAction:"all",fieldLabel:CQ.I18n.getMessage("Current Step"),selectOnFocus:true,allowBlank:false,cls:"x-form-element",options:workitemOptions,value:workItems[0]["id"],editable:false},new CQ.Ext.Button(completeAction),new CQ.Ext.Button(stepBackAction),new CQ.Ext.Button(delegateAction),wpFieldset]
}}workflowSubPanels.push(workflowConsolePanel);
var isInTranslation=false;
var transData={};
try{transData=pageInfo.translation;
if(pageInfo.workflow&&pageInfo.workflow.isRunning){isInTranslation=true
}else{var flagRoot=CQ.HTTP.externalize("/libs/wcm/msm/resources/flags/");
var languages=pageInfo.languages.rows;
var langOptions=[];
if(languages){for(var i=0;
i<languages.length;
i++){var row=languages[i];
if(row.path!=this.path){var img="";
var cls="cursor:pointer;";
if(row.exists){cls+="color:black;";
img="<a href='"+CQ.shared.HTTP.getXhrHookedURL(CQ.HTTP.externalize(row.path)+".html")+"' target='_new' style='"+cls+"' title='"+CQ.I18n.getMessage(row.language)+"'><img style='vertical-align:text-bottom;width:20px;margin-left:5px;' src='"+CQ.shared.HTTP.getXhrHookedURL(flagRoot+row.country+".gif")+"'></a>"
}else{cls+="color:#888888;";
img="<a href='"+CQ.shared.HTTP.getXhrHookedURL(CQ.HTTP.externalize(row.path)+".html")+"' target='_new' style='"+cls+"' title='"+CQ.I18n.getMessage(row.language)+"'><img style='vertical-align:text-bottom;opacity:0.4;filter:alpha(opacity=40);width:20px;margin-left:5px' src='"+CQ.shared.HTTP.getXhrHookedURL(flagRoot+row.country+".gif")+"'></a>"
}var lbl="<span style='"+cls+"'><a href='"+CQ.shared.HTTP.getXhrHookedURL(CQ.HTTP.externalize(row.path)+".html")+"' target='_new' title='"+CQ.I18n.getMessage(row.language)+"' style='"+cls+"'>"+CQ.I18n.getMessage(row.language)+"</a></span>";
langOptions.push({text:img+" "+lbl,value:row.path})
}}}}}catch(e){}var languagePanel;
if(!isInTranslation){languagePanel=new CQ.Ext.Panel({title:CQ.I18n.getMessage("Translation"),layout:"form",labelAlign:"top",cls:"cq-sidekick-form",items:[{xtype:"panel",height:1,border:false},{xtype:"selection",ctCls:"x-form-element-label-top",name:"langTargets",fieldLabel:CQ.I18n.getMessage("Select Languages"),type:"checkbox",options:langOptions},{xtype:"panel",height:3,border:false},{xtype:"selection",type:"select",name:"model",fieldLabel:CQ.I18n.getMessage("Workflow"),selectOnFocus:true,allowBlank:false,ctCls:"x-form-element-label-top",options:translateWorkflowOptions},{xtype:"panel",layout:"column",border:false,cls:"cq-sidekick-form",defaults:{border:false},items:[{xtype:"button",text:CQ.I18n.getMessage("Translate"),handler:function(){var sidekick=CQ.wcm.Sidekick.findSidekick(this);
var targets=sidekick.getField("langTargets").getValue();
var fModel=sidekick.getField("model").hiddenField;
var formUrl="/libs/wcm/msm/content/commands/translate";
if(fModel.getValue()==""){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Info"),CQ.I18n.getMessage("Please select a workflow first."));
return
}if(targets.length==0){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Info"),CQ.I18n.getMessage("You have to select at least one target."));
return
}var params={_charset_:"utf-8",path:pagePath,target:targets,model:fModel.getValue()};
CQ.HTTP.post(formUrl,null,params);
var url=CQ.HTTP.externalize(sidekick.getPath()+".html");
url=CQ.HTTP.noCaching(url);
CQ.Util.reload(CQ.WCM.getContentWindow(),url)
}}]}]})
}else{var langCSM=new CQ.Ext.grid.CheckboxSelectionModel({singleSelect:true});
var lineRenderer=function(value,metadata,record){if(record.data.deleted){metadata.attr='style="color:grey;"'
}var comment=record.data.comment;
if(comment){comment=CQ.Ext.util.Format.htmlEncode(comment);
if(CQ.Ext.QuickTips.isEnabled()){metadata.attr+=' ext:qtip="'+comment+'"'
}else{metadata.attr+=' title="'+comment+'"'
}}return value
};
var langGrid=new CQ.Ext.grid.GridPanel({border:false,width:"auto",autoHeight:true,loadMask:true,stripeRows:true,cm:new CQ.Ext.grid.ColumnModel([langCSM,{header:CQ.I18n.getMessage("Label"),dataIndex:"label",sortable:false,width:50,renderer:lineRenderer},{header:CQ.I18n.getMessage("Created"),dataIndex:"created",sortable:false,width:116,renderer:lineRenderer},{header:CQ.I18n.getMessage("Title"),dataIndex:"title",sortable:false,hidden:true,width:80,renderer:lineRenderer},{header:CQ.I18n.getMessage("Name"),dataIndex:"name",hidden:true,sortable:false,width:80,renderer:lineRenderer}]),sm:langCSM,store:new CQ.Ext.data.SimpleStore({fields:[{name:"name"},{name:"title"},{name:"comment"},{name:"created"},{name:"label"},{name:"id"},{name:"deleted"}]}),enableHdMenu:true});
var btnTextShow=CQ.I18n.getMessage("Show Side-By-Side");
var btnTextHide=CQ.I18n.getMessage("Hide");
languagePanel=new CQ.Ext.Panel({title:CQ.I18n.getMessage("Translation"),layout:"form",cls:"cq-sidekick-form",listeners:{beforeexpand:function(){var sidekick=CQ.wcm.Sidekick.findSidekick(this);
var revisionsTable={};
var vs=transData.original.versions;
for(var i=0;
i<vs.length;
i++){var data=vs[i];
revisionsTable[data.id]=[data.name,data.title,data.comment,data.created,data.label,data.id,data.deleted]
}var revisions=[];
for(var id in revisionsTable){revisions[revisions.length]=revisionsTable[id]
}langGrid.getStore().loadData(revisions);
if(CQ.HTTP.getParameter(CQ.WCM.getContentUrl(),"cq_diffTo")!=null){langGrid.on("render",function(grid){grid.el.mask()
})
}}},items:[{xtype:"panel",layout:"column",border:true,defaults:{border:false,autoScroll:true},items:[{xtype:"panel",items:{xtype:"button",text:CQ.WCM.getContentFinder()&&CQ.WCM.getContentFinder().isSideBoardCollapsed()?btnTextShow:btnTextHide,handler:function(){var sidekick=CQ.wcm.Sidekick.findSidekick(this);
if(CQ.WCM.getContentFinder().isSideBoardCollapsed()){var rec=langGrid.getSelectionModel().getSelected();
if(!rec){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Info"),CQ.I18n.getMessage("Please select a version first."));
return
}var url=CQ.HTTP.externalize(transData.original.path+".html");
url=CQ.HTTP.addParameter(url,"cq_diffTo",rec.data.label);
url=CQ.HTTP.addParameter(url,"wcmmode","disabled");
url=CQ.HTTP.noCaching(url);
this.setText(btnTextHide);
langGrid.el.mask();
CQ.WCM.getContentFinder().openSideBoard(url,400)
}else{langGrid.el.unmask();
this.setText(btnTextShow);
CQ.WCM.getContentFinder().closeSideBoard()
}}}},{xtype:"panel",border:false,style:"border-top-width: 1px",items:langGrid}]}]})
}workflowSubPanels.push(languagePanel);
var workflowAccordeonPanel=new CQ.Ext.Panel({layout:"accordion",border:false,forceLayout:true,defaults:{autoScroll:true,xtype:"panel",border:false},items:workflowSubPanels});
workflowPanel.add(workflowAccordeonPanel);
workflowPanel.doLayout()
},getTimelineWindowConfig:function(){return{cls:"cq-timewarpdialog",title:CQ.I18n.getMessage("Timeline"),layout:"fit",y:100,width:800,height:300,minWidth:CQ.themes.Dialog.MIN_WIDTH,minHeight:CQ.themes.Dialog.MIN_HEIGHT,closable:true,closeAction:"hide",stateful:false,buttons:[{text:CQ.I18n.getMessage("Go"),handler:function(c){var b=(CQ.WCM.isTimewarpMode())?CQ.Ext.getCmp("cq.sidekick.timewarp.datetime_outside"):CQ.Ext.getCmp("cq.sidekick.timewarp.datetime");
if(b){CQ.HTTP.setCookie(window.parent.CQ.WCM.TIMEWARP_COOKIE,b.getValue().getTime(),"/",0)
}var a=CQ.shared.HTTP.getXhrHookedURL(CQ.HTTP.externalize(CQ.WCM.getSidekick().getPath()+".html"));
CQ.WCM.getSidekick().destroy();
CQ.WCM.getTopWindow().CQ_Sidekick=null;
CQ.Util.reload(CQ.WCM.getContentWindow(),a);
this.close()
}},CQ.Dialog.CANCEL],items:[{html:'<iframe frameborder="0" width="100%" height="100%" src="'+CQ.shared.HTTP.getXhrHookedURL(CQ.HTTP.externalize("/libs/wcm/core/content/tools/timewarp.html")+"?path="+this.getPath())+'"></iframe>'}]}
},getEmulatorMenuConfig:function(r){if(r){var o=CQ.WCM.getPageInfo(r);
if(o&&o.emulators){var b=o.emulators;
var g=[];
if(b.groups){for(var q in b.groups){var n=b.groups[q];
g.push({xtype:"titleseparator",title:CQ.I18n.getVarMessage(n.title)});
for(var k in n){var m=n[k];
if(null==m||!m.path){continue
}g.push({text:CQ.I18n.getVarMessage(m.text),icon:m.path?CQ.HTTP.externalize(m.path+"/resources/sidekick-icon-"+k+".png"):CQ.HTTP.externalize("/libs/cq/ui/resources/0.gif"),checked:m.isDefault===true||m.isDefault=="true",group:"emulators",value:k,action:m.action,checkHandler:function(u,t){var c=CQ.WCM.getEmulatorManager();
if(c){if(t){if(u.action=="start"){c.switchEmulator(u.value)
}else{c.stopEmulator()
}}}},scope:this})
}}}else{for(var a in b){var j=b[a];
g.push({text:j.text,icon:j.path?j.path+"/resources/sidekick-icon-"+a+".png":"/libs/cq/ui/resources/0.gif",checked:j.isDefault===true||j.isDefault=="true",group:"emulators",value:a,action:j.action,checkHandler:function(u,t){var c=CQ.WCM.getEmulatorManager();
if(c){if(t){if(u.action=="start"){c.switchEmulator(u.value)
}else{c.stopEmulator()
}}}},scope:this})
}}if(g.length>0){return{menu:{items:g}}
}}}return{}
},loadActions:function(a){CQ.Timing.stamp("Start rendering sidekick");
var c=CQ.WCM.getPage(this.getPath());
this.buttons={};
var n=a.actions;
for(var b=0;
b<n.length;
b++){var g=n[b];
var m,k;
if(typeof g=="string"){k=g;
if(g==CQ.wcm.Sidekick.CREATE){m=this.getCreateConfig()
}if(g==CQ.wcm.Sidekick.CREATECHILDPAGE){m=this.getCreateChildPageConfig()
}if(g==CQ.wcm.Sidekick.COPYPAGE){m=this.getCopyPageConfig()
}if(g==CQ.wcm.Sidekick.MOVEPAGE){m=this.getMovePageConfig()
}if(g==CQ.wcm.Sidekick.DELETE){m=this.getDeleteConfig()
}if(g==CQ.wcm.Sidekick.PUBLISH){m=this.getPublishConfig(c)
}if(g==CQ.wcm.Sidekick.DEACTIVATE){m=this.getDeactivateConfig(c)
}if(g==CQ.wcm.Sidekick.ROLLOUT){m=this.getRolloutConfig(c)
}if(g==CQ.wcm.Sidekick.PRODUCTION_READY&&this.getProductionReadyConfig){m=this.getProductionReadyConfig(c)
}if(g==CQ.wcm.Sidekick.REFERENCES){m=this.getReferencesConfig()
}if(g==CQ.wcm.Sidekick.LOCK){m=this.getLockConfig(c)
}if(g==CQ.wcm.Sidekick.VERSION){m=this.getVersionConfig()
}if(g==CQ.wcm.Sidekick.RESTORE){m=this.getRestoreConfig()
}if(g==CQ.wcm.Sidekick.AUDIT){m=this.getAuditConfig()
}if(g==CQ.wcm.Sidekick.PERMS){m=this.getPermsConfig(a)
}if(g==CQ.wcm.Sidekick.PROPS){m=this.getPropsConfig(a)
}if(g==CQ.wcm.Sidekick.START_WORKFLOW){m=this.getStartWorkflowConfig()
}}else{if(typeof g=="function"){g=g.call(this,a,c)
}m=g;
k=g?g.text:""
}if(m){m.name=k;
m.disabled|=a.readOnly;
if(!m.hidden){this.addAction(m,true)
}}}for(var j in this.panels){this.panels[j].doLayout()
}CQ.Timing.stamp("Completed rendering sidekick")
},initComponent:function(){CQ.wcm.Sidekick.superclass.initComponent.call(this);
this.on("render",function(){if(CQ.WCM.getContentFinder()){this.header.on("mousedown",function(b){window.setTimeout(function(){CQ.wcm.ContentFinder.maskFrame()
},1)
})
}this.header.on("dblclick",function(){if(!this.collapsed){this.collapse()
}else{this.expand()
}},this);
this.header.on("mousedown",function(){this.suspendObservation=true
},this);
this.header.on("mouseup",function(){this.suspendObservation=false
},this);
this.previewSwitch=this.header.child(".x-tool-toggle");
this.previewSwitch.on("click",function(){var b=CQ.WCM.getContentUrl().indexOf(".scaffolding.")>0;
if(this.collapsed&&(!CQ.WCM.isEditMode()||b)){var j=CQ.WCM.getPage(this.path);
var g=CQ.WCM.isDesignMode();
var c=CQ.WCM.isPreviewMode();
this.wcmMode=CQ.WCM.setMode(CQ.WCM.MODE_EDIT);
if(b){CQ.Util.reload(CQ.WCM.getContentWindow(),CQ.HTTP.externalize(this.path+".html"))
}else{if(g){CQ.Util.reload(CQ.WCM.getContentWindow())
}else{if(!this.pageLocked&&!j.isReadOnly()){CQ.WCM.getContentWindow().CQ.WCM.show()
}}}if(c){this.hideSimulatorPanel()
}if(this.editButton){this.editButton.toggle(true)
}}},this);
var a=this;
CQ.Util.observeComponent.defer(16,this,[a,307]);
CQ.Ext.EventManager.onWindowResize(function(){this.lastCheckedPos=null
},this)
});
this.on("beforeshow",function(){var n=CQ.Ext.state.Manager.get(this.stateId||this.id);
var j=true;
if(n){var g=CQ.Ext.lib.Dom.getViewportWidth();
var c=CQ.Ext.lib.Dom.getViewportHeight();
if(n.winWidth==g&&n.winHeight==c){j=false;
var b=CQ.Ext.getDoc().getScroll();
n.x=n.x-b.left;
n.y=n.y-b.top;
this.pin()
}}if(j){this.pin("tr")
}if(CQ.WCM.isTimewarpMode()){var k=new Date(parseInt(CQ.HTTP.getCookie(CQ.WCM.TIMEWARP_COOKIE)));
var a=new CQ.Ext.Panel({xtype:"panel",width:this.width,title:CQ.I18n.getMessage("Timewarp"),cls:"cq-sidekick-form-timewarp cq-sidekick-form",renderTo:this.getEl(),items:{xtype:"panel",border:false,cls:"cq-sidekick-timewarp-panel",layout:"form",items:[{xtype:"panel",layout:"column",border:false,items:[{xtype:"panel",border:false,cls:"cq-sidekick-timewarp-datetime",items:{xtype:"datetime",id:"cq.sidekick.timewarp.datetime_outside",dateWidth:85,timeWidth:85,value:k}},{xtype:"button",text:CQ.I18n.getMessage("Go"),id:"cq.sidekick.timewarp.go_button_outside",handler:function(){var o=CQ.WCM.getSidekick();
var r=CQ.Ext.getCmp("cq.sidekick.timewarp.datetime_outside").getDateValue();
if(r){CQ.HTTP.setCookie(CQ.WCM.TIMEWARP_COOKIE,r.getTime(),"/",0);
var q=CQ.HTTP.externalize(o.getPath()+".html");
o.destroy();
CQ.WCM.getTopWindow().CQ_Sidekick=null;
CQ.Util.reload(CQ.WCM.getContentWindow(),q)
}}}]},{xtype:"panel",layout:"column",border:false,defaults:{border:false},items:[{xtype:"button",text:CQ.I18n.getMessage("Exit Timewarp"),handler:function(){var o=CQ.WCM.getSidekick();
CQ.HTTP.clearCookie(CQ.WCM.TIMEWARP_COOKIE,"/");
var q=CQ.HTTP.externalize(o.getPath()+".html");
o.destroy();
CQ.WCM.getTopWindow().CQ_Sidekick=null;
CQ.Util.reload(CQ.WCM.getContentWindow(),q);
var r=CQ.WCM.getContentFinder();
if(r){r.expand()
}}},{xtype:"button",text:CQ.I18n.getMessage("Show Timeline"),handler:function(){var o=CQ.WCM.getSidekick();
var q=new CQ.Dialog(o.getTimelineWindowConfig());
q.show()
}}]}]}});
var m=CQ.WCM.getContentFinder();
if(m){m.collapse()
}a.show()
}if(CQ.WCM.isPreviewMode()){this.showSimulatorPanel()
}});
this.on("beforestatesave",function(b,c){c.winWidth=CQ.Ext.lib.Dom.getViewportWidth();
c.winHeight=CQ.Ext.lib.Dom.getViewportHeight();
var a=CQ.Ext.getDoc().getScroll();
c.x=c.x-a.left;
c.y=c.y-a.top;
return true
});
this.on("loadcontent",function(j){var b=CQ.WCM.getPage(this.path);
if(b.isLiveCopy()){this.liveCopyStatusButton.show();
this.liveCopyStatusButton.toggle(CQ.WCM.isShownLayer(CQ.utils.WCM.LAYER_LCSTATUS))
}else{this.liveCopyStatusButton.hide()
}if(b.isDesignable()){this.designButton.show()
}else{this.designButton.hide()
}var g=CQ.WCM.getContentWindow();
var c=function(){var k=g?g.CQ_Analytics:null;
var m=k&&k.ClientContextUI&&k.ClientContextUI.isAvailable();
if(m){this.clientContextButton.show()
}else{this.clientContextButton.hide()
}};
var a=function(){var m=g?g.CQ_Analytics:null;
var k=g?g.mboxVersion:null;
var n=m&&(m.Sitecatalyst||k);
if(n){this.analyticsButton.show()
}else{this.analyticsButton.hide()
}};
if(g.CQ.WCM.areEditablesReady()){c.call(this);
a.call(this)
}else{g.CQ.WCM.on("editablesready",c,this);
g.CQ.WCM.on("editablesready",a,this)
}});
this.on("move",function(){this.suspendObservation=false
},this)
},overridePosition:function(){},pin:function(a){this.alignToViewport(a);
if(CQ.WCM.isContentWindow(window)){this.isPinned=true
}},unpin:function(){if(this.isPinned){this.isPinned=false
}},observe:function(){if(!this.suspendObservation){this.checkPosition()
}},checkPosition:function(){var c=this.getBox();
var n={x:c.x,y:c.y};
var b=CQ.Ext.getDoc().getScroll();
var k=false;
if(!this.lastScroll){this.lastScroll={left:0,top:0}
}if(this.lastScroll.top!=b.top||this.lastScroll.left!=b.left){k=true;
if(this.isPinned&&!this.startScroll){this.startScroll=this.lastScroll
}}else{if(this.isPinned&&this.startScroll){n.x+=b.left-this.startScroll.left;
n.y+=b.top-this.startScroll.top;
if(c.x!=n.x||c.y!=n.y){this.setPosition(n.x,n.y);
this.lastCheckedPos=n
}this.startScroll=null;
return
}}if(k){this.lastScroll=b;
this.lastCheckedPos=null;
return
}if(this.lastCheckedPos&&this.lastCheckedPos.x==n.x&&this.lastCheckedPos.y==n.y){return
}var a=b.left;
var m=b.top;
var j=a+CQ.Ext.lib.Dom.getViewportWidth();
var g=m+CQ.Ext.lib.Dom.getViewportHeight()-18;
if(c.x+CQ.themes.Dialog.CORNER_X>j){n.x=j-CQ.themes.Dialog.CORNER_X
}if(c.x+(c.width-CQ.themes.Dialog.CORNER_X)<a){n.x=-c.width+CQ.themes.Dialog.CORNER_X
}if(c.y+CQ.themes.Dialog.CORNER_Y>g){n.y=g-CQ.themes.Dialog.CORNER_Y
}if(c.y<m){n.y=m
}this.lastCheckedPos=n;
if(c.x!=n.x||c.y!=n.y){this.setPosition(n.x,n.y)
}},scrollContentToLastPosition:function(){var g=CQ.WCM.getContentWindow();
var b=g.CQ.Ext.getBody();
var k=CQ.wcm.Sidekick.SCROLLPOS_COOKIE;
var c=g.location.pathname;
if(CQ.Ext.isIE){var a=c.lastIndexOf("/");
k=k+"-"+c.substring(a+1);
c=c.substring(0,a+1)
}var j=g.CQ.HTTP.getCookie(k);
if(typeof j!==undefined&&j!==null){CQ.Log.info("CQ.wcm.Sidekick: scrolling content to y = {0}",[j]);
g.scrollTo(0,j)
}g.CQ.Ext.EventManager.on(g,"unload",function(m){var n=b.getScroll().top;
CQ.HTTP.setCookie(k,n,c,0)
})
},toFront:function(a){this.manager.bringToFront(this);
return this
},createGhost:function(){var a=CQ.wcm.Sidekick.superclass.createGhost.apply(this,arguments);
a.first().addClass("cq-sidekick");
return a
},constructor:function(b){CQ.Util.applyDefaults(b,{actions:CQ.wcm.Sidekick.DEFAULT_ACTIONS,pathParam:"path",reloadText:CQ.I18n.getMessage("Reload"),previewText:CQ.I18n.getMessage("Preview"),editText:CQ.I18n.getMessage("Edit"),designText:CQ.I18n.getMessage("Design"),adminText:CQ.I18n.getMessage("Websites"),clientContextText:CQ.I18n.getMessage("Client Context"),analyticsText:CQ.I18n.getMessage("Analytics"),miscText:CQ.I18n.getMessage("Tools"),adminUrl:"/siteadmin.html",miscUrl:"/miscadmin.html",liveCopyStatusText:CQ.I18n.getMessage("Live Copy Status"),createText:CQ.I18n.getMessage("Create Page..."),createDialog:"/libs/wcm/core/content/tools/sidekickcreatepagedialog",templateList:"/bin/wcmcommand?cmd=getTemplates",templateSelectionId:"templateselection",scaffoldingText:CQ.I18n.getMessage("Scaffolding"),deleteText:CQ.I18n.getMessage("Delete Page"),deleteUrl:"/bin/wcmcommand?cmd=deletePage",createChildPageText:CQ.I18n.getMessage("Create Child Page"),copyPageText:CQ.I18n.getMessage("Copy Page"),movePageText:CQ.I18n.getMessage("Move Page"),publishText:CQ.I18n.getMessage("Activate Page"),publishUrl:"/bin/replicate.json",deactivateText:CQ.I18n.getMessage("Deactivate Page"),referencesText:CQ.I18n.getMessage("Show References..."),rolloutText:CQ.I18n.getMessage("Rollout Page"),rolloutUrl:"/bin/wcmcommand?cmd=rollout",lockText:CQ.I18n.getMessage("Lock Page"),lockedByText:CQ.I18n.getMessage("Locked by {0}"),unlockText:CQ.I18n.getMessage("Unlock Page"),lockUrl:"/bin/wcmcommand?cmd=lockPage",unlockUrl:"/bin/wcmcommand?cmd=unlockPage",versionText:CQ.I18n.getMessage("Create Version..."),versionDialog:"/libs/wcm/core/content/tools/createversiondialog",versionList:"/bin/wcmcommand?cmd=getRevisions",versionSelectionId:"versionselection",restoreText:CQ.I18n.getMessage("Restore"),restoreDialog:"/libs/wcm/core/content/tools/restoreversiondialog",promoteText:CQ.I18n.getMessage("Promote Launch..."),markProductionReadyText:CQ.I18n.getMessage("Mark Launch Production Ready"),unmarkProductionReadyText:CQ.I18n.getMessage("Unmark Launch Production Ready"),productionReadyText:CQ.I18n.getMessage("Launch is Production Ready"),productionNotReadyText:CQ.I18n.getMessage("Launch is not Production Ready"),auditText:CQ.I18n.getMessage("Audit Log..."),auditDialog:"/libs/wcm/core/content/tools/auditlogdialog",permsText:CQ.I18n.getMessage("Permissions..."),permsDialog:"/libs/wcm/core/content/tools/permissiondialog",propsText:CQ.I18n.getMessage("Page Properties..."),propsDialog:"/libs/foundation/components/page/dialog",startWorkflowText:CQ.I18n.getMessage("Start Workflow"),startWorkflowDialog:"/libs/wcm/core/content/tools/startworkflowdialog",helpPath:"en/cq/current/wcm.html",warnIfModified:false});
this.wcmMode=CQ.WCM.getMode();
var c=CQ.WCM.getContentUrl().indexOf(".scaffolding.")>0;
var a=this;
this.applyConfigDefaults(b,{dialog:{id:"cq-sk",stateful:true,closable:false,collapsible:true,collapsed:!(CQ.WCM.isEditMode()&&!c&&!CQ.shared.HTTP.getCookie(CQ.wcm.Sidekick.COLLAPSE_COOKIE)),expandOnShow:false,border:false,bodyStyle:CQ.themes.wcm.Sidekick.BODY_STYLE,width:CQ.themes.wcm.Sidekick.WIDTH,height:CQ.themes.wcm.Sidekick.HEIGHT,minWidth:CQ.themes.wcm.Sidekick.MIN_WIDTH,minHeight:CQ.themes.wcm.Sidekick.MIN_HEIGHT,resizable:CQ.themes.wcm.Sidekick.RESIZABLE,resizeHandles:CQ.themes.wcm.Sidekick.RESIZE_HANDLES,headerAsText:false,autoHeight:false,autoWidth:false,cls:"cq-sidekick",tools:[{id:"help",handler:function(){CQ.wcm.HelpBrowser.show(b.helpPath)
}}],bbar:{},items:this.getLoadingPanelConfig(),listeners:{collapse:function(){CQ.shared.HTTP.setCookie(CQ.wcm.Sidekick.COLLAPSE_COOKIE,"true",CQ.wcm.Sidekick.COLLAPSE_COOKIE_PATH)
},expand:function(){CQ.shared.HTTP.clearCookie(CQ.wcm.Sidekick.COLLAPSE_COOKIE,CQ.wcm.Sidekick.COLLAPSE_COOKIE_PATH);
if(!CQ.WCM.isContentWindowLoading()){this.lazyLoadContent()
}}}}});
CQ.wcm.Sidekick.superclass.constructor.call(this,b)
},initButtons:function(g,b){this.reloadButton=new CQ.Ext.Button({iconCls:"cq-sidekick-reload",tooltip:{title:b.reloadText,text:CQ.I18n.getMessage("Reload the page"),autoHide:true},handler:function(){CQ.Util.reload(CQ.WCM.getContentWindow())
}});
this.previewButton=new CQ.Ext.Button({iconCls:"cq-sidekick-preview",tooltip:{title:b.previewText,text:CQ.I18n.getMessage("Switch to preview mode"),autoHide:true},pressed:CQ.WCM.isPreviewMode(),toggleGroup:"wcmMode",enableToggle:true,handler:function(){if(!CQ.WCM.isPreviewMode()){this.wcmMode=CQ.WCM.setMode(CQ.WCM.MODE_PREVIEW);
if(this.previewReload||CQ.utils.Form.requiresReloadForPreview()){CQ.Util.reload(CQ.WCM.getContentWindow())
}else{CQ.WCM.getContentWindow().CQ.WCM.hide()
}this.collapse()
}else{this.previewButton.toggle(true)
}this.showSimulatorPanel()
},scope:this});
this.scaffoldingButton=new CQ.Ext.Button({iconCls:"cq-sidekick-scaffolding",tooltip:{title:b.scaffoldingText,text:CQ.I18n.getMessage("Switch to scaffolding mode"),autoHide:true},pressed:CQ.WCM.getContentUrl().indexOf(".scaffolding.")>0,handler:function(){var j=CQ.WCM.getContentUrl().indexOf(".scaffolding.")>0;
if(!j){CQ.Util.reload(CQ.WCM.getContentWindow(),CQ.HTTP.externalize(this.path+".scaffolding.html"));
this.collapse()
}},scope:this});
var c={iconCls:"cq-sidekick-edit",tooltip:{title:b.editText,text:CQ.I18n.getMessage("Switch to edit mode"),autoHide:true},pressed:CQ.WCM.isEditMode(),toggleGroup:"wcmMode",enableToggle:true,handler:function(){if(!CQ.WCM.isEditMode()){this.wcmMode=CQ.WCM.setMode(CQ.WCM.MODE_EDIT);
CQ.WCM.getContentWindow().CQ.WCM.show()
}else{this.editButton.toggle(true)
}this.hideSimulatorPanel()
},scope:this};
if(!CQ.WCM.getContentWindow().CQ.WCM.isResponsiveMode()){c=CQ.Util.applyDefaults(this.getEmulatorMenuConfig(g),c)
}this.editButton=new CQ.Ext.Button(c);
this.designButton=new CQ.Ext.Button({iconCls:"cq-sidekick-design",tooltip:{title:b.designText,text:CQ.I18n.getMessage("Switch to design mode"),autoHide:true},pressed:CQ.WCM.isDesignMode(),toggleGroup:"wcmMode",enableToggle:true,handler:function(){if(!CQ.WCM.isDesignMode()){this.wcmMode=CQ.WCM.setMode(CQ.WCM.MODE_DESIGN);
CQ.Util.reload(CQ.WCM.getContentWindow());
this.collapse()
}else{this.designButton.toggle(true)
}},scope:this});
var a=g.indexOf("/etc/")==0;
this.adminButton=new CQ.Ext.Button({iconCls:a?"cq-sidekick-miscadmin":"cq-sidekick-siteadmin",tooltip:{title:a?b.miscText:b.adminText,text:a?CQ.I18n.getMessage("Go to Tools"):CQ.I18n.getMessage("Go to Websites"),autoHide:true},handler:function(k,j){if(this.multiWinMode==undefined){var m=CQ.User.getCurrentUser().getPreference("winMode");
this.multiWinMode=(m!="single")
}var o=CQ.HTTP.externalize(b.adminUrl);
var n=this.getPath();
if(n.indexOf("/etc/")==0){o=CQ.HTTP.externalize(b.miscUrl)
}n=n.substring(0,n.lastIndexOf("/"));
o=CQ.HTTP.setAnchor(o,n);
if(j.shiftKey||this.multiWinMode){window.open(o)
}else{window.location.href=o
}},scope:this});
this.clientContextButton=new CQ.Ext.Button({iconCls:"cq-sidekick-clientcontext",hidden:true,tooltip:{title:b.clientContextText,text:CQ.I18n.getMessage("Show the Client Context"),autoHide:true},handler:function(m,j){var o=CQ.WCM.getContentWindow();
var k=o?o.CQ_Analytics:null;
var n=k&&k.ClientContextUI&&k.ClientContextUI.isAvailable();
if(n){k.ClientContextUI.toggle()
}},scope:this});
this.liveCopyStatusButton=new CQ.Ext.Button({disabled:false,iconCls:"cq-sidekick-layer-livecopy",tooltip:{title:b.liveCopyStatusText,text:CQ.I18n.getMessage("Display Live Copy status"),autoHide:true},handler:function(){if(CQ.WCM.isShownLayer(CQ.utils.WCM.LAYER_LCSTATUS)){CQ.WCM.hideLayer(CQ.utils.WCM.LAYER_LCSTATUS)
}else{CQ.WCM.showLayer(CQ.utils.WCM.LAYER_LCSTATUS)
}this.liveCopyStatusButton.toggle(CQ.WCM.isShownLayer(CQ.utils.WCM.LAYER_LCSTATUS))
},scope:this});
this.analyticsButton=new CQ.Ext.Button({hidden:true,iconCls:"cq-sidekick-analytics",tooltip:{title:b.analyticsText,text:CQ.I18n.getMessage("Switch to analytics mode"),autoHide:true},pressed:CQ.WCM.isAnalyticsMode(),toggleGroup:"wcmMode",enableToggle:true,handler:function(){var n=CQ.WCM.getContentWindow();
var k=n?n.CQ_Analytics:null;
var j=n?n.mboxVersion:null;
var m=k&&(k.Sitecatalyst||j);
if(m){if(!CQ.WCM.isAnalyticsMode()){this.wcmMode=CQ.WCM.setMode(CQ.WCM.MODE_ANALYTICS);
CQ.Util.reload(CQ.WCM.getContentWindow());
this.collapse()
}else{this.analyticsButton.toggle(true)
}}},scope:this})
},addButtons:function(){var a=this.getBottomToolbar();
a.removeAll(true);
a.add([this.editButton,this.previewButton,this.designButton,this.analyticsButton,this.scaffoldingButton,this.liveCopyStatusButton,this.clientContextButton,"-",this.adminButton,this.reloadButton])
}});
CQ.wcm.Sidekick.componentsWithDragZone=[];
CQ.wcm.Sidekick.CLASSNAME="cq-sidekick";
CQ.wcm.Sidekick.findSidekick=function(b){var a=null;
if(b instanceof CQ.wcm.Sidekick){a=b
}else{a=b.findParentByType("sidekick")
}return a
};
CQ.wcm.Sidekick.CREATE="CREATE";
CQ.wcm.Sidekick.CREATECHILDPAGE="CREATECHILDPAGE";
CQ.wcm.Sidekick.COPYPAGE="COPYPAGE";
CQ.wcm.Sidekick.MOVEPAGE="MOVEPAGE";
CQ.wcm.Sidekick.DELETE="DELETE";
CQ.wcm.Sidekick.PUBLISH="PUBLISH";
CQ.wcm.Sidekick.DEACTIVATE="DEACTIVATE";
CQ.wcm.Sidekick.ROLLOUT="ROLLOUT";
CQ.wcm.Sidekick.PRODUCTION_READY="PRODUCTION_READY";
CQ.wcm.Sidekick.REFERENCES="REFERENCES";
CQ.wcm.Sidekick.LOCK="LOCK";
CQ.wcm.Sidekick.VERSION="VERSION";
CQ.wcm.Sidekick.RESTORE="RESTORE";
CQ.wcm.Sidekick.AUDIT="AUDIT";
CQ.wcm.Sidekick.PERMS="PERMS";
CQ.wcm.Sidekick.PROPS="PROPS";
CQ.wcm.Sidekick.START_WORKFLOW="START_WORKFLOW";
CQ.wcm.Sidekick.DEFAULT_ACTIONS=[CQ.wcm.Sidekick.PROPS,CQ.wcm.Sidekick.CREATECHILDPAGE,CQ.wcm.Sidekick.COPYPAGE,CQ.wcm.Sidekick.MOVEPAGE,CQ.wcm.Sidekick.DELETE,CQ.wcm.Sidekick.PUBLISH,CQ.wcm.Sidekick.DEACTIVATE,CQ.wcm.Sidekick.LOCK,CQ.wcm.Sidekick.REFERENCES,CQ.wcm.Sidekick.ROLLOUT,CQ.wcm.Sidekick.PRODUCTION_READY,CQ.wcm.Sidekick.AUDIT,CQ.wcm.Sidekick.PERMS];
CQ.wcm.Sidekick.PAGE="PAGE";
CQ.wcm.Sidekick.COMPONENTS="COMPONENTS";
CQ.wcm.Sidekick.WORKFLOW="WORKFLOW";
CQ.wcm.Sidekick.VERSIONING="VERSIONING";
CQ.wcm.Sidekick.INFO="INFO";
CQ.wcm.Sidekick.CONTEXTS=[CQ.wcm.Sidekick.PAGE,CQ.wcm.Sidekick.COMPONENTS,CQ.wcm.Sidekick.WORKFLOW,CQ.wcm.Sidekick.VERSIONING,CQ.wcm.Sidekick.INFO];
CQ.Ext.reg("sidekick",CQ.wcm.Sidekick);
CQ.wcm.Sidekick.DragZoneBase={getDragData:function(k){var j=k.getTarget(this.view.itemSelector);
if(j){var b=this.view;
if(!b.isSelected(j)){b.onClick(k)
}var a=b.getSelectedNodes();
var c=b.getSelectedRecords();
var g={nodes:a,records:c,srcObject:j};
if(a.length==1){var m=j;
if(c[0].data&&c[0].data.thumbnail){m=document.createElement("div");
m.innerHTML="<img src='"+c[0].data.thumbnail+"'>"
}g.ddel=m;
g.single=true
}return g
}return false
},afterRepair:function(){this.dragging=false
},getRepairXY:function(b){if(!this.dragData.multi){var a=CQ.Ext.Element.fly(this.dragData.srcObject).getXY();
a[0]+=3;
a[1]+=3;
return a
}return false
},notifyDropDT:function(j,c,b){if(this.isDropAllowed(j)){j.editComponent.maskTarget(CQ.wcm.EditBase.INSERTING_PARAGRAPH);
var g=j.editComponent;
var a=CQ.Util.copyObject(b.records[0].data);
window.setTimeout(function(){g.createParagraph(a);
j.editComponent.hideTarget()
},1);
return this
}return false
},notifyEnterDT:function(c,b,a){if(this.isDropAllowed(c)){c.editComponent.showTarget()
}return""
},notifyOutDT:function(c,b,a){if(this.isDropAllowed(c)){c.editComponent.hideTarget(true)
}return""
},notifyOverDT:function(c,b,a){if(this.isDropAllowed(c)){return this.dropAllowed
}else{return this.dropNotAllowed
}},isDropAllowed:function(b){var a=this.dragData?this.dragData.records[0].data:null;
return(b&&b.groups&&CQ.Util.isIntersecting(this.groups,b.groups)&&b.editComponent&&a&&b.editComponent.isInsertAllowed(a.virtual?a.virtualResourceType:a.resourceType))
},onDragCancel:function(a,b){if(b&&b.editComponent&&b.editComponent.hideTarget){b.editComponent.hideTarget()
}}};
CQ.wcm.Sidekick.COLLAPSE_COOKIE="cq-sk-collapsed";
CQ.wcm.Sidekick.COLLAPSE_COOKIE_PATH=CQ.HTTP.externalize("/");
CQ.wcm.Sidekick.SCROLLPOS_COOKIE="cq-scrollpos";
CQ.wcm.Sidekick.DragZone4ContentFinder=function(a,b){CQ.wcm.Sidekick.DragZone4ContentFinder.superclass.constructor.call(this,a.getEl(),b);
this.view=a
};
CQ.Ext.extend(CQ.wcm.Sidekick.DragZone4ContentFinder,CQ.wcm.ContentFinderDragZone,CQ.wcm.Sidekick.DragZoneBase);
CQ.wcm.Sidekick.DragZone=function(a,b){CQ.wcm.Sidekick.DragZone.superclass.constructor.call(this,a.getEl(),b);
this.view=a
};
CQ.Ext.extend(CQ.wcm.Sidekick.DragZone,CQ.Ext.dd.DragZone,CQ.wcm.Sidekick.DragZoneBase);
CQ.wcm.LinkChecker=CQ.Ext.extend(CQ.wcm.Viewport,{constructor:function(c){var g=new CQ.Ext.grid.ColumnModel([new CQ.Ext.grid.RowNumberer(),{dataIndex:"valid",header:CQ.I18n.getMessage("Status"),renderer:function(q,m,k,o,t,n){var r='<span style="color: {0};">{1}</span>';
if(k.data.lastChecked===""){return String.format(r,"orange",CQ.I18n.getMessage("Pending"))
}else{if(q){return String.format(r,"green",CQ.I18n.getMessage("Valid"))
}else{return String.format(r,"red",CQ.I18n.getMessage("Invalid"))
}}}},{id:"url",dataIndex:"url",header:CQ.I18n.getMessage("URL"),renderer:function(m){var n='<a href="{0}" target="_blank">{1}</a>';
var k=CQ.Ext.util.Format.htmlEncode(m);
var o=CQ.Ext.util.Format.htmlEncode(decodeURI(m));
return String.format(n,k,o)
}},{dataIndex:"referrer",header:CQ.I18n.getMessage("Referrer"),renderer:function(n){var k="";
for(var m=0;
m<n.length;
m++){var o='<a href="{0}" target="_blank">{1}</a>';
if(m>0){k+=", "
}k+=String.format(o,n[m],n[m])
}return k
}},{dataIndex:"lastChecked",header:CQ.I18n.getMessage("Last Checked"),renderer:CQ.wcm.LinkChecker.dateRenderer},{dataIndex:"status",header:CQ.I18n.getMessage("Last Status")},{dataIndex:"lastAvailable",header:CQ.I18n.getMessage("Last Available"),renderer:CQ.wcm.LinkChecker.dateRenderer},{dataIndex:"lastAccessed",header:CQ.I18n.getMessage("Last Accessed"),renderer:CQ.wcm.LinkChecker.dateRenderer}]);
g.defaultSortable=true;
var a=new CQ.Ext.grid.RowSelectionModel({});
a.on("selectionchange",CQ.wcm.LinkChecker.selectionChange);
var j=c.storage||"/var/linkchecker";
var b=new CQ.Ext.data.JsonStore({url:CQ.HTTP.externalize(j,true)+".list.json",autoLoad:true,root:"rows",fields:["url","referrer","status",{name:"valid",type:"bool"},{name:"lastAccessed"},{name:"lastChecked"},{name:"lastAvailable"}]});
CQ.wcm.LinkChecker.superclass.constructor.call(this,{id:"cq-linkchecker",items:[{xtype:"grid",id:"cq-linkchecker-grid",region:"center",margins:"5 5 5 5",loadMask:true,stripeRows:true,colModel:g,selModel:a,autoExpandColumn:"url",store:b,tbar:[{id:"cq-linkchecker-refresh",text:CQ.I18n.getMessage("Refresh"),handler:this.reloadAll},{id:"cq-linkchecker-check",text:CQ.I18n.getMessage("Check"),handler:CQ.wcm.LinkChecker.checkSelected.createCallback(j)}]}]});
CQ.wcm.LinkChecker.selectionChange(a)
},initComponent:function(){CQ.wcm.LinkChecker.superclass.initComponent.call(this)
},reloadAll:function(){CQ.Ext.getCmp("cq-linkchecker-grid").getStore().reload()
}});
CQ.wcm.LinkChecker.dateRenderer=function(g){if(!g){return""
}var b=new Date(g).getElapsed();
var n=Math.floor(b/1000);
var j=Math.floor(b/(60*1000));
var m=Math.floor(b/(60*60*1000));
var o=Math.floor(b/(24*60*60*1000));
var a=Math.floor(b/(7*24*60*60*1000));
var c=Math.floor(b/(30*24*60*60*1000));
var k=Math.floor(b/(365*24*60*60*1000));
if(n<2){return CQ.I18n.getMessage("now")
}else{if(j<2){return CQ.I18n.getMessage("{0} seconds ago",n)
}else{if(m<2){return CQ.I18n.getMessage("{0} minutes ago",j)
}else{if(o<2){return CQ.I18n.getMessage("{0} hours ago",m)
}else{if(a<2){return CQ.I18n.getMessage("{0} days ago",o)
}else{if(c<2){return CQ.I18n.getMessage("{0} weeks ago",a)
}else{if(k<2){return CQ.I18n.getMessage("{0} months ago",c)
}else{return CQ.I18n.getMessage("{0} years ago",k)
}}}}}}}};
CQ.wcm.LinkChecker.selectionChange=function(a){var b=CQ.Ext.getCmp("cq-linkchecker-check");
if(a.hasSelection()){b.enable()
}else{b.disable()
}};
CQ.wcm.LinkChecker.checkSelected=function(g){var b=CQ.HTTP.externalize(g,true);
var c=CQ.Ext.getCmp("cq-linkchecker-grid");
var a=c.getSelectionModel().getSelections();
for(i=0;
i<a.length;
i++){CQ.Ext.Ajax.request({url:b,params:{check:a[i].get("url")},method:"POST",success:CQ.wcm.LinkChecker.checkSuccess.createCallback(a[i].id),failure:CQ.wcm.LinkChecker.checkFailure.createCallback(a[i].get("url"))})
}};
CQ.wcm.LinkChecker.checkSuccess=function(c){var b=CQ.Ext.getCmp("cq-linkchecker-grid");
var a=b.getStore();
b.getSelectionModel().deselectRow(a.indexOfId(c));
a.reload()
};
CQ.wcm.LinkChecker.checkFailure=function(a){CQ.Ext.Msg.alert("Link Check Failed","Error checking link: "+a);
CQ.Ext.getCmp("cq-linkchecker-grid").getStore().reload()
};
CQ.Ext.reg("linkchecker",CQ.wcm.LinkChecker);
CQ.wcm.HelpBrowser={};
CQ.wcm.HelpBrowser.path="en/cq/current/wcm.html";
CQ.wcm.HelpBrowser.createHelpButton=function(a){a=CQ.wcm.HelpBrowser.preparePath(a);
return{text:CQ.I18n.getMessage("Help"),tooltip:{title:CQ.I18n.getMessage("AEM User Guide"),text:CQ.I18n.getMessage("Browse the online help"),autoHide:true},handler:function(){CQ.wcm.HelpBrowser.show(a)
}}
};
CQ.wcm.HelpBrowser.preparePath=function(a){a=typeof a=="string"?a:CQ.wcm.HelpBrowser.path;
a=CQ.I18n.getVarMessage(a);
if(a.charAt(0)!="/"){a="/libs/day-docs/content/"+a
}return CQ.HTTP.externalize(a)
};
CQ.wcm.HelpBrowser.show=function(a){a=CQ.wcm.HelpBrowser.preparePath(a);
if(!a.indexOf(CQ.HTTP.externalize("/libs/day-docs/content/"))&&CQ.HTTP.get(a).status==404){CQ.wcm.HelpBrowser.offerDocs(a);
return
}CQ.shared.Util.open(a).focus()
};
CQ.wcm.HelpBrowser.offerDocs=function(g){var a=CQ.I18n.getVarMessage("/crx/packageshare/index.html/packageshare/packages/public.html");
var c=g.split("/libs/day-docs/content/")[1];
c=c.slice(c.indexOf("/"));
var b=CQ.I18n.getVarMessage("http://dev.day.com/content/docs/en")+c;
b=b.replace("/current/","/5-5/");
var k=CQ.I18n.getMessage("Documentation not installed");
var j=CQ.I18n.getMessage("Package Share offers AEM documentation in several languages for local installation. Would you like to proceed to Package Share?");
CQ.wcm.HelpBrowser.instance=null;
CQ.Ext.Msg.show({title:k,msg:j,buttons:CQ.Ext.Msg.YESNO,fn:function(m){if(m=="yes"){CQ.shared.Util.open(CQ.HTTP.externalize(a)).focus()
}else{CQ.shared.Util.open(b).focus()
}},icon:CQ.Ext.MessageBox.QUESTION})
};
CQ.wcm.HelpBrowser.nodocs=function(){CQ.wcm.HelpBrowser.instance=null;
CQ.Ext.Msg.alert(CQ.I18n.getMessage("Documentation not available"),CQ.I18n.getMessage("Unable to load AEM documentation."))
};
CQ.wcm.Statistics=CQ.Ext.extend(CQ.form.CompositeField,{processRecord:function(a,b){if(this.fireEvent("beforeloadcontent",this,a,b)!==false){if(b.indexOf("/jcr:content")==b.length-"/jcr:content".length){b=b.substring(0,b.indexOf("/jcr:content"))
}this.path=CQ.HTTP.externalize(b)+"."+this.initialConfig.chartExt;
this.drawChart(CQ.wcm.Statistics.DEFAULT_PERIOD);
this.fireEvent("loadcontent",this,a,b)
}},drawChart:function(b){if(this.screenItem&&this.screenItem.rendered){var a=this.path;
if(!a){a=CQ.HTTP.externalize("/0.gif")
}a+="?Period="+b;
this.screenItem.getEl().set({src:a})
}},constructor:function(a){a=CQ.Util.applyDefaults(a,{chartExt:"views.png",stateful:false,border:false,screen:{xtype:"box",stateful:false,autoWidth:true,autoHeight:true,autoEl:{tag:"img",src:"0.gif"}},select:{type:"select",fieldLabel:CQ.I18n.getMessage("Display period"),allowBlank:false,stateful:false,width:250,optionsConfig:{width:250},value:CQ.wcm.Statistics.DEFAULT_PERIOD,options:[{value:30,text:CQ.I18n.getMessage("last month")},{value:180,text:CQ.I18n.getMessage("last 6 month")},{value:360,text:CQ.I18n.getMessage("last year")}],listeners:{selectionchanged:{fn:this.selectionHandler,scope:this}}}});
CQ.wcm.Statistics.superclass.constructor.call(this,a)
},initComponent:function(){CQ.wcm.Statistics.superclass.initComponent.call(this);
this.screenItem=new CQ.Ext.BoxComponent(this.initialConfig.screen);
this.add(this.screenItem);
this.selection=new CQ.form.Selection(this.initialConfig.select);
this.add(this.selection);
this.drawChart(this.selection.getValue())
},selectionHandler:function(a,b){this.drawChart(b)
}});
CQ.wcm.Statistics.DEFAULT_PERIOD=30;
CQ.Ext.reg("statistics",CQ.wcm.Statistics);
CQ.wcm.BulkEditor=CQ.Ext.extend(CQ.Ext.Panel,{rootPath:null,queryParams:null,contentMode:null,colsValue:null,extraCols:null,initialSearch:false,colsSelection:null,showGridOnly:false,searchPanelCollapsed:false,hideRootPath:false,hideQueryParams:false,hideContentMode:false,hideColsSelection:false,hideExtraCols:false,hideSearchButton:false,hideExportButton:false,hideImportButton:true,hideGImportButton:true,hideMoveButtons:true,hideBulkEditButton:true,bulkEditDialogType:null,bulkEditDialogPath:null,rowMovePostMode:null,hideResultNumber:false,hideSaveButton:false,hideInsertButton:true,hideDeleteButton:true,hidePathCol:false,insertedResourceType:null,queryURL:null,importURL:null,exportURL:null,saveURL:null,encoding:false,colsMetadata:null,encodeMapping:null,constructor:function(a){a=(!a?{}:a);
this.csvSeparator=(a["export"]&&a["export"]["separator"]?a["export"]["separator"]:null);
var b={hideBorders:true,border:false,stateful:false,autoHeight:true,colsMetadata:{"jcr:path":{readOnly:true}},bodyStyle:{"background-color":"#e8e8e8"},encodeMapping:{"\\.":"_DOT_"}};
this.gridPlugins=new Array();
CQ.Util.applyDefaults(a,b);
CQ.wcm.BulkEditor.superclass.constructor.call(this,a)
},toBoolean:function(a){return(a===true||a=="true")
},initComponent:function(){CQ.wcm.BulkEditor.superclass.initComponent.call(this);
if(this.showGridOnly){this.hideRootPath=true;
this.hideQueryParams=true;
this.hideContentMode=true;
this.hideColsSelection=true;
this.hideExtraCols=true;
this.hideSearchButton=true;
this.hideImportButton=(this.initialConfig.hideImportButton!==false);
this.hideResultNumber=(this.initialConfig.hideResultNumber!==false);
this.hideInsertButton=(this.initialConfig.hideInsertButton!==false);
this.hideDeleteButton=(this.initialConfig.hideDeleteButton!==false)
}this.initialSearch=this.toBoolean(this.initialSearch);
this.hideRootPath=this.toBoolean(this.hideRootPath);
this.hideQueryParams=this.toBoolean(this.hideQueryParams);
this.hideContentMode=this.toBoolean(this.hideContentMode);
this.hideColsSelection=this.toBoolean(this.hideColsSelection);
this.hideExtraCols=this.toBoolean(this.hideExtraCols);
this.hideSearchButton=this.toBoolean(this.hideSearchButton);
this.hideImportButton=this.toBoolean(this.hideImportButton);
this.hideResultNumber=this.toBoolean(this.hideResultNumber);
this.hideSaveButton=this.toBoolean(this.hideSaveButton);
this.hideInsertButton=this.toBoolean(this.hideInsertButton);
this.hideDeleteButton=this.toBoolean(this.hideDeleteButton);
this.hideExportButton=this.toBoolean(this.hideExportButton);
this.hideGImportButton=this.toBoolean(this.hideGImportButton);
this.hideMoveButtons=this.toBoolean(this.hideMoveButtons);
this.hideBulkEditButton=this.toBoolean(this.hideBulkEditButton);
this.hidePathCol=this.toBoolean(this.hidePathCol);
this.searchPanelCollapsed=this.toBoolean(this.searchPanelCollapsed);
this.addEvents("beforeloadgrid","loadgrid","beforesave","save","beforeinsertrow","insertrow","beforedeleterow","deleterow","beforemovedown","movedown","beforemoveup","moveup","beforeexport","export","beforeimport","import","beforeaddcolumntomodel","addcolumntomodel");
this.initSearchPanel();
this.initGridPanel();
this.clipboardArea=new CQ.Ext.form.TextArea({enableKeyEvents:true,style:"opacity:0",height:1,width:1,size:1});
this.add(this.clipboardArea);
if(this.insertedResourceType){this.add(new CQ.Ext.form.Hidden({name:"insertedResourceType",value:this.insertedResourceType,isFormField:false}))
}},onRender:function(b,a){CQ.wcm.BulkEditor.superclass.onRender.call(this,b,a);
if(this.initialSearch){var c=this.findParentByType("dialog");
if(c){c.on("loadcontent",this.loadGrid,this)
}else{this.gridEditor.getView();
this.gridEditor.on("render",this.loadGrid,this)
}}this.gridEditor.on("render",this.initializeCheckboxSelection,this)
},initSearchPanel:function(){this.searchPanel=new CQ.Ext.Panel(this.getSearchPanelConfig());
this.add(this.searchPanel)
},initGridPanel:function(){this.loadGrid(false);
this.add(this.gridEditor)
},initializeCheckboxSelection:function(){if(this.gridPlugins.length>0){var a=this;
this.selectAllItem=new CQ.Ext.menu.Item({id:"select-all-"+this.gridEditor.id,text:CQ.I18n.getMessage("Select All"),cls:"x-menu-check-item x-menu-item-checked",handler:function(o,n){var m=a.gridEditor.getColumnModel();
var b=a.gridEditor.view.hdCtxIndex;
var j=m.getColumnId(b);
var g=a.gridEditor.store.getCount();
for(var q=0;
q<g;
q++){a.gridEditor.startEditing(q,b);
var c=a.gridEditor.store.getAt(q);
var k=c.data[j];
if(k==="false"||k===false){c.set(j,true);
a.gridEditor.stopEditing();
a.handleEditedRecord(c,j,true,k)
}c=null
}m=null
}});
this.selectNoneItem=new CQ.Ext.menu.Item({id:"select-none-"+this.gridEditor.id,text:CQ.I18n.getMessage("Select None"),cls:"x-menu-check-item",handler:function(o,n){var m=a.gridEditor.getColumnModel();
var b=a.gridEditor.view.hdCtxIndex;
var j=m.getColumnId(b);
var g=a.gridEditor.store.getCount();
for(var q=0;
q<g;
q++){a.gridEditor.startEditing(q,b);
var c=a.gridEditor.store.getAt(q);
var k=c.data[j];
if(k==="true"||k===true){c.set(j,false);
a.gridEditor.stopEditing();
a.handleEditedRecord(c,j,false,k)
}c=null
}m=null
}});
this.gridEditor.view.hmenu.on("beforeshow",function(j,g,o,m){if(!this.selectionAdded){this.add("-",a.selectAllItem,a.selectNoneItem);
this.selectionAdded=true
}var n=a.gridEditor.getColumnModel().getColumnId(a.gridEditor.view.hdCtxIndex);
var k=a.getMetadata(n);
if(k&&(k.checkbox==="true"||k.checkbox===true)){a.selectAllItem.enable();
a.selectNoneItem.enable()
}else{a.selectAllItem.disable();
a.selectNoneItem.disable()
}},this.gridEditor.view.hmenu)
}},getMetadata:function(b){var a=b;
if(b.indexOf(CQ.wcm.BulkEditor.JCR_CONTENT_NODE+"/")!=-1){a=b.substring(CQ.wcm.BulkEditor.JCR_CONTENT_NODE.length+1)
}if(this.colsMetadata&&this.colsMetadata[a]){return this.colsMetadata[a]
}return{}
},getColObject:function(o){if(o||!this.currentColObject){var n=this.getColsValue();
var j=this.getExtraCols();
var k=this.getContentMode();
var a={};
if(n){if(typeof n=="string"){n=n.split(",")
}if(j&&typeof j=="string"){j=j.split(",")
}if(n instanceof Array){if(j&&j instanceof Array){n=n.concat(j)
}a.headers=new Array();
a.values=new Array();
for(var b=0;
b<n.length;
b++){var r=n[b];
if(r&&r.length>0){var c=r;
var g=r.indexOf(CQ.wcm.BulkEditor.JCR_CONTENT_NODE+"/");
if(k&&g==-1){r=CQ.wcm.BulkEditor.JCR_CONTENT_NODE+"/"+r
}else{if(g==0){c=r.substring(12,r.length);
if(!k){r=c
}}}var m=this.getMetadata(r);
if(m&&m.headerText){c=m.headerText
}if(a.values.indexOf(r)==-1){if(this.fireEvent("beforeaddcolumntomodel",this,r,m)!==false){a.headers.push(c);
a.values.push(r);
this.fireEvent("addcolumntomodel",this,r,m)
}}}}for(var b=0;
b<a.values.length;
b++){var m=this.getMetadata(a.values[b]);
var q=b;
if(m){var g=parseInt(m.forcedPosition);
if(!isNaN(g)&&g<a.values.length&&g!=b){q=g
}}a.values=this.moveCell(a.values,b,q);
a.headers=this.moveCell(a.headers,b,q)
}}}this.currentColObject=a
}return this.currentColObject
},moveCell:function(j,a,g){if(j&&g<j.length&&a<j.length&&g!=a){var b=0;
var c=new Array();
while(b<j.length){if(b==g){c.push(j[a]);
c.push(j[b]);
b++
}else{if(b!=a){c.push(j[b])
}b++
}}return c
}return j
},loadGrid:function(a){if(this.fireEvent("beforeloadgrid")!==false){this.modifiedItems={};
this.modifiedItems.count=0;
this.createdItems={};
this.createdItems.count=0;
this.deletedItems={};
this.deletedItems.count=0;
this.initialStoreData=null;
this.movedItems={};
this.movedItems.count=0;
var b=this.getRootPath();
this.buildGrid();
this.checkSaveButtonStatus();
if(a!="false"&&a!==false){if(this.hideRootPath||(b!=null&&b!="")){this.gridEditor.store.load()
}else{CQ.Ext.MessageBox.alert(CQ.I18n.getMessage("Missing parameter"),CQ.I18n.getMessage("Could not start search: no root path defined"))
}}this.fireEvent("loadgrid")
}},buildGridEditor:function(a){this.loadGrid(a)
},getColumnModel:function(){var c=this.getColObject(true);
var g=new Array();
if(!this.hidePathCol){g.push(this.getColumnModelConfig(CQ.wcm.BulkEditor.JCR_PATH,"Path",CQ.wcm.BulkEditor.JCR_PATH))
}for(var a=0;
a<c.values.length;
a++){g.push(this.getColumnModelConfig(c.values[a],c.headers[a],this.encodeString(c.values[a])))
}var b=new CQ.Ext.grid.ColumnModel(g);
if(!this.hideMoveButtons){b.defaultSortable=true
}return b
},computeURL:function(a){var j=this.getRootPath();
if(!j){j=this.path
}var b=this.getQueryParams();
var g="path:"+j+(b?" "+b:"");
a=CQ.HTTP.addParameter(a,"query",g);
a=CQ.HTTP.addParameter(a,"tidy","true");
var c=this.getColObject();
if(c.values&&c.values.length>0){a=CQ.HTTP.addParameter(a,"cols",""+c.values)
}return a
},getStoreURL:function(){return this.computeURL(this.queryURL)
},getExportURL:function(){var a=this.computeURL(this.exportURL);
a=CQ.HTTP.addParameter(a,"separator",this.csvSeparator);
return a
},getStore:function(){var m=this.getColObject();
var k=new Array();
k.push({name:CQ.wcm.BulkEditor.JCR_PATH});
for(var g=0;
g<m.values.length;
g++){k.push({name:this.encodeString(m.values[g])})
}var j=this.queryParamsInput.startValue;
var a=j&&j.indexOf("order:")===-1?{field:CQ.wcm.BulkEditor.JCR_PATH,direction:"ASC"}:null;
var b=this;
var c={proxy:new CQ.Ext.data.HttpProxy({url:this.getStoreURL(),method:"GET"}),reader:new CQ.Ext.data.JsonReader({totalProperty:"results",root:"hits"},k),sortInfo:a,listeners:{datachanged:function(){b.updateResultNumberLabel()
},add:function(){b.updateResultNumberLabel()
},remove:function(){b.updateResultNumberLabel()
}}};
if(this.initialConfig&&this.initialConfig.store){c=CQ.Util.applyDefaults(CQ.Util.copyObject(this.initialConfig.store),c)
}if(!this.hideMoveButtons){delete c.sortInfo
}return new CQ.Ext.data.Store(c)
},updateResultNumberLabel:function(){if(this.resultNumberLabel&&this.gridEditor){var b=0;
if(this.gridEditor.store){b=this.gridEditor.store.getCount();
b=b?b:0
}var a=b?CQ.I18n.getMessage("{0} result(s)",b):CQ.I18n.getMessage("No result");
this.resultNumberLabel.text=a;
this.resultNumberLabel.el.dom.innerHTML=a
}},buildGrid:function(){if(!this.gridEditor){this.gridEditor=new CQ.Ext.grid.EditorGridPanel(this.getGridConfig());
this.gridEditor.bulkeditor=this;
this.gridEditor.on("afteredit",this.editionHandler,this)
}else{this.gridEditor.stopEditing();
this.gridEditor.reconfigure(this.getStore(),this.getColumnModel())
}return this.gridEditor
},editionHandler:function(a){this.handleEditedRecord(a.record,a.field,a.value,a.originalValue)
},handleEditedRecord:function(b,j,g,a){if(b.data[CQ.wcm.BulkEditor.JCR_PATH]){var c=b.data[CQ.wcm.BulkEditor.JCR_PATH];
if(this.modifiedItems[c]){if(this.modifiedItems[c][j]){if(this.modifiedItems[c][j].originalValue==g){delete this.modifiedItems[c][j];
this.modifiedItems.count--;
if(CQ.Util.isEmptyObject(this.modifiedItems[c])){delete this.modifiedItems[c]
}}else{this.modifiedItems[c][j].newValue=g
}}else{this.modifiedItems[c][j]={};
this.modifiedItems[c][j].originalValue=a;
this.modifiedItems[c][j].newValue=g
}}else{this.modifiedItems[c]={};
this.modifiedItems[c][j]={};
this.modifiedItems[c][j].originalValue=a;
this.modifiedItems[c][j].newValue=g;
this.modifiedItems.count++
}}this.checkSaveButtonStatus()
},checkSaveButtonStatus:function(){if(this.saveButton){if(this.modifiedItems.count>0||this.deletedItems.count>0||this.createdItems.count>0||this.movedItems.count>0){this.saveButton.enable()
}else{this.saveButton.disable()
}}},getRootPathConfig:function(){var a={value:this.rootPath,selectOnFocus:true,name:"./rootPath",fieldLabel:CQ.I18n.getMessage("Root Path"),predicate:"nosystem",fieldDescription:CQ.I18n.getMessage("Select root path for edition")};
if(this.initialConfig&&this.initialConfig.rootPathInput){a=CQ.Util.applyDefaults(this.initialConfig.rootPathInput,a)
}return a
},getQueryParamsConfig:function(){var a={fieldLabel:CQ.I18n.getMessage("Query Parameters"),name:"./queryParams",value:this.queryParams,fieldDescription:CQ.I18n.getMessage("Enter GQL query parameters")};
if(this.initialConfig&&this.initialConfig.queryParamsInput){a=CQ.Util.applyDefaults(this.initialConfig.queryParamsInput,a)
}return a
},getContentModeConfig:function(){var a={fieldLabel:CQ.I18n.getMessage("Content Mode"),name:"./contentMode",checked:this.contentMode,boxLabel:"&nbsp;",fieldDescription:CQ.I18n.getMessage("Read all properties in jcr:content sub node")};
if(this.initialConfig&&this.initialConfig.contentModeInput){a=CQ.Util.applyDefaults(this.initialConfig.contentModeInput,a)
}return a
},getColsSelectionOptions:function(){var m=this.colsSelection;
var b=this.colsValue;
var c=new Array();
if(m){if(typeof m=="string"){m=m.split(",")
}if(m instanceof Array){for(var g=0;
g<m.length;
g++){var a=m[g];
if(a&&a.length>0){var j=a;
var k=this.getMetadata(a);
if(k&&k.headerText){j=k.headerText
}if(c.indexOf(a)==-1){c.push({boxLabel:j,name:a,value:a,checked:(b?b.indexOf(a)!=-1:false)})
}}}}}return c
},getColsSelectionConfig:function(){var c=this.getColsSelectionOptions();
var a=(c&&c.length>4?3:(c&&c.length>1?2:1));
var b={id:"cq-bulkeditor-colsselection",columns:a,vertical:true,fieldLabel:CQ.I18n.getMessage("Properties / Columns"),name:"./colsSelection",fieldDescription:CQ.I18n.getMessage("Select a list of properties to edit"),items:c};
if(this.initialConfig&&this.initialConfig.colsSelectionInput){b=CQ.Util.applyDefaults(this.initialConfig.colsSelectionInput,b)
}return b
},getExtraColsConfig:function(){var a={fieldLabel:CQ.I18n.getMessage("Custom Properties / Columns"),name:"./extraCols",value:this.extraCols,fieldDescription:CQ.I18n.getMessage("Enter extra properties, separated by comma")};
if(this.initialConfig&&this.initialConfig.extraColsInput){a=CQ.Util.applyDefaults(this.initialConfig.extraColsInput,a)
}return a
},exportToFile:function(){if(this.fireEvent("beforeexport")!==false){var a=function(){var b=this.getExportURL();
if(this.encoding){b=CQ.shared.HTTP.addParameter(b,"charset","UTF-8")
}CQ.shared.Util.open(b)
};
if(this.modifiedItems.count>0){CQ.Ext.MessageBox.confirm(CQ.I18n.getMessage("Export search result"),CQ.I18n.getMessage("Save your modifications or they will not be exported. Do you still want to export?"),a,this)
}else{a.call(this)
}this.fireEvent("export")
}},importFile:function(){if(this.fireEvent("beforeimport")!==false){var a=this.findParentByType("form");
if(a==null){a=this.findParentByType("bulkeditorform")
}if(a!=null){var b=a.getForm();
if(b.isValid()){b.el.dom.enctype="multipart/form-data";
b.fileUpload=true;
var c=new CQ.form.SlingSubmitAction(b,{method:"POST",url:this.importURL,success:function(g,j){g.el.dom.enctype="";
delete g.fileUpload;
this.clearImportInput();
var k=(j.result&&j.result.Message?j.result.Message:CQ.I18n.getMessage("No message"));
CQ.Notification.notify(CQ.I18n.getMessage("Data imported"),k);
this.loadGrid()
},failure:function(g,j){g.el.dom.enctype="";
delete g.fileUpload;
this.clearImportInput();
var k=(j.result&&j.result.Message?j.result.Message:CQ.I18n.getMessage("Unknown error"));
CQ.Notification.notify(CQ.I18n.getMessage("Import failed"),k);
this.loadGrid()
},scope:this});
b.doAction(c)
}else{this.clearImportInput();
CQ.Notification.notify(CQ.I18n.getMessage("Validation failed"),CQ.I18n.getMessage("Please select first a root path"))
}}else{this.clearImportInput();
CQ.Notification.notify(CQ.I18n.getMessage("Client page error"),CQ.I18n.getMessage("No valid form found"))
}this.fireEvent("export")
}else{this.clearImportInput()
}},openBulkEditDialog:function(){var v=[];
if(this.gridEditor){var w=this.gridEditor.getSelectionModel();
var o=this.gridEditor.getColumnModel();
var m=this.gridEditor.getStore();
if(w&&o&&m){var a=w.getSortedSelections();
if(a&&a.length>0){var r=[];
for(var u=0;
u<a.length;
u++){var q=a[u][0];
if(r.indexOf(q)==-1){var b=o.getColumnId(0);
var c=m.getAt(q);
if(c){var t=c.get(b);
v.push(t)
}r.push(q)
}}}else{var n=m.getCount();
for(var u=0;
u<n;
u++){var b=o.getColumnId(0);
var c=m.getAt(u);
if(c){var t=c.get(b);
v.push(t)
}}}}}if(v.length>0){var z=this.bulkEditDialogPath||null;
if(!z){var j=this.bulkEditDialogType||"default";
var y=this.getQueryParams();
if(!this.bulkEditDialogType&&y&&y.indexOf("type:")!=-1){y+=" ";
var k=new RegExp("type:([a-z]*)\\s.*$","ig");
j=y.replace(k,"$1");
j=j.toLowerCase()
}z="/libs/wcm/core/components/bulkeditor/bulkeditdialogs/"+j+"/dialog"
}var g=this;
var x=CQ.WCM.getDialog({url:z,success:function(){g.loadGrid()
}});
x.postToURLs=v;
x.show();
x.loadContent(z+"_default_content")
}},getSearchButtonConfig:function(){var a=this;
var b={text:CQ.I18n.getMessage("Search"),handler:function(){a.loadGrid()
}};
if(this.initialConfig&&this.initialConfig.searchButton){b=CQ.Util.applyDefaults(this.initialConfig.searchButton,b)
}return b
},getSaveButtonConfig:function(){var a=this;
var b={text:CQ.I18n.getMessage("Save"),disabled:true,handler:function(){a.saveGridModifications()
}};
if(this.initialConfig&&this.initialConfig.saveButton){b=CQ.Util.applyDefaults(this.initialConfig.saveButton,b)
}return b
},getExportButtonConfig:function(){var a=this;
var b={text:CQ.I18n.getMessage("Export"),handler:function(){a.exportToFile()
}};
if(this.initialConfig&&this.initialConfig.exportButton){b=CQ.Util.applyDefaults(this.initialConfig.exportButton,b)
}return b
},getGImportButtonConfig:function(){var a=this;
var b={xtype:"fileuploaddialogbutton",text:CQ.I18n.getMessage("Import"),fileNameParameter:"document",listeners:{click:function(c){c.dialogConfig.formUrl=a.importURL;
c.handleClick();
if(c.dialog){c.dialog.addHidden({"./rootPath":a.getRootPath()})
}}},success:function(c,g){var j=(g.result&&g.result.Message?g.result.Message:CQ.I18n.getMessage("No message"));
CQ.Notification.notify(CQ.I18n.getMessage("Data imported"),j);
a.loadGrid()
},failure:function(c,g){var j=(g.result&&g.result.Message?g.result.Message:CQ.I18n.getMessage("Unknown error"));
CQ.Notification.notify(CQ.I18n.getMessage("Import failed"),j);
a.loadGrid()
}};
if(this.initialConfig&&this.initialConfig.gimportButton){b=CQ.Util.applyDefaults(this.initialConfig.gimportButton,b)
}return b
},getExportEncodingConfig:function(){var a=this;
var b={boxLabel:CQ.I18n.getMessage("UTF-8"),handler:function(){a.encoding=!a.encoding
}};
if(this.initialConfig&&this.initialConfig.exportEncoding){b=CQ.Util.applyDefaults(this.initialConfig.exportEncoding,b)
}return b
},getBulkEditButtonConfig:function(){var a=this;
var b={text:CQ.I18n.getMessage("Bulk edit"),handler:function(){a.openBulkEditDialog()
}};
if(this.initialConfig&&this.initialConfig.bulkEditButton){b=CQ.Util.applyDefaults(this.initialConfig.bulkEditButton,b)
}return b
},getImportButtonConfig:function(){var a=this;
var b={buttonText:CQ.I18n.getMessage("Import"),buttonOnly:true,hideLabel:true,fieldWidth:"1",name:"document",listeners:{fileselected:function(){a.importFile()
}}};
if(this.initialConfig&&this.initialConfig.importButton){b=CQ.Util.applyDefaults(this.initialConfig.importButton,b)
}return b
},clearImportInput:function(){if(this.importButton){this.importButton.fileInput.dom.value="";
this.importButton.setValue("")
}},getSearchPanelConfig:function(){var g=new Array();
if(!this.hideRootPath){this.rootPathInput=new CQ.form.PathField(this.getRootPathConfig());
g.push(this.rootPathInput)
}else{this.rootPathInput=new CQ.Ext.form.Hidden(this.getRootPathConfig());
this.add(this.rootPathInput)
}if(!this.hideQueryParams){this.queryParamsInput=new CQ.Ext.form.TextField(this.getQueryParamsConfig());
g.push(this.queryParamsInput)
}if(!this.hideContentMode){this.contentModeInput=new CQ.Ext.form.Checkbox(this.getContentModeConfig());
g.push(this.contentModeInput)
}if(!this.hideSearchButton||!this.hideImportButton){var c=new Array();
if(!this.hideSearchButton){this.searchButton=new CQ.Ext.Button(this.getSearchButtonConfig());
c.push(this.searchButton)
}if(!this.hideImportButton){this.importButton=new CQ.form.FileUploadField(this.getImportButtonConfig());
c.push(this.importButton)
}var a={buttonAlign:"left",border:false,buttons:c};
g.push(a)
}var j=new Array();
if(!this.hideColsSelection){this.colsSelectionInput=new CQ.Ext.form.CheckboxGroup(this.getColsSelectionConfig());
j.push(this.colsSelectionInput)
}if(!this.hideExtraCols){this.extraColsInput=new CQ.Ext.form.TextField(this.getExtraColsConfig());
j.push(this.extraColsInput)
}this.leftSetId=CQ.Ext.id();
this.rightSetId=CQ.Ext.id();
var b={collapsible:true,collapsed:this.searchPanelCollapsed,title:CQ.I18n.getMessage("Search Filters"),hidden:this.showGridOnly,autoEl:"div",autoScroll:true,height:270,anchor:"100%",listeners:{expand:function(){this.doLayout()
}},bodyStyle:{"background-color":"#e8e8e8"},defaults:{labelWidth:150},border:true,items:[{layout:"column",border:false,defaults:{columnWidth:".5",border:false,bodyStyle:{"background-color":"#e8e8e8"}},bodyStyle:{"background-color":"#e8e8e8"},items:[{bodyStyle:{"background-color":"#e8e8e8"},items:{xtype:"fieldset",id:this.leftSetId,autoHeight:true,border:false,bodyStyle:{"background-color":"#e8e8e8",padding:"5px"},defaults:{anchor:"97%",bodyStyle:{"background-color":"#e8e8e8"}},items:g}},{items:{xtype:"fieldset",id:this.rightSetId,autoHeight:true,border:false,bodyStyle:{"background-color":"#e8e8e8",padding:"5px"},defaults:{anchor:"97%",bodyStyle:{"background-color":"#e8e8e8"}},items:j}}]}]};
if(this.initialConfig&&this.initialConfig.searchPanel){if(this.initialConfig.searchPanel.defaults&&this.initialConfig.searchPanel.defaults.xtype){delete this.initialConfig.searchPanel.defaults.xtype
}b=CQ.Util.applyDefaults(this.initialConfig.searchPanel,b)
}return b
},getSearchPanelLeftFieldSet:function(){return CQ.Ext.getCmp(this.leftSetId)
},getSearchPanelRightFieldSet:function(){return CQ.Ext.getCmp(this.rightSetId)
},recordToString:function(g){var c="";
if(g&&this.gridEditor){var b=this.gridEditor.getColumnModel();
if(b){var a=b.getColumnCount();
if(a>0){c+=g.get(b.getColumnId(0));
for(var j=1;
j<a;
j++){c+="\t"+g.get(b.getColumnId(j))
}}}}return c
},cellToString:function(b){if(b&&b.length==2&&this.gridEditor){var a=this.gridEditor.getColumnModel();
var g=this.gridEditor.getStore();
if(a&&g){var k=b[0];
var j=b[1];
if(k<0||k>=g.getCount()){return
}if(j<0||j>=a.getColumnCount()){return
}var c=g.getAt(k);
if(c){return c.get(a.getColumnId(j))
}}}},copySelectionToClipboard:function(){var c="";
if(this.gridEditor){var j=this.gridEditor.getSelectionModel();
if(j){var b=j.getSelections();
var a=b.length;
if(a>0){c+=this.cellToString(b[0]);
for(var g=1;
g<a;
g++){if(b[g][0]!=b[g-1][0]){c+="\n"
}else{c+="\t"
}c+=this.cellToString(b[g])
}}}}this.clipboardArea.setValue(c);
this.clipboardArea.el.dom.select()
},pasteClipboardIntoSelection:function(){var m=this.clipboardArea.getValue();
if(m&&this.gridEditor){var A=this.gridEditor.getSelectionModel();
var q=this.gridEditor.getColumnModel();
var o=this.gridEditor.getStore();
if(A&&q&&o){var a=A.getSortedSelections();
if(a&&a.length>0){var z=m.lastIndexOf("\n");
if(z==m.length-1){m=m.substring(0,m.length-1)
}var g=m.split("\n");
var v=0;
for(var y=0;
y<g.length&&v<a.length;
y++){var w=a[y];
var k=g[y].split("\t");
if(g.length==k.length==1){var t=k[0];
for(var x=0;
x<a.length;
x++){var r=a[x][0];
var u=a[x][1];
var c=q.getColumnId(u);
var n=o.getAt(r);
if(n){var B=n.get(c);
n.set(c,t);
this.handleEditedRecord(n,c,t,B)
}}return
}else{var b=(v>0?a[v-1][0]:-1);
var C=a[v][0];
if(b!=C){for(var x=0;
x<k.length&&v<a.length;
x++,v++){var r=a[v][0];
if(r==C){var u=a[v][1];
var c=q.getColumnId(u);
var n=o.getAt(r);
if(n){var B=n.get(c);
n.set(c,k[x]);
this.handleEditedRecord(n,c,k[x],B)
}}else{CQ.Notification.notify(CQ.I18n.getMessage("Paste error"),CQ.I18n.getMessage("Invalid pasted grid: format is different from grid selection"));
return
}}}else{CQ.Notification.notify(CQ.I18n.getMessage("Paste error"),CQ.I18n.getMessage("Invalid pasted grid: format is different from grid selection"));
return
}}}}}}},getToolBarButtons:function(){var a=new Array();
if(!this.hideResultNumber){this.resultNumberLabel=new CQ.Ext.form.Label(this.getResultNumberLabelConfig());
a.push(" ");
a.push(this.resultNumberLabel);
a.push(" ");
a.push("-")
}if(!this.hideSaveButton){this.saveButton=new CQ.Ext.Button(this.getSaveButtonConfig());
a.push(this.saveButton)
}if(!this.hideInsertButton){a.push(this.getInsertButtonConfig())
}if(!this.hideDeleteButton){a.push(this.getDeleteButtonConfig())
}if(!this.hideGImportButton){this.gimportButton=CQ.Util.build(this.getGImportButtonConfig());
a.push(this.gimportButton)
}if(!this.hideExportButton){this.exportButton=new CQ.Ext.Button(this.getExportButtonConfig());
this.exportEncoding=new CQ.Ext.form.Checkbox(this.getExportEncodingConfig());
a.push(this.exportButton);
a.push("&nbsp;&nbsp;");
a.push(this.exportEncoding)
}if(!this.hideBulkEditButton){this.bulkEditButton=new CQ.Ext.Button(this.getBulkEditButtonConfig());
a.push(this.bulkEditButton)
}if(!this.hideMoveButtons){a.push(this.getMoveDownButtonConfig());
a.push(this.getMoveUpButtonConfig())
}return a
},getGridConfig:function(){var b=this.getStore();
var a=this;
var j=this.getToolBarButtons();
var g=new CQ.wcm.CustomCellSelectionModel();
var c={store:b,cm:this.getColumnModel(),sm:g,clicksToEdit:2,height:370,stateful:false,border:true,plugins:this.gridPlugins,tbar:j,view:new CQ.Ext.grid.GridView({forceFit:true}),listeners:{keydown:function(k){if(k.ctrlKey&&k.getCharCode()==67){a.copySelectionToClipboard()
}else{if(k.ctrlKey&&k.getCharCode()==86){a.clipboardArea.el.dom.select();
window.setTimeout(function(){a.pasteClipboardIntoSelection()
},100)
}else{if(k.ctrlKey&&k.getCharCode()==65){if(a.gridEditor){var m=a.gridEditor.getSelectionModel();
if(m){m.selectAll();
k.stopEvent()
}}}}}}}};
if(this.initialConfig&&this.initialConfig.grid){c=CQ.Util.applyDefaults(CQ.Util.copyObject(this.initialConfig.grid),c)
}return c
},getResultNumberLabelConfig:function(){var a=this;
var b={text:CQ.I18n.getMessage("No result"),textBase:CQ.I18n.getMessage("{0} result(s)"),noValueText:CQ.I18n.getMessage("No result")};
if(this.initialConfig&&this.initialConfig.resultNumberLabel){b=CQ.Util.applyDefaults(CQ.Util.copyObject(this.initialConfig.resultNumberLabel),b)
}return b
},getInsertButtonConfig:function(){var a=this;
var b={text:CQ.I18n.getMessage("Insert row"),handler:function(){a.addRow()
}};
if(this.initialConfig&&this.initialConfig.insertButton){b=CQ.Util.applyDefaults(CQ.Util.copyObject(this.initialConfig.insertButton),b)
}return b
},getMoveUpButtonConfig:function(){var a=this;
var b={text:CQ.I18n.getMessage("Move up"),handler:function(){a.moveUpSelection()
}};
if(this.initialConfig&&this.initialConfig.moveUpButton){b=CQ.Util.applyDefaults(CQ.Util.copyObject(this.initialConfig.moveUpButton),b)
}return b
},getMoveDownButtonConfig:function(){var a=this;
var b={text:CQ.I18n.getMessage("Move down"),handler:function(){a.moveDownSelection()
}};
if(this.initialConfig&&this.initialConfig.moveDownButton){b=CQ.Util.applyDefaults(CQ.Util.copyObject(this.initialConfig.moveDownButton),b)
}return b
},getDeleteButtonConfig:function(){var a=this;
var b={text:CQ.I18n.getMessage("Delete row(s)"),handler:function(){a.deleteSelectedRow()
}};
if(this.initialConfig&&this.initialConfig.Button){b=CQ.Util.applyDefaults(CQ.Util.copyObject(this.initialConfig.deleteButton),b)
}return b
},addRow:function(){if(this.gridEditor){if(this.fireEvent("beforeinsertrow")!==false){var m=this.gridEditor.getSelectionModel();
m.clearSelections();
var j=this.getColObject();
var k=this.getRootPath()+"/"+new Date().getTime();
var a={};
a[CQ.wcm.BulkEditor.JCR_PATH]=k;
var g=new Array();
g.push({name:CQ.wcm.BulkEditor.JCR_PATH});
for(var c=0;
c<j.values.length;
c++){g.push({name:j.values[c],type:"string"});
a[j.values[c]]=""
}var b=CQ.Ext.data.Record.create(g);
this.gridEditor.stopEditing();
this.gridEditor.store.insert(0,new b(a));
this.gridEditor.startEditing(0,0);
this.createdItems[k]={};
this.createdItems.count++;
this.checkSaveButtonStatus();
this.fireEvent("insertrow")
}}},deleteSelectedRow:function(){if(this.gridEditor){if(this.fireEvent("beforedeleterow")!==false){var k=this.gridEditor.getSelectionModel();
var b=k.getSelections();
if(b){for(var a=b.length-1;
a>-1;
a--){var j=b[a][0];
var g=this.gridEditor.store.getAt(j);
if(g){var c=g.data[CQ.wcm.BulkEditor.JCR_PATH];
this.gridEditor.store.remove(g);
if(this.createdItems[c]!=undefined){delete this.createdItems[c];
this.createdItems.count--
}else{this.deletedItems[c]={};
this.deletedItems.count++
}if(this.modifiedItems[c]!=undefined){delete this.modifiedItems[c];
this.modifiedItems.count--
}this.checkSaveButtonStatus()
}}k.clearSelections()
}this.fireEvent("deleterow")
}}},moveDownSelection:function(){if(this.fireEvent("beforemovedown")!==false){var g=this.gridEditor.getSelectionModel();
var c=g.getSortedSelections();
if(c){this.prepareRowMove();
var v=this.gridEditor.store.getCount();
var m=[];
var u=-1;
var a=v;
var t=v;
for(var k=c.length-1;
k>-1;
k--){var o=c[k][0];
var r=c[k][1];
if(o!=a){var n=this.gridEditor.store.getAt(o);
var q=o+1;
if(q>v-1){q=v-1;
u=v-1
}else{if(q==u){u--;
q--
}else{var j=null;
if(o+1<v){j=this.gridEditor.store.getAt(o+1)
}this.gridEditor.store.remove(n);
this.gridEditor.store.insert(q,n);
var b=null;
if(q+1<v){b=this.gridEditor.store.getAt(q+1)
}this.handleRowMove(n,j,b)
}}t=q;
m.push([q,r])
}else{m.push([t,r])
}a=o
}for(var k=0;
k<m.length;
k++){g.selectCell(m[k],true)
}}this.fireEvent("movedown")
}},moveUpSelection:function(){if(this.fireEvent("beforemoveup")!==false){var c=this.gridEditor.getSelectionModel();
var b=c.getSortedSelections();
if(b){this.prepareRowMove();
var v=this.gridEditor.store.getCount();
var m=[];
var o=-1;
var u=-1;
var g=-1;
for(var k=0;
k<b.length;
k++){var q=b[k][0];
var t=b[k][1];
if(q!=u){var n=this.gridEditor.store.getAt(q);
var r=q-1;
if(r<0){r=0;
o=0
}else{if(r==o){o++;
r++
}else{var j=null;
if(q+1<v){j=this.gridEditor.store.getAt(q+1)
}this.gridEditor.store.remove(n);
this.gridEditor.store.insert(r,n);
var a=null;
if(r+1<v){a=this.gridEditor.store.getAt(r+1)
}this.handleRowMove(n,j,a)
}}g=r;
m.push([r,t])
}else{m.push([g,t])
}u=q
}for(var k=0;
k<m.length;
k++){c.selectCell(m[k],true)
}}this.fireEvent("movedown")
}},prepareRowMove:function(){if(!this.initialStoreData){var a=this.gridEditor.store.getCount();
this.initialStoreData=new CQ.Ext.util.MixedCollection(false);
this.initialStoreData.addAll([].concat(this.gridEditor.store.getRange(0,a)))
}},handleRowMove:function(o,j,a){var u=o.data[CQ.wcm.BulkEditor.JCR_PATH];
var g=null;
if(j){g=j.data[CQ.wcm.BulkEditor.JCR_PATH]
}var k=null;
if(a){k=a.data[CQ.wcm.BulkEditor.JCR_PATH]
}var m=this.gridEditor.store.indexOf(o);
var n=this.initialStoreData.indexOf(o);
if(m==n&&this.movedItems[u]){delete this.movedItems[u];
this.movedItems.count--
}else{if(!this.movedItems[u]){this.movedItems[u]={};
var r=null;
if(n+1<this.initialStoreData.length){var c=this.initialStoreData.itemAt(n+1);
r=c.data[CQ.wcm.BulkEditor.JCR_PATH]
}this.movedItems[u].initialNextPath=r;
this.movedItems[u].initialIndex=n;
this.movedItems[u].newNextPath=k;
this.movedItems[u].record=o;
this.movedItems[u].newIndex=m;
this.movedItems.count++
}else{if(this.movedItems[u].initialNextPath==k&&(!k||!this.movedItems[k])){delete this.movedItems[u];
this.movedItems.count--
}else{this.movedItems[u].newNextPath=k;
this.movedItems[u].newIndex=m
}}}for(var b in this.movedItems){if(b!="count"){var t=this.gridEditor.store.indexOf(this.movedItems[b].record);
var q=this.initialStoreData.indexOf(this.movedItems[b].record);
if(t==q){delete this.movedItems[b];
this.movedItems.count--
}else{if(b!=u){if(this.movedItems[b].newNextPath==u){this.movedItems[b].newNextPath=g
}if(this.movedItems[b].newNextPath==k){this.movedItems[b].newNextPath=u
}if(this.movedItems[b].newIndex!=t){this.movedItems[b].newIndex=t
}}}}}this.checkSaveButtonStatus()
},getColumnModelConfig:function(a,k,q){var o=this.getMetadata(a);
var m=o.checkbox===true||o.checkbox==="true";
var r=o.readOnly===true||o.readOnly==="true";
var b={id:a,header:k,dataIndex:q};
b=CQ.Util.applyDefaults(o,b);
if(this.initialConfig&&this.initialConfig.colModel){var t=this.initialConfig.colModel.width;
if(t!=undefined&&typeof t=="string"&&!isNaN(t)){this.initialConfig.colModel.width=parseInt(t)
}b=CQ.Util.applyDefaults(CQ.Util.copyObject(this.initialConfig.colModel),b)
}if(!b.width){if(this.rendered&&this.getSize()){var t=this.getSize().width;
var j=this.getColsValue();
if(j){var n=65;
if(this.colsSelectionInput&&this.colsSelectionInput.rendered){n=20
}var g=j.length+1;
b.width=parseInt((parseInt(t)-n)/g)
}}else{b.width="200"
}}if(m){b.readOnly=r;
var c=new CQ.wcm.BulkEditor.CheckColumn(b);
this.gridPlugins.push(c);
return c
}else{var u={xtype:"textfield",readOnly:r};
if(o.editor){u=CQ.Util.applyDefaults(o.editor,u)
}b.editor=CQ.Util.build(u);
return b
}},getRootPath:function(){if(this.rootPathInput){return this.rootPathInput.getValue()
}return this.rootPath
},getQueryParams:function(){if(this.queryParamsInput){return this.queryParamsInput.getValue()
}return this.queryParams
},getContentMode:function(){if(this.contentModeInput&&this.contentModeInput.rendered){return this.contentModeInput.getValue()
}return this.contentMode
},encodeString:function(b){for(var a in this.encodeMapping){b=b.replace(new RegExp("("+a+")","ig"),this.encodeMapping[a])
}return b
},decodeString:function(b){for(var a in this.encodeMapping){b=b.replace(new RegExp("("+this.encodeMapping[a]+")","ig"),a.replace(/\\/ig,""))
}return b
},getColsValue:function(){if(this.colsSelectionInput&&this.colsSelectionInput.rendered){var a=new Array();
if(this.colsSelectionInput&&this.colsSelectionInput.items){this.colsSelectionInput.items.each(function(j){if(j.getValue()){a.push(j.getName())
}},this)
}this.colsValue=a
}if(this.colsValue){return this.colsValue
}else{if(this.colsMetadata){var b=new Array();
for(var g in this.colsMetadata){if(g!="xtype"&&g!=CQ.wcm.BulkEditor.JCR_PRIMARYTYPE&&g!=CQ.wcm.BulkEditor.JCR_PATH){b.push(g)
}}return b
}}return null
},getExtraCols:function(){if(this.extraColsInput){return this.extraColsInput.getValue()
}return this.extraCols
},saveGridModifications:function(){if(this.fireEvent("beforesave")!==false){var n=false;
var g={};
var j=false;
if(!this.saveURL){this.saveURL="/"
}if(this.deletedItems&&this.deletedItems.count>0){delete this.deletedItems.count;
for(var t in this.deletedItems){if(this.modifiedItems[t]){delete this.modifiedItems[t]
}if(this.movedItems[t]){delete this.movedItems[t]
}g[t+CQ.Sling.DELETE_SUFFIX]="";
j=true
}}if(this.modifiedItems&&this.modifiedItems.count>0){delete this.modifiedItems.count;
for(var t in this.modifiedItems){for(var q in this.modifiedItems[t]){var o=this.modifiedItems[t][q].newValue;
if(o!==undefined){if(!o instanceof Array){o=[o]
}g[t+"/"+this.decodeString(q)]=o;
j=true
}}if(this.createdItems[t]&&this.insertedResourceType){g[t+"/"+CQ.wcm.BulkEditor.JCR_RESOURCETYPE]=this.insertedResourceType
}}}if(this.movedItems&&this.movedItems.count>0){delete this.movedItems.count;
var m=false;
for(var t in this.movedItems){if(this.saveURL=="/"){var b=[];
var r="last";
if(this.movedItems[t].newNextPath){var a=this.movedItems[t].newNextPath;
r="before "+a.substring(a.lastIndexOf("/")+1,a.length)
}b[CQ.Sling.ORDER]=r;
var c=CQ.HTTP.post(t,null,b);
if(!CQ.HTTP.isOk(c)){m=true
}}else{var k="newindex";
if(this.rowMovePostMode){k=this.rowMovePostMode
}switch(k){case"slingorder":g[t+"@Order"]=(this.movedItems[t].newNextPath?"before "+this.movedItems[t].newNextPath:"last");
break;
default:g[t+"@Order"]=this.movedItems[t].newIndex
}j=true
}}if(m){CQ.Ext.MessageBox.alert(CQ.I18n.getMessage("Saving error"),CQ.I18n.getMessage("Some re-ordering could not be saved."))
}}if(j){g[CQ.Sling.CHARSET]="utf-8";
var c=CQ.HTTP.post(this.saveURL,null,g);
if(!CQ.HTTP.isOk(c)){n=true
}}if(n){CQ.Ext.MessageBox.alert(CQ.I18n.getMessage("Saving error"),CQ.I18n.getMessage("Some modifications or deletions could not be saved."))
}this.fireEvent("save");
this.loadGrid()
}}});
CQ.wcm.BulkEditor.JCR_PATH="jcr:path";
CQ.wcm.BulkEditor.JCR_CONTENT_NODE="jcr:content";
CQ.wcm.BulkEditor.JCR_PRIMARYTYPE="jcr:primaryType";
CQ.wcm.BulkEditor.JCR_RESOURCETYPE="sling:resourceType";
CQ.Ext.reg("bulkeditor",CQ.wcm.BulkEditor);
CQ.wcm.BulkEditor.CheckColumn=function(a){CQ.Ext.apply(this,a);
if(!this.id){this.id=CQ.Ext.id()
}this.renderer=this.renderer.createDelegate(this)
};
CQ.wcm.BulkEditor.CheckColumn.prototype={init:function(a){this.grid=a;
this.grid.on("render",function(){var b=this.grid.getView();
b.mainBody.on("mousedown",this.onMouseDown,this)
},this)
},onMouseDown:function(c,b){if(this.readOnly!==true&&this.readOnly!=="true"){if(b.className&&b.className.indexOf("x-grid3-cc-"+this.id)!=-1){c.stopEvent();
var g=this.grid.getView().findRowIndex(b);
var a=this.grid.store.getAt(g);
a.set(this.dataIndex,!a.data[this.dataIndex]);
this.grid.bulkeditor.handleEditedRecord(a,this.dataIndex,a.data[this.dataIndex],!a.data[this.dataIndex])
}}},renderer:function(b,c,a){b=a.data[this.dataIndex]==="true"||a.data[this.dataIndex]===true;
a.data[this.dataIndex]=b;
c.css+=" x-grid3-check-col-td";
return'<div class="x-grid3-check-col'+(b?"-on":"")+" x-grid3-cc-"+this.id+'">&#160;</div>'
}};
CQ.wcm.FeedImporter=function(a){this.constructor.call(this,a)
};
CQ.wcm.FeedImporter=CQ.Ext.extend(CQ.Ext.Viewport,{viewConfig:{forceFit:true},constructor:function(j){var c=this;
var g=new CQ.Ext.data.Store({proxy:new CQ.Ext.data.HttpProxy({url:"/etc/importers/polling/list.json"}),autoLoad:true,reader:new CQ.Ext.data.JsonReader({root:"rows",totalProperty:"results",id:"path",fields:["path","scheme","source","target","interval","storedInterval","login","password"]})});
g.setDefaultSort("path","ASC");
var k=function(q){var o=(q.indexOf("/")==0)?q+".html":q;
o=CQ.Util.externalize(o);
var r='<a target="_blank" href="{0}" style="cursor:pointer">{1}</a>';
return CQ.Util.patchText(r,[o,q])
};
var a=new CQ.Ext.grid.ColumnModel([new CQ.Ext.grid.RowNumberer(),{header:CQ.I18n.getMessage("Scheme"),dataIndex:"scheme",width:60},{header:CQ.I18n.getMessage("URL"),renderer:k,dataIndex:"source",width:400},{header:CQ.I18n.getMessage("Imported to Path"),dataIndex:"target",renderer:k,width:400},{header:CQ.I18n.getMessage("Active Interval in Seconds"),dataIndex:"interval",width:140},{header:CQ.I18n.getMessage("Path of Importer Configuration"),dataIndex:"path",width:200}]);
a.defaultSortable=true;
var m=new CQ.Ext.Action({cls:"cq.wcm.FeedImporter.remove",text:CQ.I18n.getMessage("Remove"),handler:function(){CQ.Ext.Msg.show({title:CQ.I18n.getMessage("Delete Configuration?"),msg:CQ.I18n.getMessage("Would you really like to delete the importer configuration?"),buttons:CQ.Ext.Msg.YESNO,icon:CQ.Ext.MessageBox.QUESTION,fn:function(r){if(r=="yes"){var o=CQ.Ext.getCmp("cq-feedimporter-grid").getSelectionModel().getSelected();
var q={};
q[CQ.Sling.STATUS]=CQ.Sling.STATUS_BROWSER;
q[CQ.Sling.OPERATION]=CQ.Sling.OPERATION_DELETE;
q[CQ.Sling.CHARSET]="utf-8";
CQ.HTTP.post(o.id,function(u,v,t){if(v){CQ.Ext.getCmp("cq-feedimporter-grid").store.reload()
}},q,this)
}}})
},tooltip:{title:CQ.I18n.getMessage("Remove configuration entry"),text:CQ.I18n.getMessage("Removes the selected importer configuration"),autoHide:true}});
m.setDisabled(true);
var n=new CQ.Ext.Action({cls:"cq.wcm.FeedImporter.edit",text:CQ.I18n.getMessage("Edit"),handler:function(){var o=CQ.Ext.getCmp("cq-feedimporter-grid").getSelectionModel().getSelected();
c.newDialog.form.url=o.data.path;
c.newDialog.form.reset();
c.newDialog.getField("feedType").setValue(o.data.scheme);
c.newDialog.getField("feedUrl").setValue(o.data.source);
c.newDialog.getField("target").setValue(o.data.target);
c.newDialog.getField("interval").setValue(o.data.interval);
c.newDialog.getField("login").setValue(o.data.login);
c.newDialog.getField("password").setValue(o.data.password);
c.newDialog.show()
},tooltip:{title:CQ.I18n.getMessage("Edit configuration entry"),text:CQ.I18n.getMessage("Edit the selected importer configuration"),autoHide:true}});
n.setDisabled(true);
this.newDialog=CQ.WCM.getDialog({"jcr:primaryType":"cq:Dialog",xtype:"dialog",title:"New Importer Configuration",params:{_charset_:"utf-8"},items:{xtype:"panel",items:[{xtype:"hidden",name:"source"},{xtype:"selection",type:"select",name:"feedType",fieldLabel:CQ.I18n.getMessage("Type"),defaultValue:"atom",options:[{text:"RSS",value:"rss"},{text:"Atom",value:"atom"},{text:"Calendar",value:"ics"},{text:"IMAP",value:"imap"},{text:"IMAP (over SSL)",value:"imaps"},{text:"POP3",value:"pop3"},{text:"POP3 (over SSL)",value:"pop3s"},{text:"SiteCatalyst Impressions",value:"sitecatalyst"},{text:"SiteCatayst Report",value:"screport"}],listeners:{selectionchanged:{fn:this.syncSource,scope:this}}},{xtype:"textfield",name:"feedUrl",fieldLabel:CQ.I18n.getMessage("URL"),listeners:{change:{fn:this.syncSource,scope:this}}},{xtype:"pathfield",selectOnFocus:true,name:"target",fieldLabel:CQ.I18n.getMessage("Import to Path"),forceSelection:true,allowBlank:false,predicate:"nosystem",showTitlesInTree:false},{xtype:"numberfield",name:"interval",fieldSubLabel:CQ.I18n.getMessage("Optional"),fieldLabel:CQ.I18n.getMessage("Update Interval in Seconds")},{xtype:"textfield",name:"login",fieldSubLabel:CQ.I18n.getMessage("Optional"),fieldLabel:CQ.I18n.getMessage("Login")},{xtype:"password",name:"password",fieldSubLabel:CQ.I18n.getMessage("Optional"),fieldLabel:CQ.I18n.getMessage("Password")},{xtype:"hidden",ignoreData:false,name:"password@Encrypted",},{xtype:"hidden",name:"jcr:mixinTypes",value:"cq:PollConfig"},{xtype:"hidden",name:"hidden",value:"true"}]},responseScope:this,success:function(){CQ.Ext.getCmp("cq-feedimporter-grid").store.reload();
this.newDialog.form.reset()
},failure:function(){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not create feed configuration!"))
},buttons:CQ.Dialog.OKCANCEL});
var b=new CQ.Ext.Toolbar({id:"cq-feedimporter-toolbar",items:[{xtype:"button",text:CQ.I18n.getMessage("Refresh"),tooltip:CQ.I18n.getMessage("Updates the list of feed importer configurations"),handler:function(){CQ.Ext.getCmp("cq-feedimporter-grid").store.reload()
}},{xtype:"tbseparator"},{xtype:"button",text:CQ.I18n.getMessage("Add"),handler:function(){c.newDialog.form.url="/etc/importers/polling/*";
c.newDialog.show()
}},n,m]});
CQ.wcm.FeedImporter.superclass.constructor.call(this,{id:"cq-feedimporter-wrapper",renderTo:"CQ",layout:"fit",items:[{xtype:"panel",layout:"border",tbar:b,items:[{xtype:"grid",id:"cq-feedimporter-grid",region:"center",margins:"5 5 5 5",pageSize:25,loadMask:true,stripeRows:true,cm:a,store:g,sm:new CQ.Ext.grid.RowSelectionModel({singleSelect:true,listeners:{selectionchange:function(o){m.setDisabled(!o.hasSelection());
n.setDisabled(!o.hasSelection())
}}})}]}]})
},syncSource:function(){var b=this.newDialog;
var c=b.getField("feedType");
var a=b.getField("feedUrl");
var g=b.getField("source");
g.setValue(c.getValue()+":"+a.getValue())
},initComponent:function(){CQ.wcm.FeedImporter.superclass.initComponent.call(this)
}});
CQ.Ext.reg("feedimporter",CQ.wcm.FeedImporter);
CQ.wcm.FormActionSelectionRedirectHelper=CQ.Ext.extend(CQ.Ext.util.Observable,{redirectField:null,dialog:null,constructor:function(a){if(a){this.dialog=a;
a.FormActionSelectionRedirectHelper=this;
a.on("loadcontent",this.loadContentHandler)
}},setRedirectField:function(){if(!this.redirectField){var a=this.dialog.find("componentId","redirectField");
if(a&&a[0]){this.redirectField=a[0]
}}return this.redirectField
},loadContentHandler:function(g,b,c,j){var a=g.FormActionSelectionRedirectHelper;
if(j&&a.setRedirectField()){a.redirectField.setValue(b[0].get(a.redirectField.name))
}},updateRedirectField:function(j,c){var a=c["cq:redirectFieldName"];
var g="./"+(a?a:"redirect");
var b=j.FormActionSelectionRedirectHelper;
if(b&&b.setRedirectField()){var k=b.redirectField.getEl();
if(k.dom.name){b.redirectField.name=g;
k.dom.name=g
}else{throw ("Unable to set redirect field name to "+g+", no 'name' attribute in dom")
}}else{throw ("Unable to access redirectField")
}}});
CQ.wcm.FormActionSelection=CQ.Ext.extend(CQ.form.Selection,{tabId:null,workflowId:null,loadedData:null,redirectHelper:null,constructor:function(a){var b={options:"/bin/wcm/foundation/forms/actions.json",type:"select",tabId:"cq5_form_action_config_panel",workflowId:"cq5_form_action_workflow_id"};
CQ.Util.applyDefaults(a,b);
CQ.wcm.FormActionSelection.superclass.constructor.call(this,a);
this.tabId=a.tabId;
this.workflowId=a.workflowId;
this.addListener(CQ.form.Selection.EVENT_SELECTION_CHANGED,function(c,g){this.notifyChange(g,false)
});
this.redirectHelper=new CQ.wcm.FormActionSelectionRedirectHelper(this.findParentByType("dialog"))
},initComponent:function(){CQ.wcm.FormActionSelection.superclass.initComponent.call(this)
},notifyChange:function(value,loadWidgets){var dialog=this.findParentByType("dialog");
var configTab=dialog.find("componentId",this.tabId)[0];
if(configTab!=null){var form=configTab.findParentByType("form").getForm();
configTab.items.each(function(item,index,length){form.remove(item);
configTab.remove(item)
},this);
form.cleanDestroyed();
var workaroundRemoveLabels=CQ.Ext.DomQuery.select("div[class*='x-form-item']",configTab.getEl().dom);
for(var x=0;
x<workaroundRemoveLabels.length;
x++){workaroundRemoveLabels[x].parentNode.removeChild(workaroundRemoveLabels[x])
}configTab.doLayout();
var url="/bin/wcm/foundation/forms/actiondialog.json";
url=CQ.utils.HTTP.addParameter(url,"id",value);
response=CQ.utils.HTTP.get(url);
var noItems=true;
var needWorkflow=false;
if(CQ.HTTP.isOk(response)){var items=CQ.utils.Util.formatData(CQ.Util.eval(response));
this.redirectHelper.updateRedirectField(dialog,items);
for(var i in items){if(!items[i]||(typeof items[i]=="string")||(typeof items[i]=="boolean")){continue
}var wi=configTab.add(items[i]);
form.add(wi);
noItems=false;
configTab.doLayout();
wi.processRecord(this.loadedData)
}configTab.doLayout();
needWorkflow=items&&items.usesWorkflow
}if(noItems){configTab.add({xtype:"static",italic:true,small:true,style:"color:gray;",text:CQ.I18n.getMessage("No additional configuration options available")});
configTab.doLayout()
}var workflowWidget=this.findParentByType("dialog").find("componentId",this.workflowId)[0];
if(workflowWidget){workflowWidget.setDisabled(!needWorkflow)
}}},processRecord:function(a,b){this.loadedData=a;
CQ.wcm.FormActionSelection.superclass.processRecord.call(this,a,b)
},setValue:function(a){if(typeof a=="undefined"||a===null){a="foundation/components/form/actions/store"
}CQ.wcm.FormActionSelection.superclass.setValue.call(this,a);
this.notifyChange(a,true)
}});
CQ.Ext.reg("formactionselection",CQ.wcm.FormActionSelection);
CQ.wcm.FormReportButton=CQ.Ext.extend(CQ.form.CompositeField,{constructor:function(b){var c=this;
var g="/bin/wcm/foundation/forms/report.html";
if(b&&b.baseUrl){g=b.baseUrl
}var a;
if(b&&b.url){a=b.url
}b=CQ.Util.applyDefaults(b,{border:false,items:[{xtype:"panel",border:false,bodyStyle:"padding:4px",items:[{xtype:"button",text:CQ.I18n.getMessage("View Data..."),tooltip:CQ.I18n.getMessage("View data entered through this form"),handler:function(){var m=c.findParentByType("dialog");
var k;
if(a){k=CQ.HTTP.externalize(a)
}else{k=CQ.HTTP.externalize(g);
k+="?path="+m.form.url
}var j=CQ.shared.Util.open(k,null,"FormReport");
j.focus()
}}]}]});
var c=this;
CQ.wcm.FormReportButton.superclass.constructor.call(this,b)
},initComponent:function(){CQ.wcm.FormReportButton.superclass.initComponent.call(this)
}});
CQ.Ext.reg("formreportbutton",CQ.wcm.FormReportButton);
CQ.wcm.BulkEditorForm=CQ.Ext.extend(CQ.Ext.form.FormPanel,{constructor:function(a){a=(!a?{}:a);
a.xtype="bulkeditor";
var c=a.renderTo;
delete a.renderTo;
var b={renderTo:c,items:[a],hideBorders:true,border:false,stateful:false,layout:"fit"};
CQ.wcm.BulkEditorForm.superclass.constructor.call(this,b)
}});
CQ.Ext.reg("bulkeditorform",CQ.wcm.BulkEditorForm);
CQ.wcm.CustomCellSelectionModel=function(a){CQ.Ext.apply(this,a);
this.selections=[];
this.last=false;
this.lastActive=false;
this.addEvents("selectionchange","beforecellselect","cellselect","celldeselect");
CQ.wcm.CustomCellSelectionModel.superclass.constructor.call(this)
};
CQ.Ext.extend(CQ.wcm.CustomCellSelectionModel,CQ.Ext.grid.AbstractSelectionModel,{singleSelect:false,initEvents:function(){if(!this.grid.enableDragDrop&&!this.grid.enableDrag){this.grid.on("cellmousedown",this.handleMouseDown,this)
}else{this.grid.on("cellclick",function(b,j,c,g){if(g.button===0&&!g.shiftKey&&!g.ctrlKey){this.selectCell([j,c],false);
b.view.focusCell(j,c)
}},this)
}this.rowNav=new CQ.Ext.KeyNav(this.grid.getGridEl(),{up:function(g){if(this.last==false){this.selectCell([0,0])
}else{if(this.lastActive[0]==0){return
}else{var j,b;
j=this.lastActive[0]-1;
b=this.lastActive[1];
if(!g.shiftKey){this.selectCell([j,b])
}else{var c=this.last;
this.selectRange(this.last,[j,b]);
this.last=c
}this.grid.getView().focusCell(j,b);
this.lastActive=[j,b]
}}},down:function(g){if(this.last==false){this.selectCell([0,0])
}else{if(this.lastActive[0]==this.grid.getStore().getCount()-1){return
}else{var j,b;
j=this.lastActive[0]+1;
b=this.lastActive[1];
if(!g.shiftKey){this.selectCell([j,b])
}else{var c=this.last;
this.selectRange(this.last,[j,b]);
this.last=c
}this.grid.getView().focusCell(j,b);
this.lastActive=[j,b]
}}},left:function(g){if(this.last==false){this.selectCell([0,0])
}else{if(this.lastActive[1]==0){return
}else{var j,b;
j=this.lastActive[0];
b=this.lastActive[1]-1;
if(!g.shiftKey){this.selectCell([j,b])
}else{var c=this.last;
this.selectRange(this.last,[j,b]);
this.last=c
}this.grid.getView().focusCell(j,b);
this.lastActive=[j,b]
}}},right:function(g){if(this.last==false){this.selectCell([0,0])
}else{if(this.lastActive[1]==this.grid.getColumnModel().getColumnCount()-1){return
}else{var j,b;
j=this.lastActive[0];
b=this.lastActive[1]+1;
if(!g.shiftKey){this.selectCell([j,b])
}else{var c=this.last;
this.selectRange(this.last,[j,b]);
this.last=c
}this.grid.getView().focusCell(j,b);
this.lastActive=[j,b]
}}},scope:this});
var a=this.grid.view;
a.on("refresh",this.onRefresh,this);
a.on("rowremoved",this.onRemove,this)
},onRefresh:function(){this.clearSelections()
},onRemove:function(a,b,c){this.deselectRange([b,0],[b,this.grid.getColumnModel().getColumnCount()])
},getCount:function(){return this.selections.length
},selectRight:function(b){if(this.hasNext()){var c,a=this.last[1];
if(a==this.grid.getColumnModel().getColumnCount()-1){c=this.last[0]+1;
a=0
}else{c=this.last[0];
a+=1
}this.selectCell([c,a],b);
this.grid.getView().focusCell(this.last[0],this.last[1]);
return true
}return false
},selectDown:function(g){var b,c=this.grid.getColumnModel().getColumnCount();
for(var a=0;
a<c;
a++){b=this.selectRight(g);
if(!b){break
}}return b
},selectUp:function(g){var b,c=this.grid.getColumnModel().getColumnCount();
for(var a=0;
a<c;
a++){b=this.selectLeft(g);
if(!b){break
}}return b
},selectLeft:function(b){if(this.hasPrevious()){var c,a=this.last[1];
if(a==0){c=this.last[0]-1;
a=this.grid.getColumnModel().getColumnCount()-1
}else{c=this.last[0];
a-=1
}this.selectCell([c,a],b);
this.grid.getView().focusCell(this.last[0],this.last[1]);
return true
}return false
},hasNext:function(){return this.last!==false&&((this.last[0]+1)<this.grid.store.getCount()||(this.last[1]+1)<this.grid.getColumnModel().getColumnCount())
},hasPrevious:function(){return this.last!==false&&(this.last[0]!=0||this.last[1]!=0)
},getSelections:function(){return[].concat(this.selections)
},getSortedSelections:function(){return[].concat(this.selections).sort()
},getSelectedCell:function(){return this.selections.length>0?[].concat(this.selections[0]):null
},each:function(j,g){var c=this.getSelections();
for(var b=0,a=c.length;
b<a;
b++){if(j.call(g||this,c[b],b)===false){return false
}}return true
},clearSelections:function(){if(this.locked){return
}for(var a=this.selections.length-1;
a>=0;
a--){this.deselectCell(this.selections[a])
}this.selections=[];
this.last=false
},selectAll:function(){if(this.locked){return
}this.selections=[];
var g,b;
var a=this.grid.getStore().getCount();
var c=this.grid.getColumnModel().getColumnCount();
for(g=0;
g<a;
g++){for(b=0;
b<c;
b++){this.selectCell([g,b],true)
}}},hasSelection:function(){return this.selections.length>0
},isSelected:function(a){var c=this.selections;
for(var b=0;
b<c.length;
b++){if(c[b][0]==a[0]&&c[b][1]==a[1]){return true
}}return false
},handleMouseDown:function(k,n,c,m){if(m.button!==0||this.isLocked()){return
}var a=this.grid.getView();
if(m.shiftKey&&this.last!==false){var j=this.last;
this.selectRange(j,[n,c],m.ctrlKey);
this.last=j;
a.focusCell(n,c)
}else{var b=this.isSelected([n,c]);
if(m.ctrlKey&&b){this.deselectCell([n,c])
}else{if(!b||this.getCount()>1){if(b){this.clearSelections()
}this.selectCell([n,c],m.ctrlKey||m.shiftKey);
a.focusCell(n,c)
}}}},selectCells:function(b,g){if(!g){this.clearSelections()
}for(var c=0,a=b.length;
c<a;
c++){this.selectCell(b[c],true)
}},selectRange:function(k,b,q){if(this.locked){return
}if(!q){this.clearSelections()
}var o,c,m;
var n=k[0];
var a=k[1];
var g=b[0];
var j=b[1];
if(g<n){o=g;
g=n;
n=o
}if(j<a){c=j;
j=a;
a=c
}for(o=n;
o<=g;
o++){for(c=a;
c<=j;
c++){this.selectCell([o,c],true)
}}},deselectRange:function(m,b,j){if(this.locked){return
}var q,c,n;
var o=m[0];
var a=m[1];
var g=b[0];
var k=b[1];
if(g<o){q=g;
g=o;
o=q
}if(k<a){c=k;
k=a;
a=c
}for(q=o;
q<=g;
q++){for(c=a;
c<=k;
c++){this.deselectCell([q,c],j)
}}},selectCell:function(c,j,a){if(this.locked){return
}if(this.isSelected(c)){return
}var k=c[0];
var b=c[1];
if(k<0||k>=this.grid.store.getCount()){return
}if(b<0||b>=this.grid.getColumnModel().getColumnCount()){return
}if(this.fireEvent("beforecellselect",this,c,j)!==false){if(!j||this.singleSelect){this.clearSelections()
}this.selections.push(c);
this.last=this.lastActive=c;
if(!a){try{this.grid.getView().onCellSelect(k,b)
}catch(g){}}this.fireEvent("cellselect",this,c);
this.fireEvent("selectionchange",this,[].concat(this.selections))
}},deselectCell:function(b,a){if(this.locked){return
}if(this.last[0]==b[0]&&this.last[1]==b[1]){this.last=false
}if(this.lastActive[0]==b[0]&&this.lastActive[1]==b[1]){this.lastActive=false
}var g=this.selections;
for(var c=0;
c<g.length;
c++){if(g[c][0]==b[0]&&g[c][1]==b[1]){this.selections.remove(g[c]);
if(!a){try{this.grid.getView().onCellDeselect(b[0],b[1])
}catch(j){}}this.fireEvent("celldeselect",this,b);
this.fireEvent("selectionchange",[].concat(this.selections));
return
}}},acceptsNav:function(c,b,a){return !a.isHidden(b)&&a.isCellEditable(b,c)
},onEditorKey:function(n,m){var c=m.getKey(),o,j=this.grid,b=j.activeEditor;
var a=m.shiftKey;
if(c==m.TAB){m.stopEvent();
b.completeEdit();
if(a){o=j.walkCells(b.row,b.col-1,-1,this.acceptsNav,this)
}else{o=j.walkCells(b.row,b.col+1,1,this.acceptsNav,this)
}}else{if(c==m.ENTER){m.stopEvent();
b.completeEdit();
if(this.moveEditorOnEnter!==false){if(a){o=j.walkCells(b.row-1,b.col,-1,this.acceptsNav,this)
}else{o=j.walkCells(b.row+1,b.col,1,this.acceptsNav,this)
}}}else{if(c==m.ESC){b.cancelEdit()
}}}if(o){j.startEditing(o[0],o[1])
}}});
CQ.wcm.ComponentExtractor=CQ.Ext.extend(CQ.Ext.Viewport,{frame:null,highlightWidth:8,highlightColor:"#d3ea9b",highlightSelectColor:"#abd551",topOffset:0,filter:null,selectionInfo:null,tree:null,components:null,selectBtn:null,openBtn:null,selectedElement:null,dropRegion:null,dropTarget:null,displayComponents:[],componentList:null,highlightBorder:null,loadedPath:null,pageName:null,mouseoverRegistered:false,mouseoverActivated:false,constructor:function(b){window.onbeforeunload=function(){window.onbeforeunload=null;
return CQ.I18n.getMessage("Do you really want to leave the page? This could be an automatic redirect from the imported page, so please click cancel if you don't want this.")
};
for(var c=0;
c<b.displayComponents.length;
c++){this.displayComponents.push(new RegExp(b.displayComponents[c]))
}this.loadedPath=CQ.HTTP.getAnchor(document.location.href);
this.pageName=this.loadedPath.match("/etc/designs/(.*?)/")[1];
this.displayComponents.push(new RegExp(this.pageName+"/components"));
var a=document.createElement("iframe");
a.id="frame_cq-ce";
a.name="frame_cq-ce";
a.frameBorder="0";
a.border="0";
this.frame=new CQ.Ext.Element(a);
this.frame.addClass("cq-frame");
this.frame.setStyle("width","100%");
this.frame.setStyle("height","100%");
this.frame.on("load",this.onFrameLoad,this);
CQ.Ext.dd.Registry.register(this.frame.dom);
var g=this;
this.selectionInfo=new CQ.Ext.Toolbar.TextItem({text:CQ.I18n.getMessage("Nothing selected.")});
this.filter=new CQ.Ext.form.TriggerField({triggerClass:"x-form-clear-trigger",emptyText:CQ.I18n.getMessage("Enter selector to filter elements"),width:240,onTriggerClick:function(){this.reset()
}});
this.tree=new CQ.Ext.tree.TreePanel({title:CQ.I18n.getMessage("Document Tree"),width:320,region:"east",margins:"5 5 0 0",cmargins:"5 5 0 5",split:true,collapsible:true,collapsed:true,animate:true,border:true,autoScroll:true,containerScroll:true,root:new CQ.Ext.tree.TreeNode({name:"doc",text:CQ.I18n.getMessage("Document"),expanded:true})});
this.components=new CQ.Ext.Panel({title:CQ.I18n.getMessage("Components"),border:true,autoScroll:true,containerScroll:true,layout:"accordion",width:220,region:"west",margins:"5 0 0 5",cmargins:"5 5 0 5",split:true,collapsible:true,animate:true,tbar:[{iconCls:"cq-siteadmin-refresh",handler:g.loadComponents,scope:g}]});
this.mappings=new CQ.Ext.grid.EditorGridPanel({title:CQ.I18n.getMessage("Mappings"),border:true,autoScroll:true,containerScroll:true,height:220,region:"south",margins:"0 5 5 5",cmargins:"5 5 5 5",split:true,collapsible:true,collapsed:false,animate:true,viewConfig:new CQ.Ext.grid.GridView({forceFit:true}),store:new CQ.Ext.data.Store({}),cm:new CQ.Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:CQ.I18n.getMessage("Element"),dataIndex:"element",renderer:function(j){return g.getElementHint(j)
}},{header:CQ.I18n.getMessage("Component"),dataIndex:"component"},{header:CQ.I18n.getMessage("Path"),editor:new CQ.Ext.form.TextField({allowBlank:false}),dataIndex:"path"},{header:CQ.I18n.getMessage("Insert ID"),dataIndex:"insertID",hidden:true}]}),sm:new CQ.Ext.grid.RowSelectionModel({singleSelect:true,listeners:{selectionchange:function(k){var j=k.getSelected();
if(j){var m=j.get("element");
g.updateHighlight(g.highlightBorder,{"background-color":g.highlightSelectColor});
g.showHighlight(m,g.highlightBorder);
g.updateSelectionInfo(m);
g.updateTreeSelection(m);
g.setSelectedElement(m,true)
}}}}),tbar:[{text:CQ.I18n.getMessage("Generate"),handler:function(){var m="";
var n="";
var j=true;
var k=g.mappings.getStore();
k.each(function(o){var r=o.get("component");
var t=o.get("path");
var q=o.get("insertID");
if((t==null)||(t=="")){j=false;
return false
}else{n+=m+q+"="+r+","+t;
m=":"
}},this);
if(!j){CQ.Ext.Msg.show({title:"Missing Paths",msg:CQ.I18n.getMessage("Please provide paths for all component mappings."),width:400,buttons:CQ.Ext.MessageBox.OK,icon:CQ.Ext.MessageBox.ERROR})
}else{CQ.Ext.Msg.wait("Please wait page component is generated.","Generating page",{interval:120,increment:60,text:"Generating page..."});
CQ.Ext.Ajax.request({url:CQ.HTTP.externalize("/libs/wcm/bin/siteimporter/generate"),params:{resource:g.loadedPath,mappings:n,_charset_:"utf-8"},success:function(o,q){k.commitChanges();
CQ.Ext.Msg.hide()
},failure:function(o,q){CQ.Ext.Msg.hide();
CQ.Ext.Msg.show({title:"Error",msg:o.responseText,width:400,buttons:CQ.Ext.MessageBox.OK,icon:CQ.Ext.MessageBox.ERROR})
}})
}}},"-",{text:CQ.I18n.getMessage("Remove"),handler:function(){var n=g.mappings.getSelectionModel();
var m=n.getSelections();
var j=g.mappings.getStore();
for(var k=0;
k<m.length;
k++){j.remove(m[k])
}}},{text:CQ.I18n.getMessage("Remove All"),handler:function(){var j=g.mappings.getStore();
j.removeAll()
}}]});
this.openBtn=new CQ.Ext.Button({text:CQ.I18n.getMessage("Open"),handler:function(){var j=g.loadedPath.match(/\/dev\/(.*?)-original.html/)[1];
window.open("http://"+window.location.host+"/content/"+j+".html","win_"+j)
}});
this.selectBtn=new CQ.Ext.Button({text:CQ.I18n.getMessage("Select"),enableToggle:true,toggleHandler:function(k,m){var j=g.frame.dom.contentDocument.body;
if(m){g.hideFrame(g.highlightBorder);
g.updateHighlight(g.highlightBorder,{"background-color":g.highlightColor});
if(!g.mouseoverRegistered){g.registerMouseover([j]);
g.mouseoverRegistered=true
}g.mouseoverActivated=true
}else{g.mouseoverActivated=false
}}});
this.extractBtn=new CQ.Ext.Button({text:CQ.I18n.getMessage("Extract..."),handler:this.extractComponent,scope:this,disabled:true});
this.insertBtn=new CQ.Ext.Button({text:CQ.I18n.getMessage("Insert"),handler:this.insertComponent,scope:this,hidden:true,disabled:true});
this.restoreBtn=new CQ.Ext.Button({text:CQ.I18n.getMessage("Restore"),handler:this.restorePage,scope:this,hidden:true,disabled:false});
this.removeBtn=new CQ.Ext.Button({text:CQ.I18n.getMessage("Remove"),handler:this.removeComponent,hidden:true,scope:this,disabled:true});
CQ.wcm.ComponentExtractor.superclass.constructor.call(this,{id:"cq-ce",layout:"border",renderTo:CQ.Util.getRoot(),items:[{id:"cq-ce-wrapper",xtype:"panel",region:"center",layout:"border",items:[{id:"cq-header",xtype:"container",autoEl:"div",region:"north"},this.tree,this.components,this.mappings,{xtype:"panel",id:"cq-ce-framewrapper",region:"center",margins:"5 0 0 0",items:new CQ.Ext.BoxComponent({autoEl:{tag:"div"},style:{width:"100%",height:"100%"},listeners:{render:function(j){g.frame.appendTo(j.getEl())
}}}),tbar:[this.openBtn,this.selectBtn,this.removeBtn,this.extractBtn,this.restoreBtn],bbar:[this.selectionInfo,"->",this.filter],listeners:{render:function(j){if(g.loadedPath){g.loadResource(g.loadedPath)
}},resize:function(j,o,m,k,n){if(g.selectedElement){g.showHighlight(g.selectedElement,g.highlightBorder)
}}}}]}]})
},initComponent:function(){CQ.wcm.ComponentExtractor.superclass.initComponent.call(this);
new CQ.Ext.form.Hidden({id:CQ.Ext.History.fieldId,renderTo:CQ.Util.ROOT_ID});
var a=document.createElement("iframe");
a.id=CQ.Ext.History.iframeId;
a.src=CQ.Ext.SSL_SECURE_URL;
a.className="x-hidden";
a.frameBorder="0";
a.border="0";
new CQ.Ext.Element(a).appendTo(CQ.Util.getRoot());
CQ.Ext.History.init();
var b=this;
CQ.Ext.History.on("change",function(c){b.loadResource(c)
})
},onFrameLoad:function(){var b=this;
CQ.WCM.getTopWindow().CQ_ContentFinder={getContentWindow:function(){return b.frame.dom.contentWindow
}};
var a=CQ.Ext.get(this.frame.dom.contentDocument.documentElement).select("base",false);
if(a){a.remove()
}this.loadComponents();
this.highlightBorder=this.createHighlightBorder(this.highlightColor);
this.loadMappings();
this.loadTree([CQ.Ext.get(this.frame.dom.contentDocument.body)]);
this.setSelectedElement(null);
(function(){window.onbeforeunload=null
}).defer(2000)
},loadComponents:function(){var extractor=this;
if(this.componentList){this.componentList=null;
this.components.items.each(function(item){this.components.remove(item)
},this)
}var path="";
var url=CQ.HTTP.externalize("/libs/wcm/core/content/components.json");
url=CQ.HTTP.noCaching(url);
var res=CQ.HTTP.get(url);
var info=null;
if(CQ.HTTP.isOk(res)){info=CQ.Util.eval(res)
}else{info={}
}this.componentList=new CQ.wcm.ComponentList(path,info);
var all=this.componentList.getAllComponents();
for(var c in all){var comp=all[c];
var add=false;
if(!comp.virtual){for(var i=0;
i<extractor.displayComponents.length;
i++){if(extractor.displayComponents[i].test(comp.resourceType)){add=true;
break
}}}if(!add){delete all[c]
}}var compStores=new CQ.Ext.util.MixedCollection();
CQ.wcm.ComponentList.updateStores(compStores,all);
compStores.each(function(compStore,index,total){if(compStore.group==".hidden"){compStore.group=CQ.I18n.getMessage("Hidden")
}var panel=this.components.add(new CQ.Ext.Panel(CQ.Util.formatData({id:"cq-componenlist-"+compStore.group,title:compStore.group,cls:"cq-sidekick-buttons "+CQ.DOM.encodeClass(compStore.group,"cq-cmpts"),autoScroll:true,containerScroll:true,border:false,layout:"fit",items:extractor.createDataView(compStore)})))
},this);
this.components.doLayout()
},createHighlightBorder:function(c){var a=this.frame.dom.contentDocument.body;
var k=document.createElement("div");
var j=new CQ.Ext.Element(k);
j.appendTo(a);
j.hide();
j.applyStyles({"background-color":c,position:"absolute",height:this.highlightWidth+"px"});
var m=document.createElement("div");
bBottom=new CQ.Ext.Element(m);
bBottom.appendTo(a);
bBottom.hide();
bBottom.applyStyles({"background-color":c,position:"absolute",height:this.highlightWidth+"px"});
var b=document.createElement("div");
bLeft=new CQ.Ext.Element(b);
bLeft.appendTo(a);
bLeft.hide();
bLeft.applyStyles({"background-color":c,position:"absolute",width:this.highlightWidth+"px"});
var g=document.createElement("div");
bRight=new CQ.Ext.Element(g);
bRight.appendTo(a);
bRight.hide();
bRight.applyStyles({"background-color":c,position:"absolute",width:this.highlightWidth+"px"});
return{top:j,bottom:bBottom,left:bLeft,right:bRight}
},createDataView:function(a){return new CQ.Ext.DataView({tpl:CQ.wcm.ComponentList.TEMPLATE,autoHeight:true,autoWidth:true,border:false,singleSelect:true,multiSelect:false,overClass:"x-btn-over",selectedClass:"x-btn-selected",itemSelector:"table.x-btn",loadingText:CQ.I18n.getMessage("Loading components"),listeners:{render:function(b){b.dragZone=new CQ.wcm.ComponentExtractor.DragZone(b,{containerScroll:false});
b.dragZone.addToGroup(CQ.wcm.EditBase.DD_GROUP_COMPONENT);
b.dragZone.removeFromGroup(CQ.wcm.EditBase.DD_GROUP_DEFAULT)
}},store:a,prepareData:function(b){b.title=CQ.I18n.getVarMessage(b.title);
b.description=CQ.I18n.getVarMessage(b.description);
return b
}})
},loadMappings:function(){var mappingsPath=this.loadedPath.substr(0,this.loadedPath.lastIndexOf("/"))+"/mappings.infinity.json";
var doc=this.frame.dom.contentDocument;
var extractor=this;
CQ.Ext.Ajax.request({url:CQ.HTTP.externalize(mappingsPath),success:function(response,options){var store=extractor.mappings.getStore();
var mappings=CQ.Util.eval(response);
for(var m in mappings){var mapping=mappings[m];
if(mapping.component){var el=CQ.Ext.query("*[@componentInsertId='"+m+"']",doc.body);
if(el.length>0){el=CQ.Ext.get(el[0]);
var rID=extractor.getElementHint(el);
var record=new CQ.wcm.ComponentExtractor.ReplacementRecord({element:el,component:mapping.component,path:mapping.path,insertID:m},rID);
store.add([record])
}}}},failure:function(response,options){}})
},loadTree:function(b){var a=this.tree.getRootNode();
CQ.Ext.each(a.childNodes,function(j,c,g){j.remove()
});
this.loadTreeNodes(b,a);
a.expand(false)
},loadTreeNodes:function(o,m){for(var g=0;
g<o.length;
g++){var k=o[g];
var c=this.getElementHint(k);
var n=m.appendChild(new CQ.Ext.tree.TreeNode({name:c,text:c,leaf:k.dom.childNodes.length==0,singleClickExpand:true}));
n.on("click",function(q,j){this.updateHighlight(this.highlightBorder,{"background-color":this.highlightSelectColor});
this.showHighlight(q.relatedElement,this.highlightBorder);
this.updateSelectionInfo(q.relatedElement);
this.setSelectedElement(q.relatedElement)
},this);
n.relatedElement=k;
k.relatedTreeNode=n;
for(var b=0;
b<k.dom.childNodes.length;
b++){var a=CQ.Ext.get(k.dom.childNodes[b]);
if(a){this.loadTreeNodes([a],n)
}}}},registerMouseover:function(c){for(var a=0;
a<c.length;
a++){var b=CQ.Ext.get(c[a]);
b.on("mouseover",this.handleMouseover,this);
b.on("mouseout",this.handleMouseout,this);
b.on("click",this.handleClick,this)
}},unregisterMouseover:function(c){for(var a=0;
a<c.length;
a++){var b=CQ.Ext.get(c[a]);
b.un("mouseover",this.handleMouseover,this);
b.un("mouseout",this.handleMouseout,this);
b.un("click",this.handleClick,this)
}},handleMouseover:function(g,b,a){if(this.mouseoverActivated){var c=CQ.Ext.get(b);
if(this.isFiltered(c)){this.showHighlight(c,this.highlightBorder);
this.updateSelectionInfo(c);
this.updateTreeSelection(c)
}}},handleMouseout:function(g,b,a){if(this.mouseoverActivated){var c=CQ.Ext.get(b);
this.hideFrame(this.highlightBorder);
this.updateSelectionInfo()
}},isFiltered:function(b){var a=this.filter.getValue();
if(a&&(a!="")){return b.is(a)
}return true
},updateTreeSelection:function(a){if(a.relatedTreeNode){a.relatedTreeNode.ensureVisible();
a.relatedTreeNode.select()
}},updateSelectionInfo:function(a){var c;
if(a){var b=this.getElementHint(a);
c=CQ.I18n.getMessage("Selected Element")+": "+b
}else{c=CQ.I18n.getMessage("Nothing selected.")
}CQ.Ext.get(this.selectionInfo.el).update(c)
},updateHighlight:function(b,a){b.top.applyStyles(a);
b.bottom.applyStyles(a);
b.left.applyStyles(a);
b.right.applyStyles(a)
},showHighlight:function(b,k){var g=b.getBox();
var c=this.frame.dom.contentWindow;
var a=c.scrollY+this.topOffset;
var j=c.scrollX;
k.top.applyStyles({left:(g.x-this.highlightWidth+j)+"px",top:(g.y-this.highlightWidth+a)+"px",width:(g.width+(this.highlightWidth*2))+"px"});
k.top.show();
k.bottom.applyStyles({left:(g.x-this.highlightWidth+j)+"px",top:(g.y+g.height+a)+"px",width:(g.width+(this.highlightWidth*2))+"px"});
k.bottom.show();
k.left.applyStyles({left:(g.x-this.highlightWidth+j)+"px",top:(g.y-this.highlightWidth+a)+"px",height:(g.height+(this.highlightWidth*2))+"px"});
k.left.show();
k.right.applyStyles({left:(g.x+g.width+j)+"px",top:(g.y-this.highlightWidth+a)+"px",height:(g.height+(this.highlightWidth*2))+"px"});
k.right.show()
},getElementHint:function(b){var c=b.dom.nodeName;
if(b.dom.id&&(b.dom.id!="")){c+="#"+b.dom.id
}var a=b.dom.getAttribute("class");
if(a&&(a!="")){c+="."+a.replace(/ /g,".")
}return c
},hideFrame:function(a){a.top.hide();
a.bottom.hide();
a.left.hide();
a.right.hide()
},handleClick:function(c,b,a){if(this.mouseoverActivated){c.stopEvent();
this.setSelectedElement(CQ.Ext.get(b));
this.updateHighlight(this.highlightBorder,{"background-color":this.highlightSelectColor});
this.mouseoverActivated=false
}},setSelectedElement:function(j,a){if(this.dropTarget){this.dropTarget.destroy();
this.dropTarget=null
}this.dropRegion=null;
this.selectedElement=j;
if(this.selectedElement!=null){this.extractBtn.setDisabled(false);
this.removeBtn.setDisabled(false);
this.dropRegion=CQ.Ext.lib.Region.getRegion(j.dom);
this.dropTarget=new CQ.wcm.EditBase.DropTarget(this.selectedElement,{ddGroup:CQ.wcm.EditBase.DD_GROUP_COMPONENT});
if(!a){var g=this.mappings.getStore();
var c=this.mappings.getSelectionModel();
var k=this.getElementHint(this.selectedElement);
var b=g.getById(k);
if(b){c.selectRecords([b])
}else{c.clearSelections()
}}}else{this.removeBtn.setDisabled(true);
this.extractBtn.setDisabled(true)
}this.selectBtn.toggle(false)
},loadResource:function(a){if(a){this.frame.dom.src=CQ.HTTP.externalize(a+"?wcmmode=disabled")
}else{this.frame.dom.contentWindow.location.reload();
this.setSelectedElement(null)
}},restorePage:function(){var a=this;
CQ.HTTP.post("/libs/wcm/bin/siteimporter/editorigpage",function(){CQ.Notification.notify("page restored","");
window.location.reload()
},{path:a.loadedPath,operation:"restore"},null,true)
},insertComponent:function(){var j=this;
if(this.selectedElement){var a="new_"+new Date().getTime();
var b=this.selectedElement;
var c=this.selectedElement.insertSibling('<DIV componentInsertId="'+a+'">[place holder]</DIV>',"after");
this.loadTree([CQ.Ext.get(this.frame.dom.contentDocument.body)]);
j.setSelectedElement(c,true);
j.updateSelectionInfo(c);
j.updateTreeSelection(c);
j.updateHighlight(j.highlightBorder,{"background-color":j.highlightSelectColor});
j.showHighlight(c,j.highlightBorder);
var g=b.dom.getAttribute("componentInsertId");
CQ.HTTP.post("/libs/wcm/bin/siteimporter/editorigpage",function(){CQ.Notification.notify("inserted","page saved")
},{path:j.loadedPath,operation:"insert",content:"[place holder]",newid:a,id:g},null,true)
}},removeComponent:function(){var c=this;
if(this.selectedElement){var b=this.selectedElement;
var a=b.dom.getAttribute("componentInsertId");
this.loadTree([CQ.Ext.get(this.frame.dom.contentDocument.body)]);
b.remove();
this.hideFrame(this.highlightBorder);
CQ.HTTP.post("/libs/wcm/bin/siteimporter/editorigpage",function(){CQ.Notification.notify("removed","page saved")
},{path:c.loadedPath,operation:"remove",id:a},null,true)
}},extractComponent:function(){var c=this;
if(this.selectedElement){var a="/apps/"+this.pageName+"/components";
var b=CQ.WCM.getDialog({"jcr:primaryType":"cq:Dialog",id:CQ.Util.createId("cq-extract-component"),title:CQ.I18n.getMessage("Extract Component"),formUrl:CQ.HTTP.externalize("/libs/wcm/bin/siteimporter/extract"),params:{_charset_:"utf-8",resource:this.loadedPath,insertID:this.selectedElement.dom.getAttribute("componentInsertId")},height:400,modal:true,okText:CQ.I18n.getMessage("Create"),success:function(){c.loadComponents()
},items:{"jcr:primaryType":"cq:Panel",items:{"jcr:primaryType":"cq:WidgetCollection",path:{xtype:"pathfield",fieldLabel:CQ.I18n.getMessage("Path"),allowBlank:false,name:"path",predicate:"nosystem",rootPath:"/",showTitlesInTree:false,value:a},label:{fieldLabel:CQ.I18n.getMessage("Label"),allowBlank:false,name:"label"},overwrite:{fieldLabel:CQ.I18n.getMessage("Overwrite"),fieldDescription:CQ.I18n.getMessage("Force overwrite of existing component"),xtype:"selection",type:"checkbox",name:"overwrite"},title:{fieldLabel:CQ.I18n.getMessage("Title"),allowBlank:false,name:"title"},description:{xtype:"textarea",fieldLabel:CQ.I18n.getMessage("Description"),name:"description"},group:{fieldLabel:CQ.I18n.getMessage("Group"),name:"group"},supertype:{fieldLabel:CQ.I18n.getMessage("Supertype"),value:"foundation/components/parbase",name:"supertype"},allowedParents:{fieldLabel:CQ.I18n.getMessage("Allowed Parents"),name:"allowedParents",value:"*/parsys"}}}});
b.show()
}}});
CQ.Ext.reg("componentextractor",CQ.wcm.ComponentExtractor);
CQ.wcm.ComponentExtractor.ReplacementRecord=CQ.Ext.data.Record.create([{name:"element"},{name:"component"},{name:"path"},{name:"insertID"}]);
CQ.wcm.ComponentExtractor.maskFrame=function(){if(!CQ.wcm.ComponentExtractor.frameMask){CQ.wcm.ComponentExtractor.frameMask=CQ.Ext.get("cq-ce-framewrapper").mask()
}return CQ.wcm.ComponentExtractor.frameMask
};
CQ.wcm.ComponentExtractor.unmaskFrame=function(){if(CQ.wcm.ComponentExtractor.frameMask){CQ.wcm.ComponentExtractor.frameMask=null;
CQ.Ext.get("cq-ce-framewrapper").unmask()
}};
CQ.wcm.ComponentExtractor.DragZone=CQ.Ext.extend(CQ.wcm.Sidekick.DragZone4ContentFinder,{notifyDropDT:function(m,k,j){var g=CQ.Ext.getCmp("cq-ce");
var b=g.mappings.getStore();
var c=g.getElementHint(g.selectedElement);
var a=b.getById(c);
if(a){a.set("component",j.records[0].get("resourceType"));
a.commit()
}else{a=new CQ.wcm.ComponentExtractor.ReplacementRecord({element:g.selectedElement,component:j.records[0].get("resourceType"),path:"",insertID:g.selectedElement.dom.getAttribute("componentInsertId")},c);
b.add([a])
}return true
},notifyOverDT:function(c,b,a){return this.dropAllowed
},CF_cleanUpDD:function(){CQ.wcm.ComponentExtractor.unmaskFrame();
this.dropTargets=[];
this.dropTargetRegions=[];
this.dragging=false;
this.IDDM_dragCurrent=false
},CF_b4StartDrag:function(a,m){if(!CQ.WCM.isContentWindowLoading()){var j=CQ.WCM.getContentFinder();
if(!j){throw new Error("No finder defined")
}var k=CQ.Ext.getCmp("cq-ce-framewrapper");
j.contentWindowLeft=k.getEl().getX();
j.contentWindowTop=k.getEl().getY()+k.getTopToolbar().getEl().getHeight();
CQ.wcm.ComponentExtractor.maskFrame();
this.dropTargets=[];
this.dropTargetRegions=[];
var b=CQ.WCM.getContentWindow();
try{if(!b.CQ){return
}}catch(g){return
}var c=this;
window.setTimeout(function(){var n=CQ.Ext.getCmp("cq-ce");
var o=CQ.Ext.getCmp("cq-ce").selectedElement;
if(o){c.dropTargets.push(n.dropTarget);
c.dropTargetRegions.push(n.dropRegion)
}},1);
this.mouse={pos:[-1,-1],lastPos:[-1,-1],time:0}
}},CF_handleMouseMove:function(o){if(!CQ.WCM.isContentWindowLoading()){var b=CQ.WCM.getContentFinder();
if(!b){throw new Error("No finder defined")
}var g=CQ.Ext.dd.DDM.getScrollLeft();
var c=CQ.Ext.dd.DDM.getScrollTop();
var t=o.getPageX()-b.contentWindowLeft+g;
var q=o.getPageY()-b.contentWindowTop+c;
var j=this.dropTargetRegions;
for(var m=0;
m<j.length;
m++){var a=j[m];
var k=new CQ.Ext.lib.Region(a.top,a.right,a.bottom,a.left);
k.adjust(c,g,c,g);
if(k.contains(new CQ.Ext.lib.Point(t,q))){var n=this.dropTargets[m];
if(n==this.cachedTarget){this.onDragOver(o);
this.updateMouseInfo(t,q);
return
}else{if(this.cachedTarget){this.onDragOut(o)
}this.onDragEnter(o,n);
this.updateMouseInfo(t,q);
return
}}}if(this.cachedTarget){this.onDragOut(o)
}this.updateMouseInfo(t,q)
}}});
CQ.wcm.Annotation=CQ.Ext.extend(CQ.Ext.Window,{minimized:false,colorTimeout:0,toggleTimeout:0,resizeTimeout:0,ddTimeout:0,referencePoint:null,isUnsaved:false,currentUndoSnapshot:null,suppressUpdate:false,post:function(params,preventUndo,preventParamProcessing){if(!params){params={}
}var path=this.path;
if(this.isUnsaved&&(preventParamProcessing!==true)){params=CQ.Util.merge(params,this.getOffsetParams());
params=CQ.Util.merge(params,{"./jcr:lastModified":"","./jcr:lastModifiedBy":""})
}var isDeleted=false;
var deleteSnapshot;
if(params[CQ.Sling.OPERATION]==CQ.Sling.OPERATION_DELETE){isDeleted=true;
deleteSnapshot=this.createUndoSnapshot();
this.editComponent.removeAnnotation(this.id)
}var pResp=CQ.HTTP.post(path,null,params);
var isSuccess=CQ.HTTP.isOk(pResp);
if(isSuccess){var undoHistory,undoStep;
if(this.isUnsaved){this.path=pResp.headers[CQ.HTTP.HEADER_PATH];
this.isUnsaved=false;
if((preventUndo!==true)&&CQ.undo.UndoManager.isEnabled()){undoHistory=CQ.undo.UndoManager.getHistory();
undoStep=undoHistory.createUndoStep(undoHistory.createStepConfig());
this.currentUndoSnapshot=this.createUndoSnapshot();
undoStep.addUndoAction(new CQ.undo.actions.CreateAnnotationAction(this.editComponent,undoHistory.getIdManager(),this,this.currentUndoSnapshot));
undoStep.commit()
}}else{if(isDeleted){if((preventUndo!==true)&&CQ.undo.UndoManager.isEnabled()){undoHistory=CQ.undo.UndoManager.getHistory();
undoStep=undoHistory.createUndoStep(undoHistory.createStepConfig());
this.currentUndoSnapshot=null;
undoStep.addUndoAction(new CQ.undo.actions.RemoveAnnotationAction(this.editComponent,undoHistory.getIdManager(),this,deleteSnapshot));
for(var sketchName in this.sketches){var sketch=this.sketches[sketchName];
var sketchData=sketch.createUndoSnapshot();
undoStep.addUndoAction(new CQ.undo.actions.RemoveSketchAction(this.editComponent,undoHistory.getIdManager(),sketch,sketchData))
}undoStep.commit()
}}else{if((preventUndo!==true)&&CQ.undo.UndoManager.isEnabled()){var uu=CQ.undo.util.UndoUtils;
undoHistory=CQ.undo.UndoManager.getHistory();
var newSnapshot=this.createUndoSnapshot();
var diffObj=uu.diffObject(this.currentUndoSnapshot,newSnapshot);
if((diffObj.changeCnt>0)||(diffObj.addCnt>0)){this.currentUndoSnapshot=newSnapshot;
undoStep=undoHistory.createUndoStep(undoHistory.createStepConfig());
undoStep.addUndoAction(new CQ.undo.actions.UpdateAnnotationAction(this.editComponent,undoHistory.getIdManager(),this,diffObj));
undoStep.commit()
}}}}if(params["./jcr:lastModified"]!=undefined){var gResp=CQ.HTTP.eval(this.path+CQ.HTTP.EXTENSION_JSON);
this.modInfo.updateHtml(this.buildModInfo(gResp["jcr:lastModifiedBy"],gResp["jcr:lastModified"]))
}}return isSuccess
},getOffsetParams:function(){var a=this.editComponent.getInlinePlaceholder().getXY();
var b=this.hidden?this.mini.getPosition():this.getPosition();
this.offsetX=Math.round(b[0]-a[0]);
this.offsetY=Math.round(b[1]-a[1]);
return{"./x":this.offsetX,"./y":this.offsetY,"./x@TypeHint":"Long","./y@TypeHint":"Long"}
},align:function(){if(!this.hidden&&this.rendered){this.alignTo(this.editComponent.element,"tl",[this.offsetX,this.offsetY]);
for(var b in this.sketches){this.sketches[b].align()
}}if(!this.mini.hidden&&this.mini.rendered){var a=this.offsetX;
this.mini.alignTo(this.editComponent.element,"tl",[a,this.offsetY])
}},show:function(a){if(this.minimized){if(!this.mini.hidden){return
}this.mini.show()
}else{if(!this.hidden){return
}CQ.wcm.Annotation.superclass.show.call(this);
if(a){this.field.focus(false,200)
}for(var b in this.sketches){this.sketches[b].show()
}}this.align()
},hide:function(){if(this.minimized){if(this.mini.hidden){return
}this.mini.hide()
}else{if(this.hidden){return
}CQ.wcm.Annotation.superclass.hide.call(this)
}for(var a in this.sketches){this.sketches[a].hide()
}},destroy:function(){this.mini.destroy();
for(var a in this.sketches){this.sketches[a].destroy()
}CQ.wcm.Annotation.superclass.destroy.call(this)
},minimize:function(){this.toggle(true)
},toggle:function(c,a){if(this.minimized=c){this.mini.show();
CQ.wcm.Annotation.superclass.hide.call(this);
this.align();
for(var b in this.sketches){this.sketches[b].hide()
}}else{CQ.wcm.Annotation.superclass.show.call(this);
this.mini.hide();
this.align();
this.field.focus(false,200);
for(var b in this.sketches){this.sketches[b].show()
}}if(a!==true){window.clearTimeout(this.toggleTimeout);
this.toggleTimeout=window.setTimeout(this.post.createDelegate(this,[{"./minimized":this.minimized,"./minimized@TypeHint":"Boolean"}]),this.saveDelay)
}},rotateColor:function(){this.removeClass("cq-annotation-"+this.color);
this.mini.removeClass("cq-annotation-mini-"+this.color);
var b=this.colors.indexOf(this.color);
this.color=this.colors[b+1==this.colors.length?0:b+1];
this.addClass("cq-annotation-"+this.color);
this.mini.addClass("cq-annotation-mini-"+this.color);
for(var a in this.sketches){this.sketches[a].clearCanvas();
this.sketches[a].drawData()
}window.clearTimeout(this.colorTimeout);
this.colorTimeout=window.setTimeout(this.post.createDelegate(this,[{"./color":this.color}]),this.saveDelay)
},addSketch:function(c){if(this.isUnsaved){this.post()
}var a={annotation:this,path:this.path+"/sketches/",id:CQ.Util.createId()};
if(c){CQ.Ext.apply(a,c)
}var b=new CQ.wcm.Annotation.Sketch(a);
b.show();
return b
},getSketch:function(a){return this.sketches[a]
},getSketchAt:function(a){for(var b in this.sketches){if(this.sketches[b].path==a){return this.sketches[b]
}}return null
},removeSketch:function(a){this.sketches[a].destroy();
delete this.sketches[a]
},initTools:function(){if(!CQ.Ext.isOldIE&&this.sketchable){this.addTool({id:"sketch",handler:function(){this.addSketch()
}.createDelegate(this)})
}if(this.colors.length>1){this.addTool({id:"color",handler:this.rotateColor.createDelegate(this)})
}if(this.minimizable){this.addTool({id:"minimize",handler:this.minimize.createDelegate(this,[])})
}if(this.closable){this.addTool({id:"close",handler:this[this.closeAction].createDelegate(this,[])})
}},ghost:function(a){return CQ.wcm.Annotation.superclass.ghost.call(this,"cq-annotation cq-annotation-"+this.color)
},alignTo:function(b,a,c){return CQ.wcm.Annotation.alignTo(this,b,a,c)
},buildModInfo:function(a,c){var g="";
var n="";
try{var m=new Date(c);
var k=!c&&isNaN(m.getTime());
var b=new Date();
if(k||CQ.Date.isToday(m,b)){g=CQ.Date.TODAY
}else{if(CQ.Date.isYesterday(m,b)){g=CQ.Date.YESTERDAY
}else{if(CQ.Date.isThisWeek(m,b)){g=CQ.Date.THIS_WEEK
}else{if(CQ.Date.isLastWeek(m,b)){g=CQ.Date.LAST_WEEK
}else{if(CQ.Date.isThisMonth(m,b)){g=CQ.Date.THIS_MONTH
}else{if(CQ.Date.isThisYear(m,b)){g=m.format("F d")
}else{g=m.format("d-M-Y")
}}}}}}g=" ("+g+")";
n=' title="'+CQ.wcm.SiteAdmin.formatDate(m)+'"'
}catch(j){}return"<span"+n+">"+a+g+"</span>"
},constructor:function(g){var b=this;
this.field=new CQ.Ext.form.TextArea({name:"./annotation",xtype:"textarea",value:g.text?g.text:"",flex:1,listeners:{change:function(){b.post({"./text":this.getValue(),"./jcr:lastModified":"","./jcr:lastModifiedBy":"",_charset_:"utf-8"})
}}});
var c=g.lastModifiedBy?g.lastModifiedBy:CQ.User.getCurrentUser().getUserID();
this.modInfo=new CQ.Static({html:this.buildModInfo(c,g.lastModified)});
CQ.Util.applyDefaults(g,{cls:"cq-annotation",height:CQ.themes.wcm.Annotation.HEIGHT,width:CQ.themes.wcm.Annotation.WIDTH,minWidth:CQ.themes.wcm.Annotation.MINWIDTH,minHeight:CQ.themes.wcm.Annotation.MINHEIGHT,minimizable:true,minimized:false,sketchable:CQ.themes.wcm.Annotation.SKETCHABLE,shadow:"frame",resizeHandles:"se",color:CQ.themes.wcm.Annotation.COLOR,colors:CQ.themes.wcm.Annotation.COLORS,saveDelay:CQ.themes.wcm.Annotation.SAVE_DELAY,exitSketchDelay:CQ.themes.wcm.Annotation.EXIT_SKETCH_DELAY,layout:{type:"vbox",align:"stretch"},listeners:{resize:function(j,a,k){if((a==this.width&&k==this.height)||this.suppressUpdate){return
}window.clearTimeout(b.resizeTimeout);
this.width=(a!=undefined?a:this.width);
this.height=(k!=undefined?k:this.height);
b.resizeTimeout=window.setTimeout(b.post.createDelegate(b,[{"./w":Math.round(a),"./h":Math.round(k),"./w@TypeHint":"Long","./h@TypeHint":"Long"}]),this.saveDelay)
},beforeclose:function(){if(this.isUnsaved){this.editComponent.removeAnnotation(this.id);
return false
}var a=CQ.I18n.getMessage("Do you really want to delete the selected annotation and the associated sketches?");
CQ.Ext.Msg.confirm(CQ.I18n.getMessage("Delete Annotation"),a,function(k){if(k=="yes"){var j={};
j[CQ.Sling.OPERATION]=CQ.Sling.OPERATION_DELETE;
this.post(j)
}},this);
return false
},render:function(){this.setActive()
}},items:[this.field,this.modInfo]});
CQ.wcm.Annotation.superclass.constructor.call(this,g)
},initComponent:function(){CQ.wcm.Annotation.superclass.initComponent.call(this);
this.isUnsaved=this.path.charAt(this.path.length-1)=="/";
this.mini=new CQ.wcm.Annotation.Mini({annotation:this});
this.addClass("cq-annotation-"+this.color);
this.mini.addClass("cq-annotation-mini-"+this.color);
var b=this;
this.on("render",function(){b.el.disableShadow=function(){};
b.el.enableShadow()
});
var j={};
if(!CQ.Ext.isOldIE){for(var g in this.sketches){if(g=="jcr:primaryType"){continue
}var k=CQ.Util.createId();
var c={name:g,id:k,path:this.path+"/sketches/"+g,annotation:this,data:this.sketches[g].data,offsetX:this.sketches[g].x,offsetY:this.sketches[g].y,width:this.sketches[g].w,height:this.sketches[g].h,hidden:this.minimized};
j[k]=new CQ.wcm.Annotation.Sketch(c)
}}this.sketches=j;
this.currentUndoSnapshot=this.createUndoSnapshot()
},initDraggable:function(){this.dd=new CQ.wcm.Annotation.DD(this)
},createUndoSnapshot:function(){var a={};
var b=function(c,g,j){if(!g){g=c
}if(!CQ.undo.util.UndoUtils.strStartsWith(c,"jcr:")){c="./"+c
}a[c]=(j?this[g].getValue():this[g])
}.createDelegate(this);
b("text","field",true);
b("x","offsetX");
b("y","offsetY");
b("w","width");
b("h","height");
b("minimized");
b("color");
return a
},setText:function(a){this.field.setValue(a)
},setOffset:function(b,a){if(b!=null){this.offsetX=b
}if(a!=null){this.offsetY=a
}this.align()
},setWidth:function(b,a){this.suppressUpdate=a;
CQ.wcm.Annotation.superclass.setWidth.call(this,b);
this.suppressUpdate=false
},setHeight:function(b,a){this.suppressUpdate=a;
CQ.wcm.Annotation.superclass.setHeight.call(this,b);
this.suppressUpdate=false
},setColor:function(a){if(a!=this.color){this.removeClass("cq-annotation-"+this.color);
this.mini.removeClass("cq-annotation-mini-"+this.color);
this.addClass("cq-annotation-"+a);
this.mini.addClass("cq-annotation-mini-"+a);
this.color=a;
for(var b in this.sketches){this.sketches[b].clearCanvas();
this.sketches[b].drawData()
}}},setMinimized:function(a){if(this.minimized!=a){this.toggle(a,true)
}}});
CQ.Ext.reg("annotation",CQ.wcm.Annotation);
CQ.wcm.Annotation.alignTo=function(b,c,a,g){var j=b.el.getAlignToXY(c,a,g);
if(j[1]<0){j[1]=3
}b.setPosition(j[0],j[1]);
return this
};
CQ.wcm.Annotation.selectedSketch=null;
CQ.wcm.Annotation.removeSelectedSketch=function(){if(CQ.wcm.Annotation.selectedSketch){if(CQ.wcm.Annotation.selectedSketch.isDragging){return
}window.clearTimeout(CQ.wcm.Annotation.selectedSketch.ddTimeout);
var a={};
a[CQ.Sling.OPERATION]=CQ.Sling.OPERATION_DELETE;
CQ.wcm.Annotation.selectedSketch.post(a)
}};
CQ.wcm.Annotation.Mini=CQ.Ext.extend(CQ.Ext.Window,{post:function(){var a=this.win.getOffsetParams();
this.annotation.post(a);
window.clearTimeout(this.annotation.ddTimeout);
this.win.ddTimeout=window.setTimeout(this.win.post.createDelegate(this.win,[a]),this.win.saveDelay)
},minimize:function(){this.annotation.toggle(false)
},ghost:function(a){return CQ.wcm.Annotation.superclass.ghost.call(this,"cq-annotation-mini cq-annotation-mini-"+this.annotation.color)
},alignTo:function(b,a,c){return CQ.wcm.Annotation.alignTo(this,b,a,c)
},constructor:function(a){CQ.Util.applyDefaults(a,{cls:"cq-annotation-mini",closable:false,shadow:false,resizable:false,minimizable:true});
CQ.wcm.Annotation.Mini.superclass.constructor.call(this,a)
},initDraggable:function(){this.dd=new CQ.wcm.Annotation.Mini.DD(this)
}});
CQ.wcm.Annotation.Sketch=CQ.Ext.extend(CQ.Ext.Window,{exitTimeout:0,ddTimeout:0,minWidth:16,currentUndoSnapshot:null,constructor:function(b){var a=b.width?b.width+2:CQ.Ext.lib.Dom.getViewWidth()-20;
var c=b.height?b.height+2:CQ.Ext.lib.Dom.getViewHeight();
this.minY=c;
this.maxY=0;
this.minX=a;
this.maxX=0;
this.scrollProp=CQ.Ext.isWebKit?document.body:document.documentElement;
b=CQ.Util.applyDefaults(b,{renderTo:CQ.Util.ROOT_ID,cls:"cq-annotation-sketch",resizable:false,shadow:false,width:a,height:c,x:this.scrollProp.scrollLeft,y:this.scrollProp.scrollTop,lineWidth:CQ.themes.wcm.Annotation.LINE_WIDTH,items:[new CQ.Static({html:'<canvas width="'+a+'" height="'+c+'"></canvas>'}),this.tlAngle=new CQ.Static({cls:"cq-annotation-angle-tl",text:""}),this.trAngle=new CQ.Static({cls:"cq-annotation-angle-tr",text:""}),this.blAngle=new CQ.Static({cls:"cq-annotation-angle-bl",text:""}),this.brAngle=new CQ.Static({cls:"cq-annotation-angle-br",text:""})],listeners:{afterrender:this.initCanvas}});
CQ.wcm.Annotation.Sketch.superclass.constructor.call(this,b);
this.currentUndoSnapshot=this.createUndoSnapshot()
},initActivation:function(){this.on("activate",function(){this.addClass("cq-annotation-active");
CQ.wcm.Annotation.selectedSketch=this
});
this.on("deactivate",function(){this.removeClass("cq-annotation-active");
CQ.wcm.Annotation.selectedSketch=null
})
},initCanvas:function(){this.canvas=this.body.dom.getElementsByTagName("canvas")[0];
this.context=this.canvas.getContext("2d");
if(this.data){this.drawData();
this.initActivation();
this.canvas.setAttribute("class","cq-cursor-move")
}else{this.coords=[];
this.canvas.setAttribute("class","cq-cursor-crosshair");
this.mousedownHandler=this.start.createDelegate(this);
this.mousemoveHandler=this.draw.createDelegate(this);
this.mouseupHandler=this.stop.createDelegate(this);
this.doubleclickHandler=this.stopDoubleclick.createDelegate(this);
this.canvas.addEventListener("mousedown",this.mousedownHandler,true);
this.canvas.addEventListener("mousemove",this.mousemoveHandler,true);
this.canvas.addEventListener("mouseup",this.mouseupHandler,true);
this.canvas.addEventListener("dblclick",this.doubleclickHandler,true)
}},align:function(){if(this.rendered){this.alignTo(this.annotation.editComponent.element,"tl",[this.offsetX,this.offsetY])
}},show:function(){if(this.hidden){CQ.wcm.Annotation.Sketch.superclass.show.call(this)
}},post:function(k,o,v){if(!k){k={}
}var n=this.path.charAt(this.path.length-1)=="/";
var u=this.path;
if(!n){u+=CQ.HTTP.EXTENSION_HTML
}var q=false;
var c;
if(k[CQ.Sling.OPERATION]==CQ.Sling.OPERATION_DELETE){c=this.createUndoSnapshot();
this.annotation.removeSketch(this.id);
q=true
}else{if(v!==true){k=CQ.Util.merge(k,this.getOffsetParams())
}}var t=CQ.HTTP.post(u,null,k);
var a=CQ.HTTP.isOk(t);
if(a){var j,b;
if(n){this.path=t.headers[CQ.HTTP.HEADER_PATH];
this.annotation.sketches[this.id]=this;
if((o!==true)&&CQ.undo.UndoManager.isEnabled()){j=CQ.undo.UndoManager.getHistory();
b=j.createUndoStep(j.createStepConfig());
this.currentUndoSnapshot=this.createUndoSnapshot();
b.addUndoAction(new CQ.undo.actions.CreateSketchAction(this.annotation.editComponent,j.getIdManager(),this,this.currentUndoSnapshot));
b.commit()
}}else{if(q){if((o!==true)&&CQ.undo.UndoManager.isEnabled()){j=CQ.undo.UndoManager.getHistory();
b=j.createUndoStep(j.createStepConfig());
this.currentUndoSnapshot=null;
b.addUndoAction(new CQ.undo.actions.RemoveSketchAction(this.annotation.editComponent,j.getIdManager(),this,c));
b.commit()
}}else{if((o!==true)&&CQ.undo.UndoManager.isEnabled()){var g=CQ.undo.util.UndoUtils;
j=CQ.undo.UndoManager.getHistory();
var r=this.createUndoSnapshot();
var m=g.diffObject(this.currentUndoSnapshot,r);
if((m.changeCnt>0)||(m.addCnt>0)){this.currentUndoSnapshot=r;
b=j.createUndoStep(j.createStepConfig());
b.addUndoAction(new CQ.undo.actions.UpdateSketchAction(this.annotation.editComponent,j.getIdManager(),this,m));
b.commit()
}}}}}return a
},getOffsetParams:function(){var a=this.annotation.editComponent.getInlinePlaceholder().getXY();
var b=this.getPosition();
this.offsetX=Math.round(b[0]-a[0]);
this.offsetY=Math.round(b[1]-a[1]);
return{"./x":this.offsetX,"./y":this.offsetY,"./x@TypeHint":"Long","./y@TypeHint":"Long"}
},getMouseXY:function(b){var a;
if(CQ.Ext.isIE){a=[b.offsetX,b.offsetY]
}else{if(b.layerX!=undefined){a=[b.layerX,b.layerY]
}else{if(b.offsetX!=undefined){a=[b.offsetX,b.offsetY]
}}}if(a[0]<this.minX){this.minX=a[0]
}if(a[0]>this.maxX){this.maxX=a[0]
}if(a[1]<this.minY){this.minY=a[1]
}if(a[1]>this.maxY){this.maxY=a[1]
}this.coords.push(a[0]+this.scrollProp.scrollLeft,a[1]+this.scrollProp.scrollTop);
return a
},start:function(c,b,a){a=a||this.context;
window.clearTimeout(this.exitTimeout);
if(c){c.stopPropagation()
}if(this.doDraw){return
}if(!b){b=this.getMouseXY(c)
}this.doDraw=true;
a.strokeStyle=CQ.themes.wcm.Annotation.STROKE_STYLES[this.annotation.color];
a.lineWidth=this.lineWidth;
this.formerXY=b
},stopDoubleclick:function(b){var a=this.getMouseXY(b);
this.stop(null,a)
},stop:function(c,b){if(!b){b=this.getMouseXY(c)
}this.context.beginPath();
this.context.moveTo(this.formerXY[0],this.formerXY[1]);
this.context.lineTo(b[0],b[1]);
this.context.stroke();
this.context.closePath();
if(c){c.stopPropagation();
if(c.altKey){this.formerXY=b;
return
}}this.doDraw=false;
this.canvas.setAttribute("class","");
this.canvas.removeEventListener("mousedown",this.mousedownHandler,true);
this.canvas.removeEventListener("mousemove",this.mousemoveHandler,true);
this.canvas.removeEventListener("mouseup",this.mouseupHandler,true);
this.canvas.removeEventListener("dblclick",this.doubleclickHandler,true);
this.crop();
this.initActivation();
this.setActive();
this.canvas.setAttribute("class","cq-cursor-move");
var a=new CQ.wcm.Annotation.Sketch({annotation:this.annotation,path:this.annotation.path+"/sketches/",id:CQ.Util.createId()});
a.show();
a.exitTimeout=window.setTimeout(a.destroy.createDelegate(a),this.annotation.exitSketchDelay);
this.post({"./data":this.coords.join(","),"./w":this.canvas.getAttribute("width"),"./h":this.canvas.getAttribute("height"),"./w@TypeHint":"Long","./h@TypeHint":"Long"})
},draw:function(c,b,a){a=a||this.context;
if(c){c.stopPropagation();
if(c.altKey){return
}}if(this.doDraw||b){if(!b){b=this.getMouseXY(c)
}a.beginPath();
a.moveTo(this.formerXY[0],this.formerXY[1]);
a.lineTo(b[0],b[1]);
a.stroke();
a.closePath();
this.formerXY=b
}},drawData:function(c,b){if(!c){c=this.data.split(",")
}this.start(null,[c[0],c[1]],b);
for(var a=2;
a<c.length;
a=a+2){this.draw(null,[c[a],c[a+1]],b)
}this.doDraw=false
},clearCanvas:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)
},crop:function(){var g=Math.ceil(this.context.lineWidth/2);
var a=this.maxX-this.minX+2*g;
var c=this.maxY-this.minY+2*g;
if(a<this.minWidth){a=this.minWidth
}if(c<this.minWidth){c=this.minWidth
}this.clearCanvas();
this.canvas.setAttribute("width",a);
this.canvas.setAttribute("height",c);
this.setPosition(this.minX-g+this.scrollProp.scrollLeft,this.minY-g+this.scrollProp.scrollTop);
this.setWidth(a);
this.setHeight(c);
var j=this.getPosition();
for(var b=0;
b<this.coords.length;
b=b+2){this.coords[b]=this.coords[b]-j[0];
this.coords[b+1]=this.coords[b+1]-j[1]
}this.drawData(this.coords);
this.data=this.coords.join(",")
},onEsc:function(a,b){b.stopEvent();
if(this.coords.length==0){window.clearTimeout(this.exitTimeout);
this.destroy()
}},initDraggable:function(){this.dd=new CQ.wcm.Annotation.Sketch.DD(this)
},createGhost:function(){var c=document.createElement("div");
c.className="x-panel-ghost cq-annotation-sketch";
var a=this.canvas.cloneNode(true);
var b=a.getContext("2d");
this.drawData(null,b);
c.appendChild(a);
c.appendChild(this.tlAngle.el.dom.cloneNode(true));
c.appendChild(this.trAngle.el.dom.cloneNode(true));
c.appendChild(this.blAngle.el.dom.cloneNode(true));
c.appendChild(this.brAngle.el.dom.cloneNode(true));
c.style.width=this.el.dom.offsetWidth+"px";
c.style.height=this.bwrap.getHeight()+"px";
this.container.dom.appendChild(c);
return new CQ.Ext.Element(c)
},setOffset:function(b,a){if(b!=null){this.offsetX=b
}if(a!=null){this.offsetY=a
}this.align()
},createUndoSnapshot:function(){return{"./data":(this.coords?this.coords.join(","):this.data),"./w":parseInt(this.canvas.getAttribute("width")),"./h":parseInt(this.canvas.getAttribute("height")),"./x":this.offsetX,"./y":this.offsetY}
}});
CQ.wcm.Annotation.DD=function(a){CQ.wcm.Annotation.DD.superclass.constructor.call(this,a)
};
CQ.Ext.extend(CQ.wcm.Annotation.DD,CQ.Ext.Window.DD,{endDrag:function(a){this.win.unghost();
var b=this.win.getOffsetParams();
window.clearTimeout(this.win.ddTimeout);
this.win.ddTimeout=window.setTimeout(this.win.post.createDelegate(this.win,[b]),this.win.saveDelay)
}});
CQ.wcm.Annotation.Mini.DD=function(a){CQ.wcm.Annotation.Mini.DD.superclass.constructor.call(this,a)
};
CQ.Ext.extend(CQ.wcm.Annotation.Mini.DD,CQ.Ext.Window.DD,{endDrag:function(a){this.win.unghost();
var b=this.win.annotation.getOffsetParams();
window.clearTimeout(this.win.annotation.ddTimeout);
this.win.annotation.ddTimeout=window.setTimeout(this.win.annotation.post.createDelegate(this.win.annotation,[b]),this.win.annotation.saveDelay)
}});
CQ.wcm.Annotation.Sketch.DD=function(a){this.win=a;
CQ.Ext.Window.DD.superclass.constructor.call(this,a.el.id,"WindowDD-"+a.id);
this.setHandleElId(a.body.id);
this.scroll=false
};
CQ.Ext.extend(CQ.wcm.Annotation.Sketch.DD,CQ.Ext.Window.DD,{startDrag:function(a){this.win.isDragging=true;
CQ.wcm.Annotation.Sketch.DD.superclass.startDrag.call(this,a)
},endDrag:function(a){this.win.unghost();
this.win.isDragging=false;
var b=this.win.getOffsetParams();
window.clearTimeout(this.win.ddTimeout);
this.win.ddTimeout=window.setTimeout(this.win.post.createDelegate(this.win,[b]),this.win.annotation.saveDelay)
}});
CQ.wcm.FlashComponent=CQ.Ext.extend(CQ.Ext.Component,{flashId:null,dropTargets:[],constructor:function(c){var b=this;
this.flashId=c.id;
var g=document.getElementById(c.id);
var a=new CQ.wcm.FlashDropTarget(g,{flashId:c.id});
a.addToGroup(CQ.wcm.EditBase.DD_GROUP_ASSET);
a.addToGroup(CQ.wcm.EditBase.DD_GROUP_COMPONENT);
a.editComponent=this;
this.dropTargets=[a];
CQ.WCM.getTopWindow().CQ.WCM.on("wcmmodechange",this.onWCMModeChange,this);
CQ.wcm.FlashComponent.superclass.constructor.call(this,c)
},isVisible:function(){return true
},onWCMModeChange:function(b){var a=this.getFlashMovie();
if(a&&a.extSetWCMMode){a.extSetWCMMode(b)
}},getDropTargets:function(){var a=this.getFlashMovie();
if(a&&a.extDDEnter){return this.dropTargets
}else{return[]
}},isDropAllowedForObject:function(a){return true
},isInsertAllowed:function(a){return true
},getFlashMovie:function(){var a=CQ.WCM.getContentWindow();
if(!a){return null
}var b=navigator.appName.indexOf("Microsoft")!=-1;
return(b)?a[this.flashId]:a.document[this.flashId]
},openDialog:function(c,g){var b=this;
var a=CQ.WCM.getComponentConfig(g);
var j=CQ.WCM.getDialogConfig(a.dialog);
j.success=function(m,n){b.getFlashMovie().extReloadComponent(c)
};
j=CQ.Util.applyDefaults(j,{title:CQ.I18n.getMessage("Edit Component"),params:{"./jcr:lastModified":"","./jcr:lastModifiedBy":""}});
var k=CQ.WCM.getDialog(j);
k.loadContent(c);
k.show()
},deleteComponent:function(b){var a=this;
CQ.Ext.Msg.confirm(CQ.I18n.getMessage("Delete Component(s)"),CQ.I18n.getMessage("Do you really want to delete the selected component(s)?"),function(j){if(j=="yes"){var g={};
g[CQ.Sling.STATUS]=CQ.Sling.STATUS_BROWSER;
g[CQ.Sling.OPERATION]=CQ.Sling.OPERATION_DELETE;
response=CQ.shared.HTTP.post(b,null,g);
if(CQ.utils.HTTP.isOk(response)){var c=b.lastIndexOf("/");
a.getFlashMovie().extReloadComponent(b.substring(0,c))
}}},this)
},openPageCreateDialog:function(b){var a=this;
var c=CQ.wcm.Page.getCreatePageDialog(b);
c.success=function(j,g){a.getFlashMovie().extReload()
};
c.failure=function(){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not create page."))
};
c.show()
},openPageDeleteDialog:function(g){var b=this;
var c=g.substring(g.lastIndexOf("/")+1);
var a=CQ.WCM.getSidekick();
CQ.Ext.Msg.confirm(a.deleteText,CQ.I18n.getMessage("Do you really want to delete '{0}'?",c),function(j){if(j=="yes"){b.internalDelete(false,g)
}},this)
},internalDelete:function(b,c){var a=this;
var j=function(n,o,m){var k=m.headers[CQ.utils.HTTP.HEADER_STATUS];
if(k==200){a.getFlashMovie().extReload()
}else{if(k==412){CQ.Ext.Msg.show({title:CQ.I18n.getMessage("Delete Page"),msg:"This page is referenced. Click 'yes' to proceed deleting the page, click 'no' to review the references or 'cancel' to cancel the operation.",buttons:CQ.Ext.Msg.YESNOCANCEL,icon:CQ.Ext.MessageBox.QUESTION,fn:function(q){if(q=="yes"){this.internalDelete(true,c)
}else{if(q=="no"){this.showReferences()
}}},scope:this})
}else{CQ.Notification.notifyFromResponse(m)
}}};
var g={path:c,_charset_:"utf-8",cmd:"deletePage",force:b};
CQ.shared.HTTP.post("/bin/wcmcommand",j,g,this)
}});
CQ.wcm.FlashComponent.register=function(b){var a=new CQ.wcm.FlashComponent(b);
CQ.WCM.registerDropTargetComponent(a);
if(!CQ.wcm.FlashComponent.components){CQ.wcm.FlashComponent.components={}
}CQ.wcm.FlashComponent.components[a.flashId]=a;
return a
};
CQ.wcm.FlashComponent.getComponent=function(a){return CQ.wcm.FlashComponent.components[a]
};
CQ.wcm.FlashComponent.openDialog=function(c,a,b){CQ.wcm.FlashComponent.components[c].openDialog(a,b)
};
CQ.wcm.FlashComponent.openPageCreateDialog=function(b,a){CQ.wcm.FlashComponent.components[b].openPageCreateDialog(a)
};
CQ.wcm.FlashComponent.openPageDeleteDialog=function(b,a){CQ.wcm.FlashComponent.components[b].openPageDeleteDialog(a)
};
CQ.wcm.FlashComponent.deleteComponent=function(b,a){CQ.wcm.FlashComponent.components[b].deleteComponent(a)
};
CQ.wcm.FlashDropTarget=CQ.Ext.extend(CQ.Ext.dd.DropTarget,{constructor:function(b,a){a=a||{};
CQ.wcm.FlashDropTarget.superclass.constructor.call(this,b,a)
},getRelativeXY:function(g){var c=CQ.WCM.getTopWindow().CQ.Ext.getDom(CQ.wcm.ContentFinder.FRAME_ID);
var j=c?CQ.WCM.getTopWindow().CQ.Ext.lib.Dom.getXY(c):[0,0];
var m=CQ.Ext.lib.Dom.getXY(this.flashId);
var b=CQ.Ext.dd.DDM.getScroll();
var a=g.xy[0]-m[0]+b.left-j[0];
var k=g.xy[1]-m[1]+b.top-j[1];
return[a,k]
},getFlashMovie:function(){var a=navigator.appName.indexOf("Microsoft")!=-1;
return(a)?window[this.flashId]:document[this.flashId]
},serializeData:function(c){var b=[];
for(var a=0;
a<c.records.length;
a++){b[a]=c.records[a].data
}return b
},notifyDrop:function(a,c,b){var g=this.getRelativeXY(c);
return this.getFlashMovie().extDDDrop(g[0],g[1],this.serializeData(b))
},notifyEnter:function(a,c,b){var g=this.getRelativeXY(c);
return this.getFlashMovie().extDDEnter(g[0],g[1],this.serializeData(b))
},notifyOut:function(a,c,b){var g=this.getRelativeXY(c);
return this.getFlashMovie().extDDOut(g[0],g[1],this.serializeData(b))
},notifyOver:function(a,c,b){var g=this.getRelativeXY(c);
return this.getFlashMovie().extDDOver(g[0],g[1],this.serializeData(b))
},showHighlight:function(){},hideHighlight:function(){},flash:function(){},normalize:function(){this.el.stopFx();
this.el.fxQueue=[]
}});
CQ.wcm.LicenseBox=CQ.Ext.extend(CQ.Dialog,{licensePanel:null,licenseMap:null,gridStore:null,assetviewer_download_renditions:null,contentPanel:null,licenseAgreementRadioGroup:null,dataView:null,licensable:false,selector:"lightbox",assetPaths:null,constructor:function(config){this.assetPaths=[];
var agreeLicenseRadio=CQ.Ext.getCmp("agree-license-radio-btn");
if(agreeLicenseRadio!=undefined){agreeLicenseRadio.destroy()
}var licenseBox=this;
this.licenseMap=new Object();
var renditionsStore=new Object();
renditionsStore.renditions=new Array();
try{var items=config;
for(var i=0;
i<items.length;
i++){var damPath=items[i].data.damPath;
if(damPath.indexOf("/jcr:content/renditions")==-1){var url=damPath+".4.json";
url=CQ.HTTP.noCaching(url);
var info=CQ.HTTP.eval(url);
var metadata=info["jcr:content"]["metadata"];
if(metadata.hasOwnProperty("xmpRights:WebStatement")&&this.assetPaths.indexOf(damPath)==-1){var tmp=new Object();
tmp.damPath=damPath;
this.assetPaths.push(damPath);
tmp.name=tmp.damPath.substring(tmp.damPath.lastIndexOf("/")+1);
tmp.path=items[i].data.path;
tmp.licensePath=metadata["xmpRights:WebStatement"];
if(tmp.licensePath.lastIndexOf(".html")>0){tmp.licensePath=tmp.licensePath.substring(0,tmp.licensePath.lastIndexOf(".html")+1)+this.selector+".html"
}renditionsStore.renditions.push(tmp);
this.licensable=true
}}}}catch(e){}var fields=[{name:"name",mapping:"name"},{name:"damPath",mapping:"damPath"},{name:"path",mapping:"path"},{name:"licensePath",mapping:"licensePath"}];
var paths=[];
var tpl=new CQ.Ext.XTemplate('<table><tbody><tr><td class="padding-cell top" colspan="2"><div /></td></tr><tpl for="."><tr><td colspan="2" class="line"></td></tr><tr class="rendition-item"><td class="thumbnail-cell"><div style="background-image:url(\'{[CQ.HTTP.externalize(CQ.HTTP.encodePath(values.damPath),true)]}.thumb.48.48.png\');" /></div></td><td class="title-cell"><div>{[CQ.shared.XSS.getXSSValue(values.name)]}</div></td></tr></tpl><tr><td class="padding-cell bottom" colspan="2"></td></tr></tbody></table>');
var gridStore=new CQ.Ext.data.JsonStore({fields:fields,data:renditionsStore,root:"renditions"});
this.gridStore=gridStore;
var dataView=new CQ.Ext.DataView({id:"assetviewer_download_dataview",store:gridStore,cls:"asset_licenselist",layout:"fit",loadingText:CQ.I18n.getMessage("Loading content..."),singleSelect:true,overClass:"x-view-over",emptyText:CQ.I18n.getMessage("No content items to display"),tpl:tpl,itemSelector:".rendition-item",listeners:{selectionchange:function(dv){var licensePanel=CQ.Ext.getCmp("licensePanel");
var selectedRecord=dv.getSelectedRecords()[0];
var url=selectedRecord.data.licensePath;
var damPath=selectedRecord.data.damPath;
if(licenseBox.licenseMap[damPath]!=null){CQ.Ext.getCmp("agree-license-radio-btn").items.items[0].setValue(true)
}else{CQ.Ext.getCmp("agree-license-radio-btn").items.items[1].setValue(true)
}CQ.Ext.getCmp("licensePanel").update("");
CQ.Ext.Ajax.request({url:url,method:"GET",params:{":asset":damPath},success:function(response,opts){CQ.Ext.getCmp("licensePanel").update(response.responseText)
},failure:function(response,opts){console.log("server-side failure with status code "+response.status)
}})
}}});
this.dataView=dataView;
var assetviewer_download_renditions;
var config={xtype:"panel",region:"west",title:CQ.I18n.getMessage("Download Asset List"),collapsible:true,id:"licensebox-download-assetlist",width:"275",split:true,bodyCssClass:"dam-licensebox-body",items:[this.dataView]};
assetviewer_download_renditions=CQ.Util.build(config);
this.assetviewer_download_renditions=assetviewer_download_renditions;
var licensePanel=new CQ.Ext.Panel({header:false,id:"licensePanel",layout:"fit",fitToFrame:true,autoScroll:true,height:400,margins:"0 0 20 0",region:"center",frame:true,autoLoad:{url:""}});
this.licensePanel=licensePanel;
var licenseAgreementRadioGroup=new CQ.Ext.form.RadioGroup({fieldLabel:"Size",id:"agree-license-radio-btn",defaults:{flex:1},columns:1,frame:true,vertical:true,licenseMap:this.licenseMap,items:[{boxLabel:CQ.I18n.getMessage("   I agree to the license"),name:"license",inputValue:"m",listeners:{check:function(ct1,val){if(val==true){var selectedRecord=CQ.Ext.getCmp("assetviewer_download_dataview").getSelectedRecords();
var damPath=selectedRecord[0].data.damPath;
licenseBox.licenseMap[damPath]=true;
var items=CQ.Ext.getCmp("assetviewer_download_dataview").store.data.items;
console.log(licenseBox.getCancelConfig());
var size=0;
for(key in licenseBox.licenseMap){size++
}if(size==items.length){licenseBox.buttons[0].setDisabled(false)
}}else{licenseBox.buttons[0].setDisabled(true);
var selectedRecord=CQ.Ext.getCmp("assetviewer_download_dataview").getSelectedRecords();
var damPath=selectedRecord[0].data.damPath;
delete licenseBox.licenseMap[damPath]
}}},id:"radio1"},{boxLabel:CQ.I18n.getMessage("   I disagree with the license"),name:"license",inputValue:"l",checked:true,id:"radio2"}]});
this.licenseAgreementRadioGroup=licenseAgreementRadioGroup;
var contentPanel=new CQ.Ext.Panel({title:CQ.I18n.getMessage("License"),id:"contentPanel",height:250,layout:{type:"vbox",align:"stretch"},items:[licensePanel,licenseAgreementRadioGroup],region:"center",frame:true});
this.contentPanel=contentPanel;
config={id:CQ.Util.createId("licenseBox"),title:CQ.I18n.getMessage("Select Asset To View License"),height:654,width:899,padding:"0",okText:CQ.I18n.getMessage("Download"),buttons:CQ.Dialog.OKCANCEL,layout:"border",items:[assetviewer_download_renditions,contentPanel]};
config=CQ.Util.applyDefaults(config,{formUrl:"/libs/dam/drm",params:{_charset_:"utf-8",":agreement":"ACCEPTED"}});
CQ.wcm.LicenseBox.superclass.constructor.call(this,config);
this.addHidden({assetPaths:this.assetPaths});
this.dataView.select(0);
this.buttons[0].setDisabled(true)
}});
CQ.Ext.reg("licenseBox",CQ.wcm.LicenseBox);
CQ.wcm.Scene7PublishDialog=CQ.Ext.extend(CQ.Dialog,{store:null,dataPath:null,path:null,basePath:null,constructor:function(g){if(!g){g=new Object()
}this.dataPath=g.dataPath;
if(!this.dataPath){this.dataPath="/content/dam.s7publish.json"
}this.path=g.path;
this.basePath=g.basePath;
var b=new CQ.wcm.Scene7PublishDialog.CheckColumn({header:CQ.I18n.getMessage("Include Subfolders"),dataIndex:"subfolders",enabledIf:"isfolder",width:100});
var a=new CQ.Ext.grid.ColumnModel([b,{header:CQ.I18n.getMessage("Count"),dataIndex:"fileCount",width:60},{header:CQ.I18n.getMessage("Size"),dataIndex:"fileSize",renderer:function(r,n,m,t,q,o){return CQ.Ext.util.Format.fileSize(r)
}},{id:"path",header:CQ.I18n.getMessage("Assets"),dataIndex:CQ.shared.XSS.getXSSValue("path"),renderer:function(r,n,m,t,q,o){if(r.lastIndexOf("/")==r.length-1){return r
}else{return r.substring(r.lastIndexOf("/")+1)
}},width:220}]);
a.defaultSortable=true;
var k=this;
var c=CQ.HTTP.addParameter(this.dataPath,"path",this.path);
c=CQ.HTTP.addParameter(c,"_charset_","utf-8");
c=CQ.shared.HTTP.externalize(c);
this.store=new CQ.Ext.data.JsonStore({url:c,root:"paths",fields:[{name:"deepFileSize"},{name:"shallowFileSize"},{name:"fileSize"},{name:"deepFileCount"},{name:"shallowFileCount"},{name:"fileCount"},{name:"deepPublishStatus",defaultValue:"notAvailable"},{name:"shallowPublishStatus",defaultValue:"notAvailable"},{name:"publishStatus",defaultValue:"notAvailable"},{name:"path"},{name:"subfolders",defaultValue:true},{name:"isfolder"}],listeners:{beforeload:function(){k.loadingRefs=true
},load:function(){k.loadingRefs=false
},loadexception:function(q,n,m){k.loadingRefs=false;
try{var o=CQ.Ext.decode(m.responseText);
CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getVarMessage(o.message))
}catch(r){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Unexpected error while loading scene7 publish dialog"))
}k.hide()
}}});
var j=new CQ.Ext.grid.GridPanel({store:this.store,stateful:false,cm:a,height:238,disableSelection:true,enableHdMenu:false,autoExpandColumn:"path",clicksToEdit:1,loadMask:{msg:CQ.I18n.getMessage("Loading assets to Publish...")}});
b.init(j);
j.on("headerclick",function(n,m,q){if(m==0){var r="subfolders";
var o;
n.store.each(function(t){if(typeof o=="undefined"){o=!t.data[r]
}t.set(r,o);
t.dirty=false;
return true
})
}return true
});
g=CQ.Util.applyDefaults(g,{xtype:"dialog",title:CQ.I18n.getMessage("Publish to Scene7"),formUrl:CQ.shared.HTTP.externalize("/content/dam.s7publish.json"),params:{cmd:"setPublishSubfolderControl",integrity:"true",_charset_:"utf-8"},items:{xtype:"panel",items:[{xtype:"fieldset",title:CQ.I18n.getMessage("Location"),autoHeight:true,autoWidtht:true,stateful:false,items:[{xtype:"textfield",anchor:"100%",fieldLabel:CQ.I18n.getMessage("Path"),allowBlank:false,name:"srcPath",readOnly:true,value:this.basePath}]},j]},listeners:{show:function(){j.getStore().load()
}},failure:function(){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("An error occured while publishing assets"))
}});
g.buttons=[{text:CQ.I18n.getMessage("Publish"),cls:"cq-btn-publish",disabled:false,handler:function(){if(this.loadingRefs){CQ.Ext.Msg.show({title:CQ.I18n.getMessage("Publish To Scene7"),msg:CQ.I18n.getMessage("Please wait until the publish statistics are loaded."),buttons:CQ.Ext.Msg.OK,icon:CQ.Ext.Msg.WARNING});
return
}var m=this;
CQ.Ext.Msg.confirm(CQ.I18n.getMessage("Publish To Scene7"),CQ.I18n.getMessage("Do you really want to publish assets to Scene7?"),function(n){if(n=="yes"){m.ok.call(m)
}})
}},CQ.Dialog.CANCEL];
g.width=600;
g.height=470;
CQ.wcm.Scene7PublishDialog.superclass.constructor.call(this,g);
this.on("beforesubmit",function(){var m=this;
m.store.each(function(n){if(n.data.subfolders&&n.data.isfolder){m.addHidden({subfolders:n.data.path})
}});
return true
})
}});
CQ.Ext.reg("s7publishdialog",CQ.wcm.Scene7PublishDialog);
CQ.wcm.Scene7PublishDialog.CheckColumn=function(a){CQ.Ext.apply(this,a);
if(!this.id){this.id=CQ.Ext.id()
}this.renderer=this.renderer.createDelegate(this)
};
CQ.wcm.Scene7PublishDialog.CheckColumn.prototype={init:function(a){this.grid=a;
this.grid.on("render",function(){var b=this.grid.getView();
b.mainBody.on("mousedown",this.onMouseDown,this)
},this)
},onMouseDown:function(g,c){if(c.className&&c.className.indexOf("x-grid3-cc-"+this.id)!=-1){g.stopEvent();
var b=this.grid.getView().findRowIndex(c);
var a=this.grid.store.getAt(b);
a.set(this.dataIndex,!a.data[this.dataIndex]);
if(a.data.fileCount!=a.data.deepFileCount){a.set("fileCount",a.data.deepFileCount);
a.set("fileSize",a.data.deepFileSize);
a.set("publishStatus",a.data.deepPublishStatus)
}else{a.set("fileCount",a.data.shallowFileCount);
a.set("fileSize",a.data.shallowFileSize);
a.set("publishStatus",a.data.shallowPublishStatus)
}a.dirty=false
}},renderer:function(b,c,a){if(!this.enabledIf||a.data[this.enabledIf]){c.css+=" x-grid3-check-col-td";
return'<div class="x-grid3-check-col'+(b?"-on":"")+" x-grid3-cc-"+this.id+'">&#160;</div>'
}else{return"&nbsp;"
}}};
CQ.wcm.SlingScriptInclude=CQ.Ext.extend(CQ.Ext.Container,{script:null,constructor:function(a){a=(!a?{}:a);
var b={hidden:true};
CQ.Util.applyDefaults(a,b);
CQ.wcm.SlingScriptInclude.superclass.constructor.call(this,a)
},initComponent:function(){CQ.wcm.SlingScriptInclude.superclass.initComponent.call(this);
this.on("render",function(){var parentDialog=this.findParentByType("dialog");
if(parentDialog){parentDialog.on("loadcontent",function(dialog,recs,opts,success){if(this.loaded){return
}var selectorsAndRequestExtension=this.script.substring(0,this.script.lastIndexOf("."));
var url=CQ.HTTP.externalize(dialog.path)+"."+selectorsAndRequestExtension;
var response=CQ.HTTP.eval(url);
if(response){var fieldset=CQ.Util.build(response);
this.add(fieldset);
this.loaded=true;
fieldset.doLayout();
this.show();
dialog.processRecords(recs,opts,success)
}},this)
}},this)
}});
CQ.Ext.reg("slingscriptinclude",CQ.wcm.SlingScriptInclude);
CQ.wcm.msm.MSM=function(){var CFG_ROLLOUT_MGR="com.day.cq.wcm.msm.api.RolloutManager";
var CFG_ROLLOUT_EXCLUDE_PROPS="rolloutmgr.excludedprops.default";
var CFG_ROLLOUT_EXCLUDE_PARA_PROPS="rolloutmgr.excludedparagraphprops.default";
var serverConfig=null;
var init=function(){var url=CQ.HTTP.externalize("/libs/wcm/msm/content/info.json",false);
var serverResponse=CQ.utils.HTTP.get(url,null,this);
if(CQ.utils.HTTP.isOk(serverResponse)){var data=CQ.Util.eval(serverResponse);
serverConfig=data.config
}};
return{PARAM_SOURCEPATH:"msm:sourcePath",PARAM_TARGETPATH:"msm:targetPath",PARAM_SYNCPATH:"msm:syncPath",PARAM_LIVECOPY_PATH:"msm:liveCopyPath",PARAM_LIVECOPY_BPPATH:"msm:liveCopyBpPath",PARAM_IS_DEEP:"msm:isDeep",PARAM_STATUS:"msm:status",PARAM_TRIGGER:"msm:trigger",PARAM_COMPUTATION_TIME:"msm:computationTime",PARAM_ACTION_CONFIG:"msm:actionConfig",PARAM_IS_CANCELLED:"msm:isCancelled",PARAM_IS_CANCELLED_FOR_CHILDREN:"msm:isCancelledForChildren",PARAM_IS_CANCELLED_ON:"msm:isCancelledOn",PARAM_IS_EDITABLE:"msm:isEditable",PARAM_IS_PAGE:"msm:isPage",PARAM_IS_TARGET_EXISTING:"msm:isTargetExisting",PARAM_IS_TARGET_DELETED:"msm:isTargetDeleted",PARAM_IS_TARGET_MODIFIED:"msm:isTargetModified",PARAM_IS_TARGET_CANCELLED_CHILD:"msm:isTargetCancelledChild",PARAM_IS_TARGET_CANCELLED_PROPERTY:"msm:isTargetCancelledProperty",PARAM_IS_TARGET_MANUALLY_CREATED:"msm:isTargetManuallyCreated",PARAM_IS_TARGET_FROM_DIFFERENT_TREE:"msm:isTargetFromDifferentTree",PARAM_IS_TARGET_SKIPPED:"msm:isTargetSkipped",PARAM_IS_SOURCE_EXISTING:"msm:isSourceExisting",PARAM_IS_SOURCE_DELETED:"msm:isSourceDeleted",PARAM_IS_SOURCE_MODIFIED:"msm:isSourceModified",PARAM_LIVE_RELATIONSHIP:"msm:liveRelationship",PARAM_TARGETS:"msm:targets",PARAM_IS_LIVECOPY:"msm:isLiveCopy",PARAM_IS_IN_BLUEPRINT:"msm:isInBlueprint",PARAM_IS_SOURCE:"msm:isSource",PARAM_IS_INHERITED_CONFIG:"msm:isInheritedConfig",PARAM_IS_ROOT_CONFIG:"msm:isRootConfig",PARAM_PROPERTY_NAME:"msm:propertyName",PARAM_CANCELED_PROPERTIES:"msm:cancelledProperties",PARAM_PROPERTY_INHERITANCE_CANCELED:"cq:propertyInheritanceCancelled",MIXIN_LIVE_RELATIONSHIP:"cq:LiveRelationship",MIXIN_LIVE_SYNC:"cq:LiveSync",MIXIN_LIVE_SYNC_CANCELLED:"cq:LiveSyncCancelled",PARAM_SKIPPED_PAGES:"skippedPage",getSyncTriggerConfig:function(){return new CQ.Ext.form.ComboBox({stateful:false,fieldLabel:CQ.I18n.getMessage("Sync Trigger"),allowBlank:false,defaultValue:"never",value:"never",name:"trigger",cls:"cq-msm-synctrigger",hiddenName:"msm:trigger",displayField:"label",valueField:"id",typeAhead:true,mode:"local",triggerAction:"all",store:new CQ.Ext.data.SimpleStore({fields:["id","label"],data:[["never",CQ.I18n.getMessage("Never")],["rollout",CQ.I18n.getMessage("On Rollout")],["modification",CQ.I18n.getMessage("On Modification")],["publish",CQ.I18n.getMessage("On Activation")],["deactivate",CQ.I18n.getMessage("On Deactivation")]]})})
},getRelationStatus:function(lr){var ret="";
if(lr&&lr[CQ.wcm.msm.MSM.PARAM_SOURCEPATH]&&lr[CQ.wcm.msm.MSM.PARAM_STATUS]){if(!lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_CANCELLED]){if(lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_EXISTING]&&lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_SOURCE_EXISTING]&&!lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_MANUALLY_CREATED]){if(lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_SOURCE_MODIFIED]){if(lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_CANCELLED_CHILD]||lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_CANCELLED_PROPERTY]){var text=CQ.wcm.msm.MSM.Texts.LR.States.getTextWithParams("msm-status-src-modified-cancelled-par",[CQ.wcm.msm.MSM.filterPagePath(lr[CQ.wcm.msm.MSM.PARAM_SOURCEPATH])]);
var clazz=CQ.wcm.msm.MSM.Texts.LR.States["msm-status-src-modified-cancelled-par"]["iconClass"];
return'<div class="msm-status '+clazz+'" title="'+text+'" alt="'+text+'"></div>'
}else{var text=CQ.wcm.msm.MSM.Texts.LR.States.getTextWithParams("msm-status-src-modified",[CQ.wcm.msm.MSM.filterPagePath(lr[CQ.wcm.msm.MSM.PARAM_SOURCEPATH])]);
var clazz=CQ.wcm.msm.MSM.Texts.LR.States["msm-status-src-modified"]["iconClass"];
return'<div class="msm-status '+clazz+'" title="'+text+'" alt="'+text+'"></div>'
}}else{if(lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_MODIFIED]){if(lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_CANCELLED_CHILD]||lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_CANCELLED_PROPERTY]){var text=CQ.wcm.msm.MSM.Texts.LR.States.getTextWithParams("msm-status-target-modified-cancelled-par",[CQ.wcm.msm.MSM.filterPagePath(lr[CQ.wcm.msm.MSM.PARAM_TARGETPATH])]);
var clazz=CQ.wcm.msm.MSM.Texts.LR.States["msm-status-target-modified-cancelled-par"]["iconClass"];
return'<div class="msm-status '+clazz+'" title="'+text+'" alt="'+text+'"></div>'
}else{var text=CQ.wcm.msm.MSM.Texts.LR.States.getTextWithParams("msm-status-target-modified",[CQ.wcm.msm.MSM.filterPagePath(lr[CQ.wcm.msm.MSM.PARAM_TARGETPATH])]);
var clazz=CQ.wcm.msm.MSM.Texts.LR.States["msm-status-target-modified"]["iconClass"];
return'<div class="msm-status '+clazz+'" title="'+text+'" alt="'+text+'"></div>'
}}else{if(lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_CANCELLED_CHILD]||lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_CANCELLED_PROPERTY]){var text=CQ.wcm.msm.MSM.Texts.LR.States.getTextWithParams("msm-status-synchronized-cancelled-par",[CQ.wcm.msm.MSM.filterPagePath(lr[CQ.wcm.msm.MSM.PARAM_SOURCEPATH]),CQ.wcm.msm.MSM.filterPagePath(lr[CQ.wcm.msm.MSM.PARAM_TARGETPATH])]);
var clazz=CQ.wcm.msm.MSM.Texts.LR.States["msm-status-synchronized-cancelled-par"]["iconClass"];
return'<div class="msm-status '+clazz+'" title="'+text+'" alt="'+text+'"></div>'
}else{var text=CQ.wcm.msm.MSM.Texts.LR.States.getTextWithParams("msm-status-synchronized",[CQ.wcm.msm.MSM.filterPagePath(lr[CQ.wcm.msm.MSM.PARAM_SOURCEPATH]),CQ.wcm.msm.MSM.filterPagePath(lr[CQ.wcm.msm.MSM.PARAM_TARGETPATH])]);
var clazz=CQ.wcm.msm.MSM.Texts.LR.States["msm-status-synchronized"]["iconClass"];
return'<div class="msm-status '+clazz+'" title="'+text+'" alt="'+text+'"></div>'
}}}}else{if(lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_SOURCE_EXISTING]){var text,clazz;
if(lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_DELETED]){text=CQ.wcm.msm.MSM.Texts.LR.States.getTextWithParams("msm-status-target-deleted",[CQ.wcm.msm.MSM.filterPagePath(lr[CQ.wcm.msm.MSM.PARAM_TARGETPATH])]);
clazz=CQ.wcm.msm.MSM.Texts.LR.States["msm-status-target-deleted"]["iconClass"]
}else{if(lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_MANUALLY_CREATED]){text=CQ.wcm.msm.MSM.Texts.LR.States.getTextWithParams("msm-status-new",[CQ.wcm.msm.MSM.filterPagePath(lr[CQ.wcm.msm.MSM.PARAM_TARGETPATH])]);
clazz=CQ.wcm.msm.MSM.Texts.LR.States["msm-status-new"]["iconClass"]
}else{if(lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_SKIPPED]){text=CQ.wcm.msm.MSM.Texts.LR.States.getTextWithParams("msm-status-skipped",[CQ.wcm.msm.MSM.filterPagePath(lr[CQ.wcm.msm.MSM.PARAM_TARGETPATH])]);
clazz=CQ.wcm.msm.MSM.Texts.LR.States["msm-status-skipped"]["iconClass"]
}else{text=CQ.wcm.msm.MSM.Texts.LR.States.getTextWithParams("msm-status-never-created",[CQ.wcm.msm.MSM.filterPagePath(lr[CQ.wcm.msm.MSM.PARAM_TARGETPATH])]);
clazz=CQ.wcm.msm.MSM.Texts.LR.States["msm-status-never-created"]["iconClass"]
}}}return'<div class="msm-status '+clazz+'" title="'+text+'" alt="'+text+'"></div>'
}else{if(lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_SOURCE_DELETED]){text=CQ.wcm.msm.MSM.Texts.LR.States.getTextWithParams("msm-status-src-deleted",[CQ.wcm.msm.MSM.filterPagePath(lr[CQ.wcm.msm.MSM.PARAM_SOURCEPATH])]);
clazz=CQ.wcm.msm.MSM.Texts.LR.States["msm-status-src-deleted"]["iconClass"];
return'<div class="msm-status '+clazz+'" title="'+text+'" alt="'+text+'"></div>'
}}}}else{if(lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_SOURCE_EXISTING]||lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_SOURCE_DELETED]){var text=CQ.wcm.msm.MSM.Texts.LR.States.getTextWithParams("msm-status-cancelled",[CQ.wcm.msm.MSM.filterPagePath(lr[CQ.wcm.msm.MSM.PARAM_SOURCEPATH])]);
var clazz=CQ.wcm.msm.MSM.Texts.LR.States["msm-status-cancelled"]["iconClass"];
return'<div class="msm-status '+clazz+'" title="'+text+'" alt="'+text+'"></div>'
}}}return""
},getSyncActionsConfig:function(checkInheritance){var actions=new Array();
for(var i=0;
i<CQ.wcm.msm.MSM.ACTIONS.length;
i++){var config=CQ.Util.applyDefaults({},CQ.wcm.msm.MSM.ACTIONS[i]);
if(checkInheritance){config=CQ.Util.applyDefaults(config,{listeners:{loadcontent:function(path,rec){if(rec.data[this.actionName]&&rec.data[this.actionName]["inherited"]){this.disable()
}else{this.enable()
}}}})
}actions.push(config)
}return new CQ.Ext.form.FieldSet({title:CQ.I18n.getMessage("Sync Actions"),autoHeight:true,stateful:false,defaults:{anchor:"95%"},items:actions})
},getRolloutInfo:function(lr,rolloutPath){var info={text:"",shortText:"",css:""};
if(lr&&lr[CQ.wcm.msm.MSM.PARAM_SOURCEPATH]&&lr[CQ.wcm.msm.MSM.PARAM_STATUS]){if(rolloutPath&&lr[CQ.wcm.msm.MSM.PARAM_SOURCEPATH].indexOf(rolloutPath)!=0){info.text=CQ.I18n.getMessage("Target page inherits from a different Blueprint. Rollout page {0} to update target page.",CQ.wcm.msm.MSM.filterPagePath(lr[CQ.wcm.msm.MSM.PARAM_SOURCEPATH]));
info.shortText=CQ.I18n.getMessage("No action");
info.css="msm-rollout-plan-info-no-action"
}else{if(!lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_CANCELLED]){if(!lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_MANUALLY_CREATED]&&lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_EXISTING]&&lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_SOURCE_EXISTING]){if(lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_CANCELLED_CHILD]||lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_CANCELLED_PROPERTY]){info.text=CQ.I18n.getMessage("Target page contains paragraphs or properties for which Live Copy has been canceled. These paragraphs or properties will not be updated, any others will be replaced.");
info.shortText=CQ.I18n.getMessage("Partial update");
info.css="msm-rollout-plan-info-partial-update"
}else{info.text=CQ.I18n.getMessage("Target page will be fully updated.");
info.shortText=CQ.I18n.getMessage("Full update");
info.css="msm-rollout-plan-info-update"
}}else{if(!lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_SOURCE_EXISTING]&&lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_SOURCE_DELETED]){info.text=CQ.I18n.getMessage("Target page will be deleted from Live Copy");
info.shortText=CQ.I18n.getMessage("Delete");
info.css="msm-rollout-plan-info-delete"
}else{if(lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_MANUALLY_CREATED]||(!lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_SOURCE_EXISTING]&&!lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_SOURCE_DELETED])){info.text=CQ.I18n.getMessage("Page has been created into Live Copy. No rollout action.");
info.shortText=CQ.I18n.getMessage("No action");
info.css="msm-rollout-plan-info-no-action"
}else{if(lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_SOURCE_EXISTING]&&!lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_EXISTING]){if(!lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_DELETED]){info.text=CQ.I18n.getMessage("Target page does not exist and will be created in Live Copy.");
info.shortText=CQ.I18n.getMessage("Create");
info.css="msm-rollout-plan-info-create"
}else{info.text=CQ.I18n.getMessage("Target page has been manually deleted. To restore it, use the version manager");
info.shortText=CQ.I18n.getMessage("No action");
info.css="msm-rollout-plan-info-no-action"
}}}}}}else{info.text=CQ.I18n.getMessage("Live Copy has been cancelled for target page. No rollout action");
info.shortText=CQ.I18n.getMessage("No action");
info.css="msm-rollout-plan-info-no-action"
}}if(lr[CQ.wcm.msm.MSM.PARAM_TRIGGER]=="never"){info.shortText=CQ.I18n.getMessage("Rollout never triggered")
}}return info
},toHTML:function(lr){var html="<div>";
if(lr){if(lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_CANCELLED]){html+="cancelled"
}else{html+="sync"
}}return html+"</div>"
},isExcludedProperty:function(name){if(!serverConfig){init()
}var excludes=serverConfig[CFG_ROLLOUT_MGR][CFG_ROLLOUT_EXCLUDE_PROPS];
for(var i=0;
i<excludes.length;
i++){if(name.match(excludes[i])){return true
}}excludes=serverConfig[CFG_ROLLOUT_MGR][CFG_ROLLOUT_EXCLUDE_PARA_PROPS];
for(var i=0;
i<excludes.length;
i++){if(name.match(excludes[i])){return true
}}return false
}}
}();
CQ.wcm.msm.MSM.UpdateContentAction={xtype:"selection",fieldLabel:CQ.I18n.getMessage("Update Content"),name:"msm:actionUpdate/status",actionName:"msm:actionUpdate",stateful:false,type:"checkbox",fieldDescription:CQ.I18n.getMessage("Enables content update"),defaultValue:false};
CQ.wcm.msm.MSM.NotifyAction={xtype:"selection",fieldLabel:CQ.I18n.getMessage("Enable Notification"),name:"msm:actionNotify/target",actionName:"msm:actionNotify",stateful:false,type:"checkbox",fieldDescription:CQ.I18n.getMessage("Enables notification"),defaultValue:false};
CQ.wcm.msm.MSM.WorkflowAction={xtype:"combo",fieldLabel:CQ.I18n.getMessage("Start Workflow"),name:"actionWorkflow",cls:"cq-msm-action-workflow",hiddenName:"msm:actionWorkflow/target",actionName:"msm:actionWorkflow",stateful:false,typeAhead:true,triggerAction:"all",inputType:"text",emptyText:"",minChars:0,editable:true,lazyInit:false,displayField:"label",valueField:"wid",fieldDescription:CQ.I18n.getMessage("Select a workflow to be started on synchronization"),tpl:new CQ.Ext.XTemplate('<tpl for=".">','<div class="cq-msm-list cq-msm-workflow-list">','<div class="cq-msm-list-entry cq-msm-workflow-list-entry">{[values.label==""? values.wid: values.label]}</div>',"</div>","</tpl>"),itemSelector:"div.cq-msm-workflow-list",store:new CQ.Ext.data.Store({autoLoad:false,proxy:new CQ.Ext.data.HttpProxy({url:"/libs/cq/workflow/content/console/workflows.json",method:"GET"}),baseParams:{tags:"wcm"},reader:new CQ.Ext.data.JsonReader({root:"workflows",totalProperty:"results",id:"wid",fields:["wid","label"]})}),defaultValue:""};
CQ.wcm.msm.MSM.MandatoryAction={xtype:"combo",fieldLabel:CQ.I18n.getMessage("Read only for"),name:"actionMandatory",cls:"cq-msm-action-mandatory",hiddenName:"msm:actionMandatory/target",actionName:"msm:actionMandatory",stateful:false,typeAhead:true,triggerAction:"all",inputType:"text",displayField:"name",valueField:"id",emptyText:"",minChars:0,editable:true,lazyInit:false,queryParam:"filter",fieldDescription:CQ.I18n.getMessage("Select the group that will have read-only access on the copies."),tpl:new CQ.Ext.XTemplate('<tpl for=".">','<div class="cq-msm-list cq-msm-mandatory-list">','<div class="cq-msm-list-entry cq-msm-mandatory-list-entry">{[values.name==""? values.id: values.name]}</div>',"</div>","</tpl>"),itemSelector:"div.cq-msm-mandatory-list",store:new CQ.Ext.data.Store({autoLoad:false,proxy:new CQ.Ext.data.HttpProxy({url:"/bin/security/authorizables.json?limit=25&hideUsers=true",method:"GET"}),reader:new CQ.Ext.data.JsonReader({root:"authorizables",totalProperty:"results",id:"id",fields:["name","id"]})}),defaultValue:""};
CQ.wcm.msm.MSM.SourceVersionAction={xtype:"selection",fieldLabel:CQ.I18n.getMessage("Create Blueprint version"),name:"msm:actionSourceVersion/status",actionName:"msm:actionSourceVersion",stateful:false,type:"checkbox",fieldDescription:CQ.I18n.getMessage("Creates a version of the Blueprint page"),defaultValue:false};
CQ.wcm.msm.MSM.TargetVersionAction={xtype:"selection",fieldLabel:CQ.I18n.getMessage("Create Live Copy version"),name:"msm:actionTargetVersion/status",actionName:"msm:actionTargetVersion",stateful:false,type:"checkbox",fieldDescription:CQ.I18n.getMessage("Creates a version of the Live Copy page"),defaultValue:false};
CQ.wcm.msm.MSM.MandatoryStructureAction={xtype:"combo",fieldLabel:CQ.I18n.getMessage("Mandatory Structure for"),name:"actionMandatoryStructure",hiddenName:"msm:actionMandatoryStructure/target",actionName:"msm:actionMandatoryStructure",stateful:false,typeAhead:true,triggerAction:"all",inputType:"text",displayField:"name",valueField:"id",emptyText:"",minChars:0,editable:true,lazyInit:false,queryParam:"filter",fieldDescription:CQ.I18n.getMessage("Select the group that will not be able to modify the Live Copy structure."),tpl:new CQ.Ext.XTemplate('<tpl for=".">','<div class="cq-msm-list cq-msm-mandatory-structure-list">','<div class="cq-msm-list-entry cq-msm-mandatory-structure-list-entry">{[values.name==""? values.id: values.name]}</div>',"</div>","</tpl>"),itemSelector:"div.cq-msm-mandatory-structure-list",store:new CQ.Ext.data.Store({autoLoad:false,proxy:new CQ.Ext.data.HttpProxy({url:"/bin/security/authorizables.json?limit=25&hideUsers=true",method:"GET"}),reader:new CQ.Ext.data.JsonReader({root:"authorizables",totalProperty:"results",id:"id",fields:["name","id"]})}),defaultValue:""};
CQ.wcm.msm.MSM.MandatoryContentAction={xtype:"combo",fieldLabel:CQ.I18n.getMessage("Mandatory Content for"),name:"actionMandatoryStructure",hiddenName:"msm:actionMandatoryContent/target",actionName:"msm:actionMandatoryContent",stateful:false,typeAhead:true,triggerAction:"all",inputType:"text",displayField:"name",valueField:"id",emptyText:"",minChars:0,editable:true,lazyInit:false,queryParam:"filter",fieldDescription:CQ.I18n.getMessage("Select the group that will not be able to modify the Live Copy content."),tpl:new CQ.Ext.XTemplate('<tpl for=".">','<div class="cq-msm-list cq-msm-mandatory-structure-list">','<div class="cq-msm-list-entry cq-msm-mandatory-structure-list-entry">{[values.name==""? values.id: values.name]}</div>',"</div>","</tpl>"),itemSelector:"div.cq-msm-mandatory-structure-list",store:new CQ.Ext.data.Store({autoLoad:false,proxy:new CQ.Ext.data.HttpProxy({url:"/bin/security/authorizables.json?limit=25&hideUsers=true",method:"GET"}),reader:new CQ.Ext.data.JsonReader({root:"authorizables",totalProperty:"results",id:"id",fields:["name","id"]})}),defaultValue:""};
CQ.wcm.msm.MSM.filterPagePath=function(a){if(!a){return""
}if(a.lastIndexOf("/jcr:content")==a.length-12){return a.substring(0,a.length-12)
}return a
};
CQ.wcm.msm.MSM.ACTIONS=[CQ.wcm.msm.MSM.UpdateContentAction,CQ.wcm.msm.MSM.NotifyAction,CQ.wcm.msm.MSM.WorkflowAction,CQ.wcm.msm.MSM.MandatoryAction];
CQ.wcm.msm.MSM.Texts={};
CQ.wcm.msm.MSM.Texts.LR={};
CQ.wcm.msm.MSM.Texts.LR.States={"msm-status-synchronized":{text:CQ.I18n.getMessage("Live Copy page is up-to-date with its Blueprint page."),textWithParams:CQ.I18n.getMessage("Live Copy page {1} is up-to-date with its Blueprint page {0}."),iconClass:"msm-status-synchronized"},"msm-status-synchronized-cancelled-par":{text:CQ.I18n.getMessage("Live Copy page is up-to-date with its Blueprint page and it contains paragraphs or properties for which inheritance has been cancelled."),textWithParams:CQ.I18n.getMessage("Live Copy page {1} is up-to-date with its Blueprint page {0} and it contains paragraphs or properties for which inheritance has been cancelled."),iconClass:"msm-status-synchronized-cancelled-par"},"msm-status-src-modified":{text:CQ.I18n.getMessage("Blueprint page has been modified since last rollout."),textWithParams:CQ.I18n.getMessage("Blueprint page {0} has been modified since last rollout."),iconClass:"msm-status-src-modified"},"msm-status-src-modified-cancelled-par":{text:CQ.I18n.getMessage("Blueprint page has been modified since last rollout. Live Copy page contains paragraphs or properties for which inheritance has been cancelled."),textWithParams:CQ.I18n.getMessage("Blueprint page {0} has been modified since last rollout. Live Copy page {1} contains paragraphs or properties for which inheritance has been cancelled."),iconClass:"msm-status-src-modified-cancelled-par"},"msm-status-target-modified":{text:CQ.I18n.getMessage("Live Copy page has been modified."),textWithParams:CQ.I18n.getMessage("Live Copy page {0} has been modified."),iconClass:"msm-status-target-modified"},"msm-status-target-modified-cancelled-par":{text:CQ.I18n.getMessage("Live Copy page has been modified since last rollout and it contains paragraphs or properties for which inheritance has been cancelled."),textWithParams:CQ.I18n.getMessage("Live Copy page {0} has been modified since last rollout and it contains paragraphs or properties for which inheritance has been cancelled."),iconClass:"msm-status-target-modified-cancelled-par"},"msm-status-new":{text:CQ.I18n.getMessage("Page has been locally created inside Live Copy."),textWithParams:CQ.I18n.getMessage("Page {0} has been locally created inside Live Copy."),iconClass:"msm-status-new"},"msm-status-target-deleted":{text:CQ.I18n.getMessage("Live Copy page has been deleted."),textWithParams:CQ.I18n.getMessage("Live Copy page {0} has been deleted."),iconClass:"msm-status-target-deleted"},"msm-status-never-created":{text:CQ.I18n.getMessage("Live Copy page does not exist (it has never been created and deleted). It will be created during next rollout process."),textWithParams:CQ.I18n.getMessage("Live Copy page {0} does not exist (it has never been created and deleted). It will be created during next rollout process."),iconClass:"msm-status-never-created"},"msm-status-cancelled":{text:CQ.I18n.getMessage("Live Copy page inheritance has been cancelled."),textWithParams:CQ.I18n.getMessage("Live Copy page {0} inheritance has been cancelled."),iconClass:"msm-status-cancelled"},"msm-status-src-deleted":{text:CQ.I18n.getMessage("Blueprint page has been deleted."),textWithParams:CQ.I18n.getMessage("Blueprint page {0} has been deleted."),iconClass:"msm-status-src-deleted"},"msm-status-skipped":{text:CQ.I18n.getMessage("Live Copy page does not exist and is skipped from rollout process."),textWithParams:CQ.I18n.getMessage("Live Copy page {0} does not exist and is skipped from rollout process."),iconClass:"msm-status-skipped"}};
CQ.wcm.msm.MSM.Texts.LR.States.getTextWithParams=function(b,a){return CQ.Util.patchText(CQ.wcm.msm.MSM.Texts.LR.States[b]["textWithParams"],a)
};
CQ.wcm.msm.MSM.Texts.LR.Statuses={"msm:isCancelled":CQ.I18n.getMessage("Cancelled inheritance"),"msm:isCancelledForChildren":CQ.I18n.getMessage("Cancelled inheritance for children"),"msm:isEditable":CQ.I18n.getMessage("Editable"),"msm:isPage":CQ.I18n.getMessage("Page relation"),"msm:isSourceExisting":CQ.I18n.getMessage("Blueprint page existing"),"msm:isSourceModified":CQ.I18n.getMessage("Blueprint page modified"),"msm:isSourceDeleted":CQ.I18n.getMessage("Blueprint page deleted"),"msm:isTargetExisting":CQ.I18n.getMessage("Live Copy page existing"),"msm:isTargetModified":CQ.I18n.getMessage("Live Copy page modified"),"msm:isTargetDeleted":CQ.I18n.getMessage("Live Copy page deleted"),"msm:isTargetManuallyCreated":CQ.I18n.getMessage("Live Copy page locally created"),"msm:isTargetCancelledChild":CQ.I18n.getMessage("Live Copy page has children for which inheritance has been cancelled"),"msm:isTargetCancelledProperty":CQ.I18n.getMessage("Live Copy page has properties or children with properties for which inheritance has been cancelled"),"msm:isTargetFromDifferentTree":CQ.I18n.getMessage("Live Copy page is a Live Copy from different Blueprint"),"msm:isTargetSkipped":CQ.I18n.getMessage("Live Copy page skipped")};
CQ.wcm.msm.MSM.Commands={};
CQ.wcm.msm.MSM.Commands.rollout=function(k,j,a,c,g,b){CQ.Ext.Ajax.request({url:CQ.HTTP.externalize("/bin/wcmcommand"),method:"POST",callback:g,params:{_charset_:"utf-8",cmd:"rollout",path:CQ.wcm.msm.MSM.filterPagePath(k),"msm:targetPath":CQ.wcm.msm.MSM.filterPagePath(j),type:a?"deep":"page",reset:c},scope:b})
};
CQ.wcm.msm.MSM.Commands.rolloutLiveCopy=function(j,g,a,c,b){CQ.wcm.msm.MSM.Commands.rollout(j,g,a,false,c,b)
};
CQ.wcm.msm.MSM.Commands.resetLiveCopy=function(j,g,a,c,b){CQ.wcm.msm.MSM.Commands.rollout(j,g,a,true,c,b)
};
CQ.wcm.msm.MSM.Commands.recreateLiveCopy=function(g,c,b,a){CQ.wcm.msm.MSM.Commands.rollout(g,c,true,true,b,a)
};
CQ.wcm.msm.MSM.Commands.detachLiveCopy=function(c,b,a){CQ.Ext.Ajax.request({url:CQ.HTTP.externalize(c+".msm.conf"),method:"POST",callback:b,params:{_charset_:"utf-8",removeLCMarkers:true},scope:a})
};
CQ.wcm.msm.MSM.Commands.attachLiveCopy=function(j,g,a,c,b){CQ.Ext.Ajax.request({url:CQ.HTTP.externalize(g+".msm.conf"),method:"POST",callback:c,params:{_charset_:"utf-8",cmd:"attach",srcPath:j,deep:a},scope:b})
};
CQ.wcm.msm.MSM.Commands.flushServerCaches=function(b,a){CQ.Ext.Ajax.request({url:CQ.HTTP.externalize("/libs/wcm/msm/content/commands/servercaches.conf"),method:"POST",callback:b,params:{_charset_:"utf-8",cmd:"flush"},scope:a})
};
CQ.wcm.msm.MSM.Commands.addSkippedPage=function(j,a,g,b){var c={cmd:"append"};
c[CQ.wcm.msm.MSM.PARAM_SKIPPED_PAGES]=a;
CQ.Ext.Ajax.request({url:CQ.HTTP.externalize(j+".skippedpages.json"),method:"POST",callback:g,params:c,scope:b})
};
CQ.wcm.msm.MSM.Commands.removeSkippedPage=function(j,a,g,b){var c={cmd:"remove"};
c[CQ.wcm.msm.MSM.PARAM_SKIPPED_PAGES]=a;
CQ.Ext.Ajax.request({url:CQ.HTTP.externalize(j+".skippedpages.json"),method:"POST",callback:g,params:c,scope:b})
};
CQ.wcm.msm.MSM.Commands.skipLiveCopy=function(j,g,b){var c=j.substring(0,j.lastIndexOf("/"));
var a=j.substring(j.lastIndexOf("/")+1);
CQ.wcm.msm.MSM.Commands.addSkippedPage(c,a,g,b)
};
CQ.wcm.msm.MSM.Commands.unskipLiveCopy=function(j,g,b){var c=j.substring(0,j.lastIndexOf("/"));
var a=j.substring(j.lastIndexOf("/")+1);
CQ.wcm.msm.MSM.Commands.removeSkippedPage(c,a,g,b)
};
CQ.wcm.msm.MSM.Commands.getCreateLiveCopyDialogConfig=function(b){var a=new CQ.form.Selection({name:"missingPage",fieldLabel:CQ.I18n.getMessage("Missing pages"),options:[],type:"checkbox",fieldDescription:CQ.I18n.getMessage("Missing pages are optional pages which were not selected during Live Copy creation, deleted pages or newly created pages on Blueprint."),listeners:{selectionchanged:function(r,t,m){var j=false;
if(r&&r.optionItems&&r.optionItems.items){for(var n=0;
n<r.optionItems.items.length;
n++){if(r.optionItems.items[n].checked){j=true;
break
}}var k=r.findParentByType("tabpanel");
if(k){var q=k.find("name","srcPath");
if(q&&q.length>0){var o=q[0];
if(!o.requiredLabel){o.requiredLabel=o.label.dom.innerHTML
}o.allowBlank=j;
var g=j?o.fieldLabel:o.requiredLabel;
o.label.update(g);
o.clearInvalid()
}}}}}});
var c=new CQ.Ext.data.JsonStore({proxy:new CQ.Ext.data.HttpProxy({url:CQ.HTTP.externalize(b+".missingpages.json")}),fields:["path","name","title"]});
c.load({callback:function(g,k,o){if(g&&g.length){var k=[];
for(var m=0;
m<g.length;
m++){var j=g[m].get("name");
var n=g[m].get("title");
k.push({value:j,text:n})
}a.setOptions(k)
}else{a.findParentByType("dialogfieldset").hide();
a.findParentByType("dialogfieldset").nextSibling().setTitle(CQ.I18n.getMessage("Choose Live Copy source"));
a.findParentByType("dialogfieldset").nextSibling().expand()
}}});
return createDialog={xtype:"dialog",id:CQ.Util.createId("cq-livecopydialog"),title:CQ.I18n.getMessage("Create Live Copy"),formUrl:"/bin/wcmcommand",params:{cmd:"createLiveCopy",_charset_:"utf-8"},height:500,items:{xtype:"tabpanel",items:[{xtype:"panel",title:CQ.I18n.getMessage("Source selection"),items:[{collapsed:false,collapsible:true,xtype:"dialogfieldset",title:CQ.I18n.getMessage("Select missing pages..."),items:[a,{fieldLabel:CQ.I18n.getMessage("Exclude sub pages"),xtype:"selection",type:"checkbox",value:false,name:"excludeSubPages",fieldDescription:CQ.I18n.getMessage("If checked, sub pages of selected page above will not be copied and it will be possible to select them individually as new Live Copy.")}]},{collapsed:true,collapsible:true,xtype:"dialogfieldset",title:CQ.I18n.getMessage("... or choose Live Copy source"),items:[{name:"destPath",value:b,xtype:"hidden"},{fieldLabel:CQ.I18n.getMessage("Title"),name:"title",xtype:"textfield"},{fieldLabel:CQ.I18n.getMessage("Name"),name:"label",vtype:"itemname",xtype:"textfield"},{fieldLabel:CQ.I18n.getMessage("Live Copy From"),name:"srcPath",xtype:"pathfield",allowBlank:false},{fieldLabel:CQ.I18n.getMessage("Exclude sub pages"),xtype:"selection",type:"checkbox",value:false,name:"shallow",fieldDescription:CQ.I18n.getMessage("If checked, sub pages of selected page above will not be copied and it will be possible to select them individually as new Live Copy.")}]}]},{xtype:"panel",title:CQ.I18n.getMessage("Sync config"),items:[CQ.Util.formatData({xtype:"cqinclude",path:CQ.HTTP.externalize("/libs/wcm/msm/components/rolloutconfig/chooser.infinity.json")})]}]},buttons:CQ.Dialog.OKCANCEL,okText:CQ.I18n.getMessage("Create")}
};
CQ.wcm.msm.MSM.Commands.createLiveCopy=function(n,b,k,a,j,g,m,c){a=a||n.substring(n.lastIndexOf("/")+1);
CQ.Ext.Ajax.request({url:CQ.HTTP.externalize("/bin/wcmcommand"),method:"POST",callback:m,params:{_charset_:"utf-8",cmd:"createLiveCopy",srcPath:CQ.wcm.msm.MSM.filterPagePath(n),destPath:b,label:a,shallow:j||false,before:k,"cq:rolloutConfigs":g},scope:c})
};
CQ.wcm.msm.MSM.Commands.createCatalog=function(b,a){var g={"jcr:primaryType":"cq:Dialog",id:CQ.Util.createId("cq-createcatalogdialog"),title:CQ.I18n.getMessage("Create Catalog"),formUrl:"/bin/wcmcommand",params:{cmd:"createCatalog",srcPath:b,_charset_:"utf-8"},height:200,items:{"jcr:primaryType":"cq:Panel",items:[{fieldLabel:CQ.I18n.getMessage("Destination"),name:"destPath",rootPath:"/content",xtype:"pathfield"},{fieldLabel:CQ.I18n.getMessage("Title"),name:"title",value:a,xtype:"textfield"},{fieldLabel:CQ.I18n.getMessage("Name"),name:"label",vtype:"itemname",xtype:"textfield"}]},buttons:CQ.Dialog.OKCANCEL,okText:CQ.I18n.getMessage("Create")};
var c=CQ.WCM.getDialog(g);
c.failure=function(o,n){var j;
try{var m=CQ.HTTP.buildPostResponseFromHTML(n.response.responseText);
j=m.headers[CQ.HTTP.HEADER_MESSAGE]
}catch(k){j=CQ.I18n.getMessage("Failed to create catalog.")
}CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),j)
};
c.success=function(m,k){var j=CQ.HTTP.buildPostResponseFromHTML(k.response.responseText);
CQ.Notification.notifyFromResponse(j,null,true)
};
c.show()
};
CQ.wcm.msm.LiveCopyProperties=CQ.Ext.extend(CQ.CustomContentPanel,{RESET_NAME:"resetConfig",constructor:function(a){a=(!a?{}:a);
this.actionConfigTextField=new CQ.Static({fieldLabel:CQ.I18n.getMessage("Rollout Config"),bottommargin:true,html:""});
this.isInheritedConfigField=new CQ.Ext.form.Hidden({name:CQ.wcm.msm.MSM.PARAM_IS_INHERITED_CONFIG});
this.isRootConfigField=new CQ.Ext.form.Hidden({name:CQ.wcm.msm.MSM.PARAM_IS_ROOT_CONFIG});
this.isResetConfigField=new CQ.Ext.form.Hidden({name:this.RESET_NAME,value:false});
this.isCancelled=new CQ.form.Selection({fieldLabel:CQ.I18n.getMessage("Live Copy suspended"),name:CQ.wcm.msm.MSM.PARAM_STATUS+"/"+CQ.wcm.msm.MSM.PARAM_IS_CANCELLED,type:"checkbox",listeners:{selectionchanged:{fn:this.setActivityState,scope:this}}});
this.isCanceledPath=new CQ.Ext.form.Hidden({name:CQ.wcm.msm.MSM.PARAM_STATUS+"/"+CQ.wcm.msm.MSM.PARAM_IS_CANCELLED_ON,value:""});
this.isCanceledText=new CQ.Ext.form.DisplayField({name:CQ.wcm.msm.MSM.PARAM_STATUS+"/"+CQ.wcm.msm.MSM.PARAM_IS_CANCELLED_ON,hidden:true});
this.rolloutConfigs=CQ.Util.build({xtype:"cqinclude",path:CQ.HTTP.externalize("/libs/wcm/msm/components/rolloutconfig/chooser.infinity.json")});
var c={stateful:false,title:CQ.I18n.getMessage("Live Copy"),extensionGet:".msm.json",extensionPost:".msm.conf",items:[{fieldLabel:CQ.I18n.getMessage("Live Copy from"),name:CQ.wcm.msm.MSM.PARAM_SOURCEPATH,readOnly:true,xtype:"textfield"},{fieldLabel:CQ.I18n.getMessage("Live Copy inheritance"),fieldDescription:CQ.I18n.getMessage("If checked Live Copy configuration is effective on all children"),name:CQ.wcm.msm.MSM.PARAM_IS_DEEP,type:"checkbox",xtype:"selection"},this.isCancelled,{hidden:true,fieldLabel:"&nbsp;",fieldDescription:CQ.I18n.getMessage("suspend for children pages"),name:CQ.wcm.msm.MSM.PARAM_STATUS+"/"+CQ.wcm.msm.MSM.PARAM_IS_CANCELLED_FOR_CHILDREN,type:"checkbox",xtype:"selection"},this.isCanceledText,this.actionConfigTextField,this.rolloutConfigs,this.isCanceledPath,this.isInheritedConfigField,this.isRootConfigField,this.isResetConfigField]};
CQ.Util.applyDefaults(a,c);
var b={trackLabels:true,type:"form"};
if(a.layout=="form"){a.layout=b
}else{if(a.layout&&a.layout.type=="form"){CQ.Util.merge(a.layout,{layout:b})
}}CQ.wcm.msm.LiveCopyProperties.superclass.constructor.call(this,a)
},initComponent:function(){CQ.wcm.msm.LiveCopyProperties.superclass.initComponent.call(this);
var a=this;
this.on("render",function(){this.parentDialog=this.findParentByType("dialog");
if(this.parentDialog){this.parentDialog.on("loadcontent",function(c){var b=CQ.WCM.getPage(this.path);
if(!b.isLiveCopy()){a.disable()
}},this.parentDialog)
}},this);
this.on("loadcontent",this.setActivityState,this)
},processRecords:function(b,a,c){CQ.wcm.msm.LiveCopyProperties.superclass.processRecords.call(this,b,a,c);
if(c&&b.length>0&&b[0].json){var g=b[0].json[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_SOURCE_EXISTING];
this.parentDialog.updateEnableInheritanceLockState(g)
}},computeUrlGET:function(a){this.path=a.lastIndexOf("/jcr:content")==a.length-12?a.substring(0,a.lastIndexOf("/jcr:content")):a;
if(this.pathGet||this.urlGET){this.urlGet=this.pathGet||this.urlGET
}else{this.urlGet=this.path
}if(this.extensionGet||this.urlExtensionGET){this.urlGet+=this.extensionGet||this.urlExtensionGET
}},resetConfig:function(){this.isResetConfigField.setValue(true);
var b=this.path;
if(!this.path){var a=this.findParentByType("dialog");
if(a){b=a.path
}}if(b){this.computeUrlPOST(b);
this.submitPanel(this.urlPOST)
}this.loadContent()
},setActivityState:function(){var b=this.find("name",CQ.wcm.msm.MSM.PARAM_STATUS+"/"+CQ.wcm.msm.MSM.PARAM_IS_CANCELLED_FOR_CHILDREN);
if(b.length){b=b[0]
}else{b=""
}var j=this.isCancelled&&"true"==this.isCancelled.getValue();
if(j){if(this.rolloutConfigs){this.rolloutConfigs.hide()
}this.actionConfigTextField.hide();
var c;
if(this.isCanceledPath){c=this.isCanceledPath.getValue()
}if(c&&c!=this.path){this.isCancelled.disable();
this.isCanceledText.setValue(CQ.I18n.getMessage('The Live Copy has been suspended on a parent Page.<br>No action will be performed on a Roll Out<br>You can enable the LiveCopy on the parent Page: [<a target="_blank" href="{0}.html">{1}</a>]',[c,c]));
if(b){b.hide()
}}else{this.isCanceledText.setValue(CQ.I18n.getMessage("The Live Copy has been suspended <br>No action will be performed on a Roll Out"));
if(b){b.show()
}}this.isCanceledText.show()
}else{if(b){b.hide()
}this.isCanceledText.hide();
var a=("true"==this.isInheritedConfigField.getValue());
var g=("true"==this.isRootConfigField.getValue());
var k="";
if(a){k+=CQ.I18n.getMessage("The sync configuration is inherited from a parent page. Changes made below will cancel the inheritance and store the configuration on the current page.")
}else{if(g){k+=CQ.I18n.getMessage("The sync configuration is stored on the current page, which is the root page of the Live Copy. Child pages of the current page inherit this configuration, unless they have configurations of their own.")
}else{var m=" var cmp = CQ.Ext.getCmp('"+this.id+"');";
m+=" cmp.resetConfig();";
k+=CQ.I18n.getMessage("The sync configuration is stored on the current page. You can {0} reset the configuration {1} in order to inherit the configuration from a parent page.",['<a href="#" onClick="'+m+'">',"</a>"])
}}k+="<p></p>";
k+=CQ.I18n.getMessage("Note: Disabled actions are inherited from the blueprint and cannot be modified.");
this.actionConfigTextField.updateHtml(k);
if(this.rolloutConfigs){this.rolloutConfigs.show()
}this.actionConfigTextField.show();
if(this.rolloutConfigs.label){this.rolloutConfigs.label.hide()
}}}});
CQ.Ext.reg("livecopyproperties",CQ.wcm.msm.LiveCopyProperties);
CQ.wcm.msm.RolloutWizard=CQ.Ext.extend(CQ.Dialog,{hideComponents:false,hideRolloutPlan:false,isBackground:false,constructor:function(j){var g=new Array();
g.push({text:CQ.I18n.getMessage("Rollout entire page"),value:"page"});
g.push({text:CQ.I18n.getMessage("Rollout page and all sub pages"),value:"deep"});
if(!j.hideComponents){g.push({text:CQ.I18n.getMessage("Rollout selected components"),value:"selected"});
g.push({text:CQ.I18n.getMessage("Delete + rollout selected components"),value:"delete"})
}this.rolloutType=new CQ.form.Selection({name:"type",cls:"x-form-field",fieldLabel:CQ.I18n.getMessage("Rollout Scope"),type:"radio",value:"page",options:g});
this.backgroundExec=new CQ.Ext.form.Checkbox({name:"background",cls:"x-form-field",fieldLabel:CQ.I18n.getMessage("Background rollout"),fieldDescription:CQ.I18n.getMessage("If checked, rollout is executed as a background task"),checked:j.isBackground});
var c=[this.rolloutType,this.backgroundExec];
var b;
if(j.hideRolloutPlan){this.formUrl="/bin/wcmcommand";
c.push(new CQ.Ext.form.Hidden({name:"cmd",value:"rollout"}));
if(CQ.Ext.isArray(j.path)){for(var k=0;
k<j.path.length;
k++){c.push(new CQ.Ext.form.Hidden({name:"path",value:j.path[k]}))
}}else{c.push(new CQ.Ext.form.Hidden({name:"path",value:j.path}))
}b={text:CQ.I18n.getMessage("Roll-out"),disabled:false,handler:function(m){if(this.backgroundExec&&this.backgroundExec.getValue()){this.addHidden({"sling:bg":true},1)
}this.ok(m)
}}
}else{b={text:CQ.I18n.getMessage("Next"),disabled:false,listeners:{click:{fn:CQ.wcm.msm.RolloutWizard.showRolloutPlan,scope:this}}}
}var a={title:CQ.I18n.getMessage("Rollout: {0}",j.path),formUrl:"/bin/wcmcommand",height:j.hideRolloutPlan?210:350,items:{xtype:"panel",layout:"form",items:c},buttons:[b,CQ.Dialog.CANCEL]};
j=CQ.Util.applyDefaults(j,a);
CQ.wcm.msm.RolloutWizard.superclass.constructor.call(this,j)
},initComponent:function(){CQ.wcm.msm.RolloutWizard.superclass.initComponent.call(this)
}});
CQ.wcm.msm.RolloutWizard.showRolloutPlan=function(){var c=this.rolloutType.getValue();
var b=this.backgroundExec.getValue();
var a=[];
if(c=="selected"||c=="delete"){var g=CQ.WCM.getContentWindow().CQ.WCM.getSelection();
g.each(function(){if(this.path&&this.path.charAt(this.path.length-1)!="*"){a.push(this.path)
}});
if(a.length==0){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Info"),CQ.I18n.getMessage("You have to select at least one component."));
return
}}var k={path:this.path,params:{type:c,paras:a}};
if(b){k.bgExecute=true
}var j=new CQ.wcm.msm.RolloutPlan(k);
j.show();
this.hide()
};
CQ.Ext.reg("rolloutwizard",CQ.wcm.msm.RolloutWizard);
CQ.wcm.msm.RolloutPlan=CQ.Ext.extend(CQ.Dialog,{maxSize:500,auditLogDialog:null,selectable:true,constructor:function(k){var g=CQ.I18n.getMessage("Current page will be rolled out to the following target pages. Check targets which should be updated and press the rollout button.");
if(k.params){if(k.params.type=="deep"){g=CQ.I18n.getMessage("Current page and all its child page will be rolled out to the following target pages. Check targets which should be updated and press the rollout button.")
}else{if(k.params.type=="selected"){g=CQ.I18n.getMessage("Selected components will be rolled out into the following target pages. Check targets which should be updated and press the rollout button.")
}else{if(k.params.type=="delete"){g=CQ.I18n.getMessage("Selected components will be deleted and rolled out into the following target pages. Check targets which should be updated and press the rollout button.")
}else{k.params.type="page"
}}}}else{k.params={type:"page"}
}this.rolloutType=new CQ.Static({text:g,bottommargin:true});
var m=new CQ.wcm.msm.RolloutPlan.CheckColumn({rolloutPath:k.path,name:"isTarget",header:"",dataIndex:"isTarget",width:20});
this.columnModel=new CQ.Ext.grid.ColumnModel([m,{id:CQ.wcm.msm.MSM.PARAM_LIVECOPY_PATH,header:CQ.I18n.getMessage("Live Copy Path"),dataIndex:CQ.wcm.msm.MSM.PARAM_LIVECOPY_PATH,width:220,renderer:function(r,q,o){var n=r;
if(r.lastIndexOf("/content")==0){n=r.substring(8)
}if(o.get(CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP)[CQ.wcm.msm.MSM.PARAM_SYNCPATH]){n+="<span style='color:#d6d6d6'>"+o.get(CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP)[CQ.wcm.msm.MSM.PARAM_SYNCPATH]+"</span>"
}return'<div title="Target Path: '+o.get(CQ.wcm.msm.MSM.PARAM_TARGETPATH)+'">'+n+"</div>"
}},{header:CQ.I18n.getMessage("Action"),dataIndex:"action",width:120,renderer:function(q,o,n){return"<div class='"+q.css+"' title='"+q.text+"' alt='"+q.text+"'>"+q.shortText+"</div>"
}},{header:"Status",dataIndex:"executionStatus",width:80,renderer:function(r,q,n){var o="";
var t="";
switch(r){case"ok":o="msm-rollout-plan-rolledout";
t=CQ.I18n.getMessage("Rollout successful");
break;
case"bg":o="msm-rollout-plan-rolloutbackground";
t=CQ.I18n.getMessage("Rollout started in background");
break;
case"rolling":o="msm-rollout-plan-rollingout";
t=CQ.I18n.getMessage("Executing rollout");
break;
case"error":o="msm-rollout-plan-rollouterror";
t=CQ.I18n.getMessage("Error during rollout");
break;
case"norollout":o="msm-rollout-plan-norollout";
t=CQ.I18n.getMessage("No rollout executed");
break;
default:o="";
t=CQ.I18n.getMessage("Press Rollout button to execute rollout process")
}return"<div class='"+o+"' title='"+t+"' alt='"+t+"'>&#160;</div>"
}}]);
this.columnModel.defaultSortable=true;
var j=CQ.HTTP.externalize(k.path)+".blueprint.json";
var b=new CQ.Ext.data.JsonStore({url:j,restful:true,totalProperty:"total",root:CQ.wcm.msm.MSM.PARAM_TARGETS,fields:[{name:"isTarget"},{name:"action"},{name:CQ.wcm.msm.MSM.PARAM_LIVECOPY_PATH,convert:function(n,o){return o[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP][CQ.wcm.msm.MSM.PARAM_LIVECOPY_PATH]
}},{name:CQ.wcm.msm.MSM.PARAM_TARGETPATH},{name:CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP}],sortInfo:{field:CQ.wcm.msm.MSM.PARAM_TARGETPATH,direction:"ASC"},baseParams:{maxSize:this.maxSize,advancedStatus:true,returnRelationships:true,"msm:trigger":"ROLLOUT"},paramNames:{limit:"maxSize"},listeners:{load:function(r,q,t){for(var u=0;
u<q.length;
u++){var n=q[u];
n.beginEdit();
var o=n.data[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP];
var w=CQ.wcm.msm.MSM.getRolloutInfo(o,k.path);
n.set("action",w);
var v=true;
if(o[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_CANCELLED_CHILD]){v=false
}n.set("isTarget",v);
n.commit()
}}}});
this.lcPathFilter=new CQ.Ext.form.TwinTriggerField({style:{marginLeft:"5px"},width:206,trigger1Class:"x-form-clear-trigger",trigger2Class:"x-form-search-trigger",hideTrigger1:true,enableKeyEvents:true,onTrigger1Click:function(){this.reset();
c.applyFilter(this,0)
},onTrigger2Click:function(){c.applyFilter(this,0)
},listeners:{render:function(){CQ.Ext.QuickTips.register({target:this.getEl(),title:CQ.I18n.getMessage("Live Copies path filter"),text:CQ.I18n.getMessage("Filter the Live Copy to display in the grid (by path substring)"),autoHide:true})
},specialkey:function(n,o){if(o.getKey()==o.ENTER){c.applyFilter(n,0)
}},keyup:function(n){c.applyFilter(n,3)
}},hideTrigger:false});
var c=this;
this.targetGrid=new CQ.Ext.grid.EditorGridPanel({store:b,cm:this.columnModel,width:600,height:200,autoExpandColumn:CQ.wcm.msm.MSM.PARAM_LIVECOPY_PATH,frame:false,tbar:{},listeners:{render:function(o){var n=o.getStore();
o.getTopToolbar().add(new CQ.Ext.form.Checkbox({checked:true,listeners:{render:function(){CQ.Ext.QuickTips.register({target:this.getEl(),title:CQ.I18n.getMessage("Select / unselect all"),autoHide:true})
},check:{fn:function(r,q){this.each(function(t){t.set("isTarget",q)
});
this.commitChanges()
},scope:n}}}));
o.getTopToolbar().add(c.lcPathFilter);
o.getTopToolbar().addButton([{xtype:"tbfill"},{xtype:"tbtext",text:CQ.I18n.getMessage("Trigger")+" : "},{text:"On Rollout",tooltip:{title:CQ.I18n.getMessage("List with onRollout Trigger"),autoHide:true},pressed:true,toggleGroup:"triggerFilter",enableToggle:true,toggleHandler:function(r,u){var t=this;
var q=new CQ.Ext.LoadMask(this.getEl(),{removeMask:true});
q.show();
var v={};
v[CQ.wcm.msm.MSM.PARAM_TRIGGER]=u?"ROLLOUT":"";
n.load({params:v,callback:function(){c.params[CQ.wcm.msm.MSM.PARAM_TRIGGER]=v[CQ.wcm.msm.MSM.PARAM_TRIGGER];
q.hide()
},scope:t})
},scope:c.targetGrid},{text:CQ.I18n.getMessage("All"),tooltip:{title:CQ.I18n.getMessage("List with any available Trigger"),autoHide:true},pressed:false,toggleGroup:"triggerFilter",enableToggle:true,scope:c.targetGrid}])
}}});
m.init(this.targetGrid);
var a={title:CQ.I18n.getMessage("Rollout: {0}",k.path),formUrl:CQ.shared.HTTP.externalize("/bin/wcmcommand"),params:{cmd:"rollout",_charset_:"utf-8",path:k.path},height:350,items:{xtype:"panel",layout:"form",items:[this.rolloutType,this.targetGrid]},buttons:[{text:CQ.I18n.getMessage("Audit log"),disabled:false,handler:function(o,n){if(c.auditLogDialog==null){c.auditLogDialog=CQ.WCM.getDialog("/libs/wcm/msm/content/auditlogdialog")
}c.auditLogDialog.loadContent("/bin/msm/audit.json");
c.auditLogDialog.show()
}},{text:CQ.I18n.getMessage("Rollout"),disabled:false,scope:c,handler:k.bgExecute?CQ.wcm.msm.RolloutPlan.rolloutBg:CQ.wcm.msm.RolloutPlan.rollout},CQ.Dialog.CANCEL]};
k=CQ.Util.applyDefaults(k,a);
CQ.wcm.msm.RolloutPlan.superclass.constructor.call(this,k)
},isBackgroundJobResponse:function(a){return !(CQ.HTTP.isOkStatus(a))
},getSelection:function(){var g=[];
var b=this.targetGrid.store.getRange();
for(var c=0;
c<b.length;
c++){var k=b[c];
var j=k.data.isTarget;
var a=k.data[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP];
if(j&&a[CQ.wcm.msm.MSM.PARAM_TRIGGER]!="never"&&!a[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_CANCELLED]){g.push(k)
}else{k.beginEdit();
k.set("executionStatus","norollout");
k.commit()
}}return g
},show:function(k,a,g){var j=CQ.wcm.msm.RolloutPlan.superclass.show.call(this,k,a,g);
var c=this.targetGrid.getStore();
var b=new CQ.Ext.LoadMask(this.getEl(),{removeMask:true});
b.show();
c.load({callback:function(){this.setSelectionMode(c.getTotalCount());
b.hide()
},scope:j});
return j
},setSelectionMode:function(a){if(a>this.maxSize){this.selectable=false;
this.targetGrid.getEl().mask(CQ.I18n.getMessage("All {0} LiveCpies will be rolled-out in background",a))
}else{this.selectable=true
}},applyFilter:function(c,a){var g=c.getValue();
var b=this.targetGrid.getStore();
if(!g){b.clearFilter();
c.getTrigger(0).hide()
}else{c.getTrigger(0).show();
if(g.length>a){b.filter(CQ.wcm.msm.MSM.PARAM_LIVECOPY_PATH,"/"+g,true)
}}},rolloutSelection:function(k){var n=this.getSelection();
for(var j=0;
j<n.length;
j++){var c=n[j];
var g=this.params;
g[CQ.wcm.msm.MSM.PARAM_TARGETPATH]=c.data[CQ.wcm.msm.MSM.PARAM_TARGETPATH];
c.beginEdit();
c.set("executionStatus","rolling");
c.endEdit();
var m=this;
var a=this.params.type=="delete";
var o=function(t,q,u,v){var r=this.record;
r.beginEdit();
if(CQ.utils.HTTP.isOk(v)){r.set("executionStatus","ok")
}else{if(!v.headers.Status&&CQ.utils.HTTP.isOkStatus(u.status)){r.set("executionStatus","bg")
}else{r.set("executionStatus","error");
CQ.Notification.notify(CQ.I18n.getMessage("Rollout failed: {0}",r.data[CQ.wcm.msm.MSM.PARAM_TARGETPATH],"{0} is a placeholder for additional error text"),u.status+" "+u.statusText)
}}r.commit();
if(m.targetGrid.store.findBy(function(w){return w.dirty
})<0){k.enable();
k.setText(CQ.I18n.getMessage("Close"));
k.setHandler(function(){m.close();
if(a){var w=CQ.HTTP.externalize(m.path+".html");
w=CQ.HTTP.noCaching(w);
CQ.Util.reload(CQ.WCM.getContentWindow(),w)
}})
}};
var b=this.formPanel.form.url;
CQ.utils.HTTP.post(b,o,g,{record:c},true)
}},rolloutAll:function(){var c=this.params;
c["sling:bg"]=true;
var b=this.params.type=="delete";
CQ.utils.HTTP.post(this.formPanel.form.url,null,c,{},true);
if(b){var a=CQ.HTTP.externalize(this.path+".html");
a=CQ.HTTP.noCaching(a);
CQ.Util.reload(CQ.WCM.getContentWindow(),a)
}this.close()
},rolloutSelectionBg:function(j){var o=[];
var m=this.getSelection();
for(var g=0;
g<m.length;
g++){var b=m[g];
o.push(b.data[CQ.wcm.msm.MSM.PARAM_TARGETPATH]);
b.beginEdit();
b.set("executionStatus","rolling");
b.endEdit()
}var c=this.params;
c[CQ.wcm.msm.MSM.PARAM_TARGETPATH]=o;
c["sling:bg"]=true;
var k=this;
var a=c.type=="delete";
var n=function(t,q,v,w){var r;
if(CQ.utils.HTTP.isOk(w)||(!w.headers.Status&&CQ.utils.HTTP.isOkStatus(v.status))){r="bg"
}else{r="error";
CQ.Notification.notify(CQ.I18n.getMessage("Rollout failed: {0}",calRec.data[CQ.wcm.msm.MSM.PARAM_TARGETPATH],"{0} is a placeholder for additional error text"),v.status+" "+v.statusText)
}for(g=0;
g<m.length;
g++){var u=m[g];
u.beginEdit();
u.set("executionStatus",r);
u.endEdit();
u.commit()
}j.enable();
j.setText(CQ.I18n.getMessage("Close"));
j.setHandler(function(){k.close();
if(a){var x=CQ.HTTP.externalize(k.path+".html");
x=CQ.HTTP.noCaching(x);
CQ.Util.reload(CQ.WCM.getContentWindow(),x)
}})
};
CQ.utils.HTTP.post(this.formPanel.form.url,n,c,{},true)
}});
CQ.Ext.reg("rolloutplan",CQ.wcm.msm.RolloutPlan);
CQ.wcm.msm.RolloutPlan.rollout=function(b,a){b.disable();
if(this.selectable){this.rolloutSelection(b)
}else{this.rolloutAll()
}};
CQ.wcm.msm.RolloutPlan.rolloutBg=function(b,a){b.disable();
if(this.selectable){this.rolloutSelectionBg(b)
}else{this.rolloutAll()
}};
CQ.wcm.msm.RolloutPlan.CheckColumn=function(a){CQ.Ext.apply(this,a);
if(!this.id){this.id=CQ.Ext.id()
}this.renderer=this.renderer.createDelegate(this)
};
CQ.wcm.msm.RolloutPlan.CheckColumn.prototype={init:function(a){this.grid=a;
this.grid.on("render",function(){var b=this.grid.getView();
b.mainBody.on("mousedown",this.onMouseDown,this)
},this)
},onMouseDown:function(g,c){if(c.className&&c.className.indexOf("x-grid3-cc-"+this.id)!=-1){g.stopEvent();
var b=this.grid.getView().findRowIndex(c);
var a=this.grid.store.getAt(b);
a.set(this.dataIndex,!a.data[this.dataIndex]);
a.commit()
}},renderer:function(g,c,a){if(g===""){var b=a.data[CQ.wcm.msm.MSM.PARAM_LIVE_RELATIONSHIP];
if(b[CQ.wcm.msm.MSM.PARAM_SOURCEPATH].indexOf(this.rolloutPath)!=0){return""
}if(b[CQ.wcm.msm.MSM.PARAM_TRIGGER]!="never"&&!b[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_CANCELLED]){if(b[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_MANUALLY_CREATED]||(b[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_SOURCE_EXISTING]&&!b[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_EXISTING]&&b[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_DELETED])){return""
}if(!g){return this.getCheckbox(false,c)
}else{return this.getCheckbox(true,c)
}}else{return""
}}else{return this.getCheckbox(g,c)
}},getCheckbox:function(b,a){a.css+=" x-grid3-check-col-td";
return"<div class='x-grid3-check-col"+(b?"-on":"")+" x-grid3-cc-"+this.id+"'>&#160;</div>"
}};
CQ.wcm.msm.BlueprintConfig=CQ.Ext.extend(CQ.CustomContentPanel,{hideTargets:false,displayLimit:7,constructor:function(b){b=(!b?{}:b);
var a=new Array();
if(!b.hideTargets){this.targets=new CQ.form.MultiField({fieldLabel:CQ.I18n.getMessage("Current Live Copies"),cls:"cq-currentlivecopies",name:"msm:targets",readOnly:"true",fieldConfig:{width:300}});
a.push(this.targets)
}a.push({xtype:"static",bottommargin:true,text:CQ.I18n.getMessage("Rollout configs can be configured on a blueprint: all Live Copies of this blueprint will inherit these configs.")});
a.push(CQ.Util.formatData({xtype:"cqinclude",path:CQ.HTTP.externalize("/libs/wcm/msm/components/rolloutconfig/chooser.infinity.json")}));
var c={stateful:false,extensionGet:".blueprint.json",extensionPost:".blueprint.conf",title:CQ.I18n.getMessage("Blueprint"),items:a};
CQ.Util.applyDefaults(b,c);
CQ.wcm.msm.BlueprintConfig.superclass.constructor.call(this,b)
},initComponent:function(){CQ.wcm.msm.BlueprintConfig.superclass.initComponent.call(this);
var a=this;
this.on("render",function(){this.parentDialog=this.findParentByType("dialog");
if(this.parentDialog){this.parentDialog.on("loadcontent",function(c){var b=CQ.WCM.getPage(this.path);
if(!b.isInBlueprint()){a.disable()
}},this.parentDialog)
}},this);
this.on("loadcontent",function(){if(!this.hideTargets&&this.targets.getValue().length==this.displayLimit){this.targets.addItem("...")
}})
},computeUrlGET:function(a){CQ.wcm.msm.BlueprintConfig.superclass.computeUrlGET.call(this,a);
if(this.urlGet){this.urlGet+="?maxSize="+this.displayLimit
}}});
CQ.Ext.reg("blueprintconfig",CQ.wcm.msm.BlueprintConfig);
CQ.wcm.msm.BlueprintStatus=CQ.Ext.extend(CQ.Ext.Panel,{url:null,rootPath:null,contextMenus:[],constructor:function(c){c=(!c?{}:c);
c=CQ.Util.applyDefaults(c,{url:"/libs/wcm/msm/content/commands/blueprintstatus.json",rootPath:"",defaultLCFilter:""});
this.url=c.url;
this.rootPath=c.rootPath;
this.lcMaxColumns=CQ.wcm.msm.BlueprintStatus.DEFAULT_MAX_VISIBLE_COLUMNS;
this.headerStore=this.getHeaderStore(this.url,this.rootPath,c.defaultLCFilter);
this.treeContainer=new CQ.Ext.Panel({region:"west",split:true,layout:"fit",collapsible:true,collapseMode:"mini",animate:true,hideCollapseTool:true,border:false,width:320});
var b=[CQ.wcm.msm.MSM.Texts.LR.States["msm-status-synchronized"],CQ.wcm.msm.MSM.Texts.LR.States["msm-status-synchronized-cancelled-par"],CQ.wcm.msm.MSM.Texts.LR.States["msm-status-src-modified"],CQ.wcm.msm.MSM.Texts.LR.States["msm-status-src-modified-cancelled-par"],CQ.wcm.msm.MSM.Texts.LR.States["msm-status-target-modified"],CQ.wcm.msm.MSM.Texts.LR.States["msm-status-target-modified-cancelled-par"],CQ.wcm.msm.MSM.Texts.LR.States["msm-status-cancelled"],CQ.wcm.msm.MSM.Texts.LR.States["msm-status-new"],CQ.wcm.msm.MSM.Texts.LR.States["msm-status-target-deleted"],CQ.wcm.msm.MSM.Texts.LR.States["msm-status-skipped"],CQ.wcm.msm.MSM.Texts.LR.States["msm-status-never-created"]];
this.gridContainer=new CQ.Ext.Panel({region:"center",layout:"fit",border:false,margins:"0 5 0 5"});
var a=new CQ.Ext.Template(['<div class="cq-blueprintstatus-legend-item">','<div class="cq-blueprintstatus-legend-item-icon {iconClass}"></div>','<div class="cq-blueprintstatus-legend-item-text">{text}</div>',"</div>"]);
var j=[];
for(var g=0;
g<b.length;
g++){j.push({xtype:"box",tpl:a,data:b[g]})
}this.legendContainer=new CQ.Ext.Panel({region:"east",layout:"table",layoutConfig:{columns:1},collapsible:true,collapsed:true,collapseMode:"mini",hideCollapseTool:true,split:true,border:false,width:320,title:CQ.I18n.getMessage("Legend"),items:j});
var k={layout:"border",height:600,width:1180,tree:{lines:true,border:false,borderWidth:CQ.Ext.isBorderBox?0:2,cls:"x-column-tree",stateful:false,rootVisible:false,autoScroll:true},grid:{border:false},items:[this.treeContainer,this.gridContainer,this.legendContainer]};
CQ.Util.applyDefaults(c,k);
CQ.wcm.msm.BlueprintStatus.superclass.constructor.call(this,c)
},getBPContextMenu:function(){if(!this.BPContextMenu){this.BPContextMenu=new CQ.Ext.menu.Menu({listeners:{beforeshow:function(a){a.items.each(function(b){b.setDisabled(false);
if(b.disableHandler&&b.disableHandler.call(b,a.data[0])){b.setDisabled(true)
}})
}},items:CQ.wcm.msm.BlueprintStatus.Commands.Menus.BPMenu});
this.contextMenus.push(this.BPContextMenu)
}return this.BPContextMenu
},getLCHeaderContextMenu:function(){if(!this.LCHeaderContextMenu){this.LCHeaderContextMenu=new CQ.Ext.menu.Menu({items:CQ.wcm.msm.BlueprintStatus.Commands.Menus.LCHeaderMenu});
this.contextMenus.push(this.LCHeaderContextMenu)
}return this.LCHeaderContextMenu
},getLCPageContextMenu:function(){if(!this.LCPageContextMenu){this.LCPageContextMenu=new CQ.Ext.menu.Menu({listeners:{beforeshow:function(a){a.items.each(function(c){if(c.disableHandler){for(var b=0;
b<a.data.length;
b++){if(c.disableHandler.call(c,a.data[b])){c.setDisabled(true);
return
}}c.setDisabled(false)
}})
}},items:CQ.wcm.msm.BlueprintStatus.Commands.Menus.LCPageMenu});
this.contextMenus.push(this.LCPageContextMenu)
}return this.LCPageContextMenu
},hideContextMenu:function(){for(var a=0;
a<this.contextMenus.length;
a++){this.contextMenus[a].data=null;
this.contextMenus[a].widget=null;
this.contextMenus[a].hide()
}},showContextMenu:function(c,m){this.hideContextMenu();
var b=1;
var k=2;
var j=4;
var a=0;
for(var g=0;
g<m.length;
g++){if(m[g]["lr"]){a|=b
}else{if(m[g]["lcPath"]){a|=k
}else{a|=j
}}}var n=null;
if(a==b){n=this.getLCPageContextMenu()
}else{if(a==k){n=this.getLCHeaderContextMenu()
}else{if(a==j){n=this.getBPContextMenu()
}}}if(n){n.data=m;
n.widget=this;
n.showAt(c)
}},getHeaderStore:function(a,b,c){a=CQ.HTTP.addParameter(a,"headers",true);
a=CQ.HTTP.addParameter(a,"rootPath",b);
a=CQ.HTTP.addParameter(a,"filter",c||"");
return new CQ.Ext.data.JsonStore({proxy:new CQ.Ext.data.HttpProxy({url:a}),fields:["path","name"]})
},getTree:function(){var b=new Array();
b.push(CQ.Util.applyDefaults({dataIndex:"page",width:300,renderer:function(c,j,k){var g='<div class="cq-msm-bpcell">';
g+=k.text;
g+="</div>";
return g
},listeners:{contextmenu:function(k,g,c){var j={};
j.srcPath=c.node["attributes"]["path"];
this.showContextMenu(k.getXY(),[j]);
k.stopEvent()
},scope:this}},this.initialConfig.treecolumn));
var a=this;
this.bpPathChooser=new CQ.form.PathField({name:"blueprintSource",width:280,value:this.rootPath,listeners:{render:function(){CQ.Ext.QuickTips.register({target:this.getEl(),title:CQ.I18n.getMessage("Blueprint path"),text:CQ.I18n.getMessage("Choose the Blueprint root path of the tree"),autoHide:true})
},specialkey:function(g,j){if(j.getKey()==j.ENTER){var c=a.bpPathChooser.getValue();
if(c&&c!=a.rootPath){a.reconfigure(c)
}}}}});
this.tree=new CQ.wcm.msm.BlueprintStatus.Tree(CQ.Util.applyDefaults({columns:b,url:this.url,rootFilter:this.rootFilter,rootPath:this.rootPath,listeners:{click:function(c){a.grid.reload(c.attributes.path)
}},tbar:[this.bpPathChooser,{iconCls:"cq-siteadmin-refresh",handler:function(){var c=this.bpPathChooser.getValue();
if(c&&c!=this.rootPath){this.reconfigure(c)
}else{this.tree.reload()
}},tooltip:{title:CQ.I18n.getMessage("Refresh tree"),text:CQ.I18n.getMessage("Refreshs the parent of the selected page"),autoHide:true},scope:a}]},this.initialConfig.tree));
return this.tree
},getGrid:function(b,q){b=b||"";
if(!q){q=CQ.wcm.msm.BlueprintStatus.DEFAULT_MAX_VISIBLE_COLUMNS
}var m=[CQ.Util.applyDefaults({header:"Page",dataIndex:"text",width:150})];
var o=["path","text"];
var v=0;
var j=this.headerStore.getRange();
if(j&&j.length>0){v=j.length;
for(var n=0;
n<j.length;
n++){var u=j[n].get("path");
o.push(u);
m.push(CQ.Util.applyDefaults({header:CQ.I18n.getMessage("{0}",j[n].get("name")),dataIndex:u,id:u,tooltip:u,width:25,hidden:n>=q,renderer:function(w){if(w){var y=CQ.wcm.msm.MSM.getRolloutInfo(w,u);
var x='<div class="cq-msm-lccell">';
x+=CQ.wcm.msm.MSM.getRelationStatus(w);
x+="</div>";
return x
}}},this.initialConfig.treecolumn))
}}var r=[];
var c=(b&&b!="");
var k=this;
this.lcPathFilter=new CQ.Ext.form.TriggerField({name:"lcFilter",width:280,value:b,listeners:{render:function(){CQ.Ext.QuickTips.register({target:this.getEl(),title:CQ.I18n.getMessage("Live Copies path filter"),text:CQ.I18n.getMessage("Filter the Live Copy to display in the grid (by path substring)"),autoHide:true})
},specialkey:function(w,x){if(x.getKey()==x.ENTER){k.checkGridReload()
}}},triggerClass:"x-form-clear-trigger",hideTrigger:!c,mimicBlur:function(w){if(this.wrap&&!this.wrap.contains(w.target)&&this.validateBlur(w)){this.triggerBlur()
}},onTriggerClick:function(){this.setValue("");
this.trigger.hide();
k.checkGridReload()
}});
r.push(this.lcPathFilter);
this.displayColumn=new CQ.Ext.form.Label({text:CQ.I18n.getMessage("Display only the first"),style:{"padding-left":"5px","padding-right":"5px"}});
this.lcMaxColumns=v<q?v:q;
this.lcMaxColumnsFilter=new CQ.Ext.form.TextField({name:"lcMaxColumnsFilter",width:20,value:this.lcMaxColumns,listeners:{render:function(){CQ.Ext.QuickTips.register({target:this.getEl().parent(),title:CQ.I18n.getMessage("Live Copies default display number"),text:CQ.I18n.getMessage("Display only the x first Live Copies in the grid (you can still add extra Live Copies with the column header menu)"),autoHide:true})
},specialkey:function(w,x){if(x.getKey()==x.ENTER){k.checkGridReload()
}}}});
this.totalColumn=new CQ.Ext.form.Label({text:CQ.I18n.getMessage("out of {0}",v),style:{"padding-left":"5px","padding-right":"5px"}});
if(v>CQ.wcm.msm.BlueprintStatus.DISPLAY_COLUMNS_NUMBER_FITLER){r.push(this.displayColumn);
r.push(this.lcMaxColumnsFilter);
r.push(this.totalColumn)
}r.push({iconCls:"cq-siteadmin-refresh",handler:function(){this.checkGridReload()
},tooltip:{title:CQ.I18n.getMessage("Refresh grid"),text:CQ.I18n.getMessage("Refreshs the relationship statuses of the grid based on the filters"),autoHide:true},scope:this});
r.push("->");
var t=this.legendContainer;
this.legendButton=new CQ.Ext.Button({text:CQ.I18n.getMessage("Legend"),enableToggle:true,pressed:!t.collapsed,expandHandler:function(){this.toggle(true)
},collapseHandler:function(){this.toggle(false)
},listeners:{toggle:function(w,x){if(x){t.expand(true)
}else{t.collapse(true)
}}},tooltip:{title:CQ.I18n.getMessage("Legend"),text:CQ.I18n.getMessage("Expands the legend panel"),autoHide:true}});
t.on("collapse",this.legendButton.collapseHandler,this.legendButton);
t.on("expand",this.legendButton.expandHandler,this.legendButton);
this.gridContainer.on("remove",function(){t.un("collapse",this.legendButton.collapseHandler,this.legendButton);
t.un("expand",this.legendButton.expandHandler,this.legendButton)
},this);
r.push(this.legendButton);
var u="";
var g=this.tree.getSelectionModel().getSelectedNode();
if(g&&g.attributes){u=g.attributes.path
}var a=new CQ.wcm.CustomCellSelectionModel();
this.grid=new CQ.Ext.grid.GridPanel(CQ.Util.applyDefaults({id:"cq-blueprintstatus-grid",height:350,cm:new CQ.Ext.grid.ColumnModel(m),sm:a,viewConfig:new CQ.Ext.grid.GridView({}),hasFilter:c,store:new CQ.Ext.data.Store({autoLoad:true,proxy:new CQ.Ext.data.HttpProxy({url:this.url,method:"GET"}),reader:new CQ.Ext.data.JsonReader({id:"path",fields:o}),baseParams:{rootPath:this.rootPath,filter:b,path:u}}),reload:function(x,w){this.getEl().mask("Loading...");
if(x){if(!this.store.baseParams){this.store.baseParams={}
}this.store.baseParams.path=x
}if(w){if(!this.store.baseParams){this.store.baseParams={}
}this.store.baseParams.filter=w
}this.store.reload({callback:function(){this.getEl().unmask()
},scope:this})
},listeners:{cellcontextmenu:function(x,H,K,E){var z=x.getSelectionModel();
if(!z.isSelected([H,K])){z.clearSelections();
z.selectCell([H,K])
}var I;
var A=k.tree.getSelectionModel().getSelectedNode();
if(A){I=A.attributes
}var y=z.getSelections();
var C=[];
for(var B=0;
B<y.length;
B++){var w=y[B][0];
var G=y[B][1];
var D=x.store.getAt(w);
var F={};
if(G>0){var J=x.getColumnModel().getColumnId(G);
F.lr=D.data[J];
F.srcPath=F.lr[CQ.wcm.msm.MSM.PARAM_SOURCEPATH];
F.targetPath=F.lr[CQ.wcm.msm.MSM.PARAM_TARGETPATH];
if(I){F.parentLr=I[J]
}}else{F.srcPath=D.data["path"]
}C.push(F)
}k.showContextMenu(E.getXY(),C);
E.stopEvent()
},headercontextmenu:function(x,w,z){var A=x.getColumnModel().getColumnId(w);
if(A==w){z.stopEvent();
return
}var y={};
y.lcPath=A;
k.showContextMenu(z.getXY(),y);
z.stopEvent()
}},columnFilter:b,tbar:r},this.initialConfig.grid));
this.grid.on("viewready",function(){var w=this.grid.getView();
CQ.Ext.fly(w.innerHd).un("click",w.handleHdDown,w);
CQ.Ext.fly(w.innerHd).on("click",function(C,A){if(CQ.Ext.fly(A).hasClass("x-grid3-hd-btn")){C.stopEvent();
var B=this.findHeaderCell(A);
CQ.Ext.fly(B).addClass("x-grid3-hd-menu-open");
var z=this.getCellIndex(B);
this.hdCtxIndex=z;
var y=this.hmenu.items,x=this.cm;
y.get("asc").setDisabled(!x.isSortable(z));
y.get("desc").setDisabled(!x.isSortable(z));
this.hmenu.on("hide",function(){CQ.Ext.fly(B).removeClass("x-grid3-hd-menu-open")
},this,{single:true});
if(z>0){this.hmenu.show(CQ.Ext.fly(A).parent().parent(),"tr")
}else{this.hmenu.show(A,"tl-bl?")
}}},w)
},this);
return this.grid
},checkGridReload:function(){var b=this.lcPathFilter.getValue();
var a=this.lcMaxColumnsFilter.getValue();
if(b!=this.grid.columnFilter){this.grid.columnFilter=b;
this.redrawGrid.defer(10,this,[b])
}else{if(a!=this.lcMaxColumns){this.redrawGrid.defer(10,this,[b,a])
}else{this.grid.reload(null,b)
}}},build:function(){this.treeContainer.add(this.getTree());
this.gridContainer.add(this.getGrid(this.initialConfig.defaultLCFilter));
this.doLayout()
},redrawGrid:function(b,a){b=b||this.grid.columnFilter;
this.gridContainer.getEl().mask();
this.gridContainer.remove(this.grid);
this.headerStore=this.getHeaderStore(this.url,this.rootPath,b);
this.headerStore.load({callback:function(){this.gridContainer.add(this.getGrid(b,a));
this.gridContainer.doLayout();
this.gridContainer.getEl().unmask()
},scope:this})
},reconfigure:function(a){this.rootPath=a;
this.tree.reconfigure(this.rootPath);
this.redrawGrid()
},initComponent:function(){CQ.wcm.msm.BlueprintStatus.superclass.initComponent.call(this);
this.on("render",function(){this.headerStore.load({callback:this.build,scope:this})
},this)
}});
CQ.Ext.reg("blueprintstatus",CQ.wcm.msm.BlueprintStatus);
CQ.wcm.msm.BlueprintStatus.Tree=CQ.Ext.extend(CQ.Ext.tree.TreePanel,{columns:null,constructor:function(a){a=(!a?{}:a);
var b={columns:a.columns,loader:this.buildLoader(a.url,a.rootPath),root:this.buildRootNode(a.rootPath)};
CQ.Util.applyDefaults(a,b);
CQ.wcm.msm.BlueprintStatus.Tree.superclass.constructor.call(this,a)
},buildRootNode:function(a){return new CQ.Ext.tree.AsyncTreeNode({expanded:true,name:a})
},buildLoader:function(a,b){return new CQ.Ext.tree.TreeLoader({dataUrl:a,baseParams:{isRoot:true,isTree:true,rootPath:b},requestMethod:"GET",baseAttrs:{singleClickExpand:true,iconCls:"cq-msm-page",uiProvider:CQ.wcm.msm.BlueprintStatus.ColumnNodeUI},listeners:{beforeload:function(c,g){if(!this.baseParams.isRoot){this.baseParams.path=g.attributes.path
}else{this.baseParams.path=this.baseParams.rootPath
}},load:function(){if(this.baseParams.isRoot){this.baseParams.isRoot=false
}}}})
},initComponent:function(){CQ.wcm.msm.BlueprintStatus.Tree.superclass.initComponent.call(this)
},reconfigure:function(a){this.loader.baseParams.rootPath=a;
this.loader.baseParams.path=a;
this.loader.baseParams.isRoot=true;
this.setRootNode(this.buildRootNode(a))
},setRootNode:function(b){CQ.Ext.destroy(this.root);
if(!b.render){b=this.loader.createNode(b)
}this.root=b;
b.ownerTree=this;
b.isRoot=true;
if(!b.childNodes){b.childNodes=[]
}this.registerNode(b);
if(!this.rootVisible){var a=b.attributes.uiProvider;
b.ui=a?new a(b):new CQ.Ext.tree.RootTreeNodeUI(b)
}if(this.innerCt){this.innerCt.update("");
this.root.render();
if(!this.rootVisible){this.root.renderChildren()
}}return b
},reload:function(){var c=this.getEl().parent();
c.mask("Loading...");
try{var g=this.getSelectionModel().getSelectedNode();
if(g){g=g.parentNode
}var a=this.getRootNode();
if(!g||g==a){if(a.firstChild){g=a.firstChild
}else{g=a
}}g.reload(function(){c.unmask()
},this)
}catch(b){c.unmask()
}}});
CQ.wcm.msm.BlueprintStatus.ColumnNodeUI=CQ.Ext.extend(CQ.Ext.tree.TreeNodeUI,{focus:CQ.Ext.emptyFn,renderElements:function(g,m,q,u){this.indentMarkup=g.parentNode?g.parentNode.ui.getChildIndent():"";
var v=g.getOwnerTree();
var t=v.columns;
var r=v.borderWidth;
var x=t[0];
var b=['<li class="x-tree-node"><div ext:tree-node-id="',g.id,'" class="x-tree-node-el x-tree-node-leaf ',m.cls,'">','<div class="x-tree-col" style="width:',x.width-r,'px;">','<span class="x-tree-node-indent">',this.indentMarkup,"</span>",'<img src="',this.emptyIcon,'" class="x-tree-ec-icon x-tree-elbow">','<img src="',m.icon||this.emptyIcon,'" class="x-tree-node-icon',(m.icon?" x-tree-node-inline-icon":""),(m.iconCls?" "+m.iconCls:""),'" unselectable="on">','<a hidefocus="on" class="x-tree-node-anchor" href="',m.href?m.href:"#",'" tabIndex="1" ',m.hrefTarget?' target="'+m.hrefTarget+'"':"",">",'<span unselectable="on">',(x.renderer?x.renderer(m[x.dataIndex],g,m):g.text?g.text:m[x.dataIndex]),"</span></a>","</div>"];
for(var k=1,o=t.length;
k<o;
k++){x=t[k];
b.push('<div class="x-tree-col ',(x.cls?x.cls:""),'" style="width:',x.width-r,'px;">','<div class="x-tree-col-text">',(x.renderer?x.renderer(m[x.dataIndex],g,m):m[x.dataIndex]),"</div>","</div>")
}b.push('<div class="x-clear"></div></div>','<ul class="x-tree-node-ct" style="display:none;"></ul>',"</li>");
if(u!==true&&g.nextSibling&&g.nextSibling.ui.getEl()){this.wrap=CQ.Ext.DomHelper.insertHtml("beforeBegin",g.nextSibling.ui.getEl(),b.join(""))
}else{this.wrap=CQ.Ext.DomHelper.insertHtml("beforeEnd",q,b.join(""))
}this.elNode=this.wrap.childNodes[0];
if(t[0]["listeners"]){var a=CQ.Ext.get(this.elNode);
var w=t[0]["listeners"]["scope"]||a;
for(var j in t[0]["listeners"]){if(j!="scope"){a.on(j,t[0]["listeners"][j],w,{column:t[0],data:m[t[0].dataIndex],node:g,tree:v,location:"node"})
}}}this.ctNode=this.wrap.childNodes[1];
var n=this.elNode.firstChild.childNodes;
this.indentNode=n[0];
this.ecNode=n[1];
this.iconNode=n[2];
this.anchor=n[3];
this.textNode=n[3].firstChild;
var y=this.elNode.firstChild.nextSibling;
for(var k=1,o=t.length;
y&&k<o;
k++){var c=CQ.Ext.get(y);
if(t[k]["listeners"]){var w=t[k]["listeners"]["scope"]||c;
for(var j in t[k]["listeners"]){if(j!="scope"){c.on(j,t[k]["listeners"][j],w,{column:t[k],data:m[t[k].dataIndex],node:g,tree:v,location:"node"})
}}}y=y.nextSibling
}}});
CQ.wcm.msm.BlueprintStatus.DEFAULT_MAX_VISIBLE_COLUMNS=22;
CQ.wcm.msm.BlueprintStatus.DISPLAY_COLUMNS_NUMBER_FITLER=9;
CQ.wcm.msm.BlueprintStatus.Commands={};
CQ.wcm.msm.BlueprintStatus.Commands.Menus={};
CQ.wcm.msm.BlueprintStatus.Commands.Menus.LCHeaderMenu=[{text:CQ.I18n.getMessage("Live Copy drill down"),handler:CQ.Ext.emptyFn}];
CQ.wcm.msm.BlueprintStatus.Commands.Menus.BPMenu=[{text:CQ.I18n.getMessage("Open page"),handler:function(b){var c=b.parentMenu.data;
for(var a=0;
a<c.length;
a++){var g=CQ.wcm.msm.MSM.filterPagePath(c[a]["srcPath"]);
if(g){CQ.wcm.SiteAdmin.openPage(g,"page",true)
}}}},{text:CQ.I18n.getMessage("Edit blueprint config"),handler:function(b){var c=b.parentMenu.data;
for(var a=0;
a<c.length;
a++){var g=c[a]["srcPath"];
if(g){CQ.wcm.msm.BlueprintStatus.Commands.openBlueprintDialog(g)
}}},disableHandler:function(b){if(b&&b.srcPath){var a=true;
$.ajax({type:"HEAD",async:false,url:b.srcPath+"/jcr:content.json",success:function(){a=false
}});
return a
}return false
}},{text:CQ.I18n.getMessage("Rollout"),handler:function(b){var c=b.parentMenu.data;
for(var a=0;
a<c.length;
a++){var g=CQ.wcm.msm.MSM.filterPagePath(c[a]["srcPath"]);
if(g){CQ.wcm.SiteAdmin.openRolloutDialog(g)
}}},iconCls:"cq-msm-menu-status-icon "+CQ.wcm.msm.MSM.Texts.LR.States["msm-status-synchronized"]["iconClass"]},"-",{text:CQ.I18n.getMessage("View server caches"),handler:function(){CQ.wcm.msm.BlueprintStatus.Commands.openCachesDialog()
}}];
CQ.wcm.msm.BlueprintStatus.Commands.Menus.LCPageMenu=[{text:CQ.I18n.getMessage("Open page"),handler:function(b){var c=b.parentMenu.data;
for(var a=0;
a<c.length;
a++){CQ.wcm.SiteAdmin.openPage(CQ.wcm.msm.MSM.filterPagePath(c[a]["targetPath"]),"page",true)
}},disableHandler:function(a){return !a.lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_EXISTING]
}},{text:CQ.I18n.getMessage("View relationship details"),handler:function(a){CQ.wcm.msm.BlueprintStatus.Commands.openLiveRelationshipsDialogs(CQ.wcm.msm.BlueprintStatus.Commands.dataToLRs(a.parentMenu.data),a.parentMenu.widget)
}},{text:CQ.I18n.getMessage("View side-by-side with Blueprint"),handler:function(c){var g=c.parentMenu.data;
for(var b=0;
b<g.length;
b++){var a=CQ.wcm.msm.MSM.filterPagePath(g[b]["targetPath"]);
a=CQ.HTTP.addParameter(a,CQ.wcm.ContentFinder.SIDEVIEW_PARAM,CQ.wcm.msm.MSM.filterPagePath(g[b]["srcPath"]));
CQ.wcm.SiteAdmin.openPage(a,"page",true)
}},disableHandler:function(a){return !a.lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_EXISTING]
}},{text:CQ.I18n.getMessage("Rollout"),handler:function(a){CQ.wcm.msm.BlueprintStatus.Commands.rolloutLiveCopy(a.parentMenu.widget.grid,a.parentMenu.data,a.parentMenu.widget.tree)
},disableHandler:function(a){return CQ.wcm.msm.BlueprintStatus.Commands.isOrphaned(a)||a.lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_MANUALLY_CREATED]||a.lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_DELETED]||a.lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_SKIPPED]
},iconCls:"cq-msm-menu-status-icon "+CQ.wcm.msm.MSM.Texts.LR.States["msm-status-synchronized"]["iconClass"]},"-",{text:CQ.I18n.getMessage("Re-create"),disabled:true,handler:function(a){CQ.wcm.msm.BlueprintStatus.Commands.recreateLiveCopy(a.parentMenu.widget.grid,CQ.wcm.msm.BlueprintStatus.Commands.dataToLRs(a.parentMenu.data))
},disableHandler:function(a){return a.lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_MANUALLY_CREATED]||a.lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_DELETED]||!a.lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_EXISTING]||a.lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_SKIPPED]
},iconCls:"cq-msm-menu-status-icon "+CQ.wcm.msm.MSM.Texts.LR.States["msm-status-synchronized"]["iconClass"]},{text:CQ.I18n.getMessage("Restore"),disabled:true,handler:function(a){CQ.wcm.msm.BlueprintStatus.Commands.restoreLiveCopy(a.parentMenu.widget.grid,CQ.wcm.msm.BlueprintStatus.Commands.dataToLRs(a.parentMenu.data))
},disableHandler:function(a){return !a.lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_DELETED]||a.lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_SKIPPED]
},iconCls:"cq-msm-menu-status-icon "+CQ.wcm.msm.MSM.Texts.LR.States["msm-status-synchronized"]["iconClass"]},{text:CQ.I18n.getMessage("Attach"),disabled:true,handler:function(a){CQ.wcm.msm.BlueprintStatus.Commands.attachLiveCopy(a.parentMenu.widget.grid,CQ.wcm.msm.BlueprintStatus.Commands.dataToLRs(a.parentMenu.data))
},disableHandler:function(a){return !(a.lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_MANUALLY_CREATED]&&a.lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_SOURCE_EXISTING]&&!a.lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_SKIPPED]&&a.parentLr&&a.parentLr[CQ.wcm.msm.MSM.PARAM_IS_DEEP])
},iconCls:"cq-msm-menu-status-icon "+CQ.wcm.msm.MSM.Texts.LR.States["msm-status-target-modified"]["iconClass"]},{text:CQ.I18n.getMessage("Detach"),disabled:true,handler:function(a){CQ.wcm.msm.BlueprintStatus.Commands.detachLiveCopy(a.parentMenu.widget.grid,CQ.wcm.msm.BlueprintStatus.Commands.dataToLRs(a.parentMenu.data))
},disableHandler:function(a){return !(!a.lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_MANUALLY_CREATED]&&a.lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_SOURCE_EXISTING]&&a.lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_EXISTING])||a.lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_SKIPPED]
},iconCls:"cq-msm-menu-status-icon "+CQ.wcm.msm.MSM.Texts.LR.States["msm-status-new"]["iconClass"]},{text:CQ.I18n.getMessage("Create LiveCopy"),disabled:true,handler:function(a){CQ.wcm.msm.BlueprintStatus.Commands.createLiveCopy(a.parentMenu.widget.grid,CQ.wcm.msm.BlueprintStatus.Commands.dataToLRs(a.parentMenu.data))
},disableHandler:function(a){return CQ.wcm.msm.BlueprintStatus.Commands.isOrphaned(a)||!a.lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_SKIPPED]||a.lr[CQ.wcm.msm.MSM.PARAM_IS_INHERITED_CONFIG]
},iconCls:"cq-msm-menu-status-icon "+CQ.wcm.msm.MSM.Texts.LR.States["msm-status-synchronized"]["iconClass"]},{text:CQ.I18n.getMessage("Skip"),disabled:true,handler:function(a){CQ.wcm.msm.BlueprintStatus.Commands.skipLiveCopy(a.parentMenu.widget.grid,CQ.wcm.msm.BlueprintStatus.Commands.dataToLRs(a.parentMenu.data),true)
},disableHandler:function(a){return CQ.wcm.msm.BlueprintStatus.Commands.isOrphaned(a)||!(!a.lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_MANUALLY_CREATED]&&a.lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_SOURCE_EXISTING]&&!a.lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_EXISTING]&&!a.lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_SKIPPED])
},iconCls:"cq-msm-menu-status-icon "+CQ.wcm.msm.MSM.Texts.LR.States["msm-status-skipped"]["iconClass"]},{text:CQ.I18n.getMessage("Unskip"),disabled:true,handler:function(a){CQ.wcm.msm.BlueprintStatus.Commands.unskipLiveCopy(a.parentMenu.widget.grid,CQ.wcm.msm.BlueprintStatus.Commands.dataToLRs(a.parentMenu.data),false)
},disableHandler:function(a){return !a.lr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_SKIPPED]||CQ.wcm.msm.BlueprintStatus.Commands.isOrphaned(a)||!a.lr[CQ.wcm.msm.MSM.PARAM_IS_INHERITED_CONFIG]
},iconCls:"cq-msm-menu-status-icon "+CQ.wcm.msm.MSM.Texts.LR.States["msm-status-never-created"]["iconClass"]}];
CQ.wcm.msm.BlueprintStatus.Commands.openLiveRelationshipDialog=function(j,n){if(j){var a=CQ.wcm.msm.MSM.filterPagePath(j[CQ.wcm.msm.MSM.PARAM_SOURCEPATH]);
var c=CQ.wcm.msm.MSM.filterPagePath(j[CQ.wcm.msm.MSM.PARAM_TARGETPATH]);
var m="/libs/wcm/msm/content/commands/liverelationshipstatus.json";
m=CQ.HTTP.addParameter(m,"srcPath",a);
m=CQ.HTTP.addParameter(m,"targetPath",c);
var g="/libs/wcm/msm/content/commands/livecopyinheritance.json";
g=CQ.HTTP.addParameter(g,"targetPath",c);
var q=[{collapsed:false,collapsible:true,title:CQ.I18n.getMessage("Blueprint and Live Copy pages"),xtype:"dialogfieldset",labelWidth:200,defaults:{readOnly:true},items:[{name:"srcPath",fieldLabel:CQ.I18n.getMessage("Blueprint path"),xtype:"textfield"},{name:"srcLastModified",fieldLabel:CQ.I18n.getMessage("Blueprint last modified"),xtype:"datetime"},{name:"srcLastModifiedBy",fieldLabel:CQ.I18n.getMessage("Blueprint last modified by"),xtype:"textfield"},{name:"targetPath",fieldLabel:CQ.I18n.getMessage("Live Copy path"),xtype:"textfield"},{name:"targetLastModified",fieldLabel:CQ.I18n.getMessage("Live Copy last modified"),xtype:"datetime"},{name:"targetLastModifiedBy",fieldLabel:CQ.I18n.getMessage("Live Copy last modified by"),xtype:"textfield"},{name:"lastRolledout",fieldLabel:CQ.I18n.getMessage("Last rolled out"),xtype:"datetime"},{name:"lastRolledoutBy",fieldLabel:CQ.I18n.getMessage("Last rolled out by"),xtype:"textfield"}]}];
if(j[CQ.wcm.msm.MSM.PARAM_STATUS]){var b=[];
for(var o in CQ.wcm.msm.MSM.Texts.LR.Statuses){b.push({name:"lr/"+CQ.wcm.msm.MSM.PARAM_STATUS+"/"+o,fieldLabel:CQ.wcm.msm.MSM.Texts.LR.Statuses[o],type:"checkbox",xtype:"selection",optionsConfig:{readOnly:true}})
}q.push({collapsed:true,collapsible:true,title:CQ.I18n.getMessage("Computed statuses"),xtype:"dialogfieldset",labelWidth:400,defaults:{readOnly:true},items:b})
}var k=new CQ.Dialog({width:600,height:500,warnIfModified:false,success:n,items:{xtype:"tabpanel",items:[{xtype:"customcontentpanel",stateful:false,executePost:false,pathGet:CQ.HTTP.externalize(m),title:CQ.I18n.getMessage("Relationship status"),defaults:{readOnly:true},submitPanel:function(){if(!this.disabled){var r=CQ.Util.findFormFields(this.formPanel);
for(var t in r){for(var u=0;
u<r[t].length;
u++){r[t][u].setDisabled(true)
}}}return true
},items:q},{title:CQ.I18n.getMessage("Livecopy"),xtype:"livecopyproperties"},{xtype:"customcontentpanel",stateful:false,executePost:false,pathGet:CQ.HTTP.externalize(g),title:CQ.I18n.getMessage("Live Copies inheritance"),defaults:{readOnly:true},submitPanel:function(){if(!this.disabled){var r=CQ.Util.findFormFields(this.formPanel);
for(var t in r){for(var u=0;
u<r[t].length;
u++){r[t][u].setValue()
}}}return true
},items:[{xtype:"textfield",name:"targetPath",fieldLabel:CQ.I18n.getMessage("Live Copy page")},{xtype:"multifield",name:"inheritance",fieldLabel:CQ.I18n.getMessage("Inherited from source page(s)"),fieldDescription:CQ.I18n.getMessage("Live Copy page inherits from the above page(s). Each of these pages is a Live Copy of following one."),defaults:{listeners:{afterlayout:function(r,t){if(t&&t.table){CQ.Ext.DomHelper.applyStyles(t.table,"width:100%")
}}}}}]}]},buttons:CQ.Dialog.OKCANCEL});
k.loadContent(c);
k.show()
}};
CQ.wcm.msm.BlueprintStatus.Commands.queues={};
CQ.wcm.msm.BlueprintStatus.Commands.createBulkMsgBox=function(a,o,j,g,c,m,n,b,r,q){if(!CQ.wcm.msm.BlueprintStatus.Commands.queues[j]){CQ.wcm.msm.BlueprintStatus.Commands.queues[j]=[]
}CQ.wcm.msm.BlueprintStatus.Commands.queues[j]=CQ.wcm.msm.BlueprintStatus.Commands.queues[j].concat(o);
var k=function(t){var u=CQ.wcm.msm.BlueprintStatus.Commands.queues[j].pop();
var x=CQ.wcm.msm.MSM.filterPagePath(u[CQ.wcm.msm.MSM.PARAM_TARGETPATH]);
var w=CQ.wcm.msm.MSM.filterPagePath(u[CQ.wcm.msm.MSM.PARAM_SOURCEPATH]);
a.getEl().mask(CQ.Util.patchText(r,[x]));
var v=function(A,C,B){var z=CQ.HTTP.buildPostResponseFromHTML(B.responseText);
var y=z.headers[CQ.utils.HTTP.HEADER_STATUS];
if(y!=200){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),z.headers[CQ.HTTP.HEADER_MESSAGE]);
a.getEl().unmask();
a.reload()
}else{if(CQ.wcm.msm.BlueprintStatus.Commands.queues[j].length>0){k.call(this,t)
}else{a.getEl().unmask();
a.reload();
if(q){var D=q.getSelectionModel().getSelectedNode();
if(!D){D=q
}D.reload()
}}}};
if(c==1){g.call(this,x,v)
}else{if(c==2){g.call(this,w,x,v)
}else{if(c==3){g.call(this,w,x,t,v)
}}}};
return CQ.Ext.Msg.show({title:n,msg:b,buttons:m,icon:CQ.Ext.MessageBox.QUESTION,fn:function(t){if(m.cancel){if(t=="cancel"){CQ.wcm.msm.BlueprintStatus.Commands.queues[j]=[]
}else{k.call(this,(t=="no"))
}}else{if(t=="no"){CQ.wcm.msm.BlueprintStatus.Commands.queues[j]=[]
}else{k.call(this,true)
}}},scope:this})
};
CQ.wcm.msm.BlueprintStatus.Commands.rolloutLiveCopy=function(b,c,a){var k=CQ.wcm.msm.BlueprintStatus.Commands.dataToLRs(c);
k=CQ.wcm.msm.BlueprintStatus.Commands.assertArray(k);
if(!k){return
}var g;
if(k.length==1){var j=CQ.wcm.msm.MSM.filterPagePath(k[0][CQ.wcm.msm.MSM.PARAM_TARGETPATH]);
g=CQ.I18n.getMessage("Do you want to rollout page {0} only or page and its sub pages?",[j])
}else{g=CQ.I18n.getMessage("Do you want to rollout selected pages only or pages and their sub pages?")
}CQ.wcm.msm.BlueprintStatus.Commands.createBulkMsgBox(b,k,"rollout",CQ.wcm.msm.MSM.Commands.rolloutLiveCopy,3,{yes:CQ.I18n.getMessage("Page only"),no:CQ.I18n.getMessage("Page and sub pages"),cancel:true},CQ.I18n.getMessage("Rollout Live Copy"),g,CQ.I18n.getMessage("Rolling out {0}",null,"{0} is a placeholder for a content path"),a)
};
CQ.wcm.msm.BlueprintStatus.Commands.recreateLiveCopy=function(a,g){g=CQ.wcm.msm.BlueprintStatus.Commands.assertArray(g);
if(!g){return
}var b;
if(g.length==1){var c=CQ.wcm.msm.MSM.filterPagePath(g[0][CQ.wcm.msm.MSM.PARAM_TARGETPATH]);
b=CQ.I18n.getMessage("Are you sure you want to re-create page {0} and its sub pages? Re-creation process will run a rollout with reset option. Warning: all local modifications on Live Copy pages will be lost.",[c])
}else{b=CQ.I18n.getMessage("Are you sure you want to re-create selected pages and their sub pages? Re-creation process will run a rollout with reset option. Warning: all local modifications on Live Copy pages will be lost.")
}CQ.wcm.msm.BlueprintStatus.Commands.createBulkMsgBox(a,g,"recreate",CQ.wcm.msm.MSM.Commands.resetLiveCopy,3,CQ.Ext.MessageBox.YESNO,CQ.I18n.getMessage("Recreate Live Copy"),b,CQ.I18n.getMessage("Recreating {0}",null,"{0} is a placeholder for a content path"))
};
CQ.wcm.msm.BlueprintStatus.Commands.restoreLiveCopy=function(a,g){g=CQ.wcm.msm.BlueprintStatus.Commands.assertArray(g);
if(!g){return
}var b;
if(g.length==1){var c=CQ.wcm.msm.MSM.filterPagePath(g[0][CQ.wcm.msm.MSM.PARAM_TARGETPATH]);
b=CQ.I18n.getMessage("Do you want to restore page {0} only or page and its sub pages?",[c])
}else{b=CQ.I18n.getMessage("Do you want to restore selected pages only or pages and their sub pages?")
}CQ.wcm.msm.BlueprintStatus.Commands.createBulkMsgBox(a,g,"restore",CQ.wcm.msm.MSM.Commands.resetLiveCopy,3,{yes:CQ.I18n.getMessage("Page only"),no:CQ.I18n.getMessage("Page and sub pages"),cancel:true},CQ.I18n.getMessage("Restore Live Copy"),b,CQ.I18n.getMessage("Restoring {0}",null,"{0} is a placeholder for a content path"))
};
CQ.wcm.msm.BlueprintStatus.Commands.attachLiveCopy=function(a,g){g=CQ.wcm.msm.BlueprintStatus.Commands.assertArray(g);
if(!g){return
}var b;
if(g.length==1){var c=CQ.wcm.msm.MSM.filterPagePath(g[0][CQ.wcm.msm.MSM.PARAM_TARGETPATH]);
b=CQ.I18n.getMessage("Do you want to attach page {0} only or page and its sub pages to their corresponding Blueprint pages ? Attachment process will NOT delete or modify any existing content. A rollout is needed afterward.",[c])
}else{b=CQ.I18n.getMessage("Do you want to attach selected pages only or page and their sub pages to their corresponding Blueprint pages ? Attachment process will NOT delete or modify any existing content. A rollout is needed afterward.")
}CQ.wcm.msm.BlueprintStatus.Commands.createBulkMsgBox(a,g,"attach",CQ.wcm.msm.MSM.Commands.attachLiveCopy,3,{yes:CQ.I18n.getMessage("Page only"),no:CQ.I18n.getMessage("Page and sub pages"),cancel:true},CQ.I18n.getMessage("Attach Live Copy"),b,CQ.I18n.getMessage("Attaching {0}",null,"{0} is a placeholder for a content path"))
};
CQ.wcm.msm.BlueprintStatus.Commands.detachLiveCopy=function(a,g){g=CQ.wcm.msm.BlueprintStatus.Commands.assertArray(g);
if(!g){return
}var b;
if(g.length==1){var c=CQ.wcm.msm.MSM.filterPagePath(g[0][CQ.wcm.msm.MSM.PARAM_TARGETPATH]);
b=CQ.I18n.getMessage("Are you sure you want to detach page {0} and its sub pages from their Blueprint pages and create a standalone copy?",[c])
}else{b=CQ.I18n.getMessage("Are you sure you want to detach selected pages and their sub pages from their Blueprint pages and create standalone copies?")
}CQ.wcm.msm.BlueprintStatus.Commands.createBulkMsgBox(a,g,"detach",CQ.wcm.msm.MSM.Commands.detachLiveCopy,1,CQ.Ext.MessageBox.YESNO,CQ.I18n.getMessage("Detach Live Copy"),b,CQ.I18n.getMessage("Detaching {0}",null,"{0} is a placeholder for a content path"))
};
CQ.wcm.msm.BlueprintStatus.Commands.skipLiveCopy=function(a,g){g=CQ.wcm.msm.BlueprintStatus.Commands.assertArray(g);
if(!g){return
}var b;
if(g.length==1){var c=CQ.wcm.msm.MSM.filterPagePath(g[0][CQ.wcm.msm.MSM.PARAM_TARGETPATH]);
b=CQ.I18n.getMessage("Are you sure you want to skip page {0} and its sub pages? Pages will be excluded from the rollout process.",[c])
}else{b=CQ.I18n.getMessage("Are you sure you want to skip selected pages and their sub pages? Pages will be excluded from the rollout process.")
}CQ.wcm.msm.BlueprintStatus.Commands.createBulkMsgBox(a,g,"skip",CQ.wcm.msm.MSM.Commands.skipLiveCopy,1,CQ.Ext.MessageBox.YESNO,CQ.I18n.getMessage("Skip Live Copy"),b,CQ.I18n.getMessage("Skipping {0}",null,"{0} is a placeholder for a content path"))
};
CQ.wcm.msm.BlueprintStatus.Commands.unskipLiveCopy=function(a,g){g=CQ.wcm.msm.BlueprintStatus.Commands.assertArray(g);
if(!g){return
}var b;
if(g.length==1){var c=CQ.wcm.msm.MSM.filterPagePath(g[0][CQ.wcm.msm.MSM.PARAM_TARGETPATH]);
b=CQ.I18n.getMessage("Are you sure you want to re-integrate page {0} and its sub pages to the rollout process?",[c])
}else{b=CQ.I18n.getMessage("Are you sure you want to re-integrate selected pages and its sub pages to the rollout process?")
}CQ.wcm.msm.BlueprintStatus.Commands.createBulkMsgBox(a,g,"unskip",CQ.wcm.msm.MSM.Commands.unskipLiveCopy,1,CQ.Ext.MessageBox.YESNO,CQ.I18n.getMessage("Unskip Live Copy"),b,CQ.I18n.getMessage("Unskipping {0}",null,"{0} is a placeholder for a content path"))
};
CQ.wcm.msm.BlueprintStatus.Commands.createLiveCopy=function(b,j){j=CQ.wcm.msm.BlueprintStatus.Commands.assertArray(j);
if(!j){return
}var a=function(m,n,o){if(n&&n.indexOf("/")>-1){var k=n.lastIndexOf("/");
CQ.wcm.msm.MSM.Commands.createLiveCopy(m,n.substring(0,k),"",n.substring(k+1),false,null,o)
}};
var c;
if(j.length==1){var g=CQ.wcm.msm.MSM.filterPagePath(j[0][CQ.wcm.msm.MSM.PARAM_TARGETPATH]);
c=CQ.I18n.getMessage("Are you sure you want to re-integrate page {0} and its sub pages to the rollout process?",[g])
}else{c=CQ.I18n.getMessage("Are you sure you want to re-integrate selected pages and its sub pages to the rollout process?")
}CQ.wcm.msm.BlueprintStatus.Commands.createBulkMsgBox(b,j,"create",a,2,CQ.Ext.MessageBox.YESNO,CQ.I18n.getMessage("Creating LiveCopy"),c,CQ.I18n.getMessage("Creating LiveCopy at {0}",null,"{0} is a placeholder for a content path"))
};
CQ.wcm.msm.BlueprintStatus.Commands.openBlueprintDialog=function(b){var a=new CQ.Dialog({height:480,warnIfModified:false,items:{xtype:"tabpanel",items:[{hideTargets:true,title:"Blueprint",xtype:"blueprintconfig"}]},buttons:CQ.Dialog.OKCANCEL});
if(b.lastIndexOf("/jcr:content")<b.length-11){b+="/jcr:content"
}a.loadContent(b);
a.show()
};
CQ.wcm.msm.BlueprintStatus.Commands.openCachesDialog=function(){var a=null;
var b=function(){a.body.mask("Loading...");
a.loadContent(CQ.HTTP.externalize("/libs/wcm/msm/content/commands/servercaches"))
};
a=new CQ.Dialog({title:CQ.I18n.getMessage("Server caches"),warnIfModified:false,items:{xtype:"panel",items:[{collapsed:true,collapsible:true,title:CQ.I18n.getMessage("Live Copies cache"),xtype:"dialogfieldset",items:[{name:"livecopiesCacheSize",xtype:"hidden",listeners:{loadcontent:function(){var c=this.getValue();
var g=CQ.I18n.getMessage("Live Copies cache (size {0})",[c||0]);
this.findParentByType("dialogfieldset").setTitle(g)
}}},{name:"livecopiesCache",readOnly:true,xtype:"multifield",hideLabel:true,defaults:{listeners:{afterlayout:function(c,g){if(g&&g.table){CQ.Ext.DomHelper.applyStyles(g.table,"width:100%")
}}}}}]}]},buttons:[{text:CQ.I18n.getMessage("Flush caches"),handler:function(){CQ.wcm.msm.MSM.Commands.flushServerCaches();
b.call(this)
}},{text:CQ.I18n.getMessage("Close"),handler:function(){a.hide()
}}]});
a.show();
a.on("loadcontent",function(){a.body.unmask()
});
b.call(this)
};
CQ.wcm.msm.BlueprintStatus.Commands.openLiveRelationshipsDialogs=function(j,c){if(!j||j.length==0){return
}if(!CQ.Ext.isArray(j)){j=[j]
}for(var g=0;
g<j.length;
g++){var b=j[g];
var a=function(){c.checkGridReload()
};
CQ.wcm.msm.BlueprintStatus.Commands.openLiveRelationshipDialog(b,a)
}};
CQ.wcm.msm.BlueprintStatus.Commands.dataToLRs=function(c){var a=[];
for(var b=0;
b<c.length;
b++){if(c[b]["lr"]){a.push(c[b]["lr"])
}}return a
};
CQ.wcm.msm.BlueprintStatus.Commands.isOrphaned=function(a){return a.parentLr&&!a.parentLr[CQ.wcm.msm.MSM.PARAM_STATUS][CQ.wcm.msm.MSM.PARAM_IS_TARGET_EXISTING]
};
CQ.wcm.msm.BlueprintStatus.Commands.assertArray=function(a){if(a&&a.length>0){if(!CQ.Ext.isArray(a)){a=[a]
}return a
}return null
};
CQ.wcm.msm.TriggerSelection=CQ.Ext.extend(CQ.Ext.form.ComboBox,{constructor:function(a){a=(!a?{}:a);
a=CQ.Util.applyDefaults(a,{stateful:false,fieldLabel:CQ.I18n.getMessage("Sync Trigger"),allowBlank:false,defaultValue:"rollout",value:"rollout",name:"trigger",cls:"cq-msm-synctrigger",hiddenName:"msm:trigger",displayField:"label",valueField:"id",typeAhead:true,mode:"local",triggerAction:"all",store:new CQ.Ext.data.SimpleStore({fields:["id","label"],data:[["rollout",CQ.I18n.getMessage("On Rollout")],["modification",CQ.I18n.getMessage("On Modification")],["publish",CQ.I18n.getMessage("On Activation")],["deactivate",CQ.I18n.getMessage("On Deactivation")]]})});
CQ.wcm.msm.TriggerSelection.superclass.constructor.call(this,a)
}});
CQ.Ext.reg("triggerselection",CQ.wcm.msm.TriggerSelection);
CQ.wcm.msm.AuditLogDialog=CQ.Ext.extend(CQ.Dialog,{store:null,constructor:function(c){this.debug=c.debug;
var a=new CQ.Ext.grid.ColumnModel([{header:CQ.I18n.getMessage("Date"),dataIndex:"time",width:"150"},{header:CQ.I18n.getMessage("Target",null,"Target location"),dataIndex:"target",width:"200"},{header:CQ.I18n.getMessage("Action"),dataIndex:"operation"},{header:CQ.I18n.getMessage("Exception"),dataIndex:"exceptionMessage"},{header:CQ.I18n.getMessage("User"),dataIndex:"user"}]);
var k=new CQ.Ext.grid.RowSelectionModel({singleSelect:true});
var j={autoLoad:false,proxy:new CQ.Ext.data.HttpProxy({url:"/bin/msm/audit.json",method:"GET"}),baseParams:{start:0,limit:25},reader:new CQ.Ext.data.JsonReader({totalProperty:"results",root:"entries",fields:["path","time","target","exceptionMessage","user","operation"]})};
this.store=new CQ.Ext.data.GroupingStore(j);
var g={xtype:"grid",region:"center",margins:"5 5 5 5",loadMask:true,stripeRows:true,cm:a,sm:k,viewConfig:new CQ.Ext.grid.GroupingView({forceFit:true}),store:this.store};
var b=new CQ.Ext.Panel({layout:"border",width:500,minHeight:500,statefull:false,items:[g]});
dialog=this;
c.items=[b];
c.buttons=[{tooltip:CQ.I18n.getMessage("Refresh"),tooltipType:"title",iconCls:"cq-siteadmin-refresh",handler:function(){dialog.store.reload()
}},{text:CQ.I18n.getMessage("OK"),handler:function(){dialog.hide()
}}];
CQ.wcm.AuditLogDialog.superclass.constructor.call(this,c)
},loadContent:function(a){this.setTitle(CQ.I18n.getMessage("MSM audit log"));
this.store.baseParams.path=a;
this.store.reload()
},initComponent:function(){CQ.wcm.AuditLogDialog.superclass.initComponent.call(this)
}});
CQ.Ext.reg("MSMauditlogdialog",CQ.wcm.msm.AuditLogDialog);
CQ.wcm.Launches={};
CQ.wcm.Launches.getLaunches=function(j){var a=new CQ.Ext.data.JsonReader({root:"pages",fields:CQ.wcm.Launches.LAUNCHES_LIST_FIELDS});
var b=CQ.HTTP.noCaching(j+".launches.json");
var c=CQ.WCM.getPageInfo(j);
var g=a.read(CQ.HTTP.get(CQ.shared.HTTP.externalize(b)));
return g.records
};
CQ.wcm.Launches.LAUNCHES_LIST_FIELDS=[{name:"title"},{name:"label"},{name:"launchPath"},{name:"escapedLaunchPath"},{name:"pagePath"},{name:"escapedPagePath"},{name:"isCurrent"},{name:"jcr:lastModified"},{name:"jcr:lastModifiedBy"}];
CQ.wcm.SiteAdmin.createLaunch=function(c){var a;
try{a=this.getCurrentPath()
}catch(j){}var b=CQ.WCM.getDialog(CQ.wcm.Launches.Commands.getCreateLaunchDialogConfig(a));
var g=c.scope||CQ.Ext.getCmp(window.CQ_SiteAdmin_id);
b.on("beforesubmit",function(){if(g.mask){g.mask()
}});
b.success=function(m,k){if(g.unmask){g.unmask()
}if(g.xtype==="launchadmingrid"){g.store.reload()
}};
b.failure=function(m,k){if(g.unmask){g.unmask()
}CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not create launch: {0}",[k.result["Message"]]))
};
b.show()
};
CQ.wcm.Launches.Commands={};
CQ.wcm.Launches.Commands.getCreateLaunchDialogConfig=function(b){var a=new Date();
return{xtype:"dialog",id:CQ.Util.createId("cq-launches-dialog"),title:CQ.I18n.getMessage("Create Launch"),formUrl:"/bin/wcmcommand",params:{cmd:"createLaunch",_charset_:"utf-8"},height:400,items:{xtype:"panel",items:[{fieldLabel:CQ.I18n.getMessage("Launch Title"),name:"title",xtype:"textfield",allowBlank:false,fieldDescription:CQ.I18n.getMessage("Provide a name for your launch.")},{fieldLabel:CQ.I18n.getMessage("Source Page"),name:"srcPath",value:b,xtype:"pathfield",allowBlank:false},{boxLabel:CQ.I18n.getMessage("Exclude sub pages"),xtype:"selection",type:"checkbox",value:false,name:"shallow",fieldDescription:CQ.I18n.getMessage("Sub pages of selected source page will not be copied.")},{boxLabel:CQ.I18n.getMessage("Keep in sync"),xtype:"selection",type:"checkbox",value:true,name:"isLiveCopy",fieldDescription:CQ.I18n.getMessage("Make the launch a live copy so every update of the source page will automatically be kept in sync with the corresponding launch page.")},{fieldLabel:CQ.I18n.getMessage("Launch Date"),name:"liveDate",xtype:"datetime",dateConfig:{minValue:a},fieldDescription:CQ.I18n.getMessage("Targeted live date for the launch, which will not be promoted automatically once the date is reached.")}]},buttons:CQ.Dialog.OKCANCEL,okText:CQ.I18n.getMessage("Create")}
};
CQ.Ext.override(CQ.wcm.Sidekick,{setProductionReady:function(b,a,c){if(!b){return
}CQ.HTTP.post(CQ.shared.HTTP.externalize(b+"/_jcr_content"),c,{_charset_:"utf-8",isProductionReady:a})
},getProductionReadyConfig:function(b){var a=this;
var g=a.path;
b=b||CQ.WCM.getPage(g);
var c=b.isLaunch();
if(c){a.isProductionReady=b.launches.launch.isProductionReady
}return{name:CQ.wcm.Sidekick.PRODUCTION_READY,hidden:!b.isLaunch(),text:a.isProductionReady?a.unmarkProductionReadyText:a.markProductionReadyText,handler:function(){var k=!a.isProductionReady;
var j=a.buttons[CQ.wcm.Sidekick.PRODUCTION_READY];
j.ignoreClicks=true;
a.setProductionReady(b.launches.launch.path,k,function(n,o,m){if(o){a.isProductionReady=k;
j.setText(a.isProductionReady?a.unmarkProductionReadyText:a.markProductionReadyText);
$CQ(".cq-sk-launchesstatus-productionready").removeClass("cq-sk-launchesstatus-productionready-"+(a.isProductionReady?"off":"on")).addClass("cq-sk-launchesstatus-productionready-"+(a.isProductionReady?"on":"off")).attr("title",a.isProductionReady?a.productionReadyText:a.productionNotReadyText);
CQ.Notification.notify(CQ.I18n.getMessage("Launch Status"),k?a.productionReadyText:a.productionNotReadyText)
}else{CQ.Notification.notifyFromResponse(m)
}j.ignoreClicks=false
})
},context:[CQ.wcm.Sidekick.PAGE]}
},getLaunchesTabpanelFooter:function(){var a=this;
var b=CQ.WCM.getPageInfo(CQ.WCM.getPagePath());
if(b.launches&&b.launches.isLaunch){return'<table class="cq-sk-launchesstatus"><tr><td rowspan="2"><div class="cq-sk-launchesstatus-productionready cq-sk-launchesstatus-productionready-'+(b.launches.launch.isProductionReady?"on":"off")+'" title="'+(b.launches.launch.isProductionReady?a.productionReadyText:a.productionNotReadyText)+'">&nbsp</div></td><td nowrap><span>'+CQ.I18n.getMessage("<b>Launch:</b> {0}",[b.launches.launch.title])+"</span></td></tr><tr><td nowrap><span>"+CQ.I18n.getMessage("{0} ({1})",[CQ.wcm.SiteAdmin.formatRelativeDate(b.launches.launch["cq:lastModified"]),b.launches.launch["cq:lastModifiedBy"]])+"</span></td></tr></table>"
}return""
},getLaunchesPanelConfig:function(b){var a=CQ.wcm.Sidekick.findSidekick(this);
a.launchesGrid=new CQ.wcm.Sidekick.Launches.GridPanel();
return{title:CQ.I18n.getMessage("Launches"),collapsed:!b,layout:"form",cls:"cq-sidekick-form",listeners:{activate:function(){a.refreshLaunchesList.call(a,b)
}},items:[{xtype:"panel",layout:"column",border:false,defaults:{border:false,autoScroll:true},items:[{xtype:"button",hidden:true,text:CQ.I18n.getMessage("View"),handler:function(){}},{xtype:"button",text:CQ.I18n.getMessage("Switch"),handler:function(k,c){var m=a.launchesGrid.getSelectionModel().getSelected();
if(!m){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Info"),CQ.I18n.getMessage("Please select a version first."));
return
}var j=m.data.pagePath;
var g=CQ.shared.HTTP.getXhrHookedURL(CQ.HTTP.externalize(j)+".html");
CQ.Util.reload(CQ.WCM.getContentWindow(),g)
}},{xtype:"button",id:"cq-launches-reload-button",iconCls:"cq-launches-reload-icon",tooltip:{title:CQ.I18n.getMessage("Refresh"),text:CQ.I18n.getMessage("Refresh the list of launches"),autoHide:true},handler:function(){a.refreshLaunchesList.call(a,b)
}}]},{xtype:"panel",border:false,style:"border-top-width:1px",items:a.launchesGrid}]}
},refreshLaunchesList:function(b){var a=CQ.wcm.Sidekick.findSidekick(this);
a.launchesGrid.loadLaunches(this.getPath());
if(b){a.launchesGrid.on("render",function(c){c.el.mask()
})
}}});
CQ.wcm.Sidekick.Launches={};
CQ.wcm.Sidekick.Launches.LABEL_PRODUCTION=":production";
CQ.wcm.Sidekick.Launches.GridPanel=CQ.Ext.extend(CQ.Ext.grid.GridPanel,{listConfig:{},constructor:function(a){this.listConfig=CQ.Util.applyDefaults(a,{id:"cq-launches-gridpanel",border:false,width:"auto",autoHeight:true,loadMask:true,stripeRows:true,autoExpandColumn:"lastModified",viewConfig:{getRowClass:function(b,c){var g="";
if(b.data.isCurrent){g+=" x-grid3-row-current"
}return g
}},enableHdMenu:true});
CQ.wcm.Sidekick.Launches.GridPanel.superclass.constructor.call(this,a)
},initComponent:function(){var b=new CQ.Ext.data.SimpleStore({fields:CQ.wcm.Launches.LAUNCHES_LIST_FIELDS});
var c=new CQ.Ext.grid.CheckboxSelectionModel({singleSelect:true});
var a=new CQ.Ext.grid.ColumnModel([c,{header:CQ.I18n.getMessage("Name"),dataIndex:"title",sortable:false,width:80},{id:"lastModified",header:CQ.I18n.getMessage("Last Local Modification"),dataIndex:"jcr:lastModified",sortable:false,renderer:this.dateRenderer}]);
CQ.Ext.apply(this,{store:b,cm:a,sm:c},this.listConfig);
CQ.wcm.Sidekick.Launches.GridPanel.superclass.initComponent.call(this)
},loadLaunches:function(j){var a=CQ.wcm.Launches.getLaunches(j);
var c=CQ.WCM.getPageInfo(j);
var k=[];
for(var b=0;
b<a.length;
b++){var g=a[b].data;
k[b]=[g.title,g.label,g.launchPath,g.escapedLaunchPath,g.pagePath,g.escapedPagePath,g.label===CQ.wcm.Sidekick.Launches.LABEL_PRODUCTION?!c.launches.isLaunch:c.launches.isLaunch&&c.launches.launch.path===g.launchPath,g["jcr:lastModified"],g["jcr:lastModifiedBy"]]
}this.store.loadData(k)
},dateRenderer:function(g,c,b){var a=b.data["jcr:lastModified"];
var k="";
if(a>0){k=CQ.wcm.SiteAdmin.formatDate(new Date(a));
var j=CQ.I18n.getMessage("Modified on {0} by {1}",[k,b.data["jcr:lastModifiedBy"]]);
if(CQ.Ext.QuickTips.isEnabled()){c.attr+=' ext:qtip="'+j+'"'
}else{c.attr+=' title="'+j+'"'
}}return k
}});
CQ.wcm.Page.prototype.isLaunch=function(){if(!this.loaded){this.load()
}return this.launches&&this.launches.isLaunch
};
CQ.wcm.Launches.PromoteLaunchWizard=CQ.Ext.extend(CQ.Dialog,{isBackground:false,constructor:function(g){var c=this;
this.promotionScope=new CQ.form.Selection({name:"promotionScope",cls:"x-form-field",fieldLabel:CQ.I18n.getMessage("Scope"),type:"radio",allowBlank:false,value:"resource",options:[{text:CQ.I18n.getMessage("Promote full launch to production version"),value:"full"},{text:CQ.I18n.getMessage("Promote page changes to production version"),value:"resource"}],listeners:{selectionchanged:function(m,n){c.includeSubPages.setDisabled(n==="full")
}}});
this.includeSubPages=new CQ.form.Selection({name:"includeSubPages",cls:"x-form-field",boxLabel:CQ.I18n.getMessage("Include sub pages"),fieldDescription:CQ.I18n.getMessage("Changes to sub pages of current page will also be promoted to the production version."),type:"checkbox",value:false});
var k=CQ.WCM.getPageInfo(g.path);
this.workflowPackage=new CQ.form.Selection({name:"workflowPackage",cls:"x-form-field",fieldLabel:CQ.I18n.getMessage("Add to Workflow Package"),fieldDescription:CQ.I18n.getMessage("All changed page will be added into a package for bulk activation."),type:"select",options:CQ.WCM.getWorkflowPackageOptions(k.workflowPackageInfo&&k.workflowPackageInfo.workflowPackages?k.workflowPackageInfo.workflowPackages:[])});
var b=[this.promotionScope,this.includeSubPages,this.workflowPackage];
this.formUrl="/bin/wcmcommand";
b.push(new CQ.Ext.form.Hidden({name:"cmd",value:"promoteLaunch"}));
if(CQ.Ext.isArray(g.path)){for(var j=0;
j<g.path.length;
j++){b.push(new CQ.Ext.form.Hidden({name:"path",value:g.path[j]}))
}}else{b.push(new CQ.Ext.form.Hidden({name:"path",value:g.path}))
}var a={title:CQ.I18n.getMessage("Promote Launch: {0}",k.launches.launch.title),formUrl:"/bin/wcmcommand",height:280,items:{xtype:"panel",layout:"form",items:b},buttons:[{text:CQ.I18n.getMessage("Promote"),disabled:false,handler:function(m){if(c.backgroundExec&&c.backgroundExec.getValue()){c.addHidden({"sling:bg":true},1)
}c.ok(m)
}},CQ.Dialog.CANCEL],success:function(r,o){var n=o.result["Path"];
var m=CQ.I18n.getMessage("Launch promoted");
var t=CQ.I18n.getMessage("Redirecting to the new production version...");
CQ.Notification.notify(m,t,3);
var q=CQ.shared.HTTP.getXhrHookedURL(CQ.HTTP.externalize(n)+".html");
setTimeout(function(){CQ.Util.reload(CQ.WCM.getContentWindow(),q)
},3000)
},failure:function(){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Launch could not be promoted"))
}};
g=CQ.Util.applyDefaults(g,a);
CQ.wcm.Launches.PromoteLaunchWizard.superclass.constructor.call(this,g)
},initComponent:function(){CQ.wcm.Launches.PromoteLaunchWizard.superclass.initComponent.call(this)
}});
CQ.Ext.reg("promotelaunchwizard",CQ.wcm.Launches.PromoteLaunchWizard);
CQ.Ext.override(CQ.wcm.Sidekick,{showSimulatorPanel:function(){var a=CQ.WCM.getDeviceSimulator();
if(a){if(!this.previewOptionsPanel){this.previewOptionsPanel=new CQ.Ext.Panel(this.getPreviewPanelConfig());
CQ.WCM.getTopWindow().CQ.WCM.on("simulatorstart",function(b){this.refreshSimulatorPreviewLabel(b)
},this)
}this.previewOptionsPanel.show()
}else{this.hideSimulatorPanel()
}},hideSimulatorPanel:function(){if(this.previewOptionsPanel){this.previewOptionsPanel.hide()
}},getPreviewPanelConfig:function(){var b=CQ.wcm.Sidekick.findSidekick(this);
var m={xtype:"button",text:CQ.I18n.getMessage("Devices"),id:"cq-simulator-devices-button",tooltip:{title:CQ.I18n.getMessage("Device"),text:CQ.I18n.getMessage("Device selection"),autoHide:true},listeners:{menuhide:function(){var o=CQ.WCM.getDeviceSimulator();
o.switchDevice()
}}};
var g=b.getEmulatorMenuConfig(this.getPath());
if(g&&g.menu){var c=[];
var n=CQ.WCM.getContentWindow().CQ.wcm.mobile.simulator.DeviceSimulator.DESKTOP_CONFIG;
for(var k in n){var a=n[k];
c.push({text:CQ.I18n.getVarMessage(a.title),checked:false,group:"emulators",value:k,action:a.action,checkHandler:function(r,q){var o=CQ.WCM.getEmulatorManager();
var t=CQ.WCM.getDeviceSimulator();
if(t&&o){if(q){if(r.action=="start"){t.reset();
o.stopEmulator()
}}}},scope:this})
}if(c.length>0){if(!g.menu.items){g.menu.items=[]
}g.menu.items=c.concat(g.menu.items)
}}m=CQ.Util.applyDefaults(g,m);
var j={xtype:"button",id:"cq-simulator-rotate-button",text:CQ.I18n.getMessage("Rotate"),handler:function(){var o=CQ.WCM.getDeviceSimulator();
o.rotateDevice()
}};
return{xtype:"panel",id:"cq-sidekick-simulator-panel",title:CQ.I18n.getMessage("Simulator Options"),cls:"cq-sidekick-form-simulator cq-sidekick-form x-window-mc",width:this.width,renderTo:this.getEl(),items:{xtype:"panel",cls:"cq-sidekick-simulator-panel",border:false,layout:"form",items:[{xtype:"panel",layout:"column",border:false,items:{xtype:"label",id:"cq.sidekick.simulator.status"}},{xtype:"panel",layout:"column",border:false,defaults:{border:false,autoScroll:true},items:[m,j]}]}}
},refreshSimulatorPreviewLabel:function(g){var b="";
if(g){b=CQ.I18n.getVarMessage(g.title);
b+=" (";
var c=new CQ.WCM.getContentWindow().CQ.wcm.mobile.simulator.MediaFilter();
g=c.getDevice(g);
b+=g.getPixelWidth()+" x "+g.getPixelHeight();
b+=")"
}var a=CQ.Ext.getCmp("cq.sidekick.simulator.status");
a.setText(b)
}});
CQ.tree.SlingTreeLoader=CQ.Ext.extend(CQ.Ext.tree.TreeLoader,{path:"/",titleProperty:"jcr:title",qtipProperty:"jcr:description",nameExcludes:["rep:policy"],typeExcludes:[],typeIncludes:[],filterFn:null,directFn:null,constructor:function(a){a.url=a.path;
CQ.tree.SlingTreeLoader.superclass.constructor.call(this,a)
},requestData:function(c,g,b){if(this.fireEvent("beforeload",this,c,g)!==false){var a=c.getPath()+".1.json";
this.transId=CQ.Ext.Ajax.request({method:"GET",url:a,success:this.handleResponse,failure:this.handleFailure,scope:this,argument:{callback:g,node:c,scope:b}})
}else{this.runCallback(g,b||c,[])
}},processResponse:function(a,g,m,c){var b=a.responseText;
try{var j=a.responseData||CQ.Ext.decode(b);
g.beginUpdate();
CQ.Ext.iterate(j,function(q,r){if(CQ.Ext.isObject(r)){r=this.filter(q,r);
if(r){var t=this.createNode(this.readAttributes(q,r));
if(t){g.appendChild(t)
}}}},this);
g.endUpdate();
this.runCallback(m,c||g,[g])
}catch(k){this.handleFailure(a)
}},filter:function(b,j){if(this.nameExcludes.indexOf(b)>=0){return null
}var c=j["jcr:primaryType"];
var a=j["sling:resourceType"];
if(this.typeExcludes.indexOf(c)>=0||this.typeExcludes.indexOf(a)>=0){return null
}if(this.typeIncludes&&this.typeIncludes.length>0){var g=false;
if(!c||this.typeIncludes.indexOf(c)>=0){g=true
}if(!a||this.typeIncludes.indexOf(a)>=0){g=true
}if(!g){return null
}}if(typeof this.filterFn==="function"){j=this.filterFn(b,j)
}return j
},readAttributes:function(a,b){return{name:a,text:this.getTitle(a,b),qtip:this.getQtip(a,b),leaf:false}
},getTitle:function(a,b){return b[this.titleProperty]||a
},getQtip:function(a,b){return b[this.qtipProperty]
}});
CQ.tree.FilteredTreeLoader=CQ.Ext.extend(CQ.Ext.tree.TreeLoader,{filterFn:null,processResponse:function(response,node,callback){var json=response.responseText;
try{var o=eval("("+json+")");
if(this.filterFn){o=this.filterFn(o)
}node.beginUpdate();
for(var i=0,len=o.length;
i<len;
i++){var n=o[i];
if(n.children){delete n.children
}n=this.createNode(n);
if(n){node.appendChild(n)
}}node.endUpdate();
if(typeof callback=="function"){callback(this,node)
}}catch(e){this.handleFailure(response)
}}});
/*!
 * Ext JS Library 3.3.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.tree.TreeGridSorter=CQ.Ext.extend(CQ.Ext.tree.TreeSorter,{sortClasses:["sort-asc","sort-desc"],sortAscText:"Sort Ascending",sortDescText:"Sort Descending",constructor:function(a,b){if(!CQ.Ext.isObject(b)){b={property:a.columns[0].dataIndex||"text",folderSort:true}
}CQ.tree.TreeGridSorter.superclass.constructor.apply(this,arguments);
this.tree=a;
a.on("headerclick",this.onHeaderClick,this);
a.ddAppendOnly=true;
var c=this;
this.defaultSortFn=function(r,q){var o=c.dir&&c.dir.toLowerCase()=="desc",g=c.property||"text",k=c.sortType,u=c.caseSensitive===true,j=c.leafAttr||"leaf",v=r.attributes,t=q.attributes;
if(c.folderSort){if(v[j]&&!t[j]){return 1
}if(!v[j]&&t[j]){return -1
}}var n=v[g],m=t[g],w=k?k(n):(u?n:n.toUpperCase());
v2=k?k(m):(u?m:m.toUpperCase());
if(w<v2){return o?+1:-1
}else{if(w>v2){return o?-1:+1
}else{return 0
}}};
a.on("afterrender",this.onAfterTreeRender,this,{single:true});
a.on("headermenuclick",this.onHeaderMenuClick,this)
},onAfterTreeRender:function(){if(this.tree.hmenu){this.tree.hmenu.insert(0,{itemId:"asc",text:this.sortAscText,cls:"xg-hmenu-sort-asc"},{itemId:"desc",text:this.sortDescText,cls:"xg-hmenu-sort-desc"})
}this.updateSortIcon(0,"asc")
},onHeaderMenuClick:function(g,b,a){if(b==="asc"||b==="desc"){this.onHeaderClick(g,null,a);
return false
}},onHeaderClick:function(j,b,a){if(j&&!this.tree.headersDisabled){var g=this;
g.property=j.dataIndex;
g.dir=j.dir=(j.dir==="desc"?"asc":"desc");
g.sortType=j.sortType;
g.caseSensitive===CQ.Ext.isBoolean(j.caseSensitive)?j.caseSensitive:this.caseSensitive;
g.sortFn=j.sortFn||this.defaultSortFn;
this.tree.root.cascade(function(c){if(!c.isLeaf()){g.updateSort(g.tree,c)
}});
this.updateSortIcon(a,j.dir)
}},updateSortIcon:function(b,a){var g=this.sortClasses,c=this.tree.innerHd.select("td").removeClass(g);
c.item(b).addClass(g[a=="desc"?1:0])
}});
/*!
 * Ext JS Library 3.3.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.tree.ColumnResizer=CQ.Ext.extend(CQ.Ext.util.Observable,{minWidth:14,constructor:function(a){CQ.Ext.apply(this,a);
CQ.tree.ColumnResizer.superclass.constructor.call(this)
},init:function(a){this.tree=a;
a.on("render",this.initEvents,this)
},initEvents:function(a){a.mon(a.innerHd,"mousemove",this.handleHdMove,this);
this.tracker=new CQ.Ext.dd.DragTracker({onBeforeStart:this.onBeforeStart.createDelegate(this),onStart:this.onStart.createDelegate(this),onDrag:this.onDrag.createDelegate(this),onEnd:this.onEnd.createDelegate(this),tolerance:3,autoStart:300});
this.tracker.initEl(a.innerHd);
a.on("beforedestroy",this.tracker.destroy,this.tracker)
},handleHdMove:function(j,o){var k=5,n=j.getPageX(),g=j.getTarget(".x-treegrid-hd",3,true);
if(g){var b=g.getRegion(),q=g.dom.style,c=g.dom.parentNode;
if(n-b.left<=k&&g.dom!==c.firstChild){var a=g.dom.previousSibling;
while(a&&CQ.Ext.fly(a).hasClass("x-treegrid-hd-hidden")){a=a.previousSibling
}if(a){this.activeHd=CQ.Ext.get(a);
q.cursor=CQ.Ext.isWebKit?"e-resize":"col-resize"
}}else{if(b.right-n<=k){var m=g.dom;
while(m&&CQ.Ext.fly(m).hasClass("x-treegrid-hd-hidden")){m=m.previousSibling
}if(m){this.activeHd=CQ.Ext.get(m);
q.cursor=CQ.Ext.isWebKit?"w-resize":"col-resize"
}}else{delete this.activeHd;
q.cursor=""
}}}},onBeforeStart:function(a){this.dragHd=this.activeHd;
return !!this.dragHd
},onStart:function(b){this.dragHeadersDisabled=this.tree.headersDisabled;
this.tree.headersDisabled=true;
this.proxy=this.tree.body.createChild({cls:"x-treegrid-resizer"});
this.proxy.setHeight(this.tree.body.getHeight());
var a=this.tracker.getXY()[0];
this.hdX=this.dragHd.getX();
this.hdIndex=this.tree.findHeaderIndex(this.dragHd);
this.proxy.setX(this.hdX);
this.proxy.setWidth(a-this.hdX);
this.maxWidth=this.tree.outerCt.getWidth()-this.tree.innerBody.translatePoints(this.hdX).left
},onDrag:function(b){var a=this.tracker.getXY()[0];
this.proxy.setWidth((a-this.hdX).constrain(this.minWidth,this.maxWidth))
},onEnd:function(g){var b=this.proxy.getWidth(),a=this.tree,c=this.dragHeadersDisabled;
this.proxy.remove();
delete this.dragHd;
a.columns[this.hdIndex].width=b;
a.updateColumnWidths();
setTimeout(function(){a.headersDisabled=c
},100)
}});
/*!
 * Ext JS Library 3.3.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.tree.TreeGridNodeUI=CQ.Ext.extend(CQ.Ext.tree.TreeNodeUI,{isTreeGridNodeUI:true,renderElements:function(g,u,o,v){var w=g.getOwnerTree(),r=w.columns,q=r[0],j,b,m;
this.indentMarkup=g.parentNode?g.parentNode.ui.getChildIndent():"";
b=['<tbody class="x-tree-node">','<tr ext:tree-node-id="',g.id,'" class="x-tree-node-el x-tree-node-leaf ',u.cls,'">','<td class="x-treegrid-col">','<span class="x-tree-node-indent">',this.indentMarkup,"</span>",'<img src="',this.emptyIcon,'" class="x-tree-ec-icon x-tree-elbow" />','<img src="',u.icon||this.emptyIcon,'" class="x-tree-node-icon',(u.icon?" x-tree-node-inline-icon":""),(u.iconCls?" "+u.iconCls:""),'" unselectable="on" />','<a hidefocus="on" class="x-tree-node-anchor" href="',u.href?u.href:"#",'" tabIndex="1" ',u.hrefTarget?' target="'+u.hrefTarget+'"':"",">",'<span unselectable="on">',(q.tpl?q.tpl.apply(u):u[q.dataIndex]||q.text),"</span></a>","</td>"];
for(j=1,m=r.length;
j<m;
j++){q=r[j];
b.push('<td class="x-treegrid-col ',(q.cls?q.cls:""),'">','<div unselectable="on" class="x-treegrid-text"',(q.align?' style="text-align: '+q.align+';"':""),">",(q.tpl?q.tpl.apply(u):u[q.dataIndex]),"</div>","</td>")
}b.push('</tr><tr class="x-tree-node-ct"><td colspan="',r.length,'">','<table class="x-treegrid-node-ct-table" cellpadding="0" cellspacing="0" style="table-layout: fixed; display: none; width: ',w.innerCt.getWidth(),'px;"><colgroup>');
for(j=0,m=r.length;
j<m;
j++){b.push('<col style="width: ',(r[j].hidden?0:r[j].width),'px;" />')
}b.push("</colgroup></table></td></tr></tbody>");
if(v!==true&&g.nextSibling&&g.nextSibling.ui.getEl()){this.wrap=CQ.Ext.DomHelper.insertHtml("beforeBegin",g.nextSibling.ui.getEl(),b.join(""))
}else{this.wrap=CQ.Ext.DomHelper.insertHtml("beforeEnd",o,b.join(""))
}this.elNode=this.wrap.childNodes[0];
this.ctNode=this.wrap.childNodes[1].firstChild.firstChild;
var k=this.elNode.firstChild.childNodes;
this.indentNode=k[0];
this.ecNode=k[1];
this.iconNode=k[2];
this.anchor=k[3];
this.textNode=k[3].firstChild
},animExpand:function(a){this.ctNode.style.display="";
CQ.tree.TreeGridNodeUI.superclass.animExpand.call(this,a)
}});
CQ.tree.TreeGridRootNodeUI=CQ.Ext.extend(CQ.Ext.tree.TreeNodeUI,{isTreeGridNodeUI:true,render:function(){if(!this.rendered){this.wrap=this.ctNode=this.node.ownerTree.innerCt.dom;
this.node.expanded=true
}if(CQ.Ext.isWebKit){var a=this.ctNode;
a.style.tableLayout=null;
(function(){a.style.tableLayout="fixed"
}).defer(1)
}},destroy:function(){if(this.elNode){CQ.Ext.dd.Registry.unregister(this.elNode.id)
}delete this.node
},collapse:CQ.Ext.emptyFn,expand:CQ.Ext.emptyFn});
/*!
 * Ext JS Library 3.3.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.tree.TreeGridLoader=CQ.Ext.extend(CQ.Ext.tree.TreeLoader,{createNode:function(a){if(!a.uiProvider){a.uiProvider=CQ.tree.TreeGridNodeUI
}return CQ.Ext.tree.TreeLoader.prototype.createNode.call(this,a)
}});
/*!
 * Ext JS Library 3.3.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
(function(){CQ.Ext.override(CQ.Ext.list.Column,{init:function(){var b=CQ.Ext.data.Types,a=this.sortType;
if(this.type){if(CQ.Ext.isString(this.type)){this.type=CQ.Ext.data.Types[this.type.toUpperCase()]||b.AUTO
}}else{this.type=b.AUTO
}if(CQ.Ext.isString(a)){this.sortType=CQ.Ext.data.SortTypes[a]
}else{if(CQ.Ext.isEmpty(a)){this.sortType=this.type.sortType
}}}});
CQ.tree.Column=CQ.Ext.extend(CQ.Ext.list.Column,{});
CQ.tree.NumberColumn=CQ.Ext.extend(CQ.Ext.list.NumberColumn,{});
CQ.tree.DateColumn=CQ.Ext.extend(CQ.Ext.list.DateColumn,{});
CQ.tree.BooleanColumn=CQ.Ext.extend(CQ.Ext.list.BooleanColumn,{});
CQ.Ext.reg("tgcolumn",CQ.tree.Column);
CQ.Ext.reg("tgnumbercolumn",CQ.tree.NumberColumn);
CQ.Ext.reg("tgdatecolumn",CQ.tree.DateColumn);
CQ.Ext.reg("tgbooleancolumn",CQ.tree.BooleanColumn)
})();
/*!
 * Ext JS Library 3.3.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
CQ.tree.TreeGrid=CQ.Ext.extend(CQ.Ext.tree.TreePanel,{rootVisible:false,useArrows:true,lines:false,borderWidth:CQ.Ext.isBorderBox?0:2,cls:"x-treegrid",columnResize:true,enableSort:true,reserveScrollOffset:true,enableHdMenu:true,columnsText:"Columns",initComponent:function(){if(!this.root){this.root=new CQ.Ext.tree.AsyncTreeNode({text:"Root"})
}var a=this.loader;
if(!a){a=new CQ.tree.TreeGridLoader({dataUrl:this.dataUrl,requestMethod:this.requestMethod,store:this.store})
}else{if(CQ.Ext.isObject(a)&&!a.load){a=new CQ.tree.TreeGridLoader(a)
}}this.loader=a;
CQ.tree.TreeGrid.superclass.initComponent.call(this);
this.initColumns();
if(this.enableSort){this.treeGridSorter=new CQ.tree.TreeGridSorter(this,this.enableSort)
}if(this.columnResize){this.colResizer=new CQ.tree.ColumnResizer(this.columnResize);
this.colResizer.init(this)
}var b=this.columns;
if(!this.internalTpl){this.internalTpl=new CQ.Ext.XTemplate('<div class="x-grid3-header">','<div class="x-treegrid-header-inner">','<div class="x-grid3-header-offset">','<table style="table-layout: fixed;" cellspacing="0" cellpadding="0" border="0"><colgroup><tpl for="columns"><col /></tpl></colgroup>','<thead><tr class="x-grid3-hd-row">','<tpl for="columns">','<td class="x-grid3-hd x-grid3-cell x-treegrid-hd" style="text-align: {align};" id="',this.id,'-xlhd-{#}">','<div class="x-grid3-hd-inner x-treegrid-hd-inner" unselectable="on">',this.enableHdMenu?'<a class="x-grid3-hd-btn" href="#"></a>':"",'{header}<img class="x-grid3-sort-icon" src="',CQ.Ext.BLANK_IMAGE_URL,'" />',"</div>","</td></tpl>","</tr></thead>","</table>","</div></div>","</div>",'<div class="x-treegrid-root-node">','<table class="x-treegrid-root-table" cellpadding="0" cellspacing="0" style="table-layout: fixed;"></table>',"</div>")
}if(!this.colgroupTpl){this.colgroupTpl=new CQ.Ext.XTemplate('<colgroup><tpl for="columns"><col style="width: {width}px"/></tpl></colgroup>')
}},initColumns:function(){var j=this.columns,a=j.length,g=[],b,k;
for(b=0;
b<a;
b++){k=j[b];
if(!k.isColumn){k.xtype=k.xtype?(/^tg/.test(k.xtype)?k.xtype:"tg"+k.xtype):"tgcolumn";
k=CQ.Ext.create(k)
}k.init(this);
g.push(k);
if(this.enableSort!==false&&k.sortable!==false){k.sortable=true;
this.enableSort=true
}}this.columns=g
},onRender:function(){CQ.Ext.tree.TreePanel.superclass.onRender.apply(this,arguments);
this.el.addClass("x-treegrid");
this.outerCt=this.body.createChild({cls:"x-tree-root-ct x-treegrid-ct "+(this.useArrows?"x-tree-arrows":this.lines?"x-tree-lines":"x-tree-no-lines")});
this.internalTpl.overwrite(this.outerCt,{columns:this.columns});
this.mainHd=CQ.Ext.get(this.outerCt.dom.firstChild);
this.innerHd=CQ.Ext.get(this.mainHd.dom.firstChild);
this.innerBody=CQ.Ext.get(this.outerCt.dom.lastChild);
this.innerCt=CQ.Ext.get(this.innerBody.dom.firstChild);
this.colgroupTpl.insertFirst(this.innerCt,{columns:this.columns});
if(this.hideHeaders){this.el.child(".x-grid3-header").setDisplayed("none")
}else{if(this.enableHdMenu!==false){this.hmenu=new CQ.Ext.menu.Menu({id:this.id+"-hctx"});
if(this.enableColumnHide!==false){this.colMenu=new CQ.Ext.menu.Menu({id:this.id+"-hcols-menu"});
this.colMenu.on({scope:this,beforeshow:this.beforeColMenuShow,itemclick:this.handleHdMenuClick});
this.hmenu.add({itemId:"columns",hideOnClick:false,text:this.columnsText,menu:this.colMenu,iconCls:"x-cols-icon"})
}this.hmenu.on("itemclick",this.handleHdMenuClick,this)
}}},setRootNode:function(a){a.attributes.uiProvider=CQ.tree.TreeGridRootNodeUI;
a=CQ.tree.TreeGrid.superclass.setRootNode.call(this,a);
if(this.innerCt){this.colgroupTpl.insertFirst(this.innerCt,{columns:this.columns})
}return a
},clearInnerCt:function(){if(CQ.Ext.isIE){var a=this.innerCt.dom;
while(a.firstChild){a.removeChild(a.firstChild)
}}else{CQ.tree.TreeGrid.superclass.clearInnerCt.call(this)
}},initEvents:function(){CQ.tree.TreeGrid.superclass.initEvents.apply(this,arguments);
this.mon(this.innerBody,"scroll",this.syncScroll,this);
this.mon(this.innerHd,"click",this.handleHdDown,this);
this.mon(this.mainHd,{scope:this,mouseover:this.handleHdOver,mouseout:this.handleHdOut})
},onResize:function(b,c){CQ.tree.TreeGrid.superclass.onResize.apply(this,arguments);
var j=this.innerBody.dom;
var k=this.innerHd.dom;
if(!j){return
}if(CQ.Ext.isNumber(c)){j.style.height=this.body.getHeight(true)-k.offsetHeight+"px"
}if(CQ.Ext.isNumber(b)){var a=CQ.Ext.num(this.scrollOffset,CQ.Ext.getScrollBarWidth());
if(this.reserveScrollOffset||((j.offsetWidth-j.clientWidth)>10)){this.setScrollOffset(a)
}else{var g=this;
setTimeout(function(){g.setScrollOffset(j.offsetWidth-j.clientWidth>10?a:0)
},10)
}}},updateColumnWidths:function(){var q=this.columns,t=q.length,a=this.outerCt.query("colgroup"),r=a.length,o,m,k,b;
for(k=0;
k<t;
k++){o=q[k];
for(b=0;
b<r;
b++){m=a[b];
m.childNodes[k].style.width=(o.hidden?0:o.width)+"px"
}}for(k=0,a=this.innerHd.query("td"),len=a.length;
k<len;
k++){o=CQ.Ext.fly(a[k]);
if(q[k]&&q[k].hidden){o.addClass("x-treegrid-hd-hidden")
}else{o.removeClass("x-treegrid-hd-hidden")
}}var n=this.getTotalColumnWidth();
CQ.Ext.fly(this.innerHd.dom.firstChild).setWidth(n+(this.scrollOffset||0));
this.outerCt.select("table").setWidth(n);
this.syncHeaderScroll()
},getVisibleColumns:function(){var c=[],g=this.columns,a=g.length,b;
for(b=0;
b<a;
b++){if(!g[b].hidden){c.push(g[b])
}}return c
},getTotalColumnWidth:function(){var g=0;
for(var b=0,c=this.getVisibleColumns(),a=c.length;
b<a;
b++){g+=c[b].width
}return g
},setScrollOffset:function(a){this.scrollOffset=a;
this.updateColumnWidths()
},handleHdDown:function(n,j){var m=n.getTarget(".x-treegrid-hd");
if(m&&CQ.Ext.fly(j).hasClass("x-grid3-hd-btn")){var b=this.hmenu.items,k=this.columns,a=this.findHeaderIndex(m),o=k[a],g=o.sortable;
n.stopEvent();
CQ.Ext.fly(m).addClass("x-grid3-hd-menu-open");
this.hdCtxIndex=a;
this.fireEvent("headerbuttonclick",b,o,m,a);
this.hmenu.on("hide",function(){CQ.Ext.fly(m).removeClass("x-grid3-hd-menu-open")
},this,{single:true});
this.hmenu.show(j,"tl-bl?")
}else{if(m){var a=this.findHeaderIndex(m);
this.fireEvent("headerclick",this.columns[a],m,a)
}}},handleHdOver:function(g,a){var c=g.getTarget(".x-treegrid-hd");
if(c&&!this.headersDisabled){index=this.findHeaderIndex(c);
this.activeHdRef=a;
this.activeHdIndex=index;
var b=CQ.Ext.get(c);
this.activeHdRegion=b.getRegion();
b.addClass("x-grid3-hd-over");
this.activeHdBtn=b.child(".x-grid3-hd-btn");
if(this.activeHdBtn){this.activeHdBtn.dom.style.height=(c.firstChild.offsetHeight-1)+"px"
}}},handleHdOut:function(c,a){var b=c.getTarget(".x-treegrid-hd");
if(b&&(!CQ.Ext.isIE||!c.within(b,true))){this.activeHdRef=null;
CQ.Ext.fly(b).removeClass("x-grid3-hd-over");
b.style.cursor=""
}},findHeaderIndex:function(g){g=g.dom||g;
var b=g.parentNode.childNodes;
for(var a=0,j;
j=b[a];
a++){if(j==g){return a
}}return -1
},beforeColMenuShow:function(){var g=this.columns,b=g.length,a,j;
this.colMenu.removeAll();
for(a=1;
a<b;
a++){j=g[a];
if(j.hideable!==false){this.colMenu.add(new CQ.Ext.menu.CheckItem({itemId:"col-"+a,text:j.header,checked:!j.hidden,hideOnClick:false,disabled:j.hideable===false}))
}}},handleHdMenuClick:function(b){var a=this.hdCtxIndex,c=b.getItemId();
if(this.fireEvent("headermenuclick",this.columns[a],c,a)!==false){a=c.substr(4);
if(a>0&&this.columns[a]){this.setColumnVisible(a,!b.checked)
}}return true
},setColumnVisible:function(a,b){this.columns[a].hidden=!b;
this.updateColumnWidths()
},scrollToTop:function(){this.innerBody.dom.scrollTop=0;
this.innerBody.dom.scrollLeft=0
},syncScroll:function(){this.syncHeaderScroll();
var a=this.innerBody.dom;
this.fireEvent("bodyscroll",a.scrollLeft,a.scrollTop)
},syncHeaderScroll:function(){var a=this.innerBody.dom;
this.innerHd.dom.scrollLeft=a.scrollLeft;
this.innerHd.dom.scrollLeft=a.scrollLeft
},registerNode:function(a){CQ.tree.TreeGrid.superclass.registerNode.call(this,a);
if(!a.uiProvider&&!a.isRoot&&!a.ui.isTreeGridNodeUI){a.ui=new CQ.tree.TreeGridNodeUI(a)
}}});
CQ.Ext.reg("treegrid",CQ.tree.TreeGrid);
if(CQ.Ext.version=="3.0"){CQ.Ext.override(CQ.Ext.grid.GridView,{ensureVisible:function(z,k,j){var x=this.resolveCell(z,k,j);
if(!x||!x.row){return
}var q=x.row,m=x.cell,u=this.scroller.dom,y=0,g=q,v=this.el.dom;
var g=q,v=this.el.dom;
while(g&&g!=v){y+=g.offsetTop;
g=g.offsetParent
}y-=this.mainHd.dom.offsetHeight;
var w=y+q.offsetHeight;
var a=u.clientHeight;
var v=parseInt(u.scrollTop,10);
var t=v+a;
if(y<v){u.scrollTop=y
}else{if(w>t){u.scrollTop=w-a
}}if(j!==false){var r=parseInt(m.offsetLeft,10);
var o=r+m.offsetWidth;
var n=parseInt(u.scrollLeft,10);
var b=n+u.clientWidth;
if(r<n){u.scrollLeft=r
}else{if(o>b){u.scrollLeft=o-u.clientWidth
}}}return this.getResolvedXY(x)
}})
}CQ.Ext.namespace("CQ.Ext.ux.maximgb.tg");
CQ.Ext.ux.maximgb.tg.AbstractTreeStore=CQ.Ext.extend(CQ.Ext.data.Store,{leaf_field_name:"_is_leaf",page_offset:0,active_node:null,constructor:function(a){CQ.Ext.ux.maximgb.tg.AbstractTreeStore.superclass.constructor.call(this,a);
if(!this.paramNames.active_node){this.paramNames.active_node="anode"
}this.addEvents("beforeexpandnode","expandnode","expandnodefailed","beforecollapsenode","collapsenode","beforeactivenodechange","activenodechange")
},remove:function(a){if(a===this.active_node){this.setActiveNode(null)
}this.removeNodeDescendants(a);
CQ.Ext.ux.maximgb.tg.AbstractTreeStore.superclass.remove.call(this,a)
},removeNodeDescendants:function(g){var c,a,b=this.getNodeChildren(g);
for(c=0,a=b.length;
c<a;
c++){this.remove(b[c])
}},load:function(a){if(a){if(a.params){if(a.params[this.paramNames.active_node]===undefined){a.params[this.paramNames.active_node]=this.active_node?this.active_node.id:null
}}else{a.params={};
a.params[this.paramNames.active_node]=this.active_node?this.active_node.id:null
}}else{a={params:{}};
a.params[this.paramNames.active_node]=this.active_node?this.active_node.id:null
}if(a.params[this.paramNames.active_node]!==null){a.add=true
}return CQ.Ext.ux.maximgb.tg.AbstractTreeStore.superclass.load.call(this,a)
},loadRecords:function(c,z,u){if(!c||u===false){if(u!==false){this.fireEvent("load",this,[],z)
}if(z.callback){z.callback.call(z.scope||this,[],z,false)
}return
}var a=c.records,y=c.totalRecords||a.length,v=this.getPageOffsetFromOptions(z),x=this.getLoadedNodeIdFromOptions(z),q,g,m,b,k,n,j,w=this;
if(!z||z.add!==true){if(this.pruneModifiedRecords){this.modified=[]
}for(var g=0,m=a.length;
g<m;
g++){a[g].join(this)
}if(this.snapshot){this.data=this.snapshot;
delete this.snapshot
}this.data.clear();
this.data.addAll(a);
this.page_offset=v;
this.totalLength=y;
this.applySort();
this.fireEvent("datachanged",this)
}else{if(x){q=this.getById(x)
}if(q){this.setNodeLoaded(q,true);
this.setNodeChildrenOffset(q,v);
this.setNodeChildrenTotalCount(q,Math.max(y,a.length));
this.removeNodeDescendants(q)
}this.suspendEvents();
j={};
for(g=0,m=a.length;
g<m;
g++){k=a[g];
n=this.indexOfId(k.id);
if(n==-1){j[k.id]=false;
this.add(k)
}else{j[k.id]=true;
b=this.getAt(n);
b.reject();
b.data=k.data;
a[g]=b
}}this.applySort();
this.resumeEvents();
a.sort(function(A,r){var B=w.data.indexOf(A),t=w.data.indexOf(r),o;
if(B>t){o=1
}else{o=-1
}return o
});
for(g=0,m=a.length;
g<m;
g++){k=a[g];
if(j[k.id]==true){this.fireEvent("update",this,k,CQ.Ext.data.Record.COMMIT)
}else{this.fireEvent("add",this,[k],this.data.indexOf(k))
}}}this.fireEvent("load",this,a,z);
if(z.callback){z.callback.call(z.scope||this,a,z,true)
}},sort:function(b,a){if(this.remoteSort){this.setActiveNode(null);
if(this.lastOptions){this.lastOptions.add=false;
if(this.lastOptions.params){this.lastOptions.params[this.paramNames.active_node]=null
}}}return CQ.Ext.ux.maximgb.tg.AbstractTreeStore.superclass.sort.call(this,b,a)
},applySort:function(){if(this.sortInfo&&!this.remoteSort){var a=this.sortInfo,b=a.field;
this.sortData(b,a.direction)
}else{this.applyTreeSort()
}},sortData:function(c,g){g=g||"ASC";
var a=this.fields.get(c).sortType;
var b=function(k,j){var n=a(k.data[c]),m=a(j.data[c]);
return n>m?1:(n<m?-1:0)
};
this.data.sort(g,b);
if(this.snapshot&&this.snapshot!=this.data){this.snapshot.sort(g,b)
}this.applyTreeSort()
},applyTreeSort:function(){var j,a,g,k,c=[],b=this.getRootNodes();
for(j=0,a=b.length;
j<a;
j++){k=b[j];
c.push(k);
this.collectNodeChildrenTreeSorted(c,k)
}if(c.length>0){this.data.clear();
this.data.addAll(c)
}if(this.snapshot&&this.snapshot!==this.data){g=this.data;
this.data=this.snapshot;
this.snapshot=null;
this.applyTreeSort();
this.snapshot=this.data;
this.data=g
}},collectNodeChildrenTreeSorted:function(b,j){var g,a,k,c=this.getNodeChildren(j);
for(g=0,a=c.length;
g<a;
g++){k=c[g];
b.push(k);
this.collectNodeChildrenTreeSorted(b,k)
}},getActiveNode:function(){return this.active_node
},setActiveNode:function(a){if(this.active_node!==a){if(a){if(this.data.indexOf(a)!=-1){if(this.fireEvent("beforeactivenodechange",this,this.active_node,a)!==false){this.active_node=a;
this.fireEvent("activenodechange",this,this.active_node,a)
}}else{throw"Given record is not from the store."
}}else{if(this.fireEvent("beforeactivenodechange",this,this.active_node,a)!==false){this.active_node=a;
this.fireEvent("activenodechange",this,this.active_node,a)
}}}},isExpandedNode:function(a){return a.ux_maximgb_tg_expanded===true
},setNodeExpanded:function(b,a){b.ux_maximgb_tg_expanded=a
},isVisibleNode:function(j){var c,b,g=this.getNodeAncestors(j),a=true;
for(c=0,b=g.length;
c<b;
c++){a=a&&this.isExpandedNode(g[c]);
if(!a){break
}}return a
},isLeafNode:function(a){return a.get(this.leaf_field_name)==true
},isLoadedNode:function(b){var a;
if(b.ux_maximgb_tg_loaded!==undefined){a=b.ux_maximgb_tg_loaded
}else{if(this.isLeafNode(b)||this.hasChildNodes(b)){a=true
}else{a=false
}}return a
},setNodeLoaded:function(b,a){b.ux_maximgb_tg_loaded=a
},getNodeChildrenOffset:function(a){return a.ux_maximgb_tg_offset||0
},setNodeChildrenOffset:function(b,a){b.ux_maximgb_tg_offset=a
},getNodeChildrenTotalCount:function(a){return a.ux_maximgb_tg_total||0
},setNodeChildrenTotalCount:function(b,a){b.ux_maximgb_tg_total=a
},collapseNode:function(a){if(this.isExpandedNode(a)&&this.fireEvent("beforecollapsenode",this,a)!==false){this.setNodeExpanded(a,false);
this.fireEvent("collapsenode",this,a)
}},expandNode:function(a){var b;
if(!this.isExpandedNode(a)&&this.fireEvent("beforeexpandnode",this,a)!==false){if(this.isLoadedNode(a)){this.setNodeExpanded(a,true);
this.fireEvent("expandnode",this,a)
}else{b={};
b[this.paramNames.active_node]=a.id;
this.load({add:true,params:b,callback:this.expandNodeCallback,scope:this})
}}},expandNodeCallback:function(b,a,g){var c=this.getById(a.params[this.paramNames.active_node]);
if(g&&c){this.setNodeExpanded(c,true);
this.fireEvent("expandnode",this,c)
}else{this.fireEvent("expandnodefailed",this,a.params[this.paramNames.active_node],c)
}},expandAll:function(){var g,c,a,b=this.data.getRange();
this.suspendEvents();
for(c=0,a=b.length;
c<a;
c++){g=b[c];
if(!this.isExpandedNode(g)){this.expandNode(g)
}}this.resumeEvents();
this.fireEvent("datachanged",this)
},collapseAll:function(){var g,c,a,b=this.data.getRange();
this.suspendEvents();
for(c=0,a=b.length;
c<a;
c++){g=b[c];
if(this.isExpandedNode(g)){this.collapseNode(g)
}}this.resumeEvents();
this.fireEvent("datachanged",this)
},getLoadedNodeIdFromOptions:function(b){var a=null;
if(b&&b.params&&b.params[this.paramNames.active_node]){a=b.params[this.paramNames.active_node]
}return a
},getPageOffsetFromOptions:function(b){var a=0;
if(b&&b.params&&b.params[this.paramNames.start]){a=parseInt(b.params[this.paramNames.start],10);
if(isNaN(a)){a=0
}}return a
},hasNextSiblingNode:function(a){return this.getNodeNextSibling(a)!==null
},hasPrevSiblingNode:function(a){return this.getNodePrevSibling(a)!==null
},hasChildNodes:function(a){return this.getNodeChildrenCount(a)>0
},getNodeAncestors:function(c){var b=[],a;
a=this.getNodeParent(c);
while(a){b.push(a);
a=this.getNodeParent(a)
}return b
},getNodeChildrenCount:function(a){return this.getNodeChildren(a).length
},getNodeNextSibling:function(g){var j,c,b,a=null;
c=this.getNodeParent(g);
if(c){j=this.getNodeChildren(c)
}else{j=this.getRootNodes()
}b=j.indexOf(g);
if(b<j.length-1){a=j[b+1]
}return a
},getNodePrevSibling:function(g){var j,c,b,a=null;
c=this.getNodeParent(g);
if(c){j=this.getNodeChildren(c)
}else{j=this.getRootNodes()
}b=j.indexOf(g);
if(b>0){a=j[b-1]
}return a
},getRootNodes:function(){throw"Abstract method call"
},getNodeDepth:function(a){throw"Abstract method call"
},getNodeParent:function(a){throw"Abstract method call"
},getNodeChildren:function(a){throw"Abstract method call"
},addToNode:function(a,b){throw"Abstract method call"
},removeFromNode:function(a,b){throw"Abstract method call"
},getPageOffset:function(){return this.page_offset
},getActiveNodePageOffset:function(){var a;
if(this.active_node){a=this.getNodeChildrenOffset(this.active_node)
}else{a=this.getPageOffset()
}return a
},getActiveNodeCount:function(){var a;
if(this.active_node){a=this.getNodeChildrenCount(this.active_node)
}else{a=this.getRootNodes().length
}return a
},getActiveNodeTotalCount:function(){var a;
if(this.active_node){a=this.getNodeChildrenTotalCount(this.active_node)
}else{a=this.getTotalCount()
}return a
}});
CQ.Ext.ux.maximgb.tg.AdjacencyListStore=CQ.Ext.extend(CQ.Ext.ux.maximgb.tg.AbstractTreeStore,{parent_id_field_name:"_parent",getRootNodes:function(){var j,b,a=[],g=this.data.getRange();
for(j=0,b=g.length;
j<b;
j++){var c=g[j];
var k=c.get(this.parent_id_field_name);
if(k==null||this.getById(k)==null){a.push(g[j])
}}return a
},getNodeDepth:function(a){return this.getNodeAncestors(a).length
},getNodeParent:function(a){return this.getById(a.get(this.parent_id_field_name))
},getNodeChildren:function(j){var g,b,a=[],c=this.data.getRange();
for(g=0,b=c.length;
g<b;
g++){if(c[g].get(this.parent_id_field_name)==j.id){a.push(c[g])
}}return a
},addToNode:function(a,b){b.set(this.parent_id_field_name,a.id);
this.addSorted(b)
},removeFromNode:function(a,b){this.remove(b)
}});
CQ.Ext.reg("CQ.Ext.ux.maximgb.tg.AdjacencyListStore",CQ.Ext.ux.maximgb.tg.AdjacencyListStore);
CQ.Ext.ux.maximgb.tg.NestedSetStore=CQ.Ext.extend(CQ.Ext.ux.maximgb.tg.AbstractTreeStore,{left_field_name:"_lft",right_field_name:"_rgt",level_field_name:"_level",root_node_level:1,getRootNodes:function(){var g,b,a=[],c=this.data.getRange();
for(g=0,b=c.length;
g<b;
g++){if(c[g].get(this.level_field_name)==this.root_node_level){a.push(c[g])
}}return a
},getNodeDepth:function(a){return a.get(this.level_field_name)-this.root_node_level
},getNodeParent:function(a){var t=null,m,k=this.data.getRange(),n,o,r,j,q,g,c,b;
r=a.get(this.left_field_name);
q=a.get(this.right_field_name);
c=a.get(this.level_field_name);
for(n=0,o=k.length;
n<o;
n++){m=k[n];
j=m.get(this.left_field_name);
g=m.get(this.right_field_name);
b=m.get(this.level_field_name);
if(b==c-1&&j<r&&g>q){t=m;
break
}}return t
},getNodeChildren:function(a){var o,j,n,g,b,c,k,m,q=[];
k=this.data.getRange();
o=a.get(this.left_field_name);
n=a.get(this.right_field_name);
b=a.get(this.level_field_name);
for(i=0,len=k.length;
i<len;
i++){m=k[i];
j=m.get(this.left_field_name);
g=m.get(this.right_field_name);
c=m.get(this.level_field_name);
if(c==b+1&&j>o&&g<n){q.push(m)
}}return q
}});
CQ.Ext.ux.maximgb.tg.GridView=CQ.Ext.extend(CQ.Ext.grid.GridView,{expanded_icon_class:"ux-maximgb-tg-elbow-minus",last_expanded_icon_class:"ux-maximgb-tg-elbow-end-minus",collapsed_icon_class:"ux-maximgb-tg-elbow-plus",last_collapsed_icon_class:"ux-maximgb-tg-elbow-end-plus",skip_width_update_class:"ux-maximgb-tg-skip-width-update",initTemplates:function(){var a=this.templates||{};
if(!a.row){a.row=new CQ.Ext.Template('<div class="x-grid3-row ux-maximgb-tg-level-{level} {alt}" style="{tstyle} {display_style}">','<table class="x-grid3-row-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody>","<tr>{cells}</tr>",(this.enableRowBody?'<tr class="x-grid3-row-body-tr" style="{bodyStyle}"><td colspan="{cols}" class="x-grid3-body-cell" tabIndex="0" hidefocus="on"><div class="x-grid3-row-body">{body}</div></td></tr>':""),"</tbody>","</table>","</div>")
}if(!a.mastercell){a.mastercell=new CQ.Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}" tabIndex="0" {cellAttr}>','<div class="ux-maximgb-tg-mastercell-wrap">',"{treeui}",'<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on" {attr}>{value}</div>',"</div>","</td>")
}if(!a.treeui){a.treeui=new CQ.Ext.Template('<div class="ux-maximgb-tg-uiwrap" style="width: {wrap_width}px">',"{elbow_line}",'<div style="left: {left}px" class="{cls}">&#160;</div>',"</div>")
}if(!a.elbow_line){a.elbow_line=new CQ.Ext.Template('<div style="left: {left}px" class="{cls}">&#160;</div>')
}this.templates=a;
CQ.Ext.ux.maximgb.tg.GridView.superclass.initTemplates.call(this)
},doRender:function(n,q,y,a,x,C){var b=this.templates,m=b.cell,o=b.row,t=x-1;
var g="width:"+this.getTotalWidth()+";";
var F=[],z,G,A={},u={tstyle:g},w;
for(var B=0,E=q.length;
B<E;
B++){w=q[B];
z=[];
var v=(B+a);
var k=this.renderRow(w,v,x,y,this.cm.getTotalWidth());
if(k===false){for(var D=0;
D<x;
D++){G=n[D];
A.id=G.id;
A.css=D==0?"x-grid3-cell-first ":(D==t?"x-grid3-cell-last ":"");
A.attr=A.cellAttr="";
A.value=G.renderer.call(G.scope,w.data[G.name],A,w,v,D,y);
A.style=G.style;
if(CQ.Ext.isEmpty(A.value)){A.value="&#160;"
}if(this.markDirty&&w.dirty&&typeof w.modified[G.name]!=="undefined"){A.css+=" x-grid3-dirty-cell"
}if(G.id==this.grid.master_column_id){A.treeui=this.renderCellTreeUI(w,y);
m=b.mastercell
}else{m=b.cell
}z[z.length]=m.apply(A)
}}else{z.push(k)
}var H=[];
if(C&&((v+1)%2==0)){H[0]="x-grid3-row-alt"
}if(w.dirty){H[1]=" x-grid3-dirty-row"
}u.cols=x;
if(this.getRowClass){H[2]=this.getRowClass(w,v,u,y)
}u.alt=H.join(" ");
u.cells=z.join("");
if(!y.isVisibleNode(w)){u.display_style="display: none;"
}else{u.display_style=""
}u.level=y.getNodeDepth(w);
F[F.length]=o.apply(u)
}return F.join("")
},renderCellTreeUI:function(a,b){var c=this.templates.treeui,n=this.templates.elbow_line,j={},m,g,k=level=b.getNodeDepth(a);
j.wrap_width=(k+1)*16;
if(level>0){j.elbow_line="";
m=a;
left=0;
while(level--){g=b.getNodeParent(m);
if(g){if(b.hasNextSiblingNode(g)){j.elbow_line=n.apply({left:level*16,cls:"ux-maximgb-tg-elbow-line"})+j.elbow_line
}else{j.elbow_line=n.apply({left:level*16,cls:"ux-maximgb-tg-elbow-empty"})+j.elbow_line
}}else{throw ["Tree inconsistency can't get level ",level+1," node(id=",m.id,") parent."].join("")
}m=g
}}if(b.isLeafNode(a)){if(b.hasNextSiblingNode(a)){j.cls="ux-maximgb-tg-elbow"
}else{j.cls="ux-maximgb-tg-elbow-end"
}}else{j.cls="ux-maximgb-tg-elbow-active ";
if(b.isExpandedNode(a)){if(b.hasNextSiblingNode(a)){j.cls+=this.expanded_icon_class
}else{j.cls+=this.last_expanded_icon_class
}}else{if(b.hasNextSiblingNode(a)){j.cls+=this.collapsed_icon_class
}else{j.cls+=this.last_collapsed_icon_class
}}}j.left=1+k*16;
return c.apply(j)
},renderRow:function(a,b,j,g,c){return false
},afterRender:function(){CQ.Ext.ux.maximgb.tg.GridView.superclass.afterRender.call(this);
this.updateAllColumnWidths()
},updateAllColumnWidths:function(){var g=this.getTotalWidth(),q=this.cm.getColumnCount(),m=[],k,b;
for(b=0;
b<q;
b++){m[b]=this.getColumnWidth(b)
}this.innerHd.firstChild.style.width=this.getOffsetWidth();
this.innerHd.firstChild.firstChild.style.width=g;
this.mainBody.dom.style.width=g;
for(b=0;
b<q;
b++){var c=this.getHeaderCell(b);
c.style.width=m[b]
}var o=this.getRows(),r,n;
for(b=0,k=o.length;
b<k;
b++){r=o[b];
r.style.width=g;
if(r.firstChild){r.firstChild.style.width=g;
n=r.firstChild.rows[0];
for(var a=0;
a<q&&a<n.childNodes.length;
a++){if(!CQ.Ext.fly(n.childNodes[a]).hasClass(this.skip_width_update_class)){n.childNodes[a].style.width=m[a]
}}}}this.onAllColumnWidthsUpdated(m,g)
},updateColumnWidth:function(b,a){var n=this.getColumnWidth(b);
var j=this.getTotalWidth();
this.innerHd.firstChild.style.width=this.getOffsetWidth();
this.innerHd.firstChild.firstChild.style.width=j;
this.mainBody.dom.style.width=j;
var g=this.getHeaderCell(b);
g.style.width=n;
var m=this.getRows(),o;
for(var c=0,k=m.length;
c<k;
c++){o=m[c];
o.style.width=j;
if(o.firstChild){o.firstChild.style.width=j;
if(b<o.firstChild.rows[0].childNodes.length){if(!CQ.Ext.fly(o.firstChild.rows[0].childNodes[b]).hasClass(this.skip_width_update_class)){o.firstChild.rows[0].childNodes[b].style.width=n
}}}}this.onColumnWidthUpdated(b,n,j)
},updateColumnHidden:function(a,j){var g=this.getTotalWidth();
this.innerHd.firstChild.style.width=this.getOffsetWidth();
this.innerHd.firstChild.firstChild.style.width=g;
this.mainBody.dom.style.width=g;
var m=j?"none":"";
var c=this.getHeaderCell(a);
c.style.display=m;
var n=this.getRows(),q,o;
for(var b=0,k=n.length;
b<k;
b++){q=n[b];
q.style.width=g;
if(q.firstChild){q.firstChild.style.width=g;
if(a<q.firstChild.rows[0].childNodes.length){if(!CQ.Ext.fly(q.firstChild.rows[0].childNodes[a]).hasClass(this.skip_width_update_class)){q.firstChild.rows[0].childNodes[a].style.display=m
}}}}this.onColumnHiddenUpdated(a,j,g);
delete this.lastViewWidth;
this.layout()
},processRows:function(a,g){var b=0;
if(this.ds.getCount()<1){return
}g=!this.grid.stripeRows;
a=a||0;
var c=this.getRows();
var b=0;
CQ.Ext.each(c,function(k,j){k.rowIndex=j;
k.className=k.className.replace(this.rowClsRe," ");
if(k.style.display!="none"){if(!g&&((b+1)%2===0)){k.className+=" x-grid3-row-alt"
}b++
}},this);
CQ.Ext.fly(c[0]).addClass(this.firstRowCls);
CQ.Ext.fly(c[c.length-1]).addClass(this.lastRowCls)
},ensureVisible:function(j,b,g){var c,a=this.ds.getAt(j);
if(!this.ds.isVisibleNode(a)){c=this.ds.getNodeAncestors(a);
while(c.length>0){a=c.shift();
if(!this.ds.isExpandedNode(a)){this.ds.expandNode(a)
}}}return CQ.Ext.ux.maximgb.tg.GridView.superclass.ensureVisible.call(this,j,b,g)
},expandRow:function(g,k){var b=this.ds,c,m,q,n,a,j,o;
if(typeof g=="number"){j=g;
g=b.getAt(j)
}else{j=b.indexOf(g)
}k=k||false;
q=this.getRow(j);
n=CQ.Ext.fly(q).child(".ux-maximgb-tg-elbow-active");
if(n){if(b.hasNextSiblingNode(g)){n.removeClass(this.collapsed_icon_class);
n.removeClass(this.last_collapsed_icon_class);
n.addClass(this.expanded_icon_class)
}else{n.removeClass(this.collapsed_icon_class);
n.removeClass(this.last_collapsed_icon_class);
n.addClass(this.last_expanded_icon_class)
}}if(b.isVisibleNode(g)){a=b.getNodeChildren(g);
for(c=0,m=a.length;
c<m;
c++){o=b.indexOf(a[c]);
q=this.getRow(o);
q.style.display="block";
if(b.isExpandedNode(a[c])){this.expandRow(o,true)
}}}if(!k){this.processRows(0)
}},collapseRow:function(g,j){var b=this.ds,c,m,a,o,k,n;
if(typeof g=="number"){k=g;
g=b.getAt(k)
}else{k=b.indexOf(g)
}j=j||false;
o=this.getRow(k);
pmel=CQ.Ext.fly(o).child(".ux-maximgb-tg-elbow-active");
if(pmel){if(b.hasNextSiblingNode(g)){pmel.removeClass(this.expanded_icon_class);
pmel.removeClass(this.last_expanded_icon_class);
pmel.addClass(this.collapsed_icon_class)
}else{pmel.removeClass(this.expanded_icon_class);
pmel.removeClass(this.last_expanded_icon_class);
pmel.addClass(this.last_collapsed_icon_class)
}}a=b.getNodeChildren(g);
for(c=0,m=a.length;
c<m;
c++){n=b.indexOf(a[c]);
o=this.getRow(n);
if(o.style.display!="none"){o.style.display="none";
this.collapseRow(n,true)
}}if(!j){this.processRows(0)
}},initData:function(b,a){CQ.Ext.ux.maximgb.tg.GridView.superclass.initData.call(this,b,a);
if(this.ds){this.ds.un("expandnode",this.onStoreExpandNode,this);
this.ds.un("collapsenode",this.onStoreCollapseNode,this)
}if(b){b.on("expandnode",this.onStoreExpandNode,this);
b.on("collapsenode",this.onStoreCollapseNode,this)
}},onLoad:function(b,a,c){var g;
if(c&&c.params&&(c.params[b.paramNames.active_node]===null||b.indexOfId(c.params[b.paramNames.active_node])==-1)){CQ.Ext.ux.maximgb.tg.GridView.superclass.onLoad.call(this,b,a,c)
}},onAdd:function(c,a,b){CQ.Ext.ux.maximgb.tg.GridView.superclass.onAdd.call(this,c,a,b);
if(this.mainWrap){this.processRows(0)
}},onRemove:function(g,a,b,c){CQ.Ext.ux.maximgb.tg.GridView.superclass.onRemove.call(this,g,a,b,c);
if(c!==true){if(this.mainWrap){this.processRows(0)
}}},onUpdate:function(b,a){CQ.Ext.ux.maximgb.tg.GridView.superclass.onUpdate.call(this,b,a);
if(this.mainWrap){this.processRows(0)
}},onStoreExpandNode:function(a,b){this.expandRow(b)
},onStoreCollapseNode:function(a,b){this.collapseRow(b)
}});
CQ.Ext.ux.maximgb.tg.GridPanel=CQ.Ext.extend(CQ.Ext.grid.GridPanel,{master_column_id:0,tg_cls:"ux-maximgb-tg-panel",initComponent:function(){this.initComponentPreOverride();
CQ.Ext.ux.maximgb.tg.GridPanel.superclass.initComponent.call(this);
this.getSelectionModel().on("selectionchange",this.onTreeGridSelectionChange,this);
this.initComponentPostOverride()
},initComponentPreOverride:CQ.Ext.emptyFn,initComponentPostOverride:CQ.Ext.emptyFn,onRender:function(b,a){CQ.Ext.ux.maximgb.tg.GridPanel.superclass.onRender.call(this,b,a);
this.el.addClass(this.tg_cls)
},getView:function(){if(!this.view){this.view=new CQ.Ext.ux.maximgb.tg.GridView(this.viewConfig)
}return this.view
},onClick:function(c){var g=c.getTarget(),k=this.getView(),o=k.findRowIndex(g),m=this.getStore(),a=this.getSelectionModel(),b,j,n=true;
if(o!==false){if(CQ.Ext.fly(g).hasClass("ux-maximgb-tg-elbow-active")){b=m.getAt(o);
if(m.isExpandedNode(b)){m.collapseNode(b)
}else{m.expandNode(b)
}n=false
}}if(n){CQ.Ext.ux.maximgb.tg.GridPanel.superclass.onClick.call(this,c)
}},onMouseDown:function(b){var a=b.getTarget();
if(!CQ.Ext.fly(a).hasClass("ux-maximgb-tg-elbow-active")){CQ.Ext.ux.maximgb.tg.GridPanel.superclass.onMouseDown.call(this,b)
}},onTreeGridSelectionChange:function(j,g){var a,c,b=this.getStore();
if(j.getSelected){a=j.getSelected();
b.setActiveNode(a)
}else{if(j.getSelectedCell&&g){a=g.record;
b.setActiveNode(a)
}}if(a){if(!b.isVisibleNode(a)){c=b.getNodeAncestors(a);
while(c.length>0){b.expandNode(c.pop())
}}}}});
CQ.Ext.ux.maximgb.tg.EditorGridPanel=CQ.Ext.extend(CQ.Ext.grid.EditorGridPanel,{master_column_id:0,initComponent:function(){this.initComponentPreOverride();
CQ.Ext.ux.maximgb.tg.EditorGridPanel.superclass.initComponent.call(this);
this.getSelectionModel().on("selectionchange",this.onTreeGridSelectionChange,this);
this.initComponentPostOverride()
},initComponentPreOverride:CQ.Ext.emptyFn,initComponentPostOverride:CQ.Ext.emptyFn,onRender:function(b,a){CQ.Ext.ux.maximgb.tg.EditorGridPanel.superclass.onRender.call(this,b,a);
this.el.addClass("ux-maximgb-tg-panel")
},getView:function(){if(!this.view){this.view=new CQ.Ext.ux.maximgb.tg.GridView(this.viewConfig)
}return this.view
},onClick:function(c){var g=c.getTarget(),k=this.getView(),o=k.findRowIndex(g),m=this.getStore(),a=this.getSelectionModel(),b,j,n=true;
if(o!==false){if(CQ.Ext.fly(g).hasClass("ux-maximgb-tg-elbow-active")){b=m.getAt(o);
if(m.isExpandedNode(b)){m.collapseNode(b)
}else{m.expandNode(b)
}n=false
}}if(n){CQ.Ext.ux.maximgb.tg.EditorGridPanel.superclass.onClick.call(this,c)
}},onMouseDown:function(b){var a=b.getTarget();
if(!CQ.Ext.fly(a).hasClass("ux-maximgb-tg-elbow-active")){CQ.Ext.ux.maximgb.tg.EditorGridPanel.superclass.onMouseDown.call(this,b)
}},onTreeGridSelectionChange:function(j,g){var a,c,b=this.getStore();
if(j.getSelected){a=j.getSelected();
b.setActiveNode(a)
}else{if(j.getSelectedCell&&g){a=g.record;
b.setActiveNode(a)
}}if(a){if(!b.isVisibleNode(a)){c=b.getNodeAncestors(a);
while(c.length>0){b.expandNode(c.pop())
}}}}});
CQ.Ext.ux.maximgb.tg.PagingToolbar=CQ.Ext.extend(CQ.Ext.PagingToolbar,{onRender:function(b,a){CQ.Ext.ux.maximgb.tg.PagingToolbar.superclass.onRender.call(this,b,a);
this.updateUI()
},getPageData:function(){var a=0,b=0;
if(this.store){b=this.store.getActiveNodePageOffset();
a=this.store.getActiveNodeTotalCount()
}return{total:a,activePage:Math.ceil((b+this.pageSize)/this.pageSize),pages:a<this.pageSize?1:Math.ceil(a/this.pageSize)}
},updateInfo:function(){var b=0,g=0,a=0,c;
if(this.displayItem){if(this.store){g=this.store.getActiveNodePageOffset();
b=this.store.getActiveNodeCount();
a=this.store.getActiveNodeTotalCount()
}c=b==0?this.emptyMsg:String.format(this.displayMsg,g+1,g+b,a);
this.displayItem.setText(c)
}},updateUI:function(){var c=this.getPageData(),a=c.activePage,b=c.pages;
this.afterTextItem.setText(String.format(this.afterPageText,c.pages));
this.inputItem.setValue(a);
this.first.setDisabled(a==1);
this.prev.setDisabled(a==1);
this.next.setDisabled(a==b);
this.last.setDisabled(a==b);
this.refresh.enable();
this.updateInfo()
},bindStore:function(a,b){if(!b&&this.store){this.store.un("activenodechange",this.onStoreActiveNodeChange,this)
}if(a){a.on("activenodechange",this.onStoreActiveNodeChange,this)
}CQ.Ext.ux.maximgb.tg.PagingToolbar.superclass.bindStore.call(this,a,b)
},beforeLoad:function(a,b){var c=this.getParams();
CQ.Ext.ux.maximgb.tg.PagingToolbar.superclass.beforeLoad.call(this,a,b);
if(b&&b.params){if(b.params[c.start]===undefined){b.params[c.start]=0
}if(b.params[c.limit]===undefined){b.params[c.limit]=this.pageSize
}}},moveFirst:function(){this.doLoad(0)
},movePrevious:function(){var a=this.store,b=a?a.getActiveNodePageOffset():0;
this.doLoad(Math.max(0,b-this.pageSize))
},moveNext:function(){var a=this.store,b=a?a.getActiveNodePageOffset():0;
this.doLoad(b+this.pageSize)
},moveLast:function(){var b=this.store,g=b?b.getActiveNodePageOffset():0,c=b?b.getActiveNodeTotalCount():0,a=c%this.pageSize;
this.doLoad(a?(c-a):c-this.pageSize)
},onStoreActiveNodeChange:function(b,c,a){if(this.rendered){this.updateUI()
}}});
CQ.Ext.reg("CQ.Ext.ux.maximgb.tg.GridPanel",CQ.Ext.ux.maximgb.tg.GridPanel);
CQ.Ext.reg("CQ.Ext.ux.maximgb.tg.EditorGridPanel",CQ.Ext.ux.maximgb.tg.EditorGridPanel);
CQ.Ext.reg("CQ.Ext.ux.maximgb.tg.PagingToolbar",CQ.Ext.ux.maximgb.tg.PagingToolbar);
CQ.menu.TitleSeparator=CQ.Ext.extend(CQ.Ext.menu.Separator,{title:null,constructor:function(a){a=a||{};
CQ.Util.applyDefaults(a,{title:"&#160;"});
CQ.menu.TitleSeparator.superclass.constructor.call(this,a)
},onRender:function(a){var b=document.createElement("span");
b.className=this.itemCls+" cq-menu-title-sep";
b.innerHTML=this.title;
this.el=b;
a.addClass("x-menu-sep-li");
a.addClass("cq-menu-title-sep-li");
CQ.Ext.menu.Separator.superclass.onRender.apply(this,arguments)
}});
CQ.Ext.reg("titleseparator",CQ.menu.TitleSeparator);
var SWFUpload=function(a){this.initSWFUpload(a)
};
SWFUpload.prototype.initSWFUpload=function(b){try{this.customSettings={};
this.settings=b;
this.eventQueue=[];
this.movieName="SWFUpload_"+SWFUpload.movieCount++;
this.movieElement=null;
SWFUpload.instances[this.movieName]=this;
this.initSettings();
this.loadFlash();
this.displayDebugInfo()
}catch(a){delete SWFUpload.instances[this.movieName];
throw a
}};
SWFUpload.instances={};
SWFUpload.movieCount=0;
SWFUpload.version="2.3.0";
SWFUpload.QUEUE_ERROR={QUEUE_LIMIT_EXCEEDED:-100,FILE_EXCEEDS_SIZE_LIMIT:-110,ZERO_BYTE_FILE:-120,INVALID_FILETYPE:-130};
SWFUpload.UPLOAD_ERROR={HTTP_ERROR:-200,MISSING_UPLOAD_URL:-210,IO_ERROR:-220,SECURITY_ERROR:-230,UPLOAD_LIMIT_EXCEEDED:-240,UPLOAD_FAILED:-250,SPECIFIED_FILE_ID_NOT_FOUND:-260,FILE_VALIDATION_FAILED:-270,FILE_CANCELLED:-280,UPLOAD_STOPPED:-290};
SWFUpload.FILE_STATUS={QUEUED:-1,IN_PROGRESS:-2,ERROR:-3,COMPLETE:-4,CANCELLED:-5};
SWFUpload.BUTTON_ACTION={SELECT_FILE:-100,SELECT_FILES:-110,START_UPLOAD:-120};
SWFUpload.prototype.initSettings=function(){this.ensureDefault=function(b,a){this.settings[b]=(this.settings[b]==undefined)?a:this.settings[b]
};
this.ensureDefault("upload_url","");
this.ensureDefault("file_post_name","Filedata");
this.ensureDefault("post_params",{});
this.ensureDefault("use_query_string",false);
this.ensureDefault("requeue_on_error",false);
this.ensureDefault("file_types","*.*");
this.ensureDefault("file_types_description","All Files");
this.ensureDefault("file_size_limit",0);
this.ensureDefault("file_upload_limit",0);
this.ensureDefault("file_queue_limit",0);
this.ensureDefault("flash_url","swfupload.swf");
this.ensureDefault("prevent_swf_caching",true);
this.ensureDefault("button_image_url","");
this.ensureDefault("button_width",1);
this.ensureDefault("button_height",1);
this.ensureDefault("button_text","");
this.ensureDefault("button_text_style","color: #000000; font-size: 16pt;");
this.ensureDefault("button_text_top_padding",0);
this.ensureDefault("button_text_left_padding",0);
this.ensureDefault("button_action",SWFUpload.BUTTON_ACTION.SELECT_FILES);
this.ensureDefault("button_disabled",false);
this.ensureDefault("button_placeholder_id",null);
this.ensureDefault("debug",false);
this.settings.debug_enabled=this.settings.debug;
this.settings.return_upload_start_handler=this.returnUploadStart;
this.ensureDefault("swfupload_loaded_handler",null);
this.ensureDefault("file_dialog_start_handler",null);
this.ensureDefault("files_selected_handler",null);
this.ensureDefault("file_queued_handler",null);
this.ensureDefault("file_queue_error_handler",null);
this.ensureDefault("file_dialog_complete_handler",null);
this.ensureDefault("upload_start_handler",null);
this.ensureDefault("upload_progress_handler",null);
this.ensureDefault("upload_error_handler",null);
this.ensureDefault("upload_success_handler",null);
this.ensureDefault("upload_complete_handler",null);
this.ensureDefault("debug_handler",this.debugMessage);
this.ensureDefault("custom_settings",{});
this.customSettings=this.settings.custom_settings;
if(this.settings.prevent_swf_caching){this.settings.flash_url=CQ.shared.HTTP.getXhrHookedURL(this.settings.flash_url+"?swfuploadrnd="+Math.floor(Math.random()*999999999))
}delete this.ensureDefault
};
SWFUpload.prototype.loadFlash=function(){if(this.settings.button_placeholder_id!==""){this.replaceWithFlash()
}else{this.appendFlash()
}};
SWFUpload.prototype.appendFlash=function(){var b,a;
if(document.getElementById(this.movieName)!==null){throw"ID "+this.movieName+" is already in use. The Flash Object could not be added"
}b=document.getElementsByTagName("body")[0];
if(b==undefined){throw"Could not find the 'body' element."
}a=document.createElement("div");
a.style.width="1px";
a.style.height="1px";
a.style.overflow="hidden";
b.appendChild(a);
a.innerHTML=this.getFlashHTML()
};
SWFUpload.prototype.replaceWithFlash=function(){var a,b;
if(document.getElementById(this.movieName)!==null){throw"ID "+this.movieName+" is already in use. The Flash Object could not be added"
}a=document.getElementById(this.settings.button_placeholder_id);
if(a==undefined){throw"Could not find the placeholder element."
}b=document.createElement("div");
b.innerHTML=this.getFlashHTML();
a.parentNode.replaceChild(b.firstChild,a)
};
SWFUpload.prototype.getFlashHTML=function(){var a=this.settings.button_image_url===""?true:false;
return['<object id="',this.movieName,'" type="application/x-shockwave-flash" data="',this.settings.flash_url,'" width="',this.settings.button_width,'" height="',this.settings.button_height,'" class="swfupload">','<param name="wmode" value="',a?"transparent":"window",'" />','<param name="movie" value="',this.settings.flash_url,'" />','<param name="quality" value="high" />','<param name="menu" value="false" />','<param name="allowScriptAccess" value="sameDomain" />','<param name="flashvars" value="'+this.getFlashVars()+'" />',"</object>"].join("")
};
SWFUpload.prototype.getFlashVars=function(){var a=this.buildParamString();
return["movieName=",encodeURIComponent(this.movieName),"&amp;uploadURL=",encodeURIComponent(this.settings.upload_url),"&amp;useQueryString=",encodeURIComponent(this.settings.use_query_string),"&amp;requeueOnError=",encodeURIComponent(this.settings.requeue_on_error),"&amp;params=",encodeURIComponent(a),"&amp;filePostName=",encodeURIComponent(this.settings.file_post_name),"&amp;fileTypes=",encodeURIComponent(this.settings.file_types),"&amp;fileTypesDescription=",encodeURIComponent(this.settings.file_types_description),"&amp;fileSizeLimit=",encodeURIComponent(this.settings.file_size_limit),"&amp;fileUploadLimit=",encodeURIComponent(this.settings.file_upload_limit),"&amp;fileQueueLimit=",encodeURIComponent(this.settings.file_queue_limit),"&amp;debugEnabled=",encodeURIComponent(this.settings.debug_enabled),"&amp;buttonImageURL=",encodeURIComponent(this.settings.button_image_url),"&amp;buttonWidth=",encodeURIComponent(this.settings.button_width),"&amp;buttonHeight=",encodeURIComponent(this.settings.button_height),"&amp;buttonText=",encodeURIComponent(this.settings.button_text),"&amp;buttonTextTopPadding=",encodeURIComponent(this.settings.button_text_top_padding),"&amp;buttonTextLeftPadding=",encodeURIComponent(this.settings.button_text_left_padding),"&amp;buttonTextStyle=",encodeURIComponent(this.settings.button_text_style),"&amp;buttonAction=",encodeURIComponent(this.settings.button_action),"&amp;buttonDisabled=",encodeURIComponent(this.settings.button_disabled)].join("")
};
SWFUpload.prototype.getMovieElement=function(){if(this.movieElement==undefined){this.movieElement=document.getElementById(this.movieName)
}if(this.movieElement===null){throw"Could not find Flash element"
}return this.movieElement
};
SWFUpload.prototype.buildParamString=function(){var c=this.settings.post_params;
var b=[];
if(typeof(c)==="object"){for(var a in c){if(c.hasOwnProperty(a)){b.push(encodeURIComponent(a.toString())+"="+encodeURIComponent(c[a].toString()))
}}}return b.join("&amp;")
};
SWFUpload.prototype.destroy=function(){try{this.stopUpload();
var b=null;
try{b=this.getMovieElement()
}catch(c){}if(b!=undefined&&b.parentNode!=undefined&&typeof b.parentNode.removeChild==="function"){var a=b.parentNode;
if(a!=undefined){a.removeChild(b);
if(a.parentNode!=undefined&&typeof a.parentNode.removeChild==="function"){a.parentNode.removeChild(a)
}}}SWFUpload.instances[this.movieName]=null;
delete SWFUpload.instances[this.movieName];
delete this.movieElement;
delete this.settings;
delete this.customSettings;
delete this.eventQueue;
delete this.movieName;
if(window[this.movieName]){delete window[this.movieName]
}return true
}catch(g){return false
}};
SWFUpload.prototype.displayDebugInfo=function(){this.debug(["---SWFUpload Instance Info---\n","Version: ",SWFUpload.version,"\n","Movie Name: ",this.movieName,"\n","Settings:\n","\t","upload_url:               ",this.settings.upload_url,"\n","\t","flash_url:                ",this.settings.flash_url,"\n","\t","use_query_string:         ",this.settings.use_query_string.toString(),"\n","\t","file_post_name:           ",this.settings.file_post_name,"\n","\t","post_params:              ",this.settings.post_params.toString(),"\n","\t","file_types:               ",this.settings.file_types,"\n","\t","file_types_description:   ",this.settings.file_types_description,"\n","\t","file_size_limit:          ",this.settings.file_size_limit,"\n","\t","file_upload_limit:        ",this.settings.file_upload_limit,"\n","\t","file_queue_limit:         ",this.settings.file_queue_limit,"\n","\t","debug:                    ",this.settings.debug.toString(),"\n","\t","prevent_swf_caching:      ",this.settings.prevent_swf_caching.toString(),"\n","\t","button_placeholder_id:    ",this.settings.button_placeholder_id.toString(),"\n","\t","button_image_url:         ",this.settings.button_image_url.toString(),"\n","\t","button_width:             ",this.settings.button_width.toString(),"\n","\t","button_height:            ",this.settings.button_height.toString(),"\n","\t","button_text:              ",this.settings.button_text.toString(),"\n","\t","button_text_style:        ",this.settings.button_text_style.toString(),"\n","\t","button_text_top_padding:  ",this.settings.button_text_top_padding.toString(),"\n","\t","button_text_left_padding: ",this.settings.button_text_left_padding.toString(),"\n","\t","button_action:            ",this.settings.button_action.toString(),"\n","\t","button_disabled:          ",this.settings.button_disabled.toString(),"\n","\t","custom_settings:          ",this.settings.custom_settings.toString(),"\n","Event Handlers:\n","\t","swfupload_loaded_handler assigned:  ",(typeof this.settings.swfupload_loaded_handler==="function").toString(),"\n","\t","file_dialog_start_handler assigned: ",(typeof this.settings.file_dialog_start_handler==="function").toString(),"\n","\t","files_selected_handler assigned:    ",(typeof this.settings.files_seleted_handler==="function").toString(),"\n","\t","file_queued_handler assigned:       ",(typeof this.settings.file_queued_handler==="function").toString(),"\n","\t","file_queue_error_handler assigned:  ",(typeof this.settings.file_queue_error_handler==="function").toString(),"\n","\t","upload_start_handler assigned:      ",(typeof this.settings.upload_start_handler==="function").toString(),"\n","\t","upload_progress_handler assigned:   ",(typeof this.settings.upload_progress_handler==="function").toString(),"\n","\t","upload_error_handler assigned:      ",(typeof this.settings.upload_error_handler==="function").toString(),"\n","\t","upload_success_handler assigned:    ",(typeof this.settings.upload_success_handler==="function").toString(),"\n","\t","upload_complete_handler assigned:   ",(typeof this.settings.upload_complete_handler==="function").toString(),"\n","\t","debug_handler assigned:             ",(typeof this.settings.debug_handler==="function").toString(),"\n"].join(""))
};
SWFUpload.prototype.addSetting=function(b,c,a){if(c==undefined){return(this.settings[b]=a)
}else{return(this.settings[b]=c)
}};
SWFUpload.prototype.getSetting=function(a){if(this.settings[a]!=undefined){return this.settings[a]
}return""
};
SWFUpload.prototype.callFlash=function(c,g){g=g||[];
var a=this.getMovieElement();
var b;
if(typeof a[c]==="function"){if(g.length===0){b=a[c]()
}else{if(g.length===1){b=a[c](g[0])
}else{if(g.length===2){b=a[c](g[0],g[1])
}else{if(g.length===3){b=a[c](g[0],g[1],g[2])
}else{throw"Too many arguments"
}}}}if(b!=undefined&&typeof b.post==="object"){b=this.unescapeFilePostParams(b)
}return b
}else{throw"Invalid function name: "+c
}};
SWFUpload.prototype.selectFile=function(){this.callFlash("SelectFile")
};
SWFUpload.prototype.selectFiles=function(){this.callFlash("SelectFiles")
};
SWFUpload.prototype.startUpload=function(a){this.callFlash("StartUpload",[a])
};
SWFUpload.prototype.cancelUpload=function(a){this.callFlash("CancelUpload",[a])
};
SWFUpload.prototype.stopUpload=function(){this.callFlash("StopUpload")
};
SWFUpload.prototype.getStats=function(){return this.callFlash("GetStats")
};
SWFUpload.prototype.setStats=function(a){this.callFlash("SetStats",[a])
};
SWFUpload.prototype.getFile=function(a){if(typeof(a)==="number"){return this.callFlash("GetFileByIndex",[a])
}else{return this.callFlash("GetFile",[a])
}};
SWFUpload.prototype.addFileParam=function(a,b,c){return this.callFlash("AddFileParam",[a,b,c])
};
SWFUpload.prototype.removeFileParam=function(a,b){this.callFlash("RemoveFileParam",[a,b])
};
SWFUpload.prototype.setUploadURL=function(a){this.settings.upload_url=CQ.shared.HTTP.getXhrHookedURL(a.toString());
this.callFlash("SetUploadURL",[a])
};
SWFUpload.prototype.setPostParams=function(a){this.settings.post_params=a;
this.callFlash("SetPostParams",[a])
};
SWFUpload.prototype.addPostParam=function(a,b){this.settings.post_params[a]=b;
this.callFlash("SetPostParams",[this.settings.post_params])
};
SWFUpload.prototype.removePostParam=function(a){delete this.settings.post_params[a];
this.callFlash("SetPostParams",[this.settings.post_params])
};
SWFUpload.prototype.setFileTypes=function(a,b){this.settings.file_types=a;
this.settings.file_types_description=b;
this.callFlash("SetFileTypes",[a,b])
};
SWFUpload.prototype.setFileSizeLimit=function(a){this.settings.file_size_limit=a;
this.callFlash("SetFileSizeLimit",[a])
};
SWFUpload.prototype.setFileUploadLimit=function(a){this.settings.file_upload_limit=a;
this.callFlash("SetFileUploadLimit",[a])
};
SWFUpload.prototype.setFileQueueLimit=function(a){this.settings.file_queue_limit=a;
this.callFlash("SetFileQueueLimit",[a])
};
SWFUpload.prototype.setFilePostName=function(a){this.settings.file_post_name=a;
this.callFlash("SetFilePostName",[a])
};
SWFUpload.prototype.setUseQueryString=function(a){this.settings.use_query_string=a;
this.callFlash("SetUseQueryString",[a])
};
SWFUpload.prototype.setRequeueOnError=function(a){this.settings.requeue_on_error=a;
this.callFlash("SetRequeueOnError",[a])
};
SWFUpload.prototype.setDebugEnabled=function(a){this.settings.debug_enabled=a;
this.callFlash("SetDebugEnabled",[a])
};
SWFUpload.prototype.setButtonImageURL=function(a){if(a==undefined){a=""
}this.settings.button_image_url=a;
this.callFlash("SetButtonImageURL",[a])
};
SWFUpload.prototype.setButtonDimensions=function(c,a){this.settings.button_width=c;
this.settings.button_height=a;
var b=this.getMovieElement();
if(b!=undefined){b.style.width=c+"px";
b.style.height=a+"px"
}this.callFlash("SetButtonDimensions",[c,a])
};
SWFUpload.prototype.setButtonText=function(a){this.settings.button_text=a;
this.callFlash("SetButtonText",[a])
};
SWFUpload.prototype.setButtonTextPadding=function(b,a){this.settings.button_text_top_padding=a;
this.settings.button_text_left_padding=b;
this.callFlash("SetButtonTextPadding",[b,a])
};
SWFUpload.prototype.setButtonTextStyle=function(a){this.settings.button_text_style=a;
this.callFlash("SetButtonTextStyle",[a])
};
SWFUpload.prototype.setButtonDisabled=function(a){this.settings.button_disabled=a;
this.callFlash("SetButtonDisabled",[a])
};
SWFUpload.prototype.setButtonAction=function(a){this.settings.button_action=a;
this.callFlash("SetButtonAction",[a])
};
SWFUpload.prototype.queueEvent=function(b,c){if(c==undefined){c=[]
}else{if(!(c instanceof Array)){c=[c]
}}var a=this;
if(typeof this.settings[b]==="function"){this.eventQueue.push(function(){this.settings[b].apply(this,c)
});
setTimeout(function(){a.executeNextEvent()
},0)
}else{if(this.settings[b]!==null){throw"Event handler "+b+" is unknown or is not a function"
}}};
SWFUpload.prototype.executeNextEvent=function(){var a=this.eventQueue?this.eventQueue.shift():null;
if(typeof(a)==="function"){a.apply(this)
}};
SWFUpload.prototype.unescapeFilePostParams=function(c){var j=/[$]([0-9a-f]{4})/i;
var m={};
var g;
if(c!=undefined){for(var a in c.post){if(c.post.hasOwnProperty(a)){g=a;
var b;
while((b=j.exec(g))!==null){g=g.replace(b[0],String.fromCharCode(parseInt("0x"+b[1],16)))
}m[g]=c.post[a]
}}c.post=m
}return c
};
SWFUpload.prototype.flashReady=function(){var a=this.getMovieElement();
if(typeof a.StartUpload!=="function"){throw"ExternalInterface methods failed to initialize."
}if(window[this.movieName]==undefined){window[this.movieName]=a
}this.queueEvent("swfupload_loaded_handler")
};
SWFUpload.prototype.fileDialogStart=function(){this.queueEvent("file_dialog_start_handler")
};
SWFUpload.prototype.filesSelected=function(){this.queueEvent("files_selected_handler")
};
SWFUpload.prototype.fileQueued=function(a){a=this.unescapeFilePostParams(a);
this.queueEvent("file_queued_handler",a)
};
SWFUpload.prototype.fileQueueError=function(a,c,b){a=this.unescapeFilePostParams(a);
this.queueEvent("file_queue_error_handler",[a,c,b])
};
SWFUpload.prototype.fileDialogComplete=function(a,b){this.queueEvent("file_dialog_complete_handler",[a,b])
};
SWFUpload.prototype.uploadStart=function(a){a=this.unescapeFilePostParams(a);
this.queueEvent("return_upload_start_handler",a)
};
SWFUpload.prototype.returnUploadStart=function(a){var b;
if(typeof this.settings.upload_start_handler==="function"){a=this.unescapeFilePostParams(a);
b=this.settings.upload_start_handler.call(this,a)
}else{if(this.settings.upload_start_handler!=undefined){throw"upload_start_handler must be a function"
}}if(b===undefined){b=true
}b=!!b;
this.callFlash("ReturnUploadStart",[b])
};
SWFUpload.prototype.uploadProgress=function(a,c,b){a=this.unescapeFilePostParams(a);
this.queueEvent("upload_progress_handler",[a,c,b])
};
SWFUpload.prototype.uploadError=function(a,c,b){a=this.unescapeFilePostParams(a);
this.queueEvent("upload_error_handler",[a,c,b])
};
SWFUpload.prototype.uploadSuccess=function(b,a){b=this.unescapeFilePostParams(b);
this.queueEvent("upload_success_handler",[b,a])
};
SWFUpload.prototype.uploadComplete=function(a){a=this.unescapeFilePostParams(a);
this.queueEvent("upload_complete_handler",a)
};
SWFUpload.prototype.debug=function(a){this.queueEvent("debug_handler",a)
};
SWFUpload.prototype.debugMessage=function(c){if(this.settings.debug){var a,g=[];
if(typeof c==="object"&&typeof c.name==="string"&&typeof c.message==="string"){for(var b in c){if(c.hasOwnProperty(b)){g.push(b+": "+c[b])
}}a=g.join("\n")||"";
g=a.split("\n");
a="EXCEPTION: "+g.join("\nEXCEPTION: ");
SWFUpload.Console.writeLine(a)
}else{SWFUpload.Console.writeLine(c)
}}};
SWFUpload.Console={};
SWFUpload.Console.writeLine=function(g){var b,a;
try{b=document.getElementById("SWFUpload_Console");
if(!b){a=document.createElement("form");
document.getElementsByTagName("body")[0].appendChild(a);
b=document.createElement("textarea");
b.id="SWFUpload_Console";
b.style.fontFamily="monospace";
b.setAttribute("wrap","off");
b.wrap="off";
b.style.overflow="auto";
b.style.width="700px";
b.style.height="350px";
b.style.margin="5px";
a.appendChild(b)
}b.value+=g+"\n";
b.scrollTop=b.scrollHeight-b.clientHeight
}catch(c){alert("Exception: "+c.name+" Message: "+c.message)
}};
if(!document.createElement("canvas").getContext){(function(){var Y=Math;
var t=Y.round;
var r=Y.sin;
var B=Y.cos;
var H=Y.abs;
var N=Y.sqrt;
var g=10;
var n=g/2;
function ad(j){return String(j).replace(/&/g,"&amp;").replace(/"/g,"&quot;")
}function R(m){if(!m.namespaces.g_vml_){m.namespaces.add("g_vml_","urn:schemas-microsoft-com:vml","#default#VML")
}if(!m.namespaces.g_o_){m.namespaces.add("g_o_","urn:schemas-microsoft-com:office:office","#default#VML")
}if(!m.styleSheets.ex_canvas_){var j=m.createStyleSheet();
j.owningElement.id="ex_canvas_";
j.cssText="canvas{display:inline-block;overflow:hidden;text-align:left;width:300px;height:150px}"
}}R(document);
var k={init:function(Z){var af=Z||document;
if(/MSIE/.test(navigator.userAgent)&&!window.opera){var j=this;
var m=function(){j.init_(af)
};
af.attachEvent("onreadystatechange",m);
var ae=document.parentWindow;
var ag=function(){af.detachEvent("onreadystatechange",m);
ae.detachEvent("onunload",ag)
};
ae.attachEvent("onunload",ag)
}},init_:function(Z){var m=Z.getElementsByTagName("canvas");
for(var j=0;
j<m.length;
j++){this.initElement(m[j])
}},fixElement_:function(Z){var af=Z.outerHTML;
var ae=Z.ownerDocument.createElement(af);
if(af.slice(-2)!="/>"){var j="/"+Z.tagName;
var m;
while((m=Z.nextSibling)&&m.tagName!=j){m.removeNode()
}if(m){m.removeNode()
}}Z.parentNode.replaceChild(ae,Z);
return ae
},initElement:function(m){m=this.fixElement_(m);
m.getContext=function(){if(this.context_){return this.context_
}return this.context_=new D(this)
};
R(m.ownerDocument);
m.innerHTML="";
m.attachEvent("onpropertychange",A);
m.attachEvent("onresize",V);
var j=m.attributes;
if(j.width&&j.width.specified){m.style.width=j.width.nodeValue+"px"
}else{m.width=m.clientWidth
}if(j.height&&j.height.specified){m.style.height=j.height.nodeValue+"px"
}else{m.height=m.clientHeight
}return m
}};
function A(m){var j=m.srcElement;
switch(m.propertyName){case"width":j.getContext().clearRect();
j.style.width=j.attributes.width.nodeValue+"px";
j.firstChild.style.width=j.clientWidth+"px";
break;
case"height":j.getContext().clearRect();
j.style.height=j.attributes.height.nodeValue+"px";
j.firstChild.style.height=j.clientHeight+"px";
break
}}function V(m){var j=m.srcElement;
if(j.firstChild){j.firstChild.style.width=j.clientWidth+"px";
j.firstChild.style.height=j.clientHeight+"px"
}}k.init();
var q=[];
for(var ac=0;
ac<16;
ac++){for(var ab=0;
ab<16;
ab++){q[ac*16+ab]=ac.toString(16)+ab.toString(16)
}}function C(){return[[1,0,0],[0,1,0],[0,0,1]]
}function J(ae,Z){var m=C();
for(var j=0;
j<3;
j++){for(var ah=0;
ah<3;
ah++){var af=0;
for(var ag=0;
ag<3;
ag++){af+=ae[j][ag]*Z[ag][ah]
}m[j][ah]=af
}}return m
}function y(m,j){j.fillStyle=m.fillStyle;
j.lineCap=m.lineCap;
j.lineJoin=m.lineJoin;
j.lineWidth=m.lineWidth;
j.miterLimit=m.miterLimit;
j.shadowBlur=m.shadowBlur;
j.shadowColor=m.shadowColor;
j.shadowOffsetX=m.shadowOffsetX;
j.shadowOffsetY=m.shadowOffsetY;
j.strokeStyle=m.strokeStyle;
j.font=m.font;
j.textAlign=m.textAlign;
j.textBaseline=m.textBaseline;
j.arcScaleX_=m.arcScaleX_;
j.arcScaleY_=m.arcScaleY_;
j.lineScale_=m.lineScale_;
j.rotation_=m.rotation_
}var b={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgreen:"#006400",darkgrey:"#A9A9A9",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",grey:"#808080",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgreen:"#90EE90",lightgrey:"#D3D3D3",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",oldlace:"#FDF5E6",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",whitesmoke:"#F5F5F5",yellowgreen:"#9ACD32"};
function M(m){var ae=m.indexOf("(",3);
var j=m.indexOf(")",ae+1);
var Z=m.substring(ae+1,j).split(",");
if(Z.length==4&&m.substr(3,1)=="a"){alpha=Number(Z[3])
}else{Z[3]=1
}return Z
}function c(j){return parseFloat(j)/100
}function w(m,Z,j){return Math.min(j,Math.max(Z,m))
}function I(ag){var Z,m,j;
h=parseFloat(ag[0])/360%360;
if(h<0){h++
}s=w(c(ag[1]),0,1);
l=w(c(ag[2]),0,1);
if(s==0){Z=m=j=l
}else{var ae=l<0.5?l*(1+s):l+s-l*s;
var af=2*l-ae;
Z=a(af,ae,h+1/3);
m=a(af,ae,h);
j=a(af,ae,h-1/3)
}return"#"+q[Math.floor(Z*255)]+q[Math.floor(m*255)]+q[Math.floor(j*255)]
}function a(m,j,Z){if(Z<0){Z++
}if(Z>1){Z--
}if(6*Z<1){return m(j-m)*6*Z
}else{if(2*Z<1){return j
}else{if(3*Z<2){return m+(j-m)*(2/3-Z)*6
}else{return m
}}}}function F(j){var af,ae=1;
j=String(j);
if(j.charAt(0)=="#"){af=j
}else{if(/^rgb/.test(j)){var Z=M(j);
var af="#",ag;
for(var m=0;
m<3;
m++){if(Z[m].indexOf("%")!=-1){ag=Math.floor(c(Z[m])*255)
}else{ag=Number(Z[m])
}af+=q[w(ag,0,255)]
}ae=Z[3]
}else{if(/^hsl/.test(j)){var Z=M(j);
af=I(Z);
ae=Z[3]
}else{af=b[j]||j
}}}return{color:af,alpha:ae}
}var u={style:"normal",variant:"normal",weight:"normal",size:10,family:"sans-serif"};
var L={};
function E(j){if(L[j]){return L[j]
}var ae=document.createElement("div");
var Z=ae.style;
try{Z.font=j
}catch(m){}return L[j]={style:Z.fontStyle||u.style,variant:Z.fontVariant||u.variant,weight:Z.fontWeight||u.weight,size:Z.fontSize||u.size,family:Z.fontFamily||u.family}
}function x(Z,m){var j={};
for(var ag in Z){j[ag]=Z[ag]
}var af=parseFloat(m.currentStyle.fontSize),ae=parseFloat(Z.size);
if(typeof Z.size=="number"){j.size=Z.size
}else{if(Z.size.indexOf("px")!=-1){j.size=ae
}else{if(Z.size.indexOf("em")!=-1){j.size=af*ae
}else{if(Z.size.indexOf("%")!=-1){j.size=(af/100)*ae
}else{if(Z.size.indexOf("pt")!=-1){j.size=af*(4/3)*ae
}else{j.size=af
}}}}}j.size*=0.981;
return j
}function aa(j){return j.style+" "+j.variant+" "+j.weight+" "+j.size+"px "+j.family
}function S(j){switch(j){case"butt":return"flat";
case"round":return"round";
case"square":default:return"square"
}}function D(m){this.m_=C();
this.mStack_=[];
this.aStack_=[];
this.currentPath_=[];
this.strokeStyle="#000";
this.fillStyle="#000";
this.lineWidth=1;
this.lineJoin="miter";
this.lineCap="butt";
this.miterLimit=g*1;
this.globalAlpha=1;
this.font="10px sans-serif";
this.textAlign="left";
this.textBaseline="alphabetic";
this.canvas=m;
var j=m.ownerDocument.createElement("div");
j.style.width=m.clientWidth+"px";
j.style.height=m.clientHeight+"px";
j.style.overflow="hidden";
j.style.position="absolute";
m.appendChild(j);
this.element_=j;
this.arcScaleX_=1;
this.arcScaleY_=1;
this.lineScale_=1;
this.rotation_=0
}var v=D.prototype;
v.clearRect=function(){if(this.textMeasureEl_){this.textMeasureEl_.removeNode(true);
this.textMeasureEl_=null
}this.element_.innerHTML=""
};
v.beginPath=function(){this.currentPath_=[]
};
v.moveTo=function(m,j){var Z=this.getCoords_(m,j);
this.currentPath_.push({type:"moveTo",x:Z.x,y:Z.y});
this.currentX_=Z.x;
this.currentY_=Z.y
};
v.lineTo=function(m,j){var Z=this.getCoords_(m,j);
this.currentPath_.push({type:"lineTo",x:Z.x,y:Z.y});
this.currentX_=Z.x;
this.currentY_=Z.y
};
v.bezierCurveTo=function(Z,m,aj,ai,ah,af){var j=this.getCoords_(ah,af);
var ag=this.getCoords_(Z,m);
var ae=this.getCoords_(aj,ai);
K(this,ag,ae,j)
};
function K(j,ae,Z,m){j.currentPath_.push({type:"bezierCurveTo",cp1x:ae.x,cp1y:ae.y,cp2x:Z.x,cp2y:Z.y,x:m.x,y:m.y});
j.currentX_=m.x;
j.currentY_=m.y
}v.quadraticCurveTo=function(ah,Z,m,j){var ag=this.getCoords_(ah,Z);
var af=this.getCoords_(m,j);
var ai={x:this.currentX_+2/3*(ag.x-this.currentX_),y:this.currentY_+2/3*(ag.y-this.currentY_)};
var ae={x:ai.x+(af.x-this.currentX_)/3,y:ai.y+(af.y-this.currentY_)/3};
K(this,ai,ae,af)
};
v.arc=function(ak,ai,aj,af,m,Z){aj*=g;
var ao=Z?"at":"wa";
var al=ak+B(af)*aj-n;
var an=ai+r(af)*aj-n;
var j=ak+B(m)*aj-n;
var am=ai+r(m)*aj-n;
if(al==j&&!Z){al+=0.125
}var ae=this.getCoords_(ak,ai);
var ah=this.getCoords_(al,an);
var ag=this.getCoords_(j,am);
this.currentPath_.push({type:ao,x:ae.x,y:ae.y,radius:aj,xStart:ah.x,yStart:ah.y,xEnd:ag.x,yEnd:ag.y})
};
v.rect=function(Z,m,j,ae){this.moveTo(Z,m);
this.lineTo(Z+j,m);
this.lineTo(Z+j,m+ae);
this.lineTo(Z,m+ae);
this.closePath()
};
v.strokeRect=function(Z,m,j,ae){var af=this.currentPath_;
this.beginPath();
this.moveTo(Z,m);
this.lineTo(Z+j,m);
this.lineTo(Z+j,m+ae);
this.lineTo(Z,m+ae);
this.closePath();
this.stroke();
this.currentPath_=af
};
v.fillRect=function(Z,m,j,ae){var af=this.currentPath_;
this.beginPath();
this.moveTo(Z,m);
this.lineTo(Z+j,m);
this.lineTo(Z+j,m+ae);
this.lineTo(Z,m+ae);
this.closePath();
this.fill();
this.currentPath_=af
};
v.createLinearGradient=function(m,ae,j,Z){var af=new U("gradient");
af.x0_=m;
af.y0_=ae;
af.x1_=j;
af.y1_=Z;
return af
};
v.createRadialGradient=function(ae,ag,Z,m,af,j){var ah=new U("gradientradial");
ah.x0_=ae;
ah.y0_=ag;
ah.r0_=Z;
ah.x1_=m;
ah.y1_=af;
ah.r1_=j;
return ah
};
v.drawImage=function(au){var ak,ai,am,aB,ar,ap,aw,aF;
var j=au.runtimeStyle.width;
if(j){var al=au.runtimeStyle.width;
var at=au.runtimeStyle.height;
au.runtimeStyle.width="auto";
au.runtimeStyle.height="auto"
}var aj=au.width;
var az=au.height;
if(j){au.runtimeStyle.width=al;
au.runtimeStyle.height=at
}if(arguments.length==3){ak=arguments[1];
ai=arguments[2];
ar=ap=0;
aw=am=aj;
aF=aB=az
}else{if(arguments.length==5){ak=arguments[1];
ai=arguments[2];
am=arguments[3];
aB=arguments[4];
ar=ap=0;
aw=aj;
aF=az
}else{if(arguments.length==9){ar=arguments[1];
ap=arguments[2];
aw=arguments[3];
aF=arguments[4];
ak=arguments[5];
ai=arguments[6];
am=arguments[7];
aB=arguments[8]
}else{throw Error("Invalid number of arguments")
}}}var aC=this.getCoords_(ak,ai);
var af=aw/2;
var ae=aF/2;
var aA=[];
var m=10;
var ah=10;
var aE=scaleY=1;
aA.push(' <div style="position:absolute;');
if(this.m_[0][0]!=1||this.m_[0][1]||this.m_[1][1]!=1||this.m_[1][0]){var ag=[];
var aD=B(this.rotation_);
var an=r(this.rotation_);
var ao=[[aD,-an,0],[an,aD,0],[0,0,1]];
var Z=J(ao,this.m_);
aE=Z[0][0];
scaleY=Z[1][1];
ag.push("M11=",aD,",","M12=",-an,",","M21=",an,",","M22=",aD,",","Dx=",aC.x/g,",","Dy=",aC.y/g);
var ay=aC;
var ax=this.getCoords_(ak+am,ai);
var av=this.getCoords_(ak,ai+aB);
var aq=this.getCoords_(ak+am,ai+aB);
ay.x=Y.max(ay.x,ax.x,av.x,aq.x);
ay.y=Y.max(ay.y,ax.y,av.y,aq.y);
aA.push("padding:0 ",t(ay.x/g),"px ",t(ay.y/g),"px 0;filter:progid:DXImageTransform.Microsoft.Matrix(",ag.join(""),", sizingmethod='clip');")
}else{aA.push("top:",t(aC.y/g),"px;left:",t(aC.x/g),"px;")
}aA.push(' ">');
if(ar||ap){aA.push('<div style="overflow: hidden; width:',Math.ceil((am+ar*am/aw)*aE),"px;"," height:",Math.ceil((aB+ap*aB/aF)*scaleY),"px;"," filter:progid:DxImageTransform.Microsoft.Matrix(Dx=",-ar*am/aw*aE,",Dy=",-ap*aB/aF*scaleY,');">')
}aA.push('<div style="width:',Math.round(aE*aj*am/aw),"px;"," height:",Math.round(scaleY*az*aB/aF),"px;"," filter:");
if(this.globalAlpha<1){aA.push(" progid:DXImageTransform.Microsoft.Alpha(opacity="+(this.globalAlpha*100)+")")
}aA.push(" progid:DXImageTransform.Microsoft.AlphaImageLoader(src=",au.src,',sizingMethod=scale)">');
if(ar||ap){aA.push("</div>")
}aA.push("</div></div>");
this.element_.insertAdjacentHTML("beforeEnd",aA.join(""))
};
v.stroke=function(aj){var ah=[];
var Z=false;
var m=10;
var ak=10;
ah.push("<g_vml_:shape",' filled="',!!aj,'"',' style="position:absolute;width:',m,"px;height:",ak,'px;"',' coordorigin="0,0"',' coordsize="',g*m,",",g*ak,'"',' stroked="',!aj,'"',' path="');
var al=false;
var ae={x:null,y:null};
var ai={x:null,y:null};
for(var af=0;
af<this.currentPath_.length;
af++){var j=this.currentPath_[af];
var ag;
switch(j.type){case"moveTo":ag=j;
ah.push(" m ",t(j.x),",",t(j.y));
break;
case"lineTo":ah.push(" l ",t(j.x),",",t(j.y));
break;
case"close":ah.push(" x ");
j=null;
break;
case"bezierCurveTo":ah.push(" c ",t(j.cp1x),",",t(j.cp1y),",",t(j.cp2x),",",t(j.cp2y),",",t(j.x),",",t(j.y));
break;
case"at":case"wa":ah.push(" ",j.type," ",t(j.x-this.arcScaleX_*j.radius),",",t(j.y-this.arcScaleY_*j.radius)," ",t(j.x+this.arcScaleX_*j.radius),",",t(j.y+this.arcScaleY_*j.radius)," ",t(j.xStart),",",t(j.yStart)," ",t(j.xEnd),",",t(j.yEnd));
break
}if(j){if(ae.x==null||j.x<ae.x){ae.x=j.x
}if(ai.x==null||j.x>ai.x){ai.x=j.x
}if(ae.y==null||j.y<ae.y){ae.y=j.y
}if(ai.y==null||j.y>ai.y){ai.y=j.y
}}}ah.push(' ">');
if(!aj){z(this,ah)
}else{G(this,ah,ae,ai)
}ah.push("</g_vml_:shape>");
this.element_.insertAdjacentHTML("beforeEnd",ah.join(""))
};
function z(Z,ag){var m=F(Z.strokeStyle);
var ae=m.color;
var af=m.alpha*Z.globalAlpha;
var j=Z.lineScale_*Z.lineWidth;
if(j<1){af*=j
}ag.push("<g_vml_:stroke",' opacity="',af,'"',' joinstyle="',Z.lineJoin,'"',' miterlimit="',Z.miterLimit,'"',' endcap="',S(Z.lineCap),'"',' weight="',j,'px"',' color="',ae,'" />')
}function G(ap,ah,aJ,aq){var ai=ap.fillStyle;
var aA=ap.arcScaleX_;
var az=ap.arcScaleY_;
var j=aq.x-aJ.x;
var Z=aq.y-aJ.y;
if(ai instanceof U){var am=0;
var aE={x:0,y:0};
var aw=0;
var al=1;
if(ai.type_=="gradient"){var ak=ai.x0_/aA;
var m=ai.y0_/az;
var aj=ai.x1_/aA;
var aL=ai.y1_/az;
var aI=ap.getCoords_(ak,m);
var aH=ap.getCoords_(aj,aL);
var af=aH.x-aI.x;
var ae=aH.y-aI.y;
am=Math.atan2(af,ae)*180/Math.PI;
if(am<0){am+=360
}if(am<0.000001){am=0
}}else{var aI=ap.getCoords_(ai.x0_,ai.y0_);
aE={x:(aI.x-aJ.x)/j,y:(aI.y-aJ.y)/Z};
j/=aA*g;
Z/=az*g;
var aC=Y.max(j,Z);
aw=2*ai.r0_/aC;
al=2*ai.r1_/aC-aw
}var au=ai.colors_;
au.sort(function(aN,aM){return aN.offset-aM.offset
});
var ao=au.length;
var at=au[0].color;
var ar=au[ao-1].color;
var ay=au[0].alpha*ap.globalAlpha;
var ax=au[ao-1].alpha*ap.globalAlpha;
var aD=[];
for(var aG=0;
aG<ao;
aG++){var an=au[aG];
aD.push(an.offset*al+aw+" "+an.color)
}ah.push('<g_vml_:fill type="',ai.type_,'"',' method="none" focus="100%"',' color="',at,'"',' color2="',ar,'"',' colors="',aD.join(","),'"',' opacity="',ax,'"',' g_o_:opacity2="',ay,'"',' angle="',am,'"',' focusposition="',aE.x,",",aE.y,'" />')
}else{if(ai instanceof T){if(j&&Z){var ag=-aJ.x;
var aB=-aJ.y;
ah.push("<g_vml_:fill",' position="',ag/j*aA*aA,",",aB/Z*az*az,'"',' type="tile"',' src="',ai.src_,'" />')
}}else{var aK=F(ap.fillStyle);
var av=aK.color;
var aF=aK.alpha*ap.globalAlpha;
ah.push('<g_vml_:fill color="',av,'" opacity="',aF,'" />')
}}}v.fill=function(){this.stroke(true)
};
v.closePath=function(){this.currentPath_.push({type:"close"})
};
v.getCoords_=function(ae,Z){var j=this.m_;
return{x:g*(ae*j[0][0]+Z*j[1][0]+j[2][0])-n,y:g*(ae*j[0][1]+Z*j[1][1]+j[2][1])-n}
};
v.save=function(){var j={};
y(this,j);
this.aStack_.push(j);
this.mStack_.push(this.m_);
this.m_=J(C(),this.m_)
};
v.restore=function(){if(this.aStack_.length){y(this.aStack_.pop(),this);
this.m_=this.mStack_.pop()
}};
function o(j){return isFinite(j[0][0])&&isFinite(j[0][1])&&isFinite(j[1][0])&&isFinite(j[1][1])&&isFinite(j[2][0])&&isFinite(j[2][1])
}function X(Z,j,ae){if(!o(j)){return
}Z.m_=j;
if(ae){var af=j[0][0]*j[1][1]-j[0][1]*j[1][0];
Z.lineScale_=N(H(af))
}}v.translate=function(Z,m){var j=[[1,0,0],[0,1,0],[Z,m,1]];
X(this,J(j,this.m_),false)
};
v.rotate=function(m){var ae=B(m);
var Z=r(m);
this.rotation_+=m;
var j=[[ae,Z,0],[-Z,ae,0],[0,0,1]];
X(this,J(j,this.m_),false)
};
v.scale=function(Z,m){this.arcScaleX_*=Z;
this.arcScaleY_*=m;
var j=[[Z,0,0],[0,m,0],[0,0,1]];
X(this,J(j,this.m_),true)
};
v.transform=function(af,ae,ah,ag,m,j){var Z=[[af,ae,0],[ah,ag,0],[m,j,1]];
X(this,J(Z,this.m_),true)
};
v.setTransform=function(ag,af,ai,ah,ae,Z){var j=[[ag,af,0],[ai,ah,0],[ae,Z,1]];
X(this,j,true)
};
v.drawText_=function(am,ak,aj,ap,ai){var ao=this.m_,at=1000,Z=0,ar=at,ah={x:0,y:0},ag=[];
var j=x(E(this.font),this.element_);
var ae=aa(j);
var au=this.element_.currentStyle;
var af=this.textAlign.toLowerCase();
switch(af){case"left":case"center":case"right":break;
case"end":af=au.direction=="ltr"?"right":"left";
break;
case"start":af=au.direction=="rtl"?"right":"left";
break;
default:af="left"
}switch(this.textBaseline){case"hanging":case"top":ah.y=j.size/1.75;
break;
case"middle":break;
default:case null:case"alphabetic":case"ideographic":case"bottom":ah.y=-j.size/2.25;
break
}switch(af){case"right":Z=at;
ar=0.05;
break;
case"center":Z=ar=at/2;
break
}var aq=this.getCoords_(ak+ah.x,aj+ah.y);
ag.push('<g_vml_:line from="',-Z,' 0" to="',ar,' 0.05" ',' coordsize="100 100" coordorigin="0 0"',' filled="',!ai,'" stroked="',!!ai,'" style="position:absolute;width:1px;height:1px;">');
if(ai){z(this,ag)
}else{G(this,ag,{x:-Z,y:0},{x:ar,y:j.size})
}var an=ao[0][0].toFixed(3)+","+ao[1][0].toFixed(3)+","+ao[0][1].toFixed(3)+","+ao[1][1].toFixed(3)+",0,0";
var al=t(aq.x/g)+","+t(aq.y/g);
ag.push('<g_vml_:skew on="t" matrix="',an,'" ',' offset="',al,'" origin="',Z,' 0" />','<g_vml_:path textpathok="true" />','<g_vml_:textpath on="true" string="',ad(am),'" style="v-text-align:',af,";font:",ad(ae),'" /></g_vml_:line>');
this.element_.insertAdjacentHTML("beforeEnd",ag.join(""))
};
v.fillText=function(Z,j,ae,m){this.drawText_(Z,j,ae,m,false)
};
v.strokeText=function(Z,j,ae,m){this.drawText_(Z,j,ae,m,true)
};
v.measureText=function(af){if(!this.textMeasureEl_){var m='<span style="position:absolute;top:-20000px;left:0;padding:0;margin:0;border:none;white-space:pre;"></span>';
this.element_.insertAdjacentHTML("beforeEnd",m);
this.textMeasureEl_=this.element_.lastChild
}var Z=this.element_.ownerDocument;
this.textMeasureEl_.innerHTML="";
var ae=x(E(this.font),this.element_),j=aa(ae);
this.textMeasureEl_.style.font=j;
this.textMeasureEl_.appendChild(Z.createTextNode(af));
return{width:this.textMeasureEl_.offsetWidth}
};
v.clip=function(){};
v.arcTo=function(){};
v.createPattern=function(m,j){return new T(m,j)
};
function U(j){this.type_=j;
this.x0_=0;
this.y0_=0;
this.r0_=0;
this.x1_=0;
this.y1_=0;
this.r1_=0;
this.colors_=[]
}U.prototype.addColorStop=function(m,j){j=F(j);
this.colors_.push({offset:m,color:j.color,alpha:j.alpha})
};
function T(m,j){Q(m);
switch(j){case"repeat":case null:case"":this.repetition_="repeat";
break;
case"repeat-x":case"repeat-y":case"no-repeat":this.repetition_=j;
break;
default:O("SYNTAX_ERR")
}this.src_=m.src;
this.width_=m.width;
this.height_=m.height
}function O(j){throw new P(j)
}function Q(j){if(!j||j.nodeType!=1||j.tagName!="IMG"){O("TYPE_MISMATCH_ERR")
}if(j.readyState!="complete"){O("INVALID_STATE_ERR")
}}function P(j){this.code=this[j];
this.message=j+": DOM Exception "+this.code
}var W=P.prototype=new Error;
W.INDEX_SIZE_ERR=1;
W.DOMSTRING_SIZE_ERR=2;
W.HIERARCHY_REQUEST_ERR=3;
W.WRONG_DOCUMENT_ERR=4;
W.INVALID_CHARACTER_ERR=5;
W.NO_DATA_ALLOWED_ERR=6;
W.NO_MODIFICATION_ALLOWED_ERR=7;
W.NOT_FOUND_ERR=8;
W.NOT_SUPPORTED_ERR=9;
W.INUSE_ATTRIBUTE_ERR=10;
W.INVALID_STATE_ERR=11;
W.SYNTAX_ERR=12;
W.INVALID_MODIFICATION_ERR=13;
W.NAMESPACE_ERR=14;
W.INVALID_ACCESS_ERR=15;
W.VALIDATION_ERR=16;
W.TYPE_MISMATCH_ERR=17;
G_vmlCanvasManager=k;
CanvasRenderingContext2D=D;
CanvasGradient=U;
CanvasPattern=T;
DOMException=P
})()
}CQ.endorsed.swfobject=CQ_swfobject;
CQ.wcm.WorkflowModelCombo=CQ.Ext.extend(CQ.form.ClearableComboBox,{constructor:function(b){b=(!b?{}:b);
this.store=new CQ.Ext.data.Store({autoLoad:{},proxy:new CQ.Ext.data.HttpProxy({url:CQ.shared.HTTP.externalize("/libs/cq/workflow/content/console/workflows.json"),method:"GET"}),baseParams:{tags:"wcm"},reader:new CQ.Ext.data.JsonReader({totalProperty:"results",root:"workflows",id:"wid",fields:["wid","label",CQ.shared.XSS.getXSSPropertyName("label"),"description","thumbnail","isCqPage"]}),listeners:{load:function(g){g.add(new g.recordType({wid:"",label:CQ.I18n.getMessage("Create new workflow model..."),description:"",thumbnail:""},CQ.Ext.id()))
}}});
var a=this;
this.initialValue=null;
this.store.on("load",function(){if(a.initialValue){a.setValue(a.initialValue)
}a.fireEvent("load",this)
});
var c=CQ.HTTP.externalize("/libs/cq/ui/widgets/themes/default/widgets/wcm/WorkflowModelCombo/workflow-model.png");
b=CQ.Util.applyDefaults(b,{name:"workflowModel",hiddenName:"./workflowModel",fieldLabel:"Workflow Model",displayField:"label",valueField:"wid",title:CQ.I18n.getMessage("Available Workflow Models"),selectOnFocus:true,triggerAction:"all",allowBlank:false,editable:false,lazyInit:false,store:this.store,tpl:new CQ.Ext.XTemplate('<tpl for=".">','<div class="workflow-model-item x-combo-list-item">','<tpl if="thumbnail">','<img class="workflow-model-thumbnail" src="{[CQ.shared.HTTP.getXhrHookedURL(values.thumbnail + ".thumb.48.48.png")]}">','<div class="workflow-model-title">{[CQ.shared.XSS.getXSSTablePropertyValue(values, "label")]}</div>','<div class="workflow-model-description">{description}</div>',"</tpl>","<tpl if=\"wid == ''\">",'<div class="workflow-model-title workflow-model-no-thumbnail">{[CQ.shared.XSS.getXSSTablePropertyValue(values, "label")]}</div>','<div class="workflow-model-description workflow-model-no-thumbnail">{description}</div>',"</tpl>","<tpl if=\"thumbnail == '' && wid != ''\">",'<img class="workflow-model-thumbnail" src="'+CQ.shared.HTTP.getXhrHookedURL(c+".thumb.48.48.png")+'">','<div class="workflow-model-title">{[CQ.shared.XSS.getXSSTablePropertyValue(values, "label")]}</div>','<div class="workflow-model-description">{description}</div>',"</tpl>",'<div style="clear:both"></div>',"</div>","</tpl>",'<div style="height:5px;overflow:hidden"></div>')});
CQ.wcm.WorkflowModelCombo.superclass.constructor.call(this,b)
},initComponent:function(){CQ.wcm.WorkflowModelCombo.superclass.initComponent.call(this);
this.on("select",function(c,a,b){if(a.get("wid")==""){this.createNewWorkflow()
}},this)
},setValue:function(a){this.initialValue=a;
CQ.wcm.WorkflowModelCombo.superclass.setValue.call(this,a)
},reload:function(a){this.store.reload(a)
},getSelectedRecord:function(){var a={};
var b=this.getValue();
a=this.store.getById(b);
return a
},createNewWorkflow:function(){var b=this;
var a={xtype:"dialog",modal:true,height:150,title:CQ.I18n.getMessage("New Workflow"),params:{_charset_:"utf-8",cmd:"createPage",template:"/libs/cq/workflow/templates/model",parentPath:"/etc/workflow/models/"},items:{xtype:"panel",items:[{xtype:"textfield",name:"title",fieldLabel:CQ.I18n.getMessage("Title")}]},responseScope:b,success:function(g,j){CQ.Ext.Ajax.request({url:j.result.Location+"/jcr:content.generate.json",method:"POST",success:function(k,m){var o=CQ.Ext.util.JSON.decode(k.responseText);
if((typeof o.modelPath)=="string"){b.reload();
b.setValue(o.modelPath);
var n=CQ.HTTP.internalize(j.result.Location);
CQ.wcm.SiteAdmin.openPage(n,"page",true)
}else{CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Did not get path of new workflow model in response"))
}},failure:function(k,m){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not generate workflow model."))
}})
},failure:function(){CQ.Ext.Msg.alert(CQ.I18n.getMessage("Error"),CQ.I18n.getMessage("Could not create workflow model."))
},buttons:[CQ.Dialog.OK,{text:CQ.I18n.getMessage("Cancel"),cls:"cq-btn-cancel",handler:function(g){b.clearValue();
this.hide()
}}]};
var c=CQ.WCM.getDialog(a);
c.form.url="/bin/wcmcommand";
c.show()
}});
CQ.Ext.reg("cq.workflow.model.combo",CQ.wcm.WorkflowModelCombo);
CQ.wcm.WorkflowModelThumbnail=CQ.Ext.extend(CQ.Ext.BoxComponent,{disabled:false,constructor:function(a){CQ.Util.applyDefaults(a,{source:"",alternativeText:"Click thumbnail to edit workflow model",width:200,height:200});
CQ.wcm.WorkflowModelThumbnail.superclass.constructor.call(this,a)
},initComponent:function(){CQ.wcm.WorkflowModelThumbnail.superclass.initComponent.call(this);
this.addEvents("click")
},onRender:function(b,a){if(!this.el){this.el=b.createChild({tag:"img",alt:this.alternativeText,src:this.source,style:"cursor:pointer;"},a);
this.el.on("click",function(){if(!this.disabled){this.fireEvent("click",this)
}},this)
}CQ.wcm.WorkflowModelThumbnail.superclass.onRender.call(this,b,a)
},setSource:function(a){this.source=a;
if(this.el){if(a!=""){a=CQ.shared.HTTP.getXhrHookedURL(a)
}this.el.dom.src=CQ.shared.HTTP.getXhrHookedURL(a)
}},setDisabled:function(a){this.disabled=a;
if(this.disabled){this.el.setStyle("cursor","default")
}else{this.el.setStyle("cursor","pointer")
}}});
CQ.wcm.WorkflowModelSelector=CQ.Ext.extend(CQ.form.CompositeField,{hideThumbnail:false,constructor:function(g){g=(!g?{}:g);
var a=this;
if(!g.hideThumbnail){this.thumbnailImage=new CQ.wcm.WorkflowModelThumbnail({listeners:{click:this.editCurrentWorkflow,scope:this}})
}g=CQ.Util.applyDefaults(g,{allowBlank:false,border:false,name:"workflowModel"});
this.workflowModelCombo=new CQ.wcm.WorkflowModelCombo({xtype:"cq.workflow.model.combo",name:g.name,hiddenName:a.getHiddenName(g.name),title:"",allowBlank:g.allowBlank,listeners:{select:function(){a.updateThumbnail()
},clear:function(){a.updateThumbnail()
},load:function(){a.updateThumbnail()
}}});
var c="cq-wcm-workflow-model-selector-compact";
var b=[this.workflowModelCombo,{xtype:"spacer",height:10}];
if(this.thumbnailImage){c="cq-wcm-workflow-model-selector";
b.push({xtype:"panel",layout:"hbox",layoutConfig:{pack:"center"},border:false,items:[this.thumbnailImage]})
}g=CQ.Util.applyDefaults(g,{cls:c,layout:"vbox",layoutConfig:{align:"stretch"},border:false,items:b});
CQ.wcm.WorkflowModelSelector.superclass.constructor.call(this,g)
},initComponent:function(){CQ.wcm.WorkflowModelSelector.superclass.initComponent.call(this)
},setValue:function(a){this.workflowModelCombo.setValue(a);
this.updateThumbnail()
},getValue:function(){return this.workflowModelCombo.getValue()
},getRawValue:function(){return this.workflowModelCombo.getRawValue()
},updateThumbnail:function(){if(!this.hideThumbnail){var g=this.thumbnailImage.height;
var c=this.thumbnailImage.width;
var b=this.workflowModelCombo.getSelectedRecord();
if(!b){this.thumbnailImage.setDisabled(true);
this.thumbnailImage.setSource("data:image/gif;base64,R0lGODlhAQABAJH/AP///wAAAMDAwAAAACH5BAEAAAIALAAAAAABAAEAAAICVAEAOw==")
}else{var a=(b&&(typeof b.data.thumbnail=="string"))?b.data.thumbnail:"";
var j=CQ.HTTP.externalize("/libs/cq/ui/widgets/themes/default/widgets/wcm/WorkflowModelCombo/workflow-model.png");
if(a.length>0){j=a+".thumb.200.200.png"
}this.thumbnailImage.setDisabled(false);
this.thumbnailImage.setSource(j)
}}},editCurrentWorkflow:function(){var a=this.getValue();
if(a&&a!=""){a=a.replace(/\/jcr.content\/model$/,"");
CQ.wcm.SiteAdmin.openPage(a,"page",true)
}},getHiddenName:function(a){if(!a){return
}var b=a;
var c=new RegExp("^./","i");
if(!c.test(b)){b="./"+b
}return b
}});
CQ.Ext.reg("cq.workflow.model.selector",CQ.wcm.WorkflowModelSelector);
CUI.rte._toolkit="ext";
CQ.form.rte={};
CQ.form.rte.plugins={};
CQ.form.rte.commands={};
CQ.form.rte.ui={};
CUI.rte.ui.ext.ToolkitImpl=new Class({toString:"ToolkitImpl",extend:CUI.rte.ui.Toolkit,initialize:function(a){a()
},requiresInit:function(){return false
},createToolbarBuilder:function(c){var a=CUI.rte.ui.Toolkit;
var b=CUI.rte.ui.ext;
switch(c){case a.TBHINT_GLOBAL:return new b.GlobalToolbarBuilder();
case a.TBHINT_LOCAL:return new b.IFrameToolbarBuilder()
}throw new Error("Invalid toolbar type (parameter 'hint'): "+c)
},createContextMenuBuilder:function(a){return new CUI.rte.ui.ext.ExtContextMenuBuilder(a)
},createDialogManager:function(a){return new CUI.rte.ui.ext.ExtDialogManager(a)
}});
CUI.rte.ui.ToolkitRegistry.register("ext",CUI.rte.ui.ext.ToolkitImpl);
CUI.rte.ui.ext.ToolbarImpl=new Class({toString:"ToolbarImpl",extend:CUI.rte.ui.Toolbar,tb:null,isLocalToolbar:false,construct:function(a,b){this.tb=a;
this.isLocalToolbar=b
},getItem:function(c){var b=this.tb.length;
for(var g=0;
g<b;
g++){var a=this.tb[g].items.get(c);
if(a){return a
}}return null
},getHeight:function(){if(this.tb==null){return 0
}var a=0;
for(var b=0;
b<this.tb.length;
b++){a+=this.tb[b].el.getHeight()
}return a
},enable:function(){var a=this.tb.length;
for(var b=0;
b<a;
b++){this.tb[b].items.each(function(c){if(c.getXType()==="tbitem"){CUI.rte.Common.removeAttribute(c.el.dom,"disabled")
}else{c.enable()
}})
}},adjustToWidth:function(b){if(this.isLocalToolbar){var a=this.tb;
if(a){var c=a.length;
for(var g=0;
g<c;
g++){a[g].onResize(b,a[g].el.getHeight())
}}}},disable:function(a){var b=this.tb.length;
for(var c=0;
c<b;
c++){this.tb[c].items.each(function(g){if((a==null)||!CUI.rte.Common.arrayContains(a,g.itemId)){if(g.getXType()==="tbitem"){g.el.set({disabled:"disabled"})
}else{g.disable()
}}})
}},destroy:function(){var a=this.tb.length;
for(var b=0;
b<a;
b++){this.tb[b].items.each(function(c){if(c.menu){c.menu.removeAll();
if(c.menu.el){c.menu.el.destroy()
}}c.destroy()
})
}}});
CUI.rte.ui.ext.ElementImpl=new Class({toString:"ElementImpl",extend:CUI.rte.ui.TbElement,toolbar:null,notifyToolbar:function(a){this.toolbar=a
},getExtUI:function(){return this.toolbar.items.map[this.id]
},addToToolbar:function(a){this.notifyToolbar(a);
a.add(this.createToolbarDef())
},createToolbarDef:function(){return{itemId:this.id,cls:"x-btn-icon",iconCls:this.css,enableToggle:(this.toggle!==false),scope:this,handler:function(){var c=this.plugin.editorKernel.getEditContext();
var b=(this.cmdDef?this.cmdDef.cmd:this.id);
var g=(this.cmdDef?this.cmdDef.cmdValue:undefined);
var a={editContext:c};
this.plugin.execute(b,g,a)
},clickEvent:"mousedown",tooltip:this.tooltip,tabIndex:-1}
},setDisabled:function(a){var b=this.getExtUI();
if(b){b.setDisabled(a)
}},setSelected:function(b,a){var c=this.getExtUI();
if(c){c.toggle(b,a)
}},isSelected:function(){var a=this.getExtUI();
if(!a){return false
}return a.pressed
}});
CUI.rte.ui.ext.ParaFormatterImpl=new Class({toString:"ParaFormatterImpl",extend:CUI.rte.ui.TbParaFormatter,addToToolbar:function(c){var a=CUI.rte.Common;
this.toolbar=c;
if(a.ua.isIE){var b=document.createElement("span");
b.innerHTML='<select class="x-font-select">'+this.createFormatOptions()+"</select>";
this.formatSelector=CQ.Ext.get(b.childNodes[0])
}else{this.formatSelector=CQ.Ext.get(CQ.Ext.DomHelper.createDom({tag:"select",cls:"x-font-select",html:this.createFormatOptions()}))
}this.initializeSelector();
c.add(CQ.I18n.getMessage("Format")," ",this.formatSelector.dom)
},createFormatOptions:function(){var c="";
if(this.formats){var b=this.formats.length;
for(var a=0;
a<b;
a++){var g=this.formats[a].description;
c+='<option value="'+this.formats[a].tag+'">'+g+"</option>"
}}return c
},createToolbarDef:function(){return{xtype:"panel",itemId:this.id,html:'<select class="x-font-select">'+this.createFormatOptions()+"</select>",listeners:{afterrender:function(){var a=this.toolbar.items.get(this.id);
if(a&&a.body){this.formatSelector=CQ.Ext.get(a.body.dom.childNodes[0]);
this.initializeSelector()
}},scope:this}}
},initializeSelector:function(){this.formatSelector.on("change",function(){var a=this.formatSelector.dom.value;
if(a.length>0){this.plugin.execute(this.id)
}},this);
this.formatSelector.on("focus",function(){this.plugin.editorKernel.isTemporaryBlur=true
},this);
this.formatSelector.setHeight(20)
},getSelectorDom:function(){return this.formatSelector.dom
},getSelectedFormat:function(){var b;
if(this.formatSelector){b=this.formatSelector.dom.value;
if(b.length>0){return b
}}else{var a=this.toolbar.items.get(this.id);
if(a.getValue()){return a
}}return null
},selectFormat:function(c,a,m,o){var b=-1;
var g=this.formatSelector.dom;
if((c!=null)&&(m==1)&&(o==0)){var n=g.options;
for(var j=0;
j<n.length;
j++){var k=n[j];
if(k.value==c){b=j;
break
}}}g.disabled=(o>0)&&(a==null);
g.selectedIndex=b
}});
CUI.rte.ui.ext.StyleSelectorImpl=new Class({toString:"StyleSelectorImpl",extend:CUI.rte.ui.TbStyleSelector,getRemoveButtonUI:function(){return this.toolbar.items.map[this.id+"_remove"]
},createRemoveButton:function(){return{itemId:this.id+"_remove",cls:"x-btn-icon",iconCls:"x-edit-removestyle",enableToggle:(this.toggle!==false),scope:this,handler:function(){this.plugin.execute(this.id+"_remove")
},clickEvent:"mousedown",tabIndex:-1}
},addToToolbar:function(c){var a=CUI.rte.Common;
this.toolbar=c;
if(a.ua.isIE){var b=document.createElement("span");
b.innerHTML='<select class="x-font-select">'+this.createStyleOptions()+"</span>";
this.styleSelector=CQ.Ext.get(b.childNodes[0])
}else{this.styleSelector=CQ.Ext.get(CQ.Ext.DomHelper.createDom({tag:"select",cls:"x-font-select",html:this.createStyleOptions()}))
}this.initializeSelector();
c.add(CQ.I18n.getMessage("Style")," ",this.styleSelector.dom,this.createRemoveButton())
},createToolbarDef:function(){return[{xtype:"panel",itemId:this.id,html:'<select class="x-font-select">'+this.createStyleOptions()+"</span>",listeners:{afterrender:function(){var a=this.toolbar.items.get(this.id);
if(a&&a.body){this.styleSelector=CQ.Ext.get(a.body.dom.childNodes[0]);
this.initializeSelector()
}},scope:this}},this.createRemoveButton()]
},initializeSelector:function(){this.styleSelector.on("change",function(){var a=this.styleSelector.dom.value;
if(a.length>0){this.plugin.execute(this.id)
}},this);
this.styleSelector.on("focus",function(){this.plugin.editorKernel.isTemporaryBlur=true
},this);
this.styleSelector.setHeight(19)
},getSelectorDom:function(){return this.styleSelector.dom
},getSelectedStyle:function(){var a=this.styleSelector.dom.value;
if(a.length>0){return a
}return null
},selectStyles:function(n,j){var b;
var g=j.selectedDom;
var c=this.getSelectorDom();
if(n.length==0){b=0
}else{if(n.length>1){b=-1
}else{if(j.isContinuousStyle||g){var a=n[0];
var o=c.options;
for(var k=0;
k<o.length;
k++){var m=o[k];
if(m.value==a.className){b=k;
break
}}}else{b=-1
}}}c.selectedIndex=b;
if(g!=null){c.disabled=false;
this.setRemoveDisabled(b==0)
}else{if(j.isSelection){c.disabled=!((b==0)&&this.plugin.getStyles());
this.setRemoveDisabled(true)
}else{this.setRemoveDisabled(b==0);
c.disabled=true
}}},setRemoveDisabled:function(a){var b=this.getRemoveButtonUI();
b.setDisabled(a)
}});
CUI.rte.ui.ext.ExtToolbarBuilder=new Class({toString:"ExtToolbarBuilder",extend:CUI.rte.ui.ToolbarBuilder,createElement:function(k,c,a,j,b,g){if(!(CQ.Ext.QuickTips&&CQ.Ext.QuickTips.isEnabled())){j=null
}return new CUI.rte.ui.ext.ElementImpl(k,c,a,j,b,g)
},createParaFormatter:function(g,b,c,a){return new CUI.rte.ui.ext.ParaFormatterImpl(g,b,false,c,false,undefined,a)
},createStyleSelector:function(g,b,c,a){return new CUI.rte.ui.ext.StyleSelectorImpl(g,b,false,c,false,undefined,a)
}});
CUI.rte.ui.ext.GlobalToolbarBuilder=new Class({toString:"GlobalToolbarBuilder",extend:CUI.rte.ui.ext.ExtToolbarBuilder,createToolbar:function(y){var q=[];
var u=[];
var j=this.groups.length;
var a=false;
for(var x=0;
x<j;
x++){var w=this.groups[x].elements;
var c=w.length;
for(var g=0;
g<c;
g++){var m=w[g].def;
if((g==0)&&a){q.push("-");
a=false
}var t=m.createToolbarDef();
if(t!=null){if(!CUI.rte.Utils.isArray(t)){t=[t]
}var o=t.length;
for(var k=0;
k<o;
k++){q.push(t[k])
}u.push(m);
a=true
}}}var v=new (CQ.shared.Util.getTopWindow()).CQ.Ext.Toolbar({items:q,cls:"x-html-editor-tb",afterRender:function(){if(CUI.rte.Common.ua.isSafari){this.el.setWidth("100%")
}CQ.Ext.Toolbar.prototype.afterRender.call(this)
}});
var r=u.length;
for(var b=0;
b<r;
b++){u[b].notifyToolbar(v)
}CQ.WCM.loadToolbar(v);
return new CUI.rte.ui.ext.ToolbarImpl(v,false)
}});
CUI.rte.ui.ext.IFrameToolbarBuilder=new Class({toString:"IFrameToolbarBuilder",extend:CUI.rte.ui.ext.ExtToolbarBuilder,createToolbar:function(w){var j=new CQ.WrappingToolbar({renderTo:w.renderToDom});
j.el.on("click",function(t){t.preventDefault()
});
var u=[j];
var g=this.groups.length;
var a=[];
for(var r=0;
r<g;
r++){var q=this.groups[r].elements;
var b=q.length;
for(var c=0;
c<b;
c++){var k=q[c].def;
var n=k.getToolbar();
var o=null;
if(n<u.length){o=u[n]
}if(!o){o=new CQ.WrappingToolbar({renderTo:w.renderToDom});
u[n]=o
}if((c==0)&&a[n]){o.add("-")
}else{a[n]=true
}k.addToToolbar(o)
}}var m=u.length;
for(var v=0;
v<m;
v++){if(u[v]){u[v].doLayout()
}}return new CUI.rte.ui.ext.ToolbarImpl(u,true)
}});
CUI.rte.ui.ext.CmItemImpl=new Class({toString:"CmItemImpl",extend:CUI.rte.ui.CmItem,text:null,iconCls:null,handlerFn:null,selectionContext:null,editContext:null,defaultHandlerFn:null,subItems:null,construct:function(a){this.subItems=[];
if(a.subItems){var c=a.subItems.length;
for(var b=0;
b<c;
b++){this.subItems.push(new CUI.rte.ui.ext.CmItemImpl(a.subItems[b]))
}delete a.subItems
}this.defaultHandlerFn=CUI.rte.Utils.scope(function(j,g){g.stopEvent();
var k={selectionContext:this.selectionContext,editContext:this.editContext};
if(this.editorKernel.contextMenuSavedRange){k.savedRange=this.editorKernel.contextMenuSavedRange
}this.editorKernel.focus();
this.editorKernel.isEventingDisabled=false;
if(this.plugin&&this.cmd){this.plugin.execute(this.cmd,this.cmdValue,k)
}},this);
CUI.rte.Utils.apply(this,a)
},build:function(k,m,g,a){this.editorKernel=m;
this.selectionContext=a;
this.editContext=g;
var j=this.subItems.length;
var b=null;
if(j>0){b=new CQ.Ext.menu.Menu()
}k.addItem(new CQ.Ext.menu.Item({text:this.text,menu:b,iconCls:this.iconCls,handler:this.handlerFn?this.handlerFn:this.defaultHandlerFn,disabled:this.disabled===true}));
for(var c=0;
c<j;
c++){this.subItems[c].build(b,m,g,a)
}}});
CUI.rte.ui.ext.CmSeparatorImpl=new Class({toString:"CmSeparatorImpl",extend:CUI.rte.ui.CmSeparator,build:function(a){a.addItem(new CQ.Ext.menu.Separator())
}});
CUI.rte.ui.ext.ExtContextMenuBuilder=new Class({toString:"ExtContextMenuBuilder",extend:CUI.rte.ui.ContextMenuBuilder,construct:function(a){this.menu=new CQ.Ext.menu.Menu()
},build:function(a,c){this.menu.removeAll();
var j=this.items.length;
if(j==0){return null
}for(var b=0;
b<j;
b++){var g=this.items[b];
g.build(this.menu,this.editorKernel,c,a)
}return this.menu
},createItem:function(a){return new CUI.rte.ui.ext.CmItemImpl(a)
},createSeparator:function(){return new CUI.rte.ui.ext.CmSeparatorImpl()
},showAt:function(a,b){this.menu.showAt([a,b])
},hideAll:function(){CQ.Ext.menu.MenuMgr.hideAll()
},isVisible:function(){return this.menu.isVisible()
}});
CUI.rte.ui.ext.ExtDialogHelper=new Class({toString:"ExtDialogHelper",extend:CUI.rte.ui.DialogHelper,instantiateDialog:function(a){a.dialogHelper=this;
var c=a.type;
if(c){a.xtype=c;
delete a.type
}if(a.xtype){return CQ.Ext.ComponentMgr.create(a)
}if(a._constructor){var b=a._constructor;
delete a._constructor;
return CQ.Ext.ComponentMgr.create(a,b)
}if(a["jcr:primaryType"]&&(a["jcr:primaryType"]!="nt:unstructured")){return CQ.WCM.getDialog(a)
}throw new Error("Invalid customDialog definition; missing type, xtype or jcr:primaryType")
},createItem:function(c,b,a){return{name:b,xtype:c,fieldLabel:a,anchor:CQ.themes.Dialog.ANCHOR}
},getItemType:function(a){return a.xtype
},getItemName:function(a){return a.getName()
},getItemValue:function(a){return a.getValue()
},setItemValue:function(a,b){a.setValue(b)
}});
CUI.rte.ui.ext.ExtDialogManager=new Class({toString:"ExtDialogManager",extend:CUI.rte.ui.DialogManager,editorKernel:null,construct:function(a){this.editorKernel=a
},create:function(b,a){var c=CUI.rte.ui.DialogManager;
var g;
switch(b){case c.DLG_ANCHOR:g=this.createAnchorDialog(a);
break;
case c.DLG_FINDREPLACE:g=this.createFindReplaceDialog(a);
break;
case c.DLG_PASTE:g=this.createPasteDialog(a);
break;
case c.DLG_SPECCHARS:g=this.createSpecialCharsDialog(a);
break;
case c.DLG_TABLEPROPS:g=this.createTablePropsDialog(a);
break;
case c.DLG_CELLPROPS:g=this.createCellPropsDialog(a);
break;
case c.DLG_IMAGEPROPS:g=this.createImagePropsDialog(a);
break
}if(g){g.editorKernel=this.editorKernel
}return g
},mustRecreate:function(a){return a.isDestroyed
},show:function(a){a.show();
window.setTimeout(function(){a.toFront();
a.focus()
},10)
},hide:function(a){a.hide()
},alert:function(c,b,a){CQ.Ext.MessageBox.alert(c,b,a)
},isShown:function(a){return a&&a.isVisible()
},createDialogHelper:function(){return new CUI.rte.ui.ext.ExtDialogHelper(this.editorKernel)
},createAnchorDialog:function(a){a.xtype="rteanchordialog";
a.disableOverridePosition=true;
var b=CQ.WCM.getDialog(a);
b.setPosition(this.editorKernel.calculateWindowPosition("default"));
return b
},createFindReplaceDialog:function(a){var b=new CQ.form.rte.plugins.FindReplaceDialog(a);
b.setPosition(this.editorKernel.calculateWindowPosition("left"));
return b
},createPasteDialog:function(a){var b=new CQ.form.rte.plugins.PasteDialog(a);
b.setPosition(this.editorKernel.calculateWindowPosition("default"));
return b
},createSpecialCharsDialog:function(a){a.xtype="rtespecialcharsdialog";
a.disableOverridePosition=true;
var b=CQ.WCM.getDialog(a);
b.setPosition(this.editorKernel.calculateWindowPosition("default"));
return b
},createTablePropsDialog:function(a){var b=new CQ.form.rte.plugins.TablePropertiesDialog(a);
b.setPosition(this.editorKernel.calculateWindowPosition("default"));
return b
},createCellPropsDialog:function(a){var b=new CQ.form.rte.plugins.CellPropertiesDialog(a);
b.setPosition(this.editorKernel.calculateWindowPosition("default"));
return b
},createImagePropsDialog:function(a){a.disableOverridePosition=true;
var b=new CQ.form.rte.plugins.ImagePropertiesDialog(a);
b.setPosition(this.editorKernel.calculateWindowPosition("default"));
return b
}});
CUI.rte.CqI18nProvider=new Class({extend:CUI.rte.I18nProvider,_map:{"kernel.alertTitlePaste":CQ.I18n.get("Paste"),"kernel.alertSecurityPaste":CQ.I18n.get("Your browser's security settings don't permit the editor to execute paste operations.<br>Please use the keyboard shortcut (Ctrl/Cmd+V)."),"kernel.alertTitleCopy":CQ.I18n.get("Copy"),"kernel.alertSecurityCopy":CQ.I18n.get("Your browser's security settings don't permit the editor to execute copy operations.<br>Please use the keyboard shortcut (Ctrl/Cmd+C)."),"kernel.alertTitleCut":CQ.I18n.get("Cut"),"kernel.alertSecurityCut":CQ.I18n.get("Your browser's security settings don't permit the editor to execute cut operations.<br>Please use the keyboard shortcut (Ctrl/Cmd+X)."),"kernel.alertTitleError":CQ.I18n.get("Error"),"kernel.alertIELimitation":CQ.I18n.get("Could not insert text due to internal Internet Explorer limitations. Please try to select a smaller text fragment and try again."),"commands.paste.alertTitle":CQ.I18n.get("Paste"),"commands.paste.alertTableError":CQ.I18n.get("You are trying to paste table data into an existing table.<br>As this operation would result in invalid HTML, it has been cancelled.<br>Please try to simplify the table's structure and try again."),"commands.paste.alertCellSelectionError":CQ.I18n.get("You are trying to paste table data into an non-rectangular cell selection.<br>Please choose a rectangular cell selection and try again."),"plugins.editTools.cutTitle":CQ.I18n.get("Cut (Ctrl+X)"),"plugins.editTools.cutText":CQ.I18n.get("Cuts the currently selected text and puts it in to the clipboard."),"plugins.editTools.copyTitle":CQ.I18n.get("Copy (Ctrl+C)"),"plugins.editTools.copyText":CQ.I18n.get("Copies the currently selected text to the clipboard."),"plugins.editTools.pasteDefaultTitle":CQ.I18n.get("Paste (Ctrl+V)"),"plugins.editTools.pasteDefaultText":CQ.I18n.get("Pastes the clipboard content with the default paste method."),"plugins.editTools.pastePlainTextTitle":CQ.I18n.get("Paste as text"),"plugins.editTools.pastePlainTextText":CQ.I18n.get("Pastes the clipboard content as plain text."),"plugins.editTools.pasteWordHtmlTitle":CQ.I18n.get("Paste from Word"),"plugins.editTools.pasteWordHtmlText":CQ.I18n.get("Pastes the clipboard content from Word, applying some cleanup."),"plugins.findReplace.findTitle":CQ.I18n.get("Find"),"plugins.findReplace.replaceTitle":CQ.I18n.get("Replace"),"plugins.findReplace.findReplaceTitle":CQ.I18n.get("Find/Replace"),"plugins.findReplace.replaceAllTitle":CQ.I18n.get("Replace all"),"plugins.findReplace.alertNoMoreResults":CQ.I18n.get("No more occurences of '{0}' found in document.<br>Search will be continued from the top."),"plugins.findReplace.alertReplaceResults":CQ.I18n.get("Text '{0}' has been replaced {1} time(s)."),"plugins.findReplace.alertNotFound":CQ.I18n.get("Text '{0}' not found."),"plugins.findReplace.alertIEProblems":CQ.I18n.get("Could not replace due to limited functionality in Internet Explorer."),"plugins.findReplace.tooltipFind":CQ.I18n.get("Finds a text fragment in the text being edited."),"plugins.findReplace.tooltipReplace":CQ.I18n.get("Replaces a text fragment with another fragment."),"plugins.format.boldTitle":CQ.I18n.get("Bold (Ctrl+B)"),"plugins.format.boldText":CQ.I18n.get("Make the selected text bold."),"plugins.format.italicTitle":CQ.I18n.get("Italic (Ctrl+I)"),"plugins.format.italicText":CQ.I18n.get("Make the selected text italic."),"plugins.format.underlineTitle":CQ.I18n.get("Underline (Ctrl+U)"),"plugins.format.underlineText":CQ.I18n.get("Underline the selected text."),"plugins.image.alignMenu":CQ.I18n.get("Image alignment"),"plugins.image.alignLeft":CQ.I18n.get("Left"),"plugins.image.alignRight":CQ.I18n.get("Right"),"plugins.image.alignNone":CQ.I18n.get("None"),"plugins.image.noAlign":CQ.I18n.get("No alignment"),"plugins.image.properties":CQ.I18n.get("Image Properties"),"plugins.justify.leftTitle":CQ.I18n.get("Align Text Left"),"plugins.justify.leftText":CQ.I18n.get("Align text to the left."),"plugins.justify.centerTitle":CQ.I18n.get("Center Text"),"plugins.justify.centerText":CQ.I18n.get("Center text in the editor."),"plugins.justify.rightTitle":CQ.I18n.get("Align Text Right"),"plugins.justify.rightText":CQ.I18n.get("Align text to the right."),"plugins.link.linkTitle":CQ.I18n.get("Hyperlink"),"plugins.link.linkText":CQ.I18n.get("Create or modify a hyperlink."),"plugins.link.unlinkTitle":CQ.I18n.get("Unlink"),"plugins.link.unlinkText":CQ.I18n.get("Remove an existing hyperlink from the selected text."),"plugins.link.anchorTitle":CQ.I18n.get("Anchor"),"plugins.link.anchorText":CQ.I18n.get("Add or edit an anchor."),"plugins.list.ulTitle":CQ.I18n.get("Bullet List"),"plugins.list.ulText":CQ.I18n.get("Start a bulleted list."),"plugins.list.olTitle":CQ.I18n.get("Numbered List"),"plugins.list.olText":CQ.I18n.get("Start a numbered list."),"plugins.list.indentTitle":CQ.I18n.get("Indent"),"plugins.list.indentText":CQ.I18n.get("Indents the selected paragraph(s) or list item(s)."),"plugins.list.outdentTitle":CQ.I18n.get("Outdent"),"plugins.list.outdentText":CQ.I18n.get("Outdents the current paragraph(s) or list item(s)."),"plugins.miscTools.sourceEditTitle":CQ.I18n.get("Source Edit"),"plugins.miscTools.sourceEditText":CQ.I18n.get("Switch to source editing mode."),"plugins.miscTools.specialCharsTitle":CQ.I18n.get("Special Characters"),"plugins.miscTools.specialCharsText":CQ.I18n.get("Insert a special character."),"plugins.paraFormat.defaultP":CQ.I18n.get("Paragraph"),"plugins.paraFormat.defaultH1":CQ.I18n.get("Heading 1"),"plugins.paraFormat.defaultH2":CQ.I18n.get("Heading 2"),"plugins.paraFormat.defaultH3":CQ.I18n.get("Heading 3"),"plugins.subSuperScript.subTitle":CQ.I18n.get("Subscript"),"plugins.subSuperScript.subText":CQ.I18n.get("Formats the selected text as subscript."),"plugins.subSuperScript.superTitle":CQ.I18n.get("Superscript"),"plugins.subSuperScript.superText":CQ.I18n.get("Formats the selected text as superscript."),"plugins.table.tableTitle":CQ.I18n.get("Table"),"plugins.table.tableText":CQ.I18n.get("Creates a new table or edits the properties of an existing table."),"plugins.table.cellTitle":CQ.I18n.get("Cell"),"plugins.table.cellText":CQ.I18n.get("Edit the properties of a selected cell."),"plugins.table.insertAboveTitle":CQ.I18n.get("Insert Above"),"plugins.table.insertAboveText":CQ.I18n.get("Insert a new row above the current row."),"plugins.table.insertBelowTitle":CQ.I18n.get("Insert Below"),"plugins.table.insertBelowText":CQ.I18n.get("Insert a new row below the current row."),"plugins.table.deleteRowTitle":CQ.I18n.get("Delete Row"),"plugins.table.deleteRowText":CQ.I18n.get("Delete the current row."),"plugins.table.insertLeftTitle":CQ.I18n.get("Insert Left"),"plugins.table.insertLeftText":CQ.I18n.get("Insert a new column to the left of the current column."),"plugins.table.insertRightTitle":CQ.I18n.get("Insert Right"),"plugins.table.insertRightText":CQ.I18n.get("Insert a new column to the right of the current column."),"plugins.table.deleteColumnTitle":CQ.I18n.get("Delete Column"),"plugins.table.deleteColumnText":CQ.I18n.get("Delete the current column."),"plugins.table.cellProps":CQ.I18n.get("Cell properties"),"plugins.table.mergeCells":CQ.I18n.get("Merge cells"),"plugins.table.mergeRight":CQ.I18n.get("Merge right"),"plugins.table.mergeDown":CQ.I18n.get("Merge down"),"plugins.table.splitHor":CQ.I18n.get("Split cell horizontally"),"plugins.table.splitVert":CQ.I18n.get("Split cell vertically"),"plugins.table.cell":CQ.I18n.get("Cell"),"plugins.table.column":CQ.I18n.get("Column"),"plugins.table.row":CQ.I18n.get("Row"),"plugins.table.insertBefore":CQ.I18n.get("Insert before"),"plugins.table.insertAfter":CQ.I18n.get("Insert after"),"plugins.table.remove":CQ.I18n.get("Remove"),"plugins.table.tableProps":CQ.I18n.get("Table properties"),"plugins.table.removeTable":CQ.I18n.get("Remove table"),"plugins.table.nestedTable":CQ.I18n.get("Create nested table"),"plugins.table.selectRow":CQ.I18n.get("Select entire row"),"plugins.table.selectColumn":CQ.I18n.get("Select entire column"),"plugins.table.insertParaBefore":CQ.I18n.get("Insert paragraph before table"),"plugins.table.insertParaAfter":CQ.I18n.get("Insert paragraph after table"),"plugins.table.createTable":CQ.I18n.get("Create table"),"plugins.undoRedo.undoTitle":CQ.I18n.get("Undo"),"plugins.undoRedo.undoText":CQ.I18n.get("Undo the last change."),"plugins.undoRedo.redoTitle":CQ.I18n.get("Redo"),"plugins.undoRedo.redoText":CQ.I18n.get("Redo previously undone changes."),"plugins.fullscreen.toggleTitle":CQ.I18n.get("Fullscreen"),"plugins.fullscreen.toggleText":CQ.I18n.get("Toggle fullscreen mode."),"plugins.fullscreen.startTitle":CQ.I18n.get("Fullscreen"),"plugins.fullscreen.startText":CQ.I18n.get("Start fullscreen mode."),"plugins.fullscreen.finishTitle":CQ.I18n.get("Fullscreen"),"plugins.fullscreen.finishText":CQ.I18n.get("Exit fullscreen mode."),"plugins.control.closeTitle":CQ.I18n.get("Close"),"plugins.control.closeText":CQ.I18n.get("Finish editing the text.")},getText:function(g,a){var c=g;
if(this._map&&this._map.hasOwnProperty(g)){c=this._map[g]
}if(a){if(!CUI.rte.Utils.isArray(a)){c=c.replace("{0}",a)
}else{for(var b=0;
b<a.length;
b++){c=c.replace("{"+b+"}",a[b])
}}}return c
}});
(function(){CQ.form.rte=CQ.form.rte||{};
function a(o){var m,r,b,q,k,g;
if(!CQ.Ext.isArray(o)){o=[o]
}for(k=0;
k<o.length;
k++){var c=o[k];
b=CUI.rte;
q=CQ.form.rte;
r=c.split(".");
var j=r.length;
for(g=0;
g<j-1;
g++){m=r[g];
q[m]=q[m]||{};
q=q[m];
b=b[m]
}m=r[j-1];
q[m]=b[m]
}}a(["EditContext","EditorKernel","IFrameKernel","DivKernel","Common","HtmlProcessor","DomProcessor","WhitespaceProcessor","NodeList","Selection","UndoManager","TableMatrix","ListUtils","ListRepresentation","CellSelection","SearchableDocument","Compatibility","HtmlRules","Serializer","HtmlSerializer","XhtmlSerializer","Deserializer","HtmlDeserializer","XhtmlDeserializer","DomCleanup","EditorEvent","commands.Command","commands.CommandRegistry","commands.Delete","commands.SurroundBase","commands.DefaultFormatting","commands.Anchor","commands.CutCopy","commands.Format","commands.Indent","commands.InsertHtml","commands.Justify","commands.Link","commands.List","commands.Outdent","commands.Paste","commands.Style","commands.Table","commands.Image","commands.UndoRedo","plugins.PluginRegistry","ui.Toolkit","ui.ToolkitRegistry","ui.UIEvent","ui.ToolbarBuilder","ui.Toolbar","ui.TbParaFormatter","ui.TbStyleSelector","ui.ContextMenuBuilder","ui.DialogManager","ui.DialogHelper.js"]);
CQ.form.rte.Common.isCaretMovement=function(c){var b=c.getKey();
return(b==c.UP)||(b==c.DOWN)||(b==c.LEFT)||(b==c.RIGHT)||(b==c.PAGE_UP)||(b==c.PAGE_DOWN)||(b==c.HOME)||(b==c.END)
}
})();
CQ.Ext.override(CUI.rte.Hooks,{onPluginCreated:function(a){if(a._rtePluginType==="compat"){}return a
},resolveRelativePath:function(b){var c=CQ.WCM.getPagePath();
var a=c.substring(0,c.lastIndexOf("/"));
return CQ.Sling.getContentPath(b,a,true)
},isExistingPage:function(b){var a=CQ.WCM.getPageInfo(decodeURIComponent(b));
return a.isPage
},getServerPrefix:function(a){return CQ.HTTP.getSchemeAndAuthority(a)
},processUrl:function(a,b){if(b===CUI.rte.Utils.URL_IMAGE){a=CQ.shared.HTTP.getXhrHookedURL(CQ.HTTP.externalize(a))
}return a
}});
CUI.rte.plugins.SpellCheckerPlugin=new Class({toString:"SpellCheckerPlugin",extend:CUI.rte.plugins.Plugin,checkTextUI:null,checkText:function(c){this.clearInvalidationMarks(c);
var a=this.config.spellcheckerUrl;
var j=function(n,k,m){if(k){this.checkSuccess(c,m)
}else{this.checkFailure()
}};
var g={_charset_:"utf-8",mode:"text",html:"true",text:this.editorKernel.getProcessedHtml(),cp:this.editorKernel.getContentPath()};
switch(this.config.method.toLowerCase()){case"post":_g.shared.HTTP.post(a,j,g,this,true,false);
break;
case"get":for(var b in g){if(g.hasOwnProperty(b)){a=_g.shared.HTTP.addParameter(a,b,g[b])
}}_g.shared.HTTP.get(a,j,this,false);
break
}},checkSuccess:function(g,j){var o=true;
try{var b;
var a=this.config.method.toLowerCase();
if(a=="post"){if(j&&j.headers&&j.headers.json){b=CUI.rte.Utils.jsonDecode(j.headers.json);
o=false
}}else{if(a=="get"){if(j&&j.body){b=CUI.rte.Utils.jsonDecode(j.body);
o=false
}}}}catch(n){}if(o){this.editorKernel.getDialogManager().alert(CUI.rte.Utils.i18n("Spell checking"),CUI.rte.Utils.i18n("Spell checking failed."));
return
}var v=false;
var q=b.words;
var u=q.length;
for(var t=0;
t<u;
t++){var c=q[t];
var x=c.result;
if(!x.isCorrect){var m=c.start;
var r=c.chars;
var k=x.suggestions;
this.markInvalidWord(g,m,r,k);
v=true
}}if(!v){this.editorKernel.getDialogManager().alert(CUI.rte.Utils.i18n("Spell checking"),CUI.rte.Utils.i18n("No spelling mistakes found."))
}},checkFailure:function(){this.checkTextUI.setSelected(false);
this.editorKernel.getDialogManager().alert(CUI.rte.Utils.i18n("Spell checking"),CUI.rte.Utils.i18n("Spell checking failed."))
},markInvalidWord:function(c,q,t,n){var g=CUI.rte.Common;
var v=CUI.rte.DomProcessor;
var a=g.getNodeAtPosition(c,q,true);
var o=g.getNodeAtPosition(c,q+t,true);
var m=o.dom;
var r=o.offset;
if((m.nodeType==1)&&(o.offset==null)){var x=m;
m=g.getLastTextChild(x);
if(!m){m=g.getPreviousTextNode(c,x)
}r=g.getNodeCharacterCnt(m)
}var j=v.createNodeList(c,{startNode:a.dom,startOffset:a.offset,endNode:m,endOffset:r});
var w=null;
if(n!=null){var u=n.length;
for(var y=0;
y<u;
y++){var k=n[y];
if(y==0){w=k
}else{w+="|"+k
}}}var b={_rtetemp:"spchk"};
if(this.config.invalidStyle){b.style=this.config.invalidStyle
}if(this.config.invalidClass){b.className=this.config.invalidClass
}if(w!=null){b._rtespchksugg=w
}j.surround(c,"span",b)
},clearInvalidationMarks:function(a){var b=CUI.rte.DomProcessor;
b.removeTagsFromHierarchy(a.root,{tagName:"span",attribValues:{_rtetemp:"spchk"}})
},_init:function(a){this.inherited(arguments);
a.addPluginListener("keyup",this.handleOnKey,this,this,false);
a.addPluginListener("sourceedit",this.handleSourceEdit,this,this,false)
},handleOnKey:function(k){var g=CUI.rte.Common;
var c=CUI.rte.Selection;
var n=CUI.rte.DomProcessor;
var b=k.editContext;
if(!k.isCaretMovement()){var q=c.createProcessingSelection(b);
if(q&&!q.endNode){var a=false;
var m=c.bookmarkFromProcessingSelection(b,q);
var j=q.startNode;
while(j){var o=g.getParentNode(b,j);
if(g.isTag(j,"span")){if(g.getAttribute(j,"_rtetemp")=="spchk"){n.removeWithoutChildren(j);
a=true
}}j=o
}if(a){c.selectBookmark(b,m)
}}}},handleSourceEdit:function(a){if(a.enabled&&this.checkTextUI){this.checkTextUI.setSelected(false,true)
}},notifyPluginConfig:function(a){a=a||{};
CUI.rte.Utils.applyDefaults(a,{invalidStyle:"background-color: #ffffaa;",invalidClass:null,method:"POST",spellcheckerUrl:"/libs/cq/ui/rte/spellcheck",tooltips:{checktext:{title:CUI.rte.Utils.i18n("Check spelling"),text:CUI.rte.Utils.i18n("Checks the spelling of the entire text.")}}});
this.config=a
},getFeatures:function(){return["checktext"]
},initializeUI:function(a){var b=CUI.rte.plugins;
var c=CUI.rte.ui;
if(this.isFeatureEnabled("checktext")){this.checkTextUI=a.createElement("checktext",this,true,this.getTooltip("checktext"));
a.addElement("spellcheck",b.Plugin.SORT_LISTS,this.checkTextUI,10)
}},execute:function(g,c,a){var b=CUI.rte.DomProcessor;
switch(g){case"checktext":if(this.checkTextUI.isSelected()){this.checkText(a.editContext)
}else{this.clearInvalidationMarks(a.editContext)
}break;
case"replace":c.dom.innerHTML=c.replacement;
b.removeWithoutChildren(c.dom);
break
}},updateState:function(a){},handleContextMenu:function(n,m,b){var c=CUI.rte.Common;
var q=CUI.rte.ui;
var j=m.nodeList;
var a=c.getTagInPath(b,j.commonAncestor,"span",{_rtetemp:"spchk"});
if(a){var o=c.getAttribute(a,"_rtespchksugg");
var k=[];
if(o){o=o.split("|");
var g=o.length;
for(var r=0;
r<g;
r++){k.push({text:o[r],plugin:this,cmd:"replace",cmdValue:{dom:a,replacement:o[r]}})
}}else{k.push({text:CUI.rte.Utils.i18n("No suggestions available."),disabled:true})
}n.addItem(n.createItem({text:CUI.rte.Utils.i18n("Spelling suggestions"),subItems:k}))
}}});
CUI.rte.plugins.PluginRegistry.register("spellcheck",CUI.rte.plugins.SpellCheckerPlugin);
CUI.rte.plugins.StylesPlugin=new Class({toString:"StylePlugin",extend:CUI.rte.plugins.Plugin,cachedStyles:null,stylesUI:null,getFeatures:function(){return["styles"]
},reportStyles:function(){return[{type:"text",styles:this.getStyles()}]
},getStyles:function(){var a=CUI.rte.Common;
if(!this.cachedStyles){this.cachedStyles=this.config.styles;
if(this.cachedStyles){a.removeJcrData(this.cachedStyles);
this.cachedStyles=a.toArray(this.cachedStyles,"cssName","text")
}else{this.cachedStyles=[]
}}return this.cachedStyles
},setStyles:function(a){this.cachedStyles=a
},hasStylesConfigured:function(){return !!this.config.styles
},initializeUI:function(a,b){var c=CUI.rte.plugins;
if(this.isFeatureEnabled("styles")){this.stylesUI=new a.createStyleSelector("styles",this,null,this.getStyles());
a.addElement("styles",c.Plugin.SORT_STYLES,this.stylesUI,10)
}},notifyPluginConfig:function(a){a=a||{};
CUI.rte.Utils.applyDefaults(a,{});
this.config=a
},execute:function(a,g){if(!this.stylesUI){return
}var c=null;
var b=null;
switch(a.toLowerCase()){case"styles":c="applystyle";
b=(g!=null?g:this.stylesUI.getSelectedStyle());
break;
case"styles_remove":c="removestyle";
b={styles:this.getStyles()};
break
}if(c){this.editorKernel.relayCmd(c,b)
}},updateState:function(m){if(!this.stylesUI){return
}var b=CUI.rte.Common;
var t=m.styles;
var n=[];
var u;
var k=m.selectedDom;
if(k){if(!CUI.rte.Common.isTag(m.selectedDom,CUI.rte.plugins.StylesPlugin.STYLEABLE_OBJECTS)){k=null
}}var a=this.getStyles();
var r=a.length;
if(k){for(u=0;
u<r;
u++){var g=a[u].cssName;
if(b.hasCSS(k,g)){n.push({className:g})
}}}else{var j=t.length;
for(var o=0;
o<j;
o++){var q=t[o];
for(u=0;
u<r;
u++){if(a[u].cssName==q.className){n.push(q);
break
}}}}this.stylesUI.selectStyles(n,m)
}});
CUI.rte.plugins.StylesPlugin.STYLEABLE_OBJECTS=["img"];
CUI.rte.plugins.PluginRegistry.register("styles",CUI.rte.plugins.StylesPlugin);
CQ.form.rte.ui.TbElement=CQ.Ext.extend(CUI.rte.ui.ext.ElementImpl,{constructor:function(){this.construct.apply(this,arguments)
}});
CQ.form.rte.ui.CmItem=CQ.Ext.extend(CUI.rte.ui.ext.CmItemImpl,{constructor:function(){this.construct.apply(this,arguments)
}});
CQ.form.rte.ui.CmSeparator=CQ.Ext.extend(CUI.rte.ui.ext.CmSeparatorImpl,{constructor:function(){this.construct.apply(this,arguments)
}});
CQ.form.rte.ui.BaseWindow=CQ.Ext.extend(CQ.Ext.Window,{dialogHelper:null,parameters:null,objToEdit:null,applyFn:null,dialogItems:null,form:null,additionalFields:null,constructor:function(b){b=b||{};
if(!b.dialogItems){throw new Error("No dialogItems specified.")
}var c=b.dialogItems;
delete b.dialogItems;
this.dialogHelper=b.dialogHelper;
delete b.dialogHelper;
this.dialogHelper.removeDisabledItems(c);
this.additionalFields=this.dialogHelper.addAdditionalItems(c);
var a=this;
var g={renderTo:CQ.Util.ROOT_ID,modal:true,layout:"fit",stateful:false,closeAction:"cancel",items:[{xtype:"panel",layout:"fit",bodyStyle:"overflow: auto;",stateful:false,items:[{border:false,xtype:"form",stateful:false,items:c,afterRender:function(){CQ.Ext.form.FormPanel.prototype.afterRender.call(this);
this.body.addClass("cq-rte-basewindow");
a.dialogItems=this.items;
a.form=this.getForm()
}}]}],buttons:[{itemId:"okButton",name:"okButton",text:CQ.I18n.getMessage("OK"),handler:this.apply,disabled:false,scope:this},{itemId:"cancelButton",name:"cancelButton",text:CQ.I18n.getMessage("Cancel"),handler:this.cancel,disabled:false,scope:this}],listeners:{show:function(){this.dialogHelper.editorKernel.fireUIEvent("dialogshow")
},hide:function(){this.dialogHelper.editorKernel.fireUIEvent("dialoghide")
},scope:this}};
CQ.Util.applyDefaults(b,g);
CQ.form.rte.ui.BaseWindow.superclass.constructor.call(this,b)
},initializeEdit:function(c,b,a){this.editorKernel=c;
this.editContext=this.editorKernel.getEditContext();
this.objToEdit=b;
this.applyFn=a;
this.fromModel()
},apply:function(){if(this.validate()){this.toModel(this.objToEdit);
this.hide();
if(this.applyFn){this.applyFn(this.editContext,this.objToEdit)
}}},cancel:function(){this.hide()
},preprocessModel:function(){},dlgFromModel:function(){},fromModel:function(){this.preprocessModel();
var a=this.additionalFields.length;
for(var b=0;
b<a;
b++){var g=this.additionalFields[b];
if(g.fromModel){var c=this.getFieldByName(g.name);
if(c){g.fromModel(this.objToEdit,c)
}}}this.dlgFromModel()
},validate:function(){return this.form.isValid()
},dlgToModel:function(){},toModel:function(){this.dlgToModel();
var a=this.additionalFields.length;
for(var b=0;
b<a;
b++){var g=this.additionalFields[b];
if(g.toModel){var c=this.getFieldByName(g.name);
if(c){g.toModel(this.objToEdit,c)
}}}this.postprocessModel()
},postprocessModel:function(){},getFieldByName:function(b){var a=null;
this.dialogItems.each(function(c){if(c.isFormField){if(c.getName()==b){a=c;
return false
}}return true
});
return a
},getParameter:function(a){if(this.parameters&&this.parameters[a]){return this.parameters[a]
}return null
},show:function(c,a,b){CQ.form.rte.ui.BaseWindow.superclass.show.call(this,c,a,b);
CUI.rte.Utils.defer(function(){this.toFront();
this.focus()
},10,this)
}});
CQ.form.rte.commands.Command=CQ.Ext.extend(CUI.rte.commands.Command,{_rteCommandType:"compat",constructor:function(){if(this.construct){this.construct()
}}});
CQ.form.rte.commands.Command.PO_NONE=CUI.rte.commands.Command.PO_NONE;
CQ.form.rte.commands.Command.PO_SELECTION=CUI.rte.commands.Command.PO_SELECTION;
CQ.form.rte.commands.Command.PO_BOOKMARK=CUI.rte.commands.Command.PO_BOOKMARK;
CQ.form.rte.commands.Command.PO_NODELIST=CUI.rte.commands.Command.PO_NODELIST;
CQ.form.rte.commands.Anchor=CQ.Ext.extend(CUI.rte.commands.Anchor,{constructor:function(){if(this.construct){this.construct.apply(this,arguments)
}}});
CQ.form.rte.commands.CutCopy=CQ.Ext.extend(CUI.rte.commands.CutCopy,{constructor:function(){if(this.construct){this.construct.apply(this,arguments)
}}});
CQ.form.rte.commands.DefaultFormatting=CQ.Ext.extend(CUI.rte.commands.DefaultFormatting,{constructor:function(){if(this.construct){this.construct.apply(this,arguments)
}}});
CQ.form.rte.commands.Delete=CQ.Ext.extend(CUI.rte.commands.Delete,{constructor:function(){if(this.construct){this.construct.apply(this,arguments)
}}});
CQ.form.rte.commands.Delete.executeDelete=CUI.rte.commands.Delete.executeDelete;
CQ.form.rte.commands.Format=CQ.Ext.extend(CUI.rte.commands.Format,{constructor:function(){if(this.construct){this.construct.apply(this,arguments)
}}});
CQ.form.rte.commands.Image=CQ.Ext.extend(CUI.rte.commands.Image,{constructor:function(){if(this.construct){this.construct.apply(this,arguments)
}}});
CQ.form.rte.commands.Indent=CQ.Ext.extend(CUI.rte.commands.Indent,{constructor:function(){if(this.construct){this.construct.apply(this,arguments)
}}});
CQ.form.rte.commands.Indent.TAGEXCL=CUI.rte.commands.Indent.TAGEXCL;
CQ.form.rte.commands.Indent.DEFAULT_INDENT_SIZE=CUI.rte.commands.Indent.DEFAULT_INDENT_SIZE;
CQ.form.rte.commands.InsertHtml=CQ.Ext.extend(CUI.rte.commands.InsertHtml,{constructor:function(){if(this.construct){this.construct.apply(this,arguments)
}}});
CQ.form.rte.commands.Justify=CQ.Ext.extend(CUI.rte.commands.Justify,{constructor:function(){if(this.construct){this.construct.apply(this,arguments)
}}});
CQ.form.rte.commands.Link=CQ.Ext.extend(CUI.rte.commands.Link,{constructor:function(){if(this.construct){this.construct.apply(this,arguments)
}}});
CQ.form.rte.commands.Link.REMOVE_ATTRIBUTE=CUI.rte.commands.Link.REMOVE_ATTRIBUTE;
CQ.form.rte.commands.List=CQ.Ext.extend(CUI.rte.commands.List,{constructor:function(){if(this.construct){this.construct.apply(this,arguments)
}}});
CQ.form.rte.commands.Outdent=CQ.Ext.extend(CUI.rte.commands.Outdent,{constructor:function(){if(this.construct){this.construct.apply(this,arguments)
}}});
CQ.form.rte.commands.List.NO_LIST_AVAILABLE=CUI.rte.commands.List.NO_LIST_AVAILABLE;
CQ.form.rte.commands.Paste=CQ.Ext.extend(CUI.rte.commands.Paste,{constructor:function(){if(this.construct){this.construct.apply(this,arguments)
}}});
CQ.form.rte.commands.Paste.MODE_BROWSER=CUI.rte.commands.Paste.MODE_BROWSER;
CQ.form.rte.commands.Paste.MODE_PLAINTEXT=CUI.rte.commands.Paste.MODE_PLAINTEXT;
CQ.form.rte.commands.Paste.MODE_WORDHTML=CUI.rte.commands.Paste.MODE_WORDHTML;
CQ.form.rte.commands.Paste.ATOMIC_PROCESSING_BLOCKS=CUI.rte.commands.Paste.ATOMIC_PROCESSING_BLOCKS;
CQ.form.rte.commands.Style=CQ.Ext.extend(CUI.rte.commands.Style,{constructor:function(){if(this.construct){this.construct.apply(this,arguments)
}}});
CQ.form.rte.commands.SurroundBase=CQ.Ext.extend(CUI.rte.commands.SurroundBase,{constructor:function(){if(this.construct){this.construct.apply(this,arguments)
}}});
CQ.form.rte.commands.Table=CQ.Ext.extend(CUI.rte.commands.Table,{constructor:function(){if(this.construct){this.construct.apply(this,arguments)
}}});
CQ.form.rte.commands.Table.getCellFromSelection=CUI.rte.commands.Table.getCellFromSelection;
CQ.form.rte.commands.Table.getCellFromNodeList=CUI.rte.commands.Table.getCellFromNodeList;
CQ.form.rte.commands.Table.CONFIG_NONE=CUI.rte.commands.Table.CONFIG_NONE;
CQ.form.rte.commands.UndoRedo=CQ.Ext.extend(CUI.rte.commands.UndoRedo,{constructor:function(){if(this.construct){this.construct.apply(this,arguments)
}}});
CQ.form.rte.plugins.Plugin=CQ.Ext.extend(CUI.rte.plugins.Plugin,{_rtePluginType:"compat",constructor:function(b,a){this.construct(b,a)
}});
CQ.form.rte.plugins.Plugin.SORT_TABLE_TABLEMODE=CUI.rte.plugins.Plugin.SORT_TABLE_TABLEMODE;
CQ.form.rte.plugins.Plugin.SORT_EDIT=CUI.rte.plugins.Plugin.SORT_EDIT;
CQ.form.rte.plugins.Plugin.SORT_UNDO=CUI.rte.plugins.Plugin.SORT_UNDO;
CQ.form.rte.plugins.Plugin.SORT_FORMAT=CUI.rte.plugins.Plugin.SORT_FORMAT;
CQ.form.rte.plugins.Plugin.SORT_JUSTIFY=CUI.rte.plugins.Plugin.SORT_JUSTIFY;
CQ.form.rte.plugins.Plugin.SORT_LINKS=CUI.rte.plugins.Plugin.SORT_LINKS;
CQ.form.rte.plugins.Plugin.SORT_LISTS=CUI.rte.plugins.Plugin.SORT_LISTS;
CQ.form.rte.plugins.Plugin.SORT_IMAGE=CUI.rte.plugins.Plugin.SORT_IMAGE;
CQ.form.rte.plugins.Plugin.SORT_TABLE=CUI.rte.plugins.Plugin.SORT_TABLE;
CQ.form.rte.plugins.Plugin.SORT_STYLES=CUI.rte.plugins.Plugin.SORT_STYLES;
CQ.form.rte.plugins.Plugin.SORT_PARAFORMAT=CUI.rte.plugins.Plugin.SORT_PARAFORMAT;
CQ.form.rte.plugins.Plugin.SORT_SPELLCHECK=CUI.rte.plugins.Plugin.SORT_SPELLCHECK;
CQ.form.rte.plugins.Plugin.SORT_MISC=CUI.rte.plugins.Plugin.SORT_MISC;
CQ.form.rte.plugins.EditToolsPlugin=CQ.Ext.extend(CUI.rte.plugins.EditToolsPlugin,{_rtePluginType:"compat",constructor:function(){if(this.construct){this.construct.apply(this,arguments)
}}});
CQ.form.rte.plugins.FindReplacePlugin=CQ.Ext.extend(CUI.rte.plugins.FindReplacePlugin,{_rtePluginType:"compat",constructor:function(){if(this.construct){this.construct.apply(this,arguments)
}}});
CQ.form.rte.plugins.FormatPlugin=CQ.Ext.extend(CUI.rte.plugins.FormatPlugin,{_rtePluginType:"compat",constructor:function(){if(this.construct){this.construct.apply(this,arguments)
}}});
CQ.form.rte.plugins.ImagePlugin=CQ.Ext.extend(CUI.rte.plugins.ImagePlugin,{_rtePluginType:"compat",constructor:function(){if(this.construct){this.construct.apply(this,arguments)
}}});
CQ.form.rte.plugins.JustifyPlugin=CQ.Ext.extend(CUI.rte.plugins.JustifyPlugin,{_rtePluginType:"compat",constructor:function(){if(this.construct){this.construct.apply(this,arguments)
}}});
CQ.form.rte.plugins.KeyPlugin=CQ.Ext.extend(CUI.rte.plugins.KeyPlugin,{_rtePluginType:"compat",constructor:function(){if(this.construct){this.construct.apply(this,arguments)
}}});
CQ.form.rte.plugins.LinkPlugin=CQ.Ext.extend(CUI.rte.plugins.LinkPlugin,{_rtePluginType:"compat",constructor:function(){if(this.construct){this.construct.apply(this,arguments)
}}});
CQ.form.rte.plugins.LinkPlugin.LINKABLE_OBJECTS=CUI.rte.plugins.LinkPlugin.LINKABLE_OBJECTS;
CQ.form.rte.plugins.ListPlugin=CQ.Ext.extend(CUI.rte.plugins.ListPlugin,{_rtePluginType:"compat",constructor:function(){if(this.construct){this.construct.apply(this,arguments)
}}});
CQ.form.rte.plugins.MiscToolsPlugin=CQ.Ext.extend(CUI.rte.plugins.MiscToolsPlugin,{_rtePluginType:"compat",constructor:function(){if(this.construct){this.construct.apply(this,arguments)
}}});
CQ.form.rte.plugins.ParagraphFormatPlugin=CQ.Ext.extend(CUI.rte.plugins.ParagraphFormatPlugin,{_rtePluginType:"compat",constructor:function(){if(this.construct){this.construct.apply(this,arguments)
}}});
CQ.form.rte.plugins.SimpleFormatPlugin=CQ.Ext.extend(CUI.rte.plugins.SimpleFormatPlugin,{_rtePluginType:"compat",constructor:function(){if(this.construct){this.construct.apply(this,arguments)
}}});
CQ.form.rte.plugins.SpellCheckerPlugin=CQ.Ext.extend(CUI.rte.plugins.SpellCheckerPlugin,{_rtePluginType:"compat",constructor:function(){if(this.construct){this.construct.apply(this,arguments)
}}});
CQ.form.rte.plugins.StylesPlugin=CQ.Ext.extend(CUI.rte.plugins.StylesPlugin,{_rtePluginType:"compat",constructor:function(){if(this.construct){this.construct.apply(this,arguments)
}}});
CQ.form.rte.plugins.StylesPlugin.STYLEABLE_OBJECTS=CUI.rte.plugins.StylesPlugin.STYLEABLE_OBJECTS;
CQ.form.rte.plugins.SubSuperScriptPlugin=CQ.Ext.extend(CUI.rte.plugins.SubSuperScriptPlugin,{_rtePluginType:"compat",constructor:function(){if(this.construct){this.construct.apply(this,arguments)
}}});
CQ.form.rte.plugins.TablePlugin=CQ.Ext.extend(CUI.rte.plugins.TablePlugin,{_rtePluginType:"compat",constructor:function(){if(this.construct){this.construct.apply(this,arguments)
}}});
CQ.form.rte.plugins.TablePlugin.EDITMODE_DEFAULT=CUI.rte.plugins.TablePlugin.EDITMODE_DEFAULT;
CQ.form.rte.plugins.TablePlugin.EDITMODE_TABLE=CUI.rte.plugins.TablePlugin.EDITMODE_TABLE;
CQ.form.rte.plugins.UndoRedoPlugin=CQ.Ext.extend(CUI.rte.plugins.UndoRedoPlugin,{_rtePluginType:"compat",constructor:function(){if(this.construct){this.construct.apply(this,arguments)
}}});
CQ.form.rte.plugins.FindReplaceDialog=CQ.Ext.extend(CQ.Ext.Window,{editorKernel:null,editContext:null,isReplace:false,canReplace:false,findText:null,findNextText:null,findFn:null,replaceFn:null,constructor:function(b){var a=this;
var c=[];
var g=[];
var j={title:CQ.I18n.getMessage("Find/Replace"),isReplace:false,replaceFn:null,findFn:null,findText:CQ.I18n.getMessage("Find"),findNextText:CQ.I18n.getMessage("Find next"),listeners:{show:function(){this.editorKernel.fireUIEvent("dialogshow");
this.focusFindField.defer(150,this)
},hide:function(){this.editorKernel.fireUIEvent("dialoghide")
}}};
CQ.Util.applyDefaults(b,j);
CQ.Ext.apply(this,b);
c.push({itemId:"findText",name:"findText",xtype:"textfield",fieldLabel:CQ.I18n.getMessage("Find"),value:"",enableKeyEvents:true,listeners:{keyup:{fn:this.adjustButtonState,scope:this}},anchor:CQ.themes.Dialog.ANCHOR});
if(this.isReplace){c.push({itemId:"replaceText",name:"replaceText",xtype:"textfield",fieldLabel:CQ.I18n.getMessage("Replace with"),value:"",enableKeyEvents:true,anchor:CQ.themes.Dialog.ANCHOR})
}c.push({itemId:"matchCase",name:"matchCase",xtype:"checkbox",boxLabel:CQ.I18n.getMessage("Match case"),value:false});
g.push({itemId:"find",name:"find",text:this.findText,handler:function(){this.applyDialog(this.findFn,null)
},disabled:true,scope:this});
if(this.isReplace){g.push({itemId:"replace",name:"replace",text:CQ.I18n.getMessage("Replace"),handler:function(){this.applyDialog(this.replaceFn,{replaceAll:false})
},disabled:true,scope:this});
g.push({itemId:"replaceAll",name:"replaceAll",text:CQ.I18n.getMessage("Replace all"),handler:function(){this.applyDialog(this.replaceFn,{replaceAll:true})
},disabled:true,scope:this})
}g.push({text:CQ.I18n.getMessage("Close"),handler:function(){this.hide();
this.editorKernel.focus.defer(1,this.editorKernel);
if(this.cancelFn){this.cancelFn()
}},scope:this});
CQ.form.rte.plugins.FindReplaceDialog.superclass.constructor.call(this,{renderTo:CQ.Util.ROOT_ID,title:this.title,stateful:false,minWidth:350,minHeight:170,width:350,height:170,plain:true,layout:"fit",items:[{xtype:"panel",layout:"fit",stateful:false,items:[{border:false,xtype:"form",itemId:"findReplaceForm",stateful:false,items:c,bodyStyle:"overflow: auto;",afterRender:function(){CQ.Ext.Panel.prototype.afterRender.call(this);
a.findItems=this.items;
this.body.addClass("cq-rte-findreplacedialog")
}}]}],buttons:g,modal:true})
},applyDialog:function(b,a){a=a||{};
if(b){a.findText=this.findItems.get("findText").getValue();
a.matchCase=this.findItems.get("matchCase").getValue();
if(this.isReplace){a.replaceText=this.findItems.get("replaceText").getValue()
}b(this.editContext,a,this)
}},adjustButtonState:function(a,c){var g=this.findItems.get("findText").getValue();
var b=(g.length>0);
if(this.isReplace){this.buttons[0].setDisabled(!b);
this.buttons[1].setDisabled(!(b&this.canReplace));
this.buttons[2].setDisabled(!b)
}else{this.buttons[0].setDisabled(!b)
}if(b&&(c.keyCode==CQ.Ext.EventObject.ENTER)){this.applyDialog(this.findFn,null)
}},setMode:function(b,a){this.canReplace=a;
if(b){this.buttons[0].setText(this.findText)
}else{this.buttons[0].setText(this.findNextText)
}if(this.isReplace){this.buttons[1].setDisabled(!a)
}},focusFindField:function(){this.findItems.get("findText").focus()
}});
CQ.form.rte.plugins.LinkDialog=CQ.Ext.extend(CQ.form.rte.ui.BaseWindow,{constructor:function(a){a=a||{};
var b={title:CQ.I18n.getMessage("Hyperlink"),modal:true,width:400,height:160,dialogItems:[{itemId:"href",name:"href",parBrowse:true,anchor:CQ.themes.Dialog.ANCHOR,fieldLabel:CQ.I18n.getMessage("Link to"),xtype:"pathfield",ddGroups:[CQ.wcm.EditBase.DD_GROUP_PAGE,CQ.wcm.EditBase.DD_GROUP_ASSET],fieldDescription:CQ.I18n.getMessage("Drop files or pages from the Content Finder"),listeners:{dialogselect:{fn:this.selectAnchor,scope:this},render:this.initHrefDragAndDrop},validator:CUI.rte.Utils.scope(this.validateLink,this),validationEvent:"keyup",escapeAmp:true},{itemId:"targetBlank",name:"targetBlank",xtype:"checkbox",boxLabel:CQ.I18n.getMessage("Open in new window"),value:"targetBlank"}]};
CQ.Util.applyDefaults(a,b);
CQ.form.rte.plugins.LinkDialog.superclass.constructor.call(this,a)
},selectAnchor:function(c,b,a){b=CQ.HTTP.encodePath(b);
b=b.replace(/&/g,"%26");
if(a&&(a.length>0)){b+=".html#"+a
}c.setValue(b)
},initHrefDragAndDrop:function(){if(this.ddGroups){if(typeof(this.ddGroups)=="string"){this.ddGroups=[this.ddGroups]
}var g=this;
var c=new CQ.wcm.EditBase.DropTarget(this.el,{notifyDrop:function(o,m,n){if(o&&o.clearAnimations){o.clearAnimations(this)
}if(o.isDropAllowed(this)){if(n.records&&n.single){var k=n.records[0];
var q=k.get("path");
q=CQ.HTTP.encodePath(q);
q=q.replace(/&/g,"%26");
g.setValue(q);
m.stopEvent();
return true
}return false
}}});
var b=this.findParentByType(CQ.form.rte.plugins.LinkDialog);
b.on("activate",function(m){if(m&&m.el&&this.highlight){var k=parseInt(m.el.getStyle("z-index"),10);
if(!isNaN(k)){this.highlight.zIndex=k+1
}}},c);
b.on("deactivate",function(m){if(m&&m.el&&this.highlight){var k=parseInt(m.el.getStyle("z-index"),10);
if(!isNaN(k)){this.highlight.zIndex=k+1
}}},c);
var j=b.getParameter("editorKernel");
b.on("show",function(){j.fireUIEvent("preventdrop");
CQ.WCM.registerDropTargetComponent(g)
},c);
b.on("hide",function(){CQ.WCM.unregisterDropTargetComponent(g);
j.fireUIEvent("reactivatedrop")
},c);
for(var a=0;
a<this.ddGroups.length;
a++){c.addToGroup(this.ddGroups[a])
}c.removeFromGroup(CQ.wcm.EditBase.DD_GROUP_DEFAULT);
this.dropTargets=[c]
}},getField:function(b){var a=this.find("name","./"+b);
if((CUI.rte.Utils.isArray(a))&&(a.length>0)){return a[0]
}},preprocessModel:function(){var j=false;
if(this.objToEdit&&this.objToEdit.dom){this.objToEdit.href=CUI.rte.HtmlRules.Links.getLinkHref(this.objToEdit.dom);
var a=CUI.rte.Common;
var b=a.getAttributeNames(this.objToEdit.dom,false,function(q,n,o){return o==a.HREF_ATTRIB||o=="href"||o=="target"
});
for(var c=0;
c<b.length;
c++){var g=b[c];
var k=a.getAttribute(this.objToEdit.dom,g);
if(typeof k!=="undefined"){this.objToEdit.attributes[g]=k
}}if(this.objToEdit.attributes.onclick){j=true
}}var m=this.getField("linkdialog/cq:adhocLinkTrackingTab");
if(m){if(j){m.expand(false)
}else{m.collapse(false)
}}},dlgFromModel:function(){var b=this.getFieldByName("href");
if(b){var o="";
if(this.objToEdit){var a=this.objToEdit.href;
if(a){o=a
}}b.setRawValue(o);
b.clearInvalid()
}var t=this.getFieldByName("targetBlank");
if(t){var j=(this.objToEdit&&this.objToEdit.target?this.objToEdit.target.toLowerCase():null);
t.setValue(j=="_blank")
}if(typeof CQ_Analytics!=="undefined"&&typeof CQ_Analytics.adhocLinkTracking!=="undefined"&&CQ_Analytics.adhocLinkTracking=="true"){var c=this.getField("linkdialog/cq:adhocLinkTrackingEnableTracking");
var n=this.getField("linkdialog/cq:adhocLinkTrackingEvents");
var m=this.getField("linkdialog/cq:adhocLinkTrackingEvars");
if(n&&m){var r="",q="",g=false;
if(this.objToEdit){var o=this.objToEdit.attributes.adhocevents;
if(typeof o!=="undefined"){r=o
}o=this.objToEdit.attributes.adhocevars;
if(typeof o!=="undefined"){q=o
}o=this.objToEdit.attributes.adhocenable;
if(typeof o!=="undefined"){g=o=="true"
}}n.setValue(r);
m.setValue(q);
c.setValue(g);
this.enableSCFields(g)
}}else{var k=this.getField("linkdialog/cq:adhocLinkTrackingTab");
if(k){k.hide()
}}},dlgToModel:function(){if(this.objToEdit){var k=this.getFieldByName("href");
if(k){var c=k.getValue();
if(c){this.objToEdit.href=c
}}var j=this.getFieldByName("targetBlank");
if(j){if(j.getValue()){this.objToEdit.target="_blank"
}else{this.objToEdit.target=null
}}var g=this.getField("linkdialog/cq:adhocLinkTrackingEnableTracking");
var b=this.getField("linkdialog/cq:adhocLinkTrackingEvents");
var a=this.getField("linkdialog/cq:adhocLinkTrackingEvars");
if(g&&b&&a){this.objToEdit.attributes.adhocenable=g.getValue()?"true":"false";
this.objToEdit.attributes.adhocevents=b.getValue()||"";
this.objToEdit.attributes.adhocevars=a.getValue()||"";
if(g.getValue()){this.objToEdit.attributes.onclick="CQ_Analytics.Sitecatalyst.customTrack(this)"
}else{delete this.objToEdit.attributes.onclick;
if(this.objToEdit.dom&&this.objToEdit.dom.attributes){CUI.rte.Common.removeAttribute(this.objToEdit.dom,"onclick")
}}}}},enableSCFields:function(c){var b=this.getField("linkdialog/cq:adhocLinkTrackingEvents");
var a=this.getField("linkdialog/cq:adhocLinkTrackingEvars");
if(c){b.enable();
a.enable()
}else{b.disable();
a.disable()
}},postprocessModel:function(){var a=this.parameters.linkRules;
if(a){a.applyToObject(this.objToEdit)
}},validateLink:function(a){var c=this.getParameter("linkRules");
if(!c){return(a.length>0?true:CQ.I18n.getMessage("No link provided"))
}var b=c.validateHref(a);
return b||CQ.I18n.getMessage("Invalid link")
}});
CQ.Ext.reg("rtelinkdialog",CQ.form.rte.plugins.LinkDialog);
CQ.form.rte.plugins.AnchorDialog=CQ.Ext.extend(CQ.Dialog,{editorKernel:null,execute:null,constructor:function(b){b=b||{};
var a=[{xtype:"textfield",name:"name",fieldLabel:CQ.I18n.getMessage("Name"),fieldDescription:CQ.I18n.getMessage("Leave empty to remove anchor."),anchor:CQ.themes.Dialog.ANCHOR}];
CQ.Util.applyDefaults(b,{title:CQ.I18n.getMessage("Anchor"),modal:true,width:400,height:200,items:[{xtype:"panel",layout:"fit",items:[{xtype:"panel",layout:"form",cls:"cq-rte-anchordialog",border:false,items:a}]}],ok:function(){var c=this.getName();
var g=null;
if(c){g=c
}this.hide();
if(this.execute){this.execute(g)
}},listeners:{show:function(){this.editorKernel.fireUIEvent("dialogshow")
},hide:function(){this.editorKernel.fireUIEvent("dialoghide")
}}});
CQ.form.rte.plugins.AnchorDialog.superclass.constructor.call(this,b)
},getContainer:function(){return this.getComponent(0).getComponent(0)
},getName:function(){var g=null;
var c=this.getContainer();
var b=c.getComponent(0);
var a=b.getValue();
if(a.length>0){g=a
}return g
},resetValues:function(){var b=this.getContainer();
var a=b.getComponent(0);
a.setValue("")
},setAnchor:function(g){var c=this.getContainer();
var b=c.getComponent(0);
var a=g.name;
if(a){b.setValue(a)
}}});
CQ.Ext.reg("rteanchordialog",CQ.form.rte.plugins.AnchorDialog);
CQ.form.rte.plugins.SpecialCharsDialog=CQ.Ext.extend(CQ.Dialog,{editContext:null,charsInTable:null,backRef:null,constructor:function(a){var j=CQ.form.rte.plugins.SpecialCharsDialog.SPECIAL_CHARS_PER_ROW;
var r="<table";
if(a.tableCls){r+=' class="'+a.tableCls+'"'
}r+="><tr><td";
if(a.magnifyCls){r+=' class="'+a.magnifyCls+'"'
}r+=">&nbsp;</td></tr></table>";
var k="<table";
if(a.tableCls){k+=' class="'+a.tableCls+'"'
}k+=">";
this.chars=a.chars;
this.charsInTable=[];
var m=0;
for(var n in this.chars){if(this.chars.hasOwnProperty(n)){var g=this.chars[n];
var b;
if(g.entity){b=m%j;
if(b==0){k+="<tr>"
}k+="<td";
if(a.cellCls!=null){k+=' class="'+a.cellCls+'"'
}k+=">";
k+=g.entity;
k+="</td>";
this.charsInTable.push(g.entity);
if(b==(j-1)){k+="</tr>"
}m++
}else{if((g.rangeStart)&&(g.rangeEnd)){for(var q=g.rangeStart;
q<=g.rangeEnd;
q++){var c="&#"+q+";";
b=m%j;
if(b==0){k+="<tr>"
}k+="<td";
if(a.cellCls!=null){k+=' class="'+a.cellCls+'"'
}k+=">";
k+=c;
k+="</td>";
this.charsInTable.push(c);
if(b==(j-1)){k+="</tr>"
}m++
}}}}}b=m%j;
if(b>0){for(;
b<j;
b++){k+="<td>&nbsp;</td>"
}k+="</tr>"
}k+="</table>";
delete a.chars;
delete a.tableCls;
delete a.cellCls;
delete a.magnifyCls;
var o=this;
CQ.Util.applyDefaults(a,{title:CQ.I18n.getMessage("Insert special character"),modal:true,width:450,height:300,buttons:CQ.Dialog.CANCEL,items:[{xtype:"panel",layout:"border",items:[{xtype:"panel",region:"center",cls:"cq-rte-specialcharsdialog",border:false,html:k,autoScroll:true,afterRender:function(){var v=CUI.rte.Common;
CQ.Ext.Panel.prototype.afterRender.call(this);
var A=this.body.dom.firstChild;
var B;
if(v.ua.isIE){B=A.cells
}else{B=[];
var D=A.rows;
for(var t=0;
t<D.length;
t++){var C=D[t];
for(var y=0;
y<C.childNodes.length;
y++){if(C.childNodes[y].nodeType==1){B.push(C.childNodes[y])
}}}}var x=o.charsInTable.length;
for(var w=0;
w<x;
w++){var z=B[w];
var u=CQ.Ext.get(z);
z.charToInsert=o.charsInTable[w];
CQ.Ext.EventManager.on(u,"click",function(){o.hide();
o.insertCharacter(this.charToInsert)
});
CQ.Ext.EventManager.on(u,"mouseover",function(){if(o.overCls){var E=CQ.Ext.get(this);
E.addClass(o.overCls)
}if(o.magnifierCell){o.magnifierCell.innerHTML=this.charToInsert
}});
CQ.Ext.EventManager.on(u,"mouseout",function(){if(o.overCls){var E=CQ.Ext.get(this);
E.removeClass(o.overCls)
}if(o.magnifierCell){o.magnifierCell.innerHTML="&nbsp;"
}})
}}},{xtype:"panel",region:"east",cls:"cq-rte-specialcharsdialog",width:70,border:false,html:r,afterRender:function(){CQ.Ext.Panel.prototype.afterRender.call(this);
var t=this.body.dom.firstChild;
var u=t.rows[0];
o.magnifierCell=u.childNodes[0]
}}]}],listeners:{show:function(){this.editorKernel.fireUIEvent("dialogshow")
},hide:function(){this.editorKernel.fireUIEvent("dialoghide")
}}});
CQ.form.rte.plugins.SpecialCharsDialog.superclass.constructor.call(this,a)
}});
CQ.form.rte.plugins.SpecialCharsDialog.SPECIAL_CHARS_PER_ROW=16;
CQ.Ext.reg("rtespecialcharsdialog",CQ.form.rte.plugins.SpecialCharsDialog);
CQ.form.rte.plugins.TablePropertiesDialog=CQ.Ext.extend(CQ.Ext.Window,{constructor:function(c){if(!c){c={}
}this.table=c.table;
this.cmd=c.cmd;
this.editContext=c.editContext;
var b=c.pluginConfig;
this.execFn=c.execFn;
this.cancelFn=c.cancelFn;
var k=c.listeners;
this.tableStyles=b.tableStyles;
this.defaultValues=b.defaultValues;
var m=b.tablePropConfig.basicDefs;
var g=b.tablePropConfig.basicStyling;
var n=[];
if(m){if(!this.table){n.push({itemId:"columns",name:"columns",allowBlank:false,xtype:"textfield",width:50,fieldLabel:CQ.I18n.getMessage("Columns"),regex:/^[1-9][0-9]*$/});
n.push({itemId:"rows",name:"rows",allowBlank:false,xtype:"textfield",width:50,fieldLabel:CQ.I18n.getMessage("Rows"),regex:/^[1-9][0-9]*$/});
n.push({itemId:"header",name:"header",xtype:"selection",type:"select",options:[{value:"none",text:CQ.I18n.getMessage("No header")},{value:"top",text:CQ.I18n.getMessage("First row")},{value:"left",text:CQ.I18n.getMessage("First column")},{value:"topleft",text:CQ.I18n.getMessage("First row and column")}],fieldLabel:CQ.I18n.getMessage("Header")})
}n.push({itemId:"width",name:"width",xtype:"textfield",width:50,fieldLabel:CQ.I18n.getMessage("Width"),regex:/(^[1-9][0-9]*$)|(^1?[0-9][0-9]%$)/});
n.push({itemId:"height",name:"height",xtype:"textfield",width:50,fieldLabel:CQ.I18n.getMessage("Height"),regex:/(^[1-9][0-9]*$)|(^1?[0-9][0-9]%$)/})
}if(g){n.push({itemId:"border",name:"border",xtype:"textfield",width:50,fieldLabel:CQ.I18n.getMessage("Border"),regex:/^[0-9][0-9]?$/});
n.push({itemId:"cellpadding",name:"cellpadding",xtype:"textfield",width:50,fieldLabel:CQ.I18n.getMessage("Cell padding"),regex:/^[0-9][0-9]?$/});
n.push({itemId:"cellspacing",name:"cellspacing",xtype:"textfield",width:50,fieldLabel:CQ.I18n.getMessage("Cell spacing"),regex:/^[0-9][0-9]?$/})
}if(this.tableStyles){var j=[{value:"---",text:CQ.I18n.getMessage("[None]")}];
var o=this.tableStyles.length;
for(var r=0;
r<o;
r++){var a=this.tableStyles[r];
j.push({value:a.cssName,text:a.text})
}n.push({itemId:"tableStyle",name:"tableStyle",xtype:"selection",type:"select",fieldLabel:CQ.I18n.getMessage("Style"),options:j})
}var q=this;
CQ.form.rte.plugins.TablePropertiesDialog.superclass.constructor.call(this,{renderTo:CQ.Util.ROOT_ID,title:CQ.I18n.getMessage("Table properties"),stateful:false,minWidth:300,minHeight:300,width:300,height:350,plain:true,layout:"fit",items:[{xtype:"panel",layout:"fit",stateful:false,items:[{border:false,xtype:"form",itemId:"tablePropForm",stateful:false,items:n,bodyStyle:"overflow: auto;",afterRender:function(){CQ.Ext.Panel.prototype.afterRender.call(this);
q.propertyItems=this.items;
this.body.addClass("cq-rte-tablepropsdialog");
var t=q.calculateTableConfig();
if(t){this.items.each(function(u){var w=u.itemId;
var v=t[w];
if(v||u.isXType("selection")){if(v==null){v="---"
}u.setValue(v)
}return true
},this)
}}}]}],buttons:[{text:CQ.I18n.getMessage("OK"),handler:function(){this.applyDialog()
},scope:this},{text:CQ.I18n.getMessage("Cancel"),handler:function(){this.hide();
if(this.cancelFn){this.cancelFn()
}},scope:this}],listeners:k,modal:true})
},calculateTableConfig:function(){var a=CUI.rte.Common;
var b;
if(this.table){b={};
this.propertyItems.each(function(q){var j=q.itemId;
if(j=="tableStyle"){var n=this.tableStyles.length;
var c=CUI.rte.Common.parseCSS(this.table);
var o=false;
for(var k=0;
(k<c.length)&&!o;
k++){for(var r=0;
r<n;
r++){var g=this.tableStyles[r];
if(g.cssName==c[k]){b[j]=c[k];
o=true;
break
}}}}else{if(q.styleAttrib){b[j]=this.table.style[q.styleAttrib]
}else{var m=q.domProp||j;
b[j]=a.getAttribute(this.table,m)
}}return true
},this)
}else{b=this.defaultValues
}return b
},createTableConfig:function(){var a={};
this.propertyItems.each(function(b){var g=b.itemId;
var c=b.getValue();
if(b.isXType("selection")){if(c=="---"){c=null
}}if(c){a[g]=c
}return true
},this);
return a
},applyDialog:function(){var a=this.findBy(function(c){return(c.getItemId()=="tablePropForm")
});
if(a&&a.length==1){a=a[0];
var b=a.getForm();
if(b.isValid()){this.hide();
this.execFn(this.cmd,this.createTableConfig(),this.editContext)
}}},focus:function(){CQ.form.rte.plugins.TablePropertiesDialog.superclass.focus.call(this);
this.propertyItems.each(function(a){if(a.isXType("textfield")){CUI.rte.Utils.defer(a.focus,1);
return false
}return true
})
}});
CQ.form.rte.plugins.CellPropertiesDialog=CQ.Ext.extend(CQ.Ext.Window,{constructor:function(c){c=c||{};
var b=c.pluginConfig;
this.cell=c.cell;
this.editContext=c.editContext;
this.execFn=c.execFn;
this.cancelFn=c.cancelFn;
this.cellStyles=b.cellStyles;
var j=b.cellPropConfig.basicDefs;
var k=[];
if(j){k.push({itemId:"width",name:"width",xtype:"textfield",width:50,fieldLabel:CQ.I18n.getMessage("Width"),regex:/(^[1-9][0-9]*$)|(^1?[0-9][0-9]%$)/});
k.push({itemId:"height",name:"height",xtype:"textfield",width:50,fieldLabel:CQ.I18n.getMessage("Height"),regex:/(^[1-9][0-9]*$)|(^1?[0-9][0-9]%$)/});
k.push({itemId:"align",name:"align",styleAttrib:"textAlign",xtype:"selection",type:"select",fieldLabel:CQ.I18n.getMessage("Horizontal align"),options:[{value:"---",text:CQ.I18n.getMessage("[None]")},{value:"left",text:CQ.I18n.getMessage("Left")},{value:"center",text:CQ.I18n.getMessage("Center")},{value:"right",text:CQ.I18n.getMessage("Right")}]});
k.push({itemId:"valign",name:"valign",xtype:"selection",type:"select",fieldLabel:CQ.I18n.getMessage("Vertical align"),options:[{value:"---",text:CQ.I18n.getMessage("[None]")},{value:"top",text:CQ.I18n.getMessage("Top")},{value:"middle",text:CQ.I18n.getMessage("Middle")},{value:"bottom",text:CQ.I18n.getMessage("Bottom")},{value:"baseline",text:CQ.I18n.getMessage("Baseline")}]})
}if(this.cellStyles){var g=[{value:"---",text:CQ.I18n.getMessage("[None]")}];
var m=this.cellStyles.length;
for(var o=0;
o<m;
o++){var a=this.cellStyles[o];
g.push({value:a.cssName,text:a.text})
}k.push({itemId:"cellStyle",name:"cellStyle",xtype:"selection",type:"select",fieldLabel:CQ.I18n.getMessage("Style"),options:g})
}k.push({itemId:"cellType",name:"cellType",xtype:"selection",type:"select",fieldLabel:CQ.I18n.getMessage("Cell type"),options:[{text:CQ.I18n.getMessage("[Change to ...]"),value:"---"},{text:CQ.I18n.getMessage("Data"),value:"td"},{text:CQ.I18n.getMessage("Header"),value:"th"}]});
k.push({itemId:"_applyTo",name:"_applyTo",xtype:"selection",type:"radio",fieldLabel:CQ.I18n.getMessage("Apply to ..."),value:"cell",options:[{value:"cell",text:CQ.I18n.getMessage("Single cell")},{value:"row",text:CQ.I18n.getMessage("Entire row")},{value:"column",text:CQ.I18n.getMessage("Entire column")}],optionsConfig:{getResizeEl:function(){return this.wrap
}}});
var n=this;
CQ.form.rte.plugins.CellPropertiesDialog.superclass.constructor.call(this,{renderTo:CQ.Util.ROOT_ID,title:CQ.I18n.getMessage("Cell properties"),stateful:false,minWidth:300,minHeight:300,width:300,height:350,plain:true,layout:"fit",items:[{xtype:"panel",layout:"fit",stateful:false,items:[{border:false,xtype:"form",itemId:"cellPropForm",stateful:false,items:k,bodyStyle:"overflow: auto;",afterRender:function(){CQ.Ext.Panel.prototype.afterRender.call(this);
n.propertyItems=this.items;
this.body.addClass("cq-rte-cellpropsdialog");
var q=n.calculateCellConfig();
if(q){this.items.each(function(t){var v=t.itemId;
var r=!v||(v.charAt(0)=="_");
if(!r){var u=q[v];
if(u||t.isXType("selection")){if(u==null){u="---"
}t.setValue(u)
}}return true
},this)
}}}]}],buttons:[{text:CQ.I18n.getMessage("OK"),handler:function(){this.applyDialog()
},scope:this},{text:CQ.I18n.getMessage("Cancel"),handler:function(){this.hide();
if(this.cancelFn){this.cancelFn()
}},scope:this}],listeners:{show:function(){this.editorKernel.fireUIEvent("dialogshow")
},hide:function(){this.editorKernel.fireUIEvent("dialoghide")
}},modal:true})
},calculateCellConfig:function(){var a=CUI.rte.Common;
var b={};
this.propertyItems.each(function(q){var j=q.itemId;
if(j=="cellStyle"){var n=this.cellStyles.length;
var c=a.parseCSS(this.cell);
var o=false;
for(var k=0;
(k<c.length)&&!o;
k++){for(var r=0;
r<n;
r++){var g=this.cellStyles[r];
if(g.cssName==c[k]){b[j]=c[k];
o=true;
break
}}}}else{if(q.styleAttrib){if(this.cell.style[q.styleAttrib]){b[j]=this.cell.style[q.styleAttrib]
}}else{var m=q.domProp||j;
if(a.isAttribDefined(this.cell,m)){b[j]=a.getAttribute(this.cell,m)
}}}return true
},this);
return b
},createCellConfig:function(){var a={};
this.propertyItems.each(function(b){var g=b.itemId;
var c=b.getValue();
if(b.isXType("selection")){if(c=="---"){c=CUI.rte.commands.Table.CONFIG_NONE
}}if(c){a[g]=c
}return true
},this);
return a
},applyDialog:function(){var a=this.findBy(function(c){return(c.getItemId()=="cellPropForm")
});
if(a&&a.length==1){a=a[0];
var b=a.getForm();
if(b.isValid()){this.hide();
this.execFn(this.createCellConfig(),this.editContext)
}}}});
CQ.form.rte.plugins.PasteDialog=CQ.Ext.extend(CQ.Ext.Window,{constructor:function(b){if(!b){b={}
}var a;
if(b.type=="iframe"){a=new CQ.form.rte.plugins.PasteDialog.IFrame({itemId:"pasteArea",region:"center",stateful:false})
}else{a={xtype:"textarea",itemId:"pasteArea",region:"center",stateful:false}
}var c={renderTo:CQ.Util.ROOT_ID,title:CQ.I18n.getMessage("Paste"),stateful:false,minWidth:300,minHeight:200,width:300,height:200,plain:true,layout:"border",items:[{xtype:"label",margins:"4 4 4 4",html:CQ.I18n.getMessage('Please use the field below to paste with Ctrl+V, then hit "OK".'),region:"north",minSize:25,maxSize:50,bodyBorder:false,hideBorders:true,border:false,cls:null,stateful:false},a],buttons:[{text:CQ.I18n.getMessage("OK"),handler:function(){var j=this.items.get("pasteArea");
var k=(this.type=="iframe");
var m=j.getValue();
var n=null;
if(k){var g=j.getDom();
n=this.editContext.createElement("div");
n.innerHTML=g.innerHTML
}this.hide();
if(this.pasteFn){this.pasteFn(this.editContext,m,k,n)
}},scope:this},{text:CQ.I18n.getMessage("Cancel"),handler:function(){this.hide();
if(this.cancelFn){this.cancelFn()
}},scope:this}],listeners:{show:function(){this.editorKernel.fireUIEvent("dialogshow")
},hide:function(){this.editorKernel.fireUIEvent("dialoghide")
}},modal:true};
CQ.Util.applyDefaults(b,c);
CQ.form.rte.plugins.PasteDialog.superclass.constructor.call(this,b)
},setValue:function(b){var a=this.items.get("pasteArea");
a.setValue(b)
},focus:function(){var a=this.items.get("pasteArea");
a.focus(false,10)
}});
CQ.form.rte.plugins.PasteDialog.IFrame=CQ.Ext.extend(CQ.Ext.Panel,{autoEl:"div",onRender:function(b,c){var a=CUI.rte.Common;
CQ.form.rte.plugins.PasteDialog.IFrame.superclass.onRender.call(this,b,c);
this.iframe=document.createElement("iframe");
this.iframe.name=CQ.Ext.id();
this.iframe.frameBorder="0";
this.iframe.src=a.ua.isIE?CQ.Ext.SSL_SECURE_URL:"javascript:;";
this.body.dom.appendChild(this.iframe);
this.win=a.ua.isIE?this.iframe.contentWindow:window.frames[this.iframe.name];
this.win.document.open();
this.win.document.write('<html><head><style type="text/css">body{border:0;margin:0;padding:3px;cursor:text;font-family:sans-serif;font-size:11px}</style></head><body></body></html>');
this.win.document.close()
},focus:function(){this.win.document.designMode="on";
window.setTimeout(CUI.rte.Utils.scope(function(){this.win.focus()
},this),10)
},getValue:function(){if(!this.rendered){return""
}return this.win.document.body.innerHTML
},getDom:function(){if(!this.rendered){return null
}return this.win.document.body
},setValue:function(b){if(!this.rendered){return
}var a=CUI.rte.Common;
if(a.ua.isGecko){this.win.document.designMode="off"
}this.win.document.body.innerHTML=b;
if(a.ua.isGecko){this.win.document.designMode="on"
}},onResize:function(a,b){CQ.form.rte.plugins.PasteDialog.IFrame.superclass.onResize.call(this,a,b);
if(CUI.rte.Utils.isArray(a)){b=a[1];
a=a[0]
}if(this.iframe&&a&&b){this.iframe.width=a;
this.iframe.height=b
}}});
CQ.form.rte.plugins.ImagePropertiesDialog=CQ.Ext.extend(CQ.Dialog,{editorKernel:null,execute:null,constructor:function(c){c=c||{};
this.cmd=c.cmd;
this.execFn=c.execFn;
this.image=c.image;
var b=this;
var a=[{itemId:"alt",xtype:"textfield",name:"alt",fieldLabel:CQ.I18n.getMessage("Alternate Text"),anchor:CQ.themes.Dialog.ANCHOR}];
CQ.Util.applyDefaults(c,{title:CQ.I18n.getMessage("Image Properties"),modal:true,width:300,height:150,items:[{xtype:"panel",layout:"fit",items:[{xtype:"panel",layout:"form",border:false,items:a,afterRender:function(){CQ.Ext.Panel.prototype.afterRender.call(this);
b.propertyItems=this.items;
this.body.addClass("cq-rte-imagepropsdialog");
var g=b.calculateImageConfig();
if(g){this.items.each(function(j){var m=j.itemId;
var k=g[m];
if(k){j.setValue(k)
}return true
},this)
}}}]}],buttons:[{text:CQ.I18n.getMessage("OK"),handler:function(){this.hide();
this.execFn(this.cmd,this.createImageConfig())
},scope:this},{text:CQ.I18n.getMessage("Cancel"),handler:function(){this.hide();
if(this.cancelFn){this.cancelFn()
}},scope:this}],listeners:{show:function(){this.editorKernel.fireUIEvent("dialogshow")
},hide:function(){this.editorKernel.fireUIEvent("dialoghide")
}}});
CQ.form.rte.plugins.ImagePropertiesDialog.superclass.constructor.call(this,c)
},createImageConfig:function(){var a={};
this.propertyItems.each(function(b){var g=b.itemId;
var c=b.getValue();
if(c!=null){a[g]=c
}return true
},this);
return a
},calculateImageConfig:function(){var a=CUI.rte.Common;
var b;
if(this.image){b={};
this.propertyItems.each(function(c){var g=c.itemId;
b[g]=a.getAttribute(this.image,g);
return true
},this)
}return b
}});
(function(){CUI.rte.ui.ToolkitRegistry.initialize(CUI.rte._toolkit);
CUI.rte.Utils.setI18nProvider(new CUI.rte.CqI18nProvider())
})();
CQ.form.RichText=CQ.Ext.extend(CQ.Ext.form.Field,{validationEvent:false,deferHeight:true,initialized:false,activated:false,sourceEditMode:false,onFocus:CQ.Ext.emptyFn,iframePad:3,hideMode:"offsets",defaultAutoCreate:{tag:"textarea",style:"width:500px;height:300px;",autocomplete:"off"},externalStyleSheets:null,requiredCssPath:null,allowBlank:true,adjustEditorToToolbarHeight:false,keepSourceEditMode:false,requiredStyleSheets:null,requiredLinkedCss:null,actionMode:"wrap",savedDropTargets:null,dataPath:null,editorKernel:null,isDroppingAllowed:false,focusOnInitialize:false,constructor:function(b){var a=CUI.rte.Common;
var c={name:"text",ddAccept:"image/;application/pdf",height:CUI.rte.Theme.DEFAULT_HEIGHT,requiredCssPath:CUI.rte.Theme.DEFAULT_REQCSS_PATH,adjustEditorToToolbarHeight:true,keepSourceEditMode:false};
this.requiredStyleSheets=null;
this.requiredLinkedCss={iframeDefault:"RichText.iframe.css"};
CQ.Util.applyDefaults(b,c);
this.editorKernel=new CUI.rte.IFrameKernel(b);
CQ.form.RichText.superclass.constructor.call(this,b);
a.removeJcrData(this.externalStyleSheets);
a.removeJcrData(this.requiredLinkedCss);
this.isDroppingAllowed=true;
this.focusOnInitialize=false;
if(this.height){this.editorHeight=this.height
}},processRecord:function(a,c){this.editorKernel.setContentPath(c);
if(this.fireEvent("beforeloadcontent",this,a,c)!==false){var b=a.get(this.getName());
if(b==undefined&&this.defaultValue!=null){if(this.isApplyDefault(a,c)){this.setValue(this.defaultValue)
}}else{this.setValue(b?b:"")
}this.fireEvent("loadcontent",this,a,c)
}},validateValue:function(a){if(a.length<1||a===CQ.Ext.form.TextField.prototype.emptyText){if(this.allowBlank){this.clearInvalid();
return true
}else{this.markInvalid(CQ.Ext.form.TextField.prototype.blankText);
return false
}}if(typeof this.validator=="function"){var b=this.validator(a);
if(b!==true){this.markInvalid(b);
return false
}}if(this.regex&&!this.regex.test(a)){this.markInvalid(CQ.Ext.form.TextField.prototype.regexText);
return false
}return true
},markInvalid:function(b){if(!this.rendered||this.preventMark){return
}b=b||this.invalidText;
var a=this.iframeWrap.mask();
a.addClass(this.invalidClass);
a.dom.qtip=b;
a.dom.qclass="x-form-invalid-tip";
a.on("click",function(){this.clearInvalid();
this.focus()
},this);
if(CQ.Ext.QuickTips){CQ.Ext.QuickTips.enable()
}this.fireEvent("invalid",this,b)
},clearInvalid:function(){if(!this.rendered||this.preventMark){return
}if(this.iframeWrap){this.iframeWrap.unmask()
}this.fireEvent("valid",this)
},initComponent:function(){this.addEvents("initialize","activate","beforesync","beforepush","sync","push","editmodechange")
},afterRender:function(){CQ.form.RichText.superclass.afterRender.call(this);
if(this.editorHeight){this.setHeight(this.editorHeight)
}this.initializeDragAndDrop()
},onRender:function(g,a){CQ.form.RichText.superclass.onRender.call(this,g,a);
this.el.dom.style.border="0 none";
this.el.dom.setAttribute("tabIndex",-1);
this.el.addClass("x-hidden");
if(CQ.Ext.isIE){this.el.applyStyles("margin-top:-1px;margin-bottom:-1px;")
}this.wrap=this.el.wrap({cls:"x-html-editor-wrap",cn:{cls:"x-html-editor-tb"}});
this.createToolbar();
var k=document.createElement("iframe");
k.name=CQ.Ext.id();
k.frameBorder="0";
k.src=(CQ.Ext.SSL_SECURE_URL||"javascript:;");
this.wrap.dom.appendChild(k);
this.iframe=k;
var j=CQ.Ext.get(k);
this.iframeWrap=j.wrap();
var c=!j.isVisible(true);
if(CQ.Ext.isIE){this.doc=k.contentWindow.document;
this.win=k.contentWindow
}else{this.doc=(k.contentDocument||window.frames[k.name].document);
this.win=window.frames[k.name]
}this.doc.open();
this.doc.write(this.getDocMarkup());
this.doc.close();
this.setDesignMode(true);
var n=function(){if(j.isVisible(true)){if(this.doc.body||(this.doc.readyState=="complete")){CQ.Ext.TaskMgr.stop(b);
this.initEditor.defer(10,this)
}}};
var b={run:n,interval:(c?100:10),scope:this};
if(!c){b.duration=10000
}CQ.Ext.TaskMgr.start(b);
if(!this.width){this.setSize(this.el.getSize())
}j.setVisibilityMode(CQ.Ext.Element.DISPLAY);
var m=this.findParentByType("dialog");
if(m){m.on("show",function(q){var o=CQ.Ext.get(this.iframe);
if(o){o.show()
}if(this.sourceEditMode){if(this.keepSourceEditMode){this.el.removeClass("x-hidden");
this.el.dom.removeAttribute("tabIndex")
}else{this.toggleSourceEdit(false)
}}},this);
m.on("hide",function(q){var o=CQ.Ext.get(this.iframe);
if(o){o.hide()
}if(this.sourceEditMode){this.el.addClass("x-hidden");
this.el.dom.setAttribute("tabIndex",-1)
}},this);
m.on("beforesubmit",function(o){if(this.initialized){this.syncValue()
}},this)
}},onResize:function(c,g){CQ.form.RichText.superclass.onResize.apply(this,arguments);
if(this.el&&this.iframe){var j=this.wrap.getHeight();
var n;
if(typeof(c)=="number"){var k=c-this.wrap.getFrameWidth("lr");
this.el.setWidth(this.adjustWidth("textarea",k));
if(!isNaN(k)&&(k>0)){this.iframe.style.width=k+"px"
}}else{if((typeof(c)=="string")&&CUI.rte.Common.strEndsWith(c,"%")){this.iframe.style.width="100%";
c=this.wrap.getWidth()
}}var m=this.editorKernel.getToolbarHeight();
this.editorKernel.adjustToolbarToWidth(c);
var a=this.editorKernel.getToolbarHeight();
if((typeof g=="number")||((m!=a)&&this.adjustEditorToToolbarHeight)){if(!g){g=j-this.wrap.getFrameWidth("tb")
}var b=g-this.wrap.getFrameWidth("tb")-a;
this.el.setHeight(this.adjustWidth("textarea",b));
if(!isNaN(b)&&(b>0)){this.iframe.style.height=b+"px"
}}}},createEditContext:function(){if(this.initialized){return new CUI.rte.EditContext(this.iframe,this.getWin(),this.getDoc(),this.getEditorBody())
}return new CUI.rte.EditContext()
},addStyleSheets:function(){var o=CUI.rte.Common;
var R=this.doc.getElementsByTagName("head")[0];
if(this.externalStyleSheets){for(var Q in this.externalStyleSheets){if(this.externalStyleSheets.hasOwnProperty(Q)){var b=this.externalStyleSheets[Q];
var c=this.doc.createElement("link");
c.type="text/css";
c.rel="stylesheet";
c.href=CQ.HTTP.externalize(b);
c.media="screen";
R.appendChild(c)
}}}var N=[];
if(this.requiredStyleSheets){var O=this.requiredStyleSheets.length;
for(var L=0;
L<O;
L++){N.push(this.requiredStyleSheets[L])
}}for(var a in this.editorKernel.registeredPlugins){var k=this.editorKernel.registeredPlugins[a];
var r=k.reportStyles();
if(r!=null){var H=r.length;
for(var D=0;
D<H;
D++){var C=r[D];
var y=C.styles;
if(y!=null){var F=y.length;
for(var E=0;
E<F;
E++){var z=y[E].cssName;
if(!o.arrayContains(N,z)){N.push(z)
}}}}}}var n=N.length;
var v=document.styleSheets;
var x=v.length;
var M,u,G,B,q,A,I,K,j,m;
if(o.ua.isOldIE){var g=this.doc.createStyleSheet();
for(m=0;
m<n;
m++){M=N[m];
for(u=0;
u<x;
u++){G=v[u];
B=G.rules;
q=B.length;
A=null;
for(I=0;
I<q;
I++){K=B[I];
j=K.selectorText;
if(j=="."+M){g.addRule("."+j,K.style.cssText);
break
}}}}}else{var w=this.doc.createElement("style");
w.type="text/css";
var P="";
for(m=0;
m<n;
m++){M=N[m];
for(u=0;
u<x;
u++){try{G=v[u];
B=G.cssRules;
q=B.length;
A=null;
for(I=0;
I<q;
I++){K=B[I];
if(K.type){if(K.type==CSSRule.STYLE_RULE){j=K.selectorText;
if(j==("."+M)){A=K;
break
}}}}if(A){P+=A.cssText;
break
}}catch(J){}}}w.appendChild(this.doc.createTextNode(P));
R.appendChild(w)
}},getDocMarkup:function(){var c="<html><head>";
if(this.requiredLinkedCss){for(var b in this.requiredLinkedCss){if(this.requiredLinkedCss.hasOwnProperty(b)){var a=this.requiredCssPath+"/"+this.requiredLinkedCss[b];
c+='<link rel="stylesheet" type="text/css" href="'+CQ.shared.HTTP.getXhrHookedURL(CQ.HTTP.externalize(a))+'">'
}}}c+='</head><body id="CQrte" spellcheck="false">'+this.editorKernel.getEmptyLinePlaceholderMarkup()+"</body></html>";
return c
},getEditorBody:function(){return this.doc.body||this.doc.documentElement
},getDoc:function(){return CQ.Ext.isIE?this.getWin().document:(this.iframe.contentDocument||this.getWin().document)
},getWin:function(){return CQ.Ext.isIE?this.iframe.contentWindow:window.frames[this.iframe.name]
},adjustSize:CQ.Ext.BoxComponent.prototype.adjustSize,getResizeEl:function(){return this.wrap
},getPositionEl:function(){return this.wrap
},initEvents:function(){this.originalValue=this.getValue()
},deferFocus:function(){this.focus.defer(10,this)
},adjustWidth:function(a,b){a=a.toLowerCase();
if(typeof b=="number"&&!CQ.Ext.isSafari){if(CQ.Ext.isIE&&(a=="input"||a=="textarea")){if(a=="textarea"&&CQ.Ext.isStrict){return b-2
}}else{if(CQ.Ext.isOpera&&CQ.Ext.isStrict){if(a=="textarea"){return b-2
}}}}return b
},initEditor:function(){var b=this.getEditorBody();
var a=this.el.getStyles("font-size","font-family","background-image","background-repeat");
a["background-attachment"]="fixed";
b.bgProperties="fixed";
CQ.Ext.DomHelper.applyStyles(b,a);
if(this.doc){try{CQ.Ext.EventManager.removeAll(this.doc)
}catch(c){}}this.doc=this.getDoc();
this.addStyleSheets();
this.editorKernel.initializeEditContext(this.iframe,this.win,this.doc,this.getEditorBody());
this.editorKernel.initializeEventHandling();
this.editorKernel.addUIListener("updatestate",this.updateToolbar,this);
this.editorKernel.addUIListener("preventdrop",this.preventDrop,this);
this.editorKernel.addUIListener("reactivatedrop",this.reactivateDrop,this);
this.editorKernel.addUIListener("enablesourceedit",function(){this.toggleSourceEdit(true)
}.createDelegate(this),this);
this.editorKernel.addUIListener("disablesourceedit",function(){this.toggleSourceEdit(false)
}.createDelegate(this),this);
this.initialized=true;
this.fireEvent("initialize",this);
this.doc.editorInitialized=true;
this.pushValue();
if(this.focusOnInitialize){this.deferFocus();
this.focusOnInitialize=false
}},onFirstFocus:function(){this.activated=true;
this.fireEvent("activate",this)
},focus:function(b,a){if(a){this.focus.defer(CQ.Ext.isNumber(a)?a:10,this,[b,false]);
return null
}if(this.rendered){if(!this.sourceEditMode){if(this.initialized){this.editorKernel.focus()
}else{this.focusOnInitialize=true
}}else{this.el.focus()
}}else{this.focusOnInitialize=true
}},blur:function(){if(this.rendered){if(!this.sourceEditMode){if(this.initialized){this.editorKernel.blurFocus()
}else{this.focusOnInitialize=false
}}else{this.el.blur()
}}else{this.focusOnInitialize=false
}},onDestroy:function(){if(this.monitorTask){CQ.Ext.TaskMgr.stop(this.monitorTask)
}if(this.rendered){this.editorKernel.destroyToolbar();
this.iframeWrap.innerHTML="";
this.iframeWrap.remove();
this.wrap.dom.innerHTML="";
this.wrap.remove()
}},syncValue:function(){if(this.initialized){var a=this.editorKernel.getProcessedHtml();
if(this.fireEvent("beforesync",this,a)!==false){this.el.dom.value=a;
this.fireEvent("sync",this,a)
}}},getRawValue:function(){if(this.sourceEditMode){this.pushValue()
}this.syncValue();
return CQ.form.RichText.superclass.getRawValue.call(this)
},getValue:function(){return this.getRawValue()
},pushValue:function(){if(this.initialized){var a=this.el.dom.value;
if(this.fireEvent("beforepush",this,a)!==false){if(!CQ.Ext.isGecko){this.editorKernel.setUnprocessedHtml(a)
}else{this.getEditorBody().innerHTML="";
var b=this.doc.designMode;
this.doc.designMode="off";
this.editorKernel.setUnprocessedHtml(a);
this.doc.designMode=b;
if(this.doc.designMode=="on"){this.editorKernel.initializeGeckoSpecific.defer(10,this.editorKernel)
}}this.fireEvent("push",this,a)
}}},setValue:function(a){this.value=a;
if(this.rendered){this.el.dom.value=(a===null||a===undefined?"":a)
}this.pushValue();
if(this.rendered){this.validate()
}(function(){if(this.initialized){this.editorKernel.initializeCaret(true)
}this.editorKernel.execCmd("initializeundo")
}).defer(1,this)
},setDesignMode:function(a){if(CQ.Ext.isIE){this.doc.body.contentEditable=a
}else{this.doc.designMode=(a?"on":"off")
}},enable:function(){this.setDesignMode(true);
this.enableDropping();
this.el.dom.disabled=false;
CQ.form.RichText.superclass.enable.call(this);
this.editorKernel.enable()
},disable:function(){this.editorKernel.disable();
this.disableDropping();
this.el.dom.disabled=true;
this.setDesignMode(false);
CQ.form.RichText.superclass.disable.call(this)
},createToolbar:function(){this.editorKernel.createToolbar({renderToDom:this.wrap.dom.firstChild});
this.editorKernel.disableToolbar()
},updateToolbar:function(){if(!this.activated){this.onFirstFocus();
return
}this.editorKernel.updateToolbar()
},toggleSourceEdit:function(b){if(b===undefined){b=!this.sourceEditMode
}b=b===true;
var a=b!==this.sourceEditMode;
this.sourceEditMode=b;
var g=this.editorKernel.getToolbarItem("sourceedit");
if(g){g.toggle(this.sourceEditMode)
}if(!a){return
}if(this.sourceEditMode){this.editorKernel.disableFocusHandling();
this.editorKernel.notifyBlur();
this.editorKernel.disableToolbar(["sourceedit"]);
this.disableDropping();
this.syncValue();
this.iframe.className="x-hidden";
this.el.removeClass("x-hidden");
this.el.dom.removeAttribute("tabIndex");
this.el.focus();
this.editorKernel.firePluginEvent("sourceedit",{enabled:true},false)
}else{this.editorKernel.enableFocusHandling();
if(this.initialized&&!this.disabled){this.editorKernel.enableToolbar()
}if(!this.disabled){this.enableDropping()
}this.iframe.className="";
this.el.addClass("x-hidden");
this.el.dom.setAttribute("tabIndex",-1);
this.pushValue();
this.deferFocus();
this.editorKernel.firePluginEvent("sourceedit",{enabled:false},false)
}var c=this.lastSize;
if(c){delete this.lastSize;
this.setSize(c)
}this.fireEvent("editmodechange",this,this.sourceEditMode)
},enableDropping:function(){this.isDroppingAllowed=true
},disableDropping:function(){this.isDroppingAllowed=false
},getToplevel:function(){var a=this.findParentByType("dialog");
if(!a){a=this.findParentByType(CQ.Ext.form.FormPanel)
}return a
},initializeDragAndDrop:function(){if(!this.ddGroups){this.ddGroups=[CQ.wcm.EditBase.DD_GROUP_PAGE,CQ.wcm.EditBase.DD_GROUP_ASSET]
}if(typeof(this.ddGroups)=="string"){this.ddGroups=[this.ddGroups]
}var j=this;
var k=new CQ.wcm.EditBase.DropTarget(this.wrap,{notifyDrop:function(q,m,o){if(q&&q.clearAnimations){q.clearAnimations(this)
}if(q.isDropAllowed(this)){var n=j.handleDrop(o);
if(n){m.stopEvent()
}return n
}}});
var c=this.getToplevel();
if(c){c.on("activate",function(n){if(n&&n.el&&this.highlight){var m=parseInt(n.el.getStyle("z-index"),10);
if(!isNaN(m)){this.highlight.zIndex=m+1
}}},k);
c.on("deactivate",function(n){if(n&&n.el&&this.highlight){var m=parseInt(n.el.getStyle("z-index"),10);
if(!isNaN(m)){this.highlight.zIndex=m+1
}}},k)
}for(var b=0;
b<this.ddGroups.length;
b++){k.addToGroup(this.ddGroups[b])
}k.removeFromGroup(CQ.wcm.EditBase.DD_GROUP_DEFAULT);
var a=this.ddAccept;
if(a){if(!CUI.rte.Utils.isArray(a)){var g=new RegExp("[ ;]+","g");
a=a.split(g)
}k.ddAccept=a
}this.dropTargets=[k]
},preventDrop:function(){this.savedDropTargets=this.dropTargets;
this.dropTargets=null
},reactivateDrop:function(){this.dropTargets=this.savedDropTargets
},handleDrop:function(j){var b=CUI.rte.Selection;
var c=CUI.rte.Common;
if(j.records&&j.single){var k=j.records[0];
var n=CQ.HTTP.encodePath(k.get("path"));
var a=k.get("mimeType");
var g=(a=="");
var o=this.editorKernel.createQualifiedSelection(this.editorKernel.getEditContext());
if(o&&b.isSelection(o)){n=n.replace(/&/g,"%26");
if(g){n=n+CQ.HTTP.EXTENSION_HTML
}this.editorKernel.relayCmd("modifylink",{url:n})
}else{if(c.strStartsWith(a,"image/")){var m={path:n};
this.editorKernel.relayCmd("insertimg",m)
}}return true
}return false
},isDropAllowedForObject:function(j){var c=CUI.rte.Selection;
var b=CUI.rte.Common;
if(j.records&&j.single&&this.isDroppingAllowed){var a=j.records[0];
var k=a.get("mimeType");
var g=this.editorKernel.createQualifiedSelection(this.editorKernel.getEditContext());
if(g&&c.isSelection(g)){return true
}if(!g||!c.isSelection(g)){this.editorKernel.restoreSelectionToLastKnownBookmark();
if(b.strStartsWith(k,"image/")){return true
}}}return false
}});
CQ.Ext.reg("richtext",CQ.form.RichText);
CQ.form.TableEdit2=CQ.Ext.extend(CQ.form.RichText,{useColPercentage:false,constructor:function(a){var b={useColPercentage:false,listeners:{loadcontent:{fn:this.onLoadContent,scope:this}},rtePlugins:{table:{features:"*",defaultValues:{width:"100%"},editMode:CUI.rte.plugins.TablePlugin.EDITMODE_TABLE}}};
CQ.Util.applyDefaults(a,b);
CQ.form.TableEdit2.superclass.constructor.call(this,a)
},onRender:function(c,a){CQ.form.TableEdit2.superclass.onRender.call(this,c,a);
var b=this.findParentByType("dialog");
if(b){var g=b.getField("./hasHeaders");
if(g){b.on("beforesubmit",function(){g.setValue("false")
})
}}},deleteRow:function(){this.relayCmd("removerow",null)
},deleteColumn:function(){this.relayCmd("removecolumn",null)
},addRows:function(g){var u=this.getTableDom(this.getEditorBody());
if(!u){return
}var b=this.editorKernel.getEditContext();
var j=new CUI.rte.TableMatrix();
j.createTableMatrix(u);
var w=j.getTableSize();
var o=w.cols;
var k=CQ.Ext.DomQuery.select("tbody:first",u)[0];
for(var a=0;
a<g;
a++){var v=this.doc.createElement("tr");
for(var m=0;
m<o;
m++){var t=this.doc.createElement("td");
var q=CUI.rte.DomProcessor.createEmptyLinePlaceholder(b,false);
if(q){t.appendChild(q)
}v.appendChild(t)
}k.appendChild(v)
}},addColumns:function(g){var t=this.getTableDom(this.getEditorBody());
if(!t){return
}var b=this.editorKernel.getEditContext();
var j=new CUI.rte.TableMatrix();
j.createTableMatrix(t);
var w=j.getTableSize();
var v=w.rows;
var k=CQ.Ext.DomQuery.select("tbody:first",t)[0];
for(var a=0;
a<v;
a++){var u=j.getRowDom(a);
for(var m=0;
m<g;
m++){var q=this.doc.createElement("td");
var o=CUI.rte.DomProcessor.createEmptyLinePlaceholder(b,false);
if(o){q.appendChild(o)
}u.appendChild(q)
}k.appendChild(u)
}},getTableDom:function(b){var a=CQ.Ext.DomQuery.select("table:first",b);
if(a.length==0){return null
}return a[0]
},processPercentagePerTable:function(w,j){var v=w.clientWidth;
var a=CQ.Ext.DomQuery.select("tr:first",w)[0];
var o=CQ.Ext.DomQuery.select("tr:first",j)[0];
var b=a.childNodes.length;
var m=[];
var u=0;
var z;
for(z=0;
z<b;
z++){var t=a.childNodes[z].clientWidth;
var q=Math.round((t/v)*100);
u+=q;
m.push(q)
}var A=(100-u)/b;
var n=Math.floor(A);
var k=A-n;
var r=0;
for(z=0;
z<b;
z++){var g=o.childNodes[z];
var x=m[z]+n;
var y=Math.floor(k+r)-Math.floor(r);
r+=k;
x+=y;
g.setAttribute("width",x+"%")
}},getHtmlPayload:function(g){if(!this.useColPercentage){return g.innerHTML
}var c=this.doc.createElement("span");
var b=this.getTableDom(g);
c.appendChild(b.cloneNode(true));
var a=CQ.Ext.DomQuery.select("table:first",c);
if(a.length==0){throw new Error("Internal error - table copy not found.")
}a=a[0];
this.processPercentagePerTable(b,a);
return c.innerHTML
},onLoadContent:function(q,o){var g=CUI.rte.Common;
var v=o.get("hasHeaders");
var w=false;
if(v){w=(v===true)||(v=="true")
}if(w){var x=this.getTableDom(this.getEditorBody());
var k=CQ.Ext.DomQuery.select("tbody tr:first",x);
if(k.length==1){var y=k[0].childNodes;
var n=y.length;
for(var r=0;
r<n;
r++){var u=y[r];
if(g.isTag(u,"td")){var j=this.doc.createElement("th");
var b=u.attributes;
for(var t=0;
t<b.length;
t++){var m=b[t];
j.setAttribute(m.name,m.value)
}g.replaceNode(u,j)
}}}}}});
CQ.Ext.reg("tableedit2",CQ.form.TableEdit2);
CQ.ipe.InplaceEditing=function(){var a={};
return{register:function(b,c){a[b]=c
},create:function(b,c){if(!a[b]){return null
}return new a[b](c)
}}
}();
CQ.ipe.InplaceEditor=CQ.Ext.extend(CQ.Ext.emptyFn,{resizeListeners:null,repositionListeners:null,config:null,initialUndoContent:null,contentType:null,constructor:function(a){if(a){CQ.Ext.apply(this,a)
}this.resizeListeners=[];
this.repositionListeners=[]
},init:function(){},getProperty:function(){},start:function(c,b,a){this.componentType=(c&&c.getResourceType?c.getResourceType():null)
},finish:function(a){},cancel:function(a){},addResizeListener:function(a){this.resizeListeners.push(a)
},removeResizeListener:function(b){var c=this.resizeListeners.length;
for(var a=c-1;
a>=0;
a--){if(this.resizeListeners[a]==b){this.resizeListeners.splice(a,1)
}}},removeAllResizeListeners:function(){this.resizeListeners.length=0
},addRepositionListener:function(a){this.repositionListeners.push(a)
},removeRepositionListener:function(b){var c=this.repositionListeners.length;
for(var a=c-1;
a>=0;
a--){if(this.repositionListeners[a]==b){this.repositionListeners.splice(a,1)
}}},removeAllRepositionListeners:function(){this.repositionListeners.length=0
},fireResizeEvent:function(b,g){var c=this.resizeListeners.length;
for(var a=c-1;
a>=0;
a--){this.resizeListeners[a](b,g)
}},fireRepositionEvent:function(c,b){var g=this.repositionListeners.length;
for(var a=g-1;
a>=0;
a--){this.repositionListeners[a](c,b)
}},execConfigFunction:function(b,a,j){var g=(b.scope?b.scope:this);
var c=b[a];
if(c){c.apply(g,j)
}},loadEditorConfig:function(c,b){var a=c.configPath+CQ.Sling.SELECTOR_INFINITY+CQ.HTTP.EXTENSION_JSON;
a=CQ.HTTP.externalize(CQ.HTTP.noCaching(a));
CQ.Ext.Ajax.request({method:"GET",url:CQ.shared.HTTP.getXhrHookedURL(a),success:function(g){this.onConfigSuccess(g,b)
},failure:function(g){if(g.status==404){this.config=null;
CQ.Log.trace("CQ.ipe.InplaceEditor#loadEditorConfig: No editor configuration found, using defaults.");
this.execConfigFunction(b,"onSuccess",[this,g])
}else{this.execConfigFunction(b,"onFailure",[this,g])
}},scope:this})
},onConfigSuccess:function(a,b){var c=true;
try{if(a&&(a.status==200)){this.config=CQ.Ext.util.JSON.decode(a.responseText);
this.config=CQ.Util.formatData(this.config);
this.overrideConfig();
c=false
}}catch(g){this.config=null
}if(!c){this.execConfigFunction(b,"onSuccess",[this,a])
}else{this.execConfigFunction(b,"onFailure",[this,a])
}},transferConfigOption:function(a){if(this.config&&(this.config[a]!=null)){this[a]=this.config[a]
}},overrideConfig:function(){},notifyInitialUndoContent:function(b,a){if(CQ.undo.UndoManager.isEnabled()){this.undoPath=b;
this.initialUndoContent=a
}},addUndoStep:function(k){if(CQ.undo.UndoManager.isEnabled()&&this.undoPath&&this.componentType){var j=this.getProperty();
var b=CQ.undo.UndoManager.getHistory();
var a=b.createUndoStep(b.createStepConfig());
var g={};
g[j]=this.initialUndoContent;
var c={};
c[j]=k;
a.addUndoAction(new CQ.undo.actions.UpdateParagraphAction(b.getIdManager(),this.undoPath,this.componentType,g,c,new CQ.undo.util.FormStub()));
a.commit()
}},isDropAllowed:function(a){return false
},notifyDrop:function(a){}});
CQ.ipe.TextEditor=CQ.Ext.extend(CQ.ipe.InplaceEditor,{textPropertyName:null,boxCheckInterval:0,editElementQuery:null,savedSpellcheckAttrib:null,savedOutlineStyle:null,isBoxChangeCheckActive:false,editComponent:null,textContainer:null,currentSize:null,currentPosition:null,boxChangeHandler:null,isEmptyContent:false,editorKernel:null,constructor:function(a){a=a||{};
CQ.Util.applyDefaults(a,{textPropertyName:"./text",boxCheckInterval:500});
CQ.ipe.TextEditor.superclass.constructor.call(this,a)
},checkBoxChanged:function(g){if(this.isBoxChangeCheckActive){var c=CQ.Ext.get(this.textContainer);
var m=c.getXY();
var o=m[0];
var n=m[1];
if((o!=this.currentPosition.x)||(n!=this.currentPosition.y)){var j=this.currentPosition;
var k={x:o,y:n};
this.currentPosition=k;
this.fireRepositionEvent(k,j)
}var r=c.getSize();
var b=r.width;
var q=r.height;
if((b!=this.currentSize.width)||(q!=this.currentSize.height)){var a=this.currentSize;
this.currentSize=r;
this.fireResizeEvent(r,a)
}if(!g){window.setTimeout(this.boxChangeHandler,this.boxCheckInterval)
}}},isEmptyText:function(){var b=CQ.Ext.DomQuery.selectNode("span:first",this.textContainer);
if(!b){return false
}var a=CQ.Ext.get(b);
return a.hasClass(CQ.themes.TextEditor.EMPTY_COMPONENT_CLASS)
},prepareForNewText:function(){CUI.rte.Common.removeAllChildren(this.textContainer)
},getTextDiv:function(c){var b=this.editElementQuery||"div:first";
if(b=="."){return c.dom
}var a=CQ.Ext.DomQuery.selectNode(b,c.dom);
if(!a){a=c.dom
}return a
},resetInplaceEditing:function(){this.deactivateEditorKernel();
CQ.Ext.EventManager.un(document.body,"keyup",this.handleKeyUp,this);
CQ.WCM.unloadToolbar();
this.textContainer.blur();
this.textContainer.contentEditable="inherit";
document.body.spellcheck=this.savedSpellcheckAttrib;
if(CQ.Ext.isGecko&&this.savedOutlineStyle){this.textContainer.style.outlineStyle=this.savedOutlineStyle
}this.isBoxChangeCheckActive=false
},updateState:function(){this.editorKernel.updateToolbar()
},onDialogShow:function(){var a=this.editorKernel.getEditContext();
this.savedSelection=this.editorKernel.createQualifiedRangeBookmark(a);
this.editorKernel.disableEventHandling();
window.CQ_inplaceEditDialog=true
},onDialogHide:function(){CUI.rte.Utils.defer(function(){window.CQ_inplaceEditDialog=false;
this.editorKernel.reenableEventHandling();
var a=this.editorKernel.getEditContext();
this.editorKernel.selectQualifiedRangeBookmark(a,this.savedSelection)
},1,this)
},handleKeyUp:function(a){if(!window.CQ_inplaceEditDialog){if(a.getCharCode()==27){this.editComponent.cancelInplaceEditing()
}else{this.checkBoxChanged(true)
}}},initializeEditorKernel:function(a){this.editorKernel.addUIListener("updatestate",this.updateState,this);
this.editorKernel.addUIListener("dialogshow",this.onDialogShow,this);
this.editorKernel.addUIListener("dialoghide",this.onDialogHide,this);
this.editorKernel.initializeEditContext(window,document,this.textContainer);
this.editorKernel.initializeEventHandling();
this.editorKernel.setUnprocessedHtml(a||"");
this.editorKernel.initializeCaret(true);
this.editorKernel.execCmd("initializeundo")
},deactivateEditorKernel:function(){if(this.editorKernel!=null){this.editorKernel.removeUIListener("updatestate");
this.editorKernel.removeUIListener("dialogshow");
this.editorKernel.removeUIListener("dialoghide");
this.editorKernel.suspendEventHandling();
this.editorKernel.destroyToolbar()
}},getProperty:function(){return this.textPropertyName
},start:function(j,c,b){CQ.ipe.TextEditor.superclass.start.call(this,j,c,b);
this.notifyInitialUndoContent(j.path,b);
if(this.editorKernel==null){this.editorKernel=new CUI.rte.DivKernel(this.config)
}this.editorKernel.createToolbar();
this.editComponent=j;
this.textContainer=this.getTextDiv(c);
var a=CQ.Ext.get(this.textContainer);
this.currentSize=a.getSize();
var g=a.getXY();
this.currentPosition={x:g[0],y:g[1]};
this.isEmptyContent=this.isEmptyText();
if(this.isEmptyContent){this.prepareForNewText()
}this.savedSpellcheckAttrib=document.body.spellcheck;
document.body.spellcheck=false;
CQ.Ext.EventManager.on(document.body,"keyup",this.handleKeyUp,this);
this.textContainer.contentEditable="true";
if(CQ.Ext.isGecko||CQ.Ext.isWebKit){this.savedOutlineStyle=this.textContainer.style.outlineStyle;
this.textContainer.style.outlineStyle="none"
}this.initializeEditorKernel(b);
this.isBoxChangeCheckActive=true;
this.boxChangeHandler=CUI.rte.Utils.scope(function(){this.checkBoxChanged(false)
},this);
window.setTimeout(this.boxChangeHandler,this.boxCheckInterval)
},finish:function(){var a=this.editorKernel.getProcessedHtml();
this.resetInplaceEditing();
this.editComponent.updateParagraph(this.textPropertyName,a,{"./textIsRich":true});
this.addUndoStep(a)
},cancel:function(){this.resetInplaceEditing();
this.editComponent.refreshSelf()
},isDroppingAllowed:true,isDropAllowed:function(c){var k=c.dragData;
var g=CUI.rte.Selection;
var b=CUI.rte.Common;
if(k.records&&k.single&&this.isDroppingAllowed){var a=k.records[0];
var m=a.get("mimeType");
var j=this.editorKernel.createQualifiedSelection(this.editorKernel.getEditContext());
if(j&&g.isSelection(j)){return true
}if(!j||!g.isSelection(j)){if(b.strStartsWith(m,"image/")){return true
}}}return false
},notifyDrop:function(n){var j=n.dragData;
var b=CUI.rte.Selection;
var c=CUI.rte.Common;
if(j.records&&j.single){var k=j.records[0];
var q=CQ.HTTP.encodePath(k.get("path"));
var a=k.get("mimeType");
var g=(a=="");
var o=this.editorKernel.createQualifiedSelection(this.editorKernel.getEditContext());
if(o&&b.isSelection(o)){if(g){q=q+CQ.HTTP.EXTENSION_HTML
}this.editorKernel.relayCmd("modifylink",{url:q})
}else{if(c.strStartsWith(a,"image/")){var m={path:q};
this.editorKernel.restoreSelectionToLastKnownBookmark();
this.editorKernel.relayCmd("insertimg",m)
}}}},overrideConfig:function(){this.transferConfigOption("editElementQuery");
this.transferConfigOption("textPropertyName");
this.transferConfigOption("boxCheckInterval")
}});
CQ.ipe.InplaceEditing.register("text",CQ.ipe.TextEditor);
CQ.ipe.InplaceEditing.register("textimage",CQ.ipe.TextEditor);
CQ.ipe.PlainTextEditor=CQ.Ext.extend(CQ.ipe.InplaceEditor,{textPropertyName:null,editElementQuery:null,boxCheckInterval:0,enterKeyMode:null,tabKeyMode:null,savedSpellcheckAttrib:null,savedOutlineStyle:null,isBoxChangeCheckActive:false,editComponent:null,textContainer:null,currentSize:null,currentPosition:null,boxChangeHandler:null,isEmptyContent:false,editorKernel:null,constructor:function(a){a=a||{};
CQ.Util.applyDefaults(a,{textPropertyName:"./text",boxCheckInterval:500,enterKeyMode:"ignore",tabKeyMode:"ignore"});
CQ.ipe.TextEditor.superclass.constructor.call(this,a)
},checkBoxChanged:function(g){if(this.isBoxChangeCheckActive||g){var c=CQ.Ext.get(this.textContainer);
var m=c.getXY();
var o=m[0];
var n=m[1];
if((this.currentPosition==null)||((o!=this.currentPosition.x)||(n!=this.currentPosition.y))){var j=this.currentPosition;
var k={x:o,y:n};
this.currentPosition=k;
this.fireRepositionEvent(k,j)
}var r=c.getSize();
var b=r.width;
var q=r.height;
if((this.currentSize==null)||((b!=this.currentSize.width)||(q!=this.currentSize.height))){var a=this.currentSize;
this.currentSize=r;
this.fireResizeEvent(r,a)
}if(!g){window.setTimeout(this.boxChangeHandler,this.boxCheckInterval)
}}},isEmptyText:function(){return false
},prepareForNewText:function(){},prepareEditing:function(a){return null
},prepareUpdate:function(){var g=this.textContainer.childNodes;
for(var b=g.length-1;
b>=0;
b--){var a=g[b];
if(a.nodeType==1){a.parentNode.removeChild(a)
}}},getHtmlContent:function(){return this.textContainer.innerHTML
},getTextDiv:function(c){var a=this.prepareEditing(c);
if(!a){var b=this.editElementQuery||"div:first";
if(b=="."){return c.dom
}a=CQ.Ext.DomQuery.selectNode(b,c.dom)
}if(!a){a=c.dom
}return a
},resetInplaceEditing:function(){CQ.Ext.EventManager.un(document.body,"keyup",this.handleKeyUp,this);
CQ.Ext.EventManager.un(document.body,"keydown",this.handleKeyDown,this);
this.textContainer.blur();
this.textContainer.contentEditable="inherit";
document.body.spellcheck=this.savedSpellcheckAttrib;
if(CQ.Ext.isGecko&&this.savedOutlineStyle){this.textContainer.style.outlineStyle=this.savedOutlineStyle
}this.isBoxChangeCheckActive=false
},handleKeyUp:function(g){if(!window.CQ_inplaceEditDialog){if(g.getCharCode()==27){this.editComponent.cancelInplaceEditing()
}else{var j=this.textContainer.childNodes;
var b=CUI.rte.Common;
var a;
if(CQ.Ext.isGecko){if(j.length==0){a=document.createElement("br");
this.textContainer.appendChild(a)
}else{if(j.length==1){var c=j[0];
if(b.isTag(c,b.BLOCK_TAGS)){if(c.childNodes.length==0){a=document.createElement("br");
c.appendChild(a)
}}}}}this.checkBoxChanged(true)
}}},handleKeyDown:function(a){if(!window.CQ_inplaceEditDialog){if(a.getCharCode()==a.ENTER){a.stopEvent();
if(this.enterKeyMode=="save"){CUI.rte.Utils.defer(this.editComponent.finishInplaceEditing,1,this.editComponent)
}}if(a.getCharCode()==a.TAB){if(this.tabKeyMode=="save"){a.stopEvent();
CUI.rte.Utils.defer(this.editComponent.finishInplaceEditing,1,this.editComponent)
}}}},getProperty:function(){return this.textPropertyName
},start:function(c,b,a){CQ.ipe.PlainTextEditor.superclass.start.call(this,c,b,a);
this.notifyInitialUndoContent(c.path,a);
this.editComponent=c;
this.textContainer=this.getTextDiv(b);
if(CQ.Ext.isGecko){this.textContainer.textContent=a||""
}else{this.textContainer.innerText=a||""
}this.currentSize=null;
this.currentPosition=null;
this.isEmptyContent=this.isEmptyText();
if(this.isEmptyContent){this.prepareForNewText()
}this.savedSpellcheckAttrib=document.body.spellcheck;
document.body.spellcheck=false;
CQ.Ext.EventManager.on(document.body,"keyup",this.handleKeyUp,this);
CQ.Ext.EventManager.on(document.body,"keydown",this.handleKeyDown,this);
this.textContainer.contentEditable="true";
if(CQ.Ext.isGecko){this.savedOutlineStyle=this.textContainer.style.outlineStyle;
this.textContainer.style.outlineStyle="none"
}window.setTimeout(CUI.rte.Utils.scope(function(){this.textContainer.focus()
},this),1);
this.isBoxChangeCheckActive=true;
this.boxChangeHandler=CUI.rte.Utils.scope(function(){this.checkBoxChanged(false)
},this);
this.checkBoxChanged(true);
window.setTimeout(this.boxChangeHandler,this.boxCheckInterval)
},finish:function(){this.resetInplaceEditing();
this.prepareUpdate();
var a=this.getHtmlContent();
a=CQ.Ext.util.Format.htmlDecode(a);
this.editComponent.updateParagraph(this.textPropertyName,a);
this.addUndoStep(a)
},cancel:function(){this.resetInplaceEditing();
this.editComponent.refreshSelf()
},overrideConfig:function(){this.transferConfigOption("textPropertyName");
this.transferConfigOption("boxCheckInterval");
this.transferConfigOption("enterKeyMode");
this.transferConfigOption("editElementQuery")
}});
CQ.ipe.InplaceEditing.register("plaintext",CQ.ipe.PlainTextEditor);
CQ.ipe.TitleEditor=CQ.Ext.extend(CQ.ipe.PlainTextEditor,{titleTag:null,imageReplacingTag:null,imageReplacingStyle:null,imageTitleAttribute:null,titleContainer:null,constructor:function(a){a=a||{};
CQ.Util.applyDefaults(a,{textPropertyName:"./jcr:title",titleTag:"h1",imageReplacingTag:"h3",imageReplacingStyle:"margin-top: 0;",imageTitleAttribute:"alt",enterKeyMode:"save"});
CQ.ipe.TitleEditor.superclass.constructor.call(this,a)
},prepareEditing:function(n){var o=CUI.rte.DomProcessor;
var g=CUI.rte.Common;
var c=new CUI.rte.EditContext(null,window,document,null);
this.titleContainer=CQ.Ext.DomQuery.selectNode(this.titleTag+":first",n.dom);
if(this.titleContainer){o.insertAsParent(c,this.titleContainer,"div");
return this.titleContainer
}var j=CQ.Ext.DomQuery.selectNode("img:first",n.dom);
if(j){var m=j.getAttribute(this.imageTitleAttribute);
if(m){var k=n.dom;
g.removeAllChildren(k);
var b=document.createElement("div");
k.appendChild(b);
var a=(this.imageReplacingStyle!=null?{style:this.imageReplacingStyle}:null);
this.titleContainer=o.createNode(c,this.imageReplacingTag,a);
document.createElement(this.imageReplacingTag);
b.appendChild(this.titleContainer);
var q=document.createTextNode(m);
this.titleContainer.appendChild(q);
return this.titleContainer
}}throw new Error("No title container found (must be a '"+this.titleTag+"' tag).")
},prepareUpdate:function(){var g=this.titleContainer.childNodes;
for(var b=g.length-1;
b>=0;
b--){var a=g[b];
if(a.nodeType==1){a.parentNode.removeChild(a)
}}},getHtmlContent:function(){return this.titleContainer.innerHTML
},overrideConfig:function(){CQ.ipe.TitleEditor.superclass.overrideConfig.call(this);
this.transferConfigOption("titleTag");
this.transferConfigOption("imageReplacingTag");
this.transferConfigOption("imageReplacingStyle");
this.transferConfigOption("imageTitleAttribute")
}});
CQ.ipe.InplaceEditing.register("title",CQ.ipe.TitleEditor);